module.exports=[40642,(a,b,c)=>{var d,e,f,g="__lodash_hash_undefined__",h="[object Arguments]",i="[object Array]",j="[object Boolean]",k="[object Date]",l="[object Error]",m="[object Function]",n="[object Map]",o="[object Number]",p="[object Object]",q="[object Promise]",r="[object RegExp]",s="[object Set]",t="[object String]",u="[object WeakMap]",v="[object ArrayBuffer]",w="[object DataView]",y=/^\[object .+?Constructor\]$/,z=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[h]=A[i]=A[v]=A[j]=A[w]=A[k]=A[l]=A[m]=A[n]=A[o]=A[p]=A[r]=A[s]=A[t]=A[u]=!1;var B=a.g&&a.g.Object===Object&&a.g,C="object"==typeof self&&self&&self.Object===Object&&self,D=B||C||Function("return this")(),E=c&&!c.nodeType&&c,F=E&&b&&!b.nodeType&&b,G=F&&F.exports===E,H=G&&B.process,I=function(){try{return H&&H.binding&&H.binding("util")}catch(a){}}(),J=I&&I.isTypedArray;function K(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function L(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}var M=Array.prototype,N=Function.prototype,O=Object.prototype,P=D["__core-js_shared__"],Q=N.toString,R=O.hasOwnProperty,S=(d=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"",T=O.toString,U=RegExp("^"+Q.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),V=G?D.Buffer:void 0,W=D.Symbol,X=D.Uint8Array,Y=O.propertyIsEnumerable,Z=M.splice,$=W?W.toStringTag:void 0,_=Object.getOwnPropertySymbols,aa=V?V.isBuffer:void 0,ab=(e=Object.keys,f=Object,function(a){return e(f(a))}),ac=aA(D,"DataView"),ad=aA(D,"Map"),ae=aA(D,"Promise"),af=aA(D,"Set"),ag=aA(D,"WeakMap"),ah=aA(Object,"create"),ai=aD(ac),aj=aD(ad),ak=aD(ae),al=aD(af),am=aD(ag),an=W?W.prototype:void 0,ao=an?an.valueOf:void 0;function ap(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function aq(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function ar(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function as(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new ar;++b<c;)this.add(a[b])}function at(a){var b=this.__data__=new aq(a);this.size=b.size}function au(a,b){for(var c=a.length;c--;)if(aE(a[c][0],b))return c;return -1}function av(a){var b;return null==a?void 0===a?"[object Undefined]":"[object Null]":$&&$ in Object(a)?function(a){var b=R.call(a,$),c=a[$];try{a[$]=void 0;var d=!0}catch(a){}var e=T.call(a);return d&&(b?a[$]=c:delete a[$]),e}(a):(b=a,T.call(b))}function aw(a){return aL(a)&&av(a)==h}function ax(a,b,c,d,e,f){var g=1&c,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a);if(j&&f.get(b))return j==b;var k=-1,l=!0,m=2&c?new as:void 0;for(f.set(a,b),f.set(b,a);++k<h;){var n=a[k],o=b[k];if(d)var p=g?d(o,n,k,b,a,f):d(n,o,k,a,b,f);if(void 0!==p){if(p)continue;l=!1;break}if(m){if(!function(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}(b,function(a,b){if(!m.has(b)&&(n===a||e(n,a,c,d,f)))return m.push(b)})){l=!1;break}}else if(!(n===o||e(n,o,c,d,f))){l=!1;break}}return f.delete(a),f.delete(b),l}function ay(a){var b;return b=aN(a),aG(a)?b:function(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}(b,aB(a))}function az(a,b){var c,d,e=a.__data__;return("string"==(d=typeof(c=b))||"number"==d||"symbol"==d||"boolean"==d?"__proto__"!==c:null===c)?e["string"==typeof b?"string":"hash"]:e.map}function aA(a,b){var c,d=null==a?void 0:a[b];return!(!aK(d)||(c=d,S&&S in c))&&(aI(d)?U:y).test(aD(d))?d:void 0}ap.prototype.clear=function(){this.__data__=ah?ah(null):{},this.size=0},ap.prototype.delete=function(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=!!b,b},ap.prototype.get=function(a){var b=this.__data__;if(ah){var c=b[a];return c===g?void 0:c}return R.call(b,a)?b[a]:void 0},ap.prototype.has=function(a){var b=this.__data__;return ah?void 0!==b[a]:R.call(b,a)},ap.prototype.set=function(a,b){var c=this.__data__;return this.size+=+!this.has(a),c[a]=ah&&void 0===b?g:b,this},aq.prototype.clear=function(){this.__data__=[],this.size=0},aq.prototype.delete=function(a){var b=this.__data__,c=au(b,a);return!(c<0)&&(c==b.length-1?b.pop():Z.call(b,c,1),--this.size,!0)},aq.prototype.get=function(a){var b=this.__data__,c=au(b,a);return c<0?void 0:b[c][1]},aq.prototype.has=function(a){return au(this.__data__,a)>-1},aq.prototype.set=function(a,b){var c=this.__data__,d=au(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this},ar.prototype.clear=function(){this.size=0,this.__data__={hash:new ap,map:new(ad||aq),string:new ap}},ar.prototype.delete=function(a){var b=az(this,a).delete(a);return this.size-=!!b,b},ar.prototype.get=function(a){return az(this,a).get(a)},ar.prototype.has=function(a){return az(this,a).has(a)},ar.prototype.set=function(a,b){var c=az(this,a),d=c.size;return c.set(a,b),this.size+=+(c.size!=d),this},as.prototype.add=as.prototype.push=function(a){return this.__data__.set(a,g),this},as.prototype.has=function(a){return this.__data__.has(a)},at.prototype.clear=function(){this.__data__=new aq,this.size=0},at.prototype.delete=function(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c},at.prototype.get=function(a){return this.__data__.get(a)},at.prototype.has=function(a){return this.__data__.has(a)},at.prototype.set=function(a,b){var c=this.__data__;if(c instanceof aq){var d=c.__data__;if(!ad||d.length<199)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new ar(d)}return c.set(a,b),this.size=c.size,this};var aB=_?function(a){return null==a?[]:function(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f}(_(a=Object(a)),function(b){return Y.call(a,b)})}:function(){return[]},aC=av;function aD(a){if(null!=a){try{return Q.call(a)}catch(a){}try{return a+""}catch(a){}}return""}function aE(a,b){return a===b||a!=a&&b!=b}(ac&&aC(new ac(new ArrayBuffer(1)))!=w||ad&&aC(new ad)!=n||ae&&aC(ae.resolve())!=q||af&&aC(new af)!=s||ag&&aC(new ag)!=u)&&(aC=function(a){var b=av(a),c=b==p?a.constructor:void 0,d=c?aD(c):"";if(d)switch(d){case ai:return w;case aj:return n;case ak:return q;case al:return s;case am:return u}return b});var aF=aw(function(){return arguments}())?aw:function(a){return aL(a)&&R.call(a,"callee")&&!Y.call(a,"callee")},aG=Array.isArray,aH=aa||function(){return!1};function aI(a){if(!aK(a))return!1;var b=av(a);return b==m||"[object GeneratorFunction]"==b||"[object AsyncFunction]"==b||"[object Proxy]"==b}function aJ(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=0x1fffffffffffff}function aK(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function aL(a){return null!=a&&"object"==typeof a}var aM=J?function(a){return J(a)}:function(a){return aL(a)&&aJ(a.length)&&!!A[av(a)]};function aN(a){return null!=a&&aJ(a.length)&&!aI(a)?function(a,b){var c,d,e=aG(a),f=!e&&aF(a),g=!e&&!f&&aH(a),h=!e&&!f&&!g&&aM(a),i=e||f||g||h,j=i?function(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}(a.length,String):[],k=j.length;for(var l in a){R.call(a,l)&&!(i&&("length"==l||g&&("offset"==l||"parent"==l)||h&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||(c=l,(d=null==(d=k)?0x1fffffffffffff:d)&&("number"==typeof c||z.test(c))&&c>-1&&c%1==0&&c<d)))&&j.push(l)}return j}(a):function(a){if(c=(b=a)&&b.constructor,b!==("function"==typeof c&&c.prototype||O))return ab(a);var b,c,d=[];for(var e in Object(a))R.call(a,e)&&"constructor"!=e&&d.push(e);return d}(a)}b.exports=function(a,b){return function a(b,c,d,e,f){return b===c||(null!=b&&null!=c&&(aL(b)||aL(c))?function(a,b,c,d,e,f){var g=aG(a),m=aG(b),q=g?i:aC(a),u=m?i:aC(b);q=q==h?p:q,u=u==h?p:u;var y=q==p,z=u==p,A=q==u;if(A&&aH(a)){if(!aH(b))return!1;g=!0,y=!1}if(A&&!y)return f||(f=new at),g||aM(a)?ax(a,b,c,d,e,f):function(a,b,c,d,e,f,g){switch(c){case w:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)break;a=a.buffer,b=b.buffer;case v:if(a.byteLength!=b.byteLength||!f(new X(a),new X(b)))break;return!0;case j:case k:case o:return aE(+a,+b);case l:return a.name==b.name&&a.message==b.message;case r:case t:return a==b+"";case n:var h=K;case s:var i=1&d;if(h||(h=L),a.size!=b.size&&!i)break;var m=g.get(a);if(m)return m==b;d|=2,g.set(a,b);var p=ax(h(a),h(b),d,e,f,g);return g.delete(a),p;case"[object Symbol]":if(ao)return ao.call(a)==ao.call(b)}return!1}(a,b,q,c,d,e,f);if(!(1&c)){var B=y&&R.call(a,"__wrapped__"),C=z&&R.call(b,"__wrapped__");if(B||C){var D=B?a.value():a,E=C?b.value():b;return f||(f=new at),e(D,E,c,d,f)}}return!!A&&(f||(f=new at),function(a,b,c,d,e,f){var g=1&c,h=ay(a),i=h.length;if(i!=ay(b).length&&!g)return!1;for(var j=i;j--;){var k=h[j];if(!(g?k in b:R.call(b,k)))return!1}var l=f.get(a);if(l&&f.get(b))return l==b;var m=!0;f.set(a,b),f.set(b,a);for(var n=g;++j<i;){var o=a[k=h[j]],p=b[k];if(d)var q=g?d(p,o,k,b,a,f):d(o,p,k,a,b,f);if(!(void 0===q?o===p||e(o,p,c,d,f):q)){m=!1;break}n||(n="constructor"==k)}if(m&&!n){var r=a.constructor,s=b.constructor;r!=s&&"constructor"in a&&"constructor"in b&&!("function"==typeof r&&r instanceof r&&"function"==typeof s&&s instanceof s)&&(m=!1)}return f.delete(a),f.delete(b),m}(a,b,c,d,e,f))}(b,c,d,e,a,f):b!=b&&c!=c)}(a,b)}},23401,(a,b,c)=>{var d,e,f,g="__lodash_hash_undefined__",h="[object Arguments]",i="[object Array]",j="[object Boolean]",k="[object Date]",l="[object Error]",m="[object Function]",n="[object Map]",o="[object Number]",p="[object Object]",q="[object Promise]",r="[object RegExp]",s="[object Set]",t="[object String]",u="[object WeakMap]",v="[object ArrayBuffer]",w="[object DataView]",y=/^\[object .+?Constructor\]$/,z=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[h]=A[i]=A[v]=A[j]=A[w]=A[k]=A[l]=A[m]=A[n]=A[o]=A[p]=A[r]=A[s]=A[t]=A[u]=!1;var B=a.g&&a.g.Object===Object&&a.g,C="object"==typeof self&&self&&self.Object===Object&&self,D=B||C||Function("return this")(),E=c&&!c.nodeType&&c,F=E&&b&&!b.nodeType&&b,G=F&&F.exports===E&&B.process,H=function(){try{return G&&G.binding("util")}catch(a){}}(),I=H&&H.isTypedArray;function J(a){var b=!1;if(null!=a&&"function"!=typeof a.toString)try{b=!!(a+"")}catch(a){}return b}function K(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function L(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}var M=Array.prototype,N=Function.prototype,O=Object.prototype,P=D["__core-js_shared__"],Q=(d=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"",R=N.toString,S=O.hasOwnProperty,T=O.toString,U=RegExp("^"+R.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),V=D.Symbol,W=D.Uint8Array,X=O.propertyIsEnumerable,Y=M.splice,Z=(e=Object.keys,f=Object,function(a){return e(f(a))}),$=at(D,"DataView"),_=at(D,"Map"),aa=at(D,"Promise"),ab=at(D,"Set"),ac=at(D,"WeakMap"),ad=at(Object,"create"),ae=av($),af=av(_),ag=av(aa),ah=av(ab),ai=av(ac),aj=V?V.prototype:void 0,ak=aj?aj.valueOf:void 0;function al(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function am(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function an(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function ao(a){var b=-1,c=a?a.length:0;for(this.__data__=new an;++b<c;)this.add(a[b])}function ap(a){this.__data__=new am(a)}function aq(a,b){for(var c=a.length;c--;)if(aw(a[c][0],b))return c;return -1}function ar(a,b,c,d,e,f){var g=2&e,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a);if(j&&f.get(b))return j==b;var k=-1,l=!0,m=1&e?new ao:void 0;for(f.set(a,b),f.set(b,a);++k<h;){var n=a[k],o=b[k];if(d)var p=g?d(o,n,k,b,a,f):d(n,o,k,a,b,f);if(void 0!==p){if(p)continue;l=!1;break}if(m){if(!function(a,b){for(var c=-1,d=a?a.length:0;++c<d;)if(b(a[c],c,a))return!0;return!1}(b,function(a,b){if(!m.has(b)&&(n===a||c(n,a,d,e,f)))return m.add(b)})){l=!1;break}}else if(!(n===o||c(n,o,d,e,f))){l=!1;break}}return f.delete(a),f.delete(b),l}function as(a,b){var c,d,e=a.__data__;return("string"==(d=typeof(c=b))||"number"==d||"symbol"==d||"boolean"==d?"__proto__"!==c:null===c)?e["string"==typeof b?"string":"hash"]:e.map}function at(a,b){var c,d=null==a?void 0:a[b];return!(!aB(d)||(c=d,Q&&Q in c))&&(az(d)||J(d)?U:y).test(av(d))?d:void 0}al.prototype.clear=function(){this.__data__=ad?ad(null):{}},al.prototype.delete=function(a){return this.has(a)&&delete this.__data__[a]},al.prototype.get=function(a){var b=this.__data__;if(ad){var c=b[a];return c===g?void 0:c}return S.call(b,a)?b[a]:void 0},al.prototype.has=function(a){var b=this.__data__;return ad?void 0!==b[a]:S.call(b,a)},al.prototype.set=function(a,b){return this.__data__[a]=ad&&void 0===b?g:b,this},am.prototype.clear=function(){this.__data__=[]},am.prototype.delete=function(a){var b=this.__data__,c=aq(b,a);return!(c<0)&&(c==b.length-1?b.pop():Y.call(b,c,1),!0)},am.prototype.get=function(a){var b=this.__data__,c=aq(b,a);return c<0?void 0:b[c][1]},am.prototype.has=function(a){return aq(this.__data__,a)>-1},am.prototype.set=function(a,b){var c=this.__data__,d=aq(c,a);return d<0?c.push([a,b]):c[d][1]=b,this},an.prototype.clear=function(){this.__data__={hash:new al,map:new(_||am),string:new al}},an.prototype.delete=function(a){return as(this,a).delete(a)},an.prototype.get=function(a){return as(this,a).get(a)},an.prototype.has=function(a){return as(this,a).has(a)},an.prototype.set=function(a,b){return as(this,a).set(a,b),this},ao.prototype.add=ao.prototype.push=function(a){return this.__data__.set(a,g),this},ao.prototype.has=function(a){return this.__data__.has(a)},ap.prototype.clear=function(){this.__data__=new am},ap.prototype.delete=function(a){return this.__data__.delete(a)},ap.prototype.get=function(a){return this.__data__.get(a)},ap.prototype.has=function(a){return this.__data__.has(a)},ap.prototype.set=function(a,b){var c=this.__data__;if(c instanceof am){var d=c.__data__;if(!_||d.length<199)return d.push([a,b]),this;c=this.__data__=new an(d)}return c.set(a,b),this};var au=function(a){return T.call(a)};function av(a){if(null!=a){try{return R.call(a)}catch(a){}try{return a+""}catch(a){}}return""}function aw(a,b){return a===b||a!=a&&b!=b}($&&au(new $(new ArrayBuffer(1)))!=w||_&&au(new _)!=n||aa&&au(aa.resolve())!=q||ab&&au(new ab)!=s||ac&&au(new ac)!=u)&&(au=function(a){var b=T.call(a),c=b==p?a.constructor:void 0,d=c?av(c):void 0;if(d)switch(d){case ae:return w;case af:return n;case ag:return q;case ah:return s;case ai:return u}return b});var ax=Array.isArray;function ay(a){return null!=a&&aA(a.length)&&!az(a)}function az(a){var b=aB(a)?T.call(a):"";return b==m||"[object GeneratorFunction]"==b}function aA(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=0x1fffffffffffff}function aB(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function aC(a){return!!a&&"object"==typeof a}var aD=I?function(a){return I(a)}:function(a){return aC(a)&&aA(a.length)&&!!A[T.call(a)]};function aE(a){return ay(a)?function(a,b){var c,d,e,f,g=ax(a)||aC(d=c=a)&&ay(d)&&S.call(c,"callee")&&(!X.call(c,"callee")||T.call(c)==h)?function(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}(a.length,String):[],i=g.length,j=!!i;for(var k in a){S.call(a,k)&&!(j&&("length"==k||(e=k,(f=null==(f=i)?0x1fffffffffffff:f)&&("number"==typeof e||z.test(e))&&e>-1&&e%1==0&&e<f)))&&g.push(k)}return g}(a):function(a){if(c=(b=a)&&b.constructor,b!==("function"==typeof c&&c.prototype||O))return Z(a);var b,c,d=[];for(var e in Object(a))S.call(a,e)&&"constructor"!=e&&d.push(e);return d}(a)}b.exports=function(a,b,c){var d=(c="function"==typeof c?c:void 0)?c(a,b):void 0;return void 0===d?function a(b,c,d,e,f){return b===c||(null!=b&&null!=c&&(aB(b)||aC(c))?function(a,b,c,d,e,f){var g=ax(a),m=ax(b),q=i,u=i;g||(q=(q=au(a))==h?p:q),m||(u=(u=au(b))==h?p:u);var y=q==p&&!J(a),z=u==p&&!J(b),A=q==u;if(A&&!y)return f||(f=new ap),g||aD(a)?ar(a,b,c,d,e,f):function(a,b,c,d,e,f,g){switch(c){case w:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)break;a=a.buffer,b=b.buffer;case v:if(a.byteLength!=b.byteLength||!d(new W(a),new W(b)))break;return!0;case j:case k:case o:return aw(+a,+b);case l:return a.name==b.name&&a.message==b.message;case r:case t:return a==b+"";case n:var h=K;case s:var i=2&f;if(h||(h=L),a.size!=b.size&&!i)break;var m=g.get(a);if(m)return m==b;f|=1,g.set(a,b);var p=ar(h(a),h(b),d,e,f,g);return g.delete(a),p;case"[object Symbol]":if(ak)return ak.call(a)==ak.call(b)}return!1}(a,b,q,c,d,e,f);if(!(2&e)){var B=y&&S.call(a,"__wrapped__"),C=z&&S.call(b,"__wrapped__");if(B||C){var D=B?a.value():a,E=C?b.value():b;return f||(f=new ap),c(D,E,d,e,f)}}return!!A&&(f||(f=new ap),function(a,b,c,d,e,f){var g=2&e,h=aE(a),i=h.length;if(i!=aE(b).length&&!g)return!1;for(var j=i;j--;){var k=h[j];if(!(g?k in b:S.call(b,k)))return!1}var l=f.get(a);if(l&&f.get(b))return l==b;var m=!0;f.set(a,b),f.set(b,a);for(var n=g;++j<i;){var o=a[k=h[j]],p=b[k];if(d)var q=g?d(p,o,k,b,a,f):d(o,p,k,a,b,f);if(!(void 0===q?o===p||c(o,p,d,e,f):q)){m=!1;break}n||(n="constructor"==k)}if(m&&!n){var r=a.constructor,s=b.constructor;r!=s&&"constructor"in a&&"constructor"in b&&!("function"==typeof r&&r instanceof r&&"function"==typeof s&&s instanceof s)&&(m=!1)}return f.delete(a),f.delete(b),m}(a,b,c,d,e,f))}(b,c,a,d,e,f):b!=b&&c!=c)}(a,b,c):!!d}},65938,(a,b,c)=>{var d="Expected a function",e=0/0,f=/^\s+|\s+$/g,g=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,i=/^0o[0-7]+$/i,j=parseInt,k=a.g&&a.g.Object===Object&&a.g,l="object"==typeof self&&self&&self.Object===Object&&self,m=k||l||Function("return this")(),n=Object.prototype.toString,o=Math.max,p=Math.min,q=function(){return m.Date.now()};function r(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function s(a){if("number"==typeof a)return a;if("symbol"==typeof(b=a)||b&&"object"==typeof b&&"[object Symbol]"==n.call(b))return e;if(r(a)){var b,c="function"==typeof a.valueOf?a.valueOf():a;a=r(c)?c+"":c}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(f,"");var d=h.test(a);return d||i.test(a)?j(a.slice(2),d?2:8):g.test(a)?e:+a}b.exports=function(a,b,c){var e=!0,f=!0;if("function"!=typeof a)throw TypeError(d);return r(c)&&(e="leading"in c?!!c.leading:e,f="trailing"in c?!!c.trailing:f),function(a,b,c){var e,f,g,h,i,j,k=0,l=!1,m=!1,n=!0;if("function"!=typeof a)throw TypeError(d);function t(b){var c=e,d=f;return e=f=void 0,k=b,h=a.apply(d,c)}function u(a){var c=a-j,d=a-k;return void 0===j||c>=b||c<0||m&&d>=g}function v(){var a,c,d,e=q();if(u(e))return w(e);i=setTimeout(v,(a=e-j,c=e-k,d=b-a,m?p(d,g-c):d))}function w(a){return(i=void 0,n&&e)?t(a):(e=f=void 0,h)}function y(){var a,c=q(),d=u(c);if(e=arguments,f=this,j=c,d){if(void 0===i)return k=a=j,i=setTimeout(v,b),l?t(a):h;if(m)return i=setTimeout(v,b),t(j)}return void 0===i&&(i=setTimeout(v,b)),h}return b=s(b)||0,r(c)&&(l=!!c.leading,g=(m="maxWait"in c)?o(s(c.maxWait)||0,b):g,n="trailing"in c?!!c.trailing:n),y.cancel=function(){void 0!==i&&clearTimeout(i),k=0,e=j=f=i=void 0},y.flush=function(){return void 0===i?h:w(q())},y}(a,b,{leading:e,maxWait:b,trailing:f})}},79644,(a,b,c)=>{var d,e="__lodash_hash_undefined__",f=/^\[object .+?Constructor\]$/,g=a.g&&a.g.Object===Object&&a.g,h="object"==typeof self&&self&&self.Object===Object&&self,i=g||h||Function("return this")();function j(a,b){return!!(a?a.length:0)&&function(a,b,c){if(b!=b){for(var d=k,e=a.length,f=-1;++f<e;)if(d(a[f],f,a))return f;return -1}for(var g=-1,h=a.length;++g<h;)if(a[g]===b)return g;return -1}(a,b,0)>-1}function k(a){return a!=a}function l(a,b){return a.has(b)}function m(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}var n=Array.prototype,o=Function.prototype,p=Object.prototype,q=i["__core-js_shared__"],r=(d=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"",s=o.toString,t=p.hasOwnProperty,u=p.toString,v=RegExp("^"+s.call(t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),w=n.splice,y=I(i,"Map"),z=I(i,"Set"),A=I(Object,"create");function B(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function C(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function D(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function E(a){var b=-1,c=a?a.length:0;for(this.__data__=new D;++b<c;)this.add(a[b])}function F(a,b){for(var c,d,e=a.length;e--;){if(c=a[e][0],c===(d=b)||c!=c&&d!=d)return e}return -1}B.prototype.clear=function(){this.__data__=A?A(null):{}},B.prototype.delete=function(a){return this.has(a)&&delete this.__data__[a]},B.prototype.get=function(a){var b=this.__data__;if(A){var c=b[a];return c===e?void 0:c}return t.call(b,a)?b[a]:void 0},B.prototype.has=function(a){var b=this.__data__;return A?void 0!==b[a]:t.call(b,a)},B.prototype.set=function(a,b){return this.__data__[a]=A&&void 0===b?e:b,this},C.prototype.clear=function(){this.__data__=[]},C.prototype.delete=function(a){var b=this.__data__,c=F(b,a);return!(c<0)&&(c==b.length-1?b.pop():w.call(b,c,1),!0)},C.prototype.get=function(a){var b=this.__data__,c=F(b,a);return c<0?void 0:b[c][1]},C.prototype.has=function(a){return F(this.__data__,a)>-1},C.prototype.set=function(a,b){var c=this.__data__,d=F(c,a);return d<0?c.push([a,b]):c[d][1]=b,this},D.prototype.clear=function(){this.__data__={hash:new B,map:new(y||C),string:new B}},D.prototype.delete=function(a){return H(this,a).delete(a)},D.prototype.get=function(a){return H(this,a).get(a)},D.prototype.has=function(a){return H(this,a).has(a)},D.prototype.set=function(a,b){return H(this,a).set(a,b),this},E.prototype.add=E.prototype.push=function(a){return this.__data__.set(a,e),this},E.prototype.has=function(a){return this.__data__.has(a)};var G=z&&1/m(new z([,-0]))[1]==1/0?function(a){return new z(a)}:function(){};function H(a,b){var c,d,e=a.__data__;return("string"==(d=typeof(c=b))||"number"==d||"symbol"==d||"boolean"==d?"__proto__"!==c:null===c)?e["string"==typeof b?"string":"hash"]:e.map}function I(a,b){var c,d,e,g=null==a?void 0:a[b];return!(!J(g)||(c=g,r&&r in c))&&("[object Function]"==(e=J(d=g)?u.call(d):"")||"[object GeneratorFunction]"==e||function(a){var b=!1;if(null!=a&&"function"!=typeof a.toString)try{b=!!(a+"")}catch(a){}return b}(g)?v:f).test(function(a){if(null!=a){try{return s.call(a)}catch(a){}try{return a+""}catch(a){}}return""}(g))?g:void 0}function J(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}b.exports=function(a){return a&&a.length?function(a,b,c){var d=-1,e=j,f=a.length,g=!0,h=[],i=h;if(f>=200){var k=G(a);if(k)return m(k);g=!1,e=l,i=new E}else i=h;a:for(;++d<f;){var n=a[d],o=n;if(n=0!==n?n:0,g&&o==o){for(var p=i.length;p--;)if(i[p]===o)continue a;h.push(n)}else e(i,o,void 0)||(i!==h&&i.push(o),h.push(n))}return h}(a):[]}},29500,(a,b,c)=>{"use strict";var d=function(a){return a&&a.Math===Math&&a};b.exports=d("object"==typeof globalThis&&globalThis)||d(!1)||d("object"==typeof self&&self)||d(a.g)||d("object"==typeof a.e&&a.e)||function(){return this}()||Function("return this")()},30911,(a,b,c)=>{"use strict";b.exports=function(a){try{return!!a()}catch(a){return!0}}},61975,(a,b,c)=>{"use strict";b.exports=!a.r(30911)(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},54355,(a,b,c)=>{"use strict";b.exports=!a.r(30911)(function(){var a=(function(){}).bind();return"function"!=typeof a||a.hasOwnProperty("prototype")})},84066,(a,b,c)=>{"use strict";var d=a.r(54355),e=Function.prototype.call;b.exports=d?e.bind(e):function(){return e.apply(e,arguments)}},10895,(a,b,c)=>{"use strict";var d={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor;c.f=e&&!d.call({1:2},1)?function(a){var b=e(this,a);return!!b&&b.enumerable}:d},66455,(a,b,c)=>{"use strict";b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},7807,(a,b,c)=>{"use strict";var d=a.r(54355),e=Function.prototype,f=e.call,g=d&&e.bind.bind(f,f);b.exports=d?g:function(a){return function(){return f.apply(a,arguments)}}},2924,(a,b,c)=>{"use strict";var d=a.r(7807),e=d({}.toString),f=d("".slice);b.exports=function(a){return f(e(a),8,-1)}},57783,(a,b,c)=>{"use strict";var d=a.r(7807),e=a.r(30911),f=a.r(2924),g=Object,h=d("".split);b.exports=e(function(){return!g("z").propertyIsEnumerable(0)})?function(a){return"String"===f(a)?h(a,""):g(a)}:g},29809,(a,b,c)=>{"use strict";b.exports=function(a){return null==a}},31713,(a,b,c)=>{"use strict";var d=a.r(29809),e=TypeError;b.exports=function(a){if(d(a))throw new e("Can't call method on "+a);return a}},72636,(a,b,c)=>{"use strict";var d=a.r(57783),e=a.r(31713);b.exports=function(a){return d(e(a))}},54081,(a,b,c)=>{"use strict";var d="object"==typeof document&&document.all;b.exports=void 0===d&&void 0!==d?function(a){return"function"==typeof a||a===d}:function(a){return"function"==typeof a}},74604,(a,b,c)=>{"use strict";var d=a.r(54081);b.exports=function(a){return"object"==typeof a?null!==a:d(a)}},71699,(a,b,c)=>{"use strict";var d=a.r(29500),e=a.r(54081);b.exports=function(a,b){var c;return arguments.length<2?e(c=d[a])?c:void 0:d[a]&&d[a][b]}},39829,(a,b,c)=>{"use strict";b.exports=a.r(7807)({}.isPrototypeOf)},8358,(a,b,c)=>{"use strict";var d=a.r(29500).navigator,e=d&&d.userAgent;b.exports=e?String(e):""},12557,(a,b,c)=>{"use strict";var d,e,f=a.r(29500),g=a.r(8358),h=f.process,i=f.Deno,j=h&&h.versions||i&&i.version,k=j&&j.v8;k&&(e=(d=k.split("."))[0]>0&&d[0]<4?1:+(d[0]+d[1])),!e&&g&&(!(d=g.match(/Edge\/(\d+)/))||d[1]>=74)&&(d=g.match(/Chrome\/(\d+)/))&&(e=+d[1]),b.exports=e},47798,(a,b,c)=>{"use strict";var d=a.r(12557),e=a.r(30911),f=a.r(29500).String;b.exports=!!Object.getOwnPropertySymbols&&!e(function(){var a=Symbol("symbol detection");return!f(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&d&&d<41})},98145,(a,b,c)=>{"use strict";b.exports=a.r(47798)&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},66472,(a,b,c)=>{"use strict";var d=a.r(71699),e=a.r(54081),f=a.r(39829),g=a.r(98145),h=Object;b.exports=g?function(a){return"symbol"==typeof a}:function(a){var b=d("Symbol");return e(b)&&f(b.prototype,h(a))}},22030,(a,b,c)=>{"use strict";var d=String;b.exports=function(a){try{return d(a)}catch(a){return"Object"}}},21559,(a,b,c)=>{"use strict";var d=a.r(54081),e=a.r(22030),f=TypeError;b.exports=function(a){if(d(a))return a;throw new f(e(a)+" is not a function")}},1803,(a,b,c)=>{"use strict";var d=a.r(21559),e=a.r(29809);b.exports=function(a,b){var c=a[b];return e(c)?void 0:d(c)}},36361,(a,b,c)=>{"use strict";var d=a.r(84066),e=a.r(54081),f=a.r(74604),g=TypeError;b.exports=function(a,b){var c,h;if("string"===b&&e(c=a.toString)&&!f(h=d(c,a))||e(c=a.valueOf)&&!f(h=d(c,a))||"string"!==b&&e(c=a.toString)&&!f(h=d(c,a)))return h;throw new g("Can't convert object to primitive value")}},68006,(a,b,c)=>{"use strict";b.exports=!1},86217,(a,b,c)=>{"use strict";var d=a.r(29500),e=Object.defineProperty;b.exports=function(a,b){try{e(d,a,{value:b,configurable:!0,writable:!0})}catch(c){d[a]=b}return b}},5542,(a,b,c)=>{"use strict";var d=a.r(68006),e=a.r(29500),f=a.r(86217),g="__core-js_shared__",h=b.exports=e[g]||f(g,{});(h.versions||(h.versions=[])).push({version:"3.47.0",mode:d?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"})},64414,(a,b,c)=>{"use strict";var d=a.r(5542);b.exports=function(a,b){return d[a]||(d[a]=b||{})}},77024,(a,b,c)=>{"use strict";var d=a.r(31713),e=Object;b.exports=function(a){return e(d(a))}},33061,(a,b,c)=>{"use strict";var d=a.r(7807),e=a.r(77024),f=d({}.hasOwnProperty);b.exports=Object.hasOwn||function(a,b){return f(e(a),b)}},49550,(a,b,c)=>{"use strict";var d=a.r(7807),e=0,f=Math.random(),g=d(1.1.toString);b.exports=function(a){return"Symbol("+(void 0===a?"":a)+")_"+g(++e+f,36)}},29985,(a,b,c)=>{"use strict";var d=a.r(29500),e=a.r(64414),f=a.r(33061),g=a.r(49550),h=a.r(47798),i=a.r(98145),j=d.Symbol,k=e("wks"),l=i?j.for||j:j&&j.withoutSetter||g;b.exports=function(a){return f(k,a)||(k[a]=h&&f(j,a)?j[a]:l("Symbol."+a)),k[a]}},44545,(a,b,c)=>{"use strict";var d=a.r(84066),e=a.r(74604),f=a.r(66472),g=a.r(1803),h=a.r(36361),i=a.r(29985),j=TypeError,k=i("toPrimitive");b.exports=function(a,b){if(!e(a)||f(a))return a;var c,i=g(a,k);if(i){if(void 0===b&&(b="default"),!e(c=d(i,a,b))||f(c))return c;throw new j("Can't convert object to primitive value")}return void 0===b&&(b="number"),h(a,b)}},31403,(a,b,c)=>{"use strict";var d=a.r(44545),e=a.r(66472);b.exports=function(a){var b=d(a,"string");return e(b)?b:b+""}},36659,(a,b,c)=>{"use strict";var d=a.r(29500),e=a.r(74604),f=d.document,g=e(f)&&e(f.createElement);b.exports=function(a){return g?f.createElement(a):{}}},96035,(a,b,c)=>{"use strict";var d=a.r(61975),e=a.r(30911),f=a.r(36659);b.exports=!d&&!e(function(){return 7!==Object.defineProperty(f("div"),"a",{get:function(){return 7}}).a})},37033,(a,b,c)=>{"use strict";var d=a.r(61975),e=a.r(84066),f=a.r(10895),g=a.r(66455),h=a.r(72636),i=a.r(31403),j=a.r(33061),k=a.r(96035),l=Object.getOwnPropertyDescriptor;c.f=d?l:function(a,b){if(a=h(a),b=i(b),k)try{return l(a,b)}catch(a){}if(j(a,b))return g(!e(f.f,a,b),a[b])}},10235,(a,b,c)=>{"use strict";var d=a.r(61975),e=a.r(30911);b.exports=d&&e(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},98280,(a,b,c)=>{"use strict";var d=a.r(74604),e=String,f=TypeError;b.exports=function(a){if(d(a))return a;throw new f(e(a)+" is not an object")}},17068,(a,b,c)=>{"use strict";var d=a.r(61975),e=a.r(96035),f=a.r(10235),g=a.r(98280),h=a.r(31403),i=TypeError,j=Object.defineProperty,k=Object.getOwnPropertyDescriptor,l="enumerable",m="configurable",n="writable";c.f=d?f?function(a,b,c){if(g(a),b=h(b),g(c),"function"==typeof a&&"prototype"===b&&"value"in c&&n in c&&!c[n]){var d=k(a,b);d&&d[n]&&(a[b]=c.value,c={configurable:m in c?c[m]:d[m],enumerable:l in c?c[l]:d[l],writable:!1})}return j(a,b,c)}:j:function(a,b,c){if(g(a),b=h(b),g(c),e)try{return j(a,b,c)}catch(a){}if("get"in c||"set"in c)throw new i("Accessors not supported");return"value"in c&&(a[b]=c.value),a}},12930,(a,b,c)=>{"use strict";var d=a.r(61975),e=a.r(17068),f=a.r(66455);b.exports=d?function(a,b,c){return e.f(a,b,f(1,c))}:function(a,b,c){return a[b]=c,a}},27840,(a,b,c)=>{"use strict";var d=a.r(61975),e=a.r(33061),f=Function.prototype,g=d&&Object.getOwnPropertyDescriptor,h=e(f,"name"),i=h&&(!d||d&&g(f,"name").configurable);b.exports={EXISTS:h,PROPER:h&&"something"===(function(){}).name,CONFIGURABLE:i}},85011,(a,b,c)=>{"use strict";var d=a.r(7807),e=a.r(54081),f=a.r(5542),g=d(Function.toString);e(f.inspectSource)||(f.inspectSource=function(a){return g(a)}),b.exports=f.inspectSource},28081,(a,b,c)=>{"use strict";var d=a.r(29500),e=a.r(54081),f=d.WeakMap;b.exports=e(f)&&/native code/.test(String(f))},62097,(a,b,c)=>{"use strict";var d=a.r(64414),e=a.r(49550),f=d("keys");b.exports=function(a){return f[a]||(f[a]=e(a))}},3705,(a,b,c)=>{"use strict";b.exports={}},11953,(a,b,c)=>{"use strict";var d,e,f,g=a.r(28081),h=a.r(29500),i=a.r(74604),j=a.r(12930),k=a.r(33061),l=a.r(5542),m=a.r(62097),n=a.r(3705),o="Object already initialized",p=h.TypeError,q=h.WeakMap;if(g||l.state){var r=l.state||(l.state=new q);r.get=r.get,r.has=r.has,r.set=r.set,d=function(a,b){if(r.has(a))throw new p(o);return b.facade=a,r.set(a,b),b},e=function(a){return r.get(a)||{}},f=function(a){return r.has(a)}}else{var s=m("state");n[s]=!0,d=function(a,b){if(k(a,s))throw new p(o);return b.facade=a,j(a,s,b),b},e=function(a){return k(a,s)?a[s]:{}},f=function(a){return k(a,s)}}b.exports={set:d,get:e,has:f,enforce:function(a){return f(a)?e(a):d(a,{})},getterFor:function(a){return function(b){var c;if(!i(b)||(c=e(b)).type!==a)throw new p("Incompatible receiver, "+a+" required");return c}}}},29082,(a,b,c)=>{"use strict";var d=a.r(7807),e=a.r(30911),f=a.r(54081),g=a.r(33061),h=a.r(61975),i=a.r(27840).CONFIGURABLE,j=a.r(85011),k=a.r(11953),l=k.enforce,m=k.get,n=String,o=Object.defineProperty,p=d("".slice),q=d("".replace),r=d([].join),s=h&&!e(function(){return 8!==o(function(){},"length",{value:8}).length}),t=String(String).split("String"),u=b.exports=function(a,b,c){"Symbol("===p(n(b),0,7)&&(b="["+q(n(b),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),c&&c.getter&&(b="get "+b),c&&c.setter&&(b="set "+b),(!g(a,"name")||i&&a.name!==b)&&(h?o(a,"name",{value:b,configurable:!0}):a.name=b),s&&c&&g(c,"arity")&&a.length!==c.arity&&o(a,"length",{value:c.arity});try{c&&g(c,"constructor")&&c.constructor?h&&o(a,"prototype",{writable:!1}):a.prototype&&(a.prototype=void 0)}catch(a){}var d=l(a);return g(d,"source")||(d.source=r(t,"string"==typeof b?b:"")),a};Function.prototype.toString=u(function(){return f(this)&&m(this).source||j(this)},"toString")},72973,(a,b,c)=>{"use strict";var d=a.r(54081),e=a.r(17068),f=a.r(29082),g=a.r(86217);b.exports=function(a,b,c,h){h||(h={});var i=h.enumerable,j=void 0!==h.name?h.name:b;if(d(c)&&f(c,j,h),h.global)i?a[b]=c:g(b,c);else{try{h.unsafe?a[b]&&(i=!0):delete a[b]}catch(a){}i?a[b]=c:e.f(a,b,{value:c,enumerable:!1,configurable:!h.nonConfigurable,writable:!h.nonWritable})}return a}},76705,(a,b,c)=>{"use strict";var d=Math.ceil,e=Math.floor;b.exports=Math.trunc||function(a){var b=+a;return(b>0?e:d)(b)}},25056,(a,b,c)=>{"use strict";var d=a.r(76705);b.exports=function(a){var b=+a;return b!=b||0===b?0:d(b)}},49290,(a,b,c)=>{"use strict";var d=a.r(25056),e=Math.max,f=Math.min;b.exports=function(a,b){var c=d(a);return c<0?e(c+b,0):f(c,b)}},97504,(a,b,c)=>{"use strict";var d=a.r(25056),e=Math.min;b.exports=function(a){var b=d(a);return b>0?e(b,0x1fffffffffffff):0}},56571,(a,b,c)=>{"use strict";var d=a.r(97504);b.exports=function(a){return d(a.length)}},50244,(a,b,c)=>{"use strict";var d=a.r(72636),e=a.r(49290),f=a.r(56571),g=function(a){return function(b,c,g){var h,i=d(b),j=f(i);if(0===j)return!a&&-1;var k=e(g,j);if(a&&c!=c){for(;j>k;)if((h=i[k++])!=h)return!0}else for(;j>k;k++)if((a||k in i)&&i[k]===c)return a||k||0;return!a&&-1}};b.exports={includes:g(!0),indexOf:g(!1)}},71868,(a,b,c)=>{"use strict";var d=a.r(7807),e=a.r(33061),f=a.r(72636),g=a.r(50244).indexOf,h=a.r(3705),i=d([].push);b.exports=function(a,b){var c,d=f(a),j=0,k=[];for(c in d)!e(h,c)&&e(d,c)&&i(k,c);for(;b.length>j;)e(d,c=b[j++])&&(~g(k,c)||i(k,c));return k}},7424,(a,b,c)=>{"use strict";b.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},60379,(a,b,c)=>{"use strict";var d=a.r(71868),e=a.r(7424).concat("length","prototype");c.f=Object.getOwnPropertyNames||function(a){return d(a,e)}},98620,(a,b,c)=>{"use strict";c.f=Object.getOwnPropertySymbols},61806,(a,b,c)=>{"use strict";var d=a.r(71699),e=a.r(7807),f=a.r(60379),g=a.r(98620),h=a.r(98280),i=e([].concat);b.exports=d("Reflect","ownKeys")||function(a){var b=f.f(h(a)),c=g.f;return c?i(b,c(a)):b}},85481,(a,b,c)=>{"use strict";var d=a.r(33061),e=a.r(61806),f=a.r(37033),g=a.r(17068);b.exports=function(a,b,c){for(var h=e(b),i=g.f,j=f.f,k=0;k<h.length;k++){var l=h[k];d(a,l)||c&&d(c,l)||i(a,l,j(b,l))}}},75377,(a,b,c)=>{"use strict";var d=a.r(30911),e=a.r(54081),f=/#|\.prototype\./,g=function(a,b){var c=i[h(a)];return c===k||c!==j&&(e(b)?d(b):!!b)},h=g.normalize=function(a){return String(a).replace(f,".").toLowerCase()},i=g.data={},j=g.NATIVE="N",k=g.POLYFILL="P";b.exports=g},66334,(a,b,c)=>{"use strict";var d=a.r(29500),e=a.r(37033).f,f=a.r(12930),g=a.r(72973),h=a.r(86217),i=a.r(85481),j=a.r(75377);b.exports=function(a,b){var c,k,l,m,n,o=a.target,p=a.global,q=a.stat;if(c=p?d:q?d[o]||h(o,{}):d[o]&&d[o].prototype)for(k in b){if(m=b[k],l=a.dontCallGetSet?(n=e(c,k))&&n.value:c[k],!j(p?k:o+(q?".":"#")+k,a.forced)&&void 0!==l){if(typeof m==typeof l)continue;i(m,l)}(a.sham||l&&l.sham)&&f(m,"sham",!0),g(c,k,m,a)}}},74376,(a,b,c)=>{"use strict";var d=a.r(71868),e=a.r(7424);b.exports=Object.keys||function(a){return d(a,e)}},84231,(a,b,c)=>{"use strict";var d=a.r(61975),e=a.r(10235),f=a.r(17068),g=a.r(98280),h=a.r(72636),i=a.r(74376);c.f=d&&!e?Object.defineProperties:function(a,b){g(a);for(var c,d=h(b),e=i(b),j=e.length,k=0;j>k;)f.f(a,c=e[k++],d[c]);return a}},44105,(a,b,c)=>{"use strict";b.exports=a.r(71699)("document","documentElement")},20244,(a,b,c)=>{"use strict";var d,e=a.r(98280),f=a.r(84231),g=a.r(7424),h=a.r(3705),i=a.r(44105),j=a.r(36659),k=a.r(62097),l="prototype",m="script",n=k("IE_PROTO"),o=function(){},p=function(a){return"<"+m+">"+a+"</"+m+">"},q=function(a){a.write(p("")),a.close();var b=a.parentWindow.Object;return a=null,b},r=function(){var a,b=j("iframe");return b.style.display="none",i.appendChild(b),b.src=String("java"+m+":"),(a=b.contentWindow.document).open(),a.write(p("document.F=Object")),a.close(),a.F},s=function(){try{d=new ActiveXObject("htmlfile")}catch(a){}s="undefined"!=typeof document?document.domain&&d?q(d):r():q(d);for(var a=g.length;a--;)delete s[l][g[a]];return s()};h[n]=!0,b.exports=Object.create||function(a,b){var c;return null!==a?(o[l]=e(a),c=new o,o[l]=null,c[n]=a):c=s(),void 0===b?c:f.f(c,b)}},27043,(a,b,c)=>{"use strict";var d=a.r(29985),e=a.r(20244),f=a.r(17068).f,g=d("unscopables"),h=Array.prototype;void 0===h[g]&&f(h,g,{configurable:!0,value:e(null)}),b.exports=function(a){h[g][a]=!0}},28344,(a,b,c)=>{"use strict";var d=a.r(66334),e=a.r(77024),f=a.r(56571),g=a.r(25056),h=a.r(27043);d({target:"Array",proto:!0},{at:function(a){var b=e(this),c=f(b),d=g(a),h=d>=0?d:c+d;return h<0||h>=c?void 0:b[h]}}),h("at")},16961,(a,b,c)=>{"use strict";var d=a.r(29500),e=a.r(7807);b.exports=function(a,b){return e(d[a].prototype[b])}},27092,(a,b,c)=>{"use strict";a.r(28344),b.exports=a.r(16961)("Array","at")},33616,(a,b,c)=>{"use strict";b.exports=a.r(27092)},86759,(a,b,c)=>{"use strict";var d=a.r(2924);b.exports=Array.isArray||function(a){return"Array"===d(a)}},5128,(a,b,c)=>{"use strict";var d=TypeError;b.exports=function(a){if(a>0x1fffffffffffff)throw d("Maximum allowed index exceeded");return a}},65979,(a,b,c)=>{"use strict";var d=a.r(2924),e=a.r(7807);b.exports=function(a){if("Function"===d(a))return e(a)}},68520,(a,b,c)=>{"use strict";var d=a.r(65979),e=a.r(21559),f=a.r(54355),g=d(d.bind);b.exports=function(a,b){return e(a),void 0===b?a:f?g(a,b):function(){return a.apply(b,arguments)}}},62526,(a,b,c)=>{"use strict";var d=a.r(86759),e=a.r(56571),f=a.r(5128),g=a.r(68520),h=function(a,b,c,i,j,k,l,m){for(var n,o,p=j,q=0,r=!!l&&g(l,m);q<i;)q in c&&(n=r?r(c[q],q,b):c[q],k>0&&d(n)?(o=e(n),p=h(a,b,n,o,p,k-1)-1):(f(p+1),a[p]=n),p++),q++;return p};b.exports=h},88564,(a,b,c)=>{"use strict";var d=a.r(29985)("toStringTag"),e={};e[d]="z",b.exports="[object z]"===String(e)},77312,(a,b,c)=>{"use strict";var d=a.r(88564),e=a.r(54081),f=a.r(2924),g=a.r(29985)("toStringTag"),h=Object,i="Arguments"===f(function(){return arguments}()),j=function(a,b){try{return a[b]}catch(a){}};b.exports=d?f:function(a){var b,c,d;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(c=j(b=h(a),g))?c:i?f(b):"Object"===(d=f(b))&&e(b.callee)?"Arguments":d}},98100,(a,b,c)=>{"use strict";var d=a.r(7807),e=a.r(30911),f=a.r(54081),g=a.r(77312),h=a.r(71699),i=a.r(85011),j=function(){},k=h("Reflect","construct"),l=/^\s*(?:class|function)\b/,m=d(l.exec),n=!l.test(j),o=function(a){if(!f(a))return!1;try{return k(j,[],a),!0}catch(a){return!1}},p=function(a){if(!f(a))return!1;switch(g(a)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return n||!!m(l,i(a))}catch(a){return!0}};p.sham=!0,b.exports=!k||e(function(){var a;return o(o.call)||!o(Object)||!o(function(){a=!0})||a})?p:o},50464,(a,b,c)=>{"use strict";var d=a.r(86759),e=a.r(98100),f=a.r(74604),g=a.r(29985)("species"),h=Array;b.exports=function(a){var b;return d(a)&&(e(b=a.constructor)&&(b===h||d(b.prototype))?b=void 0:f(b)&&null===(b=b[g])&&(b=void 0)),void 0===b?h:b}},65611,(a,b,c)=>{"use strict";var d=a.r(50464);b.exports=function(a,b){return new(d(a))(0===b?0:b)}},56862,(a,b,c)=>{"use strict";var d=a.r(66334),e=a.r(62526),f=a.r(21559),g=a.r(77024),h=a.r(56571),i=a.r(65611);d({target:"Array",proto:!0},{flatMap:function(a){var b,c=g(this),d=h(c);return f(a),(b=i(c,0)).length=e(b,c,c,d,0,1,a,arguments.length>1?arguments[1]:void 0),b}})},67806,(a,b,c)=>{"use strict";a.r(27043)("flatMap")},38164,(a,b,c)=>{"use strict";a.r(56862),a.r(67806),b.exports=a.r(16961)("Array","flatMap")},35380,(a,b,c)=>{"use strict";b.exports=a.r(38164)},57322,(a,b,c)=>{"use strict";var d=a.r(66334),e=a.r(62526),f=a.r(77024),g=a.r(56571),h=a.r(25056),i=a.r(65611);d({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,b=f(this),c=g(b),d=i(b,0);return d.length=e(d,b,b,c,0,void 0===a?1:h(a)),d}})},95307,(a,b,c)=>{"use strict";a.r(27043)("flat")},75767,(a,b,c)=>{"use strict";a.r(57322),a.r(95307),b.exports=a.r(16961)("Array","flat")},7532,(a,b,c)=>{"use strict";b.exports=a.r(75767)},78994,(a,b,c)=>{"use strict";var d=a.r(77312),e=String;b.exports=function(a){if("Symbol"===d(a))throw TypeError("Cannot convert a Symbol value to a string");return e(a)}},62407,(a,b,c)=>{"use strict";var d=a.r(66334),e=a.r(7807),f=a.r(31713),g=a.r(25056),h=a.r(78994),i=a.r(30911),j=e("".charAt);d({target:"String",proto:!0,forced:i(function(){return"\uD842"!=="𠮷".at(-2)})},{at:function(a){var b=h(f(this)),c=b.length,d=g(a),e=d>=0?d:c+d;return e<0||e>=c?void 0:j(b,e)}})},54982,(a,b,c)=>{"use strict";a.r(62407),b.exports=a.r(16961)("String","at")},63010,(a,b,c)=>{"use strict";b.exports=a.r(54982)},45160,(a,b,c)=>{"use strict";var d=a.r(98280);b.exports=function(){var a=d(this),b="";return a.hasIndices&&(b+="d"),a.global&&(b+="g"),a.ignoreCase&&(b+="i"),a.multiline&&(b+="m"),a.dotAll&&(b+="s"),a.unicode&&(b+="u"),a.unicodeSets&&(b+="v"),a.sticky&&(b+="y"),b}},76077,(a,b,c)=>{"use strict";var d=a.r(30911),e=a.r(29500).RegExp,f=d(function(){var a=e("a","y");return a.lastIndex=2,null!==a.exec("abcd")}),g=f||d(function(){return!e("a","y").sticky});b.exports={BROKEN_CARET:f||d(function(){var a=e("^r","gy");return a.lastIndex=2,null!==a.exec("str")}),MISSED_STICKY:g,UNSUPPORTED_Y:f}},86128,(a,b,c)=>{"use strict";var d=a.r(30911),e=a.r(29500).RegExp;b.exports=d(function(){var a=e(".","s");return!(a.dotAll&&a.test("\n")&&"s"===a.flags)})},36052,(a,b,c)=>{"use strict";var d=a.r(30911),e=a.r(29500).RegExp;b.exports=d(function(){var a=e("(?<a>b)","g");return"b"!==a.exec("b").groups.a||"bc"!=="b".replace(a,"$<a>c")})},29374,(a,b,c)=>{"use strict";var d,e,f=a.r(84066),g=a.r(7807),h=a.r(78994),i=a.r(45160),j=a.r(76077),k=a.r(64414),l=a.r(20244),m=a.r(11953).get,n=a.r(86128),o=a.r(36052),p=k("native-string-replace",String.prototype.replace),q=RegExp.prototype.exec,r=q,s=g("".charAt),t=g("".indexOf),u=g("".replace),v=g("".slice),w=(e=/b*/g,f(q,d=/a/,"a"),f(q,e,"a"),0!==d.lastIndex||0!==e.lastIndex),y=j.BROKEN_CARET,z=void 0!==/()??/.exec("")[1];(w||z||y||n||o)&&(r=function(a){var b,c,d,e,g,j,k,n=m(this),o=h(a),A=n.raw;if(A)return A.lastIndex=this.lastIndex,b=f(r,A,o),this.lastIndex=A.lastIndex,b;var B=n.groups,C=y&&this.sticky,D=f(i,this),E=this.source,F=0,G=o;if(C&&(-1===t(D=u(D,"y",""),"g")&&(D+="g"),G=v(o,this.lastIndex),this.lastIndex>0&&(!this.multiline||this.multiline&&"\n"!==s(o,this.lastIndex-1))&&(E="(?: "+E+")",G=" "+G,F++),c=RegExp("^(?:"+E+")",D)),z&&(c=RegExp("^"+E+"$(?!\\s)",D)),w&&(d=this.lastIndex),e=f(q,C?c:this,G),C?e?(e.input=v(e.input,F),e[0]=v(e[0],F),e.index=this.lastIndex,this.lastIndex+=e[0].length):this.lastIndex=0:w&&e&&(this.lastIndex=this.global?e.index+e[0].length:d),z&&e&&e.length>1&&f(p,e[0],c,function(){for(g=1;g<arguments.length-2;g++)void 0===arguments[g]&&(e[g]=void 0)}),e&&B)for(g=0,e.groups=j=l(null);g<B.length;g++)j[(k=B[g])[0]]=e[k[1]];return e}),b.exports=r},16343,(a,b,c)=>{"use strict";var d=a.r(66334),e=a.r(29374);d({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e})},96989,(a,b,c)=>{"use strict";var d=a.r(54355),e=Function.prototype,f=e.apply,g=e.call;b.exports="object"==typeof Reflect&&Reflect.apply||(d?g.bind(f):function(){return g.apply(f,arguments)})},60628,(a,b,c)=>{"use strict";a.r(16343);var d=a.r(84066),e=a.r(72973),f=a.r(29374),g=a.r(30911),h=a.r(29985),i=a.r(12930),j=h("species"),k=RegExp.prototype;b.exports=function(a,b,c,l){var m=h(a),n=!g(function(){var b={};return b[m]=function(){return 7},7!==""[a](b)}),o=n&&!g(function(){var b=!1,c=/a/;if("split"===a){var d={};d[j]=function(){return c},(c={constructor:d,flags:""})[m]=/./[m]}return c.exec=function(){return b=!0,null},c[m](""),!b});if(!n||!o||c){var p=/./[m],q=b(m,""[a],function(a,b,c,e,g){var h=b.exec;return h===f||h===k.exec?n&&!g?{done:!0,value:d(p,b,c,e)}:{done:!0,value:d(a,c,b,e)}:{done:!1}});e(String.prototype,a,q[0]),e(k,m,q[1])}l&&i(k[m],"sham",!0)}},49818,(a,b,c)=>{"use strict";var d=a.r(7807),e=a.r(25056),f=a.r(78994),g=a.r(31713),h=d("".charAt),i=d("".charCodeAt),j=d("".slice),k=function(a){return function(b,c){var d,k,l=f(g(b)),m=e(c),n=l.length;return m<0||m>=n?a?"":void 0:(d=i(l,m))<55296||d>56319||m+1===n||(k=i(l,m+1))<56320||k>57343?a?h(l,m):d:a?j(l,m,m+2):(d-55296<<10)+(k-56320)+65536}};b.exports={codeAt:k(!1),charAt:k(!0)}},64672,(a,b,c)=>{"use strict";var d=a.r(49818).charAt;b.exports=function(a,b,c){return b+(c?d(a,b).length:1)}},81145,(a,b,c)=>{"use strict";var d=a.r(7807),e=a.r(77024),f=Math.floor,g=d("".charAt),h=d("".replace),i=d("".slice),j=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,k=/\$([$&'`]|\d{1,2})/g;b.exports=function(a,b,c,d,l,m){var n=c+a.length,o=d.length,p=k;return void 0!==l&&(l=e(l),p=j),h(m,p,function(e,h){var j;switch(g(h,0)){case"$":return"$";case"&":return a;case"`":return i(b,0,c);case"'":return i(b,n);case"<":j=l[i(h,1,-1)];break;default:var k=+h;if(0===k)return e;if(k>o){var m=f(k/10);if(0===m)return e;if(m<=o)return void 0===d[m-1]?g(h,1):d[m-1]+g(h,1);return e}j=d[k-1]}return void 0===j?"":j})}},97767,(a,b,c)=>{"use strict";var d=a.r(29500),e=a.r(30911),f=d.RegExp;b.exports={correct:!e(function(){var a=!0;try{f(".","d")}catch(b){a=!1}var b={},c="",d=a?"dgimsy":"gimsy",e=function(a,d){Object.defineProperty(b,a,{get:function(){return c+=d,!0}})},g={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var h in a&&(g.hasIndices="d"),g)e(h,g[h]);return Object.getOwnPropertyDescriptor(f.prototype,"flags").get.call(b)!==d||c!==d})}},73287,(a,b,c)=>{"use strict";var d=a.r(84066),e=a.r(33061),f=a.r(39829),g=a.r(97767),h=a.r(45160),i=RegExp.prototype;b.exports=g.correct?function(a){return a.flags}:function(a){return!g.correct&&f(i,a)&&!e(a,"flags")?d(h,a):a.flags}},19957,(a,b,c)=>{"use strict";var d=a.r(84066),e=a.r(98280),f=a.r(54081),g=a.r(2924),h=a.r(29374),i=TypeError;b.exports=function(a,b){var c=a.exec;if(f(c)){var j=d(c,a,b);return null!==j&&e(j),j}if("RegExp"===g(a))return d(h,a,b);throw new i("RegExp#exec called on incompatible receiver")}},96589,(a,b,c)=>{"use strict";var d=a.r(96989),e=a.r(84066),f=a.r(7807),g=a.r(60628),h=a.r(30911),i=a.r(98280),j=a.r(54081),k=a.r(74604),l=a.r(25056),m=a.r(97504),n=a.r(78994),o=a.r(31713),p=a.r(64672),q=a.r(1803),r=a.r(81145),s=a.r(73287),t=a.r(19957),u=a.r(29985)("replace"),v=Math.max,w=Math.min,y=f([].concat),z=f([].push),A=f("".indexOf),B=f("".slice),C="$0"==="a".replace(/./,"$0"),D=!!/./[u]&&""===/./[u]("a","$0");g("replace",function(a,b,c){var f=D?"$":"$0";return[function(a,c){var d=o(this),f=k(a)?q(a,u):void 0;return f?e(f,a,d,c):e(b,n(d),a,c)},function(a,e){var g=i(this),h=n(a);if("string"==typeof e&&-1===A(e,f)&&-1===A(e,"$<")){var k=c(b,g,h,e);if(k.done)return k.value}var o=j(e);o||(e=n(e));var q=n(s(g)),u=-1!==A(q,"g");u&&(H=-1!==A(q,"u"),g.lastIndex=0);for(var C=[];null!==(J=t(g,h))&&(z(C,J),u);){;""===n(J[0])&&(g.lastIndex=p(h,m(g.lastIndex),H))}for(var D="",E=0,F=0;F<C.length;F++){for(var G,H,I,J=C[F],K=n(J[0]),L=v(w(l(J.index),h.length),0),M=[],N=1;N<J.length;N++)z(M,void 0===(G=J[N])?G:String(G));var O=J.groups;if(o){var P=y([K],M,L,h);void 0!==O&&z(P,O),I=n(d(e,void 0,P))}else I=r(K,h,L,M,O,e);L>=E&&(D+=B(h,E,L)+I,E=L+K.length)}return D+B(h,E)}]},!!h(function(){var a=/./;return a.exec=function(){var a=[];return a.groups={a:"7"},a},"7"!=="".replace(a,"$<a>")})||!C||D)},59815,(a,b,c)=>{"use strict";var d=a.r(74604),e=a.r(2924),f=a.r(29985)("match");b.exports=function(a){var b;return d(a)&&(void 0!==(b=a[f])?!!b:"RegExp"===e(a))}},89829,(a,b,c)=>{"use strict";var d=a.r(66334),e=a.r(84066),f=a.r(7807),g=a.r(31713),h=a.r(54081),i=a.r(74604),j=a.r(59815),k=a.r(78994),l=a.r(1803),m=a.r(73287),n=a.r(81145),o=a.r(29985),p=a.r(68006),q=o("replace"),r=TypeError,s=f("".indexOf),t=f("".replace),u=f("".slice),v=Math.max;d({target:"String",proto:!0},{replaceAll:function(a,b){var c,d,f,o,w,y,z,A,B,C=g(this),D=0,E="";if(i(a)){if((c=j(a))&&!~s(k(g(m(a))),"g"))throw new r("`.replaceAll` does not allow non-global regexes");if(d=l(a,q))return e(d,a,C,b);if(p&&c)return t(k(C),a,b)}for(f=k(C),o=k(a),(w=h(b))||(b=k(b)),z=v(1,y=o.length),A=s(f,o);-1!==A;)B=w?k(b(o,A,f)):n(o,f,A,[],void 0,b),E+=u(f,D,A)+B,D=A+y,A=A+z>f.length?-1:s(f,o,A+z);return D<f.length&&(E+=u(f,D)),E}})},62303,(a,b,c)=>{"use strict";a.r(16343),a.r(96589),a.r(89829),b.exports=a.r(16961)("String","replaceAll")},54170,(a,b,c)=>{"use strict";b.exports=a.r(62303)},28525,(a,b,c)=>{!function(){"use strict";var c={}.hasOwnProperty;function d(){for(var a="",b=0;b<arguments.length;b++){var f=arguments[b];f&&(a=e(a,function(a){if("string"==typeof a||"number"==typeof a)return a;if("object"!=typeof a)return"";if(Array.isArray(a))return d.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var b="";for(var f in a)c.call(a,f)&&a[f]&&(b=e(b,f));return b}(f)))}return a}function e(a,b){return b?a?a+" "+b:a+b:a}if(b.exports)d.default=d,b.exports=d;else if("function"==typeof define&&"object"==typeof define.amd&&define.amd)void 0!==d&&a.v(d);else window.classNames=d}()},53686,(a,b,c)=>{"use strict";var d=Object.prototype.hasOwnProperty,e="~";function f(){}function g(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function h(a,b,c,d,f){if("function"!=typeof c)throw TypeError("The listener must be a function");var h=new g(c,d||a,f),i=e?e+b:b;return a._events[i]?a._events[i].fn?a._events[i]=[a._events[i],h]:a._events[i].push(h):(a._events[i]=h,a._eventsCount++),a}function i(a,b){0==--a._eventsCount?a._events=new f:delete a._events[b]}function j(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(e=!1)),j.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)d.call(a,b)&&c.push(e?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},j.prototype.listeners=function(a){var b=e?e+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,g=Array(f);d<f;d++)g[d]=c[d].fn;return g},j.prototype.listenerCount=function(a){var b=e?e+a:a,c=this._events[b];return c?c.fn?1:c.length:0},j.prototype.emit=function(a,b,c,d,f,g){var h=e?e+a:a;if(!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,f),!0;case 6:return k.fn.call(k.context,b,c,d,f,g),!0}for(j=1,i=Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!i)for(m=1,i=Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0},j.prototype.on=function(a,b,c){return h(this,a,b,c,!1)},j.prototype.once=function(a,b,c){return h(this,a,b,c,!0)},j.prototype.removeListener=function(a,b,c,d){var f=e?e+a:a;if(!this._events[f])return this;if(!b)return i(this,f),this;var g=this._events[f];if(g.fn)g.fn!==b||d&&!g.once||c&&g.context!==c||i(this,f);else{for(var h=0,j=[],k=g.length;h<k;h++)(g[h].fn!==b||d&&!g[h].once||c&&g[h].context!==c)&&j.push(g[h]);j.length?this._events[f]=1===j.length?j[0]:j:i(this,f)}return this},j.prototype.removeAllListeners=function(a){var b;return a?(b=e?e+a:a,this._events[b]&&i(this,b)):(this._events=new f,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=e,j.EventEmitter=j,b.exports=j},94862,(a,b,c)=>{"use strict";function d(a,b){var c=a.length;for(a.push(b);0<c;){var d=c-1>>>1,e=a[d];if(0<g(e,b))a[d]=b,a[c]=e,c=d;else break}}function e(a){return 0===a.length?null:a[0]}function f(a){if(0===a.length)return null;var b=a[0],c=a.pop();if(c!==b){a[0]=c;for(var d=0,e=a.length,f=e>>>1;d<f;){var h=2*(d+1)-1,i=a[h],j=h+1,k=a[j];if(0>g(i,c))j<e&&0>g(k,i)?(a[d]=k,a[j]=c,d=j):(a[d]=i,a[h]=c,d=h);else if(j<e&&0>g(k,c))a[d]=k,a[j]=c,d=j;else break}}return b}function g(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}if(c.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var h,i=performance;c.unstable_now=function(){return i.now()}}else{var j=Date,k=j.now();c.unstable_now=function(){return j.now()-k}}var l=[],m=[],n=1,o=null,p=3,q=!1,r=!1,s=!1,t=!1,u="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,w="undefined"!=typeof setImmediate?setImmediate:null;function y(a){for(var b=e(m);null!==b;){if(null===b.callback)f(m);else if(b.startTime<=a)f(m),b.sortIndex=b.expirationTime,d(l,b);else break;b=e(m)}}function z(a){if(s=!1,y(a),!r)if(null!==e(l))r=!0,A||(A=!0,h());else{var b=e(m);null!==b&&I(z,b.startTime-a)}}var A=!1,B=-1,C=5,D=-1;function E(){return!!t||!(c.unstable_now()-D<C)}function F(){if(t=!1,A){var a=c.unstable_now();D=a;var b=!0;try{b:{r=!1,s&&(s=!1,v(B),B=-1),q=!0;var d=p;try{c:{for(y(a),o=e(l);null!==o&&!(o.expirationTime>a&&E());){var g=o.callback;if("function"==typeof g){o.callback=null,p=o.priorityLevel;var i=g(o.expirationTime<=a);if(a=c.unstable_now(),"function"==typeof i){o.callback=i,y(a),b=!0;break c}o===e(l)&&f(l),y(a)}else f(l);o=e(l)}if(null!==o)b=!0;else{var j=e(m);null!==j&&I(z,j.startTime-a),b=!1}}break b}finally{o=null,p=d,q=!1}}}finally{b?h():A=!1}}}if("function"==typeof w)h=function(){w(F)};else if("undefined"!=typeof MessageChannel){var G=new MessageChannel,H=G.port2;G.port1.onmessage=F,h=function(){H.postMessage(null)}}else h=function(){u(F,0)};function I(a,b){B=u(function(){a(c.unstable_now())},b)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(a){a.callback=null},c.unstable_forceFrameRate=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<a?Math.floor(1e3/a):5},c.unstable_getCurrentPriorityLevel=function(){return p},c.unstable_next=function(a){switch(p){case 1:case 2:case 3:var b=3;break;default:b=p}var c=p;p=b;try{return a()}finally{p=c}},c.unstable_requestPaint=function(){t=!0},c.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=p;p=a;try{return b()}finally{p=c}},c.unstable_scheduleCallback=function(a,b,f){var g=c.unstable_now();switch(f="object"==typeof f&&null!==f&&"number"==typeof(f=f.delay)&&0<f?g+f:g,a){case 1:var i=-1;break;case 2:i=250;break;case 5:i=0x3fffffff;break;case 4:i=1e4;break;default:i=5e3}return i=f+i,a={id:n++,callback:b,priorityLevel:a,startTime:f,expirationTime:i,sortIndex:-1},f>g?(a.sortIndex=f,d(m,a),null===e(l)&&a===e(m)&&(s?(v(B),B=-1):s=!0,I(z,f-g))):(a.sortIndex=i,d(l,a),r||q||(r=!0,A||(A=!0,h()))),a},c.unstable_shouldYield=E,c.unstable_wrapCallback=function(a){var b=p;return function(){var c=p;p=b;try{return a.apply(this,arguments)}finally{p=c}}}},833,(a,b,c)=>{"use strict";b.exports=a.r(94862)},80507,(a,b,c)=>{"use strict";var d=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),j=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),n=Symbol.for("react.lazy"),o=Symbol.for("react.activity"),p=Symbol.for("react.view_transition"),q=Symbol.iterator,r={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},s=Object.assign,t={};function u(a,b,c){this.props=a,this.context=b,this.refs=t,this.updater=c||r}function v(){}function w(a,b,c){this.props=a,this.context=b,this.refs=t,this.updater=c||r}u.prototype.isReactComponent={},u.prototype.setState=function(a,b){if("object"!=typeof a&&"function"!=typeof a&&null!=a)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,a,b,"setState")},u.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")},v.prototype=u.prototype;var y=w.prototype=new v;y.constructor=w,s(y,u.prototype),y.isPureReactComponent=!0;var z=Array.isArray;function A(){}var B={H:null,A:null,T:null,S:null},C=Object.prototype.hasOwnProperty;function D(a,b,c){var e=c.ref;return{$$typeof:d,type:a,key:b,ref:void 0!==e?e:null,props:c}}function E(a){return"object"==typeof a&&null!==a&&a.$$typeof===d}var F=/\/+/g;function G(a,b){var c,d;return"object"==typeof a&&null!==a&&null!=a.key?(c=""+a.key,d={"=":"=0",":":"=2"},"$"+c.replace(/[=:]/g,function(a){return d[a]})):b.toString(36)}function H(a,b,c){if(null==a)return a;var f=[],g=0;return!function a(b,c,f,g,h){var i,j,k,l=typeof b;("undefined"===l||"boolean"===l)&&(b=null);var m=!1;if(null===b)m=!0;else switch(l){case"bigint":case"string":case"number":m=!0;break;case"object":switch(b.$$typeof){case d:case e:m=!0;break;case n:return a((m=b._init)(b._payload),c,f,g,h)}}if(m)return h=h(b),m=""===g?"."+G(b,0):g,z(h)?(f="",null!=m&&(f=m.replace(F,"$&/")+"/"),a(h,c,f,"",function(a){return a})):null!=h&&(E(h)&&(i=h,j=f+(null==h.key||b&&b.key===h.key?"":(""+h.key).replace(F,"$&/")+"/")+m,h=D(i.type,j,i.props)),c.push(h)),1;m=0;var o=""===g?".":g+":";if(z(b))for(var p=0;p<b.length;p++)l=o+G(g=b[p],p),m+=a(g,c,f,l,h);else if("function"==typeof(p=null===(k=b)||"object"!=typeof k?null:"function"==typeof(k=q&&k[q]||k["@@iterator"])?k:null))for(b=p.call(b),p=0;!(g=b.next()).done;)l=o+G(g=g.value,p++),m+=a(g,c,f,l,h);else if("object"===l){if("function"==typeof b.then)return a(function(a){switch(a.status){case"fulfilled":return a.value;case"rejected":throw a.reason;default:switch("string"==typeof a.status?a.then(A,A):(a.status="pending",a.then(function(b){"pending"===a.status&&(a.status="fulfilled",a.value=b)},function(b){"pending"===a.status&&(a.status="rejected",a.reason=b)})),a.status){case"fulfilled":return a.value;case"rejected":throw a.reason}}throw a}(b),c,f,g,h);throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(c=String(b))?"object with keys {"+Object.keys(b).join(", ")+"}":c)+"). If you meant to render a collection of children, use an array instead.")}return m}(a,f,"","",function(a){return b.call(c,a,g++)}),f}function I(a){if(-1===a._status){var b=a._result;(b=b()).then(function(b){(0===a._status||-1===a._status)&&(a._status=1,a._result=b)},function(b){(0===a._status||-1===a._status)&&(a._status=2,a._result=b)}),-1===a._status&&(a._status=0,a._result=b)}if(1===a._status)return a._result.default;throw a._result}var J="function"==typeof reportError?reportError:function(a){"object"==typeof process&&"function"==typeof process.emit?process.emit("uncaughtException",a):console.error(a)};function K(a){var b=B.T,c={};c.types=null!==b?b.types:null,B.T=c;try{var d=a(),e=B.S;null!==e&&e(c,d),"object"==typeof d&&null!==d&&"function"==typeof d.then&&d.then(A,J)}catch(a){J(a)}finally{null!==b&&null!==c.types&&(b.types=c.types),B.T=b}}function L(a){var b=B.T;if(null!==b){var c=b.types;null===c?b.types=[a]:-1===c.indexOf(a)&&c.push(a)}else K(L.bind(null,a))}c.Activity=o,c.Children={map:H,forEach:function(a,b,c){H(a,function(){b.apply(this,arguments)},c)},count:function(a){var b=0;return H(a,function(){b++}),b},toArray:function(a){return H(a,function(a){return a})||[]},only:function(a){if(!E(a))throw Error("React.Children.only expected to receive a single React element child.");return a}},c.Component=u,c.Fragment=f,c.Profiler=h,c.PureComponent=w,c.StrictMode=g,c.Suspense=l,c.ViewTransition=p,c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=B,c.__COMPILER_RUNTIME={__proto__:null,c:function(a){return B.H.useMemoCache(a)}},c.addTransitionType=L,c.cache=function(a){return function(){return a.apply(null,arguments)}},c.cacheSignal=function(){return null},c.cloneElement=function(a,b,c){if(null==a)throw Error("The argument must be a React element, but you passed "+a+".");var d=s({},a.props),e=a.key;if(null!=b)for(f in void 0!==b.key&&(e=""+b.key),b)C.call(b,f)&&"key"!==f&&"__self"!==f&&"__source"!==f&&("ref"!==f||void 0!==b.ref)&&(d[f]=b[f]);var f=arguments.length-2;if(1===f)d.children=c;else if(1<f){for(var g=Array(f),h=0;h<f;h++)g[h]=arguments[h+2];d.children=g}return D(a.type,e,d)},c.createContext=function(a){return(a={$$typeof:j,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null}).Provider=a,a.Consumer={$$typeof:i,_context:a},a},c.createElement=function(a,b,c){var d,e={},f=null;if(null!=b)for(d in void 0!==b.key&&(f=""+b.key),b)C.call(b,d)&&"key"!==d&&"__self"!==d&&"__source"!==d&&(e[d]=b[d]);var g=arguments.length-2;if(1===g)e.children=c;else if(1<g){for(var h=Array(g),i=0;i<g;i++)h[i]=arguments[i+2];e.children=h}if(a&&a.defaultProps)for(d in g=a.defaultProps)void 0===e[d]&&(e[d]=g[d]);return D(a,f,e)},c.createRef=function(){return{current:null}},c.forwardRef=function(a){return{$$typeof:k,render:a}},c.isValidElement=E,c.lazy=function(a){return{$$typeof:n,_payload:{_status:-1,_result:a},_init:I}},c.memo=function(a,b){return{$$typeof:m,type:a,compare:void 0===b?null:b}},c.startTransition=K,c.unstable_useCacheRefresh=function(){return B.H.useCacheRefresh()},c.use=function(a){return B.H.use(a)},c.useActionState=function(a,b,c){return B.H.useActionState(a,b,c)},c.useCallback=function(a,b){return B.H.useCallback(a,b)},c.useContext=function(a){return B.H.useContext(a)},c.useDebugValue=function(){},c.useDeferredValue=function(a,b){return B.H.useDeferredValue(a,b)},c.useEffect=function(a,b){return B.H.useEffect(a,b)},c.useEffectEvent=function(a){return B.H.useEffectEvent(a)},c.useId=function(){return B.H.useId()},c.useImperativeHandle=function(a,b,c){return B.H.useImperativeHandle(a,b,c)},c.useInsertionEffect=function(a,b){return B.H.useInsertionEffect(a,b)},c.useLayoutEffect=function(a,b){return B.H.useLayoutEffect(a,b)},c.useMemo=function(a,b){return B.H.useMemo(a,b)},c.useOptimistic=function(a,b){return B.H.useOptimistic(a,b)},c.useReducer=function(a,b,c){return B.H.useReducer(a,b,c)},c.useRef=function(a){return B.H.useRef(a)},c.useState=function(a){return B.H.useState(a)},c.useSyncExternalStore=function(a,b,c){return B.H.useSyncExternalStore(a,b,c)},c.useTransition=function(){return B.H.useTransition()},c.version="19.3.0-canary-52684925-20251110"},11027,(a,b,c)=>{"use strict";b.exports=a.r(80507)},39369,(a,b,c)=>{"use strict";var d=a.r(11027);function e(a){var b="https://react.dev/errors/"+a;if(1<arguments.length){b+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(){}var g={d:{f:f,r:function(){throw Error(e(522))},D:f,C:f,L:f,m:f,X:f,S:f,M:f},p:0,findDOMNode:null},h=Symbol.for("react.portal"),i=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function j(a,b){return"font"===a?"":"string"==typeof b?"use-credentials"===b?b:"":void 0}c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=g,c.createPortal=function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!b||1!==b.nodeType&&9!==b.nodeType&&11!==b.nodeType)throw Error(e(299));return function(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:h,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}(a,b,null,c)},c.flushSync=function(a){var b=i.T,c=g.p;try{if(i.T=null,g.p=2,a)return a()}finally{i.T=b,g.p=c,g.d.f()}},c.preconnect=function(a,b){"string"==typeof a&&(b=b?"string"==typeof(b=b.crossOrigin)?"use-credentials"===b?b:"":void 0:null,g.d.C(a,b))},c.prefetchDNS=function(a){"string"==typeof a&&g.d.D(a)},c.preinit=function(a,b){if("string"==typeof a&&b&&"string"==typeof b.as){var c=b.as,d=j(c,b.crossOrigin),e="string"==typeof b.integrity?b.integrity:void 0,f="string"==typeof b.fetchPriority?b.fetchPriority:void 0;"style"===c?g.d.S(a,"string"==typeof b.precedence?b.precedence:void 0,{crossOrigin:d,integrity:e,fetchPriority:f}):"script"===c&&g.d.X(a,{crossOrigin:d,integrity:e,fetchPriority:f,nonce:"string"==typeof b.nonce?b.nonce:void 0})}},c.preinitModule=function(a,b){if("string"==typeof a)if("object"==typeof b&&null!==b){if(null==b.as||"script"===b.as){var c=j(b.as,b.crossOrigin);g.d.M(a,{crossOrigin:c,integrity:"string"==typeof b.integrity?b.integrity:void 0,nonce:"string"==typeof b.nonce?b.nonce:void 0})}}else null==b&&g.d.M(a)},c.preload=function(a,b){if("string"==typeof a&&"object"==typeof b&&null!==b&&"string"==typeof b.as){var c=b.as,d=j(c,b.crossOrigin);g.d.L(a,c,{crossOrigin:d,integrity:"string"==typeof b.integrity?b.integrity:void 0,nonce:"string"==typeof b.nonce?b.nonce:void 0,type:"string"==typeof b.type?b.type:void 0,fetchPriority:"string"==typeof b.fetchPriority?b.fetchPriority:void 0,referrerPolicy:"string"==typeof b.referrerPolicy?b.referrerPolicy:void 0,imageSrcSet:"string"==typeof b.imageSrcSet?b.imageSrcSet:void 0,imageSizes:"string"==typeof b.imageSizes?b.imageSizes:void 0,media:"string"==typeof b.media?b.media:void 0})}},c.preloadModule=function(a,b){if("string"==typeof a)if(b){var c=j(b.as,b.crossOrigin);g.d.m(a,{as:"string"==typeof b.as&&"script"!==b.as?b.as:void 0,crossOrigin:c,integrity:"string"==typeof b.integrity?b.integrity:void 0})}else g.d.m(a)},c.requestFormReset=function(a){g.d.r(a)},c.unstable_batchedUpdates=function(a,b){return a(b)},c.useFormState=function(a,b,c){return i.H.useFormState(a,b,c)},c.useFormStatus=function(){return i.H.useHostTransitionStatus()},c.version="19.3.0-canary-52684925-20251110"},98947,(a,b,c)=>{"use strict";!function a(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(a){console.error(a)}}(),b.exports=a.r(39369)},62765,(a,b,c)=>{"use strict";var d=a.r(833),e=a.r(11027),f=a.r(98947);function g(a){var b="https://react.dev/errors/"+a;if(1<arguments.length){b+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function h(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType)}function i(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do 0!=(4098&(b=a).flags)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function j(a){if(13===a.tag){var b=a.memoizedState;if(null===b&&null!==(a=a.alternate)&&(b=a.memoizedState),null!==b)return b.dehydrated}return null}function k(a){if(31===a.tag){var b=a.memoizedState;if(null===b&&null!==(a=a.alternate)&&(b=a.memoizedState),null!==b)return b.dehydrated}return null}function l(a){if(i(a)!==a)throw Error(g(188))}function m(a,b,c,d,e,f){for(;null!==a;){if(5===a.tag&&c(a,d,e,f)||(22!==a.tag||null===a.memoizedState)&&(b||5!==a.tag)&&m(a.child,b,c,d,e,f))return!0;a=a.sibling}return!1}function n(a){for(a=a.return;null!==a;){if(3===a.tag||5===a.tag)return a;a=a.return}return null}function o(a){switch(a.tag){case 5:return a.stateNode;case 3:return a.stateNode.containerInfo;default:throw Error(g(559))}}var p=null,q=null;function r(a){return p=a,!0}function s(a,b,c){return a===c||a===b&&(p=a,!0)}function t(a,b,c){return a===c?(q=a,!1):a===b&&(null!==q&&(p=a),!0)}function u(a){if(null===a)return null;do a=null===a?null:a.return;while(a&&5!==a.tag&&27!==a.tag&&3!==a.tag)return a||null}function v(a,b,c){for(var d=0,e=a;e;e=c(e))d++;e=0;for(var f=b;f;f=c(f))e++;for(;0<d-e;)a=c(a),d--;for(;0<e-d;)b=c(b),e--;for(;d--;){if(a===b||null!==b&&a===b.alternate)return a;a=c(a),b=c(b)}return null}var w=Object.assign,y=Symbol.for("react.element"),z=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),F=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),J=Symbol.for("react.memo"),K=Symbol.for("react.lazy");Symbol.for("react.scope");var L=Symbol.for("react.activity"),M=Symbol.for("react.legacy_hidden");Symbol.for("react.tracing_marker");var N=Symbol.for("react.memo_cache_sentinel"),O=Symbol.for("react.view_transition"),P=Symbol.iterator;function Q(a){return null===a||"object"!=typeof a?null:"function"==typeof(a=P&&a[P]||a["@@iterator"])?a:null}var R=Symbol.for("react.client.reference"),S=Array.isArray,T=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U=f.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V={pending:!1,data:null,method:null,action:null},W=[],X=-1;function Y(a){return{current:a}}function Z(a){0>X||(a.current=W[X],W[X]=null,X--)}function $(a,b){W[++X]=a.current,a.current=b}var _=Y(null),aa=Y(null),ab=Y(null),ac=Y(null);function ad(a,b){switch($(ab,b),$(aa,a),$(_,null),b.nodeType){case 9:case 11:a=(a=b.documentElement)&&(a=a.namespaceURI)?j6(a):0;break;default:if(a=b.tagName,b=b.namespaceURI)a=j7(b=j6(b),a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Z(_),$(_,a)}function ae(){Z(_),Z(aa),Z(ab)}function af(a){null!==a.memoizedState&&$(ac,a);var b=_.current,c=j7(b,a.type);b!==c&&($(aa,a),$(_,c))}function ag(a){aa.current===a&&(Z(_),Z(aa)),ac.current===a&&(Z(ac),le._currentValue=V)}function ah(a){if(void 0===bT)try{throw Error()}catch(a){var b=a.stack.trim().match(/\n( *(at )?)/);bT=b&&b[1]||"",bU=-1<a.stack.indexOf("\n    at")?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+bT+a+bU}var ai=!1;function aj(a,b){if(!a||ai)return"";ai=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(b){var c=function(){throw Error()};if(Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(c,[])}catch(a){var d=a}Reflect.construct(a,[],c)}else{try{c.call()}catch(a){d=a}a.call(c.prototype)}}else{try{throw Error()}catch(a){d=a}(c=a())&&"function"==typeof c.catch&&c.catch(function(){})}}catch(a){if(a&&d&&"string"==typeof a.stack)return[a.stack,d.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var e=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");e&&e.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var f=d.DetermineComponentFrameRoot(),g=f[0],h=f[1];if(g&&h){var i=g.split("\n"),j=h.split("\n");for(e=d=0;d<i.length&&!i[d].includes("DetermineComponentFrameRoot");)d++;for(;e<j.length&&!j[e].includes("DetermineComponentFrameRoot");)e++;if(d===i.length||e===j.length)for(d=i.length-1,e=j.length-1;1<=d&&0<=e&&i[d]!==j[e];)e--;for(;1<=d&&0<=e;d--,e--)if(i[d]!==j[e]){if(1!==d||1!==e)do if(d--,e--,0>e||i[d]!==j[e]){var k="\n"+i[d].replace(" at new "," at ");return a.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",a.displayName)),k}while(1<=d&&0<=e)break}}}finally{ai=!1,Error.prepareStackTrace=c}return(c=a?a.displayName||a.name:"")?ah(c):""}function ak(a){try{var b="",c=null;do b+=function(a,b){switch(a.tag){case 26:case 27:case 5:return ah(a.type);case 16:return ah("Lazy");case 13:return a.child!==b&&null!==b?ah("Suspense Fallback"):ah("Suspense");case 19:return ah("SuspenseList");case 0:case 15:return aj(a.type,!1);case 11:return aj(a.type.render,!1);case 1:return aj(a.type,!0);case 31:return ah("Activity");case 30:return ah("ViewTransition");default:return""}}(a,c),c=a,a=a.return;while(a)return b}catch(a){return"\nError generating stack: "+a.message+"\n"+a.stack}}var al=Object.prototype.hasOwnProperty,am=d.unstable_scheduleCallback,an=d.unstable_cancelCallback,ao=d.unstable_shouldYield,ap=d.unstable_requestPaint,aq=d.unstable_now,ar=d.unstable_getCurrentPriorityLevel,as=d.unstable_ImmediatePriority,at=d.unstable_UserBlockingPriority,au=d.unstable_NormalPriority,av=d.unstable_LowPriority,aw=d.unstable_IdlePriority,ax=(d.log,d.unstable_setDisableYieldValue,null),ay=null,az=Math.clz32?Math.clz32:function(a){return 0==(a>>>=0)?32:31-(aA(a)/aB|0)|0},aA=Math.log,aB=Math.LN2,aC=256,aD=262144,aE=4194304;function aF(a){var b=42&a;if(0!==b)return b;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&a;case 262144:case 524288:case 1048576:case 2097152:return 3932160&a;case 4194304:case 8388608:case 0x1000000:case 0x2000000:return 0x3c00000&a;case 0x4000000:return 0x4000000;case 0x8000000:return 0x8000000;case 0x10000000:return 0x10000000;case 0x20000000:return 0x20000000;case 0x40000000:return 0;default:return a}}function aG(a,b,c){var d=a.pendingLanes;if(0===d)return 0;var e=0,f=a.suspendedLanes,g=a.pingedLanes;a=a.warmLanes;var h=0x7ffffff&d;return 0!==h?0!=(d=h&~f)?e=aF(d):0!=(g&=h)?e=aF(g):c||0!=(c=h&~a)&&(e=aF(c)):0!=(h=d&~f)?e=aF(h):0!==g?e=aF(g):c||0!=(c=d&~a)&&(e=aF(c)),0===e?0:0!==b&&b!==e&&0==(b&f)&&((f=e&-e)>=(c=b&-b)||32===f&&0!=(4194048&c))?b:e}function aH(a,b){return 0==(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&b)}function aI(){var a=aE;return 0==(0x3c00000&(aE<<=1))&&(aE=4194304),a}function aJ(a){for(var b=[],c=0;31>c;c++)b.push(a);return b}function aK(a,b){a.pendingLanes|=b,0x10000000!==b&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function aL(a,b,c){a.pendingLanes|=b,a.suspendedLanes&=~b;var d=31-az(b);a.entangledLanes|=b,a.entanglements[d]=0x40000000|a.entanglements[d]|261930&c}function aM(a,b){var c=a.entangledLanes|=b;for(a=a.entanglements;c;){var d=31-az(c),e=1<<d;e&b|a[d]&b&&(a[d]|=b),c&=~e}}function aN(a,b){var c=b&-b;return 0!=((c=0!=(42&c)?1:aO(c))&(a.suspendedLanes|b))?0:c}function aO(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 0x1000000:case 0x2000000:a=128;break;case 0x10000000:a=0x8000000;break;default:a=0}return a}function aP(a){return 2<(a&=-a)?8<a?0!=(0x7ffffff&a)?32:0x10000000:8:2}function aQ(){var a=U.p;return 0!==a?a:void 0===(a=window.event)?32:lt(a.type)}function aR(a,b){var c=U.p;try{return U.p=a,b()}finally{U.p=c}}var aS=Math.random().toString(36).slice(2),aT="__reactFiber$"+aS,aU="__reactProps$"+aS,aV="__reactContainer$"+aS,aW="__reactEvents$"+aS,aX="__reactListeners$"+aS,aY="__reactHandles$"+aS,aZ="__reactResources$"+aS,a$="__reactMarker$"+aS;function a_(a){delete a[aT],delete a[aU],delete a[aW],delete a[aX],delete a[aY]}function a0(a){var b;if(b=a[aT])return b;for(var c=a.parentNode;c;){if(b=c[aV]||c[aT]){if(c=b.alternate,null!==b.child||null!==c&&null!==c.child)for(a=kJ(a);null!==a;){if(c=a[aT])return c;a=kJ(a)}return b}c=(a=c).parentNode}return null}function a1(a){if(a=a[aT]||a[aV]){var b=a.tag;if(5===b||6===b||13===b||31===b||26===b||27===b||3===b)return a}return null}function a2(a){var b=a.tag;if(5===b||26===b||27===b||6===b)return a.stateNode;throw Error(g(33))}function a3(a){var b=a[aZ];return b||(b=a[aZ]={hoistableStyles:new Map,hoistableScripts:new Map}),b}function a4(a){a[a$]=!0}var a5=new Set,a6={};function a7(a,b){a8(a,b),a8(a+"Capture",b)}function a8(a,b){for(a6[a]=b,a=0;a<b.length;a++)a5.add(b[a])}var a9=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ba={},bb={},bc=!1;function bd(){var a=bc;return bc=!1,a}function be(a,b,c){if(al.call(bb,b)||!al.call(ba,b)&&(a9.test(b)?bb[b]=!0:(ba[b]=!0,!1)))if(null===c)a.removeAttribute(b);else{switch(typeof c){case"undefined":case"function":case"symbol":a.removeAttribute(b);return;case"boolean":var d=b.toLowerCase().slice(0,5);if("data-"!==d&&"aria-"!==d)return void a.removeAttribute(b)}a.setAttribute(b,""+c)}}function bf(a,b,c){if(null===c)a.removeAttribute(b);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(b);return}a.setAttribute(b,""+c)}}function bg(a,b,c,d){if(null===d)a.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttributeNS(b,c,""+d)}}function bh(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return a;default:return""}}function bi(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function bj(a){if(!a._valueTracker){var b=bi(a)?"checked":"value";a._valueTracker=function(a,b,c){var d=Object.getOwnPropertyDescriptor(a.constructor.prototype,b);if(!a.hasOwnProperty(b)&&void 0!==d&&"function"==typeof d.get&&"function"==typeof d.set){var e=d.get,f=d.set;return Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){c=""+a,f.call(this,a)}}),Object.defineProperty(a,b,{enumerable:d.enumerable}),{getValue:function(){return c},setValue:function(a){c=""+a},stopTracking:function(){a._valueTracker=null,delete a[b]}}}}(a,b,""+a[b])}}function bk(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue(),d="";return a&&(d=bi(a)?a.checked?"true":"false":a.value),(a=d)!==c&&(b.setValue(a),!0)}function bl(a){if(void 0===(a=a||("undefined"!=typeof document?document:void 0)))return null;try{return a.activeElement||a.body}catch(b){return a.body}}var bm=/[\n"\\]/g;function bn(a){return a.replace(bm,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function bo(a,b,c,d,e,f,g,h){a.name="",null!=g&&"function"!=typeof g&&"symbol"!=typeof g&&"boolean"!=typeof g?a.type=g:a.removeAttribute("type"),null!=b?"number"===g?(0===b&&""===a.value||a.value!=b)&&(a.value=""+bh(b)):a.value!==""+bh(b)&&(a.value=""+bh(b)):"submit"!==g&&"reset"!==g||a.removeAttribute("value"),null!=b?bq(a,g,bh(b)):null!=c?bq(a,g,bh(c)):null!=d&&a.removeAttribute("value"),null==e&&null!=f&&(a.defaultChecked=!!f),null!=e&&(a.checked=e&&"function"!=typeof e&&"symbol"!=typeof e),null!=h&&"function"!=typeof h&&"symbol"!=typeof h&&"boolean"!=typeof h?a.name=""+bh(h):a.removeAttribute("name")}function bp(a,b,c,d,e,f,g,h){if(null!=f&&"function"!=typeof f&&"symbol"!=typeof f&&"boolean"!=typeof f&&(a.type=f),null!=b||null!=c){if(("submit"===f||"reset"===f)&&null==b)return void bj(a);c=null!=c?""+bh(c):"",b=null!=b?""+bh(b):c,h||b===a.value||(a.value=b),a.defaultValue=b}d="function"!=typeof(d=null!=d?d:e)&&"symbol"!=typeof d&&!!d,a.checked=h?a.checked:!!d,a.defaultChecked=!!d,null!=g&&"function"!=typeof g&&"symbol"!=typeof g&&"boolean"!=typeof g&&(a.name=g),bj(a)}function bq(a,b,c){"number"===b&&bl(a.ownerDocument)===a||a.defaultValue===""+c||(a.defaultValue=""+c)}function br(a,b,c,d){if(a=a.options,b){b={};for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{for(e=0,c=""+bh(c),b=null;e<a.length;e++){if(a[e].value===c){a[e].selected=!0,d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function bs(a,b,c){if(null!=b&&((b=""+bh(b))!==a.value&&(a.value=b),null==c)){a.defaultValue!==b&&(a.defaultValue=b);return}a.defaultValue=null!=c?""+bh(c):""}function bt(a,b,c,d){if(null==b){if(null!=d){if(null!=c)throw Error(g(92));if(S(d)){if(1<d.length)throw Error(g(93));d=d[0]}c=d}null==c&&(c=""),b=c}a.defaultValue=c=bh(b),(d=a.textContent)===c&&""!==d&&null!==d&&(a.value=d),bj(a)}function bu(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b}var bv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bw(a,b,c){var d=0===b.indexOf("--");null==c||"boolean"==typeof c||""===c?d?a.setProperty(b,""):"float"===b?a.cssFloat="":a[b]="":d?a.setProperty(b,c):"number"!=typeof c||0===c||bv.has(b)?"float"===b?a.cssFloat=c:a[b]=(""+c).trim():a[b]=c+"px"}function bx(a,b,c){if(null!=b&&"object"!=typeof b)throw Error(g(62));if(a=a.style,null!=c){for(var d in c)!c.hasOwnProperty(d)||null!=b&&b.hasOwnProperty(d)||(0===d.indexOf("--")?a.setProperty(d,""):"float"===d?a.cssFloat="":a[d]="",bc=!0);for(var e in b)d=b[e],b.hasOwnProperty(e)&&c[e]!==d&&(bw(a,e,d),bc=!0)}else for(var f in b)b.hasOwnProperty(f)&&bw(a,f,b[f])}function by(a){if(-1===a.indexOf("-"))return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bz=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),bA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bB(a){return bA.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function bC(){}var bD=null;function bE(a){return(a=a.target||a.srcElement||window).correspondingUseElement&&(a=a.correspondingUseElement),3===a.nodeType?a.parentNode:a}var bF=null,bG=null;function bH(a){var b=a1(a);if(b&&(a=b.stateNode)){var c=a[aU]||null;switch(a=b.stateNode,b.type){case"input":if(bo(a,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),b=c.name,"radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+bn(""+b)+'"][type="radio"]'),b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=d[aU]||null;if(!e)throw Error(g(90));bo(d,e.value,e.defaultValue,e.defaultValue,e.checked,e.defaultChecked,e.type,e.name)}}for(b=0;b<c.length;b++)(d=c[b]).form===a.form&&bk(d)}break;case"textarea":bs(a,c.value,c.defaultValue);break;case"select":null!=(b=c.value)&&br(a,!!c.multiple,b,!1)}}}var bI=!1;function bJ(a,b,c){if(bI)return a(b,c);bI=!0;try{return a(b)}finally{if(bI=!1,(null!==bF||null!==bG)&&(i$(),bF&&(b=bF,a=bG,bG=bF=null,bH(b),a)))for(b=0;b<a.length;b++)bH(a[b])}}function bK(a,b){var c=a.stateNode;if(null===c)return null;var d=c[aU]||null;if(null===d)return null;switch(c=d[b],b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(d="button"!==(a=a.type)&&"input"!==a&&"select"!==a&&"textarea"!==a),a=!d;break;default:a=!1}if(a)return null;if(c&&"function"!=typeof c)throw Error(g(231,b,typeof c));return c}var bL=null,bM=null,bN=null;function bO(){if(bN)return bN;var a,b,c=bM,d=c.length,e="value"in bL?bL.value:bL.textContent,f=e.length;for(a=0;a<d&&c[a]===e[a];a++);var g=d-a;for(b=1;b<=g&&c[d-b]===e[f-b];b++);return bN=e.slice(a,1<b?1-b:void 0)}function bP(a){var b=a.keyCode;return"charCode"in a?0===(a=a.charCode)&&13===b&&(a=13):a=b,10===a&&(a=13),32<=a||13===a?a:0}function bQ(){return!0}function bR(){return!1}function bS(a){function b(b,c,d,e,f){for(var g in this._reactName=b,this._targetInst=d,this.type=c,this.nativeEvent=e,this.target=f,this.currentTarget=null,a)a.hasOwnProperty(g)&&(b=a[g],this[g]=b?b(e):e[g]);return this.isDefaultPrevented=(null!=e.defaultPrevented?e.defaultPrevented:!1===e.returnValue)?bQ:bR,this.isPropagationStopped=bR,this}return w(b.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!=typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=bQ)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!=typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=bQ)},persist:function(){},isPersistent:bQ}),b}var bT,bU,bV,bW,bX,bY={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bZ=bS(bY),b$=w({},bY,{view:0,detail:0}),b_=bS(b$),b0=w({},b$,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cb,button:0,buttons:0,relatedTarget:function(a){return void 0===a.relatedTarget?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==bX&&(bX&&"mousemove"===a.type?(bV=a.screenX-bX.screenX,bW=a.screenY-bX.screenY):bW=bV=0,bX=a),bV)},movementY:function(a){return"movementY"in a?a.movementY:bW}}),b1=bS(b0),b2=bS(w({},b0,{dataTransfer:0})),b3=bS(w({},b$,{relatedTarget:0})),b4=bS(w({},bY,{animationName:0,elapsedTime:0,pseudoElement:0})),b5=bS(w({},bY,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}})),b6=bS(w({},bY,{data:0})),b7={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},b8={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},b9={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ca(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):!!(a=b9[a])&&!!b[a]}function cb(){return ca}var cc=bS(w({},b$,{key:function(a){if(a.key){var b=b7[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?13===(a=bP(a))?"Enter":String.fromCharCode(a):"keydown"===a.type||"keyup"===a.type?b8[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cb,charCode:function(a){return"keypress"===a.type?bP(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===a.type?bP(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}})),cd=bS(w({},b0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),ce=bS(w({},b$,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cb})),cf=bS(w({},bY,{propertyName:0,elapsedTime:0,pseudoElement:0})),cg=bS(w({},b0,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0})),ch=bS(w({},bY,{newState:0,oldState:0})),ci=[9,13,27,32];function cj(a,b){switch(a){case"keyup":return -1!==ci.indexOf(b.keyCode);case"keydown":return 229!==b.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}var ck=!1,cl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cm(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!cl[a.type]:"textarea"===b}function cn(a,b,c,d){bF?bG?bG.push(d):bG=[d]:bF=d,0<(b=jU(b,"onChange")).length&&(c=new bZ("onChange","change",null,c,d),a.push({event:c,listeners:b}))}var co=null,cp=null;function cq(a){jM(a,0)}function cr(a){if(bk(a2(a)))return a}function cs(a,b){if("change"===a)return b}function ct(){co&&(co.detachEvent("onpropertychange",cu),cp=co=null)}function cu(a){if("value"===a.propertyName&&cr(cp)){var b=[];cn(b,cp,a,bE(a)),bJ(cq,b)}}function cv(a,b,c){"focusin"===a?(ct(),co=b,cp=c,co.attachEvent("onpropertychange",cu)):"focusout"===a&&ct()}function cw(a){if("selectionchange"===a||"keyup"===a||"keydown"===a)return cr(cp)}function cx(a,b){if("click"===a)return cr(b)}function cy(a,b){if("input"===a||"change"===a)return cr(b)}var cz="function"==typeof Object.is?Object.is:function(a,b){return a===b&&(0!==a||1/a==1/b)||a!=a&&b!=b};function cA(a,b){if(cz(a,b))return!0;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var e=c[d];if(!al.call(b,e)||!cz(a[e],b[e]))return!1}return!0}function cB(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function cC(a,b){var c,d=cB(a);for(a=0;d;){if(3===d.nodeType){if(c=a+d.textContent.length,a<=b&&c>=b)return{node:d,offset:b-a};a=c}b:{for(;d;){if(d.nextSibling){d=d.nextSibling;break b}d=d.parentNode}d=void 0}d=cB(d)}}function cD(a){a=null!=a&&null!=a.ownerDocument&&null!=a.ownerDocument.defaultView?a.ownerDocument.defaultView:window;for(var b=bl(a.document);b instanceof a.HTMLIFrameElement;){try{var c="string"==typeof b.contentWindow.location.href}catch(a){c=!1}if(c)a=b.contentWindow;else break;b=bl(a.document)}return b}function cE(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}var cF=null,cG=null,cH=null,cI=!1;function cJ(a,b,c){var d=c.window===c?c.document:9===c.nodeType?c:c.ownerDocument;cI||null==cF||cF!==bl(d)||(d="selectionStart"in(d=cF)&&cE(d)?{start:d.selectionStart,end:d.selectionEnd}:{anchorNode:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset},cH&&cA(cH,d)||(cH=d,0<(d=jU(cG,"onSelect")).length&&(b=new bZ("onSelect","select",null,b,c),a.push({event:b,listeners:d}),b.target=cF)))}function cK(a,b){var c={};return c[a.toLowerCase()]=b.toLowerCase(),c["Webkit"+a]="webkit"+b,c["Moz"+a]="moz"+b,c}var cL={animationend:cK("Animation","AnimationEnd"),animationiteration:cK("Animation","AnimationIteration"),animationstart:cK("Animation","AnimationStart"),transitionrun:cK("Transition","TransitionRun"),transitionstart:cK("Transition","TransitionStart"),transitioncancel:cK("Transition","TransitionCancel"),transitionend:cK("Transition","TransitionEnd")},cM={},cN={};function cO(a){if(cM[a])return cM[a];if(!cL[a])return a;var b,c=cL[a];for(b in c)if(c.hasOwnProperty(b)&&b in cN)return cM[a]=c[b];return a}var cP=cO("animationend"),cQ=cO("animationiteration"),cR=cO("animationstart"),cS=cO("transitionrun"),cT=cO("transitionstart"),cU=cO("transitioncancel"),cV=cO("transitionend"),cW=new Map,cX="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function cY(a,b){cW.set(a,b),a7(b,[a])}cX.push("scrollEnd");var cZ=0;function c$(a,b){return null!=a.name&&"auto"!==a.name?a.name:null!==b.autoName?b.autoName:b.autoName=a="_"+(a=iI.identifierPrefix)+"t_"+(cZ++).toString(32)+"_"}function c_(a){if(null==a||"string"==typeof a)return a;var b=null,c=iQ;if(null!==c)for(var d=0;d<c.length;d++){var e=a[c[d]];if(null!=e){if("none"===e)return"none";b=null==b?e:b+" "+e}}return null==b?a.default:b}function c0(a,b){return a=c_(a),null==(b=c_(b))?"auto"===a?null:a:"auto"===b?null:b}var c1="function"==typeof reportError?reportError:function(a){"object"==typeof process&&"function"==typeof process.emit?process.emit("uncaughtException",a):console.error(a)},c2=[],c3=0,c4=0;function c5(){for(var a=c3,b=c4=c3=0;b<a;){var c=c2[b];c2[b++]=null;var d=c2[b];c2[b++]=null;var e=c2[b];c2[b++]=null;var f=c2[b];if(c2[b++]=null,null!==d&&null!==e){var g=d.pending;null===g?e.next=e:(e.next=g.next,g.next=e),d.pending=e}0!==f&&c9(c,e,f)}}function c6(a,b,c,d){c2[c3++]=a,c2[c3++]=b,c2[c3++]=c,c2[c3++]=d,c4|=d,a.lanes|=d,null!==(a=a.alternate)&&(a.lanes|=d)}function c7(a,b,c,d){return c6(a,b,c,d),da(a)}function c8(a,b){return c6(a,null,null,b),da(a)}function c9(a,b,c){a.lanes|=c;var d=a.alternate;null!==d&&(d.lanes|=c);for(var e=!1,f=a.return;null!==f;)f.childLanes|=c,null!==(d=f.alternate)&&(d.childLanes|=c),22===f.tag&&(null===(a=f.stateNode)||1&a._visibility||(e=!0)),a=f,f=f.return;return 3===a.tag?(f=a.stateNode,e&&null!==b&&(e=31-az(c),null===(d=(a=f.hiddenUpdates)[e])?a[e]=[b]:d.push(b),b.lane=0x20000000|c),f):null}function da(a){if(50<iR)throw iR=0,iS=null,Error(g(185));for(var b=a.return;null!==b;)b=(a=b).return;return 3===a.tag?a.stateNode:null}var db={};function dc(a,b,c,d){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function dd(a,b,c,d){return new dc(a,b,c,d)}function de(a){return!(!(a=a.prototype)||!a.isReactComponent)}function df(a,b){var c=a.alternate;return null===c?((c=dd(a.tag,b,a.key,a.mode)).elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.type=a.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=0x7e00000&a.flags,c.childLanes=a.childLanes,c.lanes=a.lanes,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,b=a.dependencies,c.dependencies=null===b?null:{lanes:b.lanes,firstContext:b.firstContext},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c.refCleanup=a.refCleanup,c}function dg(a,b){a.flags&=0x7e00002;var c=a.alternate;return null===c?(a.childLanes=0,a.lanes=b,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,a.dependencies=null===(b=c.dependencies)?null:{lanes:b.lanes,firstContext:b.firstContext}),a}function dh(a,b,c,d,e,f){var h=0;if(d=a,"function"==typeof a)de(a)&&(h=1);else if("string"==typeof a)h=!function(a,b,c){if(1===c||null!=b.itemProp)return!1;switch(a){case"meta":case"title":return!0;case"style":if("string"!=typeof b.precedence||"string"!=typeof b.href||""===b.href)break;return!0;case"link":if("string"!=typeof b.rel||"string"!=typeof b.href||""===b.href||b.onLoad||b.onError)break;if("stylesheet"===b.rel)return a=b.disabled,"string"==typeof b.precedence&&null==a;return!0;case"script":if(b.async&&"function"!=typeof b.async&&"symbol"!=typeof b.async&&!b.onLoad&&!b.onError&&b.src&&"string"==typeof b.src)return!0}return!1}(a,c,_.current)?"html"===a||"head"===a||"body"===a?27:5:26;else b:switch(a){case L:return(a=dd(31,c,b,e)).elementType=L,a.lanes=f,a;case B:return di(c.children,e,f,b);case C:h=8,e|=24;break;case D:return(a=dd(12,c,b,2|e)).elementType=D,a.lanes=f,a;case H:return(a=dd(13,c,b,e)).elementType=H,a.lanes=f,a;case I:return(a=dd(19,c,b,e)).elementType=I,a.lanes=f,a;case M:case O:return(a=dd(30,c,b,a=32|e)).elementType=O,a.lanes=f,a.stateNode={autoName:null,paired:null,clones:null,ref:null},a;default:if("object"==typeof a&&null!==a)switch(a.$$typeof){case F:h=10;break b;case E:h=9;break b;case G:h=11;break b;case J:h=14;break b;case K:h=16,d=null;break b}h=29,c=Error(g(130,null===a?"null":typeof a,"")),d=null}return(b=dd(h,c,b,e)).elementType=a,b.type=d,b.lanes=f,b}function di(a,b,c,d){return(a=dd(7,a,d,b)).lanes=c,a}function dj(a,b,c){return(a=dd(6,a,null,b)).lanes=c,a}function dk(a){var b=dd(18,null,null,0);return b.stateNode=a,b}function dl(a,b,c){return(b=dd(4,null!==a.children?a.children:[],a.key,b)).lanes=c,b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},b}var dm=new WeakMap;function dn(a,b){if("object"==typeof a&&null!==a){var c=dm.get(a);return void 0!==c?c:(b={value:a,source:b,stack:ak(b)},dm.set(a,b),b)}return{value:a,source:b,stack:ak(b)}}var dp=[],dq=0,dr=null,ds=0,dt=[],du=0,dv=null,dw=1,dx="";function dy(a,b){dp[dq++]=ds,dp[dq++]=dr,dr=a,ds=b}function dz(a,b,c){dt[du++]=dw,dt[du++]=dx,dt[du++]=dv,dv=a;var d=dw;a=dx;var e=32-az(d)-1;d&=~(1<<e),c+=1;var f=32-az(b)+e;if(30<f){var g=e-e%5;f=(d&(1<<g)-1).toString(32),d>>=g,e-=g,dw=1<<32-az(b)+e|c<<e|d,dx=f+a}else dw=1<<f|c<<e|d,dx=a}function dA(a){null!==a.return&&(dy(a,1),dz(a,1,0))}function dB(a){for(;a===dr;)dr=dp[--dq],dp[dq]=null,ds=dp[--dq],dp[dq]=null;for(;a===dv;)dv=dt[--du],dt[du]=null,dx=dt[--du],dt[du]=null,dw=dt[--du],dt[du]=null}function dC(a,b){dt[du++]=dw,dt[du++]=dx,dt[du++]=dv,dw=b.id,dx=b.overflow,dv=a}var dD=null,dE=null,dF=!1,dG=null,dH=!1,dI=Error(g(519));function dJ(a){var b=Error(g(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML",""));throw dP(dn(b,a)),dI}function dK(a){var b=a.stateNode,c=a.type,d=a.memoizedProps;switch(b[aT]=a,b[aU]=d,c){case"dialog":jN("cancel",b),jN("close",b);break;case"iframe":case"object":case"embed":jN("load",b);break;case"video":case"audio":for(c=0;c<jK.length;c++)jN(jK[c],b);break;case"source":jN("error",b);break;case"img":case"image":case"link":jN("error",b),jN("load",b);break;case"details":jN("toggle",b);break;case"input":jN("invalid",b),bp(b,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":jN("invalid",b);break;case"textarea":jN("invalid",b),bt(b,d.value,d.defaultValue,d.children)}"string"!=typeof(c=d.children)&&"number"!=typeof c&&"bigint"!=typeof c||b.textContent===""+c||!0===d.suppressHydrationWarning||j$(b.textContent,c)?(null!=d.popover&&(jN("beforetoggle",b),jN("toggle",b)),null!=d.onScroll&&jN("scroll",b),null!=d.onScrollEnd&&jN("scrollend",b),null!=d.onClick&&(b.onclick=bC),b=!0):b=!1,b||dJ(a,!0)}function dL(a){for(dD=a.return;dD;)switch(dD.tag){case 5:case 31:case 13:dH=!1;return;case 27:case 3:dH=!0;return;default:dD=dD.return}}function dM(a){if(a!==dD)return!1;if(!dF)return dL(a),dF=!0,!1;var b,c=a.tag;if((b=3!==c&&27!==c)&&((b=5===c)&&(b="form"===(b=a.type)||"button"===b||j8(a.type,a.memoizedProps)),b=!b),b&&dE&&dJ(a),dL(a),13===c){if(!(a=null!==(a=a.memoizedState)?a.dehydrated:null))throw Error(g(317));dE=kI(a)}else if(31===c){if(!(a=null!==(a=a.memoizedState)?a.dehydrated:null))throw Error(g(317));dE=kI(a)}else 27===c?(c=dE,kf(a.type)?(a=kH,kH=null,dE=a):dE=c):dE=dD?kG(a.stateNode.nextSibling):null;return!0}function dN(){dE=dD=null,dF=!1}function dO(){var a=dG;return null!==a&&(null===iA?iA=a:iA.push.apply(iA,a),dG=null),a}function dP(a){null===dG?dG=[a]:dG.push(a)}var dQ=Y(null),dR=null,dS=null;function dT(a,b,c){$(dQ,b._currentValue),b._currentValue=c}function dU(a){a._currentValue=dQ.current,Z(dQ)}function dV(a,b,c){for(;null!==a;){var d=a.alternate;if((a.childLanes&b)!==b?(a.childLanes|=b,null!==d&&(d.childLanes|=b)):null!==d&&(d.childLanes&b)!==b&&(d.childLanes|=b),a===c)break;a=a.return}}function dW(a,b,c,d){var e=a.child;for(null!==e&&(e.return=a);null!==e;){var f=e.dependencies;if(null!==f){var h=e.child;f=f.firstContext;b:for(;null!==f;){var i=f;f=e;for(var j=0;j<b.length;j++)if(i.context===b[j]){f.lanes|=c,null!==(i=f.alternate)&&(i.lanes|=c),dV(f.return,c,a),d||(h=null);break b}f=i.next}}else if(18===e.tag){if(null===(h=e.return))throw Error(g(341));h.lanes|=c,null!==(f=h.alternate)&&(f.lanes|=c),dV(h,c,a),h=null}else h=e.child;if(null!==h)h.return=e;else for(h=e;null!==h;){if(h===a){h=null;break}if(null!==(e=h.sibling)){e.return=h.return,h=e;break}h=h.return}e=h}}function dX(a,b,c,d){a=null;for(var e=b,f=!1;null!==e;){if(!f){if(0!=(524288&e.flags))f=!0;else if(0!=(262144&e.flags))break}if(10===e.tag){var h=e.alternate;if(null===h)throw Error(g(387));if(null!==(h=h.memoizedProps)){var i=e.type;cz(e.pendingProps.value,h.value)||(null!==a?a.push(i):a=[i])}}else if(e===ac.current){if(null===(h=e.alternate))throw Error(g(387));h.memoizedState.memoizedState!==e.memoizedState.memoizedState&&(null!==a?a.push(le):a=[le])}e=e.return}null!==a&&dW(b,a,c,d),b.flags|=262144}function dY(a){for(a=a.firstContext;null!==a;){if(!cz(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function dZ(a){dR=a,dS=null,null!==(a=a.dependencies)&&(a.firstContext=null)}function d$(a){return d0(dR,a)}function d_(a,b){return null===dR&&dZ(a),d0(a,b)}function d0(a,b){var c=b._currentValue;if(b={context:b,memoizedValue:c,next:null},null===dS){if(null===a)throw Error(g(308));dS=b,a.dependencies={lanes:0,firstContext:b},a.flags|=524288}else dS=dS.next=b;return c}var d1="undefined"!=typeof AbortController?AbortController:function(){var a=[],b=this.signal={aborted:!1,addEventListener:function(b,c){a.push(c)}};this.abort=function(){b.aborted=!0,a.forEach(function(a){return a()})}},d2=d.unstable_scheduleCallback,d3=d.unstable_NormalPriority,d4={$$typeof:F,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function d5(){return{controller:new d1,data:new Map,refCount:0}}function d6(a){a.refCount--,0===a.refCount&&d2(d3,function(){a.controller.abort()})}function d7(a,b){if(0!=(4194048&a.pendingLanes)){var c=a.transitionTypes;for(null===c&&(c=a.transitionTypes=[]),a=0;a<b.length;a++){var d=b[a];-1===c.indexOf(d)&&c.push(d)}}}var d8=null,d9=null,ea=0,eb=0,ec=null;function ed(){if(0==--ea&&(d8=null,null!==d9)){null!==ec&&(ec.status="fulfilled");var a=d9;d9=null,eb=0,ec=null;for(var b=0;b<a.length;b++)(0,a[b])()}}var ee=T.S;T.S=function(a,b){if(iD=aq(),"object"==typeof b&&null!==b&&"function"==typeof b.then&&function(a,b){if(null===d9){var c=d9=[];ea=0,eb=jF(),ec={status:"pending",value:void 0,then:function(a){c.push(a)}}}ea++,b.then(ed,ed)}(0,b),null!==d8)for(var c=js;null!==c;)d7(c,d8),c=c.next;if(null!==(c=a.types)){for(var d=js;null!==d;)d7(d,c),d=d.next;if(0!==eb){null===(d=d8)&&(d=d8=[]);for(var e=0;e<c.length;e++){var f=c[e];-1===d.indexOf(f)&&d.push(f)}}}null!==ee&&ee(a,b)};var ef=Y(null);function eg(){var a=ef.current;return null!==a?a:ij.pooledCache}function eh(a,b){null===b?$(ef,ef.current):$(ef,b.pool)}function ei(){var a=eg();return null===a?null:{parent:d4._currentValue,pool:a}}var ej=Error(g(460)),ek=Error(g(474)),el=Error(g(542)),em={then:function(){}};function en(a){return"fulfilled"===(a=a.status)||"rejected"===a}function eo(a,b,c){switch(void 0===(c=a[c])?a.push(b):c!==b&&(b.then(bC,bC),b=c),b.status){case"fulfilled":return b.value;case"rejected":throw es(a=b.reason),a;default:if("string"==typeof b.status)b.then(bC,bC);else{if(null!==(a=ij)&&100<a.shellSuspendCounter)throw Error(g(482));(a=b).status="pending",a.then(function(a){if("pending"===b.status){var c=b;c.status="fulfilled",c.value=a}},function(a){if("pending"===b.status){var c=b;c.status="rejected",c.reason=a}})}switch(b.status){case"fulfilled":return b.value;case"rejected":throw es(a=b.reason),a}throw eq=b,ej}}function ep(a){try{return(0,a._init)(a._payload)}catch(a){if(null!==a&&"object"==typeof a&&"function"==typeof a.then)throw eq=a,ej;throw a}}var eq=null;function er(){if(null===eq)throw Error(g(459));var a=eq;return eq=null,a}function es(a){if(a===ej||a===el)throw Error(g(483))}var et=null,eu=0;function ev(a){var b=eu;return eu+=1,null===et&&(et=[]),eo(et,a,b)}function ew(a,b){a.ref=void 0!==(b=b.props.ref)?b:null}function ex(a,b){if(b.$$typeof===y)throw Error(g(525));throw Error(g(31,"[object Object]"===(a=Object.prototype.toString.call(b))?"object with keys {"+Object.keys(b).join(", ")+"}":a))}function ey(a){function b(b,c){if(a){var d=b.deletions;null===d?(b.deletions=[c],b.flags|=16):d.push(c)}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a){for(var b=new Map;null!==a;)null!==a.key?b.set(a.key,a):b.set(a.index,a),a=a.sibling;return b}function e(a,b){return(a=df(a,b)).index=0,a.sibling=null,a}function f(b,c,d){return(b.index=d,a)?null!==(d=b.alternate)?(d=d.index)<c?(b.flags|=0x8000002,c):d:(b.flags|=0x8000002,c):(b.flags|=1048576,c)}function h(b){return a&&null===b.alternate&&(b.flags|=0x8000002),b}function i(a,b,c,d){return null===b||6!==b.tag?(b=dj(c,a.mode,d)).return=a:(b=e(b,c)).return=a,b}function j(a,b,c,d){var f=c.type;return f===B?(ew(a=l(a,b,c.props.children,d,c.key),c),a):(null!==b&&(b.elementType===f||"object"==typeof f&&null!==f&&f.$$typeof===K&&ep(f)===b.type)?ew(b=e(b,c.props),c):ew(b=dh(c.type,c.key,c.props,null,a.mode,d),c),b.return=a,b)}function k(a,b,c,d){return null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation?(b=dl(c,a.mode,d)).return=a:(b=e(b,c.children||[])).return=a,b}function l(a,b,c,d,f){return null===b||7!==b.tag?(b=di(c,a.mode,d,f)).return=a:(b=e(b,c)).return=a,b}function m(a,b,c){if("string"==typeof b&&""!==b||"number"==typeof b||"bigint"==typeof b)return(b=dj(""+b,a.mode,c)).return=a,b;if("object"==typeof b&&null!==b){switch(b.$$typeof){case z:return ew(c=dh(b.type,b.key,b.props,null,a.mode,c),b),c.return=a,c;case A:return(b=dl(b,a.mode,c)).return=a,b;case K:return m(a,b=ep(b),c)}if(S(b)||Q(b))return(b=di(b,a.mode,c,null)).return=a,b;if("function"==typeof b.then)return m(a,ev(b),c);if(b.$$typeof===F)return m(a,d_(a,b),c);ex(a,b)}return null}function n(a,b,c,d){var e=null!==b?b.key:null;if("string"==typeof c&&""!==c||"number"==typeof c||"bigint"==typeof c)return null!==e?null:i(a,b,""+c,d);if("object"==typeof c&&null!==c){switch(c.$$typeof){case z:return c.key===e?j(a,b,c,d):null;case A:return c.key===e?k(a,b,c,d):null;case K:return n(a,b,c=ep(c),d)}if(S(c)||Q(c))return null!==e?null:l(a,b,c,d,null);if("function"==typeof c.then)return n(a,b,ev(c),d);if(c.$$typeof===F)return n(a,b,d_(a,c),d);ex(a,c)}return null}function o(a,b,c,d,e){if("string"==typeof d&&""!==d||"number"==typeof d||"bigint"==typeof d)return i(b,a=a.get(c)||null,""+d,e);if("object"==typeof d&&null!==d){switch(d.$$typeof){case z:return j(b,a=a.get(null===d.key?c:d.key)||null,d,e);case A:return k(b,a=a.get(null===d.key?c:d.key)||null,d,e);case K:return o(a,b,c,d=ep(d),e)}if(S(d)||Q(d))return l(b,a=a.get(c)||null,d,e,null);if("function"==typeof d.then)return o(a,b,c,ev(d),e);if(d.$$typeof===F)return o(a,b,c,d_(b,d),e);ex(b,d)}return null}return function(i,j,k,l){try{eu=0;var p=function i(j,k,l,p){if("object"==typeof l&&null!==l&&l.type===B&&null===l.key&&void 0===l.props.ref&&(l=l.props.children),"object"==typeof l&&null!==l){switch(l.$$typeof){case z:b:{for(var q=l.key;null!==k;){if(k.key===q){if((q=l.type)===B){if(7===k.tag){c(j,k.sibling),ew(p=e(k,l.props.children),l),p.return=j,j=p;break b}}else if(k.elementType===q||"object"==typeof q&&null!==q&&q.$$typeof===K&&ep(q)===k.type){c(j,k.sibling),ew(p=e(k,l.props),l),p.return=j,j=p;break b}c(j,k);break}b(j,k),k=k.sibling}l.type===B?ew(p=di(l.props.children,j.mode,p,l.key),l):ew(p=dh(l.type,l.key,l.props,null,j.mode,p),l),p.return=j,j=p}return h(j);case A:b:{for(q=l.key;null!==k;){if(k.key===q)if(4===k.tag&&k.stateNode.containerInfo===l.containerInfo&&k.stateNode.implementation===l.implementation){c(j,k.sibling),(p=e(k,l.children||[])).return=j,j=p;break b}else{c(j,k);break}b(j,k),k=k.sibling}(p=dl(l,j.mode,p)).return=j,j=p}return h(j);case K:return i(j,k,l=ep(l),p)}if(S(l))return function(e,g,h,i){for(var j=null,k=null,l=g,p=g=0,q=null;null!==l&&p<h.length;p++){l.index>p?(q=l,l=null):q=l.sibling;var r=n(e,l,h[p],i);if(null===r){null===l&&(l=q);break}a&&l&&null===r.alternate&&b(e,l),g=f(r,g,p),null===k?j=r:k.sibling=r,k=r,l=q}if(p===h.length)return c(e,l),dF&&dy(e,p),j;if(null===l){for(;p<h.length;p++)null!==(l=m(e,h[p],i))&&(g=f(l,g,p),null===k?j=l:k.sibling=l,k=l);return dF&&dy(e,p),j}for(l=d(l);p<h.length;p++)null!==(q=o(l,e,p,h[p],i))&&(a&&null!==q.alternate&&l.delete(null===q.key?p:q.key),g=f(q,g,p),null===k?j=q:k.sibling=q,k=q);return a&&l.forEach(function(a){return b(e,a)}),dF&&dy(e,p),j}(j,k,l,p);if(Q(l)){if("function"!=typeof(q=Q(l)))throw Error(g(150));return function(e,h,i,j){if(null==i)throw Error(g(151));for(var k=null,l=null,p=h,q=h=0,r=null,s=i.next();null!==p&&!s.done;q++,s=i.next()){p.index>q?(r=p,p=null):r=p.sibling;var t=n(e,p,s.value,j);if(null===t){null===p&&(p=r);break}a&&p&&null===t.alternate&&b(e,p),h=f(t,h,q),null===l?k=t:l.sibling=t,l=t,p=r}if(s.done)return c(e,p),dF&&dy(e,q),k;if(null===p){for(;!s.done;q++,s=i.next())null!==(s=m(e,s.value,j))&&(h=f(s,h,q),null===l?k=s:l.sibling=s,l=s);return dF&&dy(e,q),k}for(p=d(p);!s.done;q++,s=i.next())null!==(s=o(p,e,q,s.value,j))&&(a&&null!==s.alternate&&p.delete(null===s.key?q:s.key),h=f(s,h,q),null===l?k=s:l.sibling=s,l=s);return a&&p.forEach(function(a){return b(e,a)}),dF&&dy(e,q),k}(j,k,l=q.call(l),p)}if("function"==typeof l.then)return i(j,k,ev(l),p);if(l.$$typeof===F)return i(j,k,d_(j,l),p);ex(j,l)}return"string"==typeof l&&""!==l||"number"==typeof l||"bigint"==typeof l?(l=""+l,null!==k&&6===k.tag?(c(j,k.sibling),(p=e(k,l)).return=j):(c(j,k),(p=dj(l,j.mode,p)).return=j),h(j=p)):c(j,k)}(i,j,k,l);return et=null,p}catch(a){if(a===ej||a===el)throw a;var q=dd(29,a,null,i.mode);return q.lanes=l,q.return=i,q}finally{}}}var ez=ey(!0),eA=ey(!1),eB=!1;function eC(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function eD(a,b){a=a.updateQueue,b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function eE(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function eF(a,b,c){var d=a.updateQueue;if(null===d)return null;if(d=d.shared,0!=(2&ii)){var e=d.pending;return null===e?b.next=b:(b.next=e.next,e.next=b),d.pending=b,b=da(a),c9(a,null,c),b}return c6(a,d,b,c),da(a)}function eG(a,b,c){if(null!==(b=b.updateQueue)&&(b=b.shared,0!=(4194048&c))){var d=b.lanes;d&=a.pendingLanes,c|=d,b.lanes=c,aM(a,c)}}function eH(a,b){var c=a.updateQueue,d=a.alternate;if(null!==d&&c===(d=d.updateQueue)){var e=null,f=null;if(null!==(c=c.firstBaseUpdate)){do{var g={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};null===f?e=f=g:f=f.next=g,c=c.next}while(null!==c)null===f?e=f=b:f=f.next=b}else e=f=b;c={baseState:d.baseState,firstBaseUpdate:e,lastBaseUpdate:f,shared:d.shared,callbacks:d.callbacks},a.updateQueue=c;return}null===(a=c.lastBaseUpdate)?c.firstBaseUpdate=b:a.next=b,c.lastBaseUpdate=b}var eI=!1;function eJ(){if(eI){var a=ec;if(null!==a)throw a}}function eK(a,b,c,d){eI=!1;var e=a.updateQueue;eB=!1;var f=e.firstBaseUpdate,g=e.lastBaseUpdate,h=e.shared.pending;if(null!==h){e.shared.pending=null;var i=h,j=i.next;i.next=null,null===g?f=j:g.next=j,g=i;var k=a.alternate;null!==k&&(h=(k=k.updateQueue).lastBaseUpdate)!==g&&(null===h?k.firstBaseUpdate=j:h.next=j,k.lastBaseUpdate=i)}if(null!==f){var l=e.baseState;for(g=0,k=j=i=null,h=f;;){var m=-0x20000001&h.lane,n=m!==h.lane;if(n?(il&m)===m:(d&m)===m){0!==m&&m===eb&&(eI=!0),null!==k&&(k=k.next={lane:0,tag:h.tag,payload:h.payload,callback:null,next:null});b:{var o=a,p=h;switch(m=b,p.tag){case 1:if("function"==typeof(o=p.payload)){l=o.call(c,l,m);break b}l=o;break b;case 3:o.flags=-65537&o.flags|128;case 0:if(null==(m="function"==typeof(o=p.payload)?o.call(c,l,m):o))break b;l=w({},l,m);break b;case 2:eB=!0}}null!==(m=h.callback)&&(a.flags|=64,n&&(a.flags|=8192),null===(n=e.callbacks)?e.callbacks=[m]:n.push(m))}else n={lane:m,tag:h.tag,payload:h.payload,callback:h.callback,next:null},null===k?(j=k=n,i=l):k=k.next=n,g|=m;if(null===(h=h.next))if(null===(h=e.shared.pending))break;else h=(n=h).next,n.next=null,e.lastBaseUpdate=n,e.shared.pending=null}null===k&&(i=l),e.baseState=i,e.firstBaseUpdate=j,e.lastBaseUpdate=k,null===f&&(e.shared.lanes=0),iu|=g,a.lanes=g,a.memoizedState=l}}function eL(a,b){if("function"!=typeof a)throw Error(g(191,a));a.call(b)}function eM(a,b){var c=a.callbacks;if(null!==c)for(a.callbacks=null,a=0;a<c.length;a++)eL(c[a],b)}var eN=Y(null),eO=Y(0);function eP(a,b){$(eO,a=is),$(eN,b),is=a|b.baseLanes}function eQ(){$(eO,is),$(eN,eN.current)}function eR(){is=eO.current,Z(eN),Z(eO)}var eS=Y(null),eT=null;function eU(a){var b=a.alternate;$(eZ,1&eZ.current),$(eS,a),null===eT&&(null===b||null!==eN.current?eT=a:null!==b.memoizedState&&(eT=a))}function eV(a){$(eZ,eZ.current),$(eS,a),null===eT&&(eT=a)}function eW(a){22===a.tag?($(eZ,eZ.current),$(eS,a),null===eT&&(eT=a)):eX()}function eX(){$(eZ,eZ.current),$(eS,eS.current)}function eY(a){Z(eS),eT===a&&(eT=null),Z(eZ)}var eZ=Y(0);function e$(a,b){$(eS,eS.current),$(eZ,b)}function e_(a){Z(eZ),Z(eS),eT===a&&(eT=null)}function e0(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(null===(c=c.dehydrated)||kE(c)||kF(c)))return b}else if(19===b.tag&&"independent"!==b.memoizedProps.revealOrder){if(0!=(128&b.flags))return b}else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var e1=0,e2=null,e3=null,e4=null,e5=!1,e6=!1,e7=!1,e8=0,e9=0,fa=null,fb=0;function fc(){throw Error(g(321))}function fd(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!cz(a[c],b[c]))return!1;return!0}function fe(a,b,c,d,e,f){return e1=f,e2=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,T.H=null===a||null===a.memoizedState?gk:gl,e7=!1,f=c(d,e),e7=!1,e6&&(f=fg(b,c,d,e)),ff(a),f}function ff(a){T.H=gj;var b=null!==e3&&null!==e3.next;if(e1=0,e4=e3=e2=null,e5=!1,e9=0,fa=null,b)throw Error(g(300));null===a||gB||null!==(a=a.dependencies)&&dY(a)&&(gB=!0)}function fg(a,b,c,d){e2=a;var e=0;do{if(e6&&(fa=null),e9=0,e6=!1,25<=e)throw Error(g(301));if(e+=1,e4=e3=null,null!=a.updateQueue){var f=a.updateQueue;f.lastEffect=null,f.events=null,f.stores=null,null!=f.memoCache&&(f.memoCache.index=0)}T.H=gm,f=b(c,d)}while(e6)return f}function fh(){var a=T.H,b=a.useState()[0];return b="function"==typeof b.then?fo(b):b,a=a.useState()[0],(null!==e3?e3.memoizedState:null)!==a&&(e2.flags|=1024),b}function fi(){var a=0!==e8;return e8=0,a}function fj(a,b,c){b.updateQueue=a.updateQueue,b.flags&=-2053,a.lanes&=~c}function fk(a){if(e5){for(a=a.memoizedState;null!==a;){var b=a.queue;null!==b&&(b.pending=null),a=a.next}e5=!1}e1=0,e4=e3=e2=null,e6=!1,e9=e8=0,fa=null}function fl(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===e4?e2.memoizedState=e4=a:e4=e4.next=a,e4}function fm(){if(null===e3){var a=e2.alternate;a=null!==a?a.memoizedState:null}else a=e3.next;var b=null===e4?e2.memoizedState:e4.next;if(null!==b)e4=b,e3=a;else{if(null===a){if(null===e2.alternate)throw Error(g(467));throw Error(g(310))}a={memoizedState:(e3=a).memoizedState,baseState:e3.baseState,baseQueue:e3.baseQueue,queue:e3.queue,next:null},null===e4?e2.memoizedState=e4=a:e4=e4.next=a}return e4}function fn(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function fo(a){var b=e9;return e9+=1,null===fa&&(fa=[]),a=eo(fa,a,b),b=e2,null===(null===e4?b.memoizedState:e4.next)&&(T.H=null===(b=b.alternate)||null===b.memoizedState?gk:gl),a}function fp(a){if(null!==a&&"object"==typeof a){if("function"==typeof a.then)return fo(a);if(a.$$typeof===F)return d$(a)}throw Error(g(438,String(a)))}function fq(a){var b=null,c=e2.updateQueue;if(null!==c&&(b=c.memoCache),null==b){var d=e2.alternate;null!==d&&null!==(d=d.updateQueue)&&null!=(d=d.memoCache)&&(b={data:d.data.map(function(a){return a.slice()}),index:0})}if(null==b&&(b={data:[],index:0}),null===c&&(c=fn(),e2.updateQueue=c),c.memoCache=b,void 0===(c=b.data[b.index]))for(c=b.data[b.index]=Array(a),d=0;d<a;d++)c[d]=N;return b.index++,c}function fr(a,b){return"function"==typeof b?b(a):b}function fs(a){return ft(fm(),e3,a)}function ft(a,b,c){var d=a.queue;if(null===d)throw Error(g(311));d.lastRenderedReducer=c;var e=a.baseQueue,f=d.pending;if(null!==f){if(null!==e){var h=e.next;e.next=f.next,f.next=h}b.baseQueue=e=f,d.pending=null}if(f=a.baseState,null===e)a.memoizedState=f;else{b=e.next;var i=h=null,j=null,k=b,l=!1;do{var m=-0x20000001&k.lane;if(m!==k.lane?(il&m)===m:(e1&m)===m){var n=k.revertLane;if(0===n)null!==j&&(j=j.next={lane:0,revertLane:0,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),m===eb&&(l=!0);else if((e1&n)===n){k=k.next,n===eb&&(l=!0);continue}else m={lane:0,revertLane:k.revertLane,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},null===j?(i=j=m,h=f):j=j.next=m,e2.lanes|=n,iu|=n;m=k.action,e7&&c(f,m),f=k.hasEagerState?k.eagerState:c(f,m)}else n={lane:m,revertLane:k.revertLane,gesture:k.gesture,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},null===j?(i=j=n,h=f):j=j.next=n,e2.lanes|=m,iu|=m;k=k.next}while(null!==k&&k!==b)if(null===j?h=f:j.next=i,!cz(f,a.memoizedState)&&(gB=!0,l&&null!==(c=ec)))throw c;a.memoizedState=f,a.baseState=h,a.baseQueue=j,d.lastRenderedState=f}return null===e&&(d.lanes=0),[a.memoizedState,d.dispatch]}function fu(a){var b=fm(),c=b.queue;if(null===c)throw Error(g(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var h=e=e.next;do f=a(f,h.action),h=h.next;while(h!==e)cz(f,b.memoizedState)||(gB=!0),b.memoizedState=f,null===b.baseQueue&&(b.baseState=f),c.lastRenderedState=f}return[f,d]}function fv(a,b,c){var d=e2,e=fm(),f=dF;if(f){if(void 0===c)throw Error(g(407));c=c()}else c=b();var h=!cz((e3||e).memoizedState,c);if(h&&(e.memoizedState=c,gB=!0),e=e.queue,fU(fy.bind(null,d,e,a),[a]),e.getSnapshot!==b||h||null!==e4&&1&e4.memoizedState.tag){if(d.flags|=2048,fP(9,{destroy:void 0},fx.bind(null,d,e,c,b),null),null===ij)throw Error(g(349));f||0!=(127&e1)||fw(d,b,c)}return c}function fw(a,b,c){a.flags|=16384,a={getSnapshot:b,value:c},null===(b=e2.updateQueue)?(b=fn(),e2.updateQueue=b,b.stores=[a]):null===(c=b.stores)?b.stores=[a]:c.push(a)}function fx(a,b,c,d){b.value=c,b.getSnapshot=d,fz(b)&&fA(a)}function fy(a,b,c){return c(function(){fz(b)&&fA(a)})}function fz(a){var b=a.getSnapshot;a=a.value;try{var c=b();return!cz(a,c)}catch(a){return!0}}function fA(a){var b=c8(a,2);null!==b&&iW(b,a,2)}function fB(a){var b=fl();return"function"==typeof a&&(a=a()),b.memoizedState=b.baseState=a,b.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fr,lastRenderedState:a},b}function fC(a,b,c,d){return a.baseState=c,ft(a,e3,"function"==typeof d?d:fr)}function fD(a,b,c,d,e){if(gg(a))throw Error(g(485));if(null!==(a=b.action)){var f={payload:e,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(a){f.listeners.push(a)}};null!==T.T?c(!0):f.isTransition=!1,d(f),null===(c=b.pending)?(f.next=b.pending=f,fE(b,f)):(f.next=c.next,b.pending=c.next=f)}}function fE(a,b){var c=b.action,d=b.payload,e=a.state;if(b.isTransition){var f=T.T,g={};g.types=null!==f?f.types:null,T.T=g;try{var h=c(e,d),i=T.S;null!==i&&i(g,h),fF(a,b,h)}catch(c){fH(a,b,c)}finally{null!==f&&null!==g.types&&(f.types=g.types),T.T=f}}else try{f=c(e,d),fF(a,b,f)}catch(c){fH(a,b,c)}}function fF(a,b,c){null!==c&&"object"==typeof c&&"function"==typeof c.then?c.then(function(c){fG(a,b,c)},function(c){return fH(a,b,c)}):fG(a,b,c)}function fG(a,b,c){b.status="fulfilled",b.value=c,fI(b),a.state=c,null!==(b=a.pending)&&((c=b.next)===b?a.pending=null:(c=c.next,b.next=c,fE(a,c)))}function fH(a,b,c){var d=a.pending;if(a.pending=null,null!==d){d=d.next;do b.status="rejected",b.reason=c,fI(b),b=b.next;while(b!==d)}a.action=null}function fI(a){a=a.listeners;for(var b=0;b<a.length;b++)(0,a[b])()}function fJ(a,b){return b}function fK(a,b){if(dF){var c=ij.formState;if(null!==c){b:{var d=e2;if(dF){if(dE){c:{for(var e=dE,f=dH;8!==e.nodeType;)if(!f||null===(e=kG(e.nextSibling))){e=null;break c}e="F!"===(f=e.data)||"F"===f?e:null}if(e){dE=kG(e.nextSibling),d="F!"===e.data;break b}}dJ(d)}d=!1}d&&(b=c[0])}}return(c=fl()).memoizedState=c.baseState=b,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fJ,lastRenderedState:b},c.queue=d,c=gd.bind(null,e2,d),d.dispatch=c,d=fB(!1),f=gf.bind(null,e2,!1,d.queue),d=fl(),e={state:b,dispatch:null,action:a,pending:null},d.queue=e,c=fD.bind(null,e2,e,f,c),e.dispatch=c,d.memoizedState=a,[b,c,!1]}function fL(a){return fM(fm(),e3,a)}function fM(a,b,c){if(b=ft(a,b,fJ)[0],a=fs(fr)[0],"object"==typeof b&&null!==b&&"function"==typeof b.then)try{var d=fo(b)}catch(a){if(a===ej)throw el;throw a}else d=b;var e=(b=fm()).queue,f=e.dispatch;return c!==b.memoizedState&&(e2.flags|=2048,fP(9,{destroy:void 0},fN.bind(null,e,c),null)),[d,f,a]}function fN(a,b){a.action=b}function fO(a){var b=fm(),c=e3;if(null!==c)return fM(b,c,a);fm(),b=b.memoizedState;var d=(c=fm()).queue.dispatch;return c.memoizedState=a,[b,d,!1]}function fP(a,b,c,d){return a={tag:a,create:c,deps:d,inst:b,next:null},null===(b=e2.updateQueue)&&(b=fn(),e2.updateQueue=b),null===(c=b.lastEffect)?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a),a}function fQ(){return fm().memoizedState}function fR(a,b,c,d){var e=fl();e2.flags|=a,e.memoizedState=fP(1|b,{destroy:void 0},c,void 0===d?null:d)}function fS(a,b,c,d){var e=fm();d=void 0===d?null:d;var f=e.memoizedState.inst;null!==e3&&null!==d&&fd(d,e3.memoizedState.deps)?e.memoizedState=fP(b,f,c,d):(e2.flags|=a,e.memoizedState=fP(1|b,f,c,d))}function fT(a,b){fR(8390656,8,a,b)}function fU(a,b){fS(2048,8,a,b)}function fV(a){var b=fm().memoizedState,c={ref:b,nextImpl:a};e2.flags|=4;var d=e2.updateQueue;if(null===d)d=fn(),e2.updateQueue=d,d.events=[c];else{var e=d.events;null===e?d.events=[c]:e.push(c)}return function(){if(0!=(2&ii))throw Error(g(440));return b.impl.apply(void 0,arguments)}}function fW(a,b){return fS(4,2,a,b)}function fX(a,b){return fS(4,4,a,b)}function fY(a,b){if("function"==typeof b){var c=b(a=a());return function(){"function"==typeof c?c():b(null)}}if(null!=b)return b.current=a=a(),function(){b.current=null}}function fZ(a,b,c){c=null!=c?c.concat([a]):null,fS(4,4,fY.bind(null,b,a),c)}function f$(){}function f_(a,b){var c=fm();b=void 0===b?null:b;var d=c.memoizedState;return null!==b&&fd(b,d[1])?d[0]:(c.memoizedState=[a,b],a)}function f0(a,b){var c=fm();b=void 0===b?null:b;var d=c.memoizedState;return null!==b&&fd(b,d[1])?d[0]:(c.memoizedState=[d=a(),b],d)}function f1(a,b,c){return void 0===c||0!=(0x40000000&e1)&&0==(261930&il)?a.memoizedState=b:(a.memoizedState=c,a=iU(),e2.lanes|=a,iu|=a,c)}function f2(a,b,c,d){return cz(c,b)?c:null!==eN.current?(cz(a=f1(a,c,d),b)||(gB=!0),a):0==(42&e1)||0!=(0x40000000&e1)&&0==(261930&il)?(gB=!0,a.memoizedState=c):(a=iU(),e2.lanes|=a,iu|=a,b)}function f3(a,b,c,d,e){var f=U.p;U.p=0!==f&&8>f?f:8;var g=T.T,h={};h.types=null!==g?g.types:null,T.T=h,gf(a,!1,b,c);try{var i=e(),j=T.S;if(null!==j&&j(h,i),null!==i&&"object"==typeof i&&"function"==typeof i.then){var k,l,m=(k=[],l={status:"pending",value:null,reason:null,then:function(a){k.push(a)}},i.then(function(){l.status="fulfilled",l.value=d;for(var a=0;a<k.length;a++)(0,k[a])(d)},function(a){for(l.status="rejected",l.reason=a,a=0;a<k.length;a++)(0,k[a])(void 0)}),l);ge(a,b,m,iT(a))}else ge(a,b,d,iT(a))}catch(c){ge(a,b,{then:function(){},status:"rejected",reason:c},iT())}finally{U.p=f,null!==g&&null!==h.types&&(g.types=h.types),T.T=g}}function f4(){}function f5(a,b,c,d){if(5!==a.tag)throw Error(g(476));var e=f6(a).queue;f3(a,e,b,V,null===c?f4:function(){return f7(a),c(d)})}function f6(a){var b=a.memoizedState;if(null!==b)return b;var c={};return(b={memoizedState:V,baseState:V,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fr,lastRenderedState:V},next:null}).next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fr,lastRenderedState:c},next:null},a.memoizedState=b,null!==(a=a.alternate)&&(a.memoizedState=b),b}function f7(a){var b=f6(a);null===b.next&&(b=a.alternate.memoizedState),ge(a,b.next.queue,{},iT())}function f8(){return d$(le)}function f9(){return fm().memoizedState}function ga(){return fm().memoizedState}function gb(a){for(var b=a.return;null!==b;){switch(b.tag){case 24:case 3:var c=iT(),d=eF(b,a=eE(c),c);null!==d&&(iW(d,b,c),eG(d,b,c)),b={cache:d5()},a.payload=b;return}b=b.return}}function gc(a,b,c){var d=iT();c={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},gg(a)?gh(b,c):null!==(c=c7(a,b,c,d))&&(iW(c,a,d),gi(c,b,d))}function gd(a,b,c){ge(a,b,c,iT())}function ge(a,b,c,d){var e={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(gg(a))gh(b,e);else{var f=a.alternate;if(0===a.lanes&&(null===f||0===f.lanes)&&null!==(f=b.lastRenderedReducer))try{var g=b.lastRenderedState,h=f(g,c);if(e.hasEagerState=!0,e.eagerState=h,cz(h,g))return c6(a,b,e,0),null===ij&&c5(),!1}catch(a){}finally{}if(null!==(c=c7(a,b,e,d)))return iW(c,a,d),gi(c,b,d),!0}return!1}function gf(a,b,c,d){if(d={lane:2,revertLane:jF(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},gg(a)){if(b)throw Error(g(479))}else null!==(b=c7(a,c,d,2))&&iW(b,a,2)}function gg(a){var b=a.alternate;return a===e2||null!==b&&b===e2}function gh(a,b){e6=e5=!0;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b),a.pending=b}function gi(a,b,c){if(0!=(4194048&c)){var d=b.lanes;d&=a.pendingLanes,b.lanes=c|=d,aM(a,c)}}var gj={readContext:d$,use:fp,useCallback:fc,useContext:fc,useEffect:fc,useImperativeHandle:fc,useLayoutEffect:fc,useInsertionEffect:fc,useMemo:fc,useReducer:fc,useRef:fc,useState:fc,useDebugValue:fc,useDeferredValue:fc,useTransition:fc,useSyncExternalStore:fc,useId:fc,useHostTransitionStatus:fc,useFormState:fc,useActionState:fc,useOptimistic:fc,useMemoCache:fc,useCacheRefresh:fc};gj.useEffectEvent=fc;var gk={readContext:d$,use:fp,useCallback:function(a,b){return fl().memoizedState=[a,void 0===b?null:b],a},useContext:d$,useEffect:fT,useImperativeHandle:function(a,b,c){c=null!=c?c.concat([a]):null,fR(4194308,4,fY.bind(null,b,a),c)},useLayoutEffect:function(a,b){return fR(4194308,4,a,b)},useInsertionEffect:function(a,b){fR(4,2,a,b)},useMemo:function(a,b){var c=fl();b=void 0===b?null:b;var d=a();return c.memoizedState=[d,b],d},useReducer:function(a,b,c){var d=fl();if(void 0!==c)var e=c(b);else e=b;return d.memoizedState=d.baseState=e,d.queue=a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:e},a=a.dispatch=gc.bind(null,e2,a),[d.memoizedState,a]},useRef:function(a){return fl().memoizedState={current:a}},useState:function(a){var b=(a=fB(a)).queue,c=gd.bind(null,e2,b);return b.dispatch=c,[a.memoizedState,c]},useDebugValue:f$,useDeferredValue:function(a,b){return f1(fl(),a,b)},useTransition:function(){var a=fB(!1);return a=f3.bind(null,e2,a.queue,!0,!1),fl().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,b,c){var d=e2,e=fl();if(dF){if(void 0===c)throw Error(g(407));c=c()}else{if(c=b(),null===ij)throw Error(g(349));0!=(127&il)||fw(d,b,c)}e.memoizedState=c;var f={value:c,getSnapshot:b};return e.queue=f,fT(fy.bind(null,d,f,a),[a]),d.flags|=2048,fP(9,{destroy:void 0},fx.bind(null,d,f,c,b),null),c},useId:function(){var a=fl(),b=ij.identifierPrefix;if(dF){var c=dx,d=dw;b="_"+b+"R_"+(c=(d&~(1<<32-az(d)-1)).toString(32)+c),0<(c=e8++)&&(b+="H"+c.toString(32)),b+="_"}else b="_"+b+"r_"+(c=fb++).toString(32)+"_";return a.memoizedState=b},useHostTransitionStatus:f8,useFormState:fK,useActionState:fK,useOptimistic:function(a){var b=fl();b.memoizedState=b.baseState=a;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return b.queue=c,b=gf.bind(null,e2,!0,c),c.dispatch=b,[a,b]},useMemoCache:fq,useCacheRefresh:function(){return fl().memoizedState=gb.bind(null,e2)},useEffectEvent:function(a){var b=fl(),c={impl:a};return b.memoizedState=c,function(){if(0!=(2&ii))throw Error(g(440));return c.impl.apply(void 0,arguments)}}},gl={readContext:d$,use:fp,useCallback:f_,useContext:d$,useEffect:fU,useImperativeHandle:fZ,useInsertionEffect:fW,useLayoutEffect:fX,useMemo:f0,useReducer:fs,useRef:fQ,useState:function(){return fs(fr)},useDebugValue:f$,useDeferredValue:function(a,b){return f2(fm(),e3.memoizedState,a,b)},useTransition:function(){var a=fs(fr)[0],b=fm().memoizedState;return["boolean"==typeof a?a:fo(a),b]},useSyncExternalStore:fv,useId:f9,useHostTransitionStatus:f8,useFormState:fL,useActionState:fL,useOptimistic:function(a,b){return fC(fm(),e3,a,b)},useMemoCache:fq,useCacheRefresh:ga};gl.useEffectEvent=fV;var gm={readContext:d$,use:fp,useCallback:f_,useContext:d$,useEffect:fU,useImperativeHandle:fZ,useInsertionEffect:fW,useLayoutEffect:fX,useMemo:f0,useReducer:fu,useRef:fQ,useState:function(){return fu(fr)},useDebugValue:f$,useDeferredValue:function(a,b){var c=fm();return null===e3?f1(c,a,b):f2(c,e3.memoizedState,a,b)},useTransition:function(){var a=fu(fr)[0],b=fm().memoizedState;return["boolean"==typeof a?a:fo(a),b]},useSyncExternalStore:fv,useId:f9,useHostTransitionStatus:f8,useFormState:fO,useActionState:fO,useOptimistic:function(a,b){var c=fm();return null!==e3?fC(c,e3,a,b):(c.baseState=a,[a,c.queue.dispatch])},useMemoCache:fq,useCacheRefresh:ga};function gn(a,b,c,d){c=null==(c=c(d,b=a.memoizedState))?b:w({},b,c),a.memoizedState=c,0===a.lanes&&(a.updateQueue.baseState=c)}gm.useEffectEvent=fV;var go={enqueueSetState:function(a,b,c){a=a._reactInternals;var d=iT(),e=eE(d);e.payload=b,null!=c&&(e.callback=c),null!==(b=eF(a,e,d))&&(iW(b,a,d),eG(b,a,d))},enqueueReplaceState:function(a,b,c){a=a._reactInternals;var d=iT(),e=eE(d);e.tag=1,e.payload=b,null!=c&&(e.callback=c),null!==(b=eF(a,e,d))&&(iW(b,a,d),eG(b,a,d))},enqueueForceUpdate:function(a,b){a=a._reactInternals;var c=iT(),d=eE(c);d.tag=2,null!=b&&(d.callback=b),null!==(b=eF(a,d,c))&&(iW(b,a,c),eG(b,a,c))}};function gp(a,b,c,d,e,f,g){return"function"==typeof(a=a.stateNode).shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):!b.prototype||!b.prototype.isPureReactComponent||!cA(c,d)||!cA(e,f)}function gq(a,b,c,d){a=b.state,"function"==typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d),"function"==typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d),b.state!==a&&go.enqueueReplaceState(b,b.state,null)}function gr(a,b){var c=b;if("ref"in b)for(var d in c={},b)"ref"!==d&&(c[d]=b[d]);if(a=a.defaultProps)for(var e in c===b&&(c=w({},c)),a)void 0===c[e]&&(c[e]=a[e]);return c}function gs(a){c1(a)}function gt(a){console.error(a)}function gu(a){c1(a)}function gv(a,b){try{(0,a.onUncaughtError)(b.value,{componentStack:b.stack})}catch(a){setTimeout(function(){throw a})}}function gw(a,b,c){try{(0,a.onCaughtError)(c.value,{componentStack:c.stack,errorBoundary:1===b.tag?b.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function gx(a,b,c){return(c=eE(c)).tag=3,c.payload={element:null},c.callback=function(){gv(a,b)},c}function gy(a){return(a=eE(a)).tag=3,a}function gz(a,b,c,d){var e=c.type.getDerivedStateFromError;if("function"==typeof e){var f=d.value;a.payload=function(){return e(f)},a.callback=function(){gw(b,c,d)}}var g=c.stateNode;null!==g&&"function"==typeof g.componentDidCatch&&(a.callback=function(){gw(b,c,d),"function"!=typeof e&&(null===iG?iG=new Set([this]):iG.add(this));var a=d.stack;this.componentDidCatch(d.value,{componentStack:null!==a?a:""})})}var gA=Error(g(461)),gB=!1;function gC(a,b,c,d){b.child=null===a?eA(b,null,c,d):ez(b,a.child,c,d)}function gD(a,b,c,d,e){c=c.render;var f=b.ref;if("ref"in d){var g={};for(var h in d)"ref"!==h&&(g[h]=d[h])}else g=d;return(dZ(b),d=fe(a,b,c,g,f,e),h=fi(),null===a||gB)?(dF&&h&&dA(b),b.flags|=1,gC(a,b,d,e),b.child):(fj(a,b,e),g0(a,b,e))}function gE(a,b,c,d,e){if(null===a){var f=c.type;return"function"!=typeof f||de(f)||void 0!==f.defaultProps||null!==c.compare?((a=dh(c.type,null,d,b,b.mode,e)).ref=b.ref,a.return=b,b.child=a):(b.tag=15,b.type=f,gF(a,b,f,d,e))}if(f=a.child,!g1(a,e)){var g=f.memoizedProps;if((c=null!==(c=c.compare)?c:cA)(g,d)&&a.ref===b.ref)return g0(a,b,e)}return b.flags|=1,(a=df(f,d)).ref=b.ref,a.return=b,b.child=a}function gF(a,b,c,d,e){if(null!==a){var f=a.memoizedProps;if(cA(f,d)&&a.ref===b.ref)if(gB=!1,b.pendingProps=d=f,!g1(a,e))return b.lanes=a.lanes,g0(a,b,e);else 0!=(131072&a.flags)&&(gB=!0)}return gM(a,b,c,d,e)}function gG(a,b,c,d){var e=d.children,f=null!==a?a.memoizedState:null;if(null===a&&null===b.stateNode&&(b.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===d.mode){if(0!=(128&b.flags)){if(f=null!==f?f.baseLanes|c:c,null!==a){for(e=0,d=b.child=a.child;null!==d;)e=e|d.lanes|d.childLanes,d=d.sibling;d=e&~f}else d=0,b.child=null;return gI(a,b,f,c,d)}if(0==(0x20000000&c))return d=b.lanes=0x20000000,gI(a,b,null!==f?f.baseLanes|c:c,c,d);b.memoizedState={baseLanes:0,cachePool:null},null!==a&&eh(b,null!==f?f.cachePool:null),null!==f?eP(b,f):eQ(),eW(b)}else null!==f?(eh(b,f.cachePool),eP(b,f),eX(),b.memoizedState=null):(null!==a&&eh(b,null),eQ(),eX());return gC(a,b,e,c),b.child}function gH(a,b){return null!==a&&22===a.tag||null!==b.stateNode||(b.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),b.sibling}function gI(a,b,c,d,e){var f=eg();return b.memoizedState={baseLanes:c,cachePool:f=null===f?null:{parent:d4._currentValue,pool:f}},null!==a&&eh(b,null),eQ(),eW(b),null!==a&&dX(a,b,d,!0),b.childLanes=e,null}function gJ(a,b){return(b=gV({mode:b.mode,children:b.children},a.mode)).ref=a.ref,a.child=b,b.return=a,b}function gK(a,b,c){return ez(b,a.child,null,c),a=gJ(b,b.pendingProps),a.flags|=2,eY(b),b.memoizedState=null,a}function gL(a,b){var c=b.ref;if(null===c)null!==a&&null!==a.ref&&(b.flags|=4194816);else{if("function"!=typeof c&&"object"!=typeof c)throw Error(g(284));(null===a||a.ref!==c)&&(b.flags|=4194816)}}function gM(a,b,c,d,e){return(dZ(b),c=fe(a,b,c,d,void 0,e),d=fi(),null===a||gB)?(dF&&d&&dA(b),b.flags|=1,gC(a,b,c,e),b.child):(fj(a,b,e),g0(a,b,e))}function gN(a,b,c,d,e,f){return(dZ(b),b.updateQueue=null,c=fg(b,d,c,e),ff(a),d=fi(),null===a||gB)?(dF&&d&&dA(b),b.flags|=1,gC(a,b,c,f),b.child):(fj(a,b,f),g0(a,b,f))}function gO(a,b,c,d,e){if(dZ(b),null===b.stateNode){var f=db,g=c.contextType;"object"==typeof g&&null!==g&&(f=d$(g)),b.memoizedState=null!==(f=new c(d,f)).state&&void 0!==f.state?f.state:null,f.updater=go,b.stateNode=f,f._reactInternals=b,(f=b.stateNode).props=d,f.state=b.memoizedState,f.refs={},eC(b),g=c.contextType,f.context="object"==typeof g&&null!==g?d$(g):db,f.state=b.memoizedState,"function"==typeof(g=c.getDerivedStateFromProps)&&(gn(b,c,g,d),f.state=b.memoizedState),"function"==typeof c.getDerivedStateFromProps||"function"==typeof f.getSnapshotBeforeUpdate||"function"!=typeof f.UNSAFE_componentWillMount&&"function"!=typeof f.componentWillMount||(g=f.state,"function"==typeof f.componentWillMount&&f.componentWillMount(),"function"==typeof f.UNSAFE_componentWillMount&&f.UNSAFE_componentWillMount(),g!==f.state&&go.enqueueReplaceState(f,f.state,null),eK(b,d,f,e),eJ(),f.state=b.memoizedState),"function"==typeof f.componentDidMount&&(b.flags|=4194308),d=!0}else if(null===a){f=b.stateNode;var h=b.memoizedProps,i=gr(c,h);f.props=i;var j=f.context,k=c.contextType;g=db,"object"==typeof k&&null!==k&&(g=d$(k));var l=c.getDerivedStateFromProps;k="function"==typeof l||"function"==typeof f.getSnapshotBeforeUpdate,h=b.pendingProps!==h,k||"function"!=typeof f.UNSAFE_componentWillReceiveProps&&"function"!=typeof f.componentWillReceiveProps||(h||j!==g)&&gq(b,f,d,g),eB=!1;var m=b.memoizedState;f.state=m,eK(b,d,f,e),eJ(),j=b.memoizedState,h||m!==j||eB?("function"==typeof l&&(gn(b,c,l,d),j=b.memoizedState),(i=eB||gp(b,c,i,d,m,j,g))?(k||"function"!=typeof f.UNSAFE_componentWillMount&&"function"!=typeof f.componentWillMount||("function"==typeof f.componentWillMount&&f.componentWillMount(),"function"==typeof f.UNSAFE_componentWillMount&&f.UNSAFE_componentWillMount()),"function"==typeof f.componentDidMount&&(b.flags|=4194308)):("function"==typeof f.componentDidMount&&(b.flags|=4194308),b.memoizedProps=d,b.memoizedState=j),f.props=d,f.state=j,f.context=g,d=i):("function"==typeof f.componentDidMount&&(b.flags|=4194308),d=!1)}else{f=b.stateNode,eD(a,b),k=gr(c,g=b.memoizedProps),f.props=k,l=b.pendingProps,m=f.context,j=c.contextType,i=db,"object"==typeof j&&null!==j&&(i=d$(j)),(j="function"==typeof(h=c.getDerivedStateFromProps)||"function"==typeof f.getSnapshotBeforeUpdate)||"function"!=typeof f.UNSAFE_componentWillReceiveProps&&"function"!=typeof f.componentWillReceiveProps||(g!==l||m!==i)&&gq(b,f,d,i),eB=!1,m=b.memoizedState,f.state=m,eK(b,d,f,e),eJ();var n=b.memoizedState;g!==l||m!==n||eB||null!==a&&null!==a.dependencies&&dY(a.dependencies)?("function"==typeof h&&(gn(b,c,h,d),n=b.memoizedState),(k=eB||gp(b,c,k,d,m,n,i)||null!==a&&null!==a.dependencies&&dY(a.dependencies))?(j||"function"!=typeof f.UNSAFE_componentWillUpdate&&"function"!=typeof f.componentWillUpdate||("function"==typeof f.componentWillUpdate&&f.componentWillUpdate(d,n,i),"function"==typeof f.UNSAFE_componentWillUpdate&&f.UNSAFE_componentWillUpdate(d,n,i)),"function"==typeof f.componentDidUpdate&&(b.flags|=4),"function"==typeof f.getSnapshotBeforeUpdate&&(b.flags|=1024)):("function"!=typeof f.componentDidUpdate||g===a.memoizedProps&&m===a.memoizedState||(b.flags|=4),"function"!=typeof f.getSnapshotBeforeUpdate||g===a.memoizedProps&&m===a.memoizedState||(b.flags|=1024),b.memoizedProps=d,b.memoizedState=n),f.props=d,f.state=n,f.context=i,d=k):("function"!=typeof f.componentDidUpdate||g===a.memoizedProps&&m===a.memoizedState||(b.flags|=4),"function"!=typeof f.getSnapshotBeforeUpdate||g===a.memoizedProps&&m===a.memoizedState||(b.flags|=1024),d=!1)}return f=d,gL(a,b),d=0!=(128&b.flags),f||d?(f=b.stateNode,c=d&&"function"!=typeof c.getDerivedStateFromError?null:f.render(),b.flags|=1,null!==a&&d?(b.child=ez(b,a.child,null,e),b.child=ez(b,null,c,e)):gC(a,b,c,e),b.memoizedState=f.state,a=b.child):a=g0(a,b,e),a}function gP(a,b,c,d){return dN(),b.flags|=256,gC(a,b,c,d),b.child}var gQ={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function gR(a){return{baseLanes:a,cachePool:ei()}}function gS(a,b,c){return a=null!==a?a.childLanes&~c:0,b&&(a|=ix),a}function gT(a,b,c){var d,e=b.pendingProps,f=!1,h=0!=(128&b.flags);if((d=h)||(d=(null===a||null!==a.memoizedState)&&0!=(2&eZ.current)),d&&(f=!0,b.flags&=-129),d=0!=(32&b.flags),b.flags&=-33,null===a){if(dF){if(f?eU(b):eX(),(a=dE)?null!==(a=null!==(a=kD(a,dH))&&"&"!==a.data?a:null)&&(b.memoizedState={dehydrated:a,treeContext:null!==dv?{id:dw,overflow:dx}:null,retryLane:0x20000000,hydrationErrors:null},(c=dk(a)).return=b,b.child=c,dD=b,dE=null):a=null,null===a)throw dJ(b);return kF(a)?b.lanes=32:b.lanes=0x20000000,null}var i=e.children;return(e=e.fallback,f)?(eX(),i=gV({mode:"hidden",children:i},f=b.mode),e=di(e,f,c,null),i.return=b,e.return=b,i.sibling=e,b.child=i,(e=b.child).memoizedState=gR(c),e.childLanes=gS(a,d,c),b.memoizedState=gQ,gH(null,e)):(eU(b),gU(b,i))}var j=a.memoizedState;if(null!==j&&null!==(i=j.dehydrated)){if(h)256&b.flags?(eU(b),b.flags&=-257,b=gW(a,b,c)):null!==b.memoizedState?(eX(),b.child=a.child,b.flags|=128,b=null):(eX(),i=e.fallback,f=b.mode,e=gV({mode:"visible",children:e.children},f),i=di(i,f,c,null),i.flags|=2,e.return=b,i.return=b,e.sibling=i,b.child=e,ez(b,a.child,null,c),(e=b.child).memoizedState=gR(c),e.childLanes=gS(a,d,c),b.memoizedState=gQ,b=gH(null,e));else if(eU(b),kF(i)){if(d=i.nextSibling&&i.nextSibling.dataset)var k=d.dgst;d=k,(e=Error(g(419))).stack="",e.digest=d,dP({value:e,source:null,stack:null}),b=gW(a,b,c)}else if(gB||dX(a,b,c,!1),d=0!=(c&a.childLanes),gB||d){if(null!==(d=ij)&&0!==(e=aN(d,c))&&e!==j.retryLane)throw j.retryLane=e,c8(a,e),iW(d,a,e),gA;kE(i)||i5(),b=gW(a,b,c)}else kE(i)?(b.flags|=192,b.child=a.child,b=null):(a=j.treeContext,dE=kG(i.nextSibling),dD=b,dF=!0,dG=null,dH=!1,null!==a&&dC(b,a),b=gU(b,e.children),b.flags|=4096);return b}return f?(eX(),i=e.fallback,f=b.mode,k=(j=a.child).sibling,(e=df(j,{mode:"hidden",children:e.children})).subtreeFlags=0x7e00000&j.subtreeFlags,null!==k?i=df(k,i):(i=di(i,f,c,null),i.flags|=2),i.return=b,e.return=b,e.sibling=i,b.child=e,gH(null,e),e=b.child,null===(i=a.child.memoizedState)?i=gR(c):(null!==(f=i.cachePool)?(j=d4._currentValue,f=f.parent!==j?{parent:j,pool:j}:f):f=ei(),i={baseLanes:i.baseLanes|c,cachePool:f}),e.memoizedState=i,e.childLanes=gS(a,d,c),b.memoizedState=gQ,gH(a.child,e)):(eU(b),a=(c=a.child).sibling,(c=df(c,{mode:"visible",children:e.children})).return=b,c.sibling=null,null!==a&&(null===(d=b.deletions)?(b.deletions=[a],b.flags|=16):d.push(a)),b.child=c,b.memoizedState=null,c)}function gU(a,b){return(b=gV({mode:"visible",children:b},a.mode)).return=a,a.child=b}function gV(a,b){return(a=dd(22,a,null,b)).lanes=0,a}function gW(a,b,c){return ez(b,a.child,null,c),a=gU(b,b.pendingProps.children),a.flags|=2,b.memoizedState=null,a}function gX(a,b,c){a.lanes|=b;var d=a.alternate;null!==d&&(d.lanes|=b),dV(a.return,b,c)}function gY(a){for(var b=null;null!==a;){var c=a.alternate;null!==c&&null===e0(c)&&(b=a),a=a.sibling}return b}function gZ(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:e,treeForkCount:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailMode=e,g.treeForkCount=f)}function g$(a){var b=a.child;for(a.child=null;null!==b;){var c=b.sibling;b.sibling=a.child,a.child=b,b=c}}function g_(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;d=d.children;var g=eZ.current;if(128&b.flags)return e$(b,g),null;var h=0!=(2&g);if(h?(g=1&g|2,b.flags|=128):g&=1,e$(b,g),"backwards"===e&&null!==a?(g$(a),gC(a,b,d,c),g$(a)):gC(a,b,d,c),d=dF?ds:0,!h&&null!==a&&0!=(128&a.flags))b:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&gX(a,c,b);else if(19===a.tag)gX(a,c,b);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===b)break;for(;null===a.sibling;){if(null===a.return||a.return===b)break b;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(e){case"backwards":null===(c=gY(b.child))?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null,g$(b)),gZ(b,!0,e,null,f,d);break;case"unstable_legacy-backwards":for(c=null,e=b.child,b.child=null;null!==e;){if(null!==(a=e.alternate)&&null===e0(a)){b.child=e;break}a=e.sibling,e.sibling=c,c=e,e=a}gZ(b,!0,c,null,f,d);break;case"together":gZ(b,!1,null,null,void 0,d);break;case"independent":b.memoizedState=null;break;default:null===(c=gY(b.child))?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null),gZ(b,!1,e,c,f,d)}return b.child}function g0(a,b,c){if(null!==a&&(b.dependencies=a.dependencies),iu|=b.lanes,0==(c&b.childLanes)){if(null===a)return null;else if(dX(a,b,c,!1),0==(c&b.childLanes))return null}if(null!==a&&b.child!==a.child)throw Error(g(153));if(null!==b.child){for(c=df(a=b.child,a.pendingProps),b.child=c,c.return=b;null!==a.sibling;)a=a.sibling,(c=c.sibling=df(a,a.pendingProps)).return=b;c.sibling=null}return b.child}function g1(a,b){return 0!=(a.lanes&b)||!!(null!==(a=a.dependencies)&&dY(a))}function g2(a,b,c){if(null!==a)if(a.memoizedProps!==b.pendingProps)gB=!0;else{if(!g1(a,c)&&0==(128&b.flags))return gB=!1,function(a,b,c){switch(b.tag){case 3:ad(b,b.stateNode.containerInfo),dT(b,d4,a.memoizedState.cache),dN();break;case 27:case 5:af(b);break;case 4:ad(b,b.stateNode.containerInfo);break;case 10:dT(b,b.type,b.memoizedProps.value);break;case 31:if(null!==b.memoizedState)return b.flags|=128,eV(b),null;break;case 13:var d=b.memoizedState;if(null!==d){if(null!==d.dehydrated)return eU(b),b.flags|=128,null;if(0!=(c&b.child.childLanes))return gT(a,b,c);return eU(b),null!==(a=g0(a,b,c))?a.sibling:null}eU(b);break;case 19:if(128&b.flags)return g_(a,b,c);var e=0!=(128&a.flags);if((d=0!=(c&b.childLanes))||(dX(a,b,c,!1),d=0!=(c&b.childLanes)),e){if(d)return g_(a,b,c);b.flags|=128}if(null!==(e=b.memoizedState)&&(e.rendering=null,e.tail=null,e.lastEffect=null),e$(b,eZ.current),!d)return null;break;case 22:return b.lanes=0,gG(a,b,c,b.pendingProps);case 24:dT(b,d4,a.memoizedState.cache)}return g0(a,b,c)}(a,b,c);gB=0!=(131072&a.flags)}else gB=!1,dF&&0!=(1048576&b.flags)&&dz(b,ds,b.index);switch(b.lanes=0,b.tag){case 16:b:{var d=b.pendingProps;if(a=ep(b.elementType),b.type=a,"function"==typeof a)de(a)?(d=gr(a,d),b.tag=1,b=gO(null,b,a,d,c)):(b.tag=0,b=gM(null,b,a,d,c));else{if(null!=a){var e=a.$$typeof;if(e===G){b.tag=11,b=gD(null,b,a,d,c);break b}if(e===J){b.tag=14,b=gE(null,b,a,d,c);break b}}throw Error(g(306,b=function a(b){if(null==b)return null;if("function"==typeof b)return b.$$typeof===R?null:b.displayName||b.name||null;if("string"==typeof b)return b;switch(b){case B:return"Fragment";case D:return"Profiler";case C:return"StrictMode";case H:return"Suspense";case I:return"SuspenseList";case L:return"Activity";case O:return"ViewTransition"}if("object"==typeof b)switch(b.$$typeof){case A:return"Portal";case F:return b.displayName||"Context";case E:return(b._context.displayName||"Context")+".Consumer";case G:var c=b.render;return(b=b.displayName)||(b=""!==(b=c.displayName||c.name||"")?"ForwardRef("+b+")":"ForwardRef"),b;case J:return null!==(c=b.displayName||null)?c:a(b.type)||"Memo";case K:c=b._payload,b=b._init;try{return a(b(c))}catch(a){}}return null}(a)||a,""))}}return b;case 0:return gM(a,b,b.type,b.pendingProps,c);case 1:return e=gr(d=b.type,b.pendingProps),gO(a,b,d,e,c);case 3:b:{if(ad(b,b.stateNode.containerInfo),null===a)throw Error(g(387));d=b.pendingProps;var f=b.memoizedState;e=f.element,eD(a,b),eK(b,d,null,c);var h=b.memoizedState;if(dT(b,d4,d=h.cache),d!==f.cache&&dW(b,[d4],c,!0),eJ(),d=h.element,f.isDehydrated)if(f={element:d,isDehydrated:!1,cache:h.cache},b.updateQueue.baseState=f,b.memoizedState=f,256&b.flags){b=gP(a,b,d,c);break b}else if(d!==e){dP(e=dn(Error(g(424)),b)),b=gP(a,b,d,c);break b}else for(dE=kG((a=9===(a=b.stateNode.containerInfo).nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a).firstChild),dD=b,dF=!0,dG=null,dH=!0,c=eA(b,null,d,c),b.child=c;c;)c.flags=-3&c.flags|4096,c=c.sibling;else{if(dN(),d===e){b=g0(a,b,c);break b}gC(a,b,d,c)}b=b.child}return b;case 26:return gL(a,b),null===a?(c=kS(b.type,null,b.pendingProps,null))?b.memoizedState=c:dF||(c=b.type,a=b.pendingProps,(d=j5(ab.current).createElement(c))[aT]=b,d[aU]=a,j1(d,c,a),a4(d),b.stateNode=d):b.memoizedState=kS(b.type,a.memoizedProps,b.pendingProps,a.memoizedState),null;case 27:return af(b),null===a&&dF&&(d=b.stateNode=kK(b.type,b.pendingProps,ab.current),dD=b,dH=!0,e=dE,kf(b.type)?(kH=e,dE=kG(d.firstChild)):dE=e),gC(a,b,b.pendingProps.children,c),gL(a,b),null===a&&(b.flags|=4194304),b.child;case 5:return null===a&&dF&&((e=d=dE)&&(null!==(d=function(a,b,c,d){for(;1===a.nodeType;){if(a.nodeName.toLowerCase()!==b.toLowerCase()){if(!d&&("INPUT"!==a.nodeName||"hidden"!==a.type))break}else if(d){if(!a[a$])switch(b){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if("stylesheet"===(e=a.getAttribute("rel"))&&a.hasAttribute("data-precedence")||e!==c.rel||a.getAttribute("href")!==(null==c.href||""===c.href?null:c.href)||a.getAttribute("crossorigin")!==(null==c.crossOrigin?null:c.crossOrigin)||a.getAttribute("title")!==(null==c.title?null:c.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(((e=a.getAttribute("src"))!==(null==c.src?null:c.src)||a.getAttribute("type")!==(null==c.type?null:c.type)||a.getAttribute("crossorigin")!==(null==c.crossOrigin?null:c.crossOrigin))&&e&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else{if("input"!==b||"hidden"!==a.type)return a;var e=null==c.name?null:""+c.name;if("hidden"===c.type&&a.getAttribute("name")===e)return a}if(null===(a=kG(a.nextSibling)))break}return null}(d,b.type,b.pendingProps,dH))?(b.stateNode=d,dD=b,dE=kG(d.firstChild),dH=!1,e=!0):e=!1),e||dJ(b)),af(b),e=b.type,f=b.pendingProps,h=null!==a?a.memoizedProps:null,d=f.children,j8(e,f)?d=null:null!==h&&j8(e,h)&&(b.flags|=32),null!==b.memoizedState&&(le._currentValue=e=fe(a,b,fh,null,null,c)),gL(a,b),gC(a,b,d,c),b.child;case 6:return null===a&&dF&&((a=c=dE)&&(null!==(c=function(a,b,c){if(""===b)return null;for(;3!==a.nodeType;)if((1!==a.nodeType||"INPUT"!==a.nodeName||"hidden"!==a.type)&&!c||null===(a=kG(a.nextSibling)))return null;return a}(c,b.pendingProps,dH))?(b.stateNode=c,dD=b,dE=null,a=!0):a=!1),a||dJ(b)),null;case 13:return gT(a,b,c);case 4:return ad(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=ez(b,null,d,c):gC(a,b,d,c),b.child;case 11:return gD(a,b,b.type,b.pendingProps,c);case 7:return d=b.pendingProps,gL(a,b),gC(a,b,d,c),b.child;case 8:case 12:return gC(a,b,b.pendingProps.children,c),b.child;case 10:return d=b.pendingProps,dT(b,b.type,d.value),gC(a,b,d.children,c),b.child;case 9:return e=b.type._context,d=b.pendingProps.children,dZ(b),d=d(e=d$(e)),b.flags|=1,gC(a,b,d,c),b.child;case 14:return gE(a,b,b.type,b.pendingProps,c);case 15:return gF(a,b,b.type,b.pendingProps,c);case 19:return g_(a,b,c);case 31:var i=a,j=b,k=c,l=j.pendingProps,m=0!=(128&j.flags);if(j.flags&=-129,null===i){if(dF){if("hidden"===l.mode)return i=gJ(j,l),j.lanes=0x20000000,gH(null,i);if(eV(j),(i=dE)?null!==(i=null!==(i=kD(i,dH))&&"&"===i.data?i:null)&&(j.memoizedState={dehydrated:i,treeContext:null!==dv?{id:dw,overflow:dx}:null,retryLane:0x20000000,hydrationErrors:null},(k=dk(i)).return=j,j.child=k,dD=j,dE=null):i=null,null===i)throw dJ(j);return j.lanes=0x20000000,null}return gJ(j,l)}var n=i.memoizedState;if(null!==n){var o=n.dehydrated;if(eV(j),m)if(256&j.flags)j.flags&=-257,j=gK(i,j,k);else if(null!==j.memoizedState)j.child=i.child,j.flags|=128,j=null;else throw Error(g(558));else if(gB||dX(i,j,k,!1),m=0!=(k&i.childLanes),gB||m){if(null!==(l=ij)&&0!==(o=aN(l,k))&&o!==n.retryLane)throw n.retryLane=o,c8(i,o),iW(l,i,o),gA;i5(),j=gK(i,j,k)}else i=n.treeContext,dE=kG(o.nextSibling),dD=j,dF=!0,dG=null,dH=!1,null!==i&&dC(j,i),j=gJ(j,l),j.flags|=4096;return j}return(i=df(i.child,{mode:l.mode,children:l.children})).ref=j.ref,j.child=i,i.return=j,i;case 22:return gG(a,b,c,b.pendingProps);case 24:return dZ(b),d=d$(d4),null===a?(null===(e=eg())&&(e=ij,f=d5(),e.pooledCache=f,f.refCount++,null!==f&&(e.pooledCacheLanes|=c),e=f),b.memoizedState={parent:d,cache:e},eC(b),dT(b,d4,e)):(0!=(a.lanes&c)&&(eD(a,b),eK(b,null,null,c),eJ()),e=a.memoizedState,f=b.memoizedState,e.parent!==d?(e={parent:d,cache:d},b.memoizedState=e,0===b.lanes&&(b.memoizedState=b.updateQueue.baseState=e),dT(b,d4,d)):(dT(b,d4,d=f.cache),d!==e.cache&&dW(b,[d4],c,!0))),gC(a,b,b.pendingProps.children,c),b.child;case 30:return null!=(d=b.pendingProps).name&&"auto"!==d.name?b.flags|=null===a?0x1202000:0x1200000:dF&&dA(b),null!==a&&a.memoizedProps.name!==d.name?b.flags|=4194816:gL(a,b),gC(a,b,d.children,c),b.child;case 29:throw b.pendingProps}throw Error(g(156,b.tag))}function g3(a){a.flags|=4}function g4(a,b,c,d,e){var f;if((f=0!=(32&a.mode))&&(f=null===c?k3(b,d):k3(b,d)&&(d.src!==c.src||d.srcSet!==c.srcSet)),f){if(a.flags|=0x1000000,(0x13ffff40&e)===e)if(a.stateNode.complete)a.flags|=8192;else if(i2())a.flags|=8192;else throw eq=em,ek}else a.flags&=-0x1000001}function g5(a,b){if("stylesheet"!==b.type||0!=(4&b.state.loading))a.flags&=-0x1000001;else if(a.flags|=0x1000000,!k4(b))if(i2())a.flags|=8192;else throw eq=em,ek}function g6(a,b){null!==b&&(a.flags|=4),16384&a.flags&&(b=22!==a.tag?aI():0x20000000,a.lanes|=b,iy|=b)}function g7(a,b){if(!dF)switch(a.tailMode){case"visible":break;case"collapsed":for(var c=a.tail,d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null;break;default:for(c=null,b=a.tail;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null}}function g8(a){var b=null!==a.alternate&&a.alternate.child===a.child,c=0,d=0;if(b)for(var e=a.child;null!==e;)c|=e.lanes|e.childLanes,d|=0x7e00000&e.subtreeFlags,d|=0x7e00000&e.flags,e.return=a,e=e.sibling;else for(e=a.child;null!==e;)c|=e.lanes|e.childLanes,d|=e.subtreeFlags,d|=e.flags,e.return=a,e=e.sibling;return a.subtreeFlags|=d,a.childLanes=c,b}function g9(a,b){switch(dB(b),b.tag){case 3:dU(d4),ae();break;case 26:case 27:case 5:ag(b);break;case 4:ae();break;case 31:null!==b.memoizedState&&eY(b);break;case 13:eY(b);break;case 19:e_(b);break;case 10:dU(b.type);break;case 22:case 23:eY(b),eR(),null!==a&&Z(ef);break;case 24:dU(d4)}}function ha(a,b){try{var c=b.updateQueue,d=null!==c?c.lastEffect:null;if(null!==d){var e=d.next;c=e;do{if((c.tag&a)===a){d=void 0;var f=c.create;c.inst.destroy=d=f()}c=c.next}while(c!==e)}}catch(a){jm(b,b.return,a)}}function hb(a,b,c){try{var d=b.updateQueue,e=null!==d?d.lastEffect:null;if(null!==e){var f=e.next;d=f;do{if((d.tag&a)===a){var g=d.inst,h=g.destroy;if(void 0!==h){g.destroy=void 0,e=b;try{h()}catch(a){jm(e,c,a)}}}d=d.next}while(d!==f)}}catch(a){jm(b,b.return,a)}}function hc(a){var b=a.updateQueue;if(null!==b){var c=a.stateNode;try{eM(b,c)}catch(b){jm(a,a.return,b)}}}function hd(a,b,c){c.props=gr(a.type,a.memoizedProps),c.state=a.memoizedState;try{c.componentWillUnmount()}catch(c){jm(a,b,c)}}function he(a,b){try{var c=a.ref;if(null!==c){switch(a.tag){case 26:case 27:case 5:var d=a.stateNode;break;case 30:var e=a.stateNode,f=c$(a.memoizedProps,e);(null===e.ref||e.ref.name!==f)&&(e.ref=kp(f)),d=e.ref;break;case 7:null===a.stateNode&&(a.stateNode=new kq(a)),d=a.stateNode;break;default:d=a.stateNode}"function"==typeof c?a.refCleanup=c(d):c.current=d}}catch(c){jm(a,b,c)}}function hf(a,b){var c=a.ref,d=a.refCleanup;if(null!==c)if("function"==typeof d)try{d()}catch(c){jm(a,b,c)}finally{a.refCleanup=null,null!=(a=a.alternate)&&(a.refCleanup=null)}else if("function"==typeof c)try{c(null)}catch(c){jm(a,b,c)}else c.current=null}function hg(a){var b=a.type,c=a.memoizedProps,d=a.stateNode;try{switch(b){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(b){jm(a,a.return,b)}}function hh(a,b,c){try{var d=a.stateNode;(function(a,b,c,d){switch(b){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var e=null,f=null,h=null,i=null,j=null,k=null,l=null;for(o in c){var m=c[o];if(c.hasOwnProperty(o)&&null!=m)switch(o){case"checked":case"value":break;case"defaultValue":j=m;default:d.hasOwnProperty(o)||j_(a,b,o,null,d,m)}}for(var n in d){var o=d[n];if(m=c[n],d.hasOwnProperty(n)&&(null!=o||null!=m))switch(n){case"type":o!==m&&(bc=!0),f=o;break;case"name":o!==m&&(bc=!0),e=o;break;case"checked":o!==m&&(bc=!0),k=o;break;case"defaultChecked":o!==m&&(bc=!0),l=o;break;case"value":o!==m&&(bc=!0),h=o;break;case"defaultValue":o!==m&&(bc=!0),i=o;break;case"children":case"dangerouslySetInnerHTML":if(null!=o)throw Error(g(137,b));break;default:o!==m&&j_(a,b,n,o,d,m)}}bo(a,h,i,j,k,l,f,e);return;case"select":for(f in o=h=i=n=null,c)if(j=c[f],c.hasOwnProperty(f)&&null!=j)switch(f){case"value":break;case"multiple":o=j;default:d.hasOwnProperty(f)||j_(a,b,f,null,d,j)}for(e in d)if(f=d[e],j=c[e],d.hasOwnProperty(e)&&(null!=f||null!=j))switch(e){case"value":f!==j&&(bc=!0),n=f;break;case"defaultValue":f!==j&&(bc=!0),i=f;break;case"multiple":f!==j&&(bc=!0),h=f;default:f!==j&&j_(a,b,e,f,d,j)}b=i,c=h,d=o,null!=n?br(a,!!c,n,!1):!!d!=!!c&&(null!=b?br(a,!!c,b,!0):br(a,!!c,c?[]:"",!1));return;case"textarea":for(i in o=n=null,c)if(e=c[i],c.hasOwnProperty(i)&&null!=e&&!d.hasOwnProperty(i))switch(i){case"value":case"children":break;default:j_(a,b,i,null,d,e)}for(h in d)if(e=d[h],f=c[h],d.hasOwnProperty(h)&&(null!=e||null!=f))switch(h){case"value":e!==f&&(bc=!0),n=e;break;case"defaultValue":e!==f&&(bc=!0),o=e;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=e)throw Error(g(91));break;default:e!==f&&j_(a,b,h,e,d,f)}bs(a,n,o);return;case"option":for(var p in c)n=c[p],c.hasOwnProperty(p)&&null!=n&&!d.hasOwnProperty(p)&&("selected"===p?a.selected=!1:j_(a,b,p,null,d,n));for(j in d)n=d[j],o=c[j],d.hasOwnProperty(j)&&n!==o&&(null!=n||null!=o)&&("selected"===j?(n!==o&&(bc=!0),a.selected=n&&"function"!=typeof n&&"symbol"!=typeof n):j_(a,b,j,n,d,o));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var q in c)n=c[q],c.hasOwnProperty(q)&&null!=n&&!d.hasOwnProperty(q)&&j_(a,b,q,null,d,n);for(k in d)if(n=d[k],o=c[k],d.hasOwnProperty(k)&&n!==o&&(null!=n||null!=o))switch(k){case"children":case"dangerouslySetInnerHTML":if(null!=n)throw Error(g(137,b));break;default:j_(a,b,k,n,d,o)}return;default:if(by(b)){for(var r in c)n=c[r],c.hasOwnProperty(r)&&void 0!==n&&!d.hasOwnProperty(r)&&j0(a,b,r,void 0,d,n);for(l in d)n=d[l],o=c[l],d.hasOwnProperty(l)&&n!==o&&(void 0!==n||void 0!==o)&&j0(a,b,l,n,d,o);return}}for(var s in c)n=c[s],c.hasOwnProperty(s)&&null!=n&&!d.hasOwnProperty(s)&&j_(a,b,s,null,d,n);for(m in d)n=d[m],o=c[m],d.hasOwnProperty(m)&&n!==o&&(null!=n||null!=o)&&j_(a,b,m,n,d,o)})(d,a.type,c,b),d[aU]=b}catch(b){jm(a,a.return,b)}}function hi(a,b){if(5===a.tag&&null===a.alternate&&null!==b)for(var c=0;c<b.length;c++)kB(a.stateNode,b[c])}function hj(a){for(var b=a.return;null!==b;){if(hl(b)){var c=a.stateNode,d=b.stateNode._eventListeners;if(null!==d)for(var e=0;e<d.length;e++){var f=d[e];c.removeEventListener(f.type,f.listener,f.optionsOrUseCapture)}}if(hk(b))break;b=b.return}}function hk(a){return 5===a.tag||3===a.tag||26===a.tag||27===a.tag&&kf(a.type)||4===a.tag}function hl(a){return a&&7===a.tag&&null!==a.stateNode}function hm(a){b:for(;;){for(;null===a.sibling;){if(null===a.return||hk(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;5!==a.tag&&6!==a.tag&&18!==a.tag;){if(27===a.tag&&kf(a.type)||2&a.flags||null===a.child||4===a.tag)continue b;a.child.return=a,a=a.child}if(!(2&a.flags))return a.stateNode}}function hn(a,b,c,d){var e=a.tag;if(5===e||6===e)e=a.stateNode,b?c.insertBefore(e,b):c.appendChild(e),hi(a,d),bc=!0;else if(4!==e&&(27===e&&kf(a.type)&&(c=a.stateNode),null!==(a=a.child)))for(hn(a,b,c,d),a=a.sibling;null!==a;)hn(a,b,c,d),a=a.sibling}function ho(a){var b=a.stateNode,c=a.memoizedProps;try{for(var d=a.type,e=b.attributes;e.length;)b.removeAttributeNode(e[0]);j1(b,d,c),b[aT]=a,b[aU]=c}catch(b){jm(a,a.return,b)}}var hp=!1,hq=null;function hr(a){(30===a.tag||0!=(0x2000000&a.subtreeFlags))&&(hp=!0)}var hs=null;function ht(){var a=hs;return hs=null,a}var hu=0;function hv(a,b,c,d,e){return hu=0,function a(b,c,d,e,f){for(var g=!1;null!==b;){if(5===b.tag){var h=b.stateNode;if(null!==e){var i=kl(h);e.push(i),i.view&&(g=!0)}else g||kl(h).view&&(g=!0);hp=!0,ki(h,0===hu?c:c+"_"+hu,d),hu++}else(22!==b.tag||null===b.memoizedState)&&(30===b.tag&&f||a(b.child,c,d,e,f)&&(g=!0));b=b.sibling}return g}(a.child,b,c,d,e)}function hw(a,b){for(;null!==a;)5===a.tag?kj(a.stateNode,a.memoizedProps):(22!==a.tag||null===a.memoizedState)&&(30===a.tag&&b||hw(a.child,b)),a=a.sibling}function hx(a){if(0!=(0x1200000&a.subtreeFlags))for(a=a.child;null!==a;){if((22!==a.tag||null===a.memoizedState)&&(hx(a),30===a.tag&&0!=(0x1200000&a.flags)&&a.stateNode.paired)){var b=a.memoizedProps;if(null==b.name||"auto"===b.name)throw Error(g(544));var c=b.name;"none"!==(b=c0(b.default,b.share))&&(hv(a,c,b,null,!1)||hw(a.child,!1))}a=a.sibling}}function hy(a,b){if(30===a.tag){var c=a.stateNode,d=a.memoizedProps,e=c$(d,c),f=c0(d.default,c.paired?d.share:d.enter);"none"!==f?hv(a,e,f,null,!1)?(hx(a),c.paired||b||iV(a,d.onEnter)):hw(a.child,!1):hx(a)}else if(0!=(0x2000000&a.subtreeFlags))for(a=a.child;null!==a;)hy(a,b),a=a.sibling;else hx(a)}function hz(a){if(null!==hq&&0!==hq.size){var b=hq;if(0!=(0x1200000&a.subtreeFlags))for(a=a.child;null!==a;){if(22!==a.tag||null===a.memoizedState){if(30===a.tag&&0!=(0x1200000&a.flags)){var c=a.memoizedProps,d=c.name;if(null!=d&&"auto"!==d){var e=b.get(d);if(void 0!==e){var f=c0(c.default,c.share);if("none"!==f&&(hv(a,d,f,null,!1)?(e.paired=f=a.stateNode,f.paired=e,iV(a,c.onShare)):hw(a.child,!1)),b.delete(d),0===b.size)break}}}hz(a)}a=a.sibling}}}function hA(a){if(30===a.tag){var b=a.memoizedProps,c=c$(b,a.stateNode),d=null!==hq?hq.get(c):void 0,e=c0(b.default,void 0!==d?b.share:b.exit);"none"!==e&&(hv(a,c,e,null,!1)?void 0!==d?(d.paired=e=a.stateNode,e.paired=d,hq.delete(c),iV(a,b.onShare)):iV(a,b.onExit):hw(a.child,!1)),null!==hq&&hz(a)}else if(0!=(0x2000000&a.subtreeFlags))for(a=a.child;null!==a;)hA(a),a=a.sibling;else null!==hq&&hz(a)}function hB(a){if(0!=(0x1200000&a.subtreeFlags))for(a=a.child;null!==a;){if(22!==a.tag||null===a.memoizedState){if(30===a.tag&&0!=(0x1200000&a.flags)){var b=a.stateNode;null!==b.paired&&(b.paired=null,hw(a.child,!1))}hB(a)}a=a.sibling}}function hC(a){if(30===a.tag)a.stateNode.paired=null,hw(a.child,!1),hB(a);else if(0!=(0x2000000&a.subtreeFlags))for(a=a.child;null!==a;)hC(a),a=a.sibling;else hB(a)}function hD(a,b,c,d,e,f,g){for(var h=!1;null!==b;){if(5===b.tag){var i=b.stateNode;if(null!==f&&hu<f.length){var j,k=f[hu],l=kl(i);if((k.view||l.view)&&(h=!0),j=0==(4&a.flags))if(l.clip)j=!0;else{j=k.rect;var m=l.rect;j=j.y!==m.y||j.x!==m.x||j.height!==m.height||j.width!==m.width}j&&(a.flags|=4),l.abs?l=!k.abs:(k=k.rect,l=l.rect,l=k.height!==l.height||k.width!==l.width),l&&(a.flags|=32)}else a.flags|=32;0!=(4&a.flags)&&ki(i,0===hu?c:c+"_"+hu,e),h&&0!=(4&a.flags)||(null===hs&&(hs=[]),hs.push(i,d,b.memoizedProps)),hu++}else(22!==b.tag||null===b.memoizedState)&&(30===b.tag&&g?a.flags|=32&b.flags:hD(a,b.child,c,d,e,f,g)&&(h=!0));b=b.sibling}return h}var hE=!1,hF=!1,hG=!1,hH=!1,hI="function"==typeof WeakSet?WeakSet:Set,hJ=null,hK=!1,hL=!1,hM=!1,hN=!1;function hO(a){for(;null!==hJ;){var b=hJ,c=a,d=b.alternate,e=b.flags;switch(b.tag){case 0:case 11:case 15:if(0!=(4&e)&&null!==(d=null!==(d=b.updateQueue)?d.events:null))for(c=0;c<d.length;c++)(e=d[c]).ref.impl=e.nextImpl;break;case 1:if(0!=(1024&e)&&null!==d){c=void 0,e=d.memoizedProps,d=d.memoizedState;var f=b.stateNode;try{var h=gr(b.type,e);c=f.getSnapshotBeforeUpdate(h,d),f.__reactInternalSnapshotBeforeUpdate=c}catch(a){jm(b,b.return,a)}}break;case 3:if(0!=(1024&e)){if(9===(c=(d=b.stateNode.containerInfo).nodeType))kC(d);else if(1===c)switch(d.nodeName){case"HEAD":case"HTML":case"BODY":kC(d);break;default:d.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;case 30:c&&null!==d&&(c=c$(d.memoizedProps,d.stateNode),"none"!==(e=c0((e=b.memoizedProps).default,e.update))&&hv(d,c,e,d.memoizedState=[],!0));break;default:if(0!=(1024&e))throw Error(g(163))}if(null!==(d=b.sibling)){d.return=b.return,hJ=d;break}hJ=b.return}}function hP(a,b,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:h2(a,c),4&d&&ha(5,c);break;case 1:if(h2(a,c),4&d)if(a=c.stateNode,null===b)try{a.componentDidMount()}catch(a){jm(c,c.return,a)}else{var e=gr(c.type,b.memoizedProps);b=b.memoizedState;try{a.componentDidUpdate(e,b,a.__reactInternalSnapshotBeforeUpdate)}catch(a){jm(c,c.return,a)}}64&d&&hc(c),512&d&&he(c,c.return);break;case 3:if(h2(a,c),64&d&&null!==(a=c.updateQueue)){if(b=null,null!==c.child)switch(c.child.tag){case 27:case 5:case 1:b=c.child.stateNode}try{eM(a,b)}catch(a){jm(c,c.return,a)}}break;case 27:null===b&&4&d&&ho(c);case 26:case 5:h2(a,c),null===b&&4&d&&hg(c),512&d&&he(c,c.return);break;case 12:h2(a,c);break;case 31:h2(a,c),4&d&&hV(a,c);break;case 13:h2(a,c),4&d&&hW(a,c),64&d&&null!==(a=c.memoizedState)&&null!==(a=a.dehydrated)&&function(a,b){var c=a.ownerDocument;if("$~"===a.data)a._reactRetry=b;else if("$?"!==a.data||"loading"!==c.readyState)b();else{var d=function(){b(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),a._reactRetry=d}}(a,c=jq.bind(null,c));break;case 22:if(!(d=null!==c.memoizedState||hE)){b=null!==b&&null!==b.memoizedState||hF,e=hE;var f=hF;hE=d,(hF=b)&&!f?function a(b,c,d){for(d=d&&0!=(8772&c.subtreeFlags),c=c.child;null!==c;){var e=c.alternate,f=b,g=c,h=g.flags;switch(g.tag){case 0:case 11:case 15:a(f,g,d),ha(4,g);break;case 1:if(a(f,g,d),"function"==typeof(f=(e=g).stateNode).componentDidMount)try{f.componentDidMount()}catch(a){jm(e,e.return,a)}if(null!==(f=(e=g).updateQueue)){var i=e.stateNode;try{var j=f.shared.hiddenCallbacks;if(null!==j)for(f.shared.hiddenCallbacks=null,f=0;f<j.length;f++)eL(j[f],i)}catch(a){jm(e,e.return,a)}}d&&64&h&&hc(g),he(g,g.return);break;case 27:ho(g);case 26:case 5:if(5===g.tag){i=g;for(var k=i.return;null!==k&&(hl(k)&&kB(i.stateNode,k.stateNode),!hk(k));)k=k.return}a(f,g,d),d&&null===e&&4&h&&hg(g),he(g,g.return);break;case 12:a(f,g,d);break;case 31:a(f,g,d),d&&4&h&&hV(f,g);break;case 13:a(f,g,d),d&&4&h&&hW(f,g);break;case 22:null===g.memoizedState&&a(f,g,d),he(g,g.return);break;case 30:a(f,g,d),he(g,g.return);break;case 7:he(g,g.return);default:a(f,g,d)}c=c.sibling}}(a,c,0!=(8772&c.subtreeFlags)):h2(a,c),hE=e,hF=f}break;case 30:h2(a,c),512&d&&he(c,c.return);break;case 7:512&d&&he(c,c.return);default:h2(a,c)}}function hQ(a,b){for(a=a.child;null!==a;)(function a(b,c){switch(b.tag){case 5:case 26:try{var d=b.stateNode;if(c){var e=d.style;"function"==typeof e.setProperty?e.setProperty("display","none","important"):e.display="none"}else{var f=b.stateNode,g=b.memoizedProps.style,h=null!=g&&g.hasOwnProperty("display")?g.display:null;f.style.display=null==h||"boolean"==typeof h?"":(""+h).trim()}}catch(a){jm(b,b.return,a)}!function b(c,d){if(0x4000000&c.subtreeFlags)for(c=c.child;null!==c;){b:{var e=c;switch(e.tag){case 4:a(e,d);break b;case 22:null===e.memoizedState&&b(e,d);break b;default:b(e,d)}}c=c.sibling}}(b,c);break;case 6:try{b.stateNode.nodeValue=c?"":b.memoizedProps,bc=!0}catch(a){jm(b,b.return,a)}break;case 18:try{var i=b.stateNode;c?kh(i,!0):kh(b.stateNode,!1)}catch(a){jm(b,b.return,a)}break;case 22:case 23:null===b.memoizedState&&hQ(b,c);break;default:hQ(b,c)}})(a,b),a=a.sibling}var hR=null,hS=!1;function hT(a,b,c){for(c=c.child;null!==c;)hU(a,b,c),c=c.sibling}function hU(a,b,c){if(ay&&"function"==typeof ay.onCommitFiberUnmount)try{ay.onCommitFiberUnmount(ax,c)}catch(a){}switch(c.tag){case 26:hF||hf(c,b),hT(a,b,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode).parentNode.removeChild(c);break;case 27:hF||hf(c,b);var d=hR,e=hS;kf(c.type)&&(hR=c.stateNode,hS=!1),hT(a,b,c),kL(c.stateNode),hR=d,hS=e;break;case 5:hF||hf(c,b),5===c.tag&&hj(c);case 6:if(d=hR,e=hS,hR=null,hT(a,b,c),hR=d,hS=e,null!==hR)if(hS)try{(9===hR.nodeType?hR.body:"HTML"===hR.nodeName?hR.ownerDocument.body:hR).removeChild(c.stateNode),bc=!0}catch(a){jm(c,b,a)}else try{hR.removeChild(c.stateNode),bc=!0}catch(a){jm(c,b,a)}break;case 18:null!==hR&&(hS?(kg(9===(a=hR).nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a,c.stateNode),lL(a)):kg(hR,c.stateNode));break;case 4:d=hR,e=hS,hR=c.stateNode.containerInfo,hS=!0,hT(a,b,c),hR=d,hS=e;break;case 0:case 11:case 14:case 15:hb(2,c,b),hF||hb(4,c,b),hT(a,b,c);break;case 1:hF||(hf(c,b),"function"==typeof(d=c.stateNode).componentWillUnmount&&hd(c,b,d)),hT(a,b,c);break;case 21:default:hT(a,b,c);break;case 22:hF=(d=hF)||null!==c.memoizedState,hT(a,b,c),hF=d;break;case 30:hf(c,b),hT(a,b,c);break;case 7:hF||hf(c,b),hT(a,b,c)}}function hV(a,b){if(null===b.memoizedState&&null!==(a=b.alternate)&&null!==(a=a.memoizedState)){a=a.dehydrated;try{lL(a)}catch(a){jm(b,b.return,a)}}}function hW(a,b){if(null===b.memoizedState&&null!==(a=b.alternate)&&null!==(a=a.memoizedState)&&null!==(a=a.dehydrated))try{lL(a)}catch(a){jm(b,b.return,a)}}function hX(a,b){var c=function(a){switch(a.tag){case 31:case 13:case 19:var b=a.stateNode;return null===b&&(b=a.stateNode=new hI),b;case 22:return null===(b=(a=a.stateNode)._retryCache)&&(b=a._retryCache=new hI),b;default:throw Error(g(435,a.tag))}}(a);b.forEach(function(b){if(!c.has(b)){c.add(b);var d=jr.bind(null,a,b);b.then(d,d)}})}function hY(a,b,c){var d=b.deletions;if(null!==d)for(var e=0;e<d.length;e++){var f=d[e],h=a,i=b,j=i;b:for(;null!==j;){switch(j.tag){case 27:if(kf(j.type)){hR=j.stateNode,hS=!1;break b}break;case 5:hR=j.stateNode,hS=!1;break b;case 3:case 4:hR=j.stateNode.containerInfo,hS=!0;break b}j=j.return}if(null===hR)throw Error(g(160));hU(h,i,f),hR=null,hS=!1,null!==(h=f.alternate)&&(h.return=null),f.return=null}if(13886&b.subtreeFlags)for(b=b.child;null!==b;)h$(b,a,c),b=b.sibling}var hZ=null;function h$(a,b,c){var d=a.alternate,e=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:hY(b,a,c),h_(a),4&e&&(hb(3,a,a.return),ha(3,a),hb(5,a,a.return));break;case 1:hY(b,a,c),h_(a),512&e&&(hF||null===d||hf(d,d.return)),64&e&&hE&&null!==(a=a.updateQueue)&&null!==(d=a.callbacks)&&(b=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=null===b?d:b.concat(d));break;case 26:var f=hZ;if(hY(b,a,c),h_(a),512&e&&(hF||null===d||hf(d,d.return)),4&e)if(c=null!==d?d.memoizedState:null,b=a.memoizedState,null===d)if(null===b)if(null===a.stateNode){b:{d=a.type,b=a.memoizedProps,c=f.ownerDocument||f;c:switch(d){case"title":(!(e=c.getElementsByTagName("title")[0])||e[a$]||e[aT]||"http://www.w3.org/2000/svg"===e.namespaceURI||e.hasAttribute("itemprop"))&&(e=c.createElement(d),c.head.insertBefore(e,c.querySelector("head > title"))),j1(e,d,b),e[aT]=a,a4(e),d=e;break b;case"link":if(f=k1("link","href",c).get(d+(b.href||""))){for(var h=0;h<f.length;h++)if((e=f[h]).getAttribute("href")===(null==b.href||""===b.href?null:b.href)&&e.getAttribute("rel")===(null==b.rel?null:b.rel)&&e.getAttribute("title")===(null==b.title?null:b.title)&&e.getAttribute("crossorigin")===(null==b.crossOrigin?null:b.crossOrigin)){f.splice(h,1);break c}}j1(e=c.createElement(d),d,b),c.head.appendChild(e);break;case"meta":if(f=k1("meta","content",c).get(d+(b.content||""))){for(h=0;h<f.length;h++)if((e=f[h]).getAttribute("content")===(null==b.content?null:""+b.content)&&e.getAttribute("name")===(null==b.name?null:b.name)&&e.getAttribute("property")===(null==b.property?null:b.property)&&e.getAttribute("http-equiv")===(null==b.httpEquiv?null:b.httpEquiv)&&e.getAttribute("charset")===(null==b.charSet?null:b.charSet)){f.splice(h,1);break c}}j1(e=c.createElement(d),d,b),c.head.appendChild(e);break;default:throw Error(g(468,d))}e[aT]=a,a4(e),d=e}a.stateNode=d}else k2(f,a.type,a.stateNode);else a.stateNode=kY(f,b,a.memoizedProps);else c!==b?(null===c?null!==d.stateNode&&(d=d.stateNode).parentNode.removeChild(d):c.count--,null===b?k2(f,a.type,a.stateNode):kY(f,b,a.memoizedProps)):null===b&&null!==a.stateNode&&hh(a,a.memoizedProps,d.memoizedProps);break;case 27:hY(b,a,c),h_(a),512&e&&(hF||null===d||hf(d,d.return)),null!==d&&4&e&&hh(a,a.memoizedProps,d.memoizedProps);break;case 5:if(f=hG,hG=!1,hY(b,a,c),hG=f,h_(a),512&e&&(hF||null===d||hf(d,d.return)),32&a.flags){b=a.stateNode;try{bu(b,""),bc=!0}catch(b){jm(a,a.return,b)}}4&e&&null!=a.stateNode&&(b=a.memoizedProps,hh(a,b,null!==d?d.memoizedProps:b)),1024&e&&(hH=!0);break;case 6:if(hY(b,a,c),h_(a),4&e){if(null===a.stateNode)throw Error(g(162));d=a.memoizedProps,b=a.stateNode;try{b.nodeValue=d,bc=!0}catch(b){jm(a,a.return,b)}}break;case 3:if(bc=!1,k0=null,f=hZ,hZ=kO(b.containerInfo),hY(b,a,c),hZ=f,h_(a),4&e&&null!==d&&d.memoizedState.isDehydrated)try{lL(b.containerInfo)}catch(b){jm(a,a.return,b)}hH&&(hH=!1,function a(b){if(1024&b.subtreeFlags)for(b=b.child;null!==b;){var c=b;a(c),5===c.tag&&1024&c.flags&&c.stateNode.reset(),b=b.sibling}}(a)),bc=!1;break;case 4:d=hG,hG=hE,e=bd(),f=hZ,hZ=kO(a.stateNode.containerInfo),hY(b,a,c),h_(a),hZ=f,bc&&hL&&(hM=!0),bc=e,hG=d;break;case 12:hY(b,a,c),h_(a);break;case 31:case 19:hY(b,a,c),h_(a),4&e&&null!==(d=a.updateQueue)&&(a.updateQueue=null,hX(a,d));break;case 13:hY(b,a,c),h_(a),8192&a.child.flags&&null!==a.memoizedState!=(null!==d&&null!==d.memoizedState)&&(iC=aq()),4&e&&null!==(d=a.updateQueue)&&(a.updateQueue=null,hX(a,d));break;case 22:f=null!==a.memoizedState,h=null!==d&&null!==d.memoizedState;var i=hE,j=hF,k=hG;hE=i||f,hG=k||f,hF=j||h,hY(b,a,c),hF=j,hG=k,hE=i,h_(a),8192&e&&((b=a.stateNode)._visibility=f?-2&b._visibility:1|b._visibility,f&&(null===d||h||hE||hF||function a(b){for(b=b.child;null!==b;){var c=b;switch(c.tag){case 0:case 11:case 14:case 15:hb(4,c,c.return),a(c);break;case 1:hf(c,c.return);var d=c.stateNode;"function"==typeof d.componentWillUnmount&&hd(c,c.return,d),a(c);break;case 27:kL(c.stateNode);case 26:case 5:hf(c,c.return),5===c.tag&&hj(c),a(c);break;case 22:null===c.memoizedState&&a(c);break;case 30:hf(c,c.return),a(c);break;case 7:hf(c,c.return);default:a(c)}b=b.sibling}}(a)),!f&&hG||hQ(a,f)),4&e&&null!==(d=a.updateQueue)&&null!==(b=d.retryQueue)&&(d.retryQueue=null,hX(a,b));break;case 30:512&e&&(hF||null===d||hf(d,d.return)),e=bd(),f=hL,h=(0x13ffff00&c)===c,i=a.memoizedProps,hL=h&&"none"!==c0(i.default,i.update),hY(b,a,c),h_(a),h&&null!==d&&bc&&(a.flags|=4),hL=f,bc=e;break;case 21:break;case 7:d&&null!==d.stateNode&&(d.stateNode._fragmentFiber=a);default:hY(b,a,c),h_(a)}}function h_(a){var b=a.flags;if(2&b){try{for(var c,d=null,e=a.return;null!==e;){if(hl(e)){var f=e.stateNode;null===d?d=[f]:d.push(f)}if(hk(e)){c=e;break}e=e.return}if(null==c)throw Error(g(160));switch(c.tag){case 27:var h=c.stateNode,i=hm(a);hn(a,i,h,d);break;case 5:var j=c.stateNode;32&c.flags&&(bu(j,""),c.flags&=-33);var k=hm(a);hn(a,k,j,d);break;case 3:case 4:var l=c.stateNode.containerInfo,m=hm(a);!function a(b,c,d,e){var f=b.tag;if(5===f||6===f)f=b.stateNode,c?(9===d.nodeType?d.body:"HTML"===d.nodeName?d.ownerDocument.body:d).insertBefore(f,c):((c=9===d.nodeType?d.body:"HTML"===d.nodeName?d.ownerDocument.body:d).appendChild(f),null!=(d=d._reactRootContainer)||null!==c.onclick||(c.onclick=bC)),hi(b,e),bc=!0;else if(4!==f&&(27===f&&kf(b.type)&&(d=b.stateNode,c=null),null!==(b=b.child)))for(a(b,c,d,e),b=b.sibling;null!==b;)a(b,c,d,e),b=b.sibling}(a,m,l,d);break;default:throw Error(g(161))}}catch(b){jm(a,a.return,b)}a.flags&=-3}4096&b&&(a.flags&=-4097)}function h0(a,b){if(9270&b.subtreeFlags)for(b=b.child;null!==b;)h1(b,a),b=b.sibling;else!function a(b,c){for(b=b.child;null!==b;){if(30===b.tag){var d=b.memoizedProps,e=b.stateNode,f=c$(d,e),g=c0(d.default,d.update);if(c)var h=null===(e=e.clones)?null:e.map(km);else h=b.memoizedState,b.memoizedState=null;e=b;var i=b.child;hu=0,f=hD(e,i,f,f,g,h,!1),0!=(4&b.flags)&&f&&(c||iV(b,d.onUpdate))}else 0!=(0x2000000&b.subtreeFlags)&&a(b,c);b=b.sibling}}(b,!1)}function h1(a,b){var c=a.alternate;if(null===c)hy(a,!1);else switch(a.tag){case 3:if(hN=hK=!1,ht(),h0(b,a),!hK&&!hM){if(null!==(a=hs))for(var d=0;d<a.length;d+=3){c=a[d];var e=a[d+1];kj(c,a[d+2]),null!==(c=c.ownerDocument.documentElement)&&c.animate({opacity:[0,0],pointerEvents:["none","none"]},{duration:0,fill:"forwards",pseudoElement:"::view-transition-group("+e+")"})}null!==(a=9===(a=b.containerInfo).nodeType?a.documentElement:a.ownerDocument.documentElement)&&""===a.style.viewTransitionName&&(a.style.viewTransitionName="none",a.animate({opacity:[0,0],pointerEvents:["none","none"]},{duration:0,fill:"forwards",pseudoElement:"::view-transition-group(root)"}),a.animate({width:[0,0],height:[0,0]},{duration:0,fill:"forwards",pseudoElement:"::view-transition"})),hN=!0}hs=null;break;case 5:default:h0(b,a);break;case 4:d=hK,hK=!1,h0(b,a),hK&&(hM=!0),hK=d;break;case 22:null===a.memoizedState&&(null!==c.memoizedState?hy(a,!1):h0(b,a));break;case 30:d=hK,e=ht(),hK=!1,h0(b,a),hK&&(a.flags|=4);var f=a.memoizedProps,g=a.stateNode;b=c$(f,g),g=c$(c.memoizedProps,g);var h=c0(f.default,f.update);"none"===h?b=!1:(f=c.memoizedState,c.memoizedState=null,c=a.child,hu=0,b=hD(a,c,b,g,h,f,!0),hu!==(null===f?0:f.length)&&(a.flags|=32)),0!=(4&a.flags)&&b?(iV(a,a.memoizedProps.onUpdate),hs=e):null!==e&&(e.push.apply(e,hs),hs=e),hK=0!=(32&a.flags)||d}}function h2(a,b){if(8772&b.subtreeFlags)for(b=b.child;null!==b;)hP(a,b.alternate,b),b=b.sibling}function h3(a,b){var c=null;null!==a&&null!==a.memoizedState&&null!==a.memoizedState.cachePool&&(c=a.memoizedState.cachePool.pool),a=null,null!==b.memoizedState&&null!==b.memoizedState.cachePool&&(a=b.memoizedState.cachePool.pool),a!==c&&(null!=a&&a.refCount++,null!=c&&d6(c))}function h4(a,b){a=null,null!==b.alternate&&(a=b.alternate.memoizedState.cache),(b=b.memoizedState.cache)!==a&&(b.refCount++,null!=a&&d6(a))}function h5(a,b,c,d){var e=(0x13ffff00&c)===c;if(b.subtreeFlags&(e?10262:10256))for(b=b.child;null!==b;)h6(a,b,c,d),b=b.sibling;else e&&function a(b){for(b=b.child;null!==b;)30===b.tag?hw(b.child,!1):0!=(0x2000000&b.subtreeFlags)&&a(b),b=b.sibling}(b)}function h6(a,b,c,d){var e=(0x13ffff00&c)===c;e&&null===b.alternate&&null!==b.return&&null!==b.return.alternate&&hC(b);var f=b.flags;switch(b.tag){case 0:case 11:case 15:h5(a,b,c,d),2048&f&&ha(9,b);break;case 1:case 31:case 13:default:h5(a,b,c,d);break;case 3:h5(a,b,c,d),e&&hN&&("root"===(a=9===(a=a.containerInfo).nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a).style.viewTransitionName&&(a.style.viewTransitionName=""),null!==(a=a.ownerDocument.documentElement)&&"none"===a.style.viewTransitionName&&(a.style.viewTransitionName="")),2048&f&&(f=null,null!==b.alternate&&(f=b.alternate.memoizedState.cache),(b=b.memoizedState.cache)!==f&&(b.refCount++,null!=f&&d6(f)));break;case 12:if(2048&f){h5(a,b,c,d),f=b.stateNode;try{var g=b.memoizedProps,h=g.id,i=g.onPostCommit;"function"==typeof i&&i(h,null===b.alternate?"mount":"update",f.passiveEffectDuration,-0)}catch(a){jm(b,b.return,a)}}else h5(a,b,c,d);break;case 23:break;case 22:g=b.stateNode,h=b.alternate,null!==b.memoizedState?(e&&null!==h&&null===h.memoizedState&&hC(h),2&g._visibility?h5(a,b,c,d):h7(a,b)):(e&&null!==h&&null!==h.memoizedState&&hC(b),2&g._visibility?h5(a,b,c,d):(g._visibility|=2,function a(b,c,d,e,f){for(f=f&&0!=(10256&c.subtreeFlags),c=c.child;null!==c;){var g=c,h=g.flags;switch(g.tag){case 0:case 11:case 15:a(b,g,d,e,f),ha(8,g);break;case 23:break;case 22:var i=g.stateNode;null!==g.memoizedState?2&i._visibility?a(b,g,d,e,f):h7(b,g):(i._visibility|=2,a(b,g,d,e,f)),f&&2048&h&&h3(g.alternate,g);break;case 24:a(b,g,d,e,f),f&&2048&h&&h4(g.alternate,g);break;default:a(b,g,d,e,f)}c=c.sibling}}(a,b,c,d,0!=(10256&b.subtreeFlags)))),2048&f&&h3(h,b);break;case 24:h5(a,b,c,d),2048&f&&h4(b.alternate,b);break;case 30:e&&null!==(f=b.alternate)&&(hw(f.child,!0),hw(b.child,!0)),h5(a,b,c,d)}}function h7(a,b){if(10256&b.subtreeFlags)for(b=b.child;null!==b;){var c=b,d=c.flags;switch(c.tag){case 22:h7(a,c),2048&d&&h3(c.alternate,c);break;case 24:h7(a,c),2048&d&&h4(c.alternate,c);break;default:h7(a,c)}b=b.sibling}}var h8=8192;function h9(a,b,c){if(a.subtreeFlags&h8)for(a=a.child;null!==a;)ia(a,b,c),a=a.sibling}function ia(a,b,c){switch(a.tag){case 26:h9(a,b,c),a.flags&h8&&(null!==a.memoizedState?function(a,b,c,d){if("stylesheet"===c.type&&("string"!=typeof d.media||!1!==matchMedia(d.media).matches)&&0==(4&c.state.loading)){if(null===c.instance){var e=kT(d.href),f=b.querySelector(kU(e));if(f){null!==(b=f._p)&&"object"==typeof b&&"function"==typeof b.then&&(a.count++,a=k9.bind(a),b.then(a,a)),c.state.loading|=4,c.instance=f,a4(f);return}f=b.ownerDocument||b,d=kV(d),(e=kM.get(e))&&k$(d,e),a4(f=f.createElement("link"));var g=f;g._p=new Promise(function(a,b){g.onload=a,g.onerror=b}),j1(f,"link",d),c.instance=f}null===a.stylesheets&&(a.stylesheets=new Map),a.stylesheets.set(c,b),(b=c.state.preload)&&0==(3&c.state.loading)&&(a.count++,c=k9.bind(a),b.addEventListener("load",c),b.addEventListener("error",c))}}(c,hZ,a.memoizedState,a.memoizedProps):(a=a.stateNode,(0x13ffff40&b)===b&&k6(c,a)));break;case 5:h9(a,b,c),a.flags&h8&&(a=a.stateNode,(0x13ffff40&b)===b&&k6(c,a));break;case 3:case 4:var d=hZ;hZ=kO(a.stateNode.containerInfo),h9(a,b,c),hZ=d;break;case 22:null===a.memoizedState&&(null!==(d=a.alternate)&&null!==d.memoizedState?(d=h8,h8=0x1000000,h9(a,b,c),h8=d):h9(a,b,c));break;case 30:if(0!=(a.flags&h8)&&null!=(d=a.memoizedProps.name)&&"auto"!==d){var e=a.stateNode;e.paired=null,null===hq&&(hq=new Map),hq.set(d,e)}h9(a,b,c);break;default:h9(a,b,c)}}function ib(a){var b=a.alternate;if(null!==b&&null!==(a=b.child)){b.child=null;do b=a.sibling,a.sibling=null,a=b;while(null!==a)}}function ic(a){var b=a.deletions;if(0!=(16&a.flags)){if(null!==b)for(var c=0;c<b.length;c++){var d=b[c];hJ=d,ie(d,a)}ib(a)}if(10256&a.subtreeFlags)for(a=a.child;null!==a;)id(a),a=a.sibling}function id(a){switch(a.tag){case 0:case 11:case 15:ic(a),2048&a.flags&&hb(9,a,a.return);break;case 3:case 12:default:ic(a);break;case 22:var b=a.stateNode;null!==a.memoizedState&&2&b._visibility&&(null===a.return||13!==a.return.tag)?(b._visibility&=-3,function a(b){var c=b.deletions;if(0!=(16&b.flags)){if(null!==c)for(var d=0;d<c.length;d++){var e=c[d];hJ=e,ie(e,b)}ib(b)}for(b=b.child;null!==b;){switch((c=b).tag){case 0:case 11:case 15:hb(8,c,c.return),a(c);break;case 22:2&(d=c.stateNode)._visibility&&(d._visibility&=-3,a(c));break;default:a(c)}b=b.sibling}}(a)):ic(a)}}function ie(a,b){for(;null!==hJ;){var c=hJ;switch(c.tag){case 0:case 11:case 15:hb(8,c,b);break;case 23:case 22:if(null!==c.memoizedState&&null!==c.memoizedState.cachePool){var d=c.memoizedState.cachePool.pool;null!=d&&d.refCount++}break;case 24:d6(c.memoizedState.cache)}if(null!==(d=c.child))d.return=c,hJ=d;else for(c=a;null!==hJ;){var e=(d=hJ).sibling,f=d.return;if(!function a(b){var c=b.alternate;null!==c&&(b.alternate=null,a(c)),b.child=null,b.deletions=null,b.sibling=null,5===b.tag&&null!==(c=b.stateNode)&&a_(c),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}(d),d===c){hJ=null;break}if(null!==e){e.return=f,hJ=e;break}hJ=f}}}var ig={getCacheForType:function(a){var b=d$(d4),c=b.data.get(a);return void 0===c&&(c=a(),b.data.set(a,c)),c},cacheSignal:function(){return d$(d4).controller.signal}},ih="function"==typeof WeakMap?WeakMap:Map,ii=0,ij=null,ik=null,il=0,im=0,io=null,ip=!1,iq=!1,ir=!1,is=0,it=0,iu=0,iv=0,iw=0,ix=0,iy=0,iz=null,iA=null,iB=!1,iC=0,iD=0,iE=1/0,iF=null,iG=null,iH=0,iI=null,iJ=null,iK=0,iL=0,iM=null,iN=null,iO=null,iP=null,iQ=null,iR=0,iS=null;function iT(){return 0!=(2&ii)&&0!==il?il&-il:null!==T.T?jF():aQ()}function iU(){if(0===ix)if(0==(0x20000000&il)||dF){var a=aD;0==(3932160&(aD<<=1))&&(aD=262144),ix=a}else ix=0x20000000;return null!==(a=eS.current)&&(a.flags|=32),ix}function iV(a,b){if(null!=b){var c=a.stateNode,d=c.ref;null===d&&(d=c.ref=kp(c$(a.memoizedProps,c))),null===iP&&(iP=[]),iP.push(b.bind(null,d))}}function iW(a,b,c){(a===ij&&(2===im||9===im)||null!==a.cancelPendingCommit)&&(i0(a,0),iZ(a,il,ix,!1)),aK(a,c),(0==(2&ii)||a!==ij)&&(a===ij&&(0==(2&ii)&&(iv|=c),4===it&&iZ(a,il,ix,!1)),jy(a))}function iX(a,b,c){if(0!=(6&ii))throw Error(g(327));for(var d=!c&&0==(127&b)&&0==(b&a.expiredLanes)||aH(a,b),e=d?function(a,b){var c=ii;ii|=2;var d=i3(),e=i4();ij!==a||il!==b?(iF=null,iE=aq()+500,i0(a,b)):iq=aH(a,b);b:for(;;)try{if(0!==im&&null!==ik){b=ik;var f=io;c:switch(im){case 1:im=0,io=null,i9(a,b,f,1);break;case 2:case 9:if(en(f)){im=0,io=null,i8(b);break}b=function(){2!==im&&9!==im||ij!==a||(im=7),jy(a)},f.then(b,b);break b;case 3:im=7;break b;case 4:im=5;break b;case 7:en(f)?(im=0,io=null,i8(b)):(im=0,io=null,i9(a,b,f,7));break;case 5:var h=null;switch(ik.tag){case 26:h=ik.memoizedState;case 5:case 27:var i=ik;if(h?k4(h):i.stateNode.complete){im=0,io=null;var j=i.sibling;if(null!==j)ik=j;else{var k=i.return;null!==k?(ik=k,ja(k)):ik=null}break c}}im=0,io=null,i9(a,b,f,5);break;case 6:im=0,io=null,i9(a,b,f,6);break;case 8:i_(),it=6;break b;default:throw Error(g(462))}}for(;null!==ik&&!ao();)i7(ik);break}catch(b){i1(a,b)}return(dS=dR=null,T.H=d,T.A=e,ii=c,null!==ik)?0:(ij=null,il=0,c5(),it)}(a,b):i6(a,b,!0),f=d;;){if(0===e)iq&&!d&&iZ(a,b,0,!1);else{if(c=a.current.alternate,f&&!function(a){for(var b=a;;){var c=b.tag;if((0===c||11===c||15===c)&&16384&b.flags&&null!==(c=b.updateQueue)&&null!==(c=c.stores))for(var d=0;d<c.length;d++){var e=c[d],f=e.getSnapshot;e=e.value;try{if(!cz(f(),e))return!1}catch(a){return!1}}if(c=b.child,16384&b.subtreeFlags&&null!==c)c.return=b,b=c;else{if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}(c)){e=i6(a,b,!1),f=!1;continue}if(2===e){if(f=b,a.errorRecoveryDisabledLanes&f)var h=0;else h=0!=(h=-0x20000001&a.pendingLanes)?h:0x20000000&h?0x20000000:0;if(0!==h){b=h;b:{e=iz;var i=a.current.memoizedState.isDehydrated;if(i&&(i0(a,h).flags|=256),2!==(h=i6(a,h,!1))){if(ir&&!i){a.errorRecoveryDisabledLanes|=f,iv|=f,e=4;break b}f=iA,iA=e,null!==f&&(null===iA?iA=f:iA.push.apply(iA,f))}e=h}if(f=!1,2!==e)continue}}if(1===e){i0(a,0),iZ(a,b,0,!0);break}b:{switch(d=a,f=e){case 0:case 1:throw Error(g(345));case 4:if((4194048&b)!==b&&(0x3c00000&b)!==b)break;case 6:iZ(d,b,ix,!ip);break b;case 2:iA=null;break;case 3:case 5:break;default:throw Error(g(329))}if((0x3c00000&b)===b&&10<(e=iC+300-aq())){if(iZ(d,b,ix,!ip),0!==aG(d,0,!0))break b;iK=b,d.timeoutHandle=ka(iY.bind(null,d,c,iA,iF,iB,b,ix,iv,iy,ip,f,"Throttled",-0,0),e);break b}iY(d,c,iA,iF,iB,b,ix,iv,iy,ip,f,null,-0,0)}}break}jy(a)}function iY(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.timeoutHandle=-1;var o,p,q=b.subtreeFlags,r=(0x13ffff00&f)===f;if(l=null,(r||8192&q||0x1002000==(0x1002000&q))&&(hq=null,ia(b,f,l={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:bC}),r&&(q=l,null!=(r=(9===(r=a.containerInfo).nodeType?r:r.ownerDocument).__reactViewTransition)&&(q.count++,q.waitingForViewTransition=!0,q=k9.bind(q),r.finished.then(q,q))),null!==(o=l,p=q=(0x3c00000&f)===f?iC-aq():(4194048&f)===f?iD-aq():0,o.stylesheets&&0===o.count&&lc(o,o.stylesheets),q=0<o.count||0<o.imgCount?function(a){var b=setTimeout(function(){if(o.stylesheets&&lc(o,o.stylesheets),o.unsuspend){var a=o.unsuspend;o.unsuspend=null,a()}},6e4+p);0<o.imgBytes&&0===k7&&(k7=62500*function(){if("function"==typeof performance.getEntriesByType){for(var a=0,b=0,c=performance.getEntriesByType("resource"),d=0;d<c.length;d++){var e=c[d],f=e.transferSize,g=e.initiatorType,h=e.duration;if(f&&h&&j2(g)){for(g=0,h=e.responseEnd,d+=1;d<c.length;d++){var i=c[d],j=i.startTime;if(j>h)break;var k=i.transferSize,l=i.initiatorType;k&&j2(l)&&(g+=k*((i=i.responseEnd)<h?1:(h-j)/(i-j)))}if(--d,b+=8*(f+g)/(e.duration/1e3),10<++a)break}}if(0<a)return b/a/1e6}return navigator.connection&&"number"==typeof(a=navigator.connection.downlink)?a:5}());var c=setTimeout(function(){if(o.waitingForImages=!1,0===o.count&&(o.stylesheets&&lc(o,o.stylesheets),o.unsuspend)){var a=o.unsuspend;o.unsuspend=null,a()}},(o.imgBytes>k7?50:800)+p);return o.unsuspend=a,function(){o.unsuspend=null,clearTimeout(b),clearTimeout(c)}}:null))){iK=f,a.cancelPendingCommit=q(jc.bind(null,a,b,f,c,d,e,g,h,i,k,l,null,m,n)),iZ(a,f,g,!j);return}jc(a,b,f,c,d,e,g,h,i,k,l)}function iZ(a,b,c,d){b&=~iw,b&=~iv,a.suspendedLanes|=b,a.pingedLanes&=~b,d&&(a.warmLanes|=b),d=a.expirationTimes;for(var e=b;0<e;){var f=31-az(e),g=1<<f;d[f]=-1,e&=~g}0!==c&&aL(a,c,b)}function i$(){return 0!=(6&ii)||(jz(0,!1),!1)}function i_(){if(null!==ik){if(0===im)var a=ik.return;else a=ik,dS=dR=null,fk(a),et=null,eu=0,a=ik;for(;null!==a;)g9(a.alternate,a),a=a.return;ik=null}}function i0(a,b){var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,kb(c)),null!==(c=a.cancelPendingCommit)&&(a.cancelPendingCommit=null,c()),iK=0,i_(),ij=a,ik=c=df(a.current,null),il=b,im=0,io=null,ip=!1,iq=aH(a,b),ir=!1,iy=ix=iw=iv=iu=it=0,iA=iz=null,iB=!1,0!=(8&b)&&(b|=32&b);var d=a.entangledLanes;if(0!==d)for(a=a.entanglements,d&=b;0<d;){var e=31-az(d),f=1<<e;b|=a[e],d&=~f}return is=b,c5(),c}function i1(a,b){e2=null,T.H=gj,b===ej||b===el?(b=er(),im=3):b===ek?(b=er(),im=4):im=b===gA?8:null!==b&&"object"==typeof b&&"function"==typeof b.then?6:1,io=b,null===ik&&(it=1,gv(a,dn(b,a.current)))}function i2(){var a=eS.current;return null===a||((4194048&il)===il?null===eT:((0x3c00000&il)===il||0!=(0x20000000&il))&&a===eT)}function i3(){var a=T.H;return T.H=gj,null===a?gj:a}function i4(){var a=T.A;return T.A=ig,a}function i5(){it=4,ip||(4194048&il)!==il&&null!==eS.current||(iq=!0),0==(0x7ffffff&iu)&&0==(0x7ffffff&iv)||null===ij||iZ(ij,il,ix,!1)}function i6(a,b,c){var d=ii;ii|=2;var e=i3(),f=i4();(ij!==a||il!==b)&&(iF=null,i0(a,b)),b=!1;var g=it;b:for(;;)try{if(0!==im&&null!==ik){var h=ik,i=io;switch(im){case 8:i_(),g=6;break b;case 3:case 2:case 9:case 6:null===eS.current&&(b=!0);var j=im;if(im=0,io=null,i9(a,h,i,j),c&&iq){g=0;break b}break;default:j=im,im=0,io=null,i9(a,h,i,j)}}(function(){for(;null!==ik;)i7(ik)})(),g=it;break}catch(b){i1(a,b)}return b&&a.shellSuspendCounter++,dS=dR=null,ii=d,T.H=e,T.A=f,null===ik&&(ij=null,il=0,c5()),g}function i7(a){var b=g2(a.alternate,a,is);a.memoizedProps=a.pendingProps,null===b?ja(a):ik=b}function i8(a){var b=a,c=b.alternate;switch(b.tag){case 15:case 0:b=gN(c,b,b.pendingProps,b.type,void 0,il);break;case 11:b=gN(c,b,b.pendingProps,b.type.render,b.ref,il);break;case 5:fk(b);default:g9(c,b),b=g2(c,b=ik=dg(b,is),is)}a.memoizedProps=a.pendingProps,null===b?ja(a):ik=b}function i9(a,b,c,d){dS=dR=null,fk(b),et=null,eu=0;var e=b.return;try{if(function(a,b,c,d,e){if(c.flags|=32768,null!==d&&"object"==typeof d&&"function"==typeof d.then){if(null!==(b=c.alternate)&&dX(b,c,e,!0),null!==(c=eS.current)){switch(c.tag){case 31:case 13:case 19:return null===eT?i5():null===c.alternate&&0===it&&(it=3),c.flags&=-257,c.flags|=65536,c.lanes=e,d===em?c.flags|=16384:(null===(b=c.updateQueue)?c.updateQueue=new Set([d]):b.add(d),jn(a,d,e)),!1;case 22:return c.flags|=65536,d===em?c.flags|=16384:(null===(b=c.updateQueue)?(b={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=b):null===(c=b.retryQueue)?b.retryQueue=new Set([d]):c.add(d),jn(a,d,e)),!1}throw Error(g(435,c.tag))}return jn(a,d,e),i5(),!1}if(dF)return null!==(b=eS.current)?(0==(65536&b.flags)&&(b.flags|=256),b.flags|=65536,b.lanes=e,d!==dI&&dP(dn(a=Error(g(422),{cause:d}),c))):(d!==dI&&dP(dn(b=Error(g(423),{cause:d}),c)),a=a.current.alternate,a.flags|=65536,e&=-e,a.lanes|=e,d=dn(d,c),e=gx(a.stateNode,d,e),eH(a,e),4!==it&&(it=2)),!1;var f=Error(g(520),{cause:d});if(f=dn(f,c),null===iz?iz=[f]:iz.push(f),4!==it&&(it=2),null===b)return!0;d=dn(d,c),c=b;do{switch(c.tag){case 3:return c.flags|=65536,a=e&-e,c.lanes|=a,a=gx(c.stateNode,d,a),eH(c,a),!1;case 1:if(b=c.type,f=c.stateNode,0==(128&c.flags)&&("function"==typeof b.getDerivedStateFromError||null!==f&&"function"==typeof f.componentDidCatch&&(null===iG||!iG.has(f))))return c.flags|=65536,e&=-e,c.lanes|=e,gz(e=gy(e),a,c,d),eH(c,e),!1;break;case 22:if(null!==c.memoizedState)return c.flags|=65536,!1}c=c.return}while(null!==c)return!1}(a,e,b,c,il)){it=1,gv(a,dn(c,a.current)),ik=null;return}}catch(b){if(null!==e)throw ik=e,b;it=1,gv(a,dn(c,a.current)),ik=null;return}32768&b.flags?(dF||1===d?a=!0:iq||0!=(0x20000000&il)?a=!1:(ip=a=!0,(2===d||9===d||3===d||6===d)&&null!==(d=eS.current)&&13===d.tag&&(d.flags|=16384)),jb(b,a)):ja(b)}function ja(a){var b=a;do{if(0!=(32768&b.flags))return void jb(b,ip);a=b.return;var c=function(a,b,c){var d=b.pendingProps;switch(dB(b),b.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return g8(b),null;case 3:return c=b.stateNode,d=null,null!==a&&(d=a.memoizedState.cache),b.memoizedState.cache!==d&&(b.flags|=2048),dU(d4),ae(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(null===a||null===a.child)&&(dM(b)?g3(b):null===a||a.memoizedState.isDehydrated&&0==(256&b.flags)||(b.flags|=1024,dO())),g8(b),null;case 26:var e=b.type,f=b.memoizedState;return null===a?(g3(b),null!==f?(g8(b),g5(b,f)):(g8(b),g4(b,e,null,d,c))):f?f!==a.memoizedState?(g3(b),g8(b),g5(b,f)):(g8(b),b.flags&=-0x1000001):((a=a.memoizedProps)!==d&&g3(b),g8(b),g4(b,e,a,d,c)),null;case 27:if(ag(b),c=ab.current,e=b.type,null!==a&&null!=b.stateNode)a.memoizedProps!==d&&g3(b);else{if(!d){if(null===b.stateNode)throw Error(g(166));return g8(b),b.subtreeFlags&=-0x2000001,null}a=_.current,dM(b)?dK(b,a):(b.stateNode=a=kK(e,d,c),g3(b))}return g8(b),b.subtreeFlags&=-0x2000001,null;case 5:if(ag(b),e=b.type,null!==a&&null!=b.stateNode)a.memoizedProps!==d&&g3(b);else{if(!d){if(null===b.stateNode)throw Error(g(166));return g8(b),b.subtreeFlags&=-0x2000001,null}if(f=_.current,dM(b))dK(b,f);else{var h=j5(ab.current);switch(f){case 1:f=h.createElementNS("http://www.w3.org/2000/svg",e);break;case 2:f=h.createElementNS("http://www.w3.org/1998/Math/MathML",e);break;default:switch(e){case"svg":f=h.createElementNS("http://www.w3.org/2000/svg",e);break;case"math":f=h.createElementNS("http://www.w3.org/1998/Math/MathML",e);break;case"script":(f=h.createElement("div")).innerHTML="<script></script>",f=f.removeChild(f.firstChild);break;case"select":f="string"==typeof d.is?h.createElement("select",{is:d.is}):h.createElement("select"),d.multiple?f.multiple=!0:d.size&&(f.size=d.size);break;default:f="string"==typeof d.is?h.createElement(e,{is:d.is}):h.createElement(e)}}f[aT]=b,f[aU]=d;b:for(h=b.child;null!==h;){if(5===h.tag||6===h.tag)f.appendChild(h.stateNode);else if(4!==h.tag&&27!==h.tag&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===b)break;for(;null===h.sibling;){if(null===h.return||h.return===b)break b;h=h.return}h.sibling.return=h.return,h=h.sibling}switch(b.stateNode=f,j1(f,e,d),e){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break;case"img":d=!0;break;default:d=!1}d&&g3(b)}}return g8(b),b.subtreeFlags&=-0x2000001,g4(b,b.type,null===a?null:a.memoizedProps,b.pendingProps,c),null;case 6:if(a&&null!=b.stateNode)a.memoizedProps!==d&&g3(b);else{if("string"!=typeof d&&null===b.stateNode)throw Error(g(166));if(a=ab.current,dM(b)){if(a=b.stateNode,c=b.memoizedProps,d=null,null!==(e=dD))switch(e.tag){case 27:case 5:d=e.memoizedProps}a[aT]=b,(a=!!(a.nodeValue===c||null!==d&&!0===d.suppressHydrationWarning||j$(a.nodeValue,c)))||dJ(b,!0)}else(a=j5(a).createTextNode(d))[aT]=b,b.stateNode=a}return g8(b),null;case 31:if(c=b.memoizedState,null===a||null!==a.memoizedState){if(d=dM(b),null!==c){if(null===a){if(!d)throw Error(g(318));if(!(a=null!==(a=b.memoizedState)?a.dehydrated:null))throw Error(g(557));a[aT]=b}else dN(),0==(128&b.flags)&&(b.memoizedState=null),b.flags|=4;g8(b),a=!1}else c=dO(),null!==a&&null!==a.memoizedState&&(a.memoizedState.hydrationErrors=c),a=!0;if(!a){if(256&b.flags)return eY(b),b;return eY(b),null}if(0!=(128&b.flags))throw Error(g(558))}return g8(b),null;case 13:if(d=b.memoizedState,null===a||null!==a.memoizedState&&null!==a.memoizedState.dehydrated){if(e=dM(b),null!==d&&null!==d.dehydrated){if(null===a){if(!e)throw Error(g(318));if(!(e=null!==(e=b.memoizedState)?e.dehydrated:null))throw Error(g(317));e[aT]=b}else dN(),0==(128&b.flags)&&(b.memoizedState=null),b.flags|=4;g8(b),e=!1}else e=dO(),null!==a&&null!==a.memoizedState&&(a.memoizedState.hydrationErrors=e),e=!0;if(!e){if(256&b.flags)return eY(b),b;return eY(b),null}}if(eY(b),0!=(128&b.flags))return b.lanes=c,b;return c=null!==d,a=null!==a&&null!==a.memoizedState,c&&(d=b.child,e=null,null!==d.alternate&&null!==d.alternate.memoizedState&&null!==d.alternate.memoizedState.cachePool&&(e=d.alternate.memoizedState.cachePool.pool),f=null,null!==d.memoizedState&&null!==d.memoizedState.cachePool&&(f=d.memoizedState.cachePool.pool),f!==e&&(d.flags|=2048)),c!==a&&c&&(b.child.flags|=8192),g6(b,b.updateQueue),g8(b),null;case 4:return ae(),null===a&&jQ(b.stateNode.containerInfo),b.flags|=0x4000000,g8(b),null;case 10:return dU(b.type),g8(b),null;case 19:if(e_(b),null===(d=b.memoizedState))return g8(b),null;if(e=0!=(128&b.flags),null===(f=d.rendering))if(e)g7(d,!1);else{if(0!==it||null!==a&&0!=(128&a.flags))for(a=b.child;null!==a;){if(null!==(f=e0(a))){for(b.flags|=128,g7(d,!1),b.updateQueue=a=f.updateQueue,g6(b,a),b.subtreeFlags=0,a=c,c=b.child;null!==c;)dg(c,a),c=c.sibling;return e$(b,1&eZ.current|2),dF&&dy(b,d.treeForkCount),b.child}a=a.sibling}null!==d.tail&&aq()>iE&&(b.flags|=128,e=!0,g7(d,!1),b.lanes=4194304)}else{if(!e)if(null!==(a=e0(f))){if(b.flags|=128,e=!0,b.updateQueue=a=a.updateQueue,g6(b,a),g7(d,!0),null===d.tail&&"collapsed"!==d.tailMode&&"visible"!==d.tailMode&&!f.alternate&&!dF)return g8(b),null}else 2*aq()-d.renderingStartTime>iE&&0x20000000!==c&&(b.flags|=128,e=!0,g7(d,!1),b.lanes=4194304);d.isBackwards?(f.sibling=b.child,b.child=f):(null!==(a=d.last)?a.sibling=f:b.child=f,d.last=f)}if(null!==d.tail){a=d.tail;b:{for(c=a;null!==c;){if(null!==c.alternate){c=!1;break b}c=c.sibling}c=!0}return d.rendering=a,d.tail=a.sibling,d.renderingStartTime=aq(),a.sibling=null,f=eZ.current,f=e?1&f|2:1&f,"visible"===d.tailMode||"collapsed"===d.tailMode||!c||dF?e$(b,f):(c=f,$(eS,b),$(eZ,c),null===eT&&(eT=b)),dF&&dy(b,d.treeForkCount),a}return g8(b),null;case 22:case 23:return eY(b),eR(),d=null!==b.memoizedState,null!==a?null!==a.memoizedState!==d&&(b.flags|=8192):d&&(b.flags|=8192),d?0!=(0x20000000&c)&&0==(128&b.flags)&&(g8(b),6&b.subtreeFlags&&(b.flags|=8192)):g8(b),null!==(c=b.updateQueue)&&g6(b,c.retryQueue),c=null,null!==a&&null!==a.memoizedState&&null!==a.memoizedState.cachePool&&(c=a.memoizedState.cachePool.pool),d=null,null!==b.memoizedState&&null!==b.memoizedState.cachePool&&(d=b.memoizedState.cachePool.pool),d!==c&&(b.flags|=2048),null!==a&&Z(ef),null;case 24:return c=null,null!==a&&(c=a.memoizedState.cache),b.memoizedState.cache!==c&&(b.flags|=2048),dU(d4),g8(b),null;case 25:return null;case 30:return b.flags|=0x2000000,g8(b),null}throw Error(g(156,b.tag))}(b.alternate,b,is);if(null!==c){ik=c;return}if(null!==(b=b.sibling)){ik=b;return}ik=b=a}while(null!==b)0===it&&(it=5)}function jb(a,b){do{var c=function(a,b){switch(dB(b),b.tag){case 1:return 65536&(a=b.flags)?(b.flags=-65537&a|128,b):null;case 3:return dU(d4),ae(),0!=(65536&(a=b.flags))&&0==(128&a)?(b.flags=-65537&a|128,b):null;case 26:case 27:case 5:return ag(b),null;case 31:if(null!==b.memoizedState){if(eY(b),null===b.alternate)throw Error(g(340));dN()}return 65536&(a=b.flags)?(b.flags=-65537&a|128,b):null;case 13:if(eY(b),null!==(a=b.memoizedState)&&null!==a.dehydrated){if(null===b.alternate)throw Error(g(340));dN()}return 65536&(a=b.flags)?(b.flags=-65537&a|128,b):null;case 19:return e_(b),65536&(a=b.flags)?(b.flags=-65537&a|128,null!==(a=b.memoizedState)&&(a.rendering=null,a.tail=null),b.flags|=4,b):null;case 4:return ae(),null;case 10:return dU(b.type),null;case 22:case 23:return eY(b),eR(),null!==a&&Z(ef),65536&(a=b.flags)?(b.flags=-65537&a|128,b):null;case 24:return dU(d4),null;default:return null}}(a.alternate,a);if(null!==c){c.flags&=32767,ik=c;return}if(null!==(c=a.return)&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!b&&null!==(a=a.sibling)){ik=a;return}ik=a=c}while(null!==a)it=6,ik=null}function jc(a,b,c,d,e,f,h,i,j,k,l){a.cancelPendingCommit=null;do jj();while(0!==iH)if(0!=(6&ii))throw Error(g(327));if(null!==b){var m;if(b===a.current)throw Error(g(177));if(!function(a,b,c,d,e,f){var g=a.pendingLanes;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=c,a.entangledLanes&=c,a.errorRecoveryDisabledLanes&=c,a.shellSuspendCounter=0;var h=a.entanglements,i=a.expirationTimes,j=a.hiddenUpdates;for(c=g&~c;0<c;){var k=31-az(c),l=1<<k;h[k]=0,i[k]=-1;var m=j[k];if(null!==m)for(j[k]=null,k=0;k<m.length;k++){var n=m[k];null!==n&&(n.lane&=-0x20000001)}c&=~l}0!==d&&aL(a,d,0),0!==f&&0===e&&0!==a.tag&&(a.suspendedLanes|=f&~(g&~b))}(a,c,f=b.lanes|b.childLanes|c4,h,i,j),a===ij&&(ik=ij=null,il=0),iJ=b,iI=a,iK=c,iL=f,iM=e,iN=d,iP=null,(0x13ffff00&c)===c?(m=a.transitionTypes,a.transitionTypes=null,iQ=m,d=10262):(iQ=null,d=10256),0!=(b.subtreeFlags&d)||0!=(b.flags&d)?(a.callbackNode=null,a.callbackPriority=0,am(au,function(){return jk(),null})):(a.callbackNode=null,a.callbackPriority=0),hp=!1,d=0!=(13878&b.flags),0!=(13878&b.subtreeFlags)||d){d=T.T,T.T=null,e=U.p,U.p=2,h=ii,ii|=4;try{!function(a,b,c){if(a=a.containerInfo,j3=lm,cE(a=cD(a))){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else b:{var e=(d=(d=a.ownerDocument)&&d.defaultView||window).getSelection&&d.getSelection();if(e&&0!==e.rangeCount){d=e.anchorNode;var f,g=e.anchorOffset,h=e.focusNode;e=e.focusOffset;try{d.nodeType,h.nodeType}catch(a){d=null;break b}var i=0,j=-1,k=-1,l=0,m=0,n=a,o=null;c:for(;;){for(;n!==d||0!==g&&3!==n.nodeType||(j=i+g),n!==h||0!==e&&3!==n.nodeType||(k=i+e),3===n.nodeType&&(i+=n.nodeValue.length),null!==(f=n.firstChild);)o=n,n=f;for(;;){if(n===a)break c;if(o===d&&++l===g&&(j=i),o===h&&++m===e&&(k=i),null!==(f=n.nextSibling))break;o=(n=o).parentNode}n=f}d=-1===j||-1===k?null:{start:j,end:k}}else d=null}d=d||{start:0,end:0}}else d=null;for(j4={focusedElem:a,selectionRange:d},lm=!1,c=(0x13ffff00&c)===c,hJ=b,b=c?9270:1028;null!==hJ;){if(a=hJ,c&&null!==(d=a.deletions))for(g=0;g<d.length;g++)c&&hA(d[g]);if(null===a.alternate&&0!=(2&a.flags))c&&hr(a),hO(c);else{if(22===a.tag){if(d=a.alternate,null!==a.memoizedState){null!==d&&null===d.memoizedState&&c&&hA(d),hO(c);continue}else if(null!==d&&null!==d.memoizedState){c&&hr(a),hO(c);continue}}d=a.child,0!=(a.subtreeFlags&b)&&null!==d?(d.return=a,hJ=d):(c&&function a(b){for(b=b.child;null!==b;){if(30===b.tag){var c=b.memoizedProps,d=c$(c,b.stateNode);c=c0(c.default,c.update),b.flags&=-5,"none"!==c&&hv(b,d,c,b.memoizedState=[],!1)}else 0!=(0x2000000&b.subtreeFlags)&&a(b);b=b.sibling}}(a),hO(c))}}hq=null}(a,b,c)}finally{ii=h,U.p=e,T.T=d}}iH=1,(b=hp)?iO=function(a,b,c,d,e,f,g,h,i){var j=9===b.nodeType?b:b.ownerDocument;try{var k=j.startViewTransition({update:function(){var b=j.defaultView,c=b.navigation&&b.navigation.transition,g=j.fonts.status;d();var h=[];if("loaded"===g&&(j.documentElement.clientHeight,"loading"===j.fonts.status&&h.push(j.fonts.ready)),g=h.length,null!==a)for(var i=a.suspenseyImages,k=0,l=0;l<i.length;l++){var m=i[l];if(!m.complete){var n=m.getBoundingClientRect();if(0<n.bottom&&0<n.right&&n.top<b.innerHeight&&n.left<b.innerWidth){if((k+=k5(m))>k7){h.length=g;break}m=new Promise(kn.bind(m)),h.push(m)}}}return 0<h.length?(b=Promise.race([Promise.all(h),new Promise(function(a){return setTimeout(a,500)})]).then(e,e),(c?Promise.allSettled([c.finished,b]):b).then(f,f)):(e(),c)?c.finished.then(f,f):void f()},types:c});return j.__reactViewTransition=k,k.ready.then(function(){for(var a=j.documentElement.getAnimations({subtree:!0}),b=0;b<a.length;b++){var c=a[b].effect,d=c.pseudoElement;if(null!=d&&d.startsWith("::view-transition")){d=c.getKeyframes();for(var e=void 0,f=void 0,h=!0,i=0;i<d.length;i++){var k=d[i],l=k.width;if(void 0===e)e=l;else if(e!==l){h=!1;break}if(l=k.height,void 0===f)f=l;else if(f!==l){h=!1;break}delete k.width,delete k.height,"none"===k.transform&&delete k.transform}h&&void 0!==e&&void 0!==f&&(c.setKeyframes(d),(h=getComputedStyle(c.target,c.pseudoElement)).width!==e||h.height!==f)&&((h=d[0]).width=e,h.height=f,(h=d[d.length-1]).width=e,h.height=f,c.setKeyframes(d))}}g()},function(a){j.__reactViewTransition===k&&(j.__reactViewTransition=null);try{"object"==typeof a&&null!==a&&"InvalidStateError"===a.name&&("View transition was skipped because document visibility state is hidden."===a.message||"Skipping view transition because document visibility state has become hidden."===a.message||"Skipping view transition because viewport size changed."===a.message||"Transition was aborted because of invalid state"===a.message)&&(a=null),null!==a&&i(a)}finally{d(),e(),g()}}),k.finished.finally(function(){for(var a=j.documentElement,b=a.getAnimations({subtree:!0}),c=0;c<b.length;c++){var d=b[c],e=d.effect,f=e.pseudoElement;null!=f&&f.startsWith("::view-transition")&&e.target===a&&d.cancel()}j.__reactViewTransition===k&&(j.__reactViewTransition=null),h()}),k}catch(a){return d(),e(),g(),null}}(l,a.containerInfo,iQ,jf,jg,je,jh,jk,jd,null,null):(jf(),jg(),jh())}}function jd(a){0!==iH&&(0,iI.onRecoverableError)(a,{componentStack:null})}function je(){3===iH&&(iH=0,h1(iJ,iI),iH=4)}function jf(){if(1===iH){iH=0;var a=iI,b=iJ,c=iK,d=0!=(13878&b.flags);if(0!=(13878&b.subtreeFlags)||d){d=T.T,T.T=null;var e=U.p;U.p=2;var f=ii;ii|=4;try{hL=hM=!1,h$(b,a,c),c=j4;var g=cD(a.containerInfo),h=c.focusedElem,i=c.selectionRange;if(g!==h&&h&&h.ownerDocument&&function a(b,c){return!!b&&!!c&&(b===c||(!b||3!==b.nodeType)&&(c&&3===c.nodeType?a(b,c.parentNode):"contains"in b?b.contains(c):!!b.compareDocumentPosition&&!!(16&b.compareDocumentPosition(c))))}(h.ownerDocument.documentElement,h)){if(null!==i&&cE(h)){var j=i.start,k=i.end;if(void 0===k&&(k=j),"selectionStart"in h)h.selectionStart=j,h.selectionEnd=Math.min(k,h.value.length);else{var l=h.ownerDocument||document,m=l&&l.defaultView||window;if(m.getSelection){var n=m.getSelection(),o=h.textContent.length,p=Math.min(i.start,o),q=void 0===i.end?p:Math.min(i.end,o);!n.extend&&p>q&&(g=q,q=p,p=g);var r=cC(h,p),s=cC(h,q);if(r&&s&&(1!==n.rangeCount||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)){var t=l.createRange();t.setStart(r.node,r.offset),n.removeAllRanges(),p>q?(n.addRange(t),n.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),n.addRange(t))}}}}for(l=[],n=h;n=n.parentNode;)1===n.nodeType&&l.push({element:n,left:n.scrollLeft,top:n.scrollTop});for("function"==typeof h.focus&&h.focus(),h=0;h<l.length;h++){var u=l[h];u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}lm=!!j3,j4=j3=null}finally{ii=f,U.p=e,T.T=d}}a.current=b,iH=2}}function jg(){if(2===iH){iH=0;var a=iI,b=iJ,c=0!=(8772&b.flags);if(0!=(8772&b.subtreeFlags)||c){c=T.T,T.T=null;var d=U.p;U.p=2;var e=ii;ii|=4;try{hP(a,b.alternate,b)}finally{ii=e,U.p=d,T.T=c}}iH=3}}function jh(){if(4===iH||3===iH){iH=0,iO=null,ap();var a=iI,b=iJ,c=iK,d=iN,e=(0x13ffff00&c)===c?10262:10256;if(0!=(b.subtreeFlags&e)||0!=(b.flags&e)?iH=5:(iH=0,iJ=iI=null,ji(a,a.pendingLanes)),0===(e=a.pendingLanes)&&(iG=null),aP(c),b=b.stateNode,ay&&"function"==typeof ay.onCommitFiberRoot)try{ay.onCommitFiberRoot(ax,b,void 0,128==(128&b.current.flags))}catch(a){}if(null!==d){b=T.T,e=U.p,U.p=2,T.T=null;try{for(var f=a.onRecoverableError,g=0;g<d.length;g++){var h=d[g];f(h.value,{componentStack:h.stack})}}finally{T.T=b,U.p=e}}if(d=iP,f=iQ,iQ=null,null!==d)for(iP=null,null===f&&(f=[]),h=0;h<d.length;h++)(0,d[h])(f);0!=(3&iK)&&jj(),jy(a),e=a.pendingLanes,0!=(261930&c)&&0!=(42&e)?a===iS?iR++:(iR=0,iS=a):iR=0,jz(0,!1)}}function ji(a,b){0==(a.pooledCacheLanes&=b)&&null!=(b=a.pooledCache)&&(a.pooledCache=null,d6(b))}function jj(){return null!==iO&&(iO.skipTransition(),iO=null),jf(),jg(),jh(),jk()}function jk(){if(5!==iH)return!1;var a=iI,b=iL;iL=0;var c=aP(iK),d=T.T,e=U.p;try{U.p=32>c?32:c,T.T=null,c=iM,iM=null;var f=iI,h=iK;if(iH=0,iJ=iI=null,iK=0,0!=(6&ii))throw Error(g(331));var i=ii;if(ii|=4,id(f.current),h6(f,f.current,h,c),ii=i,jz(0,!1),ay&&"function"==typeof ay.onPostCommitFiberRoot)try{ay.onPostCommitFiberRoot(ax,f)}catch(a){}return!0}finally{U.p=e,T.T=d,ji(a,b)}}function jl(a,b,c){b=dn(c,b),b=gx(a.stateNode,b,2),null!==(a=eF(a,b,2))&&(aK(a,2),jy(a))}function jm(a,b,c){if(3===a.tag)jl(a,a,c);else for(;null!==b;){if(3===b.tag){jl(b,a,c);break}if(1===b.tag){var d=b.stateNode;if("function"==typeof b.type.getDerivedStateFromError||"function"==typeof d.componentDidCatch&&(null===iG||!iG.has(d))){a=dn(c,a),null!==(d=eF(b,c=gy(2),2))&&(gz(c,d,b,a),aK(d,2),jy(d));break}}b=b.return}}function jn(a,b,c){var d=a.pingCache;if(null===d){d=a.pingCache=new ih;var e=new Set;d.set(b,e)}else void 0===(e=d.get(b))&&(e=new Set,d.set(b,e));e.has(c)||(ir=!0,e.add(c),a=jo.bind(null,a,b,c),b.then(a,a))}function jo(a,b,c){var d=a.pingCache;null!==d&&d.delete(b),a.pingedLanes|=a.suspendedLanes&c,a.warmLanes&=~c,ij===a&&(il&c)===c&&(4===it||3===it&&(0x3c00000&il)===il&&300>aq()-iC?0==(2&ii)&&i0(a,0):iw|=c,iy===il&&(iy=0)),jy(a)}function jp(a,b){0===b&&(b=aI()),null!==(a=c8(a,b))&&(aK(a,b),jy(a))}function jq(a){var b=a.memoizedState,c=0;null!==b&&(c=b.retryLane),jp(a,c)}function jr(a,b){var c=0;switch(a.tag){case 31:case 13:var d=a.stateNode,e=a.memoizedState;null!==e&&(c=e.retryLane);break;case 19:d=a.stateNode;break;case 22:d=a.stateNode._retryCache;break;default:throw Error(g(314))}null!==d&&d.delete(b),jp(a,c)}var js=null,jt=null,ju=!1,jv=!1,jw=!1,jx=0;function jy(a){a!==jt&&null===a.next&&(null===jt?js=jt=a:jt=jt.next=a),jv=!0,ju||(ju=!0,kd(function(){0!=(6&ii)?am(as,jA):jB()}))}function jz(a,b){if(!jw&&jv){jw=!0;do for(var c=!1,d=js;null!==d;){if(!b)if(0!==a){var e=d.pendingLanes;if(0===e)var f=0;else{var g=d.suspendedLanes,h=d.pingedLanes;f=0xc000095&(f=(1<<31-az(42|a)+1)-1&(e&~(g&~h)))?0xc000095&f|1:f?2|f:0}0!==f&&(c=!0,jE(d,f))}else f=il,0==(3&(f=aG(d,d===ij?f:0,null!==d.cancelPendingCommit||-1!==d.timeoutHandle)))||aH(d,f)||(c=!0,jE(d,f));d=d.next}while(c)jw=!1}}function jA(){jB()}function jB(){jv=ju=!1;var a,b=0;0===jx||((a=window.event)&&"popstate"===a.type?a===j9||(j9=a,0):(j9=null,1))||(b=jx);for(var c=aq(),d=null,e=js;null!==e;){var f=e.next,g=jC(e,c);0===g?(e.next=null,null===d?js=f:d.next=f,null===f&&(jt=d)):(d=e,(0!==b||0!=(3&g))&&(jv=!0)),e=f}0!==iH&&5!==iH||jz(b,!1),0!==jx&&(jx=0)}function jC(a,b){for(var c=a.suspendedLanes,d=a.pingedLanes,e=a.expirationTimes,f=-0x3c00001&a.pendingLanes;0<f;){var g=31-az(f),h=1<<g,i=e[g];-1===i?(0==(h&c)||0!=(h&d))&&(e[g]=function(a,b){switch(a){case 1:case 2:case 4:case 8:case 64:return b+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;default:return -1}}(h,b)):i<=b&&(a.expiredLanes|=h),f&=~h}if(b=ij,c=il,c=aG(a,a===b?c:0,null!==a.cancelPendingCommit||-1!==a.timeoutHandle),d=a.callbackNode,0===c||a===b&&(2===im||9===im)||null!==a.cancelPendingCommit)return null!==d&&null!==d&&an(d),a.callbackNode=null,a.callbackPriority=0;if(0==(3&c)||aH(a,c)){if((b=c&-c)===a.callbackPriority)return b;switch(null!==d&&an(d),aP(c)){case 2:case 8:c=at;break;case 32:default:c=au;break;case 0x10000000:c=aw}return c=am(c,d=jD.bind(null,a)),a.callbackPriority=b,a.callbackNode=c,b}return null!==d&&null!==d&&an(d),a.callbackPriority=2,a.callbackNode=null,2}function jD(a,b){if(0!==iH&&5!==iH)return a.callbackNode=null,a.callbackPriority=0,null;var c=a.callbackNode;if(jj()&&a.callbackNode!==c)return null;var d=il;return 0===(d=aG(a,a===ij?d:0,null!==a.cancelPendingCommit||-1!==a.timeoutHandle))?null:(iX(a,d,b),jC(a,aq()),null!=a.callbackNode&&a.callbackNode===c?jD.bind(null,a):null)}function jE(a,b){if(jj())return null;iX(a,b,!0)}function jF(){if(0===jx){var a=eb;0===a&&(a=aC,0==(261888&(aC<<=1))&&(aC=256)),jx=a}return jx}function jG(a){return null==a||"symbol"==typeof a||"boolean"==typeof a?null:"function"==typeof a?a:bB(""+a)}function jH(a,b){var c=b.ownerDocument.createElement("input");return c.name=b.name,c.value=b.value,a.id&&c.setAttribute("form",a.id),b.parentNode.insertBefore(c,b),a=new FormData(a),c.parentNode.removeChild(c),a}for(var jI=0;jI<cX.length;jI++){var jJ=cX[jI];cY(jJ.toLowerCase(),"on"+(jJ[0].toUpperCase()+jJ.slice(1)))}cY(cP,"onAnimationEnd"),cY(cQ,"onAnimationIteration"),cY(cR,"onAnimationStart"),cY("dblclick","onDoubleClick"),cY("focusin","onFocus"),cY("focusout","onBlur"),cY(cS,"onTransitionRun"),cY(cT,"onTransitionStart"),cY(cU,"onTransitionCancel"),cY(cV,"onTransitionEnd"),a8("onMouseEnter",["mouseout","mouseover"]),a8("onMouseLeave",["mouseout","mouseover"]),a8("onPointerEnter",["pointerout","pointerover"]),a8("onPointerLeave",["pointerout","pointerover"]),a7("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a7("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a7("onBeforeInput",["compositionend","keypress","textInput","paste"]),a7("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a7("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a7("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jK="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jL=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jK));function jM(a,b){b=0!=(4&b);for(var c=0;c<a.length;c++){var d=a[c],e=d.event;d=d.listeners;b:{var f=void 0;if(b)for(var g=d.length-1;0<=g;g--){var h=d[g],i=h.instance,j=h.currentTarget;if(h=h.listener,i!==f&&e.isPropagationStopped())break b;f=h,e.currentTarget=j;try{f(e)}catch(a){c1(a)}e.currentTarget=null,f=i}else for(g=0;g<d.length;g++){if(i=(h=d[g]).instance,j=h.currentTarget,h=h.listener,i!==f&&e.isPropagationStopped())break b;f=h,e.currentTarget=j;try{f(e)}catch(a){c1(a)}e.currentTarget=null,f=i}}}}function jN(a,b){var c=b[aW];void 0===c&&(c=b[aW]=new Set);var d=a+"__bubble";c.has(d)||(jR(b,a,2,!1),c.add(d))}function jO(a,b,c){var d=0;b&&(d|=4),jR(c,a,d,b)}var jP="_reactListening"+Math.random().toString(36).slice(2);function jQ(a){if(!a[jP]){a[jP]=!0,a5.forEach(function(b){"selectionchange"!==b&&(jL.has(b)||jO(b,!1,a),jO(b,!0,a))});var b=9===a.nodeType?a:a.ownerDocument;null===b||b[jP]||(b[jP]=!0,jO("selectionchange",!1,b))}}function jR(a,b,c,d){switch(lt(b)){case 2:var e=ln;break;case 8:e=lo;break;default:e=lp}c=e.bind(null,b,c,a),e=void 0,d?void 0!==e?a.addEventListener(b,c,{capture:!0,passive:e}):a.addEventListener(b,c,!0):void 0!==e?a.addEventListener(b,c,{passive:e}):a.addEventListener(b,c,!1)}function jS(a,b,c,d,e){var f=d;if(0==(1&b)&&0==(2&b)&&null!==d)b:for(;;){if(null===d)return;var g=d.tag;if(3===g||4===g){var h=d.stateNode.containerInfo;if(h===e)break;if(4===g)for(g=d.return;null!==g;){var j=g.tag;if((3===j||4===j)&&g.stateNode.containerInfo===e)return;g=g.return}for(;null!==h;){if(null===(g=a0(h)))return;if(5===(j=g.tag)||6===j||26===j||27===j){d=f=g;continue b}h=h.parentNode}}d=d.return}bJ(function(){var d=f,e=bE(c),g=[];b:{var h=cW.get(a);if(void 0!==h){var j=bZ,k=a;switch(a){case"keypress":if(0===bP(c))break b;case"keydown":case"keyup":j=cc;break;case"focusin":k="focus",j=b3;break;case"focusout":k="blur",j=b3;break;case"beforeblur":case"afterblur":j=b3;break;case"click":if(2===c.button)break b;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=b1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=b2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=ce;break;case cP:case cQ:case cR:j=b4;break;case cV:j=cf;break;case"scroll":case"scrollend":j=b_;break;case"wheel":j=cg;break;case"copy":case"cut":case"paste":j=b5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=cd;break;case"toggle":case"beforetoggle":j=ch}var l=0!=(4&b),m=!l&&("scroll"===a||"scrollend"===a),n=l?null!==h?h+"Capture":null:h;l=[];for(var o,p=d;null!==p;){var q=p;if(o=q.stateNode,5!==(q=q.tag)&&26!==q&&27!==q||null===o||null===n||null!=(q=bK(p,n))&&l.push(jT(p,q,o)),m)break;p=p.return}0<l.length&&(h=new j(h,k,null,c,e),g.push({event:h,listeners:l}))}}if(0==(7&b)){j="mouseover"===a||"pointerover"===a,h="mouseout"===a||"pointerout"===a,!(j&&c!==bD&&(k=c.relatedTarget||c.fromElement)&&(a0(k)||k[aV]))&&(h||j)&&(k=e.window===e?e:(j=e.ownerDocument)?j.defaultView||j.parentWindow:window,h?(j=c.relatedTarget||c.toElement,h=d,null!==(j=j?a0(j):null)&&(m=i(j),l=j.tag,j!==m||5!==l&&27!==l&&6!==l)&&(j=null)):(h=null,j=d),h!==j&&(l=b1,q="onMouseLeave",n="onMouseEnter",p="mouse",("pointerout"===a||"pointerover"===a)&&(l=cd,q="onPointerLeave",n="onPointerEnter",p="pointer"),m=null==h?k:a2(h),o=null==j?k:a2(j),(k=new l(q,p+"leave",h,c,e)).target=m,k.relatedTarget=o,q=null,a0(e)===d&&((l=new l(n,p+"enter",j,c,e)).target=o,l.relatedTarget=m,q=l),m=q,l=h&&j?v(h,j,jV):null,null!==h&&jW(g,k,h,l,!1),null!==j&&null!==m&&jW(g,m,j,l,!0)));b:{if("select"===(j=(h=d?a2(d):window).nodeName&&h.nodeName.toLowerCase())||"input"===j&&"file"===h.type)var r,s,t,u=cs;else if(cm(h))if(1){u=cw;var w=cv}else u=cy;else(j=h.nodeName)&&"input"===j.toLowerCase()&&("checkbox"===h.type||"radio"===h.type)?u=cx:d&&by(d.elementType)&&(u=cs);if(u&&(u=u(a,d))){cn(g,u,c,e);break b}w&&w(a,h,d),"focusout"===a&&d&&"number"===h.type&&null!=d.memoizedProps.value&&bq(h,"number",h.value)}switch(w=d?a2(d):window,a){case"focusin":(cm(w)||"true"===w.contentEditable)&&(cF=w,cG=d,cH=null);break;case"focusout":cH=cG=cF=null;break;case"mousedown":cI=!0;break;case"contextmenu":case"mouseup":case"dragend":cI=!1,cJ(g,c,e);break;case"selectionchange":0;case"keydown":case"keyup":cJ(g,c,e)}ck?cj(a,c)&&(t="onCompositionEnd"):"keydown"===a&&229===c.keyCode&&(t="onCompositionStart"),t&&0<(w=jU(d,t)).length&&(t=new b6(t,a,null,c,e),g.push({event:t,listeners:w}),s?t.data=s:null!==(s="object"==typeof(r=(r=c).detail)&&"data"in r?r.data:null)&&(t.data=s)),(s=function(a,b){if(ck)return"compositionend"===a||cj(a,b)?(a=bO(),bN=bM=bL=null,ck=!1,a):null;switch(a){case"paste":default:return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return b.data}}(a,c))&&0<(t=jU(d,"onBeforeInput")).length&&(w=new b6("onBeforeInput","beforeinput",null,c,e),g.push({event:w,listeners:t}),w.data=s);var y=a;if("submit"===y&&d&&d.stateNode===e){var z=jG((e[aU]||null).action),A=c.submitter;A&&null!==(y=(y=A[aU]||null)?jG(y.formAction):A.getAttribute("formAction"))&&(z=y,A=null);var B=new bZ("action","action",null,c,e);g.push({event:B,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(0!==jx){var a=A?jH(e,A):new FormData(e);f5(d,{pending:!0,data:a,method:e.method,action:z},null,a)}}else"function"==typeof z&&(B.preventDefault(),f5(d,{pending:!0,data:a=A?jH(e,A):new FormData(e),method:e.method,action:z},z,a))},currentTarget:e}]})}}jM(g,b)})}function jT(a,b,c){return{instance:a,listener:b,currentTarget:c}}function jU(a,b){for(var c=b+"Capture",d=[];null!==a;){var e=a,f=e.stateNode;if(5!==(e=e.tag)&&26!==e&&27!==e||null===f||(null!=(e=bK(a,c))&&d.unshift(jT(a,e,f)),null!=(e=bK(a,b))&&d.push(jT(a,e,f))),3===a.tag)return d;a=a.return}return[]}function jV(a){if(null===a)return null;do a=a.return;while(a&&5!==a.tag&&27!==a.tag)return a||null}function jW(a,b,c,d,e){for(var f=b._reactName,g=[];null!==c&&c!==d;){var h=c,i=h.alternate,j=h.stateNode;if(h=h.tag,null!==i&&i===d)break;5!==h&&26!==h&&27!==h||null===j||(i=j,e?null!=(j=bK(c,f))&&g.unshift(jT(c,j,i)):e||null!=(j=bK(c,f))&&g.push(jT(c,j,i))),c=c.return}0!==g.length&&a.push({event:b,listeners:g})}var jX=/\r\n?/g,jY=/\u0000|\uFFFD/g;function jZ(a){return("string"==typeof a?a:""+a).replace(jX,"\n").replace(jY,"")}function j$(a,b){return b=jZ(b),jZ(a)===b}function j_(a,b,c,d,e,f){switch(c){case"children":if("string"==typeof d)"body"===b||"textarea"===b&&""===d||bu(a,d);else{if("number"!=typeof d&&"bigint"!=typeof d)return;"body"!==b&&bu(a,""+d)}break;case"className":bf(a,"class",d);break;case"tabIndex":bf(a,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":bf(a,c,d);break;case"style":bx(a,d,f);return;case"data":if("object"!==b){bf(a,"data",d);break}case"src":case"href":if(""===d&&("a"!==b||"href"!==c)||null==d||"function"==typeof d||"symbol"==typeof d||"boolean"==typeof d){a.removeAttribute(c);break}d=bB(""+d),a.setAttribute(c,d);break;case"action":case"formAction":if("function"==typeof d){a.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof f&&("formAction"===c?("input"!==b&&j_(a,b,"name",e.name,e,null),j_(a,b,"formEncType",e.formEncType,e,null),j_(a,b,"formMethod",e.formMethod,e,null),j_(a,b,"formTarget",e.formTarget,e,null)):(j_(a,b,"encType",e.encType,e,null),j_(a,b,"method",e.method,e,null),j_(a,b,"target",e.target,e,null))),null==d||"symbol"==typeof d||"boolean"==typeof d){a.removeAttribute(c);break}d=bB(""+d),a.setAttribute(c,d);break;case"onClick":null!=d&&(a.onclick=bC);return;case"onScroll":null!=d&&jN("scroll",a);return;case"onScrollEnd":null!=d&&jN("scrollend",a);return;case"dangerouslySetInnerHTML":if(null!=d){if("object"!=typeof d||!("__html"in d))throw Error(g(61));if(null!=(c=d.__html)){if(null!=e.children)throw Error(g(60));a.innerHTML=c}}break;case"multiple":a.multiple=d&&"function"!=typeof d&&"symbol"!=typeof d;break;case"muted":a.muted=d&&"function"!=typeof d&&"symbol"!=typeof d;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==d||"function"==typeof d||"boolean"==typeof d||"symbol"==typeof d){a.removeAttribute("xlink:href");break}c=bB(""+d),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=d&&"function"!=typeof d&&"symbol"!=typeof d?a.setAttribute(c,""+d):a.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&"function"!=typeof d&&"symbol"!=typeof d?a.setAttribute(c,""):a.removeAttribute(c);break;case"capture":case"download":!0===d?a.setAttribute(c,""):!1!==d&&null!=d&&"function"!=typeof d&&"symbol"!=typeof d?a.setAttribute(c,d):a.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":null!=d&&"function"!=typeof d&&"symbol"!=typeof d&&!isNaN(d)&&1<=d?a.setAttribute(c,d):a.removeAttribute(c);break;case"rowSpan":case"start":null==d||"function"==typeof d||"symbol"==typeof d||isNaN(d)?a.removeAttribute(c):a.setAttribute(c,d);break;case"popover":jN("beforetoggle",a),jN("toggle",a),be(a,"popover",d);break;case"xlinkActuate":bg(a,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":bg(a,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":bg(a,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":bg(a,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":bg(a,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":bg(a,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":bg(a,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":bg(a,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":bg(a,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":be(a,"is",d);break;case"innerText":case"textContent":return;default:if(2<c.length&&("o"===c[0]||"O"===c[0])&&("n"===c[1]||"N"===c[1]))return;be(a,c=bz.get(c)||c,d)}bc=!0}function j0(a,b,c,d,e,f){switch(c){case"style":bx(a,d,f);return;case"dangerouslySetInnerHTML":if(null!=d){if("object"!=typeof d||!("__html"in d))throw Error(g(61));if(null!=(c=d.__html)){if(null!=e.children)throw Error(g(60));a.innerHTML=c}}break;case"children":if("string"==typeof d)bu(a,d);else{if("number"!=typeof d&&"bigint"!=typeof d)return;bu(a,""+d)}break;case"onScroll":null!=d&&jN("scroll",a);return;case"onScrollEnd":null!=d&&jN("scrollend",a);return;case"onClick":null!=d&&(a.onclick=bC);return;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":return;default:if(!a6.hasOwnProperty(c))b:{if("o"===c[0]&&"n"===c[1]&&(e=c.endsWith("Capture"),b=c.slice(2,e?c.length-7:void 0),"function"==typeof(f=null!=(f=a[aU]||null)?f[c]:null)&&a.removeEventListener(b,f,e),"function"==typeof d)){"function"!=typeof f&&null!==f&&(c in a?a[c]=null:a.hasAttribute(c)&&a.removeAttribute(c)),a.addEventListener(b,d,e);break b}bc=!0,c in a?a[c]=d:!0===d?a.setAttribute(c,""):be(a,c,d)}return}bc=!0}function j1(a,b,c){switch(b){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jN("error",a),jN("load",a);var d,e=!1,f=!1;for(d in c)if(c.hasOwnProperty(d)){var h=c[d];if(null!=h)switch(d){case"src":e=!0;break;case"srcSet":f=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(g(137,b));default:j_(a,b,d,h,c,null)}}f&&j_(a,b,"srcSet",c.srcSet,c,null),e&&j_(a,b,"src",c.src,c,null);return;case"input":jN("invalid",a);var i=d=h=f=null,j=null,k=null;for(e in c)if(c.hasOwnProperty(e)){var l=c[e];if(null!=l)switch(e){case"name":f=l;break;case"type":h=l;break;case"checked":j=l;break;case"defaultChecked":k=l;break;case"value":d=l;break;case"defaultValue":i=l;break;case"children":case"dangerouslySetInnerHTML":if(null!=l)throw Error(g(137,b));break;default:j_(a,b,e,l,c,null)}}bp(a,d,i,j,k,h,f,!1);return;case"select":for(f in jN("invalid",a),e=h=d=null,c)if(c.hasOwnProperty(f)&&null!=(i=c[f]))switch(f){case"value":d=i;break;case"defaultValue":h=i;break;case"multiple":e=i;default:j_(a,b,f,i,c,null)}b=d,c=h,a.multiple=!!e,null!=b?br(a,!!e,b,!1):null!=c&&br(a,!!e,c,!0);return;case"textarea":for(h in jN("invalid",a),d=f=e=null,c)if(c.hasOwnProperty(h)&&null!=(i=c[h]))switch(h){case"value":e=i;break;case"defaultValue":f=i;break;case"children":d=i;break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(g(91));break;default:j_(a,b,h,i,c,null)}bt(a,e,f,d);return;case"option":for(j in c)c.hasOwnProperty(j)&&null!=(e=c[j])&&("selected"===j?a.selected=e&&"function"!=typeof e&&"symbol"!=typeof e:j_(a,b,j,e,c,null));return;case"dialog":jN("beforetoggle",a),jN("toggle",a),jN("cancel",a),jN("close",a);break;case"iframe":case"object":jN("load",a);break;case"video":case"audio":for(e=0;e<jK.length;e++)jN(jK[e],a);break;case"image":jN("error",a),jN("load",a);break;case"details":jN("toggle",a);break;case"embed":case"source":case"link":jN("error",a),jN("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(k in c)if(c.hasOwnProperty(k)&&null!=(e=c[k]))switch(k){case"children":case"dangerouslySetInnerHTML":throw Error(g(137,b));default:j_(a,b,k,e,c,null)}return;default:if(by(b)){for(l in c)c.hasOwnProperty(l)&&void 0!==(e=c[l])&&j0(a,b,l,e,c,void 0);return}}for(i in c)c.hasOwnProperty(i)&&null!=(e=c[i])&&j_(a,b,i,e,c,null)}function j2(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var j3=null,j4=null;function j5(a){return 9===a.nodeType?a:a.ownerDocument}function j6(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function j7(a,b){if(0===a)switch(b){case"svg":return 1;case"math":return 2;default:return 0}return 1===a&&"foreignObject"===b?0:a}function j8(a,b){return"textarea"===a||"noscript"===a||"string"==typeof b.children||"number"==typeof b.children||"bigint"==typeof b.children||"object"==typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var j9=null,ka="function"==typeof setTimeout?setTimeout:void 0,kb="function"==typeof clearTimeout?clearTimeout:void 0,kc="function"==typeof Promise?Promise:void 0,kd="function"==typeof queueMicrotask?queueMicrotask:void 0!==kc?function(a){return kc.resolve(null).then(a).catch(ke)}:ka;function ke(a){setTimeout(function(){throw a})}function kf(a){return"head"===a}function kg(a,b){var c=b,d=0;do{var e=c.nextSibling;if(a.removeChild(c),e&&8===e.nodeType)if("/$"===(c=e.data)||"/&"===c){if(0===d){a.removeChild(e),lL(b);return}d--}else if("$"===c||"$?"===c||"$~"===c||"$!"===c||"&"===c)d++;else if("html"===c)kL(a.ownerDocument.documentElement);else if("head"===c){kL(c=a.ownerDocument.head);for(var f=c.firstChild;f;){var g=f.nextSibling,h=f.nodeName;f[a$]||"SCRIPT"===h||"STYLE"===h||"LINK"===h&&"stylesheet"===f.rel.toLowerCase()||c.removeChild(f),f=g}}else"body"===c&&kL(a.ownerDocument.body);c=e}while(c)lL(b)}function kh(a,b){var c=a;a=0;do{var d=c.nextSibling;if(1===c.nodeType?b?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",""===c.getAttribute("style")&&c.removeAttribute("style")):3===c.nodeType&&(b?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),d&&8===d.nodeType)if("/$"===(c=d.data))if(0===a)break;else a--;else"$"!==c&&"$?"!==c&&"$~"!==c&&"$!"!==c||a++;c=d}while(c)}function ki(a,b,c){if(b=CSS.escape(b)!==b?"r-"+btoa(b).replace(/=/g,""):b,a.style.viewTransitionName=b,null!=c&&(a.style.viewTransitionClass=c),"inline"===(c=getComputedStyle(a)).display){if(1===(b=a.getClientRects()).length)var d=1;else for(var e=d=0;e<b.length;e++){var f=b[e];0<f.width&&0<f.height&&d++}1===d&&((a=a.style).display=1===b.length?"inline-block":"block",a.marginTop="-"+c.paddingTop,a.marginBottom="-"+c.paddingBottom)}}function kj(a,b){a=a.style;var c=null!=(b=b.style)?b.hasOwnProperty("viewTransitionName")?b.viewTransitionName:b.hasOwnProperty("view-transition-name")?b["view-transition-name"]:null:null;a.viewTransitionName=null==c||"boolean"==typeof c?"":(""+c).trim(),c=null!=b?b.hasOwnProperty("viewTransitionClass")?b.viewTransitionClass:b.hasOwnProperty("view-transition-class")?b["view-transition-class"]:null:null,a.viewTransitionClass=null==c||"boolean"==typeof c?"":(""+c).trim(),"inline-block"===a.display&&(null==b?a.display=a.margin="":(c=b.display,a.display=null==c||"boolean"==typeof c?"":c,null!=(c=b.margin)?a.margin=c:(c=b.hasOwnProperty("marginTop")?b.marginTop:b["margin-top"],a.marginTop=null==c||"boolean"==typeof c?"":c,b=b.hasOwnProperty("marginBottom")?b.marginBottom:b["margin-bottom"],a.marginBottom=null==b||"boolean"==typeof b?"":b)))}function kk(a,b,c){return c=c.ownerDocument.defaultView,{rect:a,abs:"absolute"===b.position||"fixed"===b.position,clip:"none"!==b.clipPath||"visible"!==b.overflow||"none"!==b.filter||"none"!==b.mask||"none"!==b.mask||"0px"!==b.borderRadius,view:0<=a.bottom&&0<=a.right&&a.top<=c.innerHeight&&a.left<=c.innerWidth}}function kl(a){return kk(a.getBoundingClientRect(),getComputedStyle(a),a)}function km(a){var b=a.getBoundingClientRect();return kk(b=new DOMRect(b.x+2e4,b.y+2e4,b.width,b.height),getComputedStyle(a),a)}function kn(a){this.addEventListener("load",a),this.addEventListener("error",a)}function ko(a,b){this._scope=document.documentElement,this._selector="::view-transition-"+a+"("+b+")"}function kp(a){return{name:a,group:new ko("group",a),imagePair:new ko("image-pair",a),old:new ko("old",a),new:new ko("new",a)}}function kq(a){this._fragmentFiber=a,this._observers=this._eventListeners=null}function kr(a,b,c,d){return o(a).addEventListener(b,c,d),!1}function ks(a,b,c,d){return o(a).removeEventListener(b,c,d),!1}function kt(a){return null==a?"0":"boolean"==typeof a?"c="+(a?"1":"0"):"c="+(a.capture?"1":"0")+"&o="+(a.once?"1":"0")+"&p="+(a.passive?"1":"0")}function ku(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e];if(f.type===b&&f.listener===c&&kt(f.optionsOrUseCapture)===kt(d))return e}return -1}function kv(a,b){var c=a=o(a),d=b;function e(){f=!0}var f=!1;try{c.addEventListener("focus",e),(c.focus||HTMLElement.prototype.focus).call(c,d)}finally{c.removeEventListener("focus",e)}return f}function kw(a,b){return b.push(a),!1}function kx(a){return(a=o(a))===a.ownerDocument.activeElement&&(a.blur(),!0)}function ky(a,b){return a=o(a),b.observe(a),!1}function kz(a,b){return a=o(a),b.unobserve(a),!1}function kA(a,b){return a=o(a),b.push.apply(b,a.getClientRects()),!1}function kB(a,b){var c=b._eventListeners;if(null!==c)for(var d=0;d<c.length;d++){var e=c[d];a.addEventListener(e.type,e.listener,e.optionsOrUseCapture)}null!==b._observers&&b._observers.forEach(function(b){b.observe(a)})}function kC(a){var b=a.firstChild;for(b&&10===b.nodeType&&(b=b.nextSibling);b;){var c=b;switch(b=b.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":kC(c),a_(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===c.rel.toLowerCase())continue}a.removeChild(c)}}function kD(a,b){for(;8!==a.nodeType;)if((1!==a.nodeType||"INPUT"!==a.nodeName||"hidden"!==a.type)&&!b||null===(a=kG(a.nextSibling)))return null;return a}function kE(a){return"$?"===a.data||"$~"===a.data}function kF(a){return"$!"===a.data||"$?"===a.data&&"loading"!==a.ownerDocument.readyState}function kG(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break;if(8===b){if("$"===(b=a.data)||"$!"===b||"$?"===b||"$~"===b||"&"===b||"F!"===b||"F"===b)break;if("/$"===b||"/&"===b)return null}}return a}ko.prototype.animate=function(a,b){return(b="number"==typeof b?{duration:b}:w({},b)).pseudoElement=this._selector,this._scope.animate(a,b)},ko.prototype.getAnimations=function(){for(var a=this._scope,b=this._selector,c=a.getAnimations({subtree:!0}),d=[],e=0;e<c.length;e++){var f=c[e].effect;null!==f&&f.target===a&&f.pseudoElement===b&&d.push(c[e])}return d},ko.prototype.getComputedStyle=function(){return getComputedStyle(this._scope,this._selector)},kq.prototype.addEventListener=function(a,b,c){null===this._eventListeners&&(this._eventListeners=[]);var d=this._eventListeners;-1===ku(d,a,b,c)&&(d.push({type:a,listener:b,optionsOrUseCapture:c}),m(this._fragmentFiber.child,!1,kr,a,b,c)),this._eventListeners=d},kq.prototype.removeEventListener=function(a,b,c){var d=this._eventListeners;null!=d&&0<d.length&&(m(this._fragmentFiber.child,!1,ks,a,b,c),a=ku(d,a,b,c),null!==this._eventListeners&&this._eventListeners.splice(a,1))},kq.prototype.dispatchEvent=function(a){var b=n(this._fragmentFiber);if(null===b)return!0;b=o(b);var c=this._eventListeners;if(null!==c&&0<c.length||!a.bubbles){var d=document.createTextNode("");if(c)for(var e=0;e<c.length;e++){var f=c[e];d.addEventListener(f.type,f.listener,f.optionsOrUseCapture)}if(b.appendChild(d),a=d.dispatchEvent(a),c)for(e=0;e<c.length;e++)f=c[e],d.removeEventListener(f.type,f.listener,f.optionsOrUseCapture);return b.removeChild(d),a}return b.dispatchEvent(a)},kq.prototype.focus=function(a){m(this._fragmentFiber.child,!0,kv,a,void 0,void 0)},kq.prototype.focusLast=function(a){var b=[];m(this._fragmentFiber.child,!0,kw,b,void 0,void 0);for(var c=b.length-1;0<=c&&!kv(b[c],a);c--);},kq.prototype.blur=function(){m(this._fragmentFiber.child,!1,kx,void 0,void 0,void 0)},kq.prototype.observeUsing=function(a){null===this._observers&&(this._observers=new Set),this._observers.add(a),m(this._fragmentFiber.child,!1,ky,a,void 0,void 0)},kq.prototype.unobserveUsing=function(a){var b=this._observers;null!==b&&b.has(a)&&(b.delete(a),m(this._fragmentFiber.child,!1,kz,a,void 0,void 0))},kq.prototype.getClientRects=function(){var a=[];return m(this._fragmentFiber.child,!1,kA,a,void 0,void 0),a},kq.prototype.getRootNode=function(a){var b=n(this._fragmentFiber);return null===b?this:o(b).getRootNode(a)},kq.prototype.compareDocumentPosition=function(a){var b=n(this._fragmentFiber);if(null===b)return Node.DOCUMENT_POSITION_DISCONNECTED;var c=[];m(this._fragmentFiber.child,!1,kw,c,void 0,void 0);var d=o(b);if(0===c.length){c=this._fragmentFiber;var e=d.compareDocumentPosition(a);return b=e,d===a?b=Node.DOCUMENT_POSITION_CONTAINS:e&Node.DOCUMENT_POSITION_CONTAINED_BY&&(m(c.sibling,!1,r),c=p,p=null,b=null===c?Node.DOCUMENT_POSITION_PRECEDING:0===(a=o(c).compareDocumentPosition(a))||a&Node.DOCUMENT_POSITION_FOLLOWING?Node.DOCUMENT_POSITION_FOLLOWING:Node.DOCUMENT_POSITION_PRECEDING),b|Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC}b=o(c[0]),e=o(c[c.length-1]);for(var f=o(c[0]),g=!1,h=this._fragmentFiber.return;null!==h&&(4===h.tag&&(g=!0),3!==h.tag&&5!==h.tag);)h=h.return;if(null==(f=g?f.parentElement:d))return Node.DOCUMENT_POSITION_DISCONNECTED;d=f.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_CONTAINED_BY,f=f.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY,g=b.compareDocumentPosition(a);var i=e.compareDocumentPosition(a);return h=g&Node.DOCUMENT_POSITION_CONTAINED_BY||i&Node.DOCUMENT_POSITION_CONTAINED_BY,i=d&&f&&g&Node.DOCUMENT_POSITION_FOLLOWING&&i&Node.DOCUMENT_POSITION_PRECEDING,(b=d&&b===a||f&&e===a||h||i?Node.DOCUMENT_POSITION_CONTAINED_BY:(d||b!==a)&&(f||e!==a)?g:Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)&Node.DOCUMENT_POSITION_DISCONNECTED||b&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC||function(a,b,c,d,e){var f=a0(e);if(a&Node.DOCUMENT_POSITION_CONTAINED_BY){if(c=!!f)b:{for(;null!==f;){if(7===f.tag&&(f===b||f.alternate===b)){c=!0;break b}f=f.return}c=!1}return c}if(a&Node.DOCUMENT_POSITION_CONTAINS){if(null===f)return f=e.ownerDocument,e===f||e===f.body;b:{for(f=b,b=n(b);null!==f;){if((5===f.tag||3===f.tag)&&(f===b||f.alternate===b)){f=!0;break b}f=f.return}f=!1}return f}return a&Node.DOCUMENT_POSITION_PRECEDING?((b=!!f)&&!(b=f===c)&&(null===(b=v(c,f,u))?b=!1:(m(b,!0,s,f,c),f=p,p=null,b=null!==f)),b):!!(a&Node.DOCUMENT_POSITION_FOLLOWING)&&((b=!!f)&&!(b=f===d)&&(null===(b=v(d,f,u))?b=!1:(m(b,!0,t,f,d),f=p,q=p=null,b=null!==f)),b)}(b,this._fragmentFiber,c[0],c[c.length-1],a)?b:Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC},kq.prototype.scrollIntoView=function(a){if("object"==typeof a)throw Error(g(566));var b=[];m(this._fragmentFiber.child,!1,kw,b,void 0,void 0);var c=!1!==a;if(0===b.length){b=this._fragmentFiber;var d=[null,null],e=n(b);null!==e&&function a(b,c,d){for(var e=3<arguments.length&&void 0!==arguments[3]&&arguments[3];null!==d;){if(d===c)if(e=!0,!d.sibling)return!0;else d=d.sibling;if(5===d.tag){if(e)return b[1]=d,!0;b[0]=d}else if((22!==d.tag||null===d.memoizedState)&&a(b,c,d.child,e))return!0;d=d.sibling}return!1}(d,b,e.child),null!==(c=c?d[1]||d[0]||n(this._fragmentFiber):d[0]||d[1])&&o(c).scrollIntoView(a)}else for(d=c?b.length-1:0;d!==(c?-1:b.length);)o(b[d]).scrollIntoView(a),d+=c?-1:1};var kH=null;function kI(a){a=a.nextSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if("/$"===c||"/&"===c){if(0===b)return kG(a.nextSibling);b--}else"$"!==c&&"$!"!==c&&"$?"!==c&&"$~"!==c&&"&"!==c||b++}a=a.nextSibling}return null}function kJ(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if("$"===c||"$!"===c||"$?"===c||"$~"===c||"&"===c){if(0===b)return a;b--}else"/$"!==c&&"/&"!==c||b++}a=a.previousSibling}return null}function kK(a,b,c){switch(b=j5(c),a){case"html":if(!(a=b.documentElement))throw Error(g(452));return a;case"head":if(!(a=b.head))throw Error(g(453));return a;case"body":if(!(a=b.body))throw Error(g(454));return a;default:throw Error(g(451))}}function kL(a){for(var b=a.attributes;b.length;)a.removeAttributeNode(b[0]);a_(a)}var kM=new Map,kN=new Set;function kO(a){return"function"==typeof a.getRootNode?a.getRootNode():9===a.nodeType?a:a.ownerDocument}var kP=U.d;U.d={f:function(){var a=kP.f(),b=i$();return a||b},r:function(a){var b=a1(a);null!==b&&5===b.tag&&"form"===b.type?f7(b):kP.r(a)},D:function(a){kP.D(a),kR("dns-prefetch",a,null)},C:function(a,b){kP.C(a,b),kR("preconnect",a,b)},L:function(a,b,c){if(kP.L(a,b,c),kQ&&a&&b){var d='link[rel="preload"][as="'+bn(b)+'"]';"image"===b&&c&&c.imageSrcSet?(d+='[imagesrcset="'+bn(c.imageSrcSet)+'"]',"string"==typeof c.imageSizes&&(d+='[imagesizes="'+bn(c.imageSizes)+'"]')):d+='[href="'+bn(a)+'"]';var e=d;switch(b){case"style":e=kT(a);break;case"script":e=kW(a)}kM.has(e)||(a=w({rel:"preload",href:"image"===b&&c&&c.imageSrcSet?void 0:a,as:b},c),kM.set(e,a),null!==kQ.querySelector(d)||"style"===b&&kQ.querySelector(kU(e))||"script"===b&&kQ.querySelector(kX(e))||(j1(b=kQ.createElement("link"),"link",a),a4(b),kQ.head.appendChild(b)))}},m:function(a,b){if(kP.m(a,b),kQ&&a){var c=b&&"string"==typeof b.as?b.as:"script",d='link[rel="modulepreload"][as="'+bn(c)+'"][href="'+bn(a)+'"]',e=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":e=kW(a)}if(!kM.has(e)&&(a=w({rel:"modulepreload",href:a},b),kM.set(e,a),null===kQ.querySelector(d))){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(kQ.querySelector(kX(e)))return}j1(c=kQ.createElement("link"),"link",a),a4(c),kQ.head.appendChild(c)}}},X:function(a,b){if(kP.X(a,b),kQ&&a){var c=a3(kQ).hoistableScripts,d=kW(a),e=c.get(d);e||((e=kQ.querySelector(kX(d)))||(a=w({src:a,async:!0},b),(b=kM.get(d))&&k_(a,b),a4(e=kQ.createElement("script")),j1(e,"link",a),kQ.head.appendChild(e)),e={type:"script",instance:e,count:1,state:null},c.set(d,e))}},S:function(a,b,c){if(kP.S(a,b,c),kQ&&a){var d=a3(kQ).hoistableStyles,e=kT(a);b=b||"default";var f=d.get(e);if(!f){var g={loading:0,preload:null};if(f=kQ.querySelector(kU(e)))g.loading=5;else{a=w({rel:"stylesheet",href:a,"data-precedence":b},c),(c=kM.get(e))&&k$(a,c);var h=f=kQ.createElement("link");a4(h),j1(h,"link",a),h._p=new Promise(function(a,b){h.onload=a,h.onerror=b}),h.addEventListener("load",function(){g.loading|=1}),h.addEventListener("error",function(){g.loading|=2}),g.loading|=4,kZ(f,b,kQ)}f={type:"stylesheet",instance:f,count:1,state:g},d.set(e,f)}}},M:function(a,b){if(kP.M(a,b),kQ&&a){var c=a3(kQ).hoistableScripts,d=kW(a),e=c.get(d);e||((e=kQ.querySelector(kX(d)))||(a=w({src:a,async:!0,type:"module"},b),(b=kM.get(d))&&k_(a,b),a4(e=kQ.createElement("script")),j1(e,"link",a),kQ.head.appendChild(e)),e={type:"script",instance:e,count:1,state:null},c.set(d,e))}}};var kQ="undefined"==typeof document?null:document;function kR(a,b,c){if(kQ&&"string"==typeof b&&b){var d=bn(b);d='link[rel="'+a+'"][href="'+d+'"]',"string"==typeof c&&(d+='[crossorigin="'+c+'"]'),kN.has(d)||(kN.add(d),a={rel:a,crossOrigin:c,href:b},null===kQ.querySelector(d)&&(j1(b=kQ.createElement("link"),"link",a),a4(b),kQ.head.appendChild(b)))}}function kS(a,b,c,d){var e=(e=ab.current)?kO(e):null;if(!e)throw Error(g(446));switch(a){case"meta":case"title":return null;case"style":return"string"==typeof c.precedence&&"string"==typeof c.href?(b=kT(c.href),(d=(c=a3(e).hoistableStyles).get(b))||(d={type:"style",instance:null,count:0,state:null},c.set(b,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===c.rel&&"string"==typeof c.href&&"string"==typeof c.precedence){a=kT(c.href);var f,h,i,j,k=a3(e).hoistableStyles,l=k.get(a);if(l||(e=e.ownerDocument||e,l={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},k.set(a,l),(k=e.querySelector(kU(a)))&&!k._p&&(l.instance=k,l.state.loading=5),kM.has(a)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},kM.set(a,c),k||(f=e,h=a,i=c,j=l.state,f.querySelector('link[rel="preload"][as="style"]['+h+"]")?j.loading=1:(j.preload=h=f.createElement("link"),h.addEventListener("load",function(){return j.loading|=1}),h.addEventListener("error",function(){return j.loading|=2}),j1(h,"link",i),a4(h),f.head.appendChild(h))))),b&&null===d)throw Error(g(528,""));return l}if(b&&null!==d)throw Error(g(529,""));return null;case"script":return b=c.async,"string"==typeof(c=c.src)&&b&&"function"!=typeof b&&"symbol"!=typeof b?(b=kW(c),(d=(c=a3(e).hoistableScripts).get(b))||(d={type:"script",instance:null,count:0,state:null},c.set(b,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(g(444,a))}}function kT(a){return'href="'+bn(a)+'"'}function kU(a){return'link[rel="stylesheet"]['+a+"]"}function kV(a){return w({},a,{"data-precedence":a.precedence,precedence:null})}function kW(a){return'[src="'+bn(a)+'"]'}function kX(a){return"script[async]"+a}function kY(a,b,c){if(b.count++,null===b.instance)switch(b.type){case"style":var d=a.querySelector('style[data-href~="'+bn(c.href)+'"]');if(d)return b.instance=d,a4(d),d;var e=w({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return a4(d=(a.ownerDocument||a).createElement("style")),j1(d,"style",e),kZ(d,c.precedence,a),b.instance=d;case"stylesheet":e=kT(c.href);var f=a.querySelector(kU(e));if(f)return b.state.loading|=4,b.instance=f,a4(f),f;d=kV(c),(e=kM.get(e))&&k$(d,e),a4(f=(a.ownerDocument||a).createElement("link"));var h=f;return h._p=new Promise(function(a,b){h.onload=a,h.onerror=b}),j1(f,"link",d),b.state.loading|=4,kZ(f,c.precedence,a),b.instance=f;case"script":if(f=kW(c.src),e=a.querySelector(kX(f)))return b.instance=e,a4(e),e;return d=c,(e=kM.get(f))&&k_(d=w({},c),e),a4(e=(a=a.ownerDocument||a).createElement("script")),j1(e,"link",d),a.head.appendChild(e),b.instance=e;case"void":return null;default:throw Error(g(443,b.type))}return"stylesheet"===b.type&&0==(4&b.state.loading)&&(d=b.instance,b.state.loading|=4,kZ(d,c.precedence,a)),b.instance}function kZ(a,b,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),e=d.length?d[d.length-1]:null,f=e,g=0;g<d.length;g++){var h=d[g];if(h.dataset.precedence===b)f=h;else if(f!==e)break}f?f.parentNode.insertBefore(a,f.nextSibling):(b=9===c.nodeType?c.head:c).insertBefore(a,b.firstChild)}function k$(a,b){null==a.crossOrigin&&(a.crossOrigin=b.crossOrigin),null==a.referrerPolicy&&(a.referrerPolicy=b.referrerPolicy),null==a.title&&(a.title=b.title)}function k_(a,b){null==a.crossOrigin&&(a.crossOrigin=b.crossOrigin),null==a.referrerPolicy&&(a.referrerPolicy=b.referrerPolicy),null==a.integrity&&(a.integrity=b.integrity)}var k0=null;function k1(a,b,c){if(null===k0){var d=new Map,e=k0=new Map;e.set(c,d)}else(d=(e=k0).get(c))||(d=new Map,e.set(c,d));if(d.has(a))return d;for(d.set(a,null),c=c.getElementsByTagName(a),e=0;e<c.length;e++){var f=c[e];if(!(f[a$]||f[aT]||"link"===a&&"stylesheet"===f.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==f.namespaceURI){var g=f.getAttribute(b)||"";g=a+g;var h=d.get(g);h?h.push(f):d.set(g,[f])}}return d}function k2(a,b,c){(a=a.ownerDocument||a).head.insertBefore(c,"title"===b?a.querySelector("head > title"):null)}function k3(a,b){return"img"===a&&null!=b.src&&""!==b.src&&null==b.onLoad&&"lazy"!==b.loading}function k4(a){return"stylesheet"!==a.type||0!=(3&a.state.loading)}function k5(a){return(a.width||100)*(a.height||100)*("number"==typeof devicePixelRatio?devicePixelRatio:1)*.25}function k6(a,b){"function"==typeof b.decode&&(a.imgCount++,b.complete||(a.imgBytes+=k5(b),a.suspenseyImages.push(b)),a=la.bind(a),b.decode().then(a,a))}var k7=0;function k8(a){if(0===a.count&&(0===a.imgCount||!a.waitingForImages)){if(a.stylesheets)lc(a,a.stylesheets);else if(a.unsuspend){var b=a.unsuspend;a.unsuspend=null,b()}}}function k9(){this.count--,k8(this)}function la(){this.imgCount--,k8(this)}var lb=null;function lc(a,b){a.stylesheets=null,null!==a.unsuspend&&(a.count++,lb=new Map,b.forEach(ld,a),lb=null,k9.call(a))}function ld(a,b){if(!(4&b.state.loading)){var c=lb.get(a);if(c)var d=c.get(null);else{c=new Map,lb.set(a,c);for(var e=a.querySelectorAll("link[data-precedence],style[data-precedence]"),f=0;f<e.length;f++){var g=e[f];("LINK"===g.nodeName||"not all"!==g.getAttribute("media"))&&(c.set(g.dataset.precedence,g),d=g)}d&&c.set(null,d)}g=(e=b.instance).getAttribute("data-precedence"),(f=c.get(g)||d)===d&&c.set(null,e),c.set(g,e),this.count++,d=k9.bind(this),e.addEventListener("load",d),e.addEventListener("error",d),f?f.parentNode.insertBefore(e,f.nextSibling):(a=9===a.nodeType?a.head:a).insertBefore(e,a.firstChild),b.state.loading|=4}}var le={$$typeof:F,Provider:null,Consumer:null,_currentValue:V,_currentValue2:V,_threadCount:0};function lf(a,b,c,d,e,f,g,h,i){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=aJ(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=aJ(0),this.hiddenUpdates=aJ(null),this.identifierPrefix=d,this.onUncaughtError=e,this.onCaughtError=f,this.onRecoverableError=g,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=i,this.transitionTypes=null,this.incompleteTransitions=new Map}function lg(a,b,c,d,e,f,g,h,i,j,k,l){return a=new lf(a,b,c,g,i,j,k,l,h),b=1,!0===f&&(b|=24),f=dd(3,null,null,b),a.current=f,f.stateNode=a,b=d5(),b.refCount++,a.pooledCache=b,b.refCount++,f.memoizedState={element:d,isDehydrated:c,cache:b},eC(f),a}function lh(a,b,c,d,e,f){e=e?db:db,null===d.context?d.context=e:d.pendingContext=e,(d=eE(b)).payload={element:c},null!==(f=void 0===f?null:f)&&(d.callback=f),null!==(c=eF(a,d,b))&&(iW(c,a,b),eG(c,a,b))}function li(a,b){if(null!==(a=a.memoizedState)&&null!==a.dehydrated){var c=a.retryLane;a.retryLane=0!==c&&c<b?c:b}}function lj(a,b){li(a,b),(a=a.alternate)&&li(a,b)}function lk(a){if(13===a.tag||31===a.tag){var b=c8(a,0x4000000);null!==b&&iW(b,a,0x4000000),lj(a,0x4000000)}}function ll(a){if(13===a.tag||31===a.tag){var b=iT(),c=c8(a,b=aO(b));null!==c&&iW(c,a,b),lj(a,b)}}var lm=!0;function ln(a,b,c,d){var e=T.T;T.T=null;var f=U.p;try{U.p=2,lp(a,b,c,d)}finally{U.p=f,T.T=e}}function lo(a,b,c,d){var e=T.T;T.T=null;var f=U.p;try{U.p=8,lp(a,b,c,d)}finally{U.p=f,T.T=e}}function lp(a,b,c,d){if(lm){var e=lq(d);if(null===e)jS(a,b,d,lr,c),lC(a,d);else if(function(a,b,c,d,e){switch(b){case"focusin":return lv=lD(lv,a,b,c,d,e),!0;case"dragenter":return lw=lD(lw,a,b,c,d,e),!0;case"mouseover":return lx=lD(lx,a,b,c,d,e),!0;case"pointerover":var f=e.pointerId;return ly.set(f,lD(ly.get(f)||null,a,b,c,d,e)),!0;case"gotpointercapture":return f=e.pointerId,lz.set(f,lD(lz.get(f)||null,a,b,c,d,e)),!0}return!1}(e,a,b,c,d))d.stopPropagation();else if(lC(a,d),4&b&&-1<lB.indexOf(a)){for(;null!==e;){var f=a1(e);if(null!==f)switch(f.tag){case 3:if((f=f.stateNode).current.memoizedState.isDehydrated){var g=aF(f.pendingLanes);if(0!==g){var h=f;for(h.pendingLanes|=2,h.entangledLanes|=2;g;){var i=1<<31-az(g);h.entanglements[1]|=i,g&=~i}jy(f),0==(6&ii)&&(iE=aq()+500,jz(0,!1))}}break;case 31:case 13:null!==(h=c8(f,2))&&iW(h,f,2),i$(),lj(f,2)}if(null===(f=lq(d))&&jS(a,b,d,lr,c),f===e)break;e=f}null!==e&&d.stopPropagation()}else jS(a,b,d,null,c)}}function lq(a){return ls(a=bE(a))}var lr=null;function ls(a){if(lr=null,null!==(a=a0(a))){var b=i(a);if(null===b)a=null;else{var c=b.tag;if(13===c){if(null!==(a=j(b)))return a;a=null}else if(31===c){if(null!==(a=k(b)))return a;a=null}else if(3===c){if(b.stateNode.current.memoizedState.isDehydrated)return 3===b.tag?b.stateNode.containerInfo:null;a=null}else b!==a&&(a=null)}}return lr=a,null}function lt(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ar()){case as:return 2;case at:return 8;case au:case av:return 32;case aw:return 0x10000000;default:return 32}default:return 32}}var lu=!1,lv=null,lw=null,lx=null,ly=new Map,lz=new Map,lA=[],lB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function lC(a,b){switch(a){case"focusin":case"focusout":lv=null;break;case"dragenter":case"dragleave":lw=null;break;case"mouseover":case"mouseout":lx=null;break;case"pointerover":case"pointerout":ly.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":lz.delete(b.pointerId)}}function lD(a,b,c,d,e,f){return null===a||a.nativeEvent!==f?(a={blockedOn:b,domEventName:c,eventSystemFlags:d,nativeEvent:f,targetContainers:[e]},null!==b&&null!==(b=a1(b))&&lk(b)):(a.eventSystemFlags|=d,b=a.targetContainers,null!==e&&-1===b.indexOf(e)&&b.push(e)),a}function lE(a){var b=a0(a.target);if(null!==b){var c=i(b);if(null!==c){if(13===(b=c.tag)){if(null!==(b=j(c))){a.blockedOn=b,aR(a.priority,function(){ll(c)});return}}else if(31===b){if(null!==(b=k(c))){a.blockedOn=b,aR(a.priority,function(){ll(c)});return}}else if(3===b&&c.stateNode.current.memoizedState.isDehydrated){a.blockedOn=3===c.tag?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function lF(a){if(null!==a.blockedOn)return!1;for(var b=a.targetContainers;0<b.length;){var c=lq(a.nativeEvent);if(null!==c)return null!==(b=a1(c))&&lk(b),a.blockedOn=c,!1;var d=new(c=a.nativeEvent).constructor(c.type,c);bD=d,c.target.dispatchEvent(d),bD=null,b.shift()}return!0}function lG(a,b,c){lF(a)&&c.delete(b)}function lH(){lu=!1,null!==lv&&lF(lv)&&(lv=null),null!==lw&&lF(lw)&&(lw=null),null!==lx&&lF(lx)&&(lx=null),ly.forEach(lG),lz.forEach(lG)}function lI(a,b){a.blockedOn===b&&(a.blockedOn=null,lu||(lu=!0,d.unstable_scheduleCallback(d.unstable_NormalPriority,lH)))}var lJ=null;function lK(a){lJ!==a&&(lJ=a,d.unstable_scheduleCallback(d.unstable_NormalPriority,function(){lJ===a&&(lJ=null);for(var b=0;b<a.length;b+=3){var c=a[b],d=a[b+1],e=a[b+2];if("function"!=typeof d)if(null===ls(d||c))continue;else break;var f=a1(c);null!==f&&(a.splice(b,3),b-=3,f5(f,{pending:!0,data:e,method:c.method,action:d},d,e))}}))}function lL(a){function b(b){return lI(b,a)}null!==lv&&lI(lv,a),null!==lw&&lI(lw,a),null!==lx&&lI(lx,a),ly.forEach(b),lz.forEach(b);for(var c=0;c<lA.length;c++){var d=lA[c];d.blockedOn===a&&(d.blockedOn=null)}for(;0<lA.length&&null===(c=lA[0]).blockedOn;)lE(c),null===c.blockedOn&&lA.shift();if(null!=(c=(a.ownerDocument||a).$$reactFormReplay))for(d=0;d<c.length;d+=3){var e=c[d],f=c[d+1],g=e[aU]||null;if("function"==typeof f)g||lK(c);else if(g){var h=null;if(f&&f.hasAttribute("formAction")){if(e=f,g=f[aU]||null)h=g.formAction;else if(null!==ls(e))continue}else h=g.action;"function"==typeof h?c[d+1]=h:(c.splice(d,3),d-=3),lK(c)}}}function lM(){function a(a){a.canIntercept&&"react-transition"===a.info&&a.intercept({handler:function(){return new Promise(function(a){return e=a})},focusReset:"manual",scroll:"manual"})}function b(){null!==e&&(e(),e=null),d||setTimeout(c,20)}function c(){if(!d&&!navigation.transition){var a=navigation.currentEntry;a&&null!=a.url&&navigation.navigate(a.url,{state:a.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var d=!1,e=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",b),navigation.addEventListener("navigateerror",b),setTimeout(c,100),function(){d=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",b),navigation.removeEventListener("navigateerror",b),null!==e&&(e(),e=null)}}}function lN(a){this._internalRoot=a}function lO(a){this._internalRoot=a}lO.prototype.render=lN.prototype.render=function(a){var b=this._internalRoot;if(null===b)throw Error(g(409));lh(b.current,iT(),a,b,null,null)},lO.prototype.unmount=lN.prototype.unmount=function(){var a=this._internalRoot;if(null!==a){this._internalRoot=null;var b=a.containerInfo;lh(a.current,2,null,a,null,null),i$(),b[aV]=null}},lO.prototype.unstable_scheduleHydration=function(a){if(a){var b=aQ();a={blockedOn:null,target:a,priority:b};for(var c=0;c<lA.length&&0!==b&&b<lA[c].priority;c++);lA.splice(c,0,a),0===c&&lE(a)}};var lP=e.version;if("19.3.0-canary-52684925-20251110"!==lP)throw Error(g(527,lP,"19.3.0-canary-52684925-20251110"));if(U.findDOMNode=function(a){var b=a._reactInternals;if(void 0===b){if("function"==typeof a.render)throw Error(g(188));throw Error(g(268,a=Object.keys(a).join(",")))}return null===(a=null!==(a=function(a){var b=a.alternate;if(!b){if(null===(b=i(a)))throw Error(g(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){if(null!==(d=e.return)){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return l(e),a;if(f===d)return l(e),b;f=f.sibling}throw Error(g(188))}if(c.return!==d.return)c=e,d=f;else{for(var h=!1,j=e.child;j;){if(j===c){h=!0,c=e,d=f;break}if(j===d){h=!0,d=e,c=f;break}j=j.sibling}if(!h){for(j=f.child;j;){if(j===c){h=!0,c=f,d=e;break}if(j===d){h=!0,d=f,c=e;break}j=j.sibling}if(!h)throw Error(g(189))}}if(c.alternate!==d)throw Error(g(190))}if(3!==c.tag)throw Error(g(188));return c.stateNode.current===c?a:b}(b))?function a(b){var c=b.tag;if(5===c||26===c||27===c||6===c)return b;for(b=b.child;null!==b;){if(null!==(c=a(b)))return c;b=b.sibling}return null}(a):null)?null:a.stateNode},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lQ=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lQ.isDisabled&&lQ.supportsFiber)try{ax=lQ.inject({bundleType:0,version:"19.3.0-canary-52684925-20251110",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.3.0-canary-52684925-20251110"}),ay=lQ}catch(a){}}c.createRoot=function(a,b){if(!h(a))throw Error(g(299));var c=!1,d="",e=gs,f=gt,i=gu;return null!=b&&(!0===b.unstable_strictMode&&(c=!0),void 0!==b.identifierPrefix&&(d=b.identifierPrefix),void 0!==b.onUncaughtError&&(e=b.onUncaughtError),void 0!==b.onCaughtError&&(f=b.onCaughtError),void 0!==b.onRecoverableError&&(i=b.onRecoverableError)),b=lg(a,1,!1,null,null,c,d,null,e,f,i,lM),a[aV]=b.current,jQ(a),new lN(b)},c.hydrateRoot=function(a,b,c){if(!h(a))throw Error(g(299));var d,e=!1,f="",i=gs,j=gt,k=gu,l=null;return null!=c&&(!0===c.unstable_strictMode&&(e=!0),void 0!==c.identifierPrefix&&(f=c.identifierPrefix),void 0!==c.onUncaughtError&&(i=c.onUncaughtError),void 0!==c.onCaughtError&&(j=c.onCaughtError),void 0!==c.onRecoverableError&&(k=c.onRecoverableError),void 0!==c.formState&&(l=c.formState)),(b=lg(a,1,!0,b,null!=c?c:null,e,f,l,i,j,k,lM)).context=(d=null,db),c=b.current,(f=eE(e=aO(e=iT()))).callback=null,eF(c,f,e),c=e,b.current.lanes=c,aK(b,c),jy(b),a[aV]=b.current,jQ(a),new lO(b)},c.version="19.3.0-canary-52684925-20251110"},6388,(a,b,c)=>{"use strict";!function a(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(a){console.error(a)}}(),b.exports=a.r(62765)},27975,(a,b,c)=>{},72091,(a,b,c)=>{var d=function(){var a=String.fromCharCode,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",d={};function e(a,b){if(!d[a]){d[a]={};for(var c=0;c<a.length;c++)d[a][a.charAt(c)]=c}return d[a][b]}var f={compressToBase64:function(a){if(null==a)return"";var c=f._compress(a,6,function(a){return b.charAt(a)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(a){return null==a?"":""==a?null:f._decompress(a.length,32,function(c){return e(b,a.charAt(c))})},compressToUTF16:function(b){return null==b?"":f._compress(b,15,function(b){return a(b+32)})+" "},decompressFromUTF16:function(a){return null==a?"":""==a?null:f._decompress(a.length,16384,function(b){return a.charCodeAt(b)-32})},compressToUint8Array:function(a){for(var b=f.compress(a),c=new Uint8Array(2*b.length),d=0,e=b.length;d<e;d++){var g=b.charCodeAt(d);c[2*d]=g>>>8,c[2*d+1]=g%256}return c},decompressFromUint8Array:function(b){if(null==b)return f.decompress(b);for(var c=Array(b.length/2),d=0,e=c.length;d<e;d++)c[d]=256*b[2*d]+b[2*d+1];var g=[];return c.forEach(function(b){g.push(a(b))}),f.decompress(g.join(""))},compressToEncodedURIComponent:function(a){return null==a?"":f._compress(a,6,function(a){return c.charAt(a)})},decompressFromEncodedURIComponent:function(a){return null==a?"":""==a?null:(a=a.replace(/ /g,"+"),f._decompress(a.length,32,function(b){return e(c,a.charAt(b))}))},compress:function(b){return f._compress(b,16,function(b){return a(b)})},_compress:function(a,b,c){if(null==a)return"";var d,e,f,g={},h={},i="",j="",k="",l=2,m=3,n=2,o=[],p=0,q=0;for(f=0;f<a.length;f+=1)if(i=a.charAt(f),Object.prototype.hasOwnProperty.call(g,i)||(g[i]=m++,h[i]=!0),j=k+i,Object.prototype.hasOwnProperty.call(g,j))k=j;else{if(Object.prototype.hasOwnProperty.call(h,k)){if(256>k.charCodeAt(0)){for(d=0;d<n;d++)p<<=1,q==b-1?(q=0,o.push(c(p)),p=0):q++;for(d=0,e=k.charCodeAt(0);d<8;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1}else{for(d=0,e=1;d<n;d++)p=p<<1|e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e=0;for(d=0,e=k.charCodeAt(0);d<16;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1}0==--l&&(l=Math.pow(2,n),n++),delete h[k]}else for(d=0,e=g[k];d<n;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1;0==--l&&(l=Math.pow(2,n),n++),g[j]=m++,k=String(i)}if(""!==k){if(Object.prototype.hasOwnProperty.call(h,k)){if(256>k.charCodeAt(0)){for(d=0;d<n;d++)p<<=1,q==b-1?(q=0,o.push(c(p)),p=0):q++;for(d=0,e=k.charCodeAt(0);d<8;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1}else{for(d=0,e=1;d<n;d++)p=p<<1|e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e=0;for(d=0,e=k.charCodeAt(0);d<16;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1}0==--l&&(l=Math.pow(2,n),n++),delete h[k]}else for(d=0,e=g[k];d<n;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1;0==--l&&(l=Math.pow(2,n),n++)}for(d=0,e=2;d<n;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1;for(;;){if(p<<=1,q==b-1){o.push(c(p));break}q++}return o.join("")},decompress:function(a){return null==a?"":""==a?null:f._decompress(a.length,32768,function(b){return a.charCodeAt(b)})},_decompress:function(b,c,d){var e,f,g,h,i,j,k,l=[],m=4,n=4,o=3,p="",q=[],r={val:d(0),position:c,index:1};for(e=0;e<3;e+=1)l[e]=e;for(g=0,i=4,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;switch(g){case 0:for(g=0,i=256,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;k=a(g);break;case 1:for(g=0,i=65536,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;k=a(g);break;case 2:return""}for(l[3]=k,f=k,q.push(k);;){if(r.index>b)return"";for(g=0,i=Math.pow(2,o),j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;switch(k=g){case 0:for(g=0,i=256,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;l[n++]=a(g),k=n-1,m--;break;case 1:for(g=0,i=65536,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;l[n++]=a(g),k=n-1,m--;break;case 2:return q.join("")}if(0==m&&(m=Math.pow(2,o),o++),l[k])p=l[k];else{if(k!==n)return null;p=f+f.charAt(0)}q.push(p),l[n++]=f+p.charAt(0),m--,f=p,0==m&&(m=Math.pow(2,o),o++)}}};return f}();if("function"==typeof define&&define.amd)a.r,void 0!==d&&a.v(d);else null!=b?b.exports=d:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return d})},76081,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o;var p,q,r,s,t,u,v,w,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a$,a_,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT=a.i(87924);let bU="__TLDRAW_LIBRARY_VERSIONS__";function bV(a,b,c){if(!a||!b||!c)throw Error("Missing name/version/module system in built version of tldraw library");let d=function(){if(globalThis[bU])return globalThis[bU];let a={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,bU,{value:a,writable:!1,configurable:!1,enumerable:!1}),a}();if(d.versions.push({name:a,version:b,modules:c}),!d.scheduledNotice)try{d.scheduledNotice=setTimeout(()=>{d.scheduledNotice=null,bW(d)},100)}catch{bW(d)}}function bW(a){if(!a.versions.length||a.didWarn)return;let b=a.versions.sort((a,b)=>bX(a.version,b.version)),c=b[b.length-1].version,d=new Set,e=new Map;for(let a of b){if(e.has(a.name)){d.delete(a.name),b$(e,a.name,new Set).add(a.version);continue}a.version===c?d.add(a.name):(d.delete(a.name),b$(e,a.name,new Set).add(a.version))}if(e.size>0){console.log([`${bZ("[tldraw]",["bold","bgRed","textWhite"])} ${bZ("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${bZ(`v${c}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(d,a=>`  \u2022 \u2705 ${bZ(a,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(e,([a,b])=>{let d=Array.from(b).sort(bX).map(a=>bZ(`v${a}`,a===c?["textGreen"]:["textRed"]));return`  \u2022 \u274C ${bZ(a,["bold"])} (${d.join(", ")})`})].join("\n")),a.didWarn=!0;return}let f=new Map;for(let a of b)b$(f,a.name,{version:a.version,modules:[]}).modules.push(a.modules);let g=new Map;for(let[a,b]of f)b.modules.length>1&&g.set(a,b);if(g.size>0){console.log([`${bZ("[tldraw]",["bold","bgRed","textWhite"])} ${bZ("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(g,([a,b])=>{let c=b.modules.map((a,b)=>"esm"===a?`      ${b+1}. ES Modules`:`      ${b+1}. CommonJS`).join("\n");return`  \u2022 \u274C ${bZ(a,["bold"])} v${b.version}: 
${c}`}),"","You should configure your bundler to only import one version of each library."].join("\n")),a.didWarn=!0;return}}function bX(a,b){let c=a.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),d=b.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return c&&d?c[1]!==d[1]?Number(c[1])-Number(d[1]):c[2]!==d[2]?Number(c[2])-Number(d[2]):c[3]!==d[3]?Number(c[3])-Number(d[3]):c[4]&&d[4]?c[4].localeCompare(d[4]):c[4]?1:d[4]?-1:0:a.localeCompare(b)}let bY={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function bZ(a,b=[]){return`\x1b[${b.map(a=>bY[a]).join(";")}m${a}\x1b[m`}function b$(a,b,c){return a.has(b)?a.get(b):(a.set(b,c),c)}var b_=a.i(40642),b0=a.i(23401),b1=a.i(65938),b2=a.i(79644);function b3(a,b){if(0===a.length)return[];let c=(Math.abs(b)%a.length+a.length)%a.length;return[...a.slice(c),...a.slice(0,c)]}function b4(a,b){let c=[];d:for(let d of a){for(let a of c)if(b?b(d,a):d===a)continue d;c.push(d)}return c}function b5(a){return a.filter(a=>null!=a)}function b6(a){return a[a.length-1]}function b7(a,b){let c,d=1/0;for(let e of a){let a=b(e);a<d&&(c=e,d=a)}return c}function b8(a,b){let c,d=-1/0;for(let e of a){let a=b(e);a>d&&(c=e,d=a)}return c}function b9(a,b){let c=[],d=[];for(let e of a)b(e)?c.push(e):d.push(e);return[c,d]}function ca(a,b){if(a===b)return!0;if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(!Object.is(a[c],b[c]))return!1;return!0}function cb(a,b,c){let d=new Set(b.map(b=>b[a])),e=[];for(let b of c)d.has(b[a])||e.push(b);for(let a of b)e.push(a);return e}function cc(a){let b=(...c)=>{try{return a(...c)}catch(a){throw a instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(a,b),a}};return b}let cd=()=>{},ce={ok:a=>({ok:!0,value:a}),err:a=>({ok:!1,error:a})};function cf(a,b){let c=b&&a&&"object"==typeof a&&b in a?a[b]:a;throw Error(`Unknown switch case ${c}`)}let cg=cc((a,b)=>{if(!a)throw Error(b||"Assertion Error")}),ch=cc((a,b)=>{if(null==a)throw Error(b??"value must be defined");return a});function ci(){let a,b;return Object.assign(new Promise((c,d)=>{a=c,b=d}),{resolve:a,reject:b})}function cj(a){return new Promise(b=>setTimeout(b,a))}function ck(...a){if(2===a.length){let[b,c]=a;c.addInitializer(function(){cg(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");let a=b.bind(this);cg(Reflect.defineProperty(this,c.name,{value:a,writable:!0,configurable:!0}),"Cannot bind a non-configurable class method.")})}else{let[b,c,d]=a;if(!d||"function"!=typeof d.value)throw TypeError(`Only methods can be decorated with @bind. <${c}> is not a method!`);return{configurable:!0,get(){let a=d.value.bind(this);return Object.defineProperty(this,c,{value:a,configurable:!0,writable:!0}),a}}}}class cl{items=new WeakMap;get(a,b){return this.items.has(a)||this.items.set(a,b(a)),this.items.get(a)}}function cm(a,b){let c,d=(...d)=>(c||((c={}).promise=new Promise((a,b)=>{c.resolve=a,c.reject=b})),clearTimeout(c.timeout),c.latestArgs=d,c.timeout=setTimeout(()=>{let b=c;c=void 0;try{b.resolve(a(...b.latestArgs))}catch(a){b.reject(a)}},b),c.promise);return d.cancel=()=>{c&&clearTimeout(c.timeout)},d}let cn=new WeakMap;function co(a,b){if("object"!=typeof a||null===a)return;let c=cn.get(a);c||(c={tags:{},extras:{}},cn.set(a,c)),b.tags&&(c.tags={...c.tags,...b.tags}),b.extras&&(c.extras={...c.extras,...b.extras})}function cp(a){return cn.get(a)??{tags:{},extras:{}}}class cq{constructor(a){this.timeout=a}queue=[];running=!1;isEmpty(){return 0===this.queue.length&&!this.running}async run(){if(!this.running)try{for(this.running=!0;this.queue.length;){let a=this.queue.shift();await a(),this.timeout&&await cj(this.timeout)}}finally{this.running=!1}}async push(a){return new Promise((b,c)=>{this.queue.push(()=>Promise.resolve(a()).then(b).catch(c)),this.run()})}close(){this.queue=[]}}async function cr(a,b){return window.fetch(a,{referrerPolicy:"strict-origin-when-cross-origin",...b})}let cs=(a,b)=>{let c=new window.Image(a,b);return c.referrerPolicy="strict-origin-when-cross-origin",c};class ct{static async urlToArrayBuffer(a){let b=await cr(a);return await b.arrayBuffer()}static async urlToBlob(a){let b=await cr(a);return await b.blob()}static async urlToDataUrl(a){if(a.startsWith("data:"))return a;let b=await ct.urlToBlob(a);return await ct.blobToDataUrl(b)}static async blobToDataUrl(a){return await new Promise((b,c)=>{if(a){let d=new FileReader;d.onload=()=>b(d.result),d.onerror=a=>c(a),d.onabort=a=>c(a),d.readAsDataURL(a)}})}static async blobToText(a){return await new Promise((b,c)=>{if(a){let d=new FileReader;d.onload=()=>b(d.result),d.onerror=a=>c(a),d.onabort=a=>c(a),d.readAsText(a)}})}static rewriteMimeType(a,b){return a.type===b?a:a instanceof File?new File([a],a.name,{type:b}):new Blob([a],{type:b})}}function cu(a){let b=0;for(let c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c)|0;return b+""}function cv(a){return cu(JSON.stringify(a))}function cw(a){let b=new DataView(a),c=0;for(let a=0;a<b.byteLength;a++)c=(c<<5)-c+b.getUint8(a)|0;return c+""}function cx(a){let b=a.split("");return b.push(...b.splice(0,Math.round(b.length/5))),b.push(...b.splice(0,Math.round(b.length/4))),b.push(...b.splice(0,Math.round(b.length/3))),b.push(...b.splice(0,Math.round(b.length/2))),b.reverse().map(a=>+a?5>+a?5+ +a:+a>5?a-5:a:a).join("")}let cy=globalThis.crypto;function cz(a=21){var d;d=a-=0,!b||b.length<d?(b=new Uint8Array(128*d),cy.getRandomValues(b),c=0):c+d>b.length&&(cy.getRandomValues(b),c=0),c+=d;let e="";for(let d=c-a;d<c;d++)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&b[d]];return e}let cA=cz;function cB(a){cA=a}function cC(){cA=cz}function cD(a){return cA(a)}function cE(a){return a.values().next().value}function cF(a,b){let c=0;for(;a[b+c];)c+=a[b+c]+1;return c+1}let cG=[0,0x77073096,0xee0e612c,0x990951ba,0x76dc419,0x706af48f,0xe963a535,0x9e6495a3,0xedb8832,0x79dcb8a4,0xe0d5e91e,0x97d2d988,0x9b64c2b,0x7eb17cbd,0xe7b82d07,0x90bf1d91,0x1db71064,0x6ab020f2,0xf3b97148,0x84be41de,0x1adad47d,0x6ddde4eb,0xf4d4b551,0x83d385c7,0x136c9856,0x646ba8c0,0xfd62f97a,0x8a65c9ec,0x14015c4f,0x63066cd9,0xfa0f3d63,0x8d080df5,0x3b6e20c8,0x4c69105e,0xd56041e4,0xa2677172,0x3c03e4d1,0x4b04d447,0xd20d85fd,0xa50ab56b,0x35b5a8fa,0x42b2986c,0xdbbbc9d6,0xacbcf940,0x32d86ce3,0x45df5c75,0xdcd60dcf,0xabd13d59,0x26d930ac,0x51de003a,0xc8d75180,0xbfd06116,0x21b4f4b5,0x56b3c423,0xcfba9599,0xb8bda50f,0x2802b89e,0x5f058808,0xc60cd9b2,0xb10be924,0x2f6f7c87,0x58684c11,0xc1611dab,0xb6662d3d,0x76dc4190,0x1db7106,0x98d220bc,0xefd5102a,0x71b18589,0x6b6b51f,0x9fbfe4a5,0xe8b8d433,0x7807c9a2,0xf00f934,0x9609a88e,0xe10e9818,0x7f6a0dbb,0x86d3d2d,0x91646c97,0xe6635c01,0x6b6b51f4,0x1c6c6162,0x856530d8,0xf262004e,0x6c0695ed,0x1b01a57b,0x8208f4c1,0xf50fc457,0x65b0d9c6,0x12b7e950,0x8bbeb8ea,0xfcb9887c,0x62dd1ddf,0x15da2d49,0x8cd37cf3,0xfbd44c65,0x4db26158,0x3ab551ce,0xa3bc0074,0xd4bb30e2,0x4adfa541,0x3dd895d7,0xa4d1c46d,0xd3d6f4fb,0x4369e96a,0x346ed9fc,0xad678846,0xda60b8d0,0x44042d73,0x33031de5,0xaa0a4c5f,0xdd0d7cc9,0x5005713c,0x270241aa,0xbe0b1010,0xc90c2086,0x5768b525,0x206f85b3,0xb966d409,0xce61e49f,0x5edef90e,0x29d9c998,0xb0d09822,0xc7d7a8b4,0x59b33d17,0x2eb40d81,0xb7bd5c3b,0xc0ba6cad,0xedb88320,0x9abfb3b6,0x3b6e20c,0x74b1d29a,0xead54739,0x9dd277af,0x4db2615,0x73dc1683,0xe3630b12,0x94643b84,0xd6d6a3e,0x7a6a5aa8,0xe40ecf0b,0x9309ff9d,0xa00ae27,0x7d079eb1,0xf00f9344,0x8708a3d2,0x1e01f268,0x6906c2fe,0xf762575d,0x806567cb,0x196c3671,0x6e6b06e7,0xfed41b76,0x89d32be0,0x10da7a5a,0x67dd4acc,0xf9b9df6f,0x8ebeeff9,0x17b7be43,0x60b08ed5,0xd6d6a3e8,0xa1d1937e,0x38d8c2c4,0x4fdff252,0xd1bb67f1,0xa6bc5767,0x3fb506dd,0x48b2364b,0xd80d2bda,0xaf0a1b4c,0x36034af6,0x41047a60,0xdf60efc3,0xa867df55,0x316e8eef,0x4669be79,0xcb61b38c,0xbc66831a,0x256fd2a0,0x5268e236,0xcc0c7795,0xbb0b4703,0x220216b9,0x5505262f,0xc5ba3bbe,0xb2bd0b28,0x2bb45a92,0x5cb36a04,0xc2d7ffa7,0xb5d0cf31,0x2cd99e8b,0x5bdeae1d,0x9b64c2b0,0xec63f226,0x756aa39c,0x26d930a,0x9c0906a9,0xeb0e363f,0x72076785,0x5005713,0x95bf4a82,0xe2b87a14,0x7bb12bae,0xcb61b38,0x92d28e9b,0xe5d5be0d,0x7cdcefb7,0xbdbdf21,0x86d3d2d4,0xf1d4e242,0x68ddb3f8,0x1fda836e,0x81be16cd,0xf6b9265b,0x6fb077e1,0x18b74777,0x88085ae6,0xff0f6a70,0x66063bca,0x11010b5c,0x8f659eff,0xf862ae69,0x616bffd3,0x166ccf45,0xa00ae278,0xd70dd2ee,0x4e048354,0x3903b3c2,0xa7672661,0xd06016f7,0x4969474d,0x3e6e77db,0xaed16a4a,0xd9d65adc,0x40df0b66,936918e3,0xa9bcae53,0xdebb9ec5,0x47b2cf7f,0x30b5ffe9,0xbdbdf21c,0xcabac28a,0x53b39330,0x24b4a3a6,0xbad03605,0xcdd70693,0x54de5729,0x23d967bf,0xb3667a2e,0xc4614ab8,0x5d681b02,0x2a6f2b94,0xb40bbe37,0xc30c8ea1,0x5a05df1b,0x2d02ef8d];"undefined"!=typeof Int32Array&&(cG=new Int32Array(cG));class cH{static isPng(a,b){return 137===a.getUint8(b+0)&&80===a.getUint8(b+1)&&78===a.getUint8(b+2)&&71===a.getUint8(b+3)&&13===a.getUint8(b+4)&&10===a.getUint8(b+5)&&26===a.getUint8(b+6)&&10===a.getUint8(b+7)||!1}static getChunkType(a,b){return[String.fromCharCode(a.getUint8(b)),String.fromCharCode(a.getUint8(b+1)),String.fromCharCode(a.getUint8(b+2)),String.fromCharCode(a.getUint8(b+3))].join("")}static readChunks(a,b=0){let c={};if(!cH.isPng(a,b))throw Error("Not a PNG");for(b+=8;b<=a.buffer.byteLength;){let d=b,e=a.getInt32(b);b+=4;let f=cH.getChunkType(a,b);if("IDAT"===f&&c[f]){b+=e+4+4;continue}if("IEND"===f)break;c[f]={start:d,dataOffset:b+4,size:e},b+=e+4+4}return c}static parsePhys(a,b){return{ppux:a.getUint32(b),ppuy:a.getUint32(b+4),unit:a.getUint8(b+8)}}static findChunk(a,b){return cH.readChunks(a)[b]}static setPhysChunk(a,b=1,c){let d=46,e=0,f=cH.findChunk(a,"pHYs");f&&(d=f.start,e=f.size);let g=cH.findChunk(a,"IDAT");g&&(d=g.start,e=0);let h=new ArrayBuffer(21),i=new DataView(h);i.setUint32(0,9),i.setUint8(4,112),i.setUint8(5,72),i.setUint8(6,89),i.setUint8(7,115),i.setInt32(8,2835.5*b),i.setInt32(12,2835.5*b),i.setInt8(16,1);let j=new Uint8Array(h.slice(4,17));return i.setInt32(17,((a,b)=>{let c=0===b?0:-1^~~b;for(let b=0;b<a.length;b++)c=cG[(c^a[b])&255]^c>>>8;return -1^c})(j)),new Blob([a.buffer.slice(0,d),h,a.buffer.slice(d+e)],c)}}let cI=Object.freeze(["image/svg+xml"]),cJ=Object.freeze(["image/jpeg","image/png","image/webp"]),cK=Object.freeze(["image/gif","image/apng","image/avif"]),cL=Object.freeze([...cJ,...cI,...cK]),cM=Object.freeze(["video/mp4","video/webm","video/quicktime"]),cN=Object.freeze([...cL,...cM]),cO=cN.join(",");class cP{static loadVideo(a){return new Promise((b,c)=>{let d=document.createElement("video");d.onloadeddata=()=>b(d),d.onerror=a=>{console.error(a),c(Error("Could not load video"))},d.crossOrigin="anonymous",d.src=a})}static async getVideoFrameAsDataUrl(a,b=0){let c=ci(),d=!1,e=()=>{if(!d)if(!(a.readyState>=a.HAVE_METADATA))return;else d=!0,a.currentTime=b;if(a.readyState>=a.HAVE_CURRENT_DATA){let b=document.createElement("canvas");b.width=a.videoWidth,b.height=a.videoHeight;let d=b.getContext("2d");if(!d)throw Error("Could not get 2d context");d.drawImage(a,0,0),c.resolve(b.toDataURL())}},f=a=>{console.error(a),c.reject(Error("Could not get video frame"))};a.addEventListener("loadedmetadata",e),a.addEventListener("loadeddata",e),a.addEventListener("canplay",e),a.addEventListener("seeked",e),a.addEventListener("error",f),a.addEventListener("stalled",f),e();try{return await c}finally{a.removeEventListener("loadedmetadata",e),a.removeEventListener("loadeddata",e),a.removeEventListener("canplay",e),a.removeEventListener("seeked",e),a.removeEventListener("error",f),a.removeEventListener("stalled",f)}}static getImageAndDimensions(a){return new Promise((b,c)=>{let d=cs();d.onload=()=>{let a;d.naturalWidth?a={w:d.naturalWidth,h:d.naturalHeight}:(document.body.appendChild(d),a={w:d.clientWidth,h:d.clientHeight},document.body.removeChild(d)),b({...a,image:d})},d.onerror=a=>{console.error(a),c(Error("Could not load image"))},d.crossOrigin="anonymous",d.referrerPolicy="strict-origin-when-cross-origin",d.style.visibility="hidden",d.style.position="absolute",d.style.opacity="0",d.style.zIndex="-9999",d.src=a})}static async getVideoSize(a){return cP.usingObjectURL(a,async a=>{let b=await cP.loadVideo(a);return{w:b.videoWidth,h:b.videoHeight}})}static async getImageSize(a){let{w:b,h:c}=await cP.usingObjectURL(a,cP.getImageAndDimensions);try{if("image/png"===a.type){let d=new DataView(await a.arrayBuffer());if(cH.isPng(d,0)){let a=cH.findChunk(d,"pHYs");if(a){let e=cH.parsePhys(d,a.dataOffset);if(1===e.unit&&e.ppux===e.ppuy){let a=Math.max(e.ppux/(72/.0254),1);return{w:Math.round(b/a),h:Math.round(c/a)}}}}}}catch(a){console.error(a)}return{w:b,h:c}}static async isAnimated(a){if("image/gif"===a.type)return function(a){let b,c,d=new Uint8Array(a),e=0,f=0;if("GIF"!==new TextDecoder("ascii").decode(a.slice(0,3)))return!1;for(b=128&d[10],c=7&d[10],e+=6,e+=7,e+=b?3*Math.pow(2,c+1):0;f<2&&e<d.length;)switch(d[e]){case 44:f+=1,b=128&d[e+9],c=7&d[e+9],e+=10,e+=b?3*Math.pow(2,c+1):0,e+=cF(d,e+1)+1;break;case 33:e+=2,e+=cF(d,e);break;default:e=d.length}return f>1}(await a.arrayBuffer());if("image/avif"===a.type)return 44===new Uint8Array(await a.arrayBuffer())[3];if("image/webp"===a.type){let b;return b=new Uint8Array(await a.arrayBuffer()),!(b.length<12)&&87===b[8]&&69===b[9]&&66===b[10]&&80===b[11]&&!!b&&!(b.length<21)&&(b[20]>>1&1)==1}return"image/apng"===a.type&&function(a){let b=new Uint8Array(a);if(!b||!("undefined"!=typeof Buffer&&Buffer.isBuffer(b)||b instanceof Uint8Array)||b.length<16||137!==b[0]||80!==b[1]||78!==b[2]||71!==b[3]||13!==b[4]||10!==b[5]||26!==b[6]||10!==b[7])return!1;function c(a,b,d,e,f=1024){if(!b)return -1;let g=(b=RegExp(b,"g")).source.length,h=new TextDecoder,i=a.length;if(void 0===e&&(e=i),d>=i||e<=0||d>=e)return -1;a=a.subarray(d,e);let j=-1,k=0,l=0,m="";a:for(;k<a.length;){let c,d=k+f,e=a.subarray(k,d),i=h.decode(e,{stream:!0}),n=m+i,o=-1;for(;null!==(c=b.exec(n));){j=l+(o=c.index-m.length);break a}k=d,l+=i.length;let p=o>-1?o+g:i.length-g;m=i.slice(p)}return j>=0&&(j+=d>=0?d:i+d),j}let d=c(b,"IDAT",12);return d>=12&&c(b,"acTL",8,d)>=8}(await a.arrayBuffer())}static isAnimatedImageType(a){return cK.includes(a||"")}static isStaticImageType(a){return cJ.includes(a||"")}static isVectorImageType(a){return cI.includes(a||"")}static isImageType(a){return cL.includes(a||"")}static async usingObjectURL(a,b){let c=URL.createObjectURL(a);try{return await b(c)}finally{URL.revokeObjectURL(c)}}}function cQ(a,b,c){return a+(b-a)*c}function cR(a,b,c){return(c-a)/(b-a)}function cS(a=""){let b=0,c=0,d=0,e=0;function f(){let a=b^b<<11;return b=c,c=d,d=e,(e^=(e>>>19^a^a>>>8)>>>0)/0x100000000*2}for(let c=0;c<a.length+64;c++)b^=a.charCodeAt(c),f();return f}function cT(a,b,c,d=!1){let[e,f]=b,[g,h]=c,i=g+(a-e)/(f-e)*(h-g);return d?g<h?Math.max(Math.min(i,h),g):Math.max(Math.min(i,g),h):i}function cU(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function cV(a,b){if(cU(a,b))return a[b]}function cW(a){return Object.keys(a)}function cX(a){return Object.values(a)}function cY(a){return Object.entries(a)}function*cZ(a){for(let b in a)Object.prototype.hasOwnProperty.call(a,b)&&(yield[b,a[b]])}function c$(a){return Object.fromEntries(a)}function c_(a,b){let c={},d=!1;for(let[e,f]of cY(a))b(e,f)?c[e]=f:d=!0;return d?c:a}function c0(a,b){let c={};for(let d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=b(d,a[d]));return c}function c1(a,b){if(a===b)return!0;let c=new Set(Object.keys(a)),d=new Set(Object.keys(b));if(c.size!==d.size)return!1;for(let e of c)if(!d.has(e)||!Object.is(a[e],b[e]))return!1;return!0}function c2(a,b){let c={};for(let d of a){let a=b(d);c[a]||(c[a]=[]),c[a].push(d)}return c}function c3(a,b){let c={...a};for(let a of b)delete c[a];return c}function c4(a,b){let c=[];for(let d in a)Object.is(a[d],b[d])||c.push(d);return c}function c5(a,b,c=1e-6){return(0,b0.default)(a,b,(a,b)=>{if("number"==typeof a&&"number"==typeof b)return Math.abs(a-b)<c})}let c6="#40C057",c7="#FFC078";function c8(a,b){let c=performance.now(),d=b();return console.debug(`%cPerf%c ${a} took ${performance.now()-c}ms`,`color: white; background: ${c6};padding: 2px;border-radius: 3px;`,"font-weight: normal"),d}function c9(a,b,c){let d=c.value;return c.value=function(...a){let c=performance.now(),e=d.apply(this,a);return console.debug(`%cPerf%c ${b} took: ${performance.now()-c}ms`,`color: white; background: ${c6};padding: 2px;border-radius: 3px;`,"font-weight: normal"),e},c}let da=new Map;function db(a,b,c){let d=c.value;return c.value=function(...a){let e=performance.now(),f=d.apply(this,a),g=performance.now(),h=g-e;if(0!==h){let a=da.get(c.value),d=a.total+h,f=a.count+1;da.set(c.value,{total:d,count:f}),console.debug(`%cPerf%c ${b} took ${(g-e).toFixed(2)}ms | average ${(d/f).toFixed(2)}ms`,`color: white; background: ${c6};padding: 2px;border-radius: 3px;`,"font-weight: normal")}return f},da.set(c.value,{total:0,count:0}),c}class dc{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(a){this.name=a,this.frames=0,this.started=!0,null!==this.frame&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,null!==this.frame&&cancelAnimationFrame(this.frame);let a=(performance.now()-this.startTime)/1e3,b=0===a?0:Math.floor(this.frames/a),c=b>55?c6:b>30?c7:"#E03131",d=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${d} %c${b}%c fps`,`color: white; background: ${c6};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${c};color: ${c===c7?"black":"white"};`,"font-weight: normal")}isStarted(){return this.started}}let dd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function de(a,b,c){let d=c[0];if(null!=b&&a>=b)throw Error(a+" >= "+b);if(a.slice(-1)===d||b&&b.slice(-1)===d)throw Error("trailing zero");if(b){let e=0;for(;(a[e]||d)===b[e];)e++;if(e>0)return b.slice(0,e)+de(a.slice(e),b.slice(e),c)}let e=a?c.indexOf(a[0]):0,f=null!=b?c.indexOf(b[0]):c.length;return f-e>1?c[Math.round(.5*(e+f))]:b&&b.length>1?b.slice(0,1):c[e]+de(a.slice(1),null,c)}function df(a){if(a.length!==dg(a[0]))throw Error("invalid integer part of order key: "+a)}function dg(a){if(a>="a"&&a<="z")return a.charCodeAt(0)-97+2;if(a>="A"&&a<="Z")return 90-a.charCodeAt(0)+2;throw Error("invalid order key head: "+a)}function dh(a){let b=dg(a[0]);if(b>a.length)throw Error("invalid order key: "+a);return a.slice(0,b)}function di(a,b){if(a==="A"+b[0].repeat(26))throw Error("invalid order key: "+a);let c=dh(a);if(a.slice(c.length).slice(-1)===b[0])throw Error("invalid order key: "+a)}function dj(a,b){df(a);let[c,...d]=a.split(""),e=!0;for(let a=d.length-1;e&&a>=0;a--){let c=b.indexOf(d[a])+1;c===b.length?d[a]=b[0]:(d[a]=b[c],e=!1)}if(!e)return c+d.join("");{if("Z"===c)return"a"+b[0];if("z"===c)return null;let a=String.fromCharCode(c.charCodeAt(0)+1);return a>"a"?d.push(b[0]):d.pop(),a+d.join("")}}function dk(a,b,c=dd){if(null!=a&&di(a,c),null!=b&&di(b,c),null!=a&&null!=b&&a>=b)throw Error(a+" >= "+b);if(null==a){if(null==b)return"a"+c[0];let a=dh(b),d=b.slice(a.length);if(a==="A"+c[0].repeat(26))return a+de("",d,c);if(a<b)return a;let e=function(a,b){df(a);let[c,...d]=a.split(""),e=!0;for(let a=d.length-1;e&&a>=0;a--){let c=b.indexOf(d[a])-1;-1===c?d[a]=b.slice(-1):(d[a]=b[c],e=!1)}if(!e)return c+d.join("");{if("a"===c)return"Z"+b.slice(-1);if("A"===c)return null;let a=String.fromCharCode(c.charCodeAt(0)-1);return a<"Z"?d.push(b.slice(-1)):d.pop(),a+d.join("")}}(a,c);if(null==e)throw Error("cannot decrement any more");return e}if(null==b){let b=dh(a),d=a.slice(b.length),e=dj(b,c);return null==e?b+de(d,null,c):e}let d=dh(a),e=a.slice(d.length),f=dh(b),g=b.slice(f.length);if(d===f)return d+de(e,g,c);let h=dj(d,c);if(null==h)throw Error("cannot increment any more");return h<b?h:d+de(e,null,c)}function dl(a,b,c,d=dd){if(0===c)return[];if(1===c)return[dk(a,b,d)];if(null==b){let e=dk(a,b,d),f=[e];for(let a=0;a<c-1;a++)f.push(e=dk(e,b,d));return f}if(null==a){let e=dk(a,b,d),f=[e];for(let b=0;b<c-1;b++)f.push(e=dk(a,e,d));return f.reverse(),f}let e=Math.floor(c/2),f=dk(a,b,d);return[...dl(a,f,e,d),f,...dl(f,b,c-e-1,d)]}let dm=()=>.5>Math.random();function dn(a,b){if(!Number.isInteger(b))throw Error(`"${a}" must be an integer, got '${b}'`);if(b<0)throw Error(`"${a}" must be greater than or equal to 0, got '${b}'`)}function dp(a,b,c){let{digits:d,jitterBits:e=30,getRandomBit:f=dm}=c??{};dn("jitterBits",e);let g=e,h=a,i=b,j=dk(a,b,d);for(;g>0;)1==+!!f()?h=j:i=j,j=dk(h,i,d),g--;return j}let dq=function(a,b,c,d){let{digits:e,jitterBits:f}=d??{};if(dn("n",c),0===c)return[];if(0===f)return dl(a,b,c,e);let g=dl(a,b,c+1,e),h=[];for(let a=0;a<c;a++){let b=g[a],c=g[a+1];h.push(dp(b,c,d))}return h};function dr(a){try{dp(a,null)}catch{throw Error("invalid index: "+a)}}function ds(a,b,c){return dq(a??null,b??null,c)}function dt(a,b){return dq(a??null,null,b)}function du(a,b){return dq(null,a??null,b)}function dv(a,b){return dq(a??null,b??null,1)[0]}function dw(a=null){return dq(a,null,1)[0]}function dx(a=null){return dq(null,a,1)[0]}function dy(a,b="a1"){return[b,...dq(b,null,a)]}function dz(a,b){return a.index<b.index?-1:+(a.index>b.index)}function dA(a,b){return a.index&&b.index?a.index<b.index?-1:1:a.index&&null==b.index?-1:+(null!=a.index||null!=b.index)}async function dB(a,{attempts:b=3,waitDuration:c=1e3,abortSignal:d,matchError:e}={}){let f=null;for(let g=0;g<b;g++){if(d?.aborted)throw Error("aborted");try{return await a({attempt:g,remaining:b-g,total:b})}catch(a){if(e&&!e(a))throw a;f=a,await cj(c)}}throw f}function dC(a,b){return a.id>b.id?1:-1}function dD(a){try{return localStorage.getItem(a)}catch{return null}}function dE(a,b){try{localStorage.setItem(a,b)}catch{}}function dF(a){try{localStorage.removeItem(a)}catch{}}function dG(){try{localStorage.clear()}catch{}}function dH(a){try{return sessionStorage.getItem(a)}catch{return null}}function dI(a,b){try{sessionStorage.setItem(a,b)}catch{}}function dJ(a){try{sessionStorage.removeItem(a)}catch{}}function dK(){try{sessionStorage.clear()}catch{}}function dL(...a){let b={};for(let c of a)b[c]=c;return b}let dM=()=>"undefined"!=typeof process&&!1,dN=[],dO=.9*Math.floor(16.666666666666668),dP=-dO,dQ=()=>{for(let a of dN.splice(0,dN.length))a()};function dR(a=!1){if(d)return;let b=Date.now();if(b-dP<dO){d=requestAnimationFrame(()=>{d=void 0,dR(!0)});return}if(a){if(e)return;dP=b,dQ()}else{if(e)return;e=requestAnimationFrame(()=>{e=void 0,dP=b,dQ()})}}function dS(a){dM();let b=()=>{dN.includes(a)||(dN.push(a),dR())};return b.cancel=()=>{let b=dN.indexOf(a);b>-1&&dN.splice(b,1)},b}function dT(a){return dM(),dN.includes(a)||(dN.push(a),dR()),()=>{let b=dN.indexOf(a);b>-1&&dN.splice(b,1)}}class dU{timeouts=new Map;intervals=new Map;rafs=new Map;constructor(){this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(a,b,c,...d){let e=window.setTimeout(b,c,d),f=this.timeouts.get(a)??[];return this.timeouts.set(a,[...f,e]),e}setInterval(a,b,c,...d){let e=window.setInterval(b,c,d),f=this.intervals.get(a)??[];return this.intervals.set(a,[...f,e]),e}requestAnimationFrame(a,b){let c=window.requestAnimationFrame(b),d=this.rafs.get(a)??[];return this.rafs.set(a,[...d,c]),c}dispose(a){this.timeouts.get(a)?.forEach(a=>clearTimeout(a)),this.intervals.get(a)?.forEach(a=>clearInterval(a)),this.rafs.get(a)?.forEach(a=>cancelAnimationFrame(a)),this.timeouts.delete(a),this.intervals.delete(a),this.rafs.delete(a)}disposeAll(){for(let a of this.timeouts.keys())this.dispose(a)}forContext(a){return{setTimeout:(b,c,...d)=>this.setTimeout(a,b,c,d),setInterval:(b,c,...d)=>this.setInterval(a,b,c,d),requestAnimationFrame:b=>this.requestAnimationFrame(a,b),dispose:()=>this.dispose(a)}}}let dV=(a,b)=>{try{return new URL(a,b)}catch{return}};function dW(a){return void 0!==a}function dX(a){return null!==a}function dY(a){return null!=a}let dZ="undefined"!=typeof globalThis&&globalThis.structuredClone?[globalThis.structuredClone,!0]:a.g.structuredClone?[a.g.structuredClone,!0]:[a=>a?JSON.parse(JSON.stringify(a)):a,!1],d$=dZ[0],d_=dZ[1],d0=Object.getPrototypeOf(d$({})),d1=new Set;function d2(a){d3(`Using '${a}' is deprecated and will be removed in the near future. Please refactor to use 'get${a[0].toLocaleUpperCase()}${a.slice(1)}' instead.`)}function d3(a){d1.has(a)||(d1.add(a),console.warn(`[tldraw] ${a}`))}function d4(a){return a&&"object"==typeof a&&"parents"in a}function d5(a){for(let b=0,c=a.parents.length;b<c;b++)if(a.parents[b].__unsafe__getWithoutCapture(!0),a.parents[b].lastChangedEpoch!==a.parentEpochs[b])return!0;return!1}function d6(a,b){if(a.children.remove(b)&&a.children.isEmpty&&d4(a))for(let b=0,c=a.parents.length;b<c;b++)d6(a.parents[b],a)}function d7(a,b){if(a.children.add(b)&&d4(a))for(let b=0,c=a.parents.length;b<c;b++)d7(a.parents[b],a)}function d8(a,b){return a===b||Object.is(a,b)||!!(a&&b&&"function"==typeof a.equals&&a.equals(b))}function d9(a,b){let c=Symbol.for(`com.tldraw.state/${a}`),d=globalThis;return d[c]??=b(),d[c]}bV("@tldraw/utils","4.2.0","esm"),a.s([],75599),a.i(33616),a.i(35380),a.i(7532),a.i(63010),a.i(54170);let ea=d9("empty_array",()=>Object.freeze([]));class eb{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw Error("no set or array")}add(a){if(this.array)return -1===this.array.indexOf(a)&&(this.arraySize<8?(this.array[this.arraySize]=a,this.arraySize++):(this.set=new Set(this.array),this.array=null,this.set.add(a)),!0);if(this.set)return!this.set.has(a)&&(this.set.add(a),!0);throw Error("no set or array")}remove(a){if(this.array){let b=this.array.indexOf(a);return -1!==b&&(this.array[b]=void 0,this.arraySize--,b!==this.arraySize&&(this.array[b]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(a)&&(this.set.delete(a),!0);throw Error("no set or array")}visit(a){if(this.array){for(let b=0;b<this.arraySize;b++){let c=this.array[b];void 0!==c&&a(c)}return}if(this.set)return void this.set.forEach(a);throw Error("no set or array")}*[Symbol.iterator](){if(this.array)for(let a=0;a<this.arraySize;a++){let b=this.array[a];void 0!==b&&(yield b)}else if(this.set)yield*this.set;else throw Error("no set or array")}has(a){return this.array?-1!==this.array.indexOf(a):this.set.has(a)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}let ec=Symbol.for("com.tldraw.state/RESET_VALUE");class ed{constructor(a){this.capacity=a,this.buffer=Array(a)}index=0;buffer;pushEntry(a,b,c){if(void 0!==c){if(c===ec)return void this.clear();this.buffer[this.index]=[a,b,c],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(a){let{index:b,capacity:c,buffer:d}=this;for(let e=0;e<c;e++){let f=(b-1+c-e)%c,g=d[f];if(!g)break;let[h,i]=g;if(0===e&&a>=i)return[];if(h<=a&&a<i){let a=e+1,b=Array(a);for(let e=0;e<a;e++)b[e]=d[(f+e)%c][2];return b}}return ec}}class ee{constructor(a,b,c){this.name=a,this.runEffect=b,this._scheduleEffect=c?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;__debug_ancestor_epochs__=null;get scheduleCount(){return this._scheduleCount}parentSet=new eb;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==ek()){if(this.parents.length&&!d5(this)){this.lastReactedEpoch=ek();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let a=0,b=this.parents.length;a<b;a++)d7(this.parents[a],this)}detach(){this._isActivelyListening=!1;for(let a=0,b=this.parents.length;a<b;a++)d6(this.parents[a],this)}execute(){try{eG(this);let a=ek(),b=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=a,b}finally{eH()}}}let ef=d9("EffectScheduler",()=>ee);function eg(a,b,c){let d=new ef(a,b,c);return d.attach(),d.scheduleEffect(),()=>{d.detach()}}function eh(a,b,c){let d=new ef(a,b,c);return{scheduler:d,start:a=>{let b=a?.force??!1;d.attach(),b?d.scheduleEffect():d.maybeScheduleEffect()},stop:()=>{d.detach()}}}class ei{constructor(a,b){this.parent=a,this.isSync=b}asyncProcessCount=0;initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){if(ej.globalIsReacting)for(let a of this.initialAtomValues.keys())en(a);else this.isRoot?em(this.initialAtomValues.keys()):this.initialAtomValues.forEach((a,b)=>{this.parent.initialAtomValues.has(b)||this.parent.initialAtomValues.set(b,a)})}abort(){ej.globalEpoch++,this.initialAtomValues.forEach((a,b)=>{b.set(a),b.historyBuffer?.clear()}),this.commit()}}let ej=d9("transactions",()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:0}));function ek(){return ej.globalEpoch}function el(a,b){b.lastTraversedEpoch!==ej.globalEpoch&&(b.lastTraversedEpoch=ej.globalEpoch,b instanceof ef?a.add(b):b.children.visit(b=>el(a,b)))}function em(a){if(ej.globalIsReacting)throw Error("flushChanges cannot be called during a reaction");let b=ej.currentTransaction;try{ej.currentTransaction=null,ej.globalIsReacting=!0,ej.reactionEpoch=ej.globalEpoch;let b=new Set;for(let c of a)c.children.visit(a=>el(b,a));for(let a of b)a.maybeScheduleEffect();let c=0;for(;ej.cleanupReactors?.size;){if(c++>1e3)throw Error("Reaction update depth limit exceeded");let a=ej.cleanupReactors;for(let b of(ej.cleanupReactors=null,a))b.maybeScheduleEffect()}}finally{ej.cleanupReactors=null,ej.globalIsReacting=!1,ej.currentTransaction=b}}function en(a){let b=ej.cleanupReactors??=new Set;a.children.visit(a=>el(b,a))}function eo(a){let b=new ei(ej.currentTransaction,!0);ej.currentTransaction=b;try{let c,d=!1;try{c=a(()=>d=!0)}catch(a){throw b.abort(),a}if(ej.currentTransaction!==b)throw Error("Transaction boundaries overlap");return d?b.abort():b.commit(),c}finally{ej.currentTransaction=b.parent}}function ep(a){return ej.currentTransaction?a():eo(a)}async function eq(a){let b,c;if(ej.currentTransaction?.isSync)throw Error("deferAsyncEffects cannot be called during a sync transaction");for(;ej.globalIsReacting;)await new Promise(a=>queueMicrotask(()=>a(null)));let d=ej.currentTransaction??new ei(null,!1);if(d.isSync)throw Error("deferAsyncEffects cannot be called during a sync transaction");ej.currentTransaction=d,d.asyncProcessCount++;try{b=await a()}catch(a){c=a??null}if(--d.asyncProcessCount>0)if(void 0===c)return b;else throw c;if(ej.currentTransaction=null,void 0===c)return d.commit(),b;throw d.abort(),c}let er=!1,es=Symbol.for("com.tldraw.state/UNINITIALIZED");function et(a){return a===es}let eu=d9("WithDiff",()=>class{constructor(a,b){this.value=a,this.diff=b}});function ev(a,b){return new eu(a,b)}class ew{constructor(a,b,c){this.name=a,this.derive=b,c?.historyLength&&(this.historyBuffer=new ed(c.historyLength)),this.computeDiff=c?.computeDiff,this.isEqual=c?.isEqual??d8}lastChangedEpoch=-1;lastTraversedEpoch=-1;__debug_ancestor_epochs__=null;lastCheckedEpoch=-1;parentSet=new eb;parents=[];parentEpochs=[];children=new eb;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=es;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(a){let b=-1===this.lastChangedEpoch,c=ek();if(!b&&(this.lastCheckedEpoch===c||this.isActivelyListening&&ej.globalIsReacting&&this.lastTraversedEpoch<ej.reactionEpoch||!d5(this))){if(this.lastCheckedEpoch=c,!this.error)return this.state;if(a)return this.state;throw this.error.thrownValue}try{eG(this);let a=this.derive(this.state,this.lastCheckedEpoch),b=a instanceof eu?a.value:a,c=this.state===es;if(c||!this.isEqual(b,this.state)){if(this.historyBuffer&&!c){let c=a instanceof eu?a.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,ek(),c??this.computeDiff?.(this.state,b,this.lastCheckedEpoch,ek())??ec)}this.lastChangedEpoch=ek(),this.state=b}return this.error=null,this.lastCheckedEpoch=ek(),this.state}catch(b){if(this.state!==es&&(this.state=es,this.lastChangedEpoch=ek()),this.lastCheckedEpoch=ek(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:b},!a)throw b;return this.state}finally{eH()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{eI(this)}}getDiffSince(a){return(this.__unsafe__getWithoutCapture(!0),eI(this),a>=this.lastChangedEpoch)?ea:this.historyBuffer?.getChangesSince(a)??ec}}let ex=d9("Computed",()=>ew);function ey(a={},b){if(2===b.length){let c,d,[e,f]=b;return cg("method"===f.kind,"@computed can only be used on methods"),c=Symbol.for("__@tldraw/state__computed__"+String(f.name)),(d=function(){let b=this[c];return b||Object.defineProperty(this,c,{enumerable:!1,configurable:!1,writable:!1,value:b=new ex(String(f.name),e.bind(this),a)}),b.get()})[ez]=!0,d}{let[c,d,e]=b;return e.get?(er||(er=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`)),function(a={},b,c,d){let e=d.get,f=Symbol.for("__@tldraw/state__computed__"+c);return d.get=function(){let b=this[f];return b||Object.defineProperty(this,f,{enumerable:!1,configurable:!1,writable:!1,value:b=new ex(c,e.bind(this),a)}),b.get()},d}(a,0,d,e)):function(a={},b,c,d){let e=d.value,f=Symbol.for("__@tldraw/state__computed__"+c);return d.value=function(){let b=this[f];return b||Object.defineProperty(this,f,{enumerable:!1,configurable:!1,writable:!1,value:b=new ex(c,e.bind(this),a)}),b.get()},d.value[ez]=!0,d}(a,0,d,e)}}let ez="@@__isComputedMethod__@@";function eA(a,b){let c=Symbol.for("__@tldraw/state__computed__"+b.toString()),d=a[c];if(!d){let e=a[b];"function"==typeof e&&e[ez]&&e.call(a),d=a[c]}return d}function eB(){if(1==arguments.length){let a=arguments[0];return(...b)=>ey(a,b)}return"string"==typeof arguments[0]?new ex(arguments[0],arguments[1],arguments[2]):ey(void 0,arguments)}function eC(a){return!!(a&&a instanceof ex)}class eD{constructor(a,b){this.below=a,this.child=b}offset=0;maybeRemoved}let eE=d9("capture",()=>({stack:null}));function eF(a){let b=eE.stack;eE.stack=null;try{return a()}finally{eE.stack=b}}function eG(a){if(eE.stack=new eD(eE.stack,a),a.__debug_ancestor_epochs__){let b=a.__debug_ancestor_epochs__;for(let b of(a.__debug_ancestor_epochs__=null,a.parents))b.__unsafe__getWithoutCapture(!0);!function(a,b){let c=function a(b,c){let d={};for(let e=0;e<b.parents.length;e++){let f=b.parents[e];if(!c.has(f))continue;let g=c.get(f);f.lastChangedEpoch!==g&&(eC(f)?d[f.name]=a(f,c):d[f.name]=null)}return d}(a,b);if(0===Object.keys(c).length)return console.log(`Effect(${a.name}) was executed manually.`);let d=eC(a)?`Computed(${a.name}) is recomputing because:`:`Effect(${a.name}) is executing because:`;!function a(b,c){let e="\n"+" ".repeat(c)+"↳ ";for(let[f,g]of Object.entries(b))g?(d+=`${e}Computed(${f}) changed`,a(g,c+2)):d+=`${e}Atom(${f}) changed`}(c,1),console.log(d)}(a,b)}a.parentSet.clear()}function eH(){let a=eE.stack;if(eE.stack=a.below,a.offset<a.child.parents.length){for(let b=a.offset;b<a.child.parents.length;b++){let c=a.child.parents[b];a.child.parentSet.has(c)||d6(c,a.child)}a.child.parents.length=a.offset,a.child.parentEpochs.length=a.offset}if(a.maybeRemoved)for(let b=0;b<a.maybeRemoved.length;b++){let c=a.maybeRemoved[b];a.child.parentSet.has(c)||d6(c,a.child)}a.child.__debug_ancestor_epochs__&&function a(b,c){for(let d=0;d<b.parents.length;d++){let e=b.parents[d],f=b.parentEpochs[d];c.set(e,f),eC(e)&&a(e,c)}return c}(a.child,a.child.__debug_ancestor_epochs__)}function eI(a){if(eE.stack&&!eE.stack.child.parentSet.has(a)){if(eE.stack.child.parentSet.add(a),eE.stack.child.isActivelyListening&&d7(a,eE.stack.child),eE.stack.offset<eE.stack.child.parents.length){let b=eE.stack.child.parents[eE.stack.offset];b!==a&&(eE.stack.maybeRemoved?eE.stack.maybeRemoved.push(b):eE.stack.maybeRemoved=[b])}eE.stack.child.parents[eE.stack.offset]=a,eE.stack.child.parentEpochs[eE.stack.offset]=a.lastChangedEpoch,eE.stack.offset++}}function eJ(){let a=eE.stack?.child;if(!a)throw Error("whyAmIRunning() called outside of a reactive context");a.__debug_ancestor_epochs__=new Map}class eK{constructor(a,b,c){if(this.name=a,this.current=b,this.isEqual=c?.isEqual??null,!c)return;c.historyLength&&(this.historyBuffer=new ed(c.historyLength)),this.computeDiff=c.computeDiff}isEqual;computeDiff;lastChangedEpoch=ek();children=new eb;historyBuffer;__unsafe__getWithoutCapture(a){return this.current}get(){return eI(this),this.current}set(a,b){if(this.isEqual?.(this.current,a)??d8(this.current,a))return this.current;ej.globalEpoch++,this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,ek(),b??this.computeDiff?.(this.current,a,this.lastChangedEpoch,ek())??ec),this.lastChangedEpoch=ek();let c=this.current;return this.current=a,ej.currentTransaction?ej.currentTransaction.initialAtomValues.has(this)||ej.currentTransaction.initialAtomValues.set(this,c):ej.globalIsReacting?en(this):em([this]),a}update(a){return this.set(a(this.current))}getDiffSince(a){return(eI(this),a>=this.lastChangedEpoch)?ea:this.historyBuffer?.getChangesSince(a)??ec}}let eL=d9("Atom",()=>eK);function eM(a,b,c){return new eL(a,b,c)}function eN(a){return a instanceof eL}function eO(a){return a instanceof eL||a instanceof ex}function eP(a,b,c){let d=b;try{let b=dD(a);b&&(d=JSON.parse(b))}catch{dF(a)}let e=eM(a,d,c),f=eg(`save ${a} to localStorage`,()=>{dE(a,JSON.stringify(e.get()))}),g=c=>{if(c.key===a){if(null===c.newValue)return void e.set(b);try{let a=JSON.parse(c.newValue);e.set(a)}catch{}}};return window.addEventListener("storage",g),[e,()=>{f(),window.removeEventListener("storage",g)}]}if(1!==d9("apiVersion",()=>1))throw Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");bV("@tldraw/state","4.2.0","esm"),a.s([],63617);var eQ=a.i(72131);function eR(a,b,c=[]){let d=eQ.default.useRef(b);d.current=b;let[e,f,g]=eQ.default.useMemo(()=>{let b=null,c=new ef(`useStateTracking(${a})`,()=>d.current?.(),{scheduleEffect(){b?.()}});return[c,a=>(b=a,()=>{b=null}),()=>c.scheduleCount]},[a,...c]);return eQ.default.useSyncExternalStore(f,g,g),eQ.default.useEffect(()=>(e.attach(),e.maybeScheduleEffect(),()=>{e.detach()}),[e]),e.execute()}let eS={apply:(a,b,c)=>eR(a.displayName??a.name??"tracked(???)",()=>a.apply(b,c))},eT=Symbol.for("react.memo"),eU=Symbol.for("react.forward_ref");function eV(a){let b=null,c=a.$$typeof;return(c===eT&&(b=(a=a.type).compare),c===eU)?(0,eQ.memo)((0,eQ.forwardRef)(new Proxy(a.render,eS))):(0,eQ.memo)(new Proxy(a,eS),b)}function eW(a,b,c){return(0,eQ.useState)(()=>eM(`useAtom(${a})`,"function"==typeof b?b():b,c))[0]}function eX(){let a=arguments[0],b=arguments[1],c=3==arguments.length?void 0:arguments[2],d=3==arguments.length?arguments[2]:arguments[3];return(0,eQ.useMemo)(()=>eB(`useComputed(${a})`,b,c),d)}function eY(a,b,c=ea){(0,eQ.useEffect)(()=>{let c=new ef(a,b);return c.attach(),c.execute(),()=>{c.detach()}},c)}function eZ(a,b,c=[]){(0,eQ.useEffect)(()=>{let c,d=new ef(a,b,{scheduleEffect:a=>{c=dT(a)}});return d.attach(),d.execute(),()=>{d.detach(),c?.()}},c)}function e$(){let a=arguments,b=3===a.length?a[2]:[a[0]],c=3===a.length?a[0]:`useValue(${a[0].name})`,{$val:d,subscribe:e,getSnapshot:f}=(0,eQ.useMemo)(()=>{let b=1===a.length?a[0]:eB(c,a[1]);return{$val:b,subscribe:a=>eg(`useValue(${c})`,()=>{try{b.get()}catch{}a()}),getSnapshot:()=>b.lastChangedEpoch}},b);return(0,eQ.useSyncExternalStore)(e,f,f),d.__unsafe__getWithoutCapture()}function e_(a){return a>>>1&0x40000000|0xbfffffff&a}bV("@tldraw/state-react","4.2.0","esm"),a.s([],65124);let e0=Object.prototype.valueOf;function e1(a){if(null==a)return e2(a);if("function"==typeof a.hashCode)return e_(a.hashCode(a));let b=(c=a).valueOf!==e0&&"function"==typeof c.valueOf?c.valueOf(c):c;if(null==b)return e2(b);switch(typeof b){case"boolean":return b?0x42108421:0x42108420;case"number":var c,d,e,f,g=b;if(g!=g||g===1/0)return 0;let h=0|g;for(h!==g&&(h^=0xffffffff*g);g>0xffffffff;)g/=0xffffffff,h^=g;return e_(h);case"string":let i;return b.length>e8?(void 0===(i=fb[d=b])&&(i=e3(d),fa===e9&&(fa=0,fb={}),fa++,fb[d]=i),i):e3(b);case"object":case"function":let j;return e=b,void 0!==(j=e5.get(e))||(j=e4(),e5.set(e,j)),j;case"symbol":let k;return void 0!==(k=e6[f=b])||(k=e4(),e6[f]=k),k;default:if("function"==typeof b.toString)return e3(b.toString());throw Error("Value type "+typeof b+" cannot be hashed.")}}function e2(a){return null===a?0x42108422:0x42108423}function e3(a){let b=0;for(let c=0;c<a.length;c++)b=31*b+a.charCodeAt(c)|0;return e_(b)}function e4(){let a=++e7;return 0x40000000&e7&&(e7=0),a}let e5=new WeakMap,e6=Object.create(null),e7=0,e8=16,e9=255,fa=0,fb={},fc={};function fd(){return{value:!1}}function fe(a){a&&(a.value=!0)}function ff(a,b){b=b||0;let c=Math.max(0,a.length-b),d=Array(c);for(let e=0;e<c;e++)d[e]=a[e+b];return d}let fg=Object.is;class fh{}class fi{_root;size;__ownerID;__hash;__altered;constructor(a){return null==a?fv():a instanceof fi?a:fv().withMutations(b=>{for(let[c,d]of a)b.set(c,d)})}get(a,b){return this._root?this._root.get(0,void 0,a,b):b}set(a,b){return fw(this,a,b)}delete(a){return fw(this,a,fc)}deleteAll(a){return this.withMutations(b=>{for(let c of a)b.delete(c)})}__ensureOwner(a){return a===this.__ownerID?this:a?fu(this.size,this._root,a,this.__hash):0===this.size?fv():(this.__ownerID=a,this.__altered=!1,this)}withMutations(a){let b=this.asMutable();return a(b),b.wasAltered()?b.__ensureOwner(this.__ownerID):this}wasAltered(){return this.__altered}asMutable(){return this.__ownerID?this:this.__ensureOwner(new fh)}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}entries(){return new fo(this,ft,!1)}keys(){return new fo(this,fr,!1)}values(){return new fo(this,fs,!1)}}class fj{constructor(a,b){this.ownerID=a,this.entries=b}get(a,b,c,d){let e=this.entries;for(let a=0,b=e.length;a<b;a++)if(fg(c,e[a][0]))return e[a][1];return d}update(a,b,c,d,e,f,g){let h=e===fc,i=this.entries,j=0,k=i.length;for(;j<k&&!fg(d,i[j][0]);j++);let l=j<k;if(l?i[j][1]===e:h)return this;if(fe(g),(h||!l)&&fe(f),h&&1===i.length)return;if(!l&&!h&&i.length>=fC){var m=a,n=i,o=d,p=e;m||(m=new fh);let b=new fn(m,e1(o),[o,p]);for(let a=0;a<n.length;a++){let c=n[a];b=b.update(m,0,void 0,c[0],c[1])}return b}let q=a&&a===this.ownerID,r=q?i:ff(i);return(l?h?j===k-1?r.pop():r[j]=r.pop():r[j]=[d,e]:r.push([d,e]),q)?(this.entries=r,this):new fj(a,r)}}class fk{constructor(a,b,c){this.ownerID=a,this.bitmap=b,this.nodes=c}get(a,b,c,d){void 0===b&&(b=e1(c));let e=1<<((0===a?b:b>>>a)&31),f=this.bitmap;return(f&e)==0?d:this.nodes[fA(f&e-1)].get(a+5,b,c,d)}update(a,b,c,d,e,f,g){void 0===c&&(c=e1(d));let h=(0===b?c:c>>>b)&31,i=1<<h,j=this.bitmap,k=(j&i)!=0;if(!k&&e===fc)return this;let l=fA(j&i-1),m=this.nodes,n=k?m[l]:void 0,o=fx(n,a,b+5,c,d,e,f,g);if(o===n)return this;if(!k&&o&&m.length>=fD){var p=a,q=m,r=j,s=h,t=o;let b=0,c=Array(32);for(let a=0;0!==r;a++,r>>>=1)c[a]=1&r?q[b++]:void 0;return c[s]=t,new fl(p,b+1,c)}if(k&&!o&&2===m.length&&fy(m[1^l]))return m[1^l];if(k&&o&&1===m.length&&fy(o))return o;let u=a&&a===this.ownerID,v=k?o?j:j^i:j|i,w=k?o?fB(m,l,o,u):function(a,b,c){let d=a.length-1;if(c&&b===d)return a.pop(),a;let e=Array(d),f=0;for(let c=0;c<d;c++)c===b&&(f=1),e[c]=a[c+f];return e}(m,l,u):function(a,b,c,d){let e=a.length+1;if(d&&b+1===e)return a[b]=c,a;let f=Array(e),g=0;for(let d=0;d<e;d++)d===b?(f[d]=c,g=-1):f[d]=a[d+g];return f}(m,l,o,u);return u?(this.bitmap=v,this.nodes=w,this):new fk(a,v,w)}}class fl{constructor(a,b,c){this.ownerID=a,this.count=b,this.nodes=c}get(a,b,c,d){void 0===b&&(b=e1(c));let e=(0===a?b:b>>>a)&31,f=this.nodes[e];return f?f.get(a+5,b,c,d):d}update(a,b,c,d,e,f,g){void 0===c&&(c=e1(d));let h=(0===b?c:c>>>b)&31,i=e===fc,j=this.nodes,k=j[h];if(i&&!k)return this;let l=fx(k,a,b+5,c,d,e,f,g);if(l===k)return this;let m=this.count;if(k){if(!l&&--m<fE)return function(a,b,c,d){let e=0,f=0,g=Array(c);for(let a=0,c=1,h=b.length;a<h;a++,c<<=1){let h=b[a];void 0!==h&&a!==d&&(e|=c,g[f++]=h)}return new fk(a,e,g)}(a,j,m,h)}else m++;let n=a&&a===this.ownerID,o=fB(j,h,l,n);return n?(this.count=m,this.nodes=o,this):new fl(a,m,o)}}class fm{constructor(a,b,c){this.ownerID=a,this.keyHash=b,this.entries=c}get(a,b,c,d){let e=this.entries;for(let a=0,b=e.length;a<b;a++)if(fg(c,e[a][0]))return e[a][1];return d}update(a,b,c,d,e,f,g){void 0===c&&(c=e1(d));let h=e===fc;if(c!==this.keyHash)return h?this:(fe(g),fe(f),fz(this,a,b,c,[d,e]));let i=this.entries,j=0,k=i.length;for(;j<k&&!fg(d,i[j][0]);j++);let l=j<k;if(l?i[j][1]===e:h)return this;if(fe(g),(h||!l)&&fe(f),h&&2===k)return new fn(a,this.keyHash,i[1^j]);let m=a&&a===this.ownerID,n=m?i:ff(i);return(l?h?j===k-1?n.pop():n[j]=n.pop():n[j]=[d,e]:n.push([d,e]),m)?(this.entries=n,this):new fm(a,this.keyHash,n)}}class fn{constructor(a,b,c){this.ownerID=a,this.keyHash=b,this.entry=c}get(a,b,c,d){return fg(c,this.entry[0])?this.entry[1]:d}update(a,b,c,d,e,f,g){let h=e===fc,i=fg(d,this.entry[0]);return(i?e===this.entry[1]:h)?this:(fe(g),h)?void fe(f):i?a&&a===this.ownerID?(this.entry[1]=e,this):new fn(a,this.keyHash,[d,e]):(fe(f),fz(this,a,b,e1(d),[d,e]))}}class fo{constructor(a,b,c){this._type=b,this._reverse=c,this._stack=a._root&&fq(a._root)}_stack;[Symbol.iterator](){return this}next(){let a=this._type,b=this._stack;for(;b;){let c,d=b.node,e=b.index++;if(d.entry){if(0===e)return fp(a,d.entry)}else if("entries"in d&&d.entries){if(e<=(c=d.entries.length-1))return fp(a,d.entries[this._reverse?c-e:e])}else if(e<=(c=d.nodes.length-1)){let f=d.nodes[this._reverse?c-e:e];if(f){if(f.entry)return fp(a,f.entry);b=this._stack=fq(f,b)}continue}b=this._stack=this._stack.__prev}return{value:void 0,done:!0}}}function fp(a,b){var c,d,e,f;let g;return c=a,d=b[0],e=b[1],g=c===fr?d:c===fs?e:[d,e],f?f.value=g:f={value:g,done:!1},f}function fq(a,b){return{node:a,index:0,__prev:b}}let fr=0,fs=1,ft=2;function fu(a,b,c,d){let e=Object.create(fi.prototype);return e.size=a,e._root=b,e.__ownerID=c,e.__hash=d,e.__altered=!1,e}function fv(){return f||(f=fu(0))}function fw(a,b,c){let d,e;if(a._root){let f=fd(),g=fd();if(d=fx(a._root,a.__ownerID,0,void 0,b,c,f,g),!g.value)return a;e=a.size+(f.value?c===fc?-1:1:0)}else{if(c===fc)return a;e=1,d=new fj(a.__ownerID,[[b,c]])}return a.__ownerID?(a.size=e,a._root=d,a.__hash=void 0,a.__altered=!0,a):d?fu(e,d):fv()}function fx(a,b,c,d,e,f,g,h){return a?a.update(b,c,d,e,f,g,h):f===fc?a:(fe(h),fe(g),new fn(b,d,[e,f]))}function fy(a){return a.constructor===fn||a.constructor===fm}function fz(a,b,c,d,e){let f;if(a.keyHash===d)return new fm(b,d,[a.entry,e]);let g=(0===c?a.keyHash:a.keyHash>>>c)&31,h=(0===c?d:d>>>c)&31,i=g===h?[fz(a,b,c+5,d,e)]:(f=new fn(b,d,e),g<h?[a,f]:[f,a]);return new fk(b,1<<g|1<<h,i)}function fA(a){return a-=a>>1&0x55555555,a=(a=(0x33333333&a)+(a>>2&0x33333333))+(a>>4)&0xf0f0f0f,a+=a>>8,127&(a+=a>>16)}function fB(a,b,c,d){let e=d?a:ff(a);return e[b]=c,e}let fC=8,fD=16,fE=8;class fF{constructor(a,b){this.name=a;let c=fv();b&&(c=c.withMutations(c=>{for(let[d,e]of b)c.set(d,eM(`${a}:${String(d)}`,e))})),this.atoms=eM(`${a}:atoms`,c)}atoms;getAtom(a){let b=this.atoms.__unsafe__getWithoutCapture().get(a);return b||void this.atoms.get()}get(a){let b=this.getAtom(a)?.get();return cg(b!==es),b}__unsafe__getWithoutCapture(a){let b=this.atoms.__unsafe__getWithoutCapture().get(a);if(!b)return;let c=b.__unsafe__getWithoutCapture();return cg(c!==es),c}has(a){let b=this.getAtom(a);return!!b&&b.get()!==es}__unsafe__hasWithoutCapture(a){let b=this.atoms.__unsafe__getWithoutCapture().get(a);return!!b&&(cg(b.__unsafe__getWithoutCapture()!==es),!0)}set(a,b){let c=this.atoms.__unsafe__getWithoutCapture().get(a);return c?c.set(b):this.atoms.update(c=>c.set(a,eM(`${this.name}:${String(a)}`,b))),this}update(a,b){let c=this.atoms.__unsafe__getWithoutCapture().get(a);if(!c)throw Error(`AtomMap: key ${a} not found`);let d=c.__unsafe__getWithoutCapture();cg(d!==es),c.set(b(d))}delete(a){let b=this.atoms.__unsafe__getWithoutCapture().get(a);return!!b&&(ep(()=>{b.set(es),this.atoms.update(b=>b.delete(a))}),!0)}deleteMany(a){return ep(()=>{let b=[],c=this.atoms.get().withMutations(c=>{for(let d of a){let a=c.get(d);if(!a)continue;let e=a.get();cg(e!==es),b.push([d,e]),c.delete(d),a.set(es)}});return b.length&&this.atoms.set(c),b})}clear(){return ep(()=>{for(let a of this.atoms.__unsafe__getWithoutCapture().values())a.set(es);this.atoms.set(fv())})}*entries(){for(let[a,b]of this.atoms.get()){let c=b.get();cg(c!==es),yield[a,c]}}*keys(){for(let a of this.atoms.get().keys())yield a}*values(){for(let a of this.atoms.get().values()){let b=a.get();cg(b!==es),yield b}}get size(){return this.atoms.get().size}forEach(a,b){for(let[c,d]of this.entries())a.call(b,d,c,this)}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="AtomMap"}function fG(a){return a}class fH{constructor(a){this.previousValue=a}nextValue;diff;get(){let a=this.diff?.removed?.size??0,b=this.diff?.added?.size??0;if(0!==a||0!==b)return{value:this.nextValue,diff:this.diff}}_add(a,b){this.nextValue??=new Set(this.previousValue),this.nextValue.add(a),this.diff??={},b?this.diff.removed?.delete(a):(this.diff.added??=new Set,this.diff.added.add(a))}add(a){let b=this.previousValue.has(a);if(b){if(!this.diff?.removed?.has(a))return;return this._add(a,b)}this.nextValue?.has(a)||this._add(a,b)}_remove(a,b){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(a),this.diff??={},b?(this.diff.removed??=new Set,this.diff.removed.add(a)):this.diff.added?.delete(a)}remove(a){let b=this.previousValue.has(a);if(!b){if(!this.diff?.added?.has(a))return;return this._remove(a,b)}this.diff?.removed?.has(a)||this._remove(a,b)}}function fI({sequence:a,sequenceId:b,retroactive:c=!0}){let d={sequenceId:b,retroactive:c,sequence:function(a){let b=[];for(let c=a.length-1;c>=0;c--){let d=a[c];if("id"in d)b.unshift(d);else{let a=d.dependsOn,c=b[0];c&&(b[0]={...c,dependsOn:a.concat(c.dependsOn??[])})}}return b}(a)};return fN(d),d}function fJ(a,b){return Object.fromEntries(cY(b).map(([b,c])=>[b,`${a}/${c}`]))}function fK(a){return fI({sequenceId:a.sequenceId,retroactive:a.retroactive??!0,sequence:a.sequence.map(b=>"id"in b?{...b,scope:"record",filter:c=>c.typeName===a.recordType&&(b.filter?.(c)??!0)&&(a.filter?.(c)??!0)}:b)})}function fL(a){let[b,c]=a.split("/");return{sequenceId:b,version:parseInt(c)}}function fM(a,b){b&&cg(a.startsWith(b+"/"),`Every migration in sequence '${b}' must have an id starting with '${b}/'. Got invalid id: '${a}'`),cg(a.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${a}'`)}function fN(a){if(cg(!a.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${a.sequenceId}`),cg(a.sequenceId.length,"sequenceId must be a non-empty string"),0===a.sequence.length)return;fM(a.sequence[0].id,a.sequenceId);let b=fL(a.sequence[0].id).version;cg(1===b,`Expected the first migrationId to be '${a.sequenceId}/1' but got '${a.sequence[0].id}'`);for(let c=1;c<a.sequence.length;c++){let d=a.sequence[c].id;fM(d,a.sequenceId);let e=fL(d).version;cg(e===b+1,`Migration id numbers must increase in increments of 1, expected ${a.sequenceId}/${b+1} but got '${a.sequence[c].id}'`),b=e}}var fO=((p=fO||{}).IncompatibleSubtype="incompatible-subtype",p.UnknownType="unknown-type",p.TargetVersionTooNew="target-version-too-new",p.TargetVersionTooOld="target-version-too-old",p.MigrationError="migration-error",p.UnrecognizedSubtype="unrecognized-subtype",p);function fP(){return{added:{},updated:{},removed:{}}}function fQ(a){let b={added:a.removed,removed:a.added,updated:{}};for(let[c,d]of Object.values(a.updated))b.updated[c.id]=[d,c];return b}function fR(a){return 0===Object.keys(a.added).length&&0===Object.keys(a.updated).length&&0===Object.keys(a.removed).length}function fS(a,b){let c=b?.mutateFirstDiff?a[0]:{added:{},removed:{},updated:{}};return fT(c,b?.mutateFirstDiff?a.slice(1):a),c}function fT(a,b){for(let c of b){for(let[b,d]of cY(c.added))if(a.removed[b]){let c=a.removed[b];delete a.removed[b],c!==d&&(a.updated[b]=[c,d])}else a.added[b]=d;for(let[b,[d,e]]of cY(c.updated)){if(a.added[b]){a.added[b]=e,delete a.updated[b],delete a.removed[b];continue}if(a.updated[b]){a.updated[b]=[a.updated[b][0],e],delete a.removed[b];continue}a.updated[b]=c.updated[b],delete a.removed[b]}for(let[b,d]of cY(c.removed))a.added[b]?delete a.added[b]:a.updated[b]?(a.removed[b]=a.updated[b][0],delete a.updated[b]):a.removed[b]=d}}class fU{constructor(a,b){this.typeName=a,this.createDefaultProperties=b.createDefaultProperties,this.validator=b.validator??{validate:a=>a},this.scope=b.scope??"document",this.ephemeralKeys=b.ephemeralKeys;const c=new Set;if(b.ephemeralKeys)for(const[a,d]of cY(b.ephemeralKeys))d&&c.add(a);this.ephemeralKeySet=c}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(a){let b={...this.createDefaultProperties(),id:"id"in a?a.id:this.createId()};for(let[c,d]of Object.entries(a))void 0!==d&&(b[c]=d);return b.typeName=this.typeName,b}clone(a){return{...d$(a),id:this.createId()}}createId(a){return this.typeName+":"+(a??cA(void 0))}parseId(a){if(!this.isId(a))throw Error(`ID "${a}" is not a valid ID for type "${this.typeName}"`);return a.slice(this.typeName.length+1)}isInstance(a){return a?.typeName===this.typeName}isId(a){if(!a)return!1;for(let b=0;b<this.typeName.length;b++)if(a[b]!==this.typeName[b])return!1;return":"===a[this.typeName.length]}withDefaultProperties(a){return new fU(this.typeName,{createDefaultProperties:a,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(a,b){return b&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(b,a):this.validator.validate(a)}}function fV(a,b){return new fU(a,{createDefaultProperties:()=>({}),validator:b.validator,scope:b.scope,ephemeralKeys:b.ephemeralKeys})}function fW(a,b){if(!a||!b.isId(a))throw Error(`string ${JSON.stringify(a)} is not a valid ${b.typeName} id`)}var fX=b_;function fY(a){return"object"==typeof a&&null!==a&&("eq"in a||"neq"in a||"gt"in a)}function fZ(a,b){for(let[c,d]of Object.entries(a)){let a=b[c];if(fY(d)){if("eq"in d&&a!==d.eq||"neq"in d&&a===d.neq||"gt"in d&&("number"!=typeof a||a<=d.gt))return!1;continue}if("object"!=typeof a||null===a||!fZ(d,a))return!1}return!0}function f$(a,b,c){let d=function a(b,c=""){let d=[];for(let[e,f]of Object.entries(b)){let b=c?`${c}\\${e}`:e;fY(f)?d.push({path:b,matcher:f}):"object"==typeof f&&null!==f&&d.push(...a(f,b))}return d}(c),e=Object.fromEntries(d.map(({path:a})=>[a,new Set]));for(let{path:c,matcher:f}of d){let d=a.index(b,c);if("eq"in f){let a=d.get().get(f.eq);if(a)for(let b of a)e[c].add(b)}else if("neq"in f){for(let[a,b]of d.get())if(a!==f.neq)for(let a of b)e[c].add(a)}else if("gt"in f){for(let[a,b]of d.get())if("number"==typeof a&&a>f.gt)for(let a of b)e[c].add(a)}if(0===e[c].size)return new Set}return function(a){if(0===a.length)return new Set;let b=a[0],c=a.slice(1),d=new Set;for(let a of b)c.every(b=>b.has(a))&&d.add(a);return d}(Object.values(e))}class f_{constructor(a,b){this.recordMap=a,this.history=b}indexCache=new Map;historyCache=new Map;getAllIdsForType(a){let b=new Set;for(let c of this.recordMap.values())c.typeName===a&&b.add(c.id);return b}getRecordById(a,b){let c=this.recordMap.get(b);if(c&&c.typeName===a)return c}getNestedValue(a,b){let c=a;for(let a of b){if(null==c||"object"!=typeof c)return;c=c[a]}return c}filterHistory(a){if(this.historyCache.has(a))return this.historyCache.get(a);let b=eB("filterHistory:"+a,(b,c)=>{if(et(b))return this.history.get();let d=this.history.getDiffSince(c);if(d===ec)return this.history.get();let e={added:{},removed:{},updated:{}},f=0,g=0,h=0;for(let b of d){for(let c of cX(b.added))if(c.typeName===a)if(e.removed[c.id]){let a=e.removed[c.id];delete e.removed[c.id],g--,a!==c&&(e.updated[c.id]=[a,c],h++)}else e.added[c.id]=c,f++;for(let[c,d]of cX(b.updated))d.typeName===a&&(e.added[d.id]?e.added[d.id]=d:e.updated[d.id]?e.updated[d.id]=[e.updated[d.id][0],d]:(e.updated[d.id]=[c,d],h++));for(let c of cX(b.removed))c.typeName===a&&(e.added[c.id]?(delete e.added[c.id],f--):(e.updated[c.id]?(e.removed[c.id]=e.updated[c.id][0],delete e.updated[c.id],h--):e.removed[c.id]=c,g++))}return f||g||h?ev(this.history.get(),e):b},{historyLength:100});return this.historyCache.set(a,b),b}index(a,b){let c=a+":"+b;if(this.indexCache.has(c))return this.indexCache.get(c);let d=this.__uncached_createIndex(a,b);return this.indexCache.set(c,d),d}__uncached_createIndex(a,b){let c=this.filterHistory(a),d=b.split("\\"),e=d.length>1?a=>this.getNestedValue(a,d):a=>a[b],f=()=>{c.get();let b=new Map;for(let c of this.recordMap.values())if(c.typeName===a){let a=e(c);void 0!==a&&(b.has(a)||b.set(a,new Set),b.get(a).add(c.id))}return b};return eB("index:"+a+":"+b,(b,d)=>{let g,h;if(et(b))return f();let i=c.getDiffSince(d);if(i===ec)return f();let j=new Map,k=(a,c)=>{let d=j.get(a);d||(d=new fH(b.get(a)??new Set)),d.add(c),j.set(a,d)},l=(a,c)=>{let d=j.get(a);d||(d=new fH(b.get(a)??new Set)),d.remove(c),j.set(a,d)};for(let b of i){for(let c of cX(b.added))if(c.typeName===a){let a=e(c);void 0!==a&&k(a,c.id)}for(let[c,d]of cX(b.updated))if(d.typeName===a){let a=e(c),b=e(d);a!==b&&(void 0!==a&&l(a,d.id),void 0!==b&&k(b,d.id))}for(let c of cX(b.removed))if(c.typeName===a){let a=e(c);void 0!==a&&l(a,c.id)}}for(let[a,c]of j){let d=c.get();d&&(g||(g=new Map(b)),h||(h=new Map),0===d.value.size?g.delete(a):g.set(a,d.value),h.set(a,d.diff))}return g&&h?ev(g,h):b},{historyLength:100})}record(a,b=()=>({}),c="record:"+a+(b?":"+b.toString():"")){let d=this.ids(a,b,c);return eB(c,()=>{for(let a of d.get())return this.recordMap.get(a)})}records(a,b=()=>({}),c="records:"+a+(b?":"+b.toString():"")){let d=this.ids(a,b,"ids:"+c);return eB(c,()=>Array.from(d.get(),a=>this.recordMap.get(a)),{isEqual:ca})}ids(a,b=()=>({}),c="ids:"+a+(b?":"+b.toString():"")){let d=this.filterHistory(a),e=()=>{d.get();let c=b();return 0===Object.keys(c).length?this.getAllIdsForType(a):f$(this,a,c)},f=a=>{let b=e(),c=function(a,b){let c={};for(let d of b)a.has(d)||(c.added??=new Set,c.added.add(d));for(let d of a)b.has(d)||(c.removed??=new Set,c.removed.add(d));return c.added||c.removed?c:void 0}(a,b);return c?ev(b,c):a},g=eB("ids_query:"+c,b,{isEqual:fX.default});return eB("query:"+c,(b,c)=>{let h=g.get();if(et(b))return e();if(c<g.lastChangedEpoch)return f(b);let i=d.getDiffSince(c);if(i===ec)return f(b);let j=new fH(b);for(let b of i){for(let c of cX(b.added))c.typeName===a&&fZ(h,c)&&j.add(c.id);for(let[c,d]of cX(b.updated))d.typeName===a&&(fZ(h,d)?j.add(d.id):j.remove(d.id));for(let c of cX(b.removed))c.typeName===a&&j.remove(c.id)}let k=j.get();return k?ev(k.value,k.diff):b},{historyLength:50})}exec(a,b){let c=f$(this,a,b);return 0===c.size?ea:Array.from(c,a=>this.recordMap.get(a))}}class f0{constructor(a){this.store=a}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(a){this._isEnabled=a}handleBeforeCreate(a,b){if(!this._isEnabled)return a;let c=this._beforeCreateHandlers[a.typeName];if(c){let d=a;for(let a of c)d=a(d,b);return d}return a}handleAfterCreate(a,b){if(!this._isEnabled)return;let c=this._afterCreateHandlers[a.typeName];if(c)for(let d of c)d(a,b)}handleBeforeChange(a,b,c){if(!this._isEnabled)return b;let d=this._beforeChangeHandlers[b.typeName];if(d){let e=b;for(let b of d)e=b(a,e,c);return e}return b}handleAfterChange(a,b,c){if(!this._isEnabled)return;let d=this._afterChangeHandlers[b.typeName];if(d)for(let e of d)e(a,b,c)}handleBeforeDelete(a,b){if(!this._isEnabled)return!0;let c=this._beforeDeleteHandlers[a.typeName];if(c){for(let d of c)if(!1===d(a,b))return!1}return!0}handleAfterDelete(a,b){if(!this._isEnabled)return;let c=this._afterDeleteHandlers[a.typeName];if(c)for(let d of c)d(a,b)}handleOperationComplete(a){if(this._isEnabled)for(let b of this._operationCompleteHandlers)b(a)}register(a){let b=[];for(let[c,d]of Object.entries(a))d?.beforeCreate&&b.push(this.registerBeforeCreateHandler(c,d.beforeCreate)),d?.afterCreate&&b.push(this.registerAfterCreateHandler(c,d.afterCreate)),d?.beforeChange&&b.push(this.registerBeforeChangeHandler(c,d.beforeChange)),d?.afterChange&&b.push(this.registerAfterChangeHandler(c,d.afterChange)),d?.beforeDelete&&b.push(this.registerBeforeDeleteHandler(c,d.beforeDelete)),d?.afterDelete&&b.push(this.registerAfterDeleteHandler(c,d.afterDelete));return()=>{for(let a of b)a()}}registerBeforeCreateHandler(a,b){return this._beforeCreateHandlers[a]||(this._beforeCreateHandlers[a]=[]),this._beforeCreateHandlers[a].push(b),()=>f1(this._beforeCreateHandlers[a],b)}registerAfterCreateHandler(a,b){return this._afterCreateHandlers[a]||(this._afterCreateHandlers[a]=[]),this._afterCreateHandlers[a].push(b),()=>f1(this._afterCreateHandlers[a],b)}registerBeforeChangeHandler(a,b){return this._beforeChangeHandlers[a]||(this._beforeChangeHandlers[a]=[]),this._beforeChangeHandlers[a].push(b),()=>f1(this._beforeChangeHandlers[a],b)}registerAfterChangeHandler(a,b){return this._afterChangeHandlers[a]||(this._afterChangeHandlers[a]=[]),this._afterChangeHandlers[a].push(b),()=>f1(this._afterChangeHandlers[a],b)}registerBeforeDeleteHandler(a,b){return this._beforeDeleteHandlers[a]||(this._beforeDeleteHandlers[a]=[]),this._beforeDeleteHandlers[a].push(b),()=>f1(this._beforeDeleteHandlers[a],b)}registerAfterDeleteHandler(a,b){return this._afterDeleteHandlers[a]||(this._afterDeleteHandlers[a]=[]),this._afterDeleteHandlers[a].push(b),()=>f1(this._afterDeleteHandlers[a],b)}registerOperationCompleteHandler(a){return this._operationCompleteHandlers.push(a),()=>f1(this._operationCompleteHandlers,a)}}function f1(a,b){let c=a.indexOf(b);c>=0&&a.splice(c,1)}class f2{id;records;history=eM("history",0,{historyLength:1e3});query;listeners=new Set;historyAccumulator=new f3;historyReactor;cancelHistoryReactor(){}schema;props;scopedTypes;sideEffects=new f0(this);constructor(a){const{initialData:b,schema:c,id:d}=a;this.id=d??cA(void 0),this.schema=c,this.props=a.props,b?this.records=new fF("store",cY(b).map(([a,b])=>[a,this.schema.validateRecord(this,b,"initialize",null)])):this.records=new fF("store"),this.query=new f_(this.records,this.history),this.historyReactor=eh("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:a=>this.cancelHistoryReactor=dT(a)}),this.scopedTypes={document:new Set(cX(this.schema.types).filter(a=>"document"===a.scope).map(a=>a.typeName)),session:new Set(cX(this.schema.types).filter(a=>"session"===a.scope).map(a=>a.typeName)),presence:new Set(cX(this.schema.types).filter(a=>"presence"===a.scope).map(a=>a.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges())for(let{changes:a,source:b}of this.historyAccumulator.flush()){let c=null,d=null,e=null;for(let{onHistory:f,filters:g}of this.listeners)if("all"===g.source||g.source===b)if("all"!==g.scope)if("document"===g.scope){if(!(d??=this.filterChangesByScope(a,"document")))continue;f({changes:d,source:b})}else if("session"===g.scope){if(!(c??=this.filterChangesByScope(a,"session")))continue;f({changes:c,source:b})}else{if(!(e??=this.filterChangesByScope(a,"presence")))continue;f({changes:e,source:b})}else f({changes:a,source:b})}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(a,b){let c={added:c_(a.added,(a,c)=>this.scopedTypes[b].has(c.typeName)),updated:c_(a.updated,(a,c)=>this.scopedTypes[b].has(c[1].typeName)),removed:c_(a.removed,(a,c)=>this.scopedTypes[b].has(c.typeName))};return 0===Object.keys(c.added).length&&0===Object.keys(c.updated).length&&0===Object.keys(c.removed).length?null:c}updateHistory(a){this.historyAccumulator.add({changes:a,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,a)}validate(a){this.allRecords().forEach(b=>this.schema.validateRecord(this,b,a,null))}put(a,b){this.atomic(()=>{let c,d={},e={},f=!1,g=this.isMergingRemoteChanges?"remote":"user";for(let h=0,i=a.length;h<i;h++){c=a[h];let i=this.records.__unsafe__getWithoutCapture(c.id);if(i){if(c=this.sideEffects.handleBeforeChange(i,c,g),this.schema.validateRecord(this,c,b??"updateRecord",i)===i)continue;this.records.set(c.id,c),f=!0,d[c.id]=[i,c],this.addDiffForAfterEvent(i,c)}else c=this.sideEffects.handleBeforeCreate(c,g),f=!0,e[(c=c=this.schema.validateRecord(this,c,b??"createRecord",null)).id]=c,this.addDiffForAfterEvent(null,c),this.records.set(c.id,c)}f&&this.updateHistory({added:e,updated:d,removed:{}})})}remove(a){this.atomic(()=>{let b=new Set(a),c=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(let d of a){let a=this.records.__unsafe__getWithoutCapture(d);a&&!1===this.sideEffects.handleBeforeDelete(a,c)&&b.delete(d)}let d=this.records.deleteMany(b);if(0===d.length)return;let e={};for(let[a,b]of d)e[a]=b,this.addDiffForAfterEvent(b,null);this.updateHistory({added:{},updated:{},removed:e})})}get(a){return this.records.get(a)}unsafeGetWithoutCapture(a){return this.records.__unsafe__getWithoutCapture(a)}serialize(a="document"){let b={};for(let[c,d]of this.records)("all"===a||this.scopedTypes[a].has(d.typeName))&&(b[c]=d);return b}getStoreSnapshot(a="document"){return{store:this.serialize(a),schema:this.schema.serialize()}}migrateSnapshot(a){let b=this.schema.migrateStoreSnapshot(a);if("error"===b.type)throw Error(`Failed to migrate snapshot: ${b.reason}`);return{store:b.value,schema:this.schema.serialize()}}loadStoreSnapshot(a){let b=this.schema.migrateStoreSnapshot(a);if("error"===b.type)throw Error(`Failed to migrate snapshot: ${b.reason}`);let c=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(b.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(c)}}allRecords(){return Array.from(this.records.values())}clear(){this.remove(Array.from(this.records.keys()))}update(a,b){let c=this.unsafeGetWithoutCapture(a);c?this.put([b(c)]):console.error(`Record ${a} not found. This is probably an error`)}has(a){return this.records.has(a)}listen(a,b){this._flushHistory();let c={onHistory:a,filters:{source:b?.source??"all",scope:b?.scope??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(c),()=>{this.listeners.delete(c),0===this.listeners.size&&this.historyReactor.stop()}}isMergingRemoteChanges=!1;mergeRemoteChanges(a){if(this.isMergingRemoteChanges)return a();if(this._isInAtomicOp)throw Error("Cannot merge remote changes while in atomic operation");try{this.atomic(a,!0,!0)}finally{this.ensureStoreIsUsable()}}extractingChanges(a){let b=[],c=this.historyAccumulator.addInterceptor(a=>b.push(a.changes));try{return ep(a),fS(b)}finally{c()}}applyDiff(a,{runCallbacks:b=!0,ignoreEphemeralKeys:c=!1}={}){this.atomic(()=>{let b=cX(a.added);for(let[d,e]of cX(a.updated)){let a=this.schema.getType(e.typeName);if(c&&a.ephemeralKeySet.size){let c=this.get(e.id);if(!c){b.push(e);continue}let d=null;for(let[b,f]of Object.entries(e))a.ephemeralKeySet.has(b)||Object.is(f,cV(c,b))||(d||(d={...c}),d[b]=f);d&&b.push(d)}else b.push(e)}let d=cW(a.removed);b.length&&this.put(b),d.length&&this.remove(d)},b)}createCache(a){let b=new cl;return{get:c=>{let d=this.records.getAtom(c);if(d)return b.get(d,()=>a(c,d)).get()}}}createComputedCache(a,b,c){return this.createCache((d,e)=>{let f=c?.areRecordsEqual?eB(`${a}:${d}:isEqual`,()=>e.get(),{isEqual:c.areRecordsEqual}):e;return eB(a+":"+d,()=>b(f.get()),{isEqual:c?.areResultsEqual})})}_integrityChecker;ensureStoreIsUsable(){this.atomic(()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()})}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(a,b){if(cg(this.pendingAfterEvents,"must be in event operation"),a===b||(a&&b&&cg(a.id===b.id),!a&&!b))return;let c=(a||b).id,d=this.pendingAfterEvents.get(c);d?d.after=b:this.pendingAfterEvents.set(c,{before:a,after:b})}flushAtomicCallbacks(a){let b=0,c=a?"remote":"user";for(;this.pendingAfterEvents;){let a=this.pendingAfterEvents;if(this.pendingAfterEvents=null,this.sideEffects.isEnabled()){if(++b>100)throw Error("Maximum store update depth exceeded, bailing out");for(let{before:b,after:d}of a.values())b&&d&&b!==d&&!(0,fX.default)(b,d)?this.sideEffects.handleAfterChange(b,d,c):b&&!d?this.sideEffects.handleAfterDelete(b,c):!b&&d&&this.sideEffects.handleAfterCreate(d,c);this.pendingAfterEvents?c="user":this.sideEffects.handleOperationComplete(c)}}}_isInAtomicOp=!1;atomic(a,b=!0,c=!1){return ep(()=>{if(this._isInAtomicOp){this.pendingAfterEvents||(this.pendingAfterEvents=new Map);let d=this.sideEffects.isEnabled();cg(!c,"cannot call mergeRemoteChanges while in atomic operation");try{return d&&!b&&this.sideEffects.setIsEnabled(!1),a()}finally{this.sideEffects.setIsEnabled(d)}}this.pendingAfterEvents=new Map;let d=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(b??d),this._isInAtomicOp=!0,c&&(this.isMergingRemoteChanges=!0);try{let b=a();return this.isMergingRemoteChanges=!1,this.flushAtomicCallbacks(c),b}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(d),this._isInAtomicOp=!1,this.isMergingRemoteChanges=!1}})}addHistoryInterceptor(a){return this.historyAccumulator.addInterceptor(b=>a(b,this.isMergingRemoteChanges?"remote":"user"))}}class f3{_history=[];_interceptors=new Set;addInterceptor(a){return this._interceptors.add(a),()=>{this._interceptors.delete(a)}}add(a){for(let b of(this._history.push(a),this._interceptors))b(a)}flush(){let a=function(a){let b;if(0===a.length)return[];let c=[],d=[a[0]];for(let e=1,f=a.length;e<f;e++)b=a[e],d[0].source!==b.source&&(c.push(d),d=[]),d.push(b);return c.push(d),c.map(a=>({source:a[0].source,changes:fS(a.map(a=>a.changes))}))}(this._history);return this._history=[],a}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function f4(a,b,c){let d=new cl;return{get:(e,f)=>d.get(e,()=>(e instanceof f2?e:e.store).createComputedCache(a,a=>b(e,a),c)).get(f)}}class f5{constructor(a,b){for(const c of(this.types=a,this.options=b,b.migrations??[]))cg(!this.migrations[c.sequenceId],`Duplicate migration sequenceId ${c.sequenceId}`),fN(c),this.migrations[c.sequenceId]=c;const c=Object.values(this.migrations).flatMap(a=>a.sequence);for(const a of(this.sortedMigrations=function(a){if(0===a.length)return[];let b=new Map(a.map(a=>[a.id,a])),c=new Map,d=new Map,e=new Map;for(let b of a)d.set(b.id,0),c.set(b.id,new Set),e.set(b.id,new Set);for(let f of a){let{version:a,sequenceId:g}=fL(f.id),h=`${g}/${a-1}`;if(b.has(h)&&(c.get(h).add(f.id),d.set(f.id,d.get(f.id)+1)),f.dependsOn)for(let a of f.dependsOn)b.has(a)&&(c.get(a).add(f.id),e.get(f.id).add(a),d.set(f.id,d.get(f.id)+1))}let f=a.filter(a=>0===d.get(a.id)),g=[],h=new Set;for(;f.length>0;){let a,i=-1/0;for(let b of f){let d=0;for(let a of c.get(b.id)||[])!h.has(a)&&(d+=1,e.get(a).has(b.id)&&(d+=100));(d>i||d===i&&0>b.id.localeCompare(a?.id??""))&&(a=b,i=d)}let j=a;for(let a of(f.splice(f.indexOf(j),1),g.push(j),h.add(j.id),c.get(j.id)||[]))h.has(a)||(d.set(a,d.get(a)-1),0===d.get(a)&&f.push(b.get(a)))}if(g.length!==a.length){let b=a.filter(a=>!h.has(a.id));cg(!1,`Circular dependency in migrations: ${b[0].id}`)}return g}(c),this.sortedMigrations))if(a.dependsOn?.length)for(const b of a.dependsOn)cg(c.find(a=>a.id===b),`Migration '${a.id}' depends on missing migration '${b}'`)}static create(a,b){return new f5(a,b??{})}migrations={};sortedMigrations;migrationCache=new WeakMap;validateRecord(a,b,c,d){try{let a=cV(this.types,b.typeName);if(!a)throw Error(`Missing definition for record type ${b.typeName}`);return a.validate(b,d??void 0)}catch(e){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:a,record:b,phase:c,recordBefore:d,error:e});throw e}}getMigrationsSince(a){let b=this.migrationCache.get(a);if(b)return b;let c=function(a){if(a.schemaVersion>2||a.schemaVersion<1)return ce.err("Bad schema version");if(2===a.schemaVersion)return ce.ok(a);let b={schemaVersion:2,sequences:{"com.tldraw.store":a.storeVersion}};for(let[c,d]of Object.entries(a.recordVersions))if(b.sequences[`com.tldraw.${c}`]=d.version,"subTypeKey"in d)for(let[a,e]of Object.entries(d.subTypeVersions))b.sequences[`com.tldraw.${c}.${a}`]=e;return ce.ok(b)}(a);if(!c.ok)return this.migrationCache.set(a,c),c;let d=c.value,e=new Set(Object.keys(d.sequences).filter(a=>this.migrations[a]));for(let a in this.migrations)void 0===d.sequences[a]&&this.migrations[a].retroactive&&e.add(a);if(0===e.size){let b=ce.ok([]);return this.migrationCache.set(a,b),b}let f=new Set;for(let b of e){let c=d.sequences[b];if("number"!=typeof c&&this.migrations[b].retroactive||0===c){for(let a of this.migrations[b].sequence)f.add(a.id);continue}let e=`${b}/${c}`,g=this.migrations[b].sequence.findIndex(a=>a.id===e);if(-1===g){let b=ce.err("Incompatible schema?");return this.migrationCache.set(a,b),b}for(let a of this.migrations[b].sequence.slice(g+1))f.add(a.id)}let g=ce.ok(this.sortedMigrations.filter(({id:a})=>f.has(a)));return this.migrationCache.set(a,g),g}migratePersistedRecord(a,b,c="up"){let d=this.getMigrationsSince(b);if(!d.ok)return console.error("Error migrating record",d.error),{type:"error",reason:fO.MigrationError};let e=d.value;if(0===e.length)return{type:"success",value:a};if(e.some(a=>"store"===a.scope))return{type:"error",reason:"down"===c?fO.TargetVersionTooOld:fO.TargetVersionTooNew};if("down"===c){if(!e.every(a=>a.down))return{type:"error",reason:fO.TargetVersionTooOld};e=e.slice().reverse()}a=d$(a);try{for(let b of e){if("store"===b.scope)throw Error();if(!(!b.filter||b.filter(a)))continue;let d=b[c](a);d&&(a=d$(d))}}catch(a){return console.error("Error migrating record",a),{type:"error",reason:fO.MigrationError}}return{type:"success",value:a}}migrateStoreSnapshot(a,b){let{store:c}=a,d=this.getMigrationsSince(a.schema);if(!d.ok)return console.error("Error migrating store",d.error),{type:"error",reason:fO.MigrationError};let e=d.value;if(0===e.length)return{type:"success",value:c};b?.mutateInputStore||(c=d$(c));try{for(let a of e)if("record"===a.scope)for(let[b,d]of Object.entries(c)){if(!(!a.filter||a.filter(d)))continue;let e=a.up(d);e&&(c[b]=e)}else if("store"===a.scope){let b=a.up(c);b&&(c=b)}else cf(a)}catch(a){return console.error("Error migrating store",a),{type:"error",reason:fO.MigrationError}}return{type:"success",value:c}}createIntegrityChecker(a){return this.options.createIntegrityChecker?.(a)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:a,sequence:b})=>[a,b.length?fL(b.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:a})=>[a,0]))}}getType(a){let b=cV(this.types,a);return cg(b,"record type does not exists"),b}}bV("@tldraw/store","4.2.0","esm"),a.s([],80011);class f6 extends Error{constructor(a,b=[]){const c=function(a){if(!a.length)return null;let b="";for(let c of a)"number"==typeof c?b+=`.${c}`:c.startsWith("(")?b.endsWith(")")?b=`${b.slice(0,-1)}, ${c.slice(1)}`:b+=c:b+=`.${c}`;return(b=b.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,"")).startsWith(".")?b.slice(1):b}(b),d=a.split("\n").map((a,b)=>0===b?a:`  ${a}`).join("\n");super(b?`At ${c}: ${d}`:d),this.rawMessage=a,this.path=b}name="ValidationError"}function f7(a,b){try{return b()}catch(b){if(b instanceof f6)throw new f6(b.rawMessage,[a,...b.path]);throw new f6(b.toString(),[a])}}function f8(a){if(null===a)return"null";if(Array.isArray(a))return"an array";let b=typeof a;switch(b){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${b}`;case"object":return`an ${b}`;case"undefined":return"undefined";default:cf(b)}}class f9{constructor(a,b){this.validationFn=a,this.validateUsingKnownGoodVersionFn=b}validate(a){return this.validationFn(a)}validateUsingKnownGoodVersion(a,b){return Object.is(a,b)?a:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(a,b):this.validate(b)}isValid(a){try{return this.validate(a),!0}catch{return!1}}nullable(){return gE(this)}optional(){return gD(this)}refine(a){return new f9(b=>a(this.validate(b)),(b,c)=>{let d=this.validateUsingKnownGoodVersion(b,c);return Object.is(b,d)?b:a(d)})}check(a,b){return"string"==typeof a?this.refine(c=>(f7(`(check ${a})`,()=>b(c)),c)):this.refine(b=>(a(b),b))}}class ga extends f9{constructor(a){super(b=>{let c=gr.validate(b);for(let b=0;b<c.length;b++)f7(b,()=>a.validate(c[b]));return c},(b,c)=>{if(!a.validateUsingKnownGoodVersion)return this.validate(c);let d=gr.validate(c),e=b.length!==d.length;for(let c=0;c<d.length;c++){let f=d[c];if(c>=b.length){e=!0,f7(c,()=>a.validate(f));continue}!Object.is(b[c],f)&&(Object.is(f7(c,()=>a.validateUsingKnownGoodVersion(b[c],f)),b[c])||(e=!0))}return e?c:b}),this.itemValidator=a}nonEmpty(){return this.check(a=>{if(0===a.length)throw new f6("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(a=>{if(a.length<=1)throw new f6("Expected an array with length greater than 1")})}}class gb extends f9{constructor(a,b=!1){super(c=>{if("object"!=typeof c||null===c)throw new f6(`Expected object, got ${f8(c)}`);for(let[b,d]of Object.entries(a))f7(b,()=>{d.validate(cV(c,b))});if(!b){for(let b of Object.keys(c))if(!cU(a,b))throw new f6("Unexpected property",[b])}return c},(c,d)=>{if("object"!=typeof d||null===d)throw new f6(`Expected object, got ${f8(d)}`);let e=!1;for(let[b,f]of Object.entries(a)){let a=cV(c,b),g=cV(d,b);!Object.is(a,g)&&(Object.is(f7(b,()=>f.validateUsingKnownGoodVersion?f.validateUsingKnownGoodVersion(a,g):f.validate(g)),a)||(e=!0))}if(!b){for(let b of Object.keys(d))if(!cU(a,b))throw new f6("Unexpected property",[b])}for(let a of Object.keys(c))if(!cU(d,a)){e=!0;break}return e?d:c}),this.config=a,this.shouldAllowUnknownProperties=b}allowUnknownProperties(){return new gb(this.config,!0)}extend(a){return new gb({...this.config,...a})}}class gc extends f9{constructor(a,b,c,d){super(b=>{this.expectObject(b);let{matchingSchema:c,variant:d}=this.getMatchingSchemaAndVariant(b);return void 0===c?this.unknownValueValidation(b,d):f7(`(${a} = ${d})`,()=>c.validate(b))},(b,c)=>{this.expectObject(c),this.expectObject(b);let{matchingSchema:d,variant:e}=this.getMatchingSchemaAndVariant(c);return void 0===d?this.unknownValueValidation(c,e):cV(b,a)!==cV(c,a)?f7(`(${a} = ${e})`,()=>d.validate(c)):f7(`(${a} = ${e})`,()=>d.validateUsingKnownGoodVersion?d.validateUsingKnownGoodVersion(b,c):d.validate(c))}),this.key=a,this.config=b,this.unknownValueValidation=c,this.useNumberKeys=d}expectObject(a){if("object"!=typeof a||null===a)throw new f6(`Expected an object, got ${f8(a)}`,[])}getMatchingSchemaAndVariant(a){let b=cV(a,this.key);if(this.useNumberKeys||"string"==typeof b){if(this.useNumberKeys&&!Number.isFinite(Number(b)))throw new f6(`Expected a number for key "${this.key}", got "${b}"`)}else throw new f6(`Expected a string for key "${this.key}", got ${f8(b)}`);return{matchingSchema:cU(this.config,b)?this.config[b]:void 0,variant:b}}validateUnknownVariants(a){return new gc(this.key,this.config,a,this.useNumberKeys)}}class gd extends f9{constructor(a,b){super(c=>{if("object"!=typeof c||null===c)throw new f6(`Expected object, got ${f8(c)}`);for(let[d,e]of Object.entries(c))f7(d,()=>{a.validate(d),b.validate(e)});return c},(c,d)=>{if("object"!=typeof d||null===d)throw new f6(`Expected object, got ${f8(d)}`);let e=!1;for(let[f,g]of Object.entries(d)){if(!cU(c,f)){e=!0,f7(f,()=>{a.validate(f),b.validate(g)});continue}let d=cV(c,f),h=g;!Object.is(d,h)&&(Object.is(f7(f,()=>b.validateUsingKnownGoodVersion?b.validateUsingKnownGoodVersion(d,h):b.validate(h)),d)||(e=!0))}for(let a of Object.keys(c))if(!cU(d,a)){e=!0;break}return e?d:c}),this.keyValidator=a,this.valueValidator=b}}function ge(a){return new f9(b=>{if(typeof b!==a)throw new f6(`Expected ${a}, got ${f8(b)}`);return b})}let gf=new f9(a=>a),gg=new f9(a=>a),gh=ge("string"),gi=ge("number").check(a=>{if(Number.isNaN(a))throw new f6("Expected a number, got NaN");if(!Number.isFinite(a))throw new f6(`Expected a finite number, got ${a}`)}),gj=gi.check(a=>{if(a<0)throw new f6(`Expected a positive number, got ${a}`)}),gk=gi.check(a=>{if(a<=0)throw new f6(`Expected a non-zero positive number, got ${a}`)}),gl=gi.check(a=>{if(!Number.isInteger(a))throw new f6(`Expected an integer, got ${a}`)}),gm=gl.check(a=>{if(a<0)throw new f6(`Expected a positive integer, got ${a}`)}),gn=gl.check(a=>{if(a<=0)throw new f6(`Expected a non-zero positive integer, got ${a}`)}),go=ge("boolean"),gp=ge("bigint");function gq(a){return new f9(b=>{if(b!==a)throw new f6(`Expected ${a}, got ${JSON.stringify(b)}`);return a})}let gr=new f9(a=>{if(!Array.isArray(a))throw new f6(`Expected an array, got ${f8(a)}`);return a});function gs(a){return new ga(a)}let gt=new f9(a=>{if("object"!=typeof a||null===a)throw new f6(`Expected object, got ${f8(a)}`);return a});function gu(a){return new gb(a)}function gv(a){return"object"==typeof a&&null!==a&&(Object.getPrototypeOf(a)===Object.prototype||null===Object.getPrototypeOf(a)||Object.getPrototypeOf(a)===d0)}let gw=new f9(a=>{if(function a(b){return null===b||"number"==typeof b||"string"==typeof b||"boolean"==typeof b||(Array.isArray(b)?b.every(a):!!gv(b)&&Object.values(b).every(a))}(a))return a;throw new f6(`Expected json serializable value, got ${typeof a}`)},(a,b)=>{if(Array.isArray(a)&&Array.isArray(b)){let c=a.length!==b.length;for(let d=0;d<b.length;d++){if(d>=a.length){c=!0,gw.validate(b[d]);continue}let e=a[d],f=b[d];!Object.is(e,f)&&(Object.is(gw.validateUsingKnownGoodVersion(e,f),e)||(c=!0))}return c?b:a}if(!(gv(a)&&gv(b)))return gw.validate(b);{let c=!1;for(let d of Object.keys(b)){if(!cU(a,d)){c=!0,gw.validate(b[d]);continue}let e=a[d],f=b[d];!Object.is(e,f)&&(Object.is(gw.validateUsingKnownGoodVersion(e,f),e)||(c=!0))}for(let d of Object.keys(a))if(!cU(b,d)){c=!0;break}return c?b:a}});function gx(){return gy(gh,gw)}function gy(a,b){return new gd(a,b)}function gz(a,b){return new gc(a,b,(c,d)=>{throw new f6(`Expected one of ${Object.keys(b).map(a=>JSON.stringify(a)).join(" or ")}, got ${JSON.stringify(d)}`,[a])},!1)}function gA(a,b){return new gc(a,b,(c,d)=>{throw new f6(`Expected one of ${Object.keys(b).map(a=>JSON.stringify(a)).join(" or ")}, got ${JSON.stringify(d)}`,[a])},!0)}function gB(a,b){return new f9(c=>f7(a,()=>b.validate(c)),(c,d)=>f7(a,()=>b.validateUsingKnownGoodVersion?b.validateUsingKnownGoodVersion(c,d):b.validate(d)))}function gC(a){return new f9(b=>{if(!a.has(b)){let c=Array.from(a,a=>JSON.stringify(a)).join(" or ");throw new f6(`Expected ${c}, got ${b}`)}return b})}function gD(a){return new f9(b=>{if(void 0!==b)return a.validate(b)},(b,c)=>{if((void 0!==b||void 0!==c)&&void 0!==c)return a.validateUsingKnownGoodVersion&&void 0!==b?a.validateUsingKnownGoodVersion(b,c):a.validate(c)})}function gE(a){return new f9(b=>null===b?null:a.validate(b),(b,c)=>null===c?null:a.validateUsingKnownGoodVersion&&null!==b?a.validateUsingKnownGoodVersion(b,c):a.validate(c))}function gF(...a){return gC(new Set(a))}function gG(a){try{return new URL(a)}catch{if(a.startsWith("/")||a.startsWith("./"))try{return new URL(a,"http://example.com")}catch{}throw new f6(`Expected a valid url, got ${JSON.stringify(a)}`)}}let gH=new Set(["http:","https:","mailto:"]),gI=gh.check(a=>{if(""===a)return;let b=gG(a);if(!gH.has(b.protocol.toLowerCase()))throw new f6(`Expected a valid url, got ${JSON.stringify(a)} (invalid protocol)`)}),gJ=new Set(["http:","https:","data:","asset:"]),gK=gh.check(a=>{if(""===a)return;let b=gG(a);if(!gJ.has(b.protocol.toLowerCase()))throw new f6(`Expected a valid url, got ${JSON.stringify(a)} (invalid protocol)`)}),gL=gh.check(a=>{if(""!==a&&!gG(a).protocol.toLowerCase().match(/^https?:$/))throw new f6(`Expected a valid url, got ${JSON.stringify(a)} (invalid protocol)`)}),gM=gh.refine(a=>{try{return dr(a),a}catch{throw new f6(`Expected an index key, got ${JSON.stringify(a)}`)}});function gN(a,b){return new f9(c=>{try{return a.validate(c)}catch{return b.validate(c)}})}a.s(["ArrayOfValidator",()=>ga,"DictValidator",()=>gd,"ObjectValidator",()=>gb,"UnionValidator",()=>gc,"ValidationError",()=>f6,"Validator",()=>f9,"any",()=>gg,"array",()=>gr,"arrayOf",()=>gs,"bigint",()=>gp,"boolean",()=>go,"dict",()=>gy,"httpUrl",()=>gL,"indexKey",()=>gM,"integer",()=>gl,"jsonDict",()=>gx,"jsonValue",()=>gw,"linkUrl",()=>gI,"literal",()=>gq,"literalEnum",()=>gF,"model",()=>gB,"nonZeroInteger",()=>gn,"nonZeroNumber",()=>gk,"nullable",()=>gE,"number",()=>gi,"numberUnion",()=>gA,"object",()=>gu,"optional",()=>gD,"or",()=>gN,"positiveInteger",()=>gm,"positiveNumber",()=>gj,"setEnum",()=>gC,"srcUrl",()=>gK,"string",()=>gh,"union",()=>gz,"unknown",()=>gf,"unknownObject",()=>gt],60150);var gO=a.i(60150);bV("@tldraw/validate","4.2.0","esm"),a.s([],53207);var gP=gO;function gQ(a){return gP.string.refine(b=>{if(!b.startsWith(`${a}:`))throw Error(`${a} ID must start with "${a}:"`);return b})}let gR=gQ("asset");function gS(a,b){return gP.object({id:gR,typeName:gP.literal("asset"),type:gP.literal(a),props:b,meta:gP.jsonValue})}var gP=gO;let gT=gP.object({x:gP.number,y:gP.number,z:gP.number.optional()}),gU=gP.object({x:gP.number,y:gP.number,w:gP.number,h:gP.number});var gP=gO;let gV=gP.number.check(a=>{if(a<0||a>1)throw new gP.ValidationError("Opacity must be between 0 and 1")}),gW=gP.string.refine(a=>{if(!a.startsWith("page:")&&!a.startsWith("shape:"))throw Error('Parent ID must start with "page:" or "shape:"');return a}),gX=gQ("shape");function gY(a,b,c){return gP.object({id:gX,typeName:gP.literal("shape"),x:gP.number,y:gP.number,rotation:gP.number,index:gP.indexKey,parentId:gW,type:gP.literal(a),isLocked:gP.boolean,opacity:gV,props:b?gP.object(b):gP.jsonValue,meta:c?gP.object(c):gP.jsonValue})}let gZ=gQ("binding");function g$(a,b,c){return gP.object({id:gZ,typeName:gP.literal("binding"),type:gP.literal(a),fromId:gX,toId:gX,props:b?gP.object(b):gP.jsonValue,meta:c?gP.object(c):gP.jsonValue})}fJ("com.tldraw.binding",{});let g_=fK({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function g0(a){return!!a&&"binding"===a.typeName}function g1(a){return!!a&&a.startsWith("binding:")}function g2(a){return`binding:${a??cA(void 0)}`}function g3(a){return a}function g4(a,b){return c0(b,(b,c)=>`com.tldraw.binding.${a}/${c}`)}var gP=gO;let g5=gP.object({type:gP.string,content:gP.arrayOf(gP.unknown)});function g6(a){return{type:"doc",content:a.split("\n").map(a=>a?{type:"paragraph",content:[{type:"text",text:a}]}:{type:"paragraph"})}}var gP=gO;class g7{constructor(a,b,c){this.id=a,this.defaultValue=b,this.type=c}static define(a,b){let{defaultValue:c,type:d=gP.any}=b;return new g7(a,c,d)}static defineEnum(a,b){let{defaultValue:c,values:d}=b;return new g8(a,c,d)}setDefaultValue(a){this.defaultValue=a}validate(a){return this.type.validate(a)}validateUsingKnownGoodVersion(a,b){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(a,b):this.validate(b)}}class g8 extends g7{constructor(a,b,c){super(a,b,gP.literalEnum(...c)),this.values=c}}let g9=fJ("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),ha=fK({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:g9.AddIsLocked,up:a=>{a.isLocked=!1},down:a=>{delete a.isLocked}},{id:g9.HoistOpacity,up:a=>{a.opacity=Number(a.props.opacity??"1"),delete a.props.opacity},down:a=>{let b=a.opacity;delete a.opacity,a.props.opacity=b<.175?"0.1":b<.375?"0.25":b<.625?"0.5":b<.875?"0.75":"1"}},{id:g9.AddMeta,up:a=>{a.meta={}}},{id:g9.AddWhite,up:a=>{},down:a=>{"white"===a.props.color&&(a.props.color="black")}}]});function hb(a){return!!a&&"shape"===a.typeName}function hc(a){return!!a&&a.startsWith("shape:")}function hd(a){return`shape:${a??cA(void 0)}`}function he(a){let b=new Map;for(let[c,d]of Object.entries(a))if(d instanceof g7){if(b.has(d))throw Error(`Duplicate style prop ${d.id}. Each style prop can only be used once within a shape.`);b.set(d,c)}return b}function hf(a){return a}function hg(a,b){return c0(b,(b,c)=>`com.tldraw.shape.${a}/${c}`)}function hh(a,b){let c=[];for(let[d,{migrations:e}]of Object.entries(b)){let b=`com.tldraw.${a}.${d}`;e?"sequenceId"in e?(cg(b===e.sequenceId,`sequenceId mismatch for ${d} ${fU} migrations. Expected '${b}', got '${e.sequenceId}'`),c.push(e)):"sequence"in e?c.push(fI({sequenceId:b,retroactive:!0,sequence:e.sequence.map(b=>"id"in b?hi(a,d,b):b)})):c.push(fI({sequenceId:b,retroactive:!0,sequence:Object.keys(e.migrators).map(a=>Number(a)).sort((a,b)=>a-b).map(c=>({id:`${b}/${c}`,scope:"record",filter:b=>b.typeName===a&&b.type===d,up:a=>{let b=e.migrators[c].up(a);if(b)return b},down:a=>{let b=e.migrators[c].down(a);if(b)return b}}))})):c.push(fI({sequenceId:b,retroactive:!0,sequence:[]}))}return c}function hi(a,b,c){return{id:c.id,dependsOn:c.dependsOn,scope:"record",filter:c=>c.typeName===a&&c.type===b,up:a=>{let b=c.up(a.props);b&&(a.props=b)},down:"function"==typeof c.down?a=>{let b=c.down(a.props);b&&(a.props=b)}:void 0}}let hj=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],hk={lightMode:{id:"light",text:"#000000",background:"#f9fafb",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",linedFill:"#363636",frameHeadingStroke:"#717171",frameHeadingFill:"#ffffff",frameStroke:"#717171",frameFill:"#ffffff",frameText:"#000000",noteFill:"#FCE19C",noteText:"#000000",semi:"#e8e8e8",pattern:"#494949",highlightSrgb:"#fddd00",highlightP3:"color(display-p3 0.972 0.8205 0.05)"},blue:{solid:"#4465e9",fill:"#4465e9",linedFill:"#6580ec",frameHeadingStroke:"#6681ec",frameHeadingFill:"#f9fafe",frameStroke:"#6681ec",frameFill:"#f9fafe",frameText:"#000000",noteFill:"#8AA3FF",noteText:"#000000",semi:"#dce1f8",pattern:"#6681ee",highlightSrgb:"#10acff",highlightP3:"color(display-p3 0.308 0.6632 0.9996)"},green:{solid:"#099268",fill:"#099268",linedFill:"#0bad7c",frameHeadingStroke:"#37a684",frameHeadingFill:"#f8fcfa",frameStroke:"#37a684",frameFill:"#f8fcfa",frameText:"#000000",noteFill:"#6FC896",noteText:"#000000",semi:"#d3e9e3",pattern:"#39a785",highlightSrgb:"#00ffc8",highlightP3:"color(display-p3 0.2536 0.984 0.7981)"},grey:{solid:"#9fa8b2",fill:"#9fa8b2",linedFill:"#bbc1c9",frameHeadingStroke:"#aaaaab",frameHeadingFill:"#fbfcfc",frameStroke:"#aaaaab",frameFill:"#fcfcfd",frameText:"#000000",noteFill:"#C0CAD3",noteText:"#000000",semi:"#eceef0",pattern:"#bcc3c9",highlightSrgb:"#cbe7f1",highlightP3:"color(display-p3 0.8163 0.9023 0.9416)"},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",linedFill:"#7abaf5",frameHeadingStroke:"#6cb2f3",frameHeadingFill:"#f8fbfe",frameStroke:"#6cb2f3",frameFill:"#fafcff",frameText:"#000000",noteFill:"#9BC4FD",noteText:"#000000",semi:"#ddedfa",pattern:"#6fbbf8",highlightSrgb:"#00f4ff",highlightP3:"color(display-p3 0.1512 0.9414 0.9996)"},"light-green":{solid:"#4cb05e",fill:"#4cb05e",linedFill:"#7ec88c",frameHeadingStroke:"#6dbe7c",frameHeadingFill:"#f8fcf9",frameStroke:"#6dbe7c",frameFill:"#fafdfa",frameText:"#000000",noteFill:"#98D08A",noteText:"#000000",semi:"#dbf0e0",pattern:"#65cb78",highlightSrgb:"#65f641",highlightP3:"color(display-p3 0.563 0.9495 0.3857)"},"light-red":{solid:"#f87777",fill:"#f87777",linedFill:"#f99a9a",frameHeadingStroke:"#f89090",frameHeadingFill:"#fffafa",frameStroke:"#f89090",frameFill:"#fffbfb",frameText:"#000000",noteFill:"#F7A5A1",noteText:"#000000",semi:"#f4dadb",pattern:"#fe9e9e",highlightSrgb:"#ff7fa3",highlightP3:"color(display-p3 0.9988 0.5301 0.6397)"},"light-violet":{solid:"#e085f4",fill:"#e085f4",linedFill:"#e9abf7",frameHeadingStroke:"#e59bf5",frameHeadingFill:"#fefaff",frameStroke:"#e59bf5",frameFill:"#fefbff",frameText:"#000000",noteFill:"#DFB0F9",noteText:"#000000",semi:"#f5eafa",pattern:"#e9acf8",highlightSrgb:"#ff88ff",highlightP3:"color(display-p3 0.9676 0.5652 0.9999)"},orange:{solid:"#e16919",fill:"#e16919",linedFill:"#ea8643",frameHeadingStroke:"#e68544",frameHeadingFill:"#fef9f6",frameStroke:"#e68544",frameFill:"#fef9f6",frameText:"#000000",noteFill:"#FAA475",noteText:"#000000",semi:"#f8e2d4",pattern:"#f78438",highlightSrgb:"#ffa500",highlightP3:"color(display-p3 0.9988 0.6905 0.266)"},red:{solid:"#e03131",fill:"#e03131",linedFill:"#e75f5f",frameHeadingStroke:"#e55757",frameHeadingFill:"#fef7f7",frameStroke:"#e55757",frameFill:"#fef9f9",frameText:"#000000",noteFill:"#FC8282",noteText:"#000000",semi:"#f4dadb",pattern:"#e55959",highlightSrgb:"#ff636e",highlightP3:"color(display-p3 0.9992 0.4376 0.45)"},violet:{solid:"#ae3ec9",fill:"#ae3ec9",linedFill:"#be68d4",frameHeadingStroke:"#bc62d3",frameHeadingFill:"#fcf7fd",frameStroke:"#bc62d3",frameFill:"#fdf9fd",frameText:"#000000",noteFill:"#DB91FD",noteText:"#000000",semi:"#ecdcf2",pattern:"#bd63d3",highlightSrgb:"#c77cff",highlightP3:"color(display-p3 0.7469 0.5089 0.9995)"},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",linedFill:"#f5c27a",frameHeadingStroke:"#f3bb6c",frameHeadingFill:"#fefcf8",frameStroke:"#f3bb6c",frameFill:"#fffdfa",frameText:"#000000",noteFill:"#FED49A",noteText:"#000000",semi:"#f9f0e6",pattern:"#fecb92",highlightSrgb:"#fddd00",highlightP3:"color(display-p3 0.972 0.8705 0.05)"},white:{solid:"#FFFFFF",fill:"#FFFFFF",linedFill:"#ffffff",semi:"#f5f5f5",pattern:"#f9f9f9",frameHeadingStroke:"#7d7d7d",frameHeadingFill:"#ffffff",frameStroke:"#7d7d7d",frameFill:"#ffffff",frameText:"#000000",noteFill:"#FFFFFF",noteText:"#000000",highlightSrgb:"#ffffff",highlightP3:"color(display-p3 1 1 1)"}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",linedFill:"#ffffff",frameHeadingStroke:"#5c5c5c",frameHeadingFill:"#252525",frameStroke:"#5c5c5c",frameFill:"#0c0c0c",frameText:"#f2f2f2",noteFill:"#2c2c2c",noteText:"#f2f2f2",semi:"#2c3036",pattern:"#989898",highlightSrgb:"#d2b700",highlightP3:"color(display-p3 0.8078 0.6225 0.0312)"},blue:{solid:"#4f72fc",fill:"#4f72fc",linedFill:"#3c5cdd",frameHeadingStroke:"#384994",frameHeadingFill:"#1C2036",frameStroke:"#384994",frameFill:"#11141f",frameText:"#f2f2f2",noteFill:"#2A3F98",noteText:"#f2f2f2",semi:"#262d40",pattern:"#3a4b9e",highlightSrgb:"#0079d2",highlightP3:"color(display-p3 0.0032 0.4655 0.7991)"},green:{solid:"#099268",fill:"#099268",linedFill:"#087856",frameHeadingStroke:"#10513C",frameHeadingFill:"#14241f",frameStroke:"#10513C",frameFill:"#0E1614",frameText:"#f2f2f2",noteFill:"#014429",noteText:"#f2f2f2",semi:"#253231",pattern:"#366a53",highlightSrgb:"#009774",highlightP3:"color(display-p3 0.0085 0.582 0.4604)"},grey:{solid:"#9398b0",fill:"#9398b0",linedFill:"#8388a5",frameHeadingStroke:"#42474D",frameHeadingFill:"#23262A",frameStroke:"#42474D",frameFill:"#151719",frameText:"#f2f2f2",noteFill:"#56595F",noteText:"#f2f2f2",semi:"#33373c",pattern:"#7c8187",highlightSrgb:"#9cb4cb",highlightP3:"color(display-p3 0.6299 0.7012 0.7856)"},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",linedFill:"#2793ec",frameHeadingStroke:"#075797",frameHeadingFill:"#142839",frameStroke:"#075797",frameFill:"#0B1823",frameText:"#f2f2f2",noteFill:"#1F5495",noteText:"#f2f2f2",semi:"#2a3642",pattern:"#4d7aa9",highlightSrgb:"#00bdc8",highlightP3:"color(display-p3 0.0023 0.7259 0.7735)"},"light-green":{solid:"#40c057",fill:"#40c057",linedFill:"#37a44b",frameHeadingStroke:"#1C5427",frameHeadingFill:"#18251A",frameStroke:"#1C5427",frameFill:"#0F1911",frameText:"#f2f2f2",noteFill:"#21581D",noteText:"#f2f2f2",semi:"#2a3830",pattern:"#4e874e",highlightSrgb:"#00a000",highlightP3:"color(display-p3 0.2711 0.6172 0.0195)"},"light-red":{solid:"#ff8787",fill:"#ff8787",linedFill:"#ff6666",frameHeadingStroke:"#6f3232",frameHeadingFill:"#341818",frameStroke:"#6f3232",frameFill:"#181212",frameText:"#f2f2f2",noteFill:"#7a3333",noteText:"#f2f2f2",semi:"#3c2b2b",pattern:"#a56767",highlightSrgb:"#db005b",highlightP3:"color(display-p3 0.7849 0.0585 0.3589)"},"light-violet":{solid:"#e599f7",fill:"#e599f7",linedFill:"#dc71f4",frameHeadingStroke:"#6c367a",frameHeadingFill:"#2D2230",frameStroke:"#6c367a",frameFill:"#1C151E",frameText:"#f2f2f2",noteFill:"#762F8E",noteText:"#f2f2f2",semi:"#383442",pattern:"#9770a9",highlightSrgb:"#c400c7",highlightP3:"color(display-p3 0.7024 0.0403 0.753)"},orange:{solid:"#f76707",fill:"#f76707",linedFill:"#f54900",frameHeadingStroke:"#773a0e",frameHeadingFill:"#2f1d13",frameStroke:"#773a0e",frameFill:"#1c1512",frameText:"#f2f2f2",noteFill:"#7c3905",noteText:"#f2f2f2",semi:"#3b2e27",pattern:"#9f552d",highlightSrgb:"#d07a00",highlightP3:"color(display-p3 0.7699 0.4937 0.0085)"},red:{solid:"#e03131",fill:"#e03131",linedFill:"#c31d1d",frameHeadingStroke:"#701e1e",frameHeadingFill:"#301616",frameStroke:"#701e1e",frameFill:"#1b1313",frameText:"#f2f2f2",noteFill:"#7e201f",noteText:"#f2f2f2",semi:"#382726",pattern:"#8f3734",highlightSrgb:"#de002c",highlightP3:"color(display-p3 0.7978 0.0509 0.2035)"},violet:{solid:"#ae3ec9",fill:"#ae3ec9",linedFill:"#8f2fa7",frameHeadingStroke:"#6d1583",frameHeadingFill:"#27152e",frameStroke:"#6d1583",frameFill:"#1b0f21",frameText:"#f2f2f2",noteFill:"#5f1c70",noteText:"#f2f2f2",semi:"#342938",pattern:"#763a8b",highlightSrgb:"#9e00ee",highlightP3:"color(display-p3 0.5651 0.0079 0.8986)"},yellow:{solid:"#ffc034",fill:"#ffc034",linedFill:"#ffae00",frameHeadingStroke:"#684e12",frameHeadingFill:"#2a2113",frameStroke:"#684e12",frameFill:"#1e1911",frameText:"#f2f2f2",noteFill:"#8a5e1c",noteText:"#f2f2f2",semi:"#3b352b",pattern:"#fecb92",highlightSrgb:"#d2b700",highlightP3:"color(display-p3 0.8078 0.7225 0.0312)"},white:{solid:"#f3f3f3",fill:"#f3f3f3",linedFill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",frameHeadingStroke:"#ffffff",frameHeadingFill:"#ffffff",frameStroke:"#ffffff",frameFill:"#ffffff",frameText:"#000000",noteFill:"#eaeaea",noteText:"#1d1d1d",highlightSrgb:"#ffffff",highlightP3:"color(display-p3 1 1 1)"}}};function hl(a){return a.isDarkMode?hk.darkMode:hk.lightMode}let hm=g7.defineEnum("tldraw:color",{defaultValue:"black",values:hj}),hn=g7.defineEnum("tldraw:labelColor",{defaultValue:"black",values:hj}),ho=new Set(hj);function hp(a,b,c){return ho.has(b)?a[b][c]:b}let hq=g7.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),hr=g7.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill","lined-fill"]}),hs=g7.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),ht={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},hu=g7.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),hv=g7.defineEnum("tldraw:arrowKind",{defaultValue:"arc",values:["arc","elbow"]}),hw=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],hx=g7.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:hw}),hy=g7.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:hw}),hz={kind:hv,labelColor:hn,color:hm,fill:hr,dash:hq,size:hu,arrowheadStart:hx,arrowheadEnd:hy,font:hs,start:gT,end:gT,bend:gP.number,richText:g5,labelPosition:gP.number,scale:gP.nonZeroNumber,elbowMidPoint:gP.number},hA=hg("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5,AddElbow:6,AddRichText:7});function hB(a){return hi("shape","arrow",a)}let hC=fI({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[hB({id:hA.AddLabelColor,up:a=>{a.labelColor="black"},down:"retired"}),hB({id:hA.AddIsPrecise,up:({start:a,end:b})=>{"binding"===a.type&&(a.isPrecise=.5!==a.normalizedAnchor.x||.5!==a.normalizedAnchor.y),"binding"===b.type&&(b.isPrecise=.5!==b.normalizedAnchor.x||.5!==b.normalizedAnchor.y)},down:({start:a,end:b})=>{"binding"===a.type&&(a.isPrecise||(a.normalizedAnchor={x:.5,y:.5}),delete a.isPrecise),"binding"===b.type&&(b.isPrecise||(b.normalizedAnchor={x:.5,y:.5}),delete b.isPrecise)}}),hB({id:hA.AddLabelPosition,up:a=>{a.labelPosition=.5},down:a=>{delete a.labelPosition}}),{id:hA.ExtractBindings,scope:"store",up:a=>{for(let b of Object.values(a).filter(a=>"shape"===a.typeName&&"arrow"===a.type)){let{start:c,end:d}=b.props;if("binding"===c.type){let d=g2(),e={typeName:"binding",id:d,type:"arrow",fromId:b.id,toId:c.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:c.normalizedAnchor,isExact:c.isExact,isPrecise:c.isPrecise}};a[d]=e,b.props.start={x:0,y:0}}else delete b.props.start.type;if("binding"===d.type){let c=g2(),e={typeName:"binding",id:c,type:"arrow",fromId:b.id,toId:d.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:d.normalizedAnchor,isExact:d.isExact,isPrecise:d.isPrecise}};a[c]=e,b.props.end={x:0,y:0}}else delete b.props.end.type}}},hB({id:hA.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}}),hB({id:hA.AddElbow,up:a=>{a.kind="arc",a.elbowMidPoint=.5},down:a=>{delete a.kind,delete a.elbowMidPoint}}),hB({id:hA.AddRichText,up:a=>{a.richText=g6(a.text),delete a.text}})]}),hD=gP.literalEnum("center","edge-point","edge","none"),hE={terminal:gP.literalEnum("start","end"),normalizedAnchor:gT,isExact:gP.boolean,isPrecise:gP.boolean,snap:hD},hF=g4("arrow",{AddSnap:1}),hG={sequence:[{dependsOn:[hA.ExtractBindings]},{id:hF.AddSnap,up:a=>{a.snap="none"},down:a=>{delete a.snap}}]};var gP=gO;let hH=gP.model("camera",gP.object({typeName:gP.literal("camera"),id:gQ("camera"),x:gP.number,y:gP.number,z:gP.number,meta:gP.jsonValue})),hI=fK({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:fJ("com.tldraw.camera",{AddMeta:1}).AddMeta,up:a=>{a.meta={}}}]}),hJ=fV("camera",{validator:hH,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}}));var gP=gO;let hK=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),hL=gP.setEnum(hK),hM=gP.object({type:hL,rotation:gP.number});var gP=gO;let hN=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),hO=gP.setEnum(hN),hP=new Set(["starting","paused","active","stopping"]),hQ=gP.object({id:gP.string,points:gP.arrayOf(gT),size:gP.positiveNumber,color:hO,opacity:gP.number,state:gP.setEnum(hP),delay:gP.number,shrink:gP.number,taper:gP.boolean});var gP=gO;let hR=gQ("page"),hS=gP.model("page",gP.object({typeName:gP.literal("page"),id:hR,name:gP.string,index:gP.indexKey,meta:gP.jsonValue})),hT=fK({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:fJ("com.tldraw.page",{AddMeta:1}).AddMeta,up:a=>{a.meta={}}}]}),hU=fV("page",{validator:hS,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function hV(a){return hU.isId(a)}let hW={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function hX(a){return a?c_(a,a=>hW[a]):null}gQ("instance");let hY=fJ("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),hZ=fK({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:hY.AddTransparentExportBgs,up:a=>({...a,exportBackground:!0})},{id:hY.RemoveDialog,up:({dialog:a,...b})=>b},{id:hY.AddToolLockMode,up:a=>({...a,isToolLocked:!1})},{id:hY.RemoveExtraPropsForNextShape,up:({propsForNextShape:a,...b})=>({...b,propsForNextShape:Object.fromEntries(Object.entries(a).filter(([a])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(a)))})},{id:hY.AddLabelColor,up:({propsForNextShape:a,...b})=>({...b,propsForNextShape:{...a,labelColor:"black"}})},{id:hY.AddFollowingUserId,up:a=>({...a,followingUserId:null})},{id:hY.RemoveAlignJustify,up:a=>{let b=a.propsForNextShape.align;return"justify"===b&&(b="start"),{...a,propsForNextShape:{...a.propsForNextShape,align:b}}}},{id:hY.AddZoom,up:a=>({...a,zoomBrush:null})},{id:hY.AddVerticalAlign,up:a=>({...a,propsForNextShape:{...a.propsForNextShape,verticalAlign:"middle"}})},{id:hY.AddScribbleDelay,up:a=>null!==a.scribble?{...a,scribble:{...a.scribble,delay:0}}:{...a}},{id:hY.RemoveUserId,up:({userId:a,...b})=>b},{id:hY.AddIsPenModeAndIsGridMode,up:a=>({...a,isPenMode:!1,isGridMode:!1})},{id:hY.HoistOpacity,up:({propsForNextShape:{opacity:a,...b},...c})=>({...c,opacityForNextShape:Number(a??"1"),propsForNextShape:b})},{id:hY.AddChat,up:a=>({...a,chatMessage:"",isChatting:!1})},{id:hY.AddHighlightedUserIds,up:a=>({...a,highlightedUserIds:[]})},{id:hY.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:a,...b})=>({...b,stylesForNextShape:{}})},{id:hY.AddMeta,up:a=>({...a,meta:{}})},{id:hY.RemoveCursorColor,up:a=>{let{color:b,...c}=a.cursor;return{...a,cursor:c}}},{id:hY.AddLonelyProperties,up:a=>({...a,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:hY.ReadOnlyReadonly,up:({isReadOnly:a,...b})=>({...b,isReadonly:a})},{id:hY.AddHoveringCanvas,up:a=>({...a,isHoveringCanvas:null})},{id:hY.AddScribbles,up:({scribble:a,...b})=>({...b,scribbles:[]})},{id:hY.AddInset,up:a=>({...a,insets:[!1,!1,!1,!1]}),down:({insets:a,...b})=>({...b})},{id:hY.AddDuplicateProps,up:a=>({...a,duplicateProps:null}),down:({duplicateProps:a,...b})=>({...b})},{id:hY.RemoveCanMoveCamera,up:({canMoveCamera:a,...b})=>({...b}),down:a=>({...a,canMoveCamera:!0})}]}),h$="instance:instance";var gP=gO;let h_=gP.model("instance_page_state",gP.object({typeName:gP.literal("instance_page_state"),id:gQ("instance_page_state"),pageId:hR,selectedShapeIds:gP.arrayOf(gX),hintingShapeIds:gP.arrayOf(gX),erasingShapeIds:gP.arrayOf(gX),hoveredShapeId:gX.nullable(),editingShapeId:gX.nullable(),croppingShapeId:gX.nullable(),focusedGroupId:gX.nullable(),meta:gP.jsonValue})),h0=fJ("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),h1=fK({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:h0.AddCroppingId,up(a){a.croppingShapeId=null}},{id:h0.RemoveInstanceIdAndCameraId,up(a){delete a.instanceId,delete a.cameraId}},{id:h0.AddMeta,up:a=>{a.meta={}}},{id:h0.RenameProperties,up:a=>{},down:a=>{}},{id:h0.RenamePropertiesAgain,up:a=>{a.selectedShapeIds=a.selectedIds,delete a.selectedIds,a.hintingShapeIds=a.hintingIds,delete a.hintingIds,a.erasingShapeIds=a.erasingIds,delete a.erasingIds,a.hoveredShapeId=a.hoveredId,delete a.hoveredId,a.editingShapeId=a.editingId,delete a.editingId,a.croppingShapeId=a.croppingShapeId??a.croppingId??null,delete a.croppingId,a.focusedGroupId=a.focusLayerId,delete a.focusLayerId},down:a=>{a.selectedIds=a.selectedShapeIds,delete a.selectedShapeIds,a.hintingIds=a.hintingShapeIds,delete a.hintingShapeIds,a.erasingIds=a.erasingShapeIds,delete a.erasingShapeIds,a.hoveredId=a.hoveredShapeId,delete a.hoveredShapeId,a.editingId=a.editingShapeId,delete a.editingShapeId,a.croppingId=a.croppingShapeId,delete a.croppingShapeId,a.focusLayerId=a.focusedGroupId,delete a.focusedGroupId}}]}),h2=fV("instance_page_state",{validator:h_,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}}));var gP=gO;let h3=gP.model("pointer",gP.object({typeName:gP.literal("pointer"),id:gQ("pointer"),x:gP.number,y:gP.number,lastActivityTimestamp:gP.number,meta:gP.jsonValue})),h4=fK({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:fJ("com.tldraw.pointer",{AddMeta:1}).AddMeta,up:a=>{a.meta={}}}]}),h5=fV("pointer",{validator:h3,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),h6=h5.createId("pointer");var gP=gO;let h7=gP.model("instance_presence",gP.object({typeName:gP.literal("instance_presence"),id:gQ("instance_presence"),userId:gP.string,userName:gP.string,lastActivityTimestamp:gP.number.nullable(),followingUserId:gP.string.nullable(),cursor:gP.object({x:gP.number,y:gP.number,type:hL,rotation:gP.number}).nullable(),color:gP.string,camera:gP.object({x:gP.number,y:gP.number,z:gP.number}).nullable(),screenBounds:gU.nullable(),selectedShapeIds:gP.arrayOf(gQ("shape")),currentPageId:gQ("page"),brush:gU.nullable(),scribbles:gP.arrayOf(hQ),chatMessage:gP.string,meta:gP.jsonValue})),h8=fJ("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),h9=fK({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:h8.AddScribbleDelay,up:a=>{null!==a.scribble&&(a.scribble.delay=0)}},{id:h8.RemoveInstanceId,up:a=>{delete a.instanceId}},{id:h8.AddChatMessage,up:a=>{a.chatMessage=""}},{id:h8.AddMeta,up:a=>{a.meta={}}},{id:h8.RenameSelectedShapeIds,up:a=>{}},{id:h8.NullableCameraCursor,up:a=>{},down:a=>{null===a.camera&&(a.camera={x:0,y:0,z:1}),null===a.lastActivityTimestamp&&(a.lastActivityTimestamp=0),null===a.cursor&&(a.cursor={type:"default",x:0,y:0,rotation:0}),null===a.screenBounds&&(a.screenBounds={x:0,y:0,w:1,h:1})}}]}),ia=fV("instance_presence",{validator:h7,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}}));function ib(a,b){return c=>eB("instancePresence",()=>{let d=a.get();if(!d)return null;let e=ic(c,d);return e?ia.create({...e,id:b??ia.createId(c.id)}):null})}function ic(a,b){let c=a.get(h$),d=a.get(h2.createId(c?.currentPageId)),e=a.get(hJ.createId(c?.currentPageId)),f=a.get(h6);return d&&c&&e&&f?{selectedShapeIds:d.selectedShapeIds,brush:c.brush,scribbles:c.scribbles,userId:b.id,userName:b.name??"",followingUserId:c.followingUserId,camera:{x:e.x,y:e.y,z:e.z},color:b.color??"#FF0000",currentPageId:c.currentPageId,cursor:{x:f.x,y:f.y,rotation:c.cursor.rotation,type:c.cursor.type},lastActivityTimestamp:f.lastActivityTimestamp,screenBounds:c.screenBounds,chatMessage:c.chatMessage,meta:{}}:null}var gP=gO;let id=gP.model("document",gP.object({typeName:gP.literal("document"),id:gP.literal("document:document"),gridSize:gP.number,name:gP.string,meta:gP.jsonValue}));function ie(a){return!!a&&"document"===a.typeName}let ig=fJ("com.tldraw.document",{AddName:1,AddMeta:2}),ih=fK({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:ig.AddName,up:a=>{a.name=""},down:a=>{delete a.name}},{id:ig.AddMeta,up:a=>{a.meta={}}}]}),ii=fV("document",{validator:id,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),ij=ii.createId("document");function ik(a){"asset"===a.typeName&&("src"in a&&(a.src="<redacted>"),"src"in a.props&&(a.props.src="<redacted>"))}function il({error:a,phase:b,record:c,recordBefore:d}){throw co(a,{tags:{origin:"store.validateRecord",storePhase:b,isExistingValidationIssue:"initialize"===b},extras:{recordBefore:d?ik(d$(d)):void 0,recordAfter:ik(d$(c))}}),a}function im(a){let b=a.query.ids("page"),c=a.query.records("instance_page_state"),d=()=>{if(!a.has(ij))return a.put([ii.create({id:ij,name:a.props.defaultName})]),d();if(!a.has(h6))return a.put([h5.create({id:h6})]),d();let e=b.get();if(0===e.size)return a.put([hU.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),d();let f=()=>[...e].map(b=>a.get(b)).sort(dz)[0].id,g=a.get(h$);if(!g)return a.put([a.schema.types.instance.create({id:h$,currentPageId:f(),exportBackground:!0})]),d();if(!e.has(g.currentPageId))return a.put([{...g,currentPageId:f()}]),d();let h=new Set,i=new Set;for(let b of e){let c=h2.createId(b);a.get(c)||h.add(c);let d=hJ.createId(b);a.has(d)||i.add(d)}for(let b of(h.size>0&&a.put([...h].map(a=>h2.create({id:a,pageId:h2.parseId(a)}))),i.size>0&&a.put([...i].map(a=>hJ.create({id:a}))),c.get())){if(!e.has(b.pageId)){a.remove([b.id]);continue}if(b.croppingShapeId&&!a.has(b.croppingShapeId))return a.put([{...b,croppingShapeId:null}]),d();if(b.focusedGroupId&&!a.has(b.focusedGroupId))return a.put([{...b,focusedGroupId:null}]),d();if(b.hoveredShapeId&&!a.has(b.hoveredShapeId))return a.put([{...b,hoveredShapeId:null}]),d();let c=b.selectedShapeIds.filter(b=>a.has(b));if(c.length!==b.selectedShapeIds.length)return a.put([{...b,selectedShapeIds:c}]),d();let f=b.hintingShapeIds.filter(b=>a.has(b));if(f.length!==b.hintingShapeIds.length)return a.put([{...b,hintingShapeIds:f}]),d();let g=b.erasingShapeIds.filter(b=>a.has(b));if(g.length!==b.erasingShapeIds.length)return a.put([{...b,erasingShapeIds:g}]),d()}};return d}var gP=gO;let io=gS("bookmark",gP.object({title:gP.string,description:gP.string,image:gP.string,favicon:gP.string,src:gP.srcUrl.nullable()})),ip=fJ("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),iq=fK({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:a=>"bookmark"===a.type,sequence:[{id:ip.MakeUrlsValid,up:a=>{gP.srcUrl.isValid(a.props.src)||(a.props.src="")},down:a=>{}},{id:ip.AddFavicon,up:a=>{gP.srcUrl.isValid(a.props.favicon)||(a.props.favicon="")},down:a=>{delete a.props.favicon}}]});var gP=gO;let ir=gS("image",gP.object({w:gP.number,h:gP.number,name:gP.string,isAnimated:gP.boolean,mimeType:gP.string.nullable(),src:gP.srcUrl.nullable(),fileSize:gP.nonZeroNumber.optional()})),is=fJ("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),it=fK({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:a=>"image"===a.type,sequence:[{id:is.AddIsAnimated,up:a=>{a.props.isAnimated=!1},down:a=>{delete a.props.isAnimated}},{id:is.RenameWidthHeight,up:a=>{a.props.w=a.props.width,a.props.h=a.props.height,delete a.props.width,delete a.props.height},down:a=>{a.props.width=a.props.w,a.props.height=a.props.h,delete a.props.w,delete a.props.h}},{id:is.MakeUrlsValid,up:a=>{gP.srcUrl.isValid(a.props.src)||(a.props.src="")},down:a=>{}},{id:is.AddFileSize,up:a=>{a.props.fileSize=-1},down:a=>{delete a.props.fileSize}},{id:is.MakeFileSizeOptional,up:a=>{-1===a.props.fileSize&&(a.props.fileSize=void 0)},down:a=>{void 0===a.props.fileSize&&(a.props.fileSize=-1)}}]});var gP=gO;let iu=gS("video",gP.object({w:gP.number,h:gP.number,name:gP.string,isAnimated:gP.boolean,mimeType:gP.string.nullable(),src:gP.srcUrl.nullable(),fileSize:gP.number.optional()})),iv=fJ("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),iw=fK({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:a=>"video"===a.type,sequence:[{id:iv.AddIsAnimated,up:a=>{a.props.isAnimated=!1},down:a=>{delete a.props.isAnimated}},{id:iv.RenameWidthHeight,up:a=>{a.props.w=a.props.width,a.props.h=a.props.height,delete a.props.width,delete a.props.height},down:a=>{a.props.width=a.props.w,a.props.height=a.props.h,delete a.props.w,delete a.props.h}},{id:iv.MakeUrlsValid,up:a=>{gP.srcUrl.isValid(a.props.src)||(a.props.src="")},down:a=>{}},{id:iv.AddFileSize,up:a=>{a.props.fileSize=-1},down:a=>{delete a.props.fileSize}},{id:iv.MakeFileSizeOptional,up:a=>{-1===a.props.fileSize&&(a.props.fileSize=void 0)},down:a=>{void 0===a.props.fileSize&&(a.props.fileSize=-1)}}]});var gP=gO;let ix=gP.model("asset",gP.union("type",{image:ir,video:iu,bookmark:io})),iy=fK({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:fJ("com.tldraw.asset",{AddMeta:1}).AddMeta,up:a=>{a.meta={}}}]}),iz=fV("asset",{validator:ix,scope:"document"}).withDefaultProperties(()=>({meta:{}}));var gP=gO;let iA={w:gP.nonZeroNumber,h:gP.nonZeroNumber,assetId:gR.nullable(),url:gP.linkUrl},iB=hg("bookmark",{NullAssetId:1,MakeUrlsValid:2}),iC={sequence:[{id:iB.NullAssetId,up:a=>{void 0===a.assetId&&(a.assetId=null)},down:"retired"},{id:iB.MakeUrlsValid,up:a=>{gP.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}}]};var gP=gO;let iD=gP.object({type:gP.literalEnum("free","straight"),points:gP.arrayOf(gT)}),iE={color:hm,fill:hr,dash:hq,size:hu,segments:gP.arrayOf(iD),isComplete:gP.boolean,isClosed:gP.boolean,isPen:gP.boolean,scale:gP.nonZeroNumber},iF=hg("draw",{AddInPen:1,AddScale:2}),iG={sequence:[{id:iF.AddInPen,up:a=>{let{points:b}=a.segments[0];if(0===b.length){a.isPen=!1;return}let c=0!==b[0].z&&.5!==b[0].z;b[1]&&(c=c&&0!==b[1].z&&.5!==b[1].z),a.isPen=c},down:"retired"},{id:iF.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}}]};var gP=gO;let iH=/(^\/r\/[^/]+\/?$)/,iI=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(iH))return a}},{hostnames:["figma.com"],fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/embed\/?$/)){let a=b.searchParams.get("url");if(a)return a}}},{hostnames:["google.*"],fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&b.searchParams.has("center")&&b.searchParams.get("zoom")){let a=b.searchParams.get("zoom"),[c,d]=b.searchParams.get("center").split(",");return`https://www.google.com/maps/@${c},${d},${a}z`}}},{hostnames:["val.town"],fromEmbedUrl:a=>{let b=dV(a),c=b&&b.pathname.match(/\/embed\/(.+)\/?/);if(c)return`https://www.val.town/v/${c[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:a=>{let b=dV(a),c=b&&b.pathname.match(/\/embed\/([^/]+)\/?/);if(c)return`https://codesandbox.io/s/${c[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:a=>{let b=a.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(b){let[a,c,d]=b;return`https://codepen.io/${c}/pen/${d}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:a=>{let b=a.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(b){let[a,c]=b;return`https://scratch.mit.edu/projects/${c}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:a=>{let b=dV(a);if(b&&"youtube.com"===b.hostname.replace(/^www./,"")){let a=b.pathname.match(/^\/embed\/([^/]+)\/?/);if(a)return`https://www.youtube.com/watch?v=${a[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:a=>{let b=dV(a),c=b?.searchParams.get("src");if(b?.pathname.match(/\/calendar\/embed/)&&c){for(let a of(b.pathname="/calendar/u/0",Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.searchParams.set("cid",c),b.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:a=>{let b=dV(a);if(b?.pathname.match(/^\/presentation/)&&b?.pathname.match(/\/embed\/?$/)){for(let a of(b.pathname=b.pathname.replace(/\/embed$/,"/pub"),Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!a.split("/").pop())return;return a}}},{hostnames:["replit.com"],fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/\/@([^/]+)\/([^/]+)/)&&b.searchParams.has("embed"))return b.searchParams.delete("embed"),b.href}},{hostnames:["felt.com"],fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/embed\/map\//))return b.pathname=b.pathname.replace(/^\/embed/,""),b.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/embed\/(artist|album)\//))return b.origin+b.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:a=>{let b=dV(a);if(b&&"player.vimeo.com"===b.hostname){let a=b.pathname.match(/^\/video\/([^/]+)\/?$/);if(a)return"https://vimeo.com/"+a[1]}}},{hostnames:["observablehq.com"],fromEmbedUrl:a=>{let b=dV(a);return b&&b.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${b.origin}${b.pathname.replace("/embed","")}#cell-*`:b&&b.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${b.origin}${b.pathname.replace("/embed","/d")}#cell-*`:void 0}},{hostnames:["desmos.com"],fromEmbedUrl:a=>{let b=dV(a);if(b&&"www.desmos.com"===b.hostname&&b.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===b.search&&""===b.hash)return a.replace("?embed","")}}],iJ={w:gP.nonZeroNumber,h:gP.nonZeroNumber,url:gP.string},iK=hg("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),iL={sequence:[{id:iK.GenOriginalUrlInEmbed,up:a=>{try{let b,c=a.url,d=new URL(c).host.replace("www.","");for(let a of iI)if(a.hostnames.includes(d))try{b=a.fromEmbedUrl(c)}catch(a){console.warn(a)}a.tmpOldUrl=a.url,a.url=b??""}catch{a.url="",a.tmpOldUrl=a.url}},down:"retired"},{id:iK.RemoveDoesResize,up:a=>{delete a.doesResize},down:"retired"},{id:iK.RemoveTmpOldUrl,up:a=>{delete a.tmpOldUrl},down:"retired"},{id:iK.RemovePermissionOverrides,up:a=>{delete a.overridePermissions},down:"retired"}]};var gP=gO;let iM={w:gP.nonZeroNumber,h:gP.nonZeroNumber,name:gP.string,color:gP.literalEnum(...hm.values)},iN={sequence:[{id:hg("frame",{AddColorProp:1}).AddColorProp,up:a=>{a.color="black"},down:a=>{delete a.color}}]};var gP=gO;let iO=g7.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),iP=g7.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),iQ=g7.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),iR={geo:iQ,dash:hq,url:gP.linkUrl,w:gP.nonZeroNumber,h:gP.nonZeroNumber,growY:gP.positiveNumber,scale:gP.nonZeroNumber,labelColor:hn,color:hm,fill:hr,size:hu,font:hs,align:iO,verticalAlign:iP,richText:g5},iS=hg("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9,AddRichText:10}),iT={sequence:[{id:iS.AddUrlProp,up:a=>{a.url=""},down:"retired"},{id:iS.AddLabelColor,up:a=>{a.labelColor="black"},down:"retired"},{id:iS.RemoveJustify,up:a=>{"justify"===a.align&&(a.align="start")},down:"retired"},{id:iS.AddCheckBox,up:a=>{},down:"retired"},{id:iS.AddVerticalAlign,up:a=>{a.verticalAlign="middle"},down:"retired"},{id:iS.MigrateLegacyAlign,up:a=>{let b;switch(a.align){case"start":b="start-legacy";break;case"end":b="end-legacy";break;default:b="middle-legacy"}a.align=b},down:"retired"},{id:iS.AddCloud,up:a=>{},down:"retired"},{id:iS.MakeUrlsValid,up:a=>{gP.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}},{id:iS.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}},{id:iS.AddRichText,up:a=>{a.richText=g6(a.text),delete a.text}}]},iU={},iV={sequence:[]};var gP=gO;let iW={color:hm,size:hu,segments:gP.arrayOf(iD),isComplete:gP.boolean,isPen:gP.boolean,scale:gP.nonZeroNumber},iX={sequence:[{id:hg("highlight",{AddScale:1}).AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}}]};var gP=gO;let iY=gP.object({topLeft:gT,bottomRight:gT,isCircle:gP.boolean.optional()}),iZ={w:gP.nonZeroNumber,h:gP.nonZeroNumber,playing:gP.boolean,url:gP.linkUrl,assetId:gR.nullable(),crop:iY.nullable(),flipX:gP.boolean,flipY:gP.boolean,altText:gP.string},i$=hg("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4,AddAltText:5}),i_={sequence:[{id:i$.AddUrlProp,up:a=>{a.url=""},down:"retired"},{id:i$.AddCropProp,up:a=>{a.crop=null},down:a=>{delete a.crop}},{id:i$.MakeUrlsValid,up:a=>{gP.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}},{id:i$.AddFlipProps,up:a=>{a.flipX=!1,a.flipY=!1},down:a=>{delete a.flipX,delete a.flipY}},{id:i$.AddAltText,up:a=>{a.altText=""},down:a=>{delete a.altText}}]};var gP=gO;let i0=g7.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),i1=gP.object({id:gP.string,index:gP.indexKey,x:gP.number,y:gP.number}),i2={color:hm,dash:hq,size:hu,spline:i0,points:gP.dict(gP.string,i1),scale:gP.nonZeroNumber},i3=hg("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),i4={sequence:[{id:i3.AddSnapHandles,up:a=>{for(let b of Object.values(a.handles))b.canSnap=!0},down:"retired"},{id:i3.RemoveExtraHandleProps,up:a=>{a.handles=c$(Object.values(a.handles).map(a=>[a.index,{x:a.x,y:a.y}]))},down:a=>{let b=Object.entries(a.handles).map(([a,b])=>({index:a,...b})).sort(dz);a.handles=Object.fromEntries(b.map((a,c)=>{let d=0===c?"start":c===b.length-1?"end":`handle:${a.index}`;return[d,{id:d,type:"vertex",canBind:!1,canSnap:!0,index:a.index,x:a.x,y:a.y}]}))}},{id:i3.HandlesToPoints,up:a=>{let b=Object.entries(a.handles).map(([a,{x:b,y:c}])=>({x:b,y:c,index:a})).sort(dz);a.points=b.map(({x:a,y:b})=>({x:a,y:b})),delete a.handles},down:a=>{let b=dy(a.points.length);a.handles=Object.fromEntries(a.points.map((a,c)=>[b[c],{x:a.x,y:a.y}])),delete a.points}},{id:i3.PointIndexIds,up:a=>{let b=dy(a.points.length);a.points=Object.fromEntries(a.points.map((a,c)=>{let d=b[c];return[d,{id:d,index:d,x:a.x,y:a.y}]}))},down:a=>{let b=Object.values(a.points).sort(dz);a.points=b.map(({x:a,y:b})=>({x:a,y:b}))}},{id:i3.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}}]};var gP=gO;let i5={color:hm,labelColor:hn,size:hu,font:hs,fontSizeAdjustment:gP.positiveNumber,align:iO,verticalAlign:iP,growY:gP.positiveNumber,url:gP.linkUrl,richText:g5,scale:gP.nonZeroNumber},i6=hg("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8,AddRichText:9}),i7={sequence:[{id:i6.AddUrlProp,up:a=>{a.url=""},down:"retired"},{id:i6.RemoveJustify,up:a=>{"justify"===a.align&&(a.align="start")},down:"retired"},{id:i6.MigrateLegacyAlign,up:a=>{switch(a.align){case"start":a.align="start-legacy";return;case"end":a.align="end-legacy";return;default:a.align="middle-legacy";return}},down:"retired"},{id:i6.AddVerticalAlign,up:a=>{a.verticalAlign="middle"},down:"retired"},{id:i6.MakeUrlsValid,up:a=>{gP.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}},{id:i6.AddFontSizeAdjustment,up:a=>{a.fontSizeAdjustment=0},down:a=>{delete a.fontSizeAdjustment}},{id:i6.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}},{id:i6.AddLabelColor,up:a=>{a.labelColor="black"},down:a=>{delete a.labelColor}},{id:i6.AddRichText,up:a=>{a.richText=g6(a.text),delete a.text}}]};var gP=gO;let i8=g7.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),i9={color:hm,size:hu,font:hs,textAlign:i8,w:gP.nonZeroNumber,richText:g5,scale:gP.nonZeroNumber,autoSize:gP.boolean},ja=hg("text",{RemoveJustify:1,AddTextAlign:2,AddRichText:3}),jb={sequence:[{id:ja.RemoveJustify,up:a=>{"justify"===a.align&&(a.align="start")},down:"retired"},{id:ja.AddTextAlign,up:a=>{a.textAlign=a.align,delete a.align},down:a=>{a.align=a.textAlign,delete a.textAlign}},{id:ja.AddRichText,up:a=>{a.richText=g6(a.text),delete a.text}}]};var gP=gO;let jc={w:gP.nonZeroNumber,h:gP.nonZeroNumber,time:gP.number,playing:gP.boolean,autoplay:gP.boolean,url:gP.linkUrl,assetId:gR.nullable(),altText:gP.string},jd=hg("video",{AddUrlProp:1,MakeUrlsValid:2,AddAltText:3,AddAutoplay:4}),je={sequence:[{id:jd.AddUrlProp,up:a=>{a.url=""},down:"retired"},{id:jd.MakeUrlsValid,up:a=>{gP.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}},{id:jd.AddAltText,up:a=>{a.altText=""},down:a=>{delete a.altText}},{id:jd.AddAutoplay,up:a=>{a.autoplay=!0},down:a=>{delete a.autoplay}}]},jf=fJ("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4,FixIndexKeys:5}),jg=fI({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:jf.RemoveCodeAndIconShapeTypes,scope:"store",up:a=>{for(let[b,c]of cY(a))"shape"===c.typeName&&("icon"===c.type||"code"===c.type)&&delete a[b]}},{id:jf.AddInstancePresenceType,scope:"store",up(a){}},{id:jf.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:a=>{for(let[b,c]of cY(a))c.typeName.match(/^(user|user_presence)$/)&&delete a[b]}},{id:jf.RemoveUserDocument,scope:"store",up:a=>{for(let[b,c]of cY(a))c.typeName.match("user_document")&&delete a[b]}},{id:jf.FixIndexKeys,scope:"record",up:a=>{if(["shape","page"].includes(a.typeName)&&"index"in a&&(a.index.endsWith("0")&&"a0"!==a.index&&(a.index=a.index.slice(0,-1)+jj(3)),"shape"===a.typeName&&"line"===a.type))for(let[b,c]of cY(a.props.points))c.index.endsWith("0")&&"a0"!==c.index&&(c.index=c.index.slice(0,-1)+jj(3))},down:()=>{}}]}),jh="123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",ji=()=>jh.charAt(Math.floor(Math.random()*jh.length)),jj=a=>Array.from({length:a},ji).join(""),jk={arrow:{migrations:hC,props:hz},bookmark:{migrations:iC,props:iA},draw:{migrations:iG,props:iE},embed:{migrations:iL,props:iJ},frame:{migrations:iN,props:iM},geo:{migrations:iT,props:iR},group:{migrations:iV,props:iU},highlight:{migrations:iX,props:iW},image:{migrations:i_,props:iZ},line:{migrations:i4,props:i2},note:{migrations:i7,props:i5},text:{migrations:jb,props:i9},video:{migrations:je,props:jc}},jl={arrow:{migrations:hG,props:hE}};function jm({shapes:a=jk,bindings:b=jl,migrations:c}={}){let d=new Map;for(let b of cX(a))for(let a of he(b.props??{}).keys()){if(d.has(a.id)&&d.get(a.id)!==a)throw Error(`Multiple StyleProp instances with the same id: ${a.id}`);d.set(a.id,a)}let e=fV("shape",{scope:"document",validator:gP.model("shape",gP.union("type",c0(a,(a,{props:b,meta:c})=>gY(a,b,c))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})),f=fV("binding",{scope:"document",validator:gP.model("binding",gP.union("type",c0(b,(a,{props:b,meta:c})=>g$(a,b,c))))}).withDefaultProperties(()=>({meta:{}})),g=function(a){let b={};for(let[c,d]of a)b[c]=gP.optional(d);return fV("instance",{validator:gP.model("instance",gP.object({typeName:gP.literal("instance"),id:gQ("instance"),currentPageId:hR,followingUserId:gP.string.nullable(),brush:gU.nullable(),opacityForNextShape:gV,stylesForNextShape:gP.object(b),cursor:hM,scribbles:gP.arrayOf(hQ),isFocusMode:gP.boolean,isDebugMode:gP.boolean,isToolLocked:gP.boolean,exportBackground:gP.boolean,screenBounds:gU,insets:gP.arrayOf(gP.boolean),zoomBrush:gU.nullable(),isPenMode:gP.boolean,isGridMode:gP.boolean,chatMessage:gP.string,isChatting:gP.boolean,highlightedUserIds:gP.arrayOf(gP.string),isFocused:gP.boolean,devicePixelRatio:gP.number,isCoarsePointer:gP.boolean,isHoveringCanvas:gP.boolean.nullable(),openMenus:gP.arrayOf(gP.string),isChangingStyle:gP.boolean,isReadonly:gP.boolean,meta:gP.jsonValue,duplicateProps:gP.object({shapeIds:gP.arrayOf(gQ("shape")),offset:gP.object({x:gP.number,y:gP.number})}).nullable()})),scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}(d);return f5.create({asset:iz,binding:f,camera:hJ,document:ii,instance:g,instance_page_state:h2,page:hU,instance_presence:ia,pointer:h5,shape:e},{migrations:[jg,iy,hI,ih,hZ,h1,hT,h9,h4,ha,iq,it,iw,...hh("shape",a),...hh("binding",b),...c??[]],onValidationFailure:il,createIntegrityChecker:im})}let jn=new Set(["vertex","virtual","create","clone"]),jo=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ms",label:"Bahasa Melayu"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"tl",label:"Filipino"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"nl",label:"Nederlands"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"sl",label:"Slovenščina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"el",label:"Ελληνικά"},{locale:"ru",label:"Русский"},{locale:"uk",label:"Українська"},{locale:"he",label:"עברית"},{locale:"ur",label:"اردو"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ne",label:"नेपाली"},{locale:"mr",label:"मराठी"},{locale:"hi-in",label:"हिन्दी"},{locale:"bn",label:"বাংলা"},{locale:"pa",label:"ਪੰਜਾਬੀ"},{locale:"gu-in",label:"ગુજરાતી"},{locale:"ta",label:"தமிழ்"},{locale:"te",label:"తెలుగు"},{locale:"kn",label:"ಕನ್ನಡ"},{locale:"ml",label:"മലയാളം"},{locale:"th",label:"ภาษาไทย"},{locale:"km-kh",label:"ភាសាខ្មែរ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function jp(){var a=["en"];for(let b of a){let a=function(a){let b=jo.find(b=>b.locale===a.toLowerCase());if(b)return b.locale;let[c,d]=a.split(/[-_]/).map(a=>a.toLowerCase());if(d){let a=jo.find(a=>a.locale===c);if(a)return a.locale}return c in jq?jq[c]:null}(b);if(a)return a}return"en"}let jq={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function jr(){return(0,bT.jsx)("div",{className:"tl-background"})}function js(a,b,c,d,e,f){(0,eQ.useLayoutEffect)(()=>{let g=a.current;if(!g||void 0===b)return;let h=`translate(${b}px, ${c}px)`;void 0!==d&&(h+=` scale(${d})`),void 0!==e&&(h+=` rotate(${e}rad)`),f&&(h+=` translate(${f.x}px, ${f.y}px)`),g.style.transform=h})}bV("@tldraw/tlschema","4.2.0","esm"),a.s([],31103);let jt=a=>a,ju=a=>a*a,jv=a=>a*(2-a),jw=a=>--a*a*a+1,jx=a=>a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1,jy=a=>1+--a*a*a*a*a,jz=a=>Math.sin(a*Math.PI/2);class jA{constructor(a=0,b=0,c=1){this.x=a,this.y=b,this.z=c}get pressure(){return this.z}set(a=this.x,b=this.y,c=this.z){return this.x=a,this.y=b,this.z=c,this}setTo({x:a=0,y:b=0,z:c=1}){return this.x=a,this.y=b,this.z=c,this}rot(a){if(0===a)return this;let{x:b,y:c}=this,d=Math.sin(a),e=Math.cos(a);return this.x=b*e-c*d,this.y=b*d+c*e,this}rotWith(a,b){if(0===b)return this;let c=this.x-a.x,d=this.y-a.y,e=Math.sin(b),f=Math.cos(b);return this.x=a.x+(c*f-d*e),this.y=a.y+(c*e+d*f),this}clone(){let{x:a,y:b,z:c}=this;return new jA(a,b,c)}sub(a){return this.x-=a.x,this.y-=a.y,this}subXY(a,b){return this.x-=a,this.y-=b,this}subScalar(a){return this.x-=a,this.y-=a,this}add(a){return this.x+=a.x,this.y+=a.y,this}addXY(a,b){return this.x+=a,this.y+=b,this}addScalar(a){return this.x+=a,this.y+=a,this}clamp(a,b){return this.x=Math.max(this.x,a),this.y=Math.max(this.y,a),void 0!==b&&(this.x=Math.min(this.x,b),this.y=Math.min(this.y,b)),this}div(a){return this.x/=a,this.y/=a,this}divV(a){return this.x/=a.x,this.y/=a.y,this}mul(a){return this.x*=a,this.y*=a,this}mulV(a){return this.x*=a.x,this.y*=a.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(a,b){let c=jA.Tan(a,this);return this.add(c.mul(b))}neg(){return this.x*=-1,this.y*=-1,this}cross(a){return this.x=this.y*a.z-this.z*a.y,this.y=this.z*a.x-this.x*a.z,this}dpr(a){return jA.Dpr(this,a)}cpr(a){return jA.Cpr(this,a)}len2(){return jA.Len2(this)}len(){return jA.Len(this)}pry(a){return jA.Pry(this,a)}per(){let{x:a,y:b}=this;return this.x=b,this.y=-a,this}uni(){let a=this.len();return 0===a||(this.x/=a,this.y/=a),this}tan(a){return this.sub(a).uni()}dist(a){return jA.Dist(this,a)}distanceToLineSegment(a,b){return jA.DistanceToLineSegment(a,b,this)}slope(a){return jA.Slope(this,a)}snapToGrid(a){return this.x=Math.round(this.x/a)*a,this.y=Math.round(this.y/a)*a,this}angle(a){return jA.Angle(this,a)}toAngle(){return jA.ToAngle(this)}lrp(a,b){return this.x=this.x+(a.x-this.x)*b,this.y=this.y+(a.y-this.y)*b,this}equals(a){return jA.Equals(this,a)}equalsXY(a,b){return jA.EqualsXY(this,a,b)}toFixed(){return this.x=jY(this.x),this.y=jY(this.y),this}toString(){return jA.ToString(jA.ToFixed(this))}toJson(){return jA.ToJson(this)}toArray(){return jA.ToArray(this)}static Add(a,b){return new jA(a.x+b.x,a.y+b.y)}static AddXY(a,b,c){return new jA(a.x+b,a.y+c)}static Sub(a,b){return new jA(a.x-b.x,a.y-b.y)}static SubXY(a,b,c){return new jA(a.x-b,a.y-c)}static AddScalar(a,b){return new jA(a.x+b,a.y+b)}static SubScalar(a,b){return new jA(a.x-b,a.y-b)}static Div(a,b){return new jA(a.x/b,a.y/b)}static Mul(a,b){return new jA(a.x*b,a.y*b)}static DivV(a,b){return new jA(a.x/b.x,a.y/b.y)}static MulV(a,b){return new jA(a.x*b.x,a.y*b.y)}static Neg(a){return new jA(-a.x,-a.y)}static Per(a){return new jA(a.y,-a.x)}static Abs(a){return new jA(Math.abs(a.x),Math.abs(a.y))}static Dist(a,b){return((a.y-b.y)**2+(a.x-b.x)**2)**.5}static ManhattanDist(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)}static DistMin(a,b,c){return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)<c**2}static Dist2(a,b){return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)}static Dpr(a,b){return a.x*b.x+a.y*b.y}static Cross(a,b){return new jA(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z)}static Cpr(a,b){return a.x*b.y-b.x*a.y}static Len2(a){return a.x*a.x+a.y*a.y}static Len(a){return(a.x*a.x+a.y*a.y)**.5}static Pry(a,b){return jA.Dpr(a,b)/jA.Len(b)}static Uni(a){let b=jA.Len(a);return new jA(0===b?0:a.x/b,0===b?0:a.y/b)}static Tan(a,b){return jA.Uni(jA.Sub(a,b))}static Min(a,b){return new jA(Math.min(a.x,b.x),Math.min(a.y,b.y))}static Max(a,b){return new jA(Math.max(a.x,b.x),Math.max(a.y,b.y))}static From({x:a,y:b,z:c=1}){return new jA(a,b,c)}static FromArray(a){return new jA(a[0],a[1])}static Rot(a,b=0){let c=Math.sin(b),d=Math.cos(b);return new jA(a.x*d-a.y*c,a.x*c+a.y*d)}static RotWith(a,b,c){let d=a.x-b.x,e=a.y-b.y,f=Math.sin(c),g=Math.cos(c);return new jA(b.x+(d*g-e*f),b.y+(d*f+e*g))}static NearestPointOnLineThroughPoint(a,b,c){return jA.Mul(b,jA.Sub(c,a).pry(b)).add(a)}static NearestPointOnLineSegment(a,b,c,d=!0){if(jA.Equals(a,c)||jA.Equals(b,c))return jA.From(c);let e=jA.Tan(b,a),f=jA.Add(a,jA.Mul(e,jA.Sub(c,a).pry(e)));if(d){if(f.x<Math.min(a.x,b.x))return jA.Cast(a.x<b.x?a:b);if(f.x>Math.max(a.x,b.x))return jA.Cast(a.x>b.x?a:b);if(f.y<Math.min(a.y,b.y))return jA.Cast(a.y<b.y?a:b);if(f.y>Math.max(a.y,b.y))return jA.Cast(a.y>b.y?a:b)}return f}static DistanceToLineThroughPoint(a,b,c){return jA.Dist(c,jA.NearestPointOnLineThroughPoint(a,b,c))}static DistanceToLineSegment(a,b,c,d=!0){return jA.Dist(c,jA.NearestPointOnLineSegment(a,b,c,d))}static Snap(a,b=1){return new jA(Math.round(a.x/b)*b,Math.round(a.y/b)*b)}static Cast(a){return a instanceof jA?a:jA.From(a)}static Slope(a,b){return a.x===b.y?NaN:(a.y-b.y)/(a.x-b.x)}static IsNaN(a){return isNaN(a.x)||isNaN(a.y)}static Angle(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}static AngleBetween(a,b){let c=a.x*b.x+a.y*b.y,d=Math.sqrt((Math.pow(a.x,2)+Math.pow(a.y,2))*(Math.pow(b.x,2)+Math.pow(b.y,2)));return(a.x*b.y-a.y*b.x<0?-1:1)*Math.acos(jI(c/d,-1,1))}static Lrp(a,b,c){return jA.Sub(b,a).mul(c).add(a)}static Med(a,b){return new jA((a.x+b.x)/2,(a.y+b.y)/2)}static Equals(a,b){return 1e-4>Math.abs(a.x-b.x)&&1e-4>Math.abs(a.y-b.y)}static EqualsXY(a,b,c){return a.x===b&&a.y===c}static Clockwise(a,b,c){return(c.x-a.x)*(b.y-a.y)-(b.x-a.x)*(c.y-a.y)<0}static Rescale(a,b){let c=jA.Len(a);return new jA(b*a.x/c,b*a.y/c)}static ScaleWithOrigin(a,b,c){return jA.Sub(a,c).mul(b).add(c)}static ToFixed(a){return new jA(jY(a.x),jY(a.y))}static ToInt(a){return new jA(parseInt(a.x.toFixed(0)),parseInt(a.y.toFixed(0)),parseInt((a.z??0).toFixed(0)))}static ToCss(a){return`${a.x},${a.y}`}static Nudge(a,b,c){return jA.Add(a,jA.Tan(b,a).mul(c))}static ToString(a){return`${a.x}, ${a.y}`}static ToAngle(a){let b=Math.atan2(a.y,a.x);return b<0&&(b+=2*Math.PI),b}static FromAngle(a,b=1){return new jA(Math.cos(a)*b,Math.sin(a)*b)}static ToArray(a){return[a.x,a.y,a.z]}static ToJson(a){let{x:b,y:c,z:d}=a;return{x:b,y:c,z:d}}static Average(a){let b=a.length,c=new jA(0,0);if(0===b)return c;for(let d=0;d<b;d++)c.add(a[d]);return c.div(b)}static Clamp(a,b,c){return void 0===c?new jA(Math.min(Math.max(a.x,b)),Math.min(Math.max(a.y,b))):new jA(Math.min(Math.max(a.x,b),c),Math.min(Math.max(a.y,b),c))}static PointsBetween(a,b,c=6){let d=[];for(let e=0;e<c;e++){let f=ju(e/(c-1)),g=jA.Lrp(a,b,f);g.z=Math.min(1,.5+.65*Math.abs(.5-jB(f))),d.push(g)}return d}static SnapToGrid(a,b=8){return new jA(Math.round(a.x/b)*b,Math.round(a.y/b)*b)}}let jB=a=>a<.5?2*a*a:-1+(4-2*a)*a;function jC(a){return`${jX(a.x)},${jX(a.y)} `}function jD(a,b){return`${jX((a.x+b.x)/2)},${jX((a.y+b.y)/2)} `}let jE=Math.PI,jF=jE/2,jG=2*jE,jH=Math.sin;function jI(a,b,c){return Math.max(b,void 0!==c?Math.min(a,c):a)}function jJ(a,b=1e10){return a?Math.round(a*b)/b:0}function jK(a,b,c=1e-6){return Math.abs(a-b)<=c}function jL(a,b,c=1e-6){return a<b||jK(a,b,c)}function jM(a){return(a%=jG)<0?a+=jG:0===a&&(a=0),a}function jN(a,b){return(a=jM(a))>(b=jM(b))&&(b+=jG),b-a}function jO(a,b){return jG-jN(a,b)}function jP(a,b){let c=(b-a)%jG;return 2*c%jG-c}function jQ(a,b){let c=jG/b,d=Math.floor(((jG+a)%jG+c/2)/c)*c%jG;return d<jE&&(d+=jG),d>jE&&(d-=jG),d}function jR(a,b){return a===b||jK(a%(Math.PI/2)-b%(Math.PI/2),0)}function jS(a,b,c){return new jA(a.x,a.y).add(jA.FromAngle(c,b))}function jT(a,b,c){let d=a/2,e=b/2,f=[],g=1/0,h=-1/0,i=1/0,j=-1/0;for(let a=0;a<c;a++){let b=-jF+jG/c*a,k=d+d*Math.cos(b),l=e+e*Math.sin(b);k<g&&(g=k),l<i&&(i=l),k>h&&(h=k),l>j&&(j=l),f.push(new jA(k,l))}let k=h-g,l=j-i;if(0!=a-k||0!=b-l)for(let c=0;c<f.length;c++){let d=f[c];d.x=(d.x-g)/k*a,d.y=(d.y-i)/l*b}return f}function jU(a,b,c,d){let e=Math.max(a,c),f=Math.min(b,d);return e<=f?[e,f]:null}function jV(a,b,c){return(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y)}function jW(a,b){let c,d,e=0;for(let f=0;f<b.length;f++){if((c=b[f]).x===a.x&&c.y===a.y||(d=b[(f+1)%b.length],jA.Dist(a,c)+jA.Dist(a,d)===jA.Dist(c,d)))return!0;c.y<=a.y?d.y>a.y&&jV(c,d,a)>0&&(e+=1):d.y<=a.y&&0>jV(c,d,a)&&(e-=1)}return 0!==e}function jX(a){return Math.round(1e4*a)/1e4}function jY(a){return Math.round(100*a)/100}let jZ=a=>Math.abs(a)<Number.MAX_SAFE_INTEGER;function j$(a,b,c,d){let e;if(Math.abs(a)>jE){e=jP(b,d);let f=jP(d,c);return Math.abs(e)<Math.abs(f)?e/a:(a-f)/a}{let c=(e=jP(b,d))/a;return Math.sign(e)!==Math.sign(a)?+(Math.abs(c)>.5):c}}function j_(a,b,c){let d=-2*(a.x*(b.y-c.y)-a.y*(b.x-c.x)+b.x*c.y-c.x*b.y),e=((a.x*a.x+a.y*a.y)*(c.y-b.y)+(b.x*b.x+b.y*b.y)*(a.y-c.y)+(c.x*c.x+c.y*c.y)*(b.y-a.y))/d,f=((a.x*a.x+a.y*a.y)*(b.x-c.x)+(b.x*b.x+b.y*b.y)*(c.x-a.x)+(c.x*c.x+c.y*c.y)*(a.x-b.x))/d;return Number.isFinite(e)&&Number.isFinite(f)?new jA(e,f):null}let j0=({brush:a,color:b,opacity:c,className:d})=>{let e=(0,eQ.useRef)(null);js(e,a.x,a.y);let f=jX(Math.max(1,a.w)),g=jX(Math.max(1,a.h));return(0,bT.jsx)("svg",{className:"tl-overlays__item",ref:e,"aria-hidden":"true",children:b?(0,bT.jsxs)("g",{className:"tl-brush",opacity:c,children:[(0,bT.jsx)("rect",{width:f,height:g,fill:b,opacity:.75}),(0,bT.jsx)("rect",{width:f,height:g,fill:"none",stroke:b,opacity:.1})]}):(0,bT.jsx)("rect",{className:`tl-brush tl-brush__default ${d}`,width:f,height:g})})};var j1=a.i(28525);let j2={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.05,.1,.25,.5,1,2,4,8]},j3={duration:0,easing:jx},j4=["top","right","bottom","left"],j5={},j6=j8("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),j7={logPreventDefaults:j8("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:j8("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:j8("logElementRemoves",{defaults:{all:!1}}),debugSvg:j8("debugSvg",{defaults:{all:!1}}),showFps:j8("showFps",{defaults:{all:!1}}),measurePerformance:j8("measurePerformance",{defaults:{all:!1}}),throwToBlob:j8("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:j8("reconnectOnPing",{defaults:{all:!1}}),debugCursors:j8("debugCursors",{defaults:{all:!1}}),forceSrgb:j8("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:j8("debugGeometry",{defaults:{all:!1}}),hideShapes:j8("hideShapes",{defaults:{all:!1}}),editOnType:j8("editOnType",{defaults:{all:!1}}),a11y:j8("a11y",{defaults:{all:!1}}),debugElbowArrows:j8("debugElbowArrows",{defaults:{all:!1}})};if("undefined"!=typeof Element){let a=Element.prototype.removeChild;eg("element removal logging",()=>{j7.logElementRemoves.get()?Element.prototype.removeChild=function(b){return console.warn("[tldraw] removing child:",b),a.call(this,b)}:Element.prototype.removeChild=a})}function j8(a,{defaults:b,shouldStoreForSession:c=!0}){var d;let e,f,g;return e=function(a){switch(j9(()=>process.env.TLDRAW_ENV)??j9(()=>process.env.VERCEL_PUBLIC_TLDRAW_ENV)??j9(()=>process.env.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return a.defaults.production??a.defaults.all;case"preview":case"staging":return a.defaults.staging??a.defaults.all;default:return a.defaults.development??a.defaults.all}}(d={name:a,defaults:b,shouldStoreForSession:c}),f=d.shouldStoreForSession?function(a){try{return JSON.parse(dH(`tldraw_debug:${a}`)??"null")}catch{return null}}(d.name):null,Object.assign(g=eM(`debug:${d.name}`,f??e),d,{reset:()=>g.set(e)})}function j9(a){try{return a()}catch{return null}}function ka(a){if(a.nodeType===Node.ELEMENT_NODE)return a;if(a.parentElement)return ka(a.parentElement);throw Error("Could not find a parent element of an HTML type!")}function kb(a){a.preventDefault(),j7.logPreventDefaults.get()&&console.warn("preventDefault called on event:",a)}function kc(a,b){if(a.setPointerCapture(b.pointerId),j7.logPointerCaptures.get()){let c=j6.get();c.set(a,(c.get(a)??0)+1),console.warn("setPointerCapture called on element:",a,b)}}function kd(a,b){if(a.hasPointerCapture(b.pointerId)&&(a.releasePointerCapture(b.pointerId),j7.logPointerCaptures.get())){let c=j6.get();1===c.get(a)?c.delete(a):c.has(a)?c.set(a,c.get(a)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",a,b)}}let ke=(a,b,c)=>{a&&a.style.setProperty(b,c)};function kf(a=!1){let{activeElement:b}=document;return!!(b&&(b.isContentEditable||(a?["input","textarea"]:["input","select","button","textarea"]).indexOf(b.tagName.toLowerCase())>-1||b.classList.contains("tlui-slider__thumb")))}let kg=a=>a.ctrlKey||a.metaKey;function kh(a,b){return a.markEventAsHandled(b),{point:{x:b.clientX,y:b.clientY,z:b.pressure},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:kg(b),pointerId:b.pointerId,button:b.button,isPen:"pen"===b.pointerType}}function ki(a,b){return kl(`${a}_${b}`)}function kj(a){return kl(`${(0,eQ.useId)()}${a??""}`)}function kk(a){let b=ch((0,eQ.useContext)(km));return kl(`${b}_${a}`)}function kl(a){return a.replace(/:/g,"_")}let km=(0,eQ.createContext)(null);function kn({children:a}){let b=kj();return(0,bT.jsx)(km.Provider,{value:b,children:a})}let ko=(0,eQ.createContext)(null);function kp(){let a=eQ.default.useContext(ko);if(!a)throw Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return a}function kq(){return eQ.default.useContext(ko)}function kr({editor:a,children:b}){return(0,bT.jsx)(ko.Provider,{value:a,children:(0,bT.jsx)(kn,{children:b})})}function ks(){let a=kp(),b=e$("current tool",()=>a.getCurrentTool(),[a]),c=(0,eQ.useMemo)(function(){return{onPointerDown:function(b){a.wasEventAlreadyHandled(b)||(2===b.button?a.dispatch({type:"pointer",target:"canvas",name:"right_click",...kh(a,b)}):(0===b.button||1===b.button||5===b.button)&&(kc(b.currentTarget,b),a.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...kh(a,b)})))},onPointerUp:function(b){a.wasEventAlreadyHandled(b)||(0===b.button||1===b.button||2===b.button||5===b.button)&&(kd(b.currentTarget,b),a.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...kh(a,b)}))},onPointerEnter:function(b){if(a.wasEventAlreadyHandled(b)||a.getInstanceState().isPenMode&&"pen"!==b.pointerType)return;let c="mouse"===b.pointerType||"pen"===b.pointerType;a.updateInstanceState({isHoveringCanvas:!!c||null})},onPointerLeave:function(b){if(a.wasEventAlreadyHandled(b)||a.getInstanceState().isPenMode&&"pen"!==b.pointerType)return;let c="mouse"===b.pointerType||"pen"===b.pointerType;a.updateInstanceState({isHoveringCanvas:!c&&null})},onDragOver:function(b){a.wasEventAlreadyHandled(b)||kb(b)},onDrop:async function b(b){if(a.wasEventAlreadyHandled(b))return;if(kb(b),b.stopPropagation(),b.dataTransfer?.files?.length){let c=Array.from(b.dataTransfer.files);await a.putExternalContent({type:"files",files:c,point:a.screenToPage({x:b.clientX,y:b.clientY})});return}let c=b.dataTransfer.getData("url");if(c)return void await a.putExternalContent({type:"url",url:c,point:a.screenToPage({x:b.clientX,y:b.clientY})})},onTouchStart:function(b){a.wasEventAlreadyHandled(b)||(a.markEventAsHandled(b),kb(b))},onTouchEnd:function(b){if(a.wasEventAlreadyHandled(b)||(a.markEventAsHandled(b),!(b.target instanceof HTMLElement)))return;let c=a.getEditingShape()?.id;c&&b.target.closest(`[data-shape-id="${c}"]`)||"A"===b.target.tagName||"TEXTAREA"===b.target.tagName||b.target.isContentEditable||kb(b)},onClick:function(b){a.wasEventAlreadyHandled(b)||b.stopPropagation()}}},[a]);return(0,eQ.useEffect)(()=>{let c,d;function e(e){if(!a.wasEventAlreadyHandled(e)){if(a.markEventAsHandled(e),e.clientX!==c||e.clientY!==d)for(let f of(c=e.clientX,d=e.clientY,(0,b.useCoalescedEvents&&e.getCoalescedEvents)?e.getCoalescedEvents():[e]))a.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...kh(a,f)})}}return document.body.addEventListener("pointermove",e),()=>{document.body.removeEventListener("pointermove",e)}},[a,b]),c}let kt=(0,eQ.createContext)(null);function ku({container:a,children:b}){return(0,bT.jsx)(kt.Provider,{value:a,children:b})}function kv(){return ch((0,eQ.useContext)(kt),"useContainer used outside of <Tldraw />")}function kw(a){return a.menus.hasOpenMenus()||kf()}function kx({className:a,zoom:b,point:c,color:d,viewport:e,opacity:f=1}){let g=(0,eQ.useRef)(null);js(g,jI(c.x,e.minX+5/b,e.maxX-5/b),jI(c.y,e.minY+5/b,e.maxY-5/b),1/b,jA.Angle(e.center,c));let h=kk("cursor_hint");return(0,bT.jsxs)("svg",{ref:g,className:(0,j1.default)("tl-overlays__item",a),"aria-hidden":"true",children:[(0,bT.jsx)("use",{href:`#${h}`,color:d,strokeWidth:3,stroke:"var(--tl-color-background)"}),(0,bT.jsx)("use",{href:`#${h}`,color:d,opacity:f})]})}let ky=(0,eQ.memo)(function({className:a,zoom:b,point:c,color:d,name:e,chatMessage:f}){let g=(0,eQ.useRef)(null);js(g,c?.x,c?.y,1/b);let h=kk("cursor");return c?(0,bT.jsxs)("div",{ref:g,className:(0,j1.default)("tl-overlays__item",a),children:[(0,bT.jsx)("svg",{className:"tl-cursor","aria-hidden":"true",children:(0,bT.jsx)("use",{href:`#${h}`,color:d})}),f?(0,bT.jsxs)(bT.Fragment,{children:[e&&(0,bT.jsx)("div",{className:"tl-nametag-title",style:{color:d},children:e}),(0,bT.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:d},children:f})]}):e&&(0,bT.jsx)("div",{className:"tl-nametag",style:{backgroundColor:d},children:e})]}):null}),kz={openWindow:(a,b,c=!1)=>window.open(a,b,c?"noopener":"noopener noreferrer"),refreshPage(){window.location.reload()},hardReset:async()=>await window.__tldraw__hardReset?.()};function kA(){kz.hardReset()}var kB=eQ;let kC={error:null};class kD extends kB.Component{static getDerivedStateFromError(a){return{error:a}}state=kC;componentDidCatch(a){this.props.onError?.(a)}render(){let{error:a}=this.state;if(null!==a){let{fallback:b}=this.props;return(0,bT.jsx)(b,{error:a})}return this.props.children}}function kE({children:a,fallback:b,...c}){return null===b?a:(0,bT.jsx)(kD,{fallback:b,...c,children:a})}let kF=({error:a,editor:b})=>{let c=(0,eQ.useRef)(null),[d,e]=(0,eQ.useState)(!1),[f,g]=(0,eQ.useState)(!1),[h,i]=(0,eQ.useState)(!1),j=null;try{j=re().Canvas??null}catch{}let k=a instanceof Error?a.message:String(a),l=a instanceof Error?a.stack:null,m=e$("isDarkMode",()=>{try{if(b)return b.user.getIsDarkMode()}catch{}return null},[b]),[n,o]=(0,eQ.useState)(null);(0,eQ.useLayoutEffect)(()=>{null!==m&&o(m);let a=c.current?.parentElement,b=!1;for(;a;){if(a.classList.contains("tl-theme__dark")||a.classList.contains("tl-theme__light")){b=!0;break}a=a.parentElement}if(b)return void o(null)},[m]),(0,eQ.useEffect)(()=>{if(f){let a=b?.timers.setTimeout(()=>{g(!1)},2e3);return()=>clearTimeout(a)}},[f,b]);let p=async()=>{kA()},q=new URL("https://github.com/tldraw/tldraw/issues/new");return q.searchParams.set("title",k),q.searchParams.set("labels","bug"),q.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${l??k}
\`\`\`

My browser: ${navigator.userAgent}`),(0,bT.jsxs)("div",{ref:c,className:(0,j1.default)("tl-container tl-error-boundary",null===n?"":n?"tl-theme__dark":"tl-theme__light"),children:[(0,bT.jsx)("div",{className:"tl-error-boundary__overlay"}),b&&(0,bT.jsx)(kD,{onError:cd,fallback:()=>null,children:(0,bT.jsx)(kr,{editor:b,children:(0,bT.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:j?(0,bT.jsx)(j,{}):null})})}),(0,bT.jsx)("div",{className:(0,j1.default)("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":d&&!h}),children:h?(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("h2",{children:"Are you sure?"}),(0,bT.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,bT.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,bT.jsx)("button",{className:"tlui-button",onClick:()=>i(!1),children:"Cancel"}),(0,bT.jsx)("button",{className:"tlui-button tl-error-boundary__reset",onClick:p,children:"Reset data"})]})]}):(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("h2",{children:"Something went wrong"}),(0,bT.jsx)("p",{children:"Please refresh your browser."}),(0,bT.jsx)("p",{children:"If the issue continues after refreshing, you may need to reset the tldraw data stored on your device."}),(0,bT.jsxs)("p",{children:[(0,bT.jsx)("strong",{children:"Note:"})," Resetting will erase your current project and any unsaved work."]}),!1,d&&(0,bT.jsxs)(bT.Fragment,{children:["Message:",(0,bT.jsx)("h4",{children:(0,bT.jsx)("code",{children:k})}),"Stack trace:",(0,bT.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,bT.jsx)("pre",{children:(0,bT.jsx)("code",{children:l??k})}),(0,bT.jsx)("button",{className:"tlui-button",onClick:()=>{let a=document.createElement("textarea");a.value=l??k,document.body.appendChild(a),a.select(),document.execCommand("copy"),a.remove(),g(!0)},children:f?"Copied!":"Copy"})]})]}),(0,bT.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,bT.jsx)("button",{className:"tlui-button",onClick:()=>e(!d),children:d?"Hide details":"Show details"}),(0,bT.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,bT.jsx)("button",{className:"tlui-button tl-error-boundary__reset",onClick:()=>i(!0),children:"Reset data"}),(0,bT.jsx)("button",{className:"tlui-button tl-error-boundary__refresh",onClick:()=>{kz.refreshPage()},children:"Refresh Page"})]})]})]})})]})};function kG({x:a,y:b,z:c,size:d}){let e=kj("grid"),{gridSteps:f}=kp().options;return(0,bT.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,bT.jsx)("defs",{children:f.map(({min:f,mid:g,step:h},i)=>{let j=h*d*c,k=.5+a*c,l=.5+b*c,m=k>0?k%j:j+k%j,n=l>0?l%j:j+l%j,o=c<g?cT(c,[f,g],[0,1]):1;return(0,bT.jsx)("pattern",{id:ki(e,`${h}`),width:j,height:j,patternUnits:"userSpaceOnUse",children:(0,bT.jsx)("circle",{className:"tl-grid-dot",cx:m,cy:n,r:1,opacity:o})},i)})}),f.map(({step:a},b)=>(0,bT.jsx)("rect",{width:"100%",height:"100%",fill:`url(#${e}_${a})`},b))]})}function kH({handle:a,isCoarse:b,className:c,zoom:d}){let e=kp(),f=(b?e.options.coarseHandleRadius:e.options.handleRadius)/d;if("clone"===a.type){let b=3/d,e=`M0,${-b} A${b},${b} 0 0,1 0,${b}`,g=j4.indexOf(a.id);return(0,bT.jsxs)("g",{className:(0,j1.default)(`tl-handle tl-handle__${a.type}`,c),children:[(0,bT.jsx)("circle",{className:"tl-handle__bg",r:f}),(0,bT.jsx)("path",{className:"tl-handle__fg",d:e,transform:`rotate(${-90+90*g})`})]})}let g=("create"===a.type&&b?3:4)/Math.max(d,.25);return(0,bT.jsxs)("g",{className:(0,j1.default)(`tl-handle tl-handle__${a.type}`,c),children:[(0,bT.jsx)("circle",{className:"tl-handle__bg",r:f}),(0,bT.jsx)("circle",{className:"tl-handle__fg",r:g})]})}let kI=({children:a})=>(0,bT.jsx)("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:a}),kJ="4.2.0";function kK(a,b){let c=(0,eQ.useRef)(a);return b(a,c.current)?c.current:(c.current=a,a)}let kL=(a,b)=>(a??=null)===(b??=null)||!!a&&!!b&&ca(a,b),kM=(a,b)=>(a??=null)===(b??=null)||!!a&&!!b&&c1(a,b);var gP=gO;let kN="TLDRAW_USER_DATA_v3",kO=gP.object({id:gP.string,name:gP.string.nullable().optional(),color:gP.string.nullable().optional(),locale:gP.string.nullable().optional(),animationSpeed:gP.number.nullable().optional(),areKeyboardShortcutsEnabled:gP.boolean.nullable().optional(),edgeScrollSpeed:gP.number.nullable().optional(),colorScheme:gP.literalEnum("light","dark","system").optional(),isSnapMode:gP.boolean.nullable().optional(),isWrapMode:gP.boolean.nullable().optional(),isDynamicSizeMode:gP.boolean.nullable().optional(),isPasteAtCursorMode:gP.boolean.nullable().optional(),enhancedA11yMode:gP.boolean.nullable().optional(),inputMode:gP.literalEnum("trackpad","mouse").nullable().optional()}),kP={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8,AddKeyboardShortcuts:9,AddShowUiLabels:10,AddPointerPeripheral:11,RenameShowUiLabelsToEnhancedA11yMode:12},kQ=Math.max(...Object.values(kP)),kR=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function kS(){return kR[Math.floor(Math.random()*kR.length)]}let kT=Object.freeze({name:"",locale:jp(),color:kS(),edgeScrollSpeed:1,animationSpeed:1,areKeyboardShortcutsEnabled:!0,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,enhancedA11yMode:!1,colorScheme:"light",inputMode:null});function kU(){return{id:cA(void 0),color:kS()}}function kV(a){if(null===a||"object"!=typeof a||!("version"in a)||!("user"in a)||"number"!=typeof a.version)return kU();let b=d$(a);b.version<kP.AddAnimationSpeed&&(b.user.animationSpeed=1),b.version<kP.AddIsSnapMode&&(b.user.isSnapMode=!1),b.version,kP.MakeFieldsNullable,b.version<kP.AddEdgeScrollSpeed&&(b.user.edgeScrollSpeed=1),b.version<kP.AddExcalidrawSelectMode&&(b.user.isWrapMode=!1),b.version<kP.AllowSystemColorScheme&&(!0===b.user.isDarkMode?b.user.colorScheme="dark":!1===b.user.isDarkMode&&(b.user.colorScheme="light"),delete b.user.isDarkMode),b.version<kP.AddDynamicSizeMode&&(b.user.isDynamicSizeMode=!1),b.version<kP.AddPasteAtCursor&&(b.user.isPasteAtCursorMode=!1),b.version<kP.AddKeyboardShortcuts&&(b.user.areKeyboardShortcutsEnabled=!0),b.version<kP.AddShowUiLabels&&(b.user.showUiLabels=!1),b.version<kP.RenameShowUiLabelsToEnhancedA11yMode&&(b.user.enhancedA11yMode=b.user.showUiLabels,delete b.user.showUiLabels),b.version<kP.AddPointerPeripheral&&(b.user.inputMode=null),b.version=kQ;try{return kO.validate(b.user)}catch{return kU()}}let kW=eM("globalUserData",null);function kX(a){kO.validate(a),kW.set(a),dE(kN,JSON.stringify({version:kQ,user:kW.get()})),kZ?.postMessage({type:k0,origin:k_(),data:{user:k1(),version:kQ}})}let kY="undefined"!=typeof process&&!1,kZ="undefined"==typeof BroadcastChannel||kY?null:new BroadcastChannel("tldraw-user-sync");kZ?.addEventListener("message",a=>{let b=a.data;b?.type===k0&&b?.origin!==k_()&&kW.set(kV(b.data))});let k$=null;function k_(){return null===k$&&(k$=cA(void 0)),k$}let k0="tldraw-user-preferences-change";function k1(){let a=kW.get();return a||kX(a=kV(JSON.parse(dD(kN)||"null")??null)),a}let k2=eB("defaultLocalStorageUserPrefs",()=>k1());function k3(a={}){return{userPreferences:a.userPreferences??k2,setUserPreferences:a.setUserPreferences??kX}}var k4=a.i(53686),fX=b_,gP=gO;let k5="TLDRAW_TAB_ID_v2",k6=globalThis.window,k7=k6?k6[k5]??dH(k5)??"TLDRAW_INSTANCE_STATE_V1_"+cA(void 0):"<error>";k6&&(k6[k5]=k7,k6&&["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(k6.navigator.platform)?dI(k5,k7):dJ(k5)),k6?.addEventListener("beforeunload",()=>{dI(k5,k7)});let k8={Initial:0},k9=Math.max(...Object.values(k8)),la=gP.object({version:gP.number,currentPageId:hR.optional(),isFocusMode:gP.boolean.optional(),exportBackground:gP.boolean.optional(),isDebugMode:gP.boolean.optional(),isToolLocked:gP.boolean.optional(),isGridMode:gP.boolean.optional(),pageStates:gP.arrayOf(gP.object({pageId:hR,camera:gP.object({x:gP.number,y:gP.number,z:gP.number}).optional(),selectedShapeIds:gP.arrayOf(gX).optional(),focusedGroupId:gX.nullable().optional()})).optional()});function lb(a){let b=a.query.ids("page");return eB("sessionStateSnapshot",()=>{let c=a.get(h$);if(!c)return null;let d=[...b.get()];return{version:k9,currentPageId:c.currentPageId,exportBackground:c.exportBackground,isFocusMode:c.isFocusMode,isDebugMode:c.isDebugMode,isToolLocked:c.isToolLocked,isGridMode:c.isGridMode,pageStates:d.map(b=>{let c=a.get(h2.createId(b)),d=a.get(hJ.createId(b));return{pageId:b,camera:{x:d?.x??0,y:d?.y??0,z:d?.z??1},selectedShapeIds:c?.selectedShapeIds??[],focusedGroupId:c?.focusedGroupId??null}})}},{isEqual:fX.default})}function lc(a,b,c){let d=function(a){if(!a||"object"!=typeof a)return console.warn("Invalid instance state"),null;if(!("version"in a)||"number"!=typeof a.version)return console.warn("No version in instance state"),null;if(a.version!==k9){var b;(b=a=d$(a)).version,k8.Initial,b.version=k9}try{return la.validate(a)}catch(a){return console.warn(a),null}}(b);if(!d)return;let e=hX(a.get(h$)),f=c?.forceOverwrite?d:e,g=c?.forceOverwrite?e:d,h=a.schema.types.instance.create({id:h$,...e,currentPageId:d.currentPageId,isDebugMode:f?.isDebugMode??g?.isDebugMode,isFocusMode:f?.isFocusMode??g?.isFocusMode,isToolLocked:f?.isToolLocked??g?.isToolLocked,isGridMode:f?.isGridMode??g?.isGridMode,exportBackground:f?.exportBackground??g?.exportBackground});a.atomic(()=>{for(let b of d.pageStates??[]){if(!a.has(b.pageId))continue;let c=hJ.createId(b.pageId),d=h2.createId(b.pageId),e=a.get(c),f=a.get(d);a.put([hJ.create({id:c,x:b.camera?.x??e?.x,y:b.camera?.y??e?.y,z:b.camera?.z??e?.z}),h2.create({id:d,pageId:b.pageId,selectedShapeIds:b.selectedShapeIds??f?.selectedShapeIds,focusedGroupId:b.focusedGroupId??f?.focusedGroupId})])}a.put([h]),a.ensureStoreIsUsable()})}function ld(a,b,c){let d={};if("store"in b){let c=a.schema.migrateStoreSnapshot(b);if("success"!==c.type)throw Error("Failed to migrate store snapshot: "+c.reason);d.document={schema:a.schema.serialize(),store:c_(c.value,(b,{typeName:c})=>a.scopedTypes.document.has(c))}}else d=b;let e=hX(a.get(h$)),f=le.get(a,lb).get();a.atomic(()=>{d.document&&a.loadStoreSnapshot(d.document),e&&a.update(h$,a=>({...a,...e})),f&&lc(a,f),d.session&&lc(a,d.session,{forceOverwrite:c?.forceOverwriteSessionState})})}let le=new cl;function lf(a){let b=[],c=new Set;for(let d of a){if(c.has(d.type))throw Error(`Binding type "${d.type}" is defined more than once`);b.push(d),c.add(d.type)}return b}function lg({children:a,className:b="",...c}){return(0,bT.jsx)("svg",{...c,className:(0,j1.default)("tl-svg-container",b),"aria-hidden":"true",children:a})}class lh{constructor(a=0,b=0,c=0,d=0){this.x=a,this.y=b,this.w=c,this.h=d}x=0;y=0;w=0;h=0;get point(){return new jA(this.x,this.y)}set point(a){this.x=a.x,this.y=a.y}get minX(){return this.x}set minX(a){this.x=a}get left(){return this.x}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get right(){return this.x+this.w}get minY(){return this.y}set minY(a){this.y=a}get top(){return this.y}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get bottom(){return this.y+this.h}get width(){return this.w}set width(a){this.w=a}get height(){return this.h}set height(a){this.h=a}get aspectRatio(){return this.width/this.height}get center(){return new jA(this.x+this.w/2,this.y+this.h/2)}set center(a){this.x=a.x-this.w/2,this.y=a.y-this.h/2}get corners(){return[new jA(this.x,this.y),new jA(this.x+this.w,this.y),new jA(this.x+this.w,this.y+this.h),new jA(this.x,this.y+this.h)]}get cornersAndCenter(){return[new jA(this.x,this.y),new jA(this.x+this.w,this.y),new jA(this.x+this.w,this.y+this.h),new jA(this.x,this.y+this.h),new jA(this.x+this.w/2,this.y+this.h/2)]}get sides(){let{corners:a}=this;return[[a[0],a[1]],[a[1],a[2]],[a[2],a[3]],[a[3],a[0]]]}get size(){return new jA(this.w,this.h)}toFixed(){return this.x=jJ(this.x),this.y=jJ(this.y),this.w=jJ(this.w),this.h=jJ(this.h),this}setTo(a){return this.x=a.x,this.y=a.y,this.w=a.w,this.h=a.h,this}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.w=c,this.h=d,this}expand(a){let b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.w,a.x+a.w),e=Math.max(this.y+this.h,a.y+a.h);return this.x=b,this.y=c,this.w=d-b,this.h=e-c,this}expandBy(a){return this.x-=a,this.y-=a,this.w+=2*a,this.h+=2*a,this}scale(a){return this.x/=a,this.y/=a,this.w/=a,this.h/=a,this}clone(){let{x:a,y:b,w:c,h:d}=this;return new lh(a,b,c,d)}translate(a){return this.x+=a.x,this.y+=a.y,this}snapToGrid(a){let b=Math.round(this.x/a)*a,c=Math.round(this.y/a)*a,d=Math.round((this.x+this.w)/a)*a,e=Math.round((this.y+this.h)/a)*a;this.minX=b,this.minY=c,this.width=Math.max(1,d-b),this.height=Math.max(1,e-c)}collides(a){return lh.Collides(this,a)}contains(a){return lh.Contains(this,a)}includes(a){return lh.Includes(this,a)}containsPoint(a,b=0){return lh.ContainsPoint(this,a,b)}getHandlePoint(a){switch(a){case"top_left":return new jA(this.x,this.y);case"top_right":return new jA(this.x+this.w,this.y);case"bottom_left":return new jA(this.x,this.y+this.h);case"bottom_right":return new jA(this.x+this.w,this.y+this.h);case"top":return new jA(this.x+this.w/2,this.y);case"right":return new jA(this.x+this.w,this.y+this.h/2);case"bottom":return new jA(this.x+this.w/2,this.y+this.h);case"left":return new jA(this.x,this.y+this.h/2)}}toJson(){return{x:this.x,y:this.y,w:this.w,h:this.h}}resize(a,b,c){let{minX:d,minY:e,maxX:f,maxY:g}=this,{minX:h,minY:i,maxX:j,maxY:k}=this;switch(a){case"left":case"top_left":case"bottom_left":h+=b;break;case"right":case"top_right":case"bottom_right":j+=b}switch(a){case"top":case"top_left":case"top_right":i+=c;break;case"bottom":case"bottom_left":case"bottom_right":k+=c}let l=(k-i)/(g-e);if((j-h)/(f-d)<0){let a=j;j=h,h=a}if(l<0){let a=k;k=i,i=a}this.minX=h,this.minY=i,this.width=Math.abs(j-h),this.height=Math.abs(k-i)}union(a){let b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.w,a.x+a.w),e=Math.max(this.y+this.h,a.y+a.h);return this.x=b,this.y=c,this.width=d-b,this.height=e-c,this}static From(a){return new lh(a.x,a.y,a.w,a.h)}static FromCenter(a,b){return new lh(a.x-b.x/2,a.y-b.y/2,b.x,b.y)}static FromPoints(a){let b;if(0===a.length)return new lh;let c=1/0,d=1/0,e=-1/0,f=-1/0;for(let g=0,h=a.length;g<h;g++)c=Math.min((b=a[g]).x,c),d=Math.min(b.y,d),e=Math.max(b.x,e),f=Math.max(b.y,f);return new lh(c,d,e-c,f-d)}static Expand(a,b){let c=Math.min(b.minX,a.minX),d=Math.min(b.minY,a.minY);return new lh(c,d,Math.max(b.maxX,a.maxX)-c,Math.max(b.maxY,a.maxY)-d)}static ExpandBy(a,b){return new lh(a.minX-b,a.minY-b,a.width+2*b,a.height+2*b)}static Collides(a,b){return!(a.maxX<b.minX||a.minX>b.maxX||a.maxY<b.minY||a.minY>b.maxY)}static Contains(a,b){return a.minX<b.minX&&a.minY<b.minY&&a.maxY>b.maxY&&a.maxX>b.maxX}static ContainsApproximately(a,b,c){return jL(a.minX,b.minX,c)&&jL(a.minY,b.minY,c)&&jL(b.maxX,a.maxX,c)&&jL(b.maxY,a.maxY,c)}static Includes(a,b){return lh.Collides(a,b)||lh.Contains(a,b)}static ContainsPoint(a,b,c=0){return!(b.x<a.minX-c||b.y<a.minY-c||b.x>a.maxX+c||b.y>a.maxY+c)}static Common(a){let b=1/0,c=1/0,d=-1/0,e=-1/0;for(let f=0;f<a.length;f++){let g=a[f];b=Math.min(b,g.minX),c=Math.min(c,g.minY),d=Math.max(d,g.maxX),e=Math.max(e,g.maxY)}return new lh(b,c,d-b,e-c)}static Sides(a,b=0){let{corners:c}=a;return[[c[0],c[1]],[c[1],c[2]],[c[2],c[3]],[c[3],c[0]]]}static Resize(a,b,c,d,e=!1){let{minX:f,minY:g,maxX:h,maxY:i}=a,{minX:j,minY:k,maxX:l,maxY:m}=a;switch(b){case"left":case"top_left":case"bottom_left":j+=c;break;case"right":case"top_right":case"bottom_right":l+=c}switch(b){case"top":case"top_left":case"top_right":k+=d;break;case"bottom":case"bottom_left":case"bottom_right":m+=d}let n=(l-j)/(h-f),o=(m-k)/(i-g);if(e){let a=(h-f)/(i-g),c=Math.abs(l-j),d=Math.abs(m-k),e=c*(o<0?1:-1)*(1/a),p=d*(n<0?1:-1)*a,q=a<c/d;switch(b){case"top_left":q?k=m+e:j=l+p;break;case"top_right":q?k=m+e:l=j-p;break;case"bottom_right":q?m=k-e:l=j-p;break;case"bottom_left":q?m=k-e:j=l+p;break;case"bottom":case"top":{let b=(j+l)/2,c=d*a;j=b-c/2,l=b+c/2;break}case"left":case"right":{let b=(k+m)/2,d=c/a;k=b-d/2,m=b+d/2}}}if(n<0){let a=l;l=j,j=a}if(o<0){let a=m;m=k,k=a}let p=new lh(j,k,Math.abs(l-j),Math.abs(m-k));return{box:p,scaleX:+(p.width/a.width*(n>0?1:-1)).toFixed(5),scaleY:+(p.height/a.height*(o>0?1:-1)).toFixed(5)}}equals(a){return lh.Equals(this,a)}static Equals(a,b){return b.x===a.x&&b.y===a.y&&b.w===a.w&&b.h===a.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(a){return new lh(a.x,a.y,Math.max(1,a.w),Math.max(1,a.h))}}class li{constructor(a,b,c,d,e,f){this.a=a,this.b=b,this.c=c,this.d=d,this.e=e,this.f=f}a=1;b=0;c=0;d=1;e=0;f=0;equals(a){return this===a||this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d&&this.e===a.e&&this.f===a.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(a){let{a:b,b:c,c:d,d:e,e:f,f:g}=this;return this.a=b*a.a+d*a.b,this.c=b*a.c+d*a.d,this.e=b*a.e+d*a.f+f,this.b=c*a.a+e*a.b,this.d=c*a.c+e*a.d,this.f=c*a.e+e*a.f+g,this}rotate(a,b,c){return 0===a?this:void 0===b?this.multiply(li.Rotate(a)):this.translate(b,c).multiply(li.Rotate(a)).translate(-b,-c)}translate(a,b){return this.multiply(li.Translate(a,b))}scale(a,b){return this.multiply(li.Scale(a,b))}invert(){let{a,b,c,d,e,f}=this,g=a*d-b*c;return this.a=d/g,this.b=-(b/g),this.c=-(c/g),this.d=a/g,this.e=-((d*e-c*f)/g),this.f=(b*e-a*f)/g,this}applyToPoint(a){return li.applyToPoint(this,a)}applyToPoints(a){return li.applyToPoints(this,a)}rotation(){return li.Rotation(this)}point(){return li.Point(this)}decomposed(){return li.Decompose(this)}toCssString(){return li.toCssString(this)}setTo(a){return Object.assign(this,a),this}decompose(){return li.Decompose(this)}clone(){return new li(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new li(1,0,0,1,0,0)}static Translate(a,b){return new li(1,0,0,1,a,b)}static Rotate(a,b,c){if(0===a)return li.Identity();let d=Math.cos(a),e=Math.sin(a),f=new li(d,e,-e,d,0,0);return void 0===b?f:li.Compose(li.Translate(b,c),f,li.Translate(-b,-c))}static Scale(a,b,c,d){let e=new li(a,0,0,b,0,0);return void 0===c?e:li.Translate(c,d).multiply(e).translate(-c,-d)}static Multiply(a,b){return{a:a.a*b.a+a.c*b.b,c:a.a*b.c+a.c*b.d,e:a.a*b.e+a.c*b.f+a.e,b:a.b*b.a+a.d*b.b,d:a.b*b.c+a.d*b.d,f:a.b*b.e+a.d*b.f+a.f}}static Inverse(a){let b=a.a*a.d-a.b*a.c;return{a:a.d/b,b:-(a.b/b),c:-(a.c/b),d:a.a/b,e:-((a.d*a.e-a.c*a.f)/b),f:(a.b*a.e-a.a*a.f)/b}}static Absolute(a){let b=a.a*a.d-a.b*a.c;return{a:a.d/b,b:-(a.b/b),c:-(a.c/b),d:a.a/b,e:(a.d*a.e-a.c*a.f)/b,f:-((a.b*a.e-a.a*a.f)/b)}}static Compose(...a){let b=li.Identity();for(let c=0,d=a.length;c<d;c++)b.multiply(a[c]);return b}static Point(a){return new jA(a.e,a.f)}static Rotation(a){let b;if(0!==a.a||0!==a.c){let c=(a.a*a.a+a.c*a.c)**.5;b=Math.acos(a.a/c)*(a.c>0?-1:1)}else if(0!==a.b||0!==a.d){let c=(a.b*a.b+a.d*a.d)**.5;b=jF+Math.acos(a.b/c)*(a.d>0?-1:1)}else b=0;return(jG+b)%jG}static Decompose(a){let b,c,d;if(0!==a.a||0!==a.c){let e=(a.a*a.a+a.c*a.c)**.5;b=e,c=(a.a*a.d-a.b*a.c)/e,d=Math.acos(a.a/e)*(a.c>0?-1:1)}else if(0!==a.b||0!==a.d){let e=(a.b*a.b+a.d*a.d)**.5;b=(a.a*a.d-a.b*a.c)/e,c=e,d=jF+Math.acos(a.b/e)*(a.d>0?-1:1)}else b=0,c=0,d=0;return{x:a.e,y:a.f,scaleX:b,scaleY:c,rotation:(jG+d)%jG}}static Smooth(a,b=1e10){return a.a=Math.round(a.a*b)/b,a.b=Math.round(a.b*b)/b,a.c=Math.round(a.c*b)/b,a.d=Math.round(a.d*b)/b,a.e=Math.round(a.e*b)/b,a.f=Math.round(a.f*b)/b,a}static toCssString(a){return`matrix(${jX(a.a)}, ${jX(a.b)}, ${jX(a.c)}, ${jX(a.d)}, ${jX(a.e)}, ${jX(a.f)})`}static applyToPoint(a,b){return new jA(a.a*b.x+a.c*b.y+a.e,a.b*b.x+a.d*b.y+a.f,b.z)}static applyToXY(a,b,c){return[a.a*b+a.c*c+a.e,a.b*b+a.d*c+a.f]}static applyToPoints(a,b){return b.map(b=>new jA(a.a*b.x+a.c*b.y+a.e,a.b*b.x+a.d*b.y+a.f,b.z))}static applyToBounds(a,b){return new lh(a.e+b.minX,a.f+b.minY,b.width,b.height)}static From(a){return new li(a.a,a.b,a.c,a.d,a.e,a.f)}static Cast(a){return a instanceof li?a:li.From(a)}}function lj(a,b,c,d,e=1e-10){let f=a.x-c.x,g=a.y-c.y,h=d.x-c.x,i=d.y-c.y,j=b.x-a.x,k=b.y-a.y,l=h*g-i*f,m=j*g-k*f,n=i*j-h*k;if(jK(l,0,e)||jK(m,0,e)||jK(n,0,e))return null;if(0!==n){let b=l/n,c=m/n;if(jL(0,b,e)&&jL(b,1,e)&&jL(0,c,e)&&jL(c,1,e))return jA.AddXY(a,b*j,b*k)}return null}function lk(a,b,c,d){let e=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y),f=2*((b.x-a.x)*(a.x-c.x)+(b.y-a.y)*(a.y-c.y)),g=f*f-4*e*(c.x*c.x+c.y*c.y+a.x*a.x+a.y*a.y-2*(c.x*a.x+c.y*a.y)-d*d);if(g<0||0===g)return null;let h=Math.sqrt(g),i=(-f+h)/(2*e),j=(-f-h)/(2*e);if((i<0||i>1)&&(j<0||j>1))return null;let k=[];return(0<=i&&i<=1&&k.push(jA.Lrp(a,b,i)),0<=j&&j<=1&&k.push(jA.Lrp(a,b,j)),0===k.length)?null:k}function ll(a,b,c){let d,e=[];for(let f=1,g=c.length;f<g+1;f++)(d=lj(a,b,c[f-1],c[f%c.length]))&&e.push(d);return 0===e.length?null:e}function lm(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)}function ln(a,b,c,d){return lm(a,c,d)!==lm(b,c,d)&&lm(a,b,c)!==lm(a,b,d)}function lo(a,b){var c;let d,e,f,g=new Map;for(let c=0,d=a.length;c<d;c++)if(jW(e=a[c],b)){let a=lq(e);g.has(a)||g.set(a,e)}for(let c=0,d=b.length;c<d;c++)if(jW(e=b[c],a)){let a=lq(e);g.has(a)||g.set(a,e)}for(let c=0,d=a.length;c<d;c++){e=a[c],f=a[(c+1)%a.length];for(let a=0,c=b.length;a<c;a++){let c=lj(e,f,b[a],b[(a+1)%b.length]);if(null!==c){let a=lq(c);g.has(a)||g.set(a,c)}}}return 0===g.size?null:(c=[...g.values()],d=jA.Average(c),c.sort((a,b)=>jA.Angle(d,a)-jA.Angle(d,b)))}function lp(a,b,c,d){let e=new Map;for(let f=0,g=c?a.length:a.length-1;f<g;f++){let c=a[f],g=a[(f+1)%a.length];for(let a=0,f=d?b.length:b.length-1;a<f;a++){let d=lj(c,g,b[a],b[(a+1)%b.length]);if(null!==d){let a=lq(d);e.has(a)||e.set(a,d)}}}return[...e.values()]}function lq(a){return`${a.x},${a.y}`}function lr(a,b){let c,d;for(let e=0,f=a.length;e<f;e++){c=a[e],d=a[(e+1)%f];for(let a=0,e=b.length;a<e;a++)if(ln(c,d,b[a],b[(a+1)%e]))return!0}return!1}let ls={includeLabels:!1,includeInternal:!1},lt={includeLabels:!1,includeInternal:!0};class lu{isFilled=!1;isClosed=!0;isLabel=!1;isEmptyLabel=!1;isInternal=!1;excludeFromShapeBounds=!1;debugColor;ignore;constructor(a){const{isLabel:b=!1,isEmptyLabel:c=!1,isInternal:d=!1,excludeFromShapeBounds:e=!1}=a;this.isFilled=a.isFilled,this.isClosed=a.isClosed,this.debugColor=a.debugColor,this.ignore=a.ignore,this.isLabel=b,this.isEmptyLabel=c,this.isInternal=d,this.excludeFromShapeBounds=e}isExcludedByFilter(a){return!!a&&(!!this.isLabel&&!a.includeLabels||!!this.isInternal&&!a.includeInternal)}hitTestPoint(a,b=0,c=!1,d){return!!(this.isClosed&&(this.isFilled||c)&&jW(a,this.vertices))||jA.Dist2(a,this.nearestPoint(a))<=b*b}distanceToPoint(a,b=!1,c){return jA.Dist(a,this.nearestPoint(a,c))*(this.isClosed&&(this.isFilled||b)&&jW(a,this.vertices)?-1:1)}distanceToLineSegment(a,b,c){let d,e,f,g;if(jA.Equals(a,b))return this.distanceToPoint(a,!1,c);let{vertices:h}=this;if(0===h.length)throw Error("nearest point not found");if(1===h.length)return jA.Dist(a,h[0]);let i=1/0,j=this.isClosed?h.length:h.length-1;for(let c=0;c<h.length;c++){if(f=h[c],c<j&&ln(a,b,f,h[(c+1)%h.length]))return 0;g=jA.NearestPointOnLineSegment(a,b,f,!0),(e=jA.Dist2(f,g))<i&&(i=e,d=g)}if(!d)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&jW(d,this.vertices)?-i:i}hitTestLineSegment(a,b,c=0,d){return this.distanceToLineSegment(a,b,d)<=c}intersectLineSegment(a,b,c){return(this.isClosed?ll(a,b,this.vertices):function(a,b,c){let d,e=[];for(let f=0,g=c.length-1;f<g;f++)(d=lj(a,b,c[f],c[f+1]))&&e.push(d);return 0===e.length?null:e}(a,b,this.vertices))??[]}intersectCircle(a,b,c){return(this.isClosed?function(a,b,c){let d,e=[];for(let f=0,g=c.length;f<g;f++)(d=lk(c[f],c[(f+1)%c.length],a,b))&&e.push(...d);return 0===e.length?null:e}(a,b,this.vertices):function(a,b,c){let d,e=[];for(let f=1,g=c.length;f<g;f++)(d=lk(c[f-1],c[f],a,b))&&e.push(...d);return 0===e.length?null:e}(a,b,this.vertices))??[]}intersectPolygon(a,b){return lp(a,this.vertices,!0,this.isClosed)}intersectPolyline(a,b){return lp(a,this.vertices,!1,this.isClosed)}interpolateAlongEdge(a,b){let{vertices:c}=this;if(0===c.length)return new jA(0,0);if(1===c.length||a<=0)return c[0];let d=a*this.length,e=0;for(let a=0;a<(this.isClosed?c.length:c.length-1);a++){let b=c[a],g=c[(a+1)%c.length],h=e+jA.Dist(b,g);if(h>=d){var f;return jA.Lrp(b,g,(d-(f=e))/(h-f))}e=h}return this.isClosed?c[0]:c[c.length-1]}uninterpolateAlongEdge(a,b){let{vertices:c,length:d}=this,e=null,f=1/0,g=0;if(0===c.length||1===c.length)return 0;for(let b=0;b<(this.isClosed?c.length:c.length-1);b++){let d=c[b],h=c[(b+1)%c.length],i=jA.NearestPointOnLineSegment(d,h,a,!0),j=jA.Dist(i,a);j<f&&(f=j,e={start:d,end:h,nearestPoint:i,distanceToStart:g}),g+=jA.Dist(d,h)}return cg(e),(e.distanceToStart+jA.Dist(e.start,e.nearestPoint))/d}isPointInBounds(a,b=0){let{bounds:c}=this;return!(a.x<c.minX-b||a.y<c.minY-b||a.x>c.maxX+b||a.y>c.maxY+b)}overlapsPolygon(a){let b=a.map(a=>jA.From(a)),{vertices:c,center:d,isFilled:e,isEmptyLabel:f,isClosed:g}=this;if(f)return!1;if(c.some(a=>jW(a,b)))return!0;if(g){if(e&&(jW(d,b)||b.every(a=>jW(a,c)))||lr(b,c))return!0}else if(function(a,b){let c,d;for(let e=0,f=a.length;e<f;e++){c=a[e],d=a[(e+1)%f];for(let a=1,e=b.length;a<e;a++)if(ln(c,d,b[a-1],b[a]))return!0}return!1}(b,c))return!0;return!1}transform(a,b){return new lv(this,a,b)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices(lt)),this._vertices}getBoundsVertices(){return this.excludeFromShapeBounds?[]:this.vertices}_boundsVertices;get boundsVertices(){return this._boundsVertices||(this._boundsVertices=this.getBoundsVertices()),this._boundsVertices}getBounds(){return lh.FromPoints(this.boundsVertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;let{vertices:a}=this,b=0;for(let c=0,d=a.length;c<d;c++){let e=a[c],f=a[(c+1)%d];b+=e.x*f.y-f.x*e.y}return b/2}toSimpleSvgPath(){let a="",{vertices:b}=this,c=b.length;if(0===c)return a;a+=`M${b[0].x},${b[0].y}`;for(let d=1;d<c;d++)a+=`L${b[d].x},${b[d].y}`;return this.isClosed&&(a+="Z"),a}_length;get length(){return this._length||(this._length=this.getLength(lt)),this._length}getLength(a){let b=this.getVertices(a??lt);if(0===b.length)return 0;let c=b[0],d=0;for(let a=1;a<b.length;a++){let e=b[a];d+=jA.Dist(c,e),c=e}return this.isClosed&&(d+=jA.Dist(b[b.length-1],b[0])),d}}class lv extends lu{constructor(a,b,c){super(a),this.geometry=a,this.matrix=b,this.inverse=li.Inverse(b),this.decomposed=li.Decompose(b),c&&(null!=c.isLabel&&(this.isLabel=c.isLabel),null!=c.isInternal&&(this.isInternal=c.isInternal),null!=c.debugColor&&(this.debugColor=c.debugColor),null!=c.ignore&&(this.ignore=c.ignore)),cg(jK(this.decomposed.scaleX,this.decomposed.scaleY),"non-uniform scaling is not yet supported")}inverse;decomposed;getVertices(a){return this.geometry.getVertices(a).map(a=>li.applyToPoint(this.matrix,a))}getBoundsVertices(){return this.geometry.getBoundsVertices().map(a=>li.applyToPoint(this.matrix,a))}nearestPoint(a,b){return li.applyToPoint(this.matrix,this.geometry.nearestPoint(li.applyToPoint(this.inverse,a),b))}hitTestPoint(a,b=0,c,d){return this.geometry.hitTestPoint(li.applyToPoint(this.inverse,a),b/this.decomposed.scaleX,c,d)}distanceToPoint(a,b=!1,c){return this.geometry.distanceToPoint(li.applyToPoint(this.inverse,a),b,c)*this.decomposed.scaleX}distanceToLineSegment(a,b,c){return this.geometry.distanceToLineSegment(li.applyToPoint(this.inverse,a),li.applyToPoint(this.inverse,b),c)*this.decomposed.scaleX}hitTestLineSegment(a,b,c=0,d){return this.geometry.hitTestLineSegment(li.applyToPoint(this.inverse,a),li.applyToPoint(this.inverse,b),c/this.decomposed.scaleX,d)}intersectLineSegment(a,b,c){return li.applyToPoints(this.matrix,this.geometry.intersectLineSegment(li.applyToPoint(this.inverse,a),li.applyToPoint(this.inverse,b),c))}intersectCircle(a,b,c){return li.applyToPoints(this.matrix,this.geometry.intersectCircle(li.applyToPoint(this.inverse,a),b/this.decomposed.scaleX,c))}intersectPolygon(a,b){return li.applyToPoints(this.matrix,this.geometry.intersectPolygon(li.applyToPoints(this.inverse,a),b))}intersectPolyline(a,b){return li.applyToPoints(this.matrix,this.geometry.intersectPolyline(li.applyToPoints(this.inverse,a),b))}transform(a,b){return new lv(this.geometry,li.Multiply(a,this.matrix),{isLabel:b?.isLabel??this.isLabel,isInternal:b?.isInternal??this.isInternal,debugColor:b?.debugColor??this.debugColor,ignore:b?.ignore??this.ignore})}getSvgPathData(){throw Error("Cannot get SVG path data for transformed geometry.")}}class lw extends lu{children=[];ignoredChildren=[];constructor(a){super({...a,isClosed:!0,isFilled:!1});const b=a=>{for(let c of a)c instanceof lw?b(c.children):c.ignore?this.ignoredChildren.push(c):this.children.push(c)};if(b(a.children),0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(a){return this.isExcludedByFilter(a)?[]:this.children.filter(b=>!b.isExcludedByFilter(a)).flatMap(b=>b.getVertices(a))}nearestPoint(a,b){let c,d,e,f=1/0,{children:g}=this;if(0===g.length)throw Error("no children");for(let h of g)!h.isExcludedByFilter(b)&&(d=h.nearestPoint(a,b),(e=jA.Dist2(d,a))<f&&(f=e,c=d));if(!c)throw Error("nearest point not found");return c}distanceToPoint(a,b=!1,c){let d=1/0;for(let e of this.children){if(e.isExcludedByFilter(c))continue;let f=e.distanceToPoint(a,b,c);f<d&&(d=f)}return d}hitTestPoint(a,b,c,d=lt){return!!this.children.filter(a=>!a.isExcludedByFilter(d)).find(d=>d.hitTestPoint(a,b,c))}hitTestLineSegment(a,b,c,d=lt){return!!this.children.filter(a=>!a.isExcludedByFilter(d)).find(d=>d.hitTestLineSegment(a,b,c))}intersectLineSegment(a,b,c){return this.children.flatMap(d=>d.isExcludedByFilter(c)?ea:d.intersectLineSegment(a,b,c))}intersectCircle(a,b,c){return this.children.flatMap(d=>d.isExcludedByFilter(c)?ea:d.intersectCircle(a,b,c))}getBoundsVertices(){return this.excludeFromShapeBounds?[]:this.children.flatMap(a=>a.getBoundsVertices())}intersectPolygon(a,b){return this.children.flatMap(c=>c.isExcludedByFilter(b)?ea:c.intersectPolygon(a,b))}intersectPolyline(a,b){return this.children.flatMap(c=>c.isExcludedByFilter(b)?ea:c.intersectPolyline(a,b))}interpolateAlongEdge(a,b){let c=a*this.getLength(b),d=0;for(let a of this.children){if(a.isExcludedByFilter(b))continue;let f=d+a.length;if(f>=c){var e;return a.interpolateAlongEdge((c-(e=d))/(f-e),b)}d=f}return this.children[this.children.length-1].interpolateAlongEdge(1,b)}uninterpolateAlongEdge(a,b){var c;let d=this.getLength(b),e=null,f=1/0,g=0;for(let c of this.children){if(c.isExcludedByFilter(b))continue;let d=g+c.getLength(b),h=c.distanceToPoint(a,!1,b);h<f&&(f=h,e={startLength:g,endLength:d,child:c}),g=d}cg(e);let h=e.child.uninterpolateAlongEdge(a,b);return c=e.startLength,(c+(e.endLength-c)*h)/d}transform(a){return new lw({children:this.children.map(b=>b.transform(a)),isLabel:this.isLabel,debugColor:this.debugColor,ignore:this.ignore})}getArea(){return this.children[0].area}toSimpleSvgPath(){let a="";for(let b of this.children)a+=b.toSimpleSvgPath();let b=lh.FromPoints(this.boundsVertices).corners;for(let c=0,d=b.length;c<d;c++){let e=b[c],f=b[(c-1+d)%d],g=e.dist(f),h=b[(c+1)%d],i=e.dist(h),j=e.clone().lrp(f,4/g),k=e.clone().lrp(h,4/i);a+=`M${j.x},${j.y} L${e.x},${e.y} L${k.x},${k.y} `}return a}getLength(a){let b=0;for(let c of this.children)c.isExcludedByFilter(a)||(b+=c.length);return b}getSvgPathData(){return this.children.map((a,b)=>a.isLabel?"":a.getSvgPathData(0===b)).join(" ")}overlapsPolygon(a){return this.children.some(b=>b.overlapsPolygon(a))}}class lx extends lu{_start;_end;_d;_u;_ul;constructor(a){super({...a,isClosed:!1,isFilled:!1});const{start:b,end:c}=a;this._start=b,this._end=c,this._d=b.clone().sub(c),this._u=this._d.clone().uni(),this._ul=this._u.len()}getLength(){return this._d.len()}getVertices(){return[this._start,this._end]}nearestPoint(a){let{_start:b,_end:c,_d:d,_u:e,_ul:f}=this;if(0===d.len()||0===f)return b;let g=jA.Sub(a,b).dpr(e)/f,h=b.x+e.x*g;if(h<Math.min(b.x,c.x))return b.x<c.x?b:c;if(h>Math.max(b.x,c.x))return b.x>c.x?b:c;let i=b.y+e.y*g;return i<Math.min(b.y,c.y)?b.y<c.y?b:c:i>Math.max(b.y,c.y)?b.y>c.y?b:c:new jA(h,i)}getSvgPathData(a=!0){let{_start:b,_end:c}=this;return`${a?`M${b.toFixed()}`:""} L${c.toFixed()}`}}class ly extends lu{_points;_segments;constructor(a){super({isClosed:!1,isFilled:!1,...a});const{points:b}=a;if(this._points=b,b.length<2)throw Error("Polyline2d: points must be an array of at least 2 points")}get segments(){if(!this._segments){this._segments=[];let{vertices:a}=this;for(let b=0,c=a.length-1;b<c;b++){let c=a[b],d=a[b+1];this._segments.push(new lx({start:c,end:d}))}this.isClosed&&this._segments.push(new lx({start:a[a.length-1],end:a[0]}))}return this._segments}getLength(){return this.segments.reduce((a,b)=>a+b.length,0)}getVertices(){return this._points}nearestPoint(a){let b,c,{segments:d}=this,e=this._points[0],f=1/0;for(let g=0;g<d.length;g++)b=d[g].nearestPoint(a),(c=jA.Dist2(b,a))<f&&(e=b,f=c);if(!e)throw Error("nearest point not found");return e}hitTestLineSegment(a,b,c=0){let{segments:d}=this;for(let e=0,f=d.length;e<f;e++)if(d[e].hitTestLineSegment(a,b,c))return!0;return!1}getSvgPathData(){let{vertices:a}=this;return a.length<2?"":a.reduce((a,b,c)=>0===c?`M ${b.x} ${b.y}`:`${a} L ${b.x} ${b.y}`,"")}}class lz extends ly{constructor(a){if(super({...a}),this.isClosed=!0,a.points.length<3)throw Error("Polygon2d: points must be an array of at least 3 points")}}class lA extends lz{_x;_y;_w;_h;constructor(a){const{x:b=0,y:c=0,width:d,height:e}=a;super({...a,points:[new jA(b,c),new jA(b+d,c),new jA(b+d,c+e),new jA(b,c+e)]}),this._x=b,this._y=c,this._w=d,this._h=e}getBounds(){return new lh(this._x,this._y,this._w,this._h)}getSvgPathData(){let{_x:a,_y:b,_w:c,_h:d}=this;return this.negativeZeroFix(),`M${a},${b} h${c} v${d} h${-c}z`}negativeZeroFix(){this._x=lB(this._x),this._y=lB(this._y),this._w=lB(this._w),this._h=lB(this._h)}}function lB(a){return Object.is(a,-0)?0:a}class lC{constructor(a){this.editor=a}static configure(a){return class extends this{options={...this.options,...a}}}options={};static props;static migrations;static type;getFontFaces(a){return ea}canSnap(a){return!0}canTabTo(a){return!0}canScroll(a){return!1}canBind(a){return!0}canEdit(a){return!1}canResize(a){return!0}canResizeChildren(a){return!0}canEditInReadonly(a){return!1}canCrop(a){return!1}canBeLaidOut(a,b){return!0}canCull(a){return!0}providesBackgroundForChildren(a){return!1}hideResizeHandles(a){return!1}hideRotateHandle(a){return!1}hideSelectionBoundsBg(a){return!1}hideSelectionBoundsFg(a){return!1}isAspectRatioLocked(a){return!1}isExportBoundsContainer(a){return!1}canReceiveNewChildrenOfType(a,b){return!1}expandSelectionOutlinePx(a){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(a){return{}}getHandleSnapGeometry(a){return{}}getText(a){}getAriaDescriptor(a){}}function lD(a,b,c={}){let{closed:d=!1,snap:e=1,start:f="outset",end:g="outset",lengthRatio:h=2,style:i="dashed",forceSolid:j=!1}=c,k=0,l=0,m=1,n=0,o=0;if(j)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(i){case"dashed":m=1,k=Math.min(b*h,a/4);break;case"dotted":k=b/(m=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return d||("outset"===f?(a+=k/2,o+=k/2):"skip"===f&&(a-=k,o-=k),"outset"===g?a+=k/2:"skip"===g&&(a-=k)),l=Math.floor(a/k/(2*m)),(l-=l%e)<3&&"dashed"===i?a/b<4?(k=a,l=1,n=0):(k=1/3*a,n=1/3*a):(k=a/l/(2*m),d?(o=k/2,n=(a-l*k)/l):n=(a-l*k)/Math.max(1,l-1)),{strokeDasharray:[k,n].join(" "),strokeDashoffset:o.toString()}}function lE({bounds:a,className:b}){let c=kp(),d=e$("zoom level",()=>c.getZoomLevel(),[c]);return(0,bT.jsx)("g",{className:b,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:a.sides.map((a,b)=>{let{strokeDasharray:c,strokeDashoffset:e}=lD(a[0].dist(a[1]),1/d,{style:"dashed",lengthRatio:4});return(0,bT.jsx)("line",{x1:a[0].x,y1:a[0].y,x2:a[1].x,y2:a[1].y,strokeDasharray:c,strokeDashoffset:e},b)})})}let lF=[class extends lC{static type="group";static props=iU;static migrations=iV;hideSelectionBoundsFg(){return!0}canBind(){return!1}canResize(){return!0}canResizeChildren(){return!0}getDefaultProps(){return{}}getGeometry(a){let b=this.editor.getSortedChildIdsForParent(a.id);return 0===b.length?new lA({width:1,height:1,isFilled:!1}):new lw({children:b.map(a=>{let b=this.editor.getShape(a);return this.editor.getShapeGeometry(a).transform(this.editor.getShapeLocalTransform(b),{isLabel:!1})})})}component(a){let b=this.editor.getErasingShapeIds().includes(a.id),{hintingShapeIds:c}=this.editor.getCurrentPageState(),d=c.length>0&&c.some(b=>b!==a.id&&this.editor.isShapeOfType(this.editor.getShape(b),"group")),e=this.editor.getCurrentPageState().focusedGroupId!==a.id;if(!b&&(e||d))return null;let f=this.editor.getShapeGeometry(a).bounds;return(0,bT.jsx)(lg,{children:(0,bT.jsx)(lE,{className:"tl-group",bounds:f})})}indicator(a){let b=this.editor.getShapeGeometry(a).bounds;return(0,bT.jsx)(lE,{className:"",bounds:b})}onChildrenChange(a){let b=this.editor.getSortedChildIdsForParent(a.id);if(0===b.length){this.editor.getCurrentPageState().focusedGroupId===a.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([a.id]);return}if(1===b.length){this.editor.getCurrentPageState().focusedGroupId===a.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(b,a.parentId),this.editor.deleteShapes([a.id]);return}}}],lG=new Set(lF.map(a=>a.type));function lH(a){let b=[...lF],c=new Set;for(let d of a){if(lG.has(d.type))throw Error(`Shape type "${d.type}" is a core shapes type and cannot be overridden`);if(c.has(d.type))throw Error(`Shape type "${d.type}" is defined more than once`);b.push(d),c.add(d.type)}return b}var lI=a.i(35112),lJ=a.i(6388);function lK(a,b){let c=new Map;return async function(d){let e=c.get(d);if(e)return e;let f=(async()=>{try{let c=await cr(d,b);return cg(c.ok),await a(c)}catch(a){return console.error(a),null}})();return c.set(d,f),f}}let lL=lK(async a=>await ct.blobToDataUrl(await a.blob())),lM=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,lN=/@font-face\s*{([^}]+)}/gi,lO=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,lP=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function lQ(a,b){return Array.from(a.matchAll(lN),a=>{let c=a[1],d=Array.from(c.matchAll(lO),a=>{let c=a[1]||a[2]||a[3];return{original:c,resolved:dV(c,b)?.href??null}}),e=new Set(Array.from(c.matchAll(lP),a=>(a[1]||a[2]||a[3]).toLowerCase()));return{fontFace:c,urls:d,fontFamilies:e}})}function lR(a){return!(a.startsWith("-")||a.startsWith("animation")||a.startsWith("transition"))&&"cursor"!==a&&"pointer-events"!==a&&"user-select"!==a&&"touch-action"!==a}var lS=Object.create,lT=Object.defineProperty,lU=Object.getOwnPropertyDescriptor,lV=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),lW=a=>{throw TypeError(a)},lX=(a,b,c)=>b in a?lT(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lY=(a,b)=>lT(a,"name",{value:b,configurable:!0}),lZ=["class","method","getter","setter","accessor","field","value","get","set"],l$=a=>void 0!==a&&"function"!=typeof a?lW("Function expected"):a,l_=(a,b,c,d,e)=>({kind:lZ[a],name:b,metadata:d,addInitializer:a=>c._?lW("Already initialized"):e.push(l$(a||null))}),l0=(a,b)=>lX(b,lV("metadata"),a[3]),l1=(a,b,c)=>lX(a,"symbol"!=typeof b?b+"":b,c),l2=(a,b,c)=>b.has(a)||lW("Cannot "+c),l3=(a,b)=>Object(b)!==b?lW('Cannot use the "in" operator on this value'):a.has(b),l4=(a,b,c)=>(l2(a,b,"read from private field"),c?c.call(a):b.get(a)),l5=(a,b,c,d)=>(l2(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),l6=(a,b,c)=>(l2(a,b,"access private method"),c);let l7="tldraw-svg-export";J=[ck];class l8{constructor(){((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(K,5,this),l1(this,"fontFacesPromise",null),l1(this,"foundFontNames",new Set),l1(this,"fontFacesToEmbed",new Set),l1(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){cg(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=l9()}onFontFamilyValue(a){for(let b of(cg(this.fontFacesPromise,"FontEmbedder not started"),function(a){let b=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,c=/\s*,\s*/gi,d=new Set;for(;;){let e=b.exec(a);if(!e)break;let f=e[1]||e[2]||e[3];if(d.add(f.toLowerCase()),c.lastIndex=b.lastIndex,!c.exec(a))break;b.lastIndex=c.lastIndex}return d}(a))){if(this.foundFontNames.has(b))return;this.foundFontNames.add(b),this.pendingPromises.push(this.fontFacesPromise.then(a=>{for(let c of a.filter(a=>a.fontFamilies.has(b)))if(!this.fontFacesToEmbed.has(c))for(let a of(this.fontFacesToEmbed.add(c),c.urls))a.resolved&&!a.embedded&&(a.embedded=lL(a.resolved))}))}}async createCss(){await Promise.all(this.pendingPromises);let a="";for(let b of this.fontFacesToEmbed){let c=`@font-face {${b.fontFace}}`;for(let a of b.urls){if(!a.embedded)continue;let b=await a.embedded;b&&(c=c.replace(a.original,b))}a+=c}return a}}async function l9(){let a=[];for(let b of Array.from(document.styleSheets).filter(a=>!a.ownerNode?.closest(`.${l7}`))){let c;try{c=b.cssRules}catch{}if(c){for(let c of b.cssRules)if(c instanceof CSSFontFaceRule)a.push(lQ(c.cssText,b.href??document.baseURI));else if(c instanceof CSSImportRule){let b=new URL(c.href,c.parentStyleSheet?.href??document.baseURI);a.push(ma(b.href))}}else b.href&&a.push(ma(b.href))}return b5(await Promise.all(a)).flat()}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=lZ[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&lU(l<4?e:{get[c](){return l4(this,f)},set[c](x){return l5(this,f,x)}},c));l?n&&l<4&&lY(f,(l>2?"set ":l>1?"get ":"")+c):lY(e,c);for(var t=d.length-1;t>=0;t--)j=l_(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>l3(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?l4:l6)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>l5(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?l$(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?lW("Object expected"):(l$(g=h.get)&&(s.get=g),l$(g=h.set)&&(s.set=g),l$(g=h.init)&&q.unshift(g));return l||l0(a,e),s&&lT(e,c,s),n})(K=[,,,lS((void 0)??null)],1,"onFontFamilyValue",J,l8),l0(K,l8);let ma=lK(async a=>{var b,c;let d=(b=await a.text(),c=a.url,{imports:Array.from(b.matchAll(lM),a=>({url:a[1]||a[2]||a[3]||a[4]||a[5],extras:a[6]})),fontFaces:lQ(b,c)}),e=await Promise.all(d.imports.map(({url:b})=>ma(new URL(b,a.url).href)));return[...d.fontFaces,...b5(e).flat()]}),mb=(a,b,{currentColor:c})=>"currentColor"===a||a===c,mc=(a,b,{parentStyles:c})=>c[b]===a,md=a=>(b,c,{getStyle:d})=>{let e=d(`border-${a}-width`),f=d(`border-${a}-style`);return"0px"===e||"none"===f},me={"border-block-end-color":mb,"border-block-start-color":mb,"border-bottom-color":mb,"border-inline-end-color":mb,"border-inline-start-color":mb,"border-left-color":mb,"border-right-color":mb,"border-top-color":mb,"caret-color":mb,"column-rule-color":mb,"outline-color":mb,"text-decoration":(a,b,{currentColor:c})=>"none solid currentColor"===a||a==="none solid "+c,"text-decoration-color":mb,"text-emphasis-color":mb,"border-collapse":mc,"border-spacing":mc,"caption-side":mc,cursor:mc,direction:mc,"empty-cells":mc,"font-family":mc,"font-size":mc,"font-style":mc,"font-variant":mc,"font-weight":mc,"font-size-adjust":mc,"font-stretch":mc,font:mc,"letter-spacing":mc,"line-height":mc,"list-style-image":mc,"list-style-position":mc,"list-style-type":mc,"list-style":mc,orphans:mc,"overflow-wrap":mc,quotes:mc,"stroke-linecap":mc,"stroke-linejoin":mc,"tab-size":mc,"text-align":mc,"text-align-last":mc,"text-indent":mc,"text-justify":mc,"text-shadow":mc,"text-transform":mc,visibility:mc,"white-space":mc,"white-space-collapse":mc,widows:mc,"word-break":mc,"word-spacing":mc,"word-wrap":mc,"border-top":md("top"),"border-right":md("right"),"border-bottom":md("bottom"),"border-left":md("left"),"border-block-end":md("block-end"),"border-block-start":md("block-start"),"border-inline-end":md("inline-end"),"border-inline-start":md("inline-start"),"border-top-style":md("top"),"border-right-style":md("right"),"border-bottom-style":md("bottom"),"border-left-style":md("left"),"border-block-end-style":md("block-end"),"border-block-start-style":md("block-start"),"border-inline-end-style":md("inline-end"),"border-inline-start-style":md("inline-start"),"border-top-width":md("top"),"border-right-width":md("right"),"border-bottom-width":md("bottom"),"border-left-width":md("left"),"border-block-end-width":md("block-end"),"border-block-start-width":md("block-start"),"border-inline-end-width":md("inline-end")};function mf(a){if(a.shadowRoot)return a.shadowRoot.childNodes;if(function(a){var b;return"getRootNode"in a&&(b=a.getRootNode())instanceof mh(b).ShadowRoot&&a instanceof mh(a).HTMLSlotElement}(a)){let b=a.assignedNodes();if(b?.length)return b}return a.childNodes}function*mg(a){for(let c of mf(a)){var b;(b=c)instanceof mh(b).Element&&(yield c)}}function mh(a){return a.ownerDocument?.defaultView??globalThis}function mi(a,b){return mh(a).getComputedStyle(a,b)}let mj={};class mk{constructor(a){this.root=a}styles=new Map;fonts=new l8;readRootElementStyles(a){this.readElementStyles(a,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});let b=Array.from(mg(a));for(;b.length;){let a=b.pop();b.push(...mg(a)),this.readElementStyles(a,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(a,{shouldRespectDefaults:b=!0,shouldSkipInheritedParentStyles:c=!0}){let d=b?function(a){let b=mp[a];if(!b){let{foreignObject:c,document:d}=function(){if(!g){let a=document.createElement("iframe");a.style.display="none",document.body.appendChild(a);let b=ch(a.contentDocument,"frame must have a document"),c=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.appendChild(d),b.body.appendChild(c),g={iframe:a,foreignObject:d,document:b}}return g}(),e=d.createElement(a);c.appendChild(e),b=e.computedStyleMap?mm(e.computedStyleMap(),mq):mn(mi(e),mq),c.removeChild(e),mp[a]=b}return b}(a.tagName.toLowerCase()):mj,e=Object.assign({},mj);if(c){let b=a.parentElement;for(;b;){let a=this.styles.get(b)?.self;for(let b in a)e[b]||(e[b]=a[b]);b=b.parentElement}}let f={self:function(a,{defaultStyles:b,parentStyles:c}){return a.computedStyleMap?mm(a.computedStyleMap(),{defaultStyles:b,parentStyles:c}):mn(mi(a),{defaultStyles:b,parentStyles:c})}(a,{defaultStyles:d,parentStyles:e}),before:ml(a,"::before"),after:ml(a,"::after")};this.styles.set(a,f)}fetchResources(){let a=[];for(let b of this.styles.values())for(let c of cX(b))if(c)for(let[b,d]of Object.entries(c)){if(!d)continue;"font-family"===b&&this.fonts.onFontFamilyValue(d);let e=Array.from(d.matchAll(lO),a=>({original:a[0],url:a[1]||a[2]||a[3]}));0!==e.length&&a.push(...e.map(async({url:a,original:e})=>{let f=await lL(a)??"data:";c[b]=d.replace(e,`url("${f}")`)}))}return Promise.all(a)}unwrapCustomElements(){let a=new Set,b=(c,d)=>{if(a.has(c))return;a.add(c);let e=c.shadowRoot;if(e){let a=document.createElement("div");for(let f of(this.styles.set(a,this.styles.get(c)),a.setAttribute("data-tl-custom-element",c.tagName),(d??c.parentElement).appendChild(a),e.childNodes))f instanceof Element?b(f,a):a.appendChild(f.cloneNode(!0));c.remove()}else if(d){if("style"===c.tagName.toLowerCase())return;let a=c.cloneNode(!1);for(let e of(this.styles.set(a,this.styles.get(c)),d.appendChild(a),mf(c)))e instanceof Element?b(e,a):a.appendChild(e.cloneNode(!0))}};for(let a of this.styles.keys())b(a,null)}embedStyles(){let a="";for(let[b,c]of this.styles){if(c.after||c.before){let d=`pseudo-${cA(void 0)}`;b.classList.add(d),c.before&&(a+=`.${d}::before {${mo(c.before)}}
`),c.after&&(a+=`.${d}::after {${mo(c.after)}}
`)}let d=b.style;for(let[a,b]of Object.entries(c.self))b&&d.setProperty(a,b);"auto"===d.fontKerning&&(d.fontKerning="normal")}return a}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){g&&(document.body.removeChild(g.iframe),g=void 0)}}function ml(a,b){let c=mi(a,b),d=c.getPropertyValue("content");if(""!==d&&"none"!==d)return mn(c,{defaultStyles:mj,parentStyles:mj})}function mm(a,{defaultStyles:b,parentStyles:c}){let d={},e={currentColor:a.get("color")?.toString()||"",parentStyles:c,defaultStyles:b,getStyle:b=>a.get(b)?.toString()??""};for(let c of a.keys()){if(!lR(c))continue;let f=a.get(c).toString();if(b[c]===f)continue;let g=cV(me,c);g&&g(f,c,e)||(d[c]=f)}return d}function mn(a,{defaultStyles:b,parentStyles:c}){let d={},e={currentColor:a.color,parentStyles:c,defaultStyles:b,getStyle:b=>a.getPropertyValue(b)};for(let c in a){if(!lR(c))continue;let f=a.getPropertyValue(c);if(b[c]===f)continue;let g=cV(me,c);g&&g(f,c,e)||(d[c]=f)}return d}function mo(a){let b="";for(let[c,d]of Object.entries(a))b+=`${c}: ${d};`;return b}let mp={},mq={defaultStyles:mj,parentStyles:mj};function mr(a,b){return a.replaceWith(b),b}async function ms(a,b){let c=document.createElement("img");b&&Array.from(b.attributes).forEach(a=>{c.setAttribute(a.name,a.value)}),c.setAttribute("src",a??"data:"),c.setAttribute("decoding","sync"),c.setAttribute("loading","eager");try{await c.decode()}catch{}return c}async function mt(a){try{let b=a.toDataURL();return await ms(b,a)}catch{return await ms(null,a)}}async function mu(a){try{let b=await cP.getVideoFrameAsDataUrl(a);return ms(b,a)}catch(a){console.error("Could not get video frame",a)}return a.poster?ms(await lL(a.poster),a):ms(null,a)}async function mv(a){if(a instanceof HTMLCanvasElement)return mr(a,await mt(a));if(a instanceof HTMLVideoElement)return mr(a,await mu(a));if(a instanceof HTMLImageElement){let b=a.currentSrc||a.src,c=await lL(b);a.setAttribute("src",c??"data:"),a.setAttribute("decoding","sync"),a.setAttribute("loading","eager");try{await a.decode()}catch{}return a}a instanceof HTMLInputElement?a.setAttribute("value",a.value):a instanceof HTMLTextAreaElement&&(a.textContent=a.value);await Promise.all(Array.from(mg(a),a=>mv(a)))}let mw=(a,b)=>a.props===b.props&&a.meta===b.meta,mx=(0,eQ.memo)(function({id:a,shape:b,util:c,index:d,backgroundIndex:e,opacity:f}){let g=kp(),{ShapeErrorFallback:h,ShapeWrapper:i}=re(),j=(0,eQ.useRef)(null),k=(0,eQ.useRef)(null);(0,eQ.useEffect)(()=>eg("load fonts",()=>{let b=g.fonts.getShapeFontFaces(a);g.fonts.requestFonts(b)}),[g,a]);let l=(0,eQ.useRef)({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});eY("set shape stuff",()=>{let b=g.getShape(a);if(!b)return;let c=l.current,d=g.getShapeClipPath(a)??"none";d!==c.clipPath&&(ke(j.current,"clip-path",d),ke(k.current,"clip-path",d),c.clipPath=d);let e=g.getShapePageTransform(a),f=li.toCssString(e),h=g.getShapeGeometry(b).bounds;f!==c.transform&&(ke(j.current,"transform",f),ke(k.current,"transform",f),c.transform=f);let i=Math.max(h.width,1),m=Math.max(h.height,1);(i!==c.width||m!==c.height)&&(ke(j.current,"width",i+"px"),ke(j.current,"height",m+"px"),ke(k.current,"width",i+"px"),ke(k.current,"height",m+"px"),c.width=i,c.height=m)},[g]),(0,eQ.useLayoutEffect)(()=>{let a=j.current,b=k.current;ke(a,"opacity",f),ke(b,"opacity",f),ke(a,"z-index",d),ke(b,"z-index",e)},[f,d,e]),eY("set display",()=>{if(!g.getShape(a))return;let b=g.getCulledShapes().has(a);b!==l.current.isCulled&&(ke(j.current,"display",b?"none":"block"),ke(k.current,"display",b?"none":"block"),l.current.isCulled=b)},[g]);let m=(0,eQ.useCallback)(a=>g.annotateError(a,{origin:"shape",willCrashApp:!1}),[g]);return b&&i?(0,bT.jsxs)(bT.Fragment,{children:[c.backgroundComponent&&(0,bT.jsx)(i,{ref:k,shape:b,isBackground:!0,children:(0,bT.jsx)(kE,{fallback:h,onError:m,children:(0,bT.jsx)(mz,{shape:b,util:c})})}),(0,bT.jsx)(i,{ref:j,shape:b,isBackground:!1,children:(0,bT.jsx)(kE,{fallback:h,onError:m,children:(0,bT.jsx)(my,{shape:b,util:c})})})]}):null}),my=(0,eQ.memo)(function({shape:a,util:b}){return eR("InnerShape:"+a.type,()=>b.component(b.editor.store.unsafeGetWithoutCapture(a.id)),[b,a.id])},(a,b)=>mw(a.shape,b.shape)&&a.util===b.util),mz=(0,eQ.memo)(function({shape:a,util:b}){return eR("InnerShape:"+a.type,()=>b.backgroundComponent?.(b.editor.store.unsafeGetWithoutCapture(a.id)),[b,a.id])},(a,b)=>a.shape.props===b.shape.props&&a.shape.meta===b.shape.meta&&a.util===b.util);function mA(a){let b=(0,eQ.useRef)();return(0,eQ.useLayoutEffect)(()=>{b.current=a}),(0,eQ.useDebugValue)(a),(0,eQ.useCallback)((...a)=>{let c=b.current;return cg(c,"fn does not exist"),c(...a)},[])}let mB=(0,eQ.createContext)(null);function mC({context:a,editor:b,children:c}){let d=b.options.exportProvider;return(0,bT.jsx)(kr,{editor:b,children:(0,bT.jsx)(ku,{container:b.getContainer(),children:(0,bT.jsx)(mB.Provider,{value:a,children:(0,bT.jsx)(d,{children:c})})})})}function mD(){return(0,eQ.useContext)(mB)}var mE=Object.create,mF=Object.defineProperty,mG=Object.getOwnPropertyDescriptor,mH=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),mI=a=>{throw TypeError(a)},mJ=(a,b,c)=>b in a?mF(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mK=(a,b)=>mF(a,"name",{value:b,configurable:!0}),mL=["class","method","getter","setter","accessor","field","value","get","set"],mM=a=>void 0!==a&&"function"!=typeof a?mI("Function expected"):a,mN=(a,b,c,d,e)=>({kind:mL[a],name:b,metadata:d,addInitializer:a=>c._?mI("Already initialized"):e.push(mM(a||null))}),mO=(a,b)=>mJ(b,mH("metadata"),a[3]),mP=(a,b,c)=>mJ(a,"symbol"!=typeof b?b+"":b,c),mQ=(a,b,c)=>b.has(a)||mI("Cannot "+c),mR=(a,b)=>Object(b)!==b?mI('Cannot use the "in" operator on this value'):a.has(b),mS=(a,b,c)=>(mQ(a,b,"read from private field"),c?c.call(a):b.get(a)),mT=(a,b,c,d)=>(mQ(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),mU=(a,b,c)=>(mQ(a,b,"access private method"),c);L=[ck];class mV{constructor(a){this.maxDelayTimeMs=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(M,5,this),mP(this,"isResolved",!1),mP(this,"promisesToWaitFor",[])}waitUntil(a){if(this.isResolved)throw Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(a.catch(a=>console.error("Error while waiting for export:",a)))}async resolvePromises(){let a=null;for(;this.promisesToWaitFor.length!==a;)a=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await cj(0)}async resolve(){let a=cj(this.maxDelayTimeMs).then(()=>"timeout"),b=this.resolvePromises().then(()=>"resolved");"timeout"===await Promise.race([a,b])&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}function mW({editor:a,preserveAspectRatio:b,scale:c,pixelRatio:d,bbox:e,background:f,singleFrameShapeId:g,isDarkMode:h,renderingShapes:i,onMount:j,waitUntil:k}){let l=kj(),m=hl({isDarkMode:h}),n=eW("export state",{defsById:{},shapeElements:null}),{defsById:o,shapeElements:p}=e$(n),q=mA(a=>{n.update(b=>{if(cU(b.defsById,a.key))return b;let c=Promise.resolve(a.getElement());return k(c.then(b=>{n.update(c=>({...c,defsById:{...c.defsById,[a.key]:{pending:!1,element:b}}}))})),{...b,defsById:{...b.defsById,[a.key]:{pending:!0,element:c}}}})}),r=(0,eQ.useMemo)(()=>({isDarkMode:h,waitUntil:k,addExportDef:q,scale:c,pixelRatio:d,async resolveAssetUrl(b,e){let f=a.getAsset(b);return f&&("image"===f.type||"video"===f.type)?await a.resolveAssetUrl(b,{screenScale:c*(e/f.props.w),shouldResolveToOriginal:null===d,dpr:d??void 0}):null}}),[h,k,q,c,d,a]),s=(0,eQ.useRef)(!1);(0,eQ.useLayoutEffect)(()=>{if(s.current)throw Error("SvgExport should only render once - do not use with react strict mode");s.current=!0,(async()=>{let b={},c=i.map(async({id:c,opacity:d,index:f,backgroundIndex:h})=>{if(c===g)return[];let i=a.getShape(c);if(a.isShapeOfType(i,"group"))return[];let j=[],k=a.getShapeUtil(i);if(k.toSvg||k.toBackgroundSvg){let[c,e]=await Promise.all([k.toSvg?.(i,r),k.toBackgroundSvg?.(i,r)]),g=a.getShapePageTransform(i),m=g.toCssString(),n=1;"scale"in i.props&&1!==i.props.scale&&(n=i.props.scale,m=`${m} scale(${i.props.scale}, ${i.props.scale})`);let o=a.getShapeMask(i.id),p=o?li.From(li.Inverse(g)).applyToPoints(o):null,q=ki(l,i.id);p&&(b[q]={pending:!1,element:(0,bT.jsx)("clipPath",{id:q,children:(0,bT.jsx)("path",{d:`M${p.map(({x:a,y:b})=>`${a/n},${b/n}`).join("L")}Z`})})}),c&&j.push({zIndex:f,element:(0,bT.jsx)("g",{transform:m,opacity:d,clipPath:o?`url(#${q})`:void 0,children:c},`fg_${i.id}`)}),e&&j.push({zIndex:h,element:(0,bT.jsx)("g",{transform:m,opacity:d,clipPath:o?`url(#${q})`:void 0,children:e},`bg_${i.id}`)})}else j.push({zIndex:f,element:(0,bT.jsx)(mX,{shape:i,util:k,component:my,className:"tl-shape",bbox:e,opacity:d},`fg_${i.id}`)}),k.backgroundComponent&&j.push({zIndex:h,element:(0,bT.jsx)(mX,{shape:i,util:k,component:mz,className:"tl-shape tl-shape-background",bbox:e,opacity:d},`bg_${i.id}`)});return j}),d=(await Promise.all(c)).flat();(0,lI.flushSync)(()=>{n.update(a=>({...a,shapeElements:d.sort((a,b)=>a.zIndex-b.zIndex).map(({element:a})=>a),defsById:{...a.defsById,...b}}))})})()},[e,a,r,l,i,g,n]),(0,eQ.useEffect)(()=>{let b=new Set;for(let{id:c}of i)for(let d of a.fonts.getShapeFontFaces(c))b.add(d);for(let c of b)q({key:cA(void 0),getElement:async()=>{let b=await a.fonts.toEmbeddedCssDeclaration(c);return(0,bT.jsx)("style",{nonce:a.options.nonce,children:b})}})},[a,i,q]),(0,eQ.useEffect)(()=>{null!==p&&j()},[j,p]);let t=f?m.background:"transparent";if(g&&f){let b=a.getShapeUtil("frame");t=b?.options.showColors?hp(m,a.getShape(g).props.color,"frameFill"):m.solid}return(0,bT.jsx)(mC,{editor:a,context:r,children:(0,bT.jsxs)("svg",{preserveAspectRatio:b,direction:"ltr",width:e.width*c,height:e.height*c,viewBox:`${e.minX} ${e.minY} ${e.width} ${e.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:t},"data-color-mode":h?"dark":"light",className:`tl-container tl-theme__force-sRGB ${h?"tl-theme__dark":"tl-theme__light"}`,children:[(0,bT.jsx)("defs",{children:Object.entries(o).map(([a,b])=>b.pending?null:(0,bT.jsx)(eQ.Fragment,{children:b.element},a))}),p]})})}function mX({shape:a,util:b,className:c,component:d,bbox:e,opacity:f}){let g=kp(),h=li.Translate(-e.minX,-e.minY).multiply(g.getShapePageTransform(a.id)),i=g.getShapeGeometry(a.id).bounds,j=Math.max(i.width,1),k=Math.max(i.height,1);return(0,bT.jsx)(kD,{fallback:()=>null,children:(0,bT.jsx)("foreignObject",{x:e.minX,y:e.minY,width:e.w,height:e.h,className:"tl-shape-foreign-object tl-export-embed-styles",children:(0,bT.jsx)("div",{className:c,"data-shape-type":a.type,style:{clipPath:g.getShapeClipPath(a.id),transform:h.toCssString(),width:j,height:k,opacity:f},children:(0,bT.jsx)(d,{shape:a,util:b})})})})}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=mL[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&mG(l<4?e:{get[c](){return mS(this,f)},set[c](x){return mT(this,f,x)}},c));l?n&&l<4&&mK(f,(l>2?"set ":l>1?"get ":"")+c):mK(e,c);for(var t=d.length-1;t>=0;t--)j=mN(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>mR(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?mS:mU)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>mT(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?mM(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?mI("Object expected"):(mM(g=h.get)&&(s.get=g),mM(g=h.set)&&(s.set=g),mM(g=h.init)&&q.unshift(g));return l||mO(a,e),s&&mF(e,c,s),n})(M=[,,,mE((void 0)??null)],1,"waitUntil",L,mV),mO(M,mV);let mY=1;async function mZ(a,b,c={}){let d=function(a,b,c={}){if(!window.document)throw Error("No document");let{scale:d=1,background:e=a.getInstanceState().exportBackground,padding:f=a.options.defaultSvgPadding,preserveAspectRatio:g}=c,h=c.darkMode??a.user.getIsDarkMode(),i=a.getShapeAndDescendantIds(b),j=a.getUnorderedRenderingShapes(!1).filter(({id:a})=>i.has(a)),k=1===b.length&&a.isShapeOfType(a.getShape(b[0]),"frame")?b[0]:null,l=null;if(!(l=c.bounds?c.bounds.clone().expandBy(f):function(a,b,c,d){let e=!1,f=null;for(let{id:c}of b){let b=a.getShapeMaskedPageBounds(c);if(!b)continue;let d=a.getShape(c),g=a.getShapeUtil(d).isExportBoundsContainer(d);f?g&&lh.ContainsApproximately(b,f)?(e=!0,f=b.clone()):(e&&!lh.ContainsApproximately(f,b)&&(e=!1),f.union(b)):(e=g,f=b.clone())}return f?(d||e||f.expandBy(c),f):null}(a,j,f,k)))return;let m=l.width*d,n=l.height*d;try{document.body.focus?.()}catch{}let o=new mV(a.options.maxExportDelayMs),p=ci();return o.waitUntil(p),{jsx:(0,bT.jsx)(mW,{editor:a,preserveAspectRatio:g,scale:d,pixelRatio:c.pixelRatio??null,bbox:l,background:e,singleFrameShapeId:k,isDarkMode:h,renderingShapes:j,onMount:p.resolve,waitUntil:o.waitUntil}),width:m,height:n,exportDelay:o}}(a,b,c);if(!d)return;let e=a.getContainer(),f=document.createElement("div");f.className=l7,f.inert=!0,f.tabIndex=-1,Object.assign(f.style,{position:"absolute",top:"0px",left:"0px",width:d.width+"px",height:d.height+"px",pointerEvents:"none",opacity:0}),e.appendChild(f);let g=(0,lJ.createRoot)(f,{identifierPrefix:`export_${mY++}_`});try{await Promise.resolve(),(0,lI.flushSync)(()=>{g.render(d.jsx)}),await d.exportDelay.resolve();let a=f.firstElementChild;return cg(a instanceof SVGSVGElement,"Expected an SVG element"),await m$(a),{svg:a,width:d.width,height:d.height}}finally{setTimeout(()=>{g.unmount(),e.removeChild(f)},0)}}async function m$(a){let b=[...a.querySelectorAll("foreignObject.tl-export-embed-styles > *")];if(!b.length)return;let c=new mk(a);try{for(let a of(c.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(b.map(a=>mv(a))),b))c.readRootElementStyles(a);await c.fetchResources();let d=await c.getFontFaceCss();c.unwrapCustomElements();let e=c.embedStyles();if(d||e){let b=document.createElementNS("http://www.w3.org/2000/svg","style");b.textContent=`${d}
${e}`,a.prepend(b)}}finally{c.dispose()}}let m_=null,m0={area:[16384,14188,11402,11180,10836,8192,4096],height:[8388607,65535,32767,16384,8192,4096],width:[4194303,65535,32767,16384,8192,4096]};function m1(a){let b=document.createElement("canvas");b.width=1,b.height=1;let c=b.getContext("2d");for(let d of m0[a]){let e="height"===a?1:d,f="width"===a?1:d,g=document.createElement("canvas");g.width=e,g.height=f,g.getContext("2d").fillRect(e-1,f-1,1,1),c.drawImage(g,e-1,f-1,1,1,0,0,1,1);let h=0!==c.getImageData(0,0,1,1).data[3];if(g.width=0,g.height=0,h){if(b.width=0,b.height=0,"area"===a)return d*d;return d}}throw b.width=0,b.height=0,Error("Failed to determine maximum canvas dimension")}async function m2(a,b){let{type:c,width:d,height:e,quality:f=1,pixelRatio:g=2}=b,[h,i]=function(a,b){if(a<=8192&&b<=8192&&a*b<=0x1000000)return[a,b];let{maxWidth:c,maxHeight:d,maxArea:e}=(m_||(m_={maxWidth:m1("width"),maxHeight:m1("height"),maxArea:m1("area")}),m_),f=a/b;if(a>c&&(b=(a=c)/f),b>d&&(a=(b=d)*f),a*b>e){let c=Math.sqrt(e/(a*b));a*=c,b*=c}return[a,b]}(d*g,e*g);h=Math.floor(h),i=Math.floor(i);let j=h/d,k=await ct.blobToDataUrl(new Blob([a],{type:"image/svg+xml"})),l=await new Promise(a=>{let b=cs();b.crossOrigin="anonymous",b.onload=async()=>{let c=document.createElement("canvas"),d=c.getContext("2d");c.width=h,c.height=i,d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(b,0,0,h,i),URL.revokeObjectURL(k),a(c)},b.onerror=()=>{a(null)},b.src=k});if(!l)return null;let m=await new Promise(a=>l.toBlob(b=>{(!b||j7.throwToBlob.get())&&a(null),a(b)},"image/"+c,f));if(!m)return null;if("png"!==c)return m;{let a=new DataView(await m.arrayBuffer());return cH.setPhysChunk(a,j,{type:"image/"+c})}}let m3={menus:eM("open menus",[]),getOpenMenus(a){return a?this.menus.get().filter(b=>b.endsWith("-"+a)):this.menus.get()},addOpenMenu(a,b=""){let c=b?`${a}-${b}`:a,d=new Set(this.menus.get());d.has(c)||(d.add(c),this.menus.set([...d]))},deleteOpenMenu(a,b=""){let c=b?`${a}-${b}`:a,d=new Set(this.menus.get());d.has(c)&&(d.delete(c),this.menus.set([...d]))},clearOpenMenus(a){this.menus.set(a?this.menus.get().filter(b=>!b.endsWith("-"+a)):[])},_hiddenMenus:[],hideOpenMenus(a){if(this._hiddenMenus=[...this.getOpenMenus(a)],0!==this._hiddenMenus.length)for(let b of this._hiddenMenus)this.deleteOpenMenu(b,a)},showOpenMenus(a){if(0!==this._hiddenMenus.length){for(let b of this._hiddenMenus)this.addOpenMenu(b,a);this._hiddenMenus=[]}},isMenuOpen(a,b){return this.getOpenMenus(b).includes(a)},hasOpenMenus(a){return this.getOpenMenus(a).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(a){return{getOpenMenus:()=>this.getOpenMenus(a),addOpenMenu:b=>this.addOpenMenu(b,a),deleteOpenMenu:b=>this.deleteOpenMenu(b,a),clearOpenMenus:()=>this.clearOpenMenus(a),isMenuOpen:b=>this.isMenuOpen(b,a),hasOpenMenus:()=>this.hasOpenMenus(a),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},m4=new dU,m5={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,uiDragDistanceSquared:16,uiCoarseDragDistanceSquared:625,defaultSvgPadding:32,cameraSlideFriction:.09,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,tooltipDelayMs:700,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:eQ.Fragment,enableToolbarKeyboardShortcuts:!0,maxFontsToLoadBeforeRender:1/0,nonce:void 0};function m6(a,b){if(!b)return!1;switch(a.type){case"mixed":return"mixed"===b.type;case"shared":return"shared"===b.type&&a.value===b.value;default:throw cf(a)}}class m7{map;constructor(a){this.map=new Map(a)}get(a){return this.map.get(a)}getAsKnownValue(a){let b=this.get(a);if(b&&"mixed"!==b.type)return b.value}get size(){return this.map.size}equals(a){if(this.size!==a.size)return!1;let b=new Set;for(let[c,d]of this){if(!m6(d,a.get(c)))return!1;b.add(c)}for(let[c,d]of a)if(!b.has(c)&&!m6(d,this.get(c)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class m8 extends m7{set(a,b){this.map.set(a,b)}applyValue(a,b){let c=this.get(a);if(!c)return void this.set(a,{type:"shared",value:b});switch(c.type){case"mixed":return;case"shared":c.value!==b&&this.set(a,{type:"mixed"});return;default:cf(c,"type")}}}function m9(){return`https://cdn.tldraw.com/${kJ}`}function na(a){return encodeURIComponent(a).replace(/\./g,"%2E")}function nb(a,b,c,d){if(0===c.length)return[];let e=new Map;for(let b of b5(c.map(b=>a.getShape(b)))){let{parentId:c}=b;e.has(c)||e.set(c,{children:b5(a.getSortedChildIdsForParent(c).map(b=>a.getShape(b))),moving:new Set}),e.get(c).moving.add(b)}let f=[];switch(b){case"toBack":e.forEach(({moving:a,children:b})=>(function(a,b,c){let d,e,f=b.length;if(a.size!==f){for(let c=0;c<f;c++){let f=b[c];if(a.has(f))d=f.index,a.delete(f);else{e=f.index;break}}if(0===a.size)return;{let b=ds(d,e,a.size);c.push(...Array.from(a.values()).sort(dz).map((a,c)=>({...a,index:b[c]})))}}})(a,b,f));break;case"toFront":e.forEach(({moving:a,children:b})=>(function(a,b,c){let d,e,f=b.length;if(a.size!==f){for(let c=f-1;c>-1;c--){let f=b[c];if(a.has(f))e=f.index,a.delete(f);else{d=f.index;break}}if(0===a.size)return;{let b=ds(d,e,a.size);c.push(...Array.from(a.values()).sort(dz).map((a,c)=>({...a,index:b[c]})))}}})(a,b,f));break;case"forward":e.forEach(({moving:b,children:c})=>(function(a,b,c,d,e){let f=nc(a,b),g=c.length;if(b.size===g)return;let h={name:"skipping"};for(let a=0;a<g;a++){let g=b.has(c[a]);switch(h.name){case"skipping":if(!g)continue;h={name:"selecting",selectIndex:a};break;case"selecting":{if(g||!e?.considerAllShapes&&!f(c[a]))continue;let{selectIndex:i}=h;ds(c[a].index,c[a+1]?.index,a-i).forEach((a,e)=>{let f=c[i+e];b.has(f)&&d.push({...f,index:a})}),h={name:"skipping"}}}}})(a,b,c,f,d));break;case"backward":e.forEach(({moving:b,children:c})=>(function(a,b,c,d,e){let f=nc(a,b),g=c.length;if(b.size===g)return;let h={name:"skipping"};for(let a=g-1;a>-1;a--){let g=b.has(c[a]);switch(h.name){case"skipping":if(!g)continue;h={name:"selecting",selectIndex:a};break;case"selecting":if(g||!e?.considerAllShapes&&!f(c[a]))continue;ds(c[a-1]?.index,c[a].index,h.selectIndex-a).forEach((e,f)=>{let g=c[a+f+1];b.has(g)&&d.push({...g,index:e})}),h={name:"skipping"}}}})(a,b,c,f,d))}return f}function nc(a,b){let c=b5(Array.from(b).map(b=>{let c=a.getShapePageBounds(b);return c?{shape:b,bounds:c}:null}));return b=>{let d=a.getShapePageBounds(b);return!!d&&c.some(a=>a.bounds.includes(d))}}function nd({editor:a,ids:b}){let c=b5(b.map(b=>a.getShape(b))),d=a.getShapesSharedRotation(b),e=a.getShapesRotatedPageBounds(b);if(!e)return null;let f=e.center.clone().rotWith(e.point,d);return{initialPageCenter:f,initialCursorAngle:f.angle(a.inputs.originPagePoint),initialShapesRotation:d,shapeSnapshots:c.map(b=>({shape:b,initialPagePoint:a.getShapePageTransform(b.id).point()}))}}function ne({delta:a,editor:b,snapshot:c,stage:d,centerOverride:e}){let{initialPageCenter:f,shapeSnapshots:g}=c;b.updateShapes(g.map(({shape:c,initialPagePoint:d})=>{let g=hc(c.parentId)?b.getShapePageTransform(c.parentId):li.Identity(),h=jA.RotWith(d,e??f,a),i=li.applyToPoint(li.Inverse(g),h),j=jM(c.rotation+a);return{id:c.id,type:c.type,x:i.x,y:i.y,rotation:j}}));let h=[];g.forEach(({shape:a})=>{let c=b.getShape(a.id);if(!c)return;let e=b.getShapeUtil(a);if("start"===d||"one-off"===d){let b=e.onRotateStart?.(a);b&&h.push(b)}let f=e.onRotate?.(a,c);if(f&&h.push(f),"end"===d||"one-off"===d){let b=e.onRotateEnd?.(a,c);b&&h.push(b)}}),h.length>0&&b.updateShapes(h)}function nf(a){let b=a.get(),c=new Map;for(let a of b){let{fromId:b,toId:d}=a,e=c.get(b);e?e.push(a):c.set(b,[a]);let f=c.get(d);f?f.push(a):c.set(d,[a])}return c}function ng(a,b){let c={};return Array.from(a.get(),a=>b.get(a)).sort(dz).forEach(a=>{c[a.parentId]??=[],c[a.parentId].push(a.id)}),c}let nh=(a,b,c)=>{for(;!hV(c.parentId);){let b=a.get(c.parentId);if(!b)return!1;c=b}return c.parentId===b};var ni=Object.create,nj=Object.defineProperty,nk=Object.getOwnPropertyDescriptor,nl=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),nm=a=>{throw TypeError(a)},nn=(a,b,c)=>b in a?nj(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,no=(a,b)=>nj(a,"name",{value:b,configurable:!0}),np=["class","method","getter","setter","accessor","field","value","get","set"],nq=a=>void 0!==a&&"function"!=typeof a?nm("Function expected"):a,nr=(a,b,c,d,e)=>({kind:np[a],name:b,metadata:d,addInitializer:a=>c._?nm("Already initialized"):e.push(nq(a||null))}),ns=(a,b)=>nn(b,nl("metadata"),a[3]),nt=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=np[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&nk(l<4?e:{get[c](){return nx(this,f)},set[c](x){return ny(this,f,x)}},c));l?n&&l<4&&no(f,(l>2?"set ":l>1?"get ":"")+c):no(e,c);for(var t=d.length-1;t>=0;t--)j=nr(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>nw(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?nx:nz)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>ny(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?nq(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?nm("Object expected"):(nq(g=h.get)&&(s.get=g),nq(g=h.set)&&(s.set=g),nq(g=h.init)&&q.unshift(g));return l||ns(a,e),s&&nj(e,c,s),n?4^l?f:s:e},nu=(a,b,c)=>nn(a,"symbol"!=typeof b?b+"":b,c),nv=(a,b,c)=>b.has(a)||nm("Cannot "+c),nw=(a,b)=>Object(b)!==b?nm('Cannot use the "in" operator on this value'):a.has(b),nx=(a,b,c)=>(nv(a,b,"read from private field"),c?c.call(a):b.get(a)),ny=(a,b,c,d)=>(nv(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),nz=(a,b,c)=>(nv(a,b,"access private method"),c);O=[ck],N=[ck];class nA{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(P,5,this),nu(this,"_clickId",""),nu(this,"_clickTimeout"),nu(this,"_clickScreenPoint"),nu(this,"_previousScreenPoint"),nu(this,"_clickState","idle"),nu(this,"lastPointerInfo",{})}_getClickTimeout(a,b=function(a){return cA(void 0)}()){this._clickId=b,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===a&&this._clickId===b){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}},"idle"===a||"pendingDouble"===a?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(a){switch(a.name){case"pointer_down":if(!this._clickState)break;switch(this._clickScreenPoint=jA.From(a.point),this._previousScreenPoint&&jA.Dist2(this._previousScreenPoint,this._clickScreenPoint)>1600&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=a,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...a,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...a,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...a,type:"click",name:"quadruple_click",phase:"down"};case"idle":this._clickState="pendingDouble";break;case"pendingOverflow":this._clickState="overflow"}this._clickTimeout=this._getClickTimeout(this._clickState);break;case"pointer_up":if(!this._clickState)break;switch(this._clickScreenPoint=jA.From(a.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}break;case"pointer_move":"idle"!==this._clickState&&this._clickScreenPoint&&jA.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout()}return a}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}nt(P=[,,,ni((void 0)??null)],1,"_getClickTimeout",O,nA),nt(P,1,"cancelDoubleClickTimeout",N,nA),ns(P,nA);class nB{constructor(a){this.editor=a}_isEdgeScrolling=!1;_edgeScrollDuration=-1;updateEdgeScrolling(a){let{editor:b}=this,c=this.getEdgeScroll();if(0===c.x&&0===c.y)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=a,this._edgeScrollDuration>b.options.edgeScrollDelay){let a,d=b.options.edgeScrollEaseDuration>0?(a=Math.min(1,this._edgeScrollDuration/(b.options.edgeScrollDelay+b.options.edgeScrollEaseDuration)))*a*a:1;this.moveCameraWhenCloseToEdge({x:c.x*d,y:c.y*d})}}getEdgeProximityFactors(a,b,c,d,e){let{editor:f}=this,g=f.options.edgeScrollDistance,h=c?f.options.coarsePointerWidth:0,i=a-h,j=a+h,k=d?0:g,l=e?b:b-g;return i<k?Math.min(1,(k-i)/g):j>l?-Math.min(1,(j-l)/g):0}getEdgeScroll(){let{editor:a}=this,{inputs:{currentScreenPoint:{x:b,y:c}}}=a,d=a.getViewportScreenBounds(),{isCoarsePointer:e,insets:[f,g,h,i]}=a.getInstanceState();return{x:this.getEdgeProximityFactors(b,d.w,e,i,g),y:this.getEdgeProximityFactors(c,d.h,e,f,h)}}moveCameraWhenCloseToEdge(a){let{editor:b}=this;if(!b.inputs.isDragging||b.inputs.isPanning||b.getCameraOptions().isLocked||0===a.x&&0===a.y)return;let c=b.getViewportScreenBounds(),d=c.w<1e3?.612:1,e=c.h<1e3?.612:1,f=b.getZoomLevel(),g=b.user.getEdgeScrollSpeed()*b.options.edgeScrollSpeed,h=g*a.x*d/f,i=g*a.y*e/f,{x:j,y:k,z:l}=b.getCamera();b.setCamera(new jA(j+h,k+i,l))}}class nC{constructor(a,b){this.editor=a,this.disposeSideEffectListener=a.sideEffects.registerAfterChangeHandler("instance",(a,b)=>{a.isFocused!==b.isFocused&&this.updateContainerClass()}),b!==a.getInstanceState().isFocused&&a.updateInstanceState({isFocused:!!b}),this.updateContainerClass(),document.body.addEventListener("keydown",this.handleKeyDown.bind(this)),document.body.addEventListener("mousedown",this.handleMouseDown.bind(this))}disposeSideEffectListener;updateContainerClass(){let a=this.editor.getContainer();this.editor.getInstanceState().isFocused?a.classList.add("tl-container__focused"):a.classList.remove("tl-container__focused"),a.classList.add("tl-container__no-focus-ring")}handleKeyDown(a){let b=this.editor.getContainer(),c=document.activeElement;this.editor.isIn("select.editing_shape")&&!c?.closest(".tlui-contextual-toolbar")||(c!==b||!(this.editor.getSelectedShapeIds().length>0))&&["Tab","ArrowUp","ArrowDown"].includes(a.key)&&b.classList.remove("tl-container__no-focus-ring")}handleMouseDown(){this.editor.getContainer().classList.add("tl-container__no-focus-ring")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){document.body.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.body.removeEventListener("mousedown",this.handleMouseDown.bind(this)),this.disposeSideEffectListener?.()}}class nD{constructor(a,b){this.editor=a,this.assetUrls=b,this.shapeFontFacesCache=a.store.createComputedCache("shape font faces",a=>this.editor.getShapeUtil(a).getFontFaces(a),{areResultsEqual:ca,areRecordsEqual:(a,b)=>a.props===b.props&&a.meta===b.meta}),this.shapeFontLoadStateCache=a.store.createCache(a=>{let b=eB("font faces",()=>this.getShapeFontFaces(a));return eB("font load state",()=>b.get().map(a=>this.getFontState(a)),{isEqual:ca})})}shapeFontFacesCache;shapeFontLoadStateCache;getShapeFontFaces(a){let b="string"==typeof a?a:a.id;return this.shapeFontFacesCache.get(b)??ea}trackFontsForShape(a){let b="string"==typeof a?a:a.id;this.shapeFontLoadStateCache.get(b)}async loadRequiredFontsForCurrentPage(a=1/0){let b=new Set;for(let a of this.editor.getCurrentPageShapeIds())for(let c of this.getShapeFontFaces(this.editor.getShape(a)))b.add(c);if(b.size>a)return;let c=Array.from(b,a=>this.ensureFontIsLoaded(a));await Promise.all(c)}fontStates=new fF("font states");getFontState(a){return this.fontStates.get(a)??null}ensureFontIsLoaded(a){let b=this.getFontState(a);if(b)return b.loadingPromise;let c=this.findOrCreateFontFace(a),d={state:"loading",instance:c,loadingPromise:c.load().then(()=>{document.fonts.add(c),this.fontStates.update(a,a=>({...a,state:"ready"}))}).catch(b=>{console.error(b),this.fontStates.update(a,a=>({...a,state:"error"}))})};return this.fontStates.set(a,d),d.loadingPromise}fontsToLoad=new Set;requestFonts(a){for(let b of(this.fontsToLoad.size||queueMicrotask(()=>{if(this.editor.isDisposed)return;let a=this.fontsToLoad;this.fontsToLoad=new Set,ep(()=>{for(let b of a)this.ensureFontIsLoaded(b)})}),a))this.fontsToLoad.add(b)}findOrCreateFontFace(a){for(let b of document.fonts)if(b.family===a.family&&cY(nE).every(([c,d])=>b[c]===(a[c]??d)))return b;let b=this.assetUrls?.[a.src.url]??a.src.url,c=new FontFace(a.family,`url(${JSON.stringify(b)})`,{...c0(nE,b=>a[b]),display:"swap"});return document.fonts.add(c),c}async toEmbeddedCssDeclaration(a){let b=this.assetUrls?.[a.src.url]??a.src.url,c=await ct.urlToDataUrl(b),d=b5([`url("${c}")`,a.src.format?`format(${a.src.format})`:null,a.src.tech?`tech(${a.src.tech})`:null]).join(" ");return b5(["@font-face {",`  font-family: "${a.family}";`,a.ascentOverride?`  ascent-override: ${a.ascentOverride};`:null,a.descentOverride?`  descent-override: ${a.descentOverride};`:null,a.stretch?`  font-stretch: ${a.stretch};`:null,a.style?`  font-style: ${a.style};`:null,a.weight?`  font-weight: ${a.weight};`:null,a.featureSettings?`  font-feature-settings: ${a.featureSettings};`:null,a.lineGapOverride?`  line-gap-override: ${a.lineGapOverride};`:null,a.unicodeRange?`  unicode-range: ${a.unicodeRange};`:null,`  src: ${d};`,"}"]).join("\n")}}let nE={style:"normal",weight:"normal",stretch:"normal",unicodeRange:"U+0-10FFFF",featureSettings:"normal",ascentOverride:"normal",descentOverride:"normal",lineGapOverride:"normal"};var nF=((q=nF||{}).Recording="recording",q.RecordingPreserveRedoStack="recordingPreserveRedoStack",q.Paused="paused",q);class nG{store;dispose;state="recording";pendingDiff=new nI;stacks=eM("HistoryManager.stacks",{undos:nJ(),redos:nJ()},{isEqual:(a,b)=>a.undos===b.undos&&a.redos===b.redos});annotateError;constructor(a){this.store=a.store,this.annotateError=a.annotateError??cd,this.dispose=this.store.addHistoryInterceptor((a,b)=>{if("user"===b)switch(this.state){case"recording":this.pendingDiff.apply(a.changes),this.stacks.update(({undos:a})=>({undos:a,redos:nJ()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(a.changes);break;case"paused":break;default:cf(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;let a=this.pendingDiff.clear();this.stacks.update(({undos:b,redos:c})=>({undos:b.push({type:"diff",diff:a}),redos:c}))}getNumUndos(){return this.stacks.get().undos.length+ +!this.pendingDiff.isEmpty()}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch(a,b){let c=this.state;"paused"!==c&&b?.history&&(this.state=nH[b.history]);try{if(this._isInBatch)return ep(a),this;this._isInBatch=!0;try{ep(a)}catch(a){throw this.annotateError(a),a}finally{this._isInBatch=!1}return this}finally{this.state=c}}_undo({pushToRedoStack:a,toMark:b}){let c=this.state;this.state="paused";try{let{undos:c,redos:d}=this.stacks.get(),e=this.pendingDiff.clear(),f=fR(e),g=fQ(e);a&&!f&&(d=d.push({type:"diff",diff:e}));let h=!1;if(f)for(;c.head?.type==="stop";){let e=c.head;if(c=c.tail,a&&(d=d.push(e)),e.id===b){h=!0;break}}if(!h)e:for(;c.head;){let e=c.head;switch(c=c.tail,a&&(d=d.push(e)),e.type){case"diff":fT(g,[fQ(e.diff)]);break;case"stop":if(!b)break e;if(e.id===b){h=!0;break e}break;default:cf(e)}}if(!h&&b)return this;this.store.applyDiff(g,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:c,redos:d})}finally{this.state=c}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){let a=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:a,redos:b}=this.stacks.get();if(0===b.length)return this;for(;b.head?.type==="stop";)a=a.push(b.head),b=b.tail;let c=fP();for(;b.head;){let d=b.head;if(a=a.push(d),b=b.tail,"diff"===d.type)fT(c,[d.diff]);else break}this.store.applyDiff(c,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:a,redos:b})}finally{this.state=a}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(a){return a&&this._undo({pushToRedoStack:!1,toMark:a}),this}squashToMark(a){let b=this.stacks.get().undos,c=[];for(;b.head&&("stop"!==b.head.type||b.head.id!==a);)"diff"===b.head.type&&c.push(b.head.diff),b=b.tail;if(!b.head||b.head?.id!==a)return console.error("Could not find mark to squash to: ",a),this;if(0===c.length)return this;let d=fP();return fT(d,c.reverse()),this.stacks.update(({redos:a})=>({undos:b.push({type:"diff",diff:d}),redos:a})),this}_mark(a){ep(()=>{this.flushPendingDiff(),this.stacks.update(({undos:b,redos:c})=>({undos:b.push({type:"stop",id:a}),redos:c}))})}clear(){this.stacks.set({undos:nJ(),redos:nJ()}),this.pendingDiff.clear()}getMarkIdMatching(a){let b=this.stacks.get().undos;for(;b.head;){if("stop"===b.head.type&&b.head.id.includes(a))return b.head.id;b=b.tail}return null}debug(){let{undos:a,redos:b}=this.stacks.get();return{undos:a.toArray(),redos:b.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}let nH={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class nI{diff=fP();isEmptyAtom=eM("PendingDiff.isEmpty",!0);clear(){let a=this.diff;return this.diff=fP(),this.isEmptyAtom.set(!0),a}isEmpty(){return this.isEmptyAtom.get()}apply(a){fT(this.diff,[a]),this.isEmptyAtom.set(fR(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}function nJ(a){if(a){let b=nL;for(;a.length;)b=b.push(a.pop());return b}return nL}class nK{length=0;head=null;tail=this;push(a){return new nM(a,this)}toArray(){return ea}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}}let nL=new nK;class nM{constructor(a,b){this.head=a,this.tail=b,this.length=b.length+1}length;push(a){return new nM(a,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let a=this;return{next(){if(!a.length)return{value:void 0,done:!0};{let b=a.head;return a=a.tail,{value:b,done:!1}}}}}}class nN{constructor(a){this.editor=a}scribbleItems=new Map;state="paused";addScribble(a,b=function(a){return cA(void 0)}()){let c={id:b,scribble:{id:b,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...a,state:"starting"},timeoutMs:0,delayRemaining:a.delay??0,prev:null,next:null};return this.scribbleItems.set(b,c),c}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(a){let b=this.scribbleItems.get(a);if(!b)throw Error(`Scribble with id ${a} not found`);return b.delayRemaining=Math.min(b.delayRemaining,200),b.scribble.state="stopping",b}addPoint(a,b,c,d=.5){let e=this.scribbleItems.get(a);if(!e)throw Error(`Scribble with id ${a} not found`);let{prev:f}=e,g={x:b,y:c,z:d};return(!f||jA.Dist(f,g)>=1)&&(e.next=g),e}tick(a){0!==this.scribbleItems.size&&this.editor.run(()=>{this.scribbleItems.forEach(b=>{if("starting"===b.scribble.state){let{next:a,prev:c}=b;a&&a!==c&&(b.prev=a,b.scribble.points.push(a)),b.scribble.points.length>8&&(b.scribble.state="active");return}b.delayRemaining>0&&(b.delayRemaining=Math.max(0,b.delayRemaining-a)),b.timeoutMs+=a,b.timeoutMs>=16&&(b.timeoutMs=0);let{delayRemaining:c,timeoutMs:d,prev:e,next:f,scribble:g}=b;switch(g.state){case"active":f&&f!==e?(b.prev=f,g.points.push(f),0===c&&g.points.length>8&&g.points.shift()):0===d&&(g.points.length>1?g.points.shift():b.delayRemaining=g.delay);break;case"stopping":if(0===b.delayRemaining&&0===d){if(1===g.points.length)return void this.scribbleItems.delete(b.id);g.shrink&&(g.size=Math.max(1,g.size*(1-g.shrink))),g.points.shift()}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:a})=>({...a,points:[...a.points]})).slice(-5)})})}}var nO=Object.create,nP=Object.defineProperty,nQ=Object.getOwnPropertyDescriptor,nR=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),nS=a=>{throw TypeError(a)},nT=(a,b,c)=>b in a?nP(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nU=(a,b)=>nP(a,"name",{value:b,configurable:!0}),nV=["class","method","getter","setter","accessor","field","value","get","set"],nW=a=>void 0!==a&&"function"!=typeof a?nS("Function expected"):a,nX=(a,b,c,d,e)=>({kind:nV[a],name:b,metadata:d,addInitializer:a=>c._?nS("Already initialized"):e.push(nW(a||null))}),nY=(a,b)=>nT(b,nR("metadata"),a[3]),nZ=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=nV[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&nQ(l<4?e:{get[c](){return n0(this,f)},set[c](x){return n1(this,f,x)}},c));l?n&&l<4&&nU(f,(l>2?"set ":l>1?"get ":"")+c):nU(e,c);for(var t=d.length-1;t>=0;t--)j=nX(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>n_(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?n0:n2)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>n1(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?nW(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?nS("Object expected"):(nW(g=h.get)&&(s.get=g),nW(g=h.set)&&(s.set=g),nW(g=h.init)&&q.unshift(g));return l||nY(a,e),s&&nP(e,c,s),n?4^l?f:s:e},n$=(a,b,c)=>b.has(a)||nS("Cannot "+c),n_=(a,b)=>Object(b)!==b?nS('Cannot use the "in" operator on this value'):a.has(b),n0=(a,b,c)=>(n$(a,b,"read from private field"),c?c.call(a):b.get(a)),n1=(a,b,c,d)=>(n$(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),n2=(a,b,c)=>(n$(a,b,"access private method"),c);let n3=a=>Math.round(1e8*a)/1e8;function n4(a,b,c,d,e){let f=a.filter(a=>("forward"===d?a.startNode.id===b:a.endNode.id===b)&&n3(a.length)===n3(c)&&jU(a.breadthIntersection[0],a.breadthIntersection[1],e[0],e[1]));if(0===f.length)return[];let g=new Set;return f.forEach(b=>{let h="forward"===d?b.endNode.id:b.startNode.id;if(!g.has(h)){g.add(h);let i=n4(a,h,c,d,jU(b.breadthIntersection[0],b.breadthIntersection[1],e[0],e[1]));f.push(...i)}}),f}T=[eB],S=[eB],R=[eB],Q=[eB];class n5{constructor(a){this.manager=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(U,5,this),((a,b,c)=>nT(a,"symbol"!=typeof b?b+"":b,c))(this,"editor"),this.editor=a.editor}getSnapPointsCache(){let{editor:a}=this;return a.store.createComputedCache("snapPoints",b=>{let c=a.getShapePageTransform(b.id);if(!c)return;let d=a.getShapeUtil(b).getBoundsSnapGeometry(b).points??a.getShapeGeometry(b).bounds.cornersAndCenter;if(c&&d)return d.map((a,d)=>{let{x:e,y:f}=li.applyToPoint(c,a);return{x:e,y:f,id:`${b.id}:${d}`}})})}getSnapPoints(a){return this.getSnapPointsCache().get(a)??[]}getSnappablePoints(){let a=this.getSnapPointsCache(),b=this.manager.getSnappableShapes(),c=[];for(let d of b){let b=a.get(d);b&&c.push(...b)}return c}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),a=>({id:a,pageBounds:ch(this.editor.getShapePageBounds(a))}))}getVisibleGaps(){var a,b,c,d,e,f;let g,h,i=[],j=[],k=this.getSnappableGapNodes().sort((a,b)=>a.pageBounds.minX-b.pageBounds.minX);for(let d=0;d<k.length;d++){g=k[d];for(let e=d+1;e<k.length;e++)h=k[e],g.pageBounds.maxX<h.pageBounds.minX&&(a=g.pageBounds.minY,b=g.pageBounds.maxY,c=h.pageBounds.minY,a<h.pageBounds.maxY&&c<b)&&i.push({startNode:g,endNode:h,startEdge:[new jA(g.pageBounds.maxX,g.pageBounds.minY),new jA(g.pageBounds.maxX,g.pageBounds.maxY)],endEdge:[new jA(h.pageBounds.minX,h.pageBounds.minY),new jA(h.pageBounds.minX,h.pageBounds.maxY)],length:h.pageBounds.minX-g.pageBounds.maxX,breadthIntersection:jU(g.pageBounds.minY,g.pageBounds.maxY,h.pageBounds.minY,h.pageBounds.maxY)})}let l=k.sort((a,b)=>a.pageBounds.minY-b.pageBounds.minY);for(let a=0;a<l.length;a++){g=l[a];for(let b=a+1;b<l.length;b++)h=l[b],g.pageBounds.maxY<h.pageBounds.minY&&(d=g.pageBounds.minX,e=g.pageBounds.maxX,f=h.pageBounds.minX,d<h.pageBounds.maxX&&f<e)&&j.push({startNode:g,endNode:h,startEdge:[new jA(g.pageBounds.minX,g.pageBounds.maxY),new jA(g.pageBounds.maxX,g.pageBounds.maxY)],endEdge:[new jA(h.pageBounds.minX,h.pageBounds.minY),new jA(h.pageBounds.maxX,h.pageBounds.minY)],length:h.pageBounds.minY-g.pageBounds.maxY,breadthIntersection:jU(g.pageBounds.minX,g.pageBounds.maxX,h.pageBounds.minX,h.pageBounds.maxX)})}return{horizontal:i,vertical:j}}snapTranslateShapes({lockedAxis:a,initialSelectionPageBounds:b,initialSelectionSnapPoints:c,dragDelta:d}){let e=this.manager.getSnapThreshold(),f=this.getSnappablePoints(),g=b.clone().translate(d),h=c.map(({x:a,y:b},c)=>({id:"selection:"+c,x:a+d.x,y:b+d.y})),i=[],j=[],k=new jA(e,e);this.collectPointSnaps({minOffset:k,nearestSnapsX:i,nearestSnapsY:j,otherNodeSnapPoints:f,selectionSnapPoints:h}),this.collectGapSnaps({selectionPageBounds:g,nearestSnapsX:i,nearestSnapsY:j,minOffset:k});let l=new jA("x"===a?0:i[0]?.nudge??0,"y"===a?0:j[0]?.nudge??0);k.x=0,k.y=0,i.length=0,j.length=0,h.forEach(a=>{a.x+=l.x,a.y+=l.y}),g.translate(l),this.collectPointSnaps({minOffset:k,nearestSnapsX:i,nearestSnapsY:j,otherNodeSnapPoints:f,selectionSnapPoints:h}),this.collectGapSnaps({selectionPageBounds:g,nearestSnapsX:i,nearestSnapsY:j,minOffset:k});let m=this.getPointSnapLines({nearestSnapsX:i,nearestSnapsY:j}),n=this.getGapSnapLines({selectionPageBounds:g,nearestSnapsX:i,nearestSnapsY:j});return this.manager.setIndicators([...n,...m]),{nudge:l}}snapResizeShapes({initialSelectionPageBounds:a,dragDelta:b,handle:c,isAspectRatioLocked:d,isResizingFromCenter:e}){var f;let g=this.manager.getSnapThreshold(),{box:h,scaleX:i,scaleY:j}=lh.Resize(a,c,e?2*b.x:b.x,e?2*b.y:b.y,d),k=c;i<0&&(k=function(a){switch(a){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return a}}(k)),j<0&&(k=function(a){switch(a){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return a}}(k)),e&&(h.center=a.center);let l="top"===k||"bottom"===k,m="left"===k||"right"===k,n=n6(k,h),o=this.getSnappablePoints(),p=[],q=[],r=new jA(g,g);this.collectPointSnaps({minOffset:r,nearestSnapsX:p,nearestSnapsY:q,otherNodeSnapPoints:o,selectionSnapPoints:n});let s=new jA(l?0:p[0]?.nudge??0,m?0:q[0]?.nudge??0);if(d&&("top_left"===(f=k)||"top_right"===f||"bottom_right"===f||"bottom_left"===f)&&0!==s.len()){let b=p.length&&q.length?Math.abs(s.x)<Math.abs(s.y)?"x":"y":p.length?"x":"y",c=a.aspectRatio;"x"===b?(q.length=0,s.y=s.x/c,("bottom_left"===k||"top_right"===k)&&(s.y=-s.y)):(p.length=0,s.x=s.y*c,("bottom_left"===k||"top_right"===k)&&(s.x=-s.x))}let t=jA.Add(b,s),{box:u}=lh.Resize(a,c,e?2*t.x:t.x,e?2*t.y:t.y,d);e&&(u.center=a.center);let v=n6("any",u);p.length=0,q.length=0,r.x=0,r.y=0,this.collectPointSnaps({minOffset:r,nearestSnapsX:p,nearestSnapsY:q,otherNodeSnapPoints:o,selectionSnapPoints:v});let w=this.getPointSnapLines({nearestSnapsX:p,nearestSnapsY:q});return this.manager.setIndicators([...w]),{nudge:s}}collectPointSnaps({selectionSnapPoints:a,otherNodeSnapPoints:b,minOffset:c,nearestSnapsX:d,nearestSnapsY:e}){for(let f of a)for(let a of b){let b=jA.Sub(f,a),g=Math.abs(b.x),h=Math.abs(b.y);n3(g)<=n3(c.x)&&(n3(g)<n3(c.x)&&(d.length=0),d.push({type:"points",points:{thisPoint:f,otherPoint:a},nudge:a.x-f.x}),c.x=g),n3(h)<=n3(c.y)&&(n3(h)<n3(c.y)&&(e.length=0),e.push({type:"points",points:{thisPoint:f,otherPoint:a},nudge:a.y-f.y}),c.y=h)}}collectGapSnaps({selectionPageBounds:a,minOffset:b,nearestSnapsX:c,nearestSnapsY:d}){var e,f,g,h,i,j,k,l,m;let{horizontal:n,vertical:o}=this.getVisibleGaps();for(let d of n){if(e=d.breadthIntersection[0],f=d.breadthIntersection[1],g=a.minY,!(e<a.maxY)||!(g<f))continue;let h=d.startEdge[0].x+d.length/2-a.center.x;if(d.length>a.width&&n3(Math.abs(h))<=n3(b.x)){n3(Math.abs(h))<n3(b.x)&&(c.length=0),b.x=Math.abs(h);let a={type:"gap_center",gap:d,nudge:h},e=c.find(({type:a})=>"gap_center"===a),f=e&&jU(d.breadthIntersection[0],d.breadthIntersection[1],e.gap.breadthIntersection[0],e.gap.breadthIntersection[1]);e&&e.gap.length>d.length&&f?c[c.indexOf(e)]=a:e&&f||c.push(a)}let i=d.startNode.pageBounds.minX-d.length-a.maxX;n3(Math.abs(i))<=n3(b.x)&&(n3(Math.abs(i))<n3(b.x)&&(c.length=0),b.x=Math.abs(i),c.push({type:"gap_duplicate",gap:d,protrusionDirection:"left",nudge:i}));let j=d.endNode.pageBounds.maxX+d.length-a.minX;n3(Math.abs(j))<=n3(b.x)&&(n3(Math.abs(j))<n3(b.x)&&(c.length=0),b.x=Math.abs(j),c.push({type:"gap_duplicate",gap:d,protrusionDirection:"right",nudge:j}))}for(let c of o){if(h=c.breadthIntersection[0],i=c.breadthIntersection[1],j=a.minX,!(h<a.maxX)||!(j<i))continue;let e=c.startEdge[0].y+c.length/2-a.center.y;if(c.length>a.height&&n3(Math.abs(e))<=n3(b.y)){n3(Math.abs(e))<n3(b.y)&&(d.length=0),b.y=Math.abs(e);let a={type:"gap_center",gap:c,nudge:e},f=d.find(({type:a})=>"gap_center"===a),g=f&&(k=f.gap.breadthIntersection[0],l=f.gap.breadthIntersection[1],m=c.breadthIntersection[0],k<c.breadthIntersection[1]&&m<l);f&&f.gap.length>c.length&&g?d[d.indexOf(f)]=a:f&&g||d.push(a);continue}let f=c.startNode.pageBounds.minY-c.length-a.maxY;n3(Math.abs(f))<=n3(b.y)&&(n3(Math.abs(f))<n3(b.y)&&(d.length=0),b.y=Math.abs(f),d.push({type:"gap_duplicate",gap:c,protrusionDirection:"top",nudge:f}));let g=c.endNode.pageBounds.maxY+c.length-a.minY;n3(Math.abs(g))<=n3(b.y)&&(n3(Math.abs(g))<n3(b.y)&&(d.length=0),b.y=Math.abs(g),d.push({type:"gap_duplicate",gap:c,protrusionDirection:"bottom",nudge:g}))}}getPointSnapLines({nearestSnapsX:a,nearestSnapsY:b}){let c={},d={};if(a.length>0){for(let b of a)if("points"===b.type){let a=n3(b.points.otherPoint.x);c[a]||(c[a]=[]),c[a].push(b.points)}}if(b.length>0){for(let a of b)if("points"===a.type){let b=n3(a.points.otherPoint.y);d[b]||(d[b]=[]),d[b].push(a.points)}}return Object.values(c).concat(Object.values(d)).map(a=>({id:cA(void 0),type:"points",points:b4(a.map(a=>jA.From(a.otherPoint)).concat(a.map(a=>jA.From(a.thisPoint))),(a,b)=>a.equals(b))}))}getGapSnapLines({selectionPageBounds:a,nearestSnapsX:b,nearestSnapsY:c}){let{vertical:d,horizontal:e}=this.getVisibleGaps(),f={top:a.sides[0],right:a.sides[1],bottom:[a.corners[3],a.corners[2]],left:[a.corners[0],a.corners[3]]},g=[];if(b.length>0)for(let c of b){if("points"===c.type)continue;let{gap:{breadthIntersection:b,startEdge:d,startNode:h,endNode:i,length:j,endEdge:k}}=c;switch(c.type){case"gap_center":{let c=(j-a.width)/2,l=jU(b[0],b[1],a.minY,a.maxY);g.push({type:"gaps",direction:"horizontal",id:cA(void 0),gaps:[...n4(e,h.id,c,"backward",l),{startEdge:d,endEdge:f.left},{startEdge:f.right,endEdge:k},...n4(e,i.id,c,"forward",l)]});break}case"gap_duplicate":{let l=jU(b[0],b[1],a.minY,a.maxY);g.push({type:"gaps",direction:"horizontal",id:cA(void 0),gaps:"left"===c.protrusionDirection?[{startEdge:f.right,endEdge:d.map(a=>a.clone().addXY(-h.pageBounds.width,0))},{startEdge:d,endEdge:k},...n4(e,i.id,j,"forward",l)]:[...n4(e,h.id,j,"backward",l),{startEdge:d,endEdge:k},{startEdge:k.map(a=>a.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:f.left}]})}}}if(c.length>0)for(let b of c){if("points"===b.type)continue;let{gap:{breadthIntersection:c,startEdge:e,startNode:h,endNode:i,length:j,endEdge:k}}=b;switch(b.type){case"gap_center":{let i=(j-a.height)/2,l=jU(c[0],c[1],a.minX,a.maxX);g.push({type:"gaps",direction:"vertical",id:cA(void 0),gaps:[...n4(d,h.id,i,"backward",l),{startEdge:e,endEdge:f.top},{startEdge:f.bottom,endEdge:k},...n4(d,b.gap.endNode.id,i,"forward",l)]});break}case"gap_duplicate":{let l=jU(c[0],c[1],a.minX,a.maxX);g.push({type:"gaps",direction:"vertical",id:cA(void 0),gaps:"top"===b.protrusionDirection?[{startEdge:f.bottom,endEdge:e.map(a=>a.clone().addXY(0,-h.pageBounds.height))},{startEdge:e,endEdge:k},...n4(d,i.id,j,"forward",l)]:[...n4(d,h.id,j,"backward",l),{startEdge:e,endEdge:k},{startEdge:k.map(a=>a.clone().addXY(0,i.pageBounds.height)),endEdge:f.top}]})}}}g.sort((a,b)=>b.gaps.length-a.gaps.length);for(let a=g.length-1;a>0;a--){let b=g[a];for(let c=a-1;c>=0;c--){let d=g[c];if(d.direction===b.direction&&b.gaps.every(a=>d.gaps.some(b=>n3(a.startEdge[0].x)===n3(b.startEdge[0].x)&&n3(a.startEdge[0].y)===n3(b.startEdge[0].y)&&n3(a.startEdge[1].x)===n3(b.startEdge[1].x)&&n3(a.startEdge[1].y)===n3(b.startEdge[1].y))&&d.gaps.some(b=>n3(a.endEdge[0].x)===n3(b.endEdge[0].x)&&n3(a.endEdge[0].y)===n3(b.endEdge[0].y)&&n3(a.endEdge[1].x)===n3(b.endEdge[1].x)&&n3(a.endEdge[1].y)===n3(b.endEdge[1].y)))){g.splice(a,1);break}}}return g}}function n6(a,b){let{minX:c,maxX:d,minY:e,maxY:f}=b,g=[];switch(a){case"top":case"left":case"top_left":case"any":g.push({id:"top_left",handle:"top_left",x:c,y:e})}switch(a){case"top":case"right":case"top_right":case"any":g.push({id:"top_right",handle:"top_right",x:d,y:e})}switch(a){case"bottom":case"right":case"bottom_right":case"any":g.push({id:"bottom_right",handle:"bottom_right",x:d,y:f})}switch(a){case"bottom":case"left":case"bottom_left":case"any":g.push({id:"bottom_left",handle:"bottom_left",x:c,y:f})}return g}nZ(U=[,,,nO((void 0)??null)],1,"getSnapPointsCache",T,n5),nZ(U,1,"getSnappablePoints",S,n5),nZ(U,1,"getSnappableGapNodes",R,n5),nZ(U,1,"getVisibleGaps",Q,n5),nY(U,n5);var n7=Object.create,n8=Object.defineProperty,n9=Object.getOwnPropertyDescriptor,oa=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),ob=a=>{throw TypeError(a)},oc=(a,b,c)=>b in a?n8(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,od=(a,b)=>n8(a,"name",{value:b,configurable:!0}),oe=["class","method","getter","setter","accessor","field","value","get","set"],of=a=>void 0!==a&&"function"!=typeof a?ob("Function expected"):a,og=(a,b,c,d,e)=>({kind:oe[a],name:b,metadata:d,addInitializer:a=>c._?ob("Already initialized"):e.push(of(a||null))}),oh=(a,b)=>oc(b,oa("metadata"),a[3]),oi=(a,b,c)=>b.has(a)||ob("Cannot "+c),oj=(a,b)=>Object(b)!==b?ob('Cannot use the "in" operator on this value'):a.has(b),ok=(a,b,c)=>(oi(a,b,"read from private field"),c?c.call(a):b.get(a)),ol=(a,b,c,d)=>(oi(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),om=(a,b,c)=>(oi(a,b,"access private method"),c);let on=()=>null,oo=()=>[];V=[eB];class op{constructor(a){this.manager=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(W,5,this),((a,b,c)=>oc(a,"symbol"!=typeof b?b+"":b,c))(this,"editor"),this.editor=a.editor}getSnapGeometryCache(){let{editor:a}=this;return a.store.createComputedCache("handle snap geometry",b=>{let c=a.getShapeUtil(b).getHandleSnapGeometry(b),d=c.getSelfSnapOutline?c.getSelfSnapOutline.bind(c):on,e=c.getSelfSnapPoints?c.getSelfSnapPoints.bind(c):oo;return{outline:void 0===c.outline?a.getShapeGeometry(b):c.outline,points:c.points??[],getSelfSnapOutline:d,getSelfSnapPoints:e}})}*iterateSnapPointsInPageSpace(a,b){let c=this.getSnapGeometryCache().get(a)?.getSelfSnapPoints(b);if(c&&c.length){let b=ch(this.editor.getShapePageTransform(a));for(let a of c)yield b.applyToPoint(a)}for(let b of this.manager.getSnappableShapes()){if(b===a)continue;let c=this.getSnapGeometryCache().get(b)?.points;if(!c||!c.length)continue;let d=ch(this.editor.getShapePageTransform(b));for(let a of c)yield d.applyToPoint(a)}}*iterateSnapOutlines(a,b){let c=this.getSnapGeometryCache().get(a)?.getSelfSnapOutline(b);for(let b of(c&&(yield{shapeId:a,outline:c}),this.manager.getSnappableShapes())){if(b===a)continue;let c=this.getSnapGeometryCache().get(b)?.outline;c&&(yield{shapeId:b,outline:c})}}getHandleSnapPosition({currentShapeId:a,handle:b,handleInPageSpace:c}){let d=this.manager.getSnapThreshold(),e=d,f=null;for(let d of this.iterateSnapPointsInPageSpace(a,b))jA.DistMin(c,d,e)&&(e=jA.Dist(c,d),f=d);if(f)return f;let g=d,h=null;for(let{shapeId:d,outline:e}of this.iterateSnapOutlines(a,b)){let a=ch(this.editor.getShapePageTransform(d)),b=this.editor.getPointInShapeSpace(d,c),f=e.nearestPoint(b),i=a.applyToPoint(f);jA.DistMin(c,i,g)&&(g=jA.Dist(c,i),h=i)}return h||null}getHandleSnapData({handle:a,currentShapeId:b}){let c=this.manager.getSnapThreshold(),d=ch(this.editor.getShapePageTransform(b)).applyToPoint(a),e=null,f=null,g=c,h=c;for(let c of this.iterateSnapPointsInPageSpace(b,a)){let a=Math.abs(d.x-c.x),b=Math.abs(d.y-c.y);a<g&&(g=a,e=c),b<h&&(h=b,f=c)}if(!e&&!f)return null;let i=new jA(e?e.x-d.x:0,f?f.y-d.y:0),j=jA.Add(d,i),k=[];if(e){let a=new jA(e.x,j.y);k.push({id:cA(void 0),type:"points",points:[e,a]})}if(f){let a=new jA(j.x,f.y);k.push({id:cA(void 0),type:"points",points:[f,a]})}return{snaps:k,nudge:i}}snapHandle({currentShapeId:a,handle:b}){let c=ch(this.editor.getShapePageTransform(a)).applyToPoint(b),d=b.canSnap?"point":b.snapType;if("point"===d){let d=this.getHandleSnapPosition({currentShapeId:a,handle:b,handleInPageSpace:c});return d?(this.manager.setIndicators([{id:cA(void 0),type:"points",points:[d]}]),{nudge:jA.Sub(d,c)}):null}if("align"===d){let c=this.getHandleSnapData({handle:b,currentShapeId:a});return c?(this.manager.setIndicators(c.snaps),{nudge:c.nudge}):null}return null}}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=oe[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&n9(l<4?e:{get[c](){return ok(this,f)},set[c](x){return ol(this,f,x)}},c));l?n&&l<4&&od(f,(l>2?"set ":l>1?"get ":"")+c):od(e,c);for(var t=d.length-1;t>=0;t--)j=og(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>oj(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?ok:om)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>ol(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?of(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?ob("Object expected"):(of(g=h.get)&&(s.get=g),of(g=h.set)&&(s.set=g),of(g=h.init)&&q.unshift(g));return l||oh(a,e),s&&n8(e,c,s),n})(W=[,,,n7((void 0)??null)],1,"getSnapGeometryCache",V,op),oh(W,op);var oq=Object.create,or=Object.defineProperty,ot=Object.getOwnPropertyDescriptor,ou=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),ov=a=>{throw TypeError(a)},ow=(a,b,c)=>b in a?or(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,ox=(a,b)=>or(a,"name",{value:b,configurable:!0}),oy=["class","method","getter","setter","accessor","field","value","get","set"],oz=a=>void 0!==a&&"function"!=typeof a?ov("Function expected"):a,oA=(a,b,c,d,e)=>({kind:oy[a],name:b,metadata:d,addInitializer:a=>c._?ov("Already initialized"):e.push(oz(a||null))}),oB=(a,b)=>ow(b,ou("metadata"),a[3]),oC=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=oy[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&ot(l<4?e:{get[c](){return oG(this,f)},set[c](x){return oH(this,f,x)}},c));l?n&&l<4&&ox(f,(l>2?"set ":l>1?"get ":"")+c):ox(e,c);for(var t=d.length-1;t>=0;t--)j=oA(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>oF(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?oG:oI)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>oH(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?oz(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?ov("Object expected"):(oz(g=h.get)&&(s.get=g),oz(g=h.set)&&(s.set=g),oz(g=h.init)&&q.unshift(g));return l||oB(a,e),s&&or(e,c,s),n?4^l?f:s:e},oD=(a,b,c)=>ow(a,"symbol"!=typeof b?b+"":b,c),oE=(a,b,c)=>b.has(a)||ov("Cannot "+c),oF=(a,b)=>Object(b)!==b?ov('Cannot use the "in" operator on this value'):a.has(b),oG=(a,b,c)=>(oE(a,b,"read from private field"),c?c.call(a):b.get(a)),oH=(a,b,c,d)=>(oE(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),oI=(a,b,c)=>(oE(a,b,"access private method"),c);Z=[eB],Y=[eB],X=[eB];class oJ{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})($,5,this),oD(this,"shapeBounds"),oD(this,"handles"),oD(this,"_snapIndicators",eM("snapLines",void 0)),this.shapeBounds=new n5(this),this.handles=new op(this)}getIndicators(){return this._snapIndicators.get()??ea}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(a){this._snapIndicators.set(a)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){let{editor:a}=this,b=a.getViewportPageBounds(),c=a.getSelectedShapeIds(),d=new Set,e=f=>{if(hc(f)){let b=a.getShape(f);b&&a.isShapeOfType(b,"frame")&&d.add(f)}for(let g of a.getSortedChildIdsForParent(f)){if(c.includes(g))continue;let f=a.getShape(g);if(!f||!a.getShapeUtil(f).canSnap(f))continue;let h=a.getShapePageBounds(g);if(h&&b.includes(h)){if(a.isShapeOfType(f,"group")){e(g);continue}d.add(g)}}};return e(this.getCurrentCommonAncestor()??a.getCurrentPageId()),d}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}oC($=[,,,oq((void 0)??null)],1,"getSnapThreshold",Z,oJ),oC($,1,"getSnappableShapes",Y,oJ),oC($,1,"getCurrentCommonAncestor",X,oJ),oB($,oJ);let oK=/\r?\n|\r/g;function oL(a){return a.replace(oK,"\n").split("\n").map(a=>a||" ").join("\n")}let oM={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},oN=/\s/,oO=Object.freeze({"overflow-wrap":"break-word","word-break":"auto",width:null,height:null,"max-width":null,"min-width":null});class oP{constructor(a){this.editor=a;const b=document.createElement("div");for(const a of(b.classList.add("tl-text"),b.classList.add("tl-text-measure"),b.setAttribute("dir","auto"),b.tabIndex=-1,this.editor.getContainer().appendChild(b),this.elm=b,cW(oO)))b.style.setProperty(a,oO[a])}elm;setElementStyles(a){let b={};for(let c of cW(a))if("string"==typeof a[c]){let d=this.elm.style.getPropertyValue(c);if(d===a[c])continue;b[c]=d,this.elm.style.setProperty(c,a[c])}return()=>{for(let a of cW(b))this.elm.style.setProperty(a,b[a])}}dispose(){return this.elm.remove()}measureText(a,b){let c=document.createElement("div");return c.textContent=oL(a),this.measureHtml(c.innerHTML,b)}measureHtml(a,b){let{elm:c}=this,d={"font-family":b.fontFamily,"font-style":b.fontStyle,"font-weight":b.fontWeight,"font-size":b.fontSize+"px","line-height":b.lineHeight.toString(),padding:b.padding,"max-width":b.maxWidth?b.maxWidth+"px":void 0,"min-width":b.minWidth?b.minWidth+"px":void 0,"overflow-wrap":b.disableOverflowWrapBreaking?"normal":void 0,...b.otherStyles},e=this.setElementStyles(d);try{c.innerHTML=a;let d=b.measureScrollWidth?c.scrollWidth:0,e=c.getBoundingClientRect();return{x:0,y:0,w:e.width,h:e.height,scrollWidth:d}}finally{e()}}measureElementTextNodeSpans(a,{shouldTruncateToFirstLine:b=!1}={}){let c=[],d=a.getBoundingClientRect(),e=-d.left,f=-d.top,g=new Range,h=a.childNodes[0],i=0,j=null,k=null,l=0,m=0,n=!1;for(let d of a.childNodes)if(d.nodeType===Node.TEXT_NODE)for(let a of d.textContent??""){g.setStart(h,i),g.setEnd(h,i+a.length);let d=g.getClientRects(),o=d[d.length-1],p=o.top+f,q=o.left+e,r=o.right+e,s=q<m,t=oN.test(a);if(t===k&&p===l&&j)s&&(j.box.x=q),j.box.w=s?j.box.w+o.width:r-j.box.x,j.text+=a;else{if(j){if(b&&p!==l){n=!0;break}c.push(j)}j={box:{x:q,y:p,w:o.width,h:o.height},text:a},m=q}"\n"===a&&(m=0),k=t,l=p,i+=a.length}return j&&c.push(j),{spans:c,didTruncate:n}}measureTextSpans(a,b){if(""===a)return[];let{elm:c}=this,d="truncate-ellipsis"===b.overflow||"truncate-clip"===b.overflow,e=Math.ceil(b.width-2*b.padding),f={"font-family":b.fontFamily,"font-style":b.fontStyle,"font-weight":b.fontWeight,"font-size":b.fontSize+"px","line-height":b.lineHeight.toString(),width:`${e}px`,height:"min-content","text-align":oM[b.textAlign],"overflow-wrap":d?"anywhere":void 0,"word-break":d?"break-all":void 0,...b.otherStyles},g=this.setElementStyles(f);try{let f=oL(a);c.textContent=f;let{spans:g,didTruncate:h}=this.measureElementTextNodeSpans(c,{shouldTruncateToFirstLine:d});if("truncate-ellipsis"===b.overflow&&h){c.textContent="…";let a=Math.ceil(this.measureElementTextNodeSpans(c).spans[0].box.w);c.style.setProperty("width",`${e-a}px`),c.textContent=f;let d=this.measureElementTextNodeSpans(c,{shouldTruncateToFirstLine:!0}).spans,g=d[d.length-1];return d.push({text:"…",box:{x:Math.min(g.box.x+g.box.w,b.width-b.padding-a),y:g.box.y,w:a,h:g.box.h}}),d}return g}finally{g()}}}var oQ=Object.create,oR=Object.defineProperty,oS=Object.getOwnPropertyDescriptor,oT=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),oU=a=>{throw TypeError(a)},oV=(a,b,c)=>b in a?oR(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,oW=(a,b)=>oR(a,"name",{value:b,configurable:!0}),oX=["class","method","getter","setter","accessor","field","value","get","set"],oY=a=>void 0!==a&&"function"!=typeof a?oU("Function expected"):a,oZ=(a,b,c,d,e)=>({kind:oX[a],name:b,metadata:d,addInitializer:a=>c._?oU("Already initialized"):e.push(oY(a||null))}),o$=(a,b)=>oV(b,oT("metadata"),a[3]),o_=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=oX[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&oS(l<4?e:{get[c](){return o3(this,f)},set[c](x){return o4(this,f,x)}},c));l?n&&l<4&&oW(f,(l>2?"set ":l>1?"get ":"")+c):oW(e,c);for(var t=d.length-1;t>=0;t--)j=oZ(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>o2(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?o3:o5)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>o4(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?oY(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?oU("Object expected"):(oY(g=h.get)&&(s.get=g),oY(g=h.set)&&(s.set=g),oY(g=h.init)&&q.unshift(g));return l||o$(a,e),s&&oR(e,c,s),n?4^l?f:s:e},o0=(a,b,c)=>oV(a,"symbol"!=typeof b?b+"":b,c),o1=(a,b,c)=>b.has(a)||oU("Cannot "+c),o2=(a,b)=>Object(b)!==b?oU('Cannot use the "in" operator on this value'):a.has(b),o3=(a,b,c)=>(o1(a,b,"read from private field"),c?c.call(a):b.get(a)),o4=(a,b,c,d)=>(o1(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),o5=(a,b,c)=>(o1(a,b,"access private method"),c);aa=[ck],_=[ck];class o6{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(ab,5,this),o0(this,"cancelRaf"),o0(this,"isPaused",!0),o0(this,"now",0),o0(this,"prevPoint",new jA),this.editor.disposables.add(this.dispose),this.start()}start(){this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=dT(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;let a=Date.now(),b=a-this.now;this.now=a,this.updatePointerVelocity(b),this.editor.emit("frame",b),this.editor.emit("tick",b),this.cancelRaf=dT(this.tick)}dispose(){this.isPaused=!0,this.cancelRaf?.()}updatePointerVelocity(a){let{prevPoint:b,editor:{inputs:{currentScreenPoint:c,pointerVelocity:d}}}=this;if(0===a)return;let e=jA.Sub(c,b);this.prevPoint=c.clone();let f=e.len(),g=f?e.div(f):new jA(0,0),h=d.clone().lrp(g.mul(f/a),.5);.01>Math.abs(h.x)&&(h.x=0),.01>Math.abs(h.y)&&(h.y=0),d.equals(h)||(this.editor.inputs.pointerVelocity=h)}}o_(ab=[,,,oQ((void 0)??null)],1,"tick",aa,o6),o_(ab,1,"dispose",_,o6),o$(ab,o6);var o7=Object.create,o8=Object.defineProperty,o9=Object.getOwnPropertyDescriptor,pa=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),pb=a=>{throw TypeError(a)},pc=(a,b,c)=>b in a?o8(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,pd=(a,b)=>o8(a,"name",{value:b,configurable:!0}),pe=["class","method","getter","setter","accessor","field","value","get","set"],pf=a=>void 0!==a&&"function"!=typeof a?pb("Function expected"):a,pg=(a,b,c,d,e)=>({kind:pe[a],name:b,metadata:d,addInitializer:a=>c._?pb("Already initialized"):e.push(pf(a||null))}),ph=(a,b)=>pc(b,pa("metadata"),a[3]),pi=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=pe[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&o9(l<4?e:{get[c](){return pm(this,f)},set[c](x){return pn(this,f,x)}},c));l?n&&l<4&&pd(f,(l>2?"set ":l>1?"get ":"")+c):pd(e,c);for(var t=d.length-1;t>=0;t--)j=pg(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>pl(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?pm:po)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>pn(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?pf(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?pb("Object expected"):(pf(g=h.get)&&(s.get=g),pf(g=h.set)&&(s.set=g),pf(g=h.init)&&q.unshift(g));return l||ph(a,e),s&&o8(e,c,s),n?4^l?f:s:e},pj=(a,b,c)=>pc(a,"symbol"!=typeof b?b+"":b,c),pk=(a,b,c)=>b.has(a)||pb("Cannot "+c),pl=(a,b)=>Object(b)!==b?pb('Cannot use the "in" operator on this value'):a.has(b),pm=(a,b,c)=>(pk(a,b,"read from private field"),c?c.call(a):b.get(a)),pn=(a,b,c,d)=>(pk(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),po=(a,b,c)=>(pk(a,b,"access private method"),c);aq=[eB],ap=[eB],ao=[eB],an=[eB],am=[eB],al=[eB],ak=[eB],aj=[eB],ai=[eB],ah=[eB],ag=[eB],af=[eB],ae=[eB],ad=[eB],ac=[eB];class pp{constructor(a,b){this.user=a,this.inferDarkMode=b,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(ar,5,this),pj(this,"systemColorScheme",eM("systemColorScheme","light")),pj(this,"disposables",new Set);return}dispose(){this.disposables.forEach(a=>a())}updateUserPreferences(a){this.user.setUserPreferences({...this.user.userPreferences.get(),...a})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),areKeyboardShortcutsEnabled:this.getAreKeyboardShortcutsEnabled(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode(),enhancedA11yMode:this.getEnhancedA11yMode(),inputMode:this.getInputMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return"dark"===this.systemColorScheme.get();default:return!!this.inferDarkMode&&"dark"===this.systemColorScheme.get()}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??kT.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??kT.animationSpeed}getAreKeyboardShortcutsEnabled(){return this.user.userPreferences.get().areKeyboardShortcutsEnabled??kT.areKeyboardShortcutsEnabled}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name?.trim()??kT.name}getLocale(){return this.user.userPreferences.get().locale??kT.locale}getColor(){return this.user.userPreferences.get().color??kT.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??kT.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??kT.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??kT.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??kT.isPasteAtCursorMode}getEnhancedA11yMode(){return this.user.userPreferences.get().enhancedA11yMode??kT.enhancedA11yMode}getInputMode(){return this.user.userPreferences.get().inputMode??kT.inputMode}}pi(ar=[,,,o7((void 0)??null)],1,"getUserPreferences",aq,pp),pi(ar,1,"getIsDarkMode",ap,pp),pi(ar,1,"getEdgeScrollSpeed",ao,pp),pi(ar,1,"getAnimationSpeed",an,pp),pi(ar,1,"getAreKeyboardShortcutsEnabled",am,pp),pi(ar,1,"getId",al,pp),pi(ar,1,"getName",ak,pp),pi(ar,1,"getLocale",aj,pp),pi(ar,1,"getColor",ai,pp),pi(ar,1,"getIsSnapMode",ah,pp),pi(ar,1,"getIsWrapMode",ag,pp),pi(ar,1,"getIsDynamicResizeMode",af,pp),pi(ar,1,"getIsPasteAtCursorMode",ae,pp),pi(ar,1,"getEnhancedA11yMode",ad,pp),pi(ar,1,"getInputMode",ac,pp),ph(ar,pp);let pq={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},pr=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class ps{constructor(a,b){this.editor=a;const{id:c,children:d,initial:e,isLockable:f,useCoalescedEvents:g}=this.constructor;this.id=c,this._isActive=eM("toolIsActive"+this.id,!1),this._current=eM("toolState"+this.id,void 0),this._path=eB("toolPath"+this.id,()=>{let a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=b??{},b?d&&e?(this.type="branch",this.initial=e,this.children=Object.fromEntries(d().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",d&&e&&(this.initial=e,this.children=Object.fromEntries(d().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=f,this.useCoalescedEvents=g,this.performanceTracker=new dc}performanceTracker;static id;static initial;static children;static isLockable=!0;static useCoalescedEvents=!1;id;type;shapeType;initial;children;isLockable;useCoalescedEvents;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition(a,b={}){let c=a.split("."),d=this;for(let a=0;a<c.length;a++){let e=c[a],f=d.getCurrent(),g=d.children?.[e];if(!g)throw Error(`${d.id} - no child state exists with the id ${e}.`);if(f?.id!==g.id&&(f?.exit(b,e),d._current.set(g),g.enter(b,f?.id||"initial"),!g.getIsActive()))break;d=g}return this}handleEvent(a){let b=pq[a.name],c=this._current.__unsafe__getWithoutCapture();this[b]?.(a),this._isActive.__unsafe__getWithoutCapture()&&c&&c===this._current.__unsafe__getWithoutCapture()&&c.handleEvent(a)}enter(a,b){if(j7.measurePerformance.get()&&pr.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(a,b),this.children&&this.initial&&this.getIsActive()){let c=this.children[this.initial];this._current.set(c),c.enter(a,b)}}exit(a,b){j7.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(a,b),this.getIsActive()||this.getCurrent()?.exit(a,b)}_currentToolIdMask=eM("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(a){this._currentToolIdMask.set(a)}addChild(a){if("leaf"===this.type)throw Error("StateNode.addChild: cannot add child to a leaf node");this.children||(this.children={});let b=new a(this.editor,this);if(this.children[b.id])throw Error(`StateNode.addChild: a child with id '${b.id}' already exists`);return this.children[b.id]=b,this}}class pt extends ps{static id="root";static initial="";static children(){return[]}onKeyDown(a){if("KeyZ"===a.code&&!(a.shiftKey||a.ctrlKey)){let b=this.getCurrent();b&&b.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...a,onInteractionEnd:b.id})}}}var pu=Object.create,pv=Object.defineProperty,pw=Object.getOwnPropertyDescriptor,px=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),py=a=>{throw TypeError(a)},pz=(a,b,c)=>b in a?pv(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,pA=(a,b)=>pv(a,"name",{value:b,configurable:!0}),pB=["class","method","getter","setter","accessor","field","value","get","set"],pC=a=>void 0!==a&&"function"!=typeof a?py("Function expected"):a,pD=(a,b,c,d,e)=>({kind:pB[a],name:b,metadata:d,addInitializer:a=>c._?py("Already initialized"):e.push(pC(a||null))}),pE=(a,b)=>pz(b,px("metadata"),a[3]),pF=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=pB[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&pw(l<4?e:{get[c](){return pJ(this,f)},set[c](x){return pK(this,f,x)}},c));l?n&&l<4&&pA(f,(l>2?"set ":l>1?"get ":"")+c):pA(e,c);for(var t=d.length-1;t>=0;t--)j=pD(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>pI(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?pJ:pL)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>pK(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?pC(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?py("Object expected"):(pC(g=h.get)&&(s.get=g),pC(g=h.set)&&(s.set=g),pC(g=h.init)&&q.unshift(g));return l||pE(a,e),s&&pv(e,c,s),n?4^l?f:s:e},pG=(a,b,c)=>pz(a,"symbol"!=typeof b?b+"":b,c),pH=(a,b,c)=>b.has(a)||py("Cannot "+c),pI=(a,b)=>Object(b)!==b?py('Cannot use the "in" operator on this value'):a.has(b),pJ=(a,b,c)=>(pH(a,b,"read from private field"),c?c.call(a):b.get(a)),pK=(a,b,c,d)=>(pH(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),pL=(a,b,c)=>(pH(a,b,"access private method"),c);class pM extends(bz=k4.default,by=[eB],bx=[eB],bw=[eB],bv=[eB],bu=[eB],bt=[eB],bs=[eB],br=[eB],bq=[eB],bp=[eB],bo=[eB],bn=[eB],bm=[eB],bl=[eB],bk=[eB],bj=[eB],bi=[eB],bh=[eB],bg=[eB],bf=[eB],be=[eB],bd=[eB],bc=[eB],bb=[eB],ba=[eB],a9=[eB],a8=[eB],a7=[eB],a6=[eB],a5=[eB],a4=[eB],a3=[eB],a2=[eB],a1=[eB],a0=[eB],a_=[eB],a$=[eB],aZ=[eB],aY=[eB],aX=[eB],aW=[eB],aV=[eB],aU=[eB],aT=[eB],aS=[eB],aR=[eB],aQ=[eB],aP=[eB],aO=[eB],aN=[eB],aM=[eB],aL=[eB],aK=[eB],aJ=[eB],aI=[eB],aH=[eB],aG=[eB],aF=[eB],aE=[eB],aD=[eB],aC=[eB],aB=[eB],aA=[eB],az=[eB({isEqual:(a,b)=>a.equals(b)})],ay=[eB],ax=[eB],aw=[eB],av=[ck],au=[ck],at=[ck],as=[ck],bz){constructor({store:a,user:b,shapeUtils:c,bindingUtils:d,tools:e,getContainer:f,cameraOptions:g,textOptions:h,initialState:i,autoFocus:j,inferDarkMode:k,options:l,getShapeVisibility:m,fontAssetUrls:n}){var o;super(),((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(bA,5,this),pG(this,"id",cA(void 0)),pG(this,"_getShapeVisibility"),pG(this,"options"),pG(this,"contextId",cA(void 0)),pG(this,"store"),pG(this,"root"),pG(this,"disposables",new Set),pG(this,"isDisposed",!1),pG(this,"_tickManager"),pG(this,"snaps"),pG(this,"timers",m4.forContext(this.contextId)),pG(this,"user"),pG(this,"textMeasure"),pG(this,"fonts"),pG(this,"scribbles"),pG(this,"sideEffects"),pG(this,"edgeScrollManager"),pG(this,"focusManager"),pG(this,"getContainer"),pG(this,"shapeUtils"),pG(this,"styleProps"),pG(this,"bindingUtils"),pG(this,"history"),pG(this,"_shouldIgnoreShapeLock",!1),pG(this,"_crashingError",null),pG(this,"_isChangingStyleTimeout",-1),pG(this,"menus",m3.forContext(this.contextId)),pG(this,"_currentRichTextEditor",eM("rich text editor",null)),pG(this,"_textOptions"),pG(this,"_cameraOptions",eM("camera options",j2)),pG(this,"_viewportAnimation",null),pG(this,"_willSetInitialBounds",!0),pG(this,"_isLockedOnFollowingUser",eM("isLockedOnFollowingUser",!1)),pG(this,"_cameraState",eM("camera state","idle")),pG(this,"_cameraStateTimeoutRemaining",0),pG(this,"_currentPageShapeIds"),pG(this,"_shapeGeometryCaches",{}),pG(this,"_notVisibleShapes",(o=this,eB("notVisibleShapes",function(a){let b,c,d,e=(b=o.getCurrentPageShapeIds(),c=o.getViewportPageBounds(),d=new Set,b.forEach(a=>{let b=o.getShape(a);if(!b||!o.getShapeUtil(b.type).canCull(b))return;let e=o.getShapePageBounds(a);void 0!==e&&c.includes(e)||d.add(a)}),d);if(et(a)||a.size!==e.size)return e;for(let b of a)if(!e.has(b))return e;return a}))),pG(this,"_parentIdsToChildIds"),pG(this,"animatingShapes",new Map),pG(this,"externalAssetContentHandlers",{file:null,url:null}),pG(this,"temporaryAssetPreview",new Map),pG(this,"externalContentHandlers",{text:null,files:null,"file-replace":null,embed:null,"svg-text":null,url:null,tldraw:null,excalidraw:null}),pG(this,"inputs",{originPagePoint:new jA,originScreenPoint:new jA,previousPagePoint:new jA,previousScreenPoint:new jA,currentPagePoint:new jA,currentScreenPoint:new jA,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new jA}),pG(this,"_clickManager",new nA(this)),pG(this,"_prevCursor","default"),pG(this,"_shiftKeyTimeout",-1),pG(this,"_altKeyTimeout",-1),pG(this,"_ctrlKeyTimeout",-1),pG(this,"_metaKeyTimeout",-1),pG(this,"_restoreToolId","select"),pG(this,"_pinchStart",1),pG(this,"_didPinch",!1),pG(this,"_selectedShapeIdsAtPointerDown",[]),pG(this,"_longPressTimeout",-1),pG(this,"capturedPointerId",null),pG(this,"performanceTracker"),pG(this,"performanceTrackerTimeout",-1),pG(this,"handledEvents",new WeakSet),pG(this,"_pendingEventsForNextTick",[]),this._getShapeVisibility=m,this.options={...m5,...l},this.store=a,this.history=new nG({store:a,annotateError:a=>{this.annotateError(a,{origin:"history.batch",willCrashApp:!0}),this.crash(a)}}),this.snaps=new oJ(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...j2,...g}),this._textOptions=eM("text options",h??null),this.user=new pp(b??k3(),k??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=f,this.textMeasure=new oP(this),this.disposables.add(()=>this.textMeasure.dispose()),this.fonts=new nD(this,n),this._tickManager=new o6(this),this.root=new class extends pt{static initial=i??""}(this),this.root.children={},this.markEventAsHandled=this.markEventAsHandled.bind(this);const p=lH(c),q={},r={},s=new Map;for(const a of p){const b=new a(this);q[a.type]=b;const c=he(a.props??{});for(const b of(r[a.type]=c,c.keys()))if(s.has(b.id)){if(s.get(b.id)!==b)throw Error(`Multiple style props with id "${b.id}" in use. Style prop IDs must be unique.`)}else s.set(b.id,b)}this.shapeUtils=q,this.styleProps=r;const t=lf(d),u={};for(const a of t){const b=new a(this);u[a.type]=b}for(const a of(this.bindingUtils=u,[...e])){if(cU(this.root.children,a.id))throw Error(`Can't override tool with id "${a.id}"`);this.root.children[a.id]=new a(this,this.root)}this.scribbles=new nN(this);const v=(a,b)=>{let c=null,d=a.selectedShapeIds.filter(a=>!b.has(a));d.length!==a.selectedShapeIds.length&&(c||(c={...a}),c.selectedShapeIds=d);let e=a.erasingShapeIds.filter(a=>!b.has(a));e.length!==a.erasingShapeIds.length&&(c||(c={...a}),c.erasingShapeIds=e),a.hoveredShapeId&&b.has(a.hoveredShapeId)&&(c||(c={...a}),c.hoveredShapeId=null),a.editingShapeId&&b.has(a.editingShapeId)&&(c||(c={...a}),c.editingShapeId=null);let f=a.hintingShapeIds.filter(a=>!b.has(a));return f.length!==a.hintingShapeIds.length&&(c||(c={...a}),c.hintingShapeIds=f),a.focusedGroupId&&b.has(a.focusedGroupId)&&(c||(c={...a}),c.focusedGroupId=null),c};this.sideEffects=this.store.sideEffects;let w=new Map;const y=new Set,z=new Set;let A=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{for(let a of(y.clear(),z)){z.delete(a);let b=this.getShape(a);if(!b)continue;let c=this.getShapeUtil(b),d=c.onChildrenChange?.(b);d?.length&&this.updateShapes(d)}if(A.size){let a=A;for(let b of(A=new Set,a)){let a=this.getBindingUtil(b);a.onOperationComplete?.()}}if(w.size){let a=w;for(let b of(w=new Map,a.values()))this.getBindingUtil(b.binding).onAfterDelete?.(b)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(a,b)=>{for(let c of this.getBindingsInvolvingShape(b))A.add(c.type),c.fromId===b.id&&this.getBindingUtil(c).onAfterChangeFromShape?.({binding:c,shapeBefore:a,shapeAfter:b,reason:"self"}),c.toId===b.id&&this.getBindingUtil(c).onAfterChangeToShape?.({binding:c,shapeBefore:a,shapeAfter:b,reason:"self"});if(a.parentId!==b.parentId){let a=a=>{let b=this.getShape(a);if(b)for(let a of this.getBindingsInvolvingShape(b))A.add(a.type),a.fromId===b.id&&this.getBindingUtil(a).onAfterChangeFromShape?.({binding:a,shapeBefore:b,shapeAfter:b,reason:"ancestry"}),a.toId===b.id&&this.getBindingUtil(a).onAfterChangeToShape?.({binding:a,shapeBefore:b,shapeAfter:b,reason:"ancestry"})};a(b.id),this.visitDescendants(b.id,a)}if(a.parentId!==b.parentId&&hV(b.parentId)){let c=new Set([a.id]);for(let d of(this.visitDescendants(a.id,a=>{c.add(a)}),this.getPageStates())){if(d.pageId===b.parentId)continue;let a=v(d,c);a&&this.store.put([a])}}a.parentId&&hc(a.parentId)&&z.add(a.parentId),b.parentId!==a.parentId&&hc(b.parentId)&&z.add(b.parentId)},beforeDelete:a=>{if(y.has(a.id))return;a.parentId&&hc(a.parentId)&&z.add(a.parentId),y.add(a.id);let b=[];for(let c of this.getBindingsInvolvingShape(a)){A.add(c.type),b.push(c.id);let d=this.getBindingUtil(c);c.fromId===a.id?(d.onBeforeIsolateToShape?.({binding:c,removedShape:a}),d.onBeforeDeleteFromShape?.({binding:c,shape:a})):(d.onBeforeIsolateFromShape?.({binding:c,removedShape:a}),d.onBeforeDeleteToShape?.({binding:c,shape:a}))}b.length&&this.deleteBindings(b);let c=new Set([a.id]),d=b5(this.getPageStates().map(a=>v(a,c)));d.length&&this.store.put(d)}},binding:{beforeCreate:a=>{let b=this.getBindingUtil(a).onBeforeCreate?.({binding:a});return b||a},afterCreate:a=>{A.add(a.type),this.getBindingUtil(a).onAfterCreate?.({binding:a})},beforeChange:(a,b)=>{let c=this.getBindingUtil(b).onBeforeChange?.({bindingBefore:a,bindingAfter:b});return c||b},afterChange:(a,b)=>{A.add(b.type),this.getBindingUtil(b).onAfterChange?.({bindingBefore:a,bindingAfter:b})},beforeDelete:a=>{this.getBindingUtil(a).onBeforeDelete?.({binding:a})},afterDelete:a=>{this.getBindingUtil(a).onAfterDelete?.({binding:a}),A.add(a.type)}},page:{afterCreate:a=>{let b=hJ.createId(a.id),c=h2.createId(a.id);this.store.has(b)||this.store.put([hJ.create({id:b})]),this.store.has(c)||this.store.put([h2.create({id:c,pageId:a.id})])},afterDelete:(a,b)=>{if(this.getInstanceState()?.currentPageId===a.id){let c=this.getPages().find(b=>b.id!==a.id)?.id;c?this.store.put([{...this.getInstanceState(),currentPageId:c}]):"user"===b&&this.store.ensureStoreIsUsable()}let c=hJ.createId(a.id),d=h2.createId(a.id);this.store.remove([c,d])}},instance:{afterChange:(a,b,c)=>{if(!this.store.has(b.currentPageId)){let d=this.store.has(a.currentPageId)?a.currentPageId:this.getPages()[0]?.id;d?this.store.update(b.id,a=>({...a,currentPageId:d})):"user"===c&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(a,b)=>{if(a?.selectedShapeIds!==b?.selectedShapeIds){let a=b.selectedShapeIds.filter(a=>{let c=this.getShape(a)?.parentId;for(;hc(c);){if(b.selectedShapeIds.includes(c))return!1;c=this.getShape(c)?.parentId}return!0}),c=null;if(a.length>0){let b=this.findCommonAncestor(b5(a.map(a=>this.getShape(a))),a=>this.isShapeOfType(a,"group"));b&&(c=b)}else b?.focusedGroupId&&(c=b.focusedGroupId);(a.length!==b.selectedShapeIds.length||c!==b.focusedGroupId)&&this.store.put([{...b,selectedShapeIds:a,focusedGroupId:c??null}])}}}})),this._currentPageShapeIds=((a,b)=>{let c=a.query.ids("shape"),d=null;function e(){let e=b();return d=e,new Set([...c.get()].filter(b=>nh(a,e,a.get(b))))}return eB("_shapeIdsInCurrentPage",(c,f)=>{if(et(c))return e();let g=b();if(g!==d)return e();let h=a.history.getDiffSince(f);if(h===ec)return e();let i=new fH(c);for(let b of h){for(let c of Object.values(b.added))hb(c)&&nh(a,g,c)&&i.add(c.id);for(let[c,d]of Object.values(b.updated))hb(d)&&(nh(a,g,d)?i.add(d.id):i.remove(d.id));for(let a of Object.keys(b.removed))hc(a)&&i.remove(a)}let j=i.get();return j?ev(j.value,j.diff):c})})(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=(a=>{let b=a.query.ids("shape"),c=a.query.filterHistory("shape");return eB("parentsToChildrenWithIndexes",(d,e)=>{let f;if(et(d))return ng(b,a);let g=c.getDiffSince(e);if(g===ec)return ng(b,a);if(0===g.length)return d;let h=null,i=a=>{h||(h={...d}),h[a]?h[a]===d[a]&&(h[a]=[...h[a]]):h[a]=[]},j=new Set;for(let a=0,b=g.length;a<b;a++){for(let b of Object.values((f=g[a]).added))hb(b)&&(i(b.parentId),h[b.parentId].push(b.id),j.add(h[b.parentId]));for(let[a,b]of Object.values(f.updated))if(hb(b)&&hb(a)){if(a.parentId!==b.parentId)i(a.parentId),i(b.parentId),h[a.parentId].splice(h[a.parentId].indexOf(b.id),1),h[b.parentId].push(b.id),j.add(h[b.parentId]);else if(a.index!==b.index){i(b.parentId);let a=h[b.parentId].indexOf(b.id);h[b.parentId][a]=b.id,j.add(h[b.parentId])}}for(let a of Object.values(f.removed))hb(a)&&(i(a.parentId),h[a.parentId].splice(h[a.parentId].indexOf(a.id),1))}for(let b of j){let c=b5(b.map(b=>a.get(b)));c.sort(dz),b.splice(0,b.length,...c.map(a=>a.id))}return h??d})})(this.store),this.disposables.add(this.store.listen(a=>{this.emit("change",a)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),i&&void 0===this.root.children[i])throw Error(`No state found for initialState "${i}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new nB(this),this.focusManager=new nC(this,j),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new dc,this.store.props.collaboration?.mode){const a=this.store.props.collaboration.mode;this.disposables.add(eg("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:"readonly"===a.get()}])}))}}getIsShapeHiddenCache(){return this._getShapeVisibility?this.store.createComputedCache("isShapeHidden",a=>{let b=this._getShapeVisibility(a,this);return!hU.isId(a.parentId)&&this.isShapeHidden(a.parentId)?"visible"!==b:"hidden"===b}):null}isShapeHidden(a){return!!this._getShapeVisibility&&!!this.getIsShapeHiddenCache().get("string"==typeof a?a:a.id)}setTool(a,b){if(cU((b??=this.root).children,a.id))throw Error(`Can't override tool with id "${a.id}"`);b.children[a.id]=new a(this,b)}removeTool(a,b){cU((b??=this.root).children,a.id)&&delete b.children[a.id]}dispose(){this.disposables.forEach(a=>a()),this.disposables.clear(),this.store.dispose(),this.isDisposed=!0}getShapeUtil(a){let b="string"==typeof a?a:a.type,c=cV(this.shapeUtils,b);return cg(c,`No shape util found for type "${b}"`),c}hasShapeUtil(a){let b="string"==typeof a?a:a.type;return cU(this.shapeUtils,b)}getBindingUtil(a){let b="string"==typeof a?a:a.type,c=cV(this.bindingUtils,b);return cg(c,`No binding util found for type "${b}"`),c}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}markHistoryStoppingPoint(a){let b=`[${a??"stop"}]_${cA(void 0)}`;return this.history._mark(b),b}getMarkIdMatching(a){return this.history.getMarkIdMatching(a)}squashToMark(a){return this.history.squashToMark(a),this}bail(){return this.history.bail(),this}bailToMark(a){return this.history.bailToMark(a),this}run(a,b){let c=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=b?.ignoreShapeLock??c;try{this.history.batch(a,b)}finally{this._shouldIgnoreShapeLock=c}return this}annotateError(a,{origin:b,willCrashApp:c,tags:d,extras:e}){let f=this.createErrorAnnotations(b,c);return co(a,{tags:{...f.tags,...d},extras:{...f.extras,...e}}),c&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(a,b){try{let c=this.getEditingShapeId();return{tags:{origin:a,willCrashApp:b},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes().map(a=>{let{props:b,...c}=a,{text:d,richText:e,...f}=b;return{...c,props:f}}),selectionCount:this.getSelectedShapes().length,editingShape:c?this.getShape(c):void 0,inputs:this.inputs,pageState:this.getCurrentPageState(),instanceState:this.getInstanceState(),collaboratorCount:this.getCollaboratorsOnCurrentPage().length}}}catch{return{tags:{origin:a,willCrashApp:b},extras:{}}}}getCrashingError(){return this._crashingError}crash(a){return this._crashingError=a,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:a}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(a){let b=a.split(".").reverse(),c=this.root;for(;b.length>0;){let a=b.pop();if(!a)return!0;let d=c.getCurrent();if(d?.id===a){if(0===b.length)return!0;c=d;continue}break}return!1}isInAny(...a){return a.some(a=>this.isIn(a))}setCurrentTool(a,b={}){return this.root.transition(a,b),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){let a=this.getCurrentTool();return a?a.getCurrentToolIdMask()??a.id:""}getStateDescendant(a){let b=a.split(".").reverse(),c=this.root;for(;b.length>0;){let a=b.pop();if(!a)break;let d=c.children?.[a];if(!d)return;c=d}return c}getDocumentSettings(){return this.store.get(ij)}updateDocumentSettings(a){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...a}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(h$)}updateInstanceState(a,b){return this._updateInstanceState(a,{history:"ignore",...b}),void 0!==a.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===a.isChangingStyle&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},1e3))),this}_updateInstanceState(a,b){this.run(()=>{this.store.put([{...this.getInstanceState(),...a}])},b)}setCursor(a){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...a}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return h2.createId(this.getCurrentPageId())}updateCurrentPageState(a){return this._updateCurrentPageState(a),this}_updateCurrentPageState(a){this.store.update(a.id??this.getCurrentPageState().id,b=>({...b,...a}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){return b5(this.getSelectedShapeIds().map(a=>this.store.get(a)))}setSelectedShapes(a){return this.run(()=>{let b=a.map(a=>"string"==typeof a?a:a.id),{selectedShapeIds:c}=this.getCurrentPageState(),d=new Set(c);if(b.length===d.size&&b.every(a=>d.has(a)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:b}])},{history:"record-preserveRedoStack"})}isAncestorSelected(a){let b="string"==typeof a?a:a?.id??null,c=this.getShape(b);if(!c)return!1;let d=this.getSelectedShapeIds();return!!this.findShapeAncestor(c,a=>d.includes(a.id))}select(...a){let b="string"==typeof a[0]?a:a.map(a=>a.id);return this.setSelectedShapes(b),this}deselect(...a){let b="string"==typeof a[0]?a:a.map(a=>a.id),c=this.getSelectedShapeIds();return c.length>0&&b.length>0&&this.setSelectedShapes(c.filter(a=>!b.includes(a))),this}selectAll(){let a=null,b=this.getSelectedShapeIds();if(b.length>0)for(let c of b){let b=this.getShape(c);if(b){if(null===a)a=b.parentId;else if(a!==b.parentId)return this}}a||(a=this.getCurrentPageId());let c=this.getSortedChildIdsForParent(a);return c.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(c)),this}selectAdjacentShape(a){let b,c=this.getSelectedShapeIds(),d=c[0]?this.getShape(c[0])?.parentId:null,e=d&&c.every(a=>this.getShape(a)?.parentId===d)&&!hV(d),f=e?this.getCurrentPageShapes().filter(a=>a.parentId===d):this.getCurrentPageShapes().filter(a=>hV(a.parentId)),g=e?this._getShapesInReadingOrder(f):this.getCurrentPageShapesInReadingOrder(),h=1===c.length?c[0]:g.find(a=>c.includes(a.id))?.id;if("next"===a||"prev"===a){let c=g.map(a=>a.id),d=((h?c.indexOf(h):-1)+("next"===a?1:-1)+c.length)%c.length;b=c[d]}else{if(!h)return;b=this.getNearestAdjacentShape(f,h,a)}let i=this.getShape(b);i&&this._selectShapesAndZoom([i.id])}getCurrentPageShapesInReadingOrder(){let a=this.getCurrentPageShapes().filter(a=>hV(a.parentId));return this._getShapesInReadingOrder(a)}_getShapesInReadingOrder(a){let b=a.filter(a=>this.getShapeUtil(a).canTabTo(a));if(b.length<=1)return b;let c=b.map(a=>({shape:a,center:this.getShapePageBounds(a).center}));c.sort((a,b)=>a.center.y-b.center.y);let d=[];for(let a of c){let b=-1;for(let c=d.length-1;c>=0;c--){let e=d[c],f=e[e.length-1];if(100>Math.abs(a.center.y-f.center.y)){b=c;break}}-1===b?d.push([a]):d[b].push(a)}for(let a of d)a.sort((a,b)=>a.center.x-b.center.x);for(let a of d)if(!(a.length<=2))for(let b=0;b<a.length-2;b++){let c=a[b],d=a[b+1],e=a[b+2],f=jA.Dist2(c.center,d.center);jA.Dist2(c.center,e.center)<.9*f&&20>=Math.abs(jA.Angle(c.center,e.center)*(180/Math.PI))&&([a[b+1],a[b+2]]=[a[b+2],a[b+1]])}return d.flat().map(a=>a.shape)}getNearestAdjacentShape(a,b,c){let d={right:0,left:180,down:90,up:270},e=this.getShape(b);if(!e)return b;let f=a.filter(a=>this.getShapeUtil(a).canTabTo(a)&&a.id!==b);if(!f.length)return b;let g=this.getShapePageBounds(e).center,h=f.map(a=>({shape:a,center:this.getShapePageBounds(a).center})).filter(({center:a})=>{let b=a.x>g.x,d=a.y>g.y,e=a.x-g.x,f=a.y-g.y,h=Math.abs(f)<2*Math.abs(e),i=Math.abs(e)<2*Math.abs(f);return"left"===c||"right"===c?h&&("right"===c?b:!b):"up"===c||"down"===c?i&&("down"===c?d:!d):void 0});return 0===h.length?b:b7(h,({center:a})=>{let b=jA.Dist2(g,a),e=["left","right"].includes(c)?"x":"y",f=Math.abs(a[e]-g[e]),h=["left","right"].includes(c)?"y":"x";return+b+2*Math.abs(a[h]-g[h])+(b-f)*1.5+.5*Math.abs(Math.abs(jA.Angle(g,a)*(180/Math.PI))-d[c])}).shape.id}selectParentShape(){let a=this.getOnlySelectedShape();if(!a)return;let b=this.getShape(a.parentId);b&&this._selectShapesAndZoom([b.id])}selectFirstChildShape(){let a=this.getSelectedShapes();if(!a.length)return;let b=a[0],c=this.getSortedChildIdsForParent(b.id).map(a=>this.getShape(a)).filter(a=>a),d=this._getShapesInReadingOrder(c);0!==d.length&&this._selectShapesAndZoom([d[0].id])}_selectShapesAndZoom(a){this.setSelectedShapes(a),this.zoomToSelectionIfOffscreen(256,{animation:{duration:this.options.animationMediumMs},inset:0})}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){return this.getOnlySelectedShape()?.id??null}getOnlySelectedShape(){let a=this.getSelectedShapes();return 1===a.length?a[0]:null}getShapesPageBounds(a){let b=b5(a.map(a=>this.getShapePageBounds(a)));return 0===b.length?null:lh.Common(b)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getSelectionScreenBounds(){let a=this.getSelectionPageBounds();if(!a)return;let{x:b,y:c}=this.pageToScreen(a.point),d=this.getZoomLevel();return new lh(b,c,a.width*d,a.height*d)}getShapesSharedRotation(a){let b=!1,c=0;for(let d=0,e=a.length;d<e;d++){let e=this.getShapePageTransform(a[d]);if(e)if(b){if(e.rotation()!==c)return 0}else b=!0,c=e.rotation()}return c}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(a){if(0===a.length)return;let b=this.getShapesSharedRotation(a);if(0===b)return this.getShapesPageBounds(a)??void 0;if(1===a.length){let b=this.getShapeGeometry(a[0]).bounds.clone();return b.point=this.getShapePageTransform(a[0]).applyToPoint(b.point),b}let c=lh.FromPoints(a.flatMap(a=>{let b=this.getShapePageTransform(a);return b?b.applyToPoints(this.getShapeGeometry(a).bounds.corners):[]}).map(a=>a.rot(-b)));return c.point=c.point.rot(b),c}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){let a=this.getSelectionRotatedPageBounds();if(!a)return;let{x:b,y:c}=this.pageToScreen(a.point),d=this.getZoomLevel();return new lh(b,c,a.width*d,a.height*d)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){let a=this.getFocusedGroupId();return a?this.getShape(a):void 0}setFocusedGroup(a){let b="string"==typeof a?a:a?.id??null;if(null!==b){let a=this.getShape(b);if(!a)throw Error(`Editor.setFocusedGroup: Shape with id ${b} does not exist`);if(!this.isShapeOfType(a,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${a.type}`)}return b===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,a=>({...a,focusedGroupId:b}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){let a=this.getFocusedGroup();if(a){let b=this.findShapeAncestor(a,a=>this.isShapeOfType(a,"group"));this.setFocusedGroup(b?.id??null),this.select(a.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){let a=this.getEditingShapeId();return a?this.getShape(a):void 0}setEditingShape(a){let b="string"==typeof a?a:a?.id??null;this.setRichTextEditor(null);let c=this.getEditingShapeId();if(b!==c){if(b){let a=this.getShape(b);if(a&&this.getShapeUtil(a).canEdit(a))return this.run(()=>{if(this._updateCurrentPageState({editingShapeId:b}),c){let a=this.getShape(c);a&&this.getShapeUtil(a).onEditEnd?.(a)}this.getShapeUtil(a).onEditStart?.(a)},{history:"ignore"}),this}this.run(()=>{if(this._updateCurrentPageState({editingShapeId:null}),this._currentRichTextEditor.set(null),c){let a=this.getShape(c);a&&this.getShapeUtil(a).onEditEnd?.(a)}},{history:"ignore"})}return this}getRichTextEditor(){return this._currentRichTextEditor.get()}setRichTextEditor(a){return this._currentRichTextEditor.set(a),this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){let a=this.getHoveredShapeId();return a?this.getShape(a):void 0}setHoveredShape(a){let b="string"==typeof a?a:a?.id??null;return b===this.getHoveredShapeId()||this.run(()=>{this.updateCurrentPageState({hoveredShapeId:b})},{history:"ignore"}),this}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){return b5(this.getHintingShapeIds().map(a=>this.getShape(a)))}setHintingShapes(a){let b="string"==typeof a[0]?a:a.map(a=>a.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:b4(b)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){return b5(this.getErasingShapeIds().map(a=>this.getShape(a)))}setErasingShapes(a){let b="string"==typeof a[0]?a:a.map(a=>a.id);b.sort();let c=this.getErasingShapeIds();return this.run(()=>{if(b.length===c.length){for(let a=0;a<b.length;a++)if(b[a]!==c[a]){this._updateCurrentPageState({erasingShapeIds:b});break}}else this._updateCurrentPageState({erasingShapeIds:b})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(a){let b="string"==typeof a?a:a?.id??null;return b!==this.getCroppingShapeId()&&this.run(()=>{if(b){let a=this.getShape(b),c=this.getShapeUtil(a);a&&c.canCrop(a)&&this.updateCurrentPageState({croppingShapeId:b})}else this.updateCurrentPageState({croppingShapeId:null})},{history:"ignore"}),this}getTextOptions(){return ch(this._textOptions.get(),"Cannot use text without setting textOptions")}_unsafe_getCameraId(){return hJ.createId(this.getCurrentPageId())}getCamera(){let a=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){let b=this.getCameraForFollowing();if(b)return{...a,...b}}return a}_getFollowingPresence(a){let b=[this.user.getId()],c=this.getCollaborators(),d=null;for(;a&&!b.includes(a);)d=c.find(b=>b.userId===a)??null,a=d?.followingUserId??null,d&&b.push(d.userId);return d}getViewportPageBoundsForFollowing(){let a=this._getFollowingPresence(this.getInstanceState().followingUserId);if(!a?.camera||!a?.screenBounds)return null;let{w:b,h:c}=a.screenBounds,{x:d,y:e,z:f}=a.camera,g=new lh(-d,-e,b/f,c/f),h=this.getViewportScreenBounds().clone(),i=h.width/h.height;return h.width=g.width,h.height=h.width/i,h.height<g.height&&(h.height=g.height,h.width=h.height*i),h.center=g.center,h}getCameraForFollowing(){let a=this.getViewportPageBoundsForFollowing();return a?{x:-a.x,y:-a.y,z:this.getViewportScreenBounds().w/a.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){let a=this.getCameraOptions();if(!a.constraints||"default"===a.constraints.initialZoom)return 1;let{zx:b,zy:c}=pQ(this,a);switch(a.constraints.initialZoom){case"fit-min":return Math.max(b,c);case"fit-max":return Math.min(b,c);case"fit-x":return b;case"fit-y":return c;case"fit-min-100":return Math.min(1,Math.max(b,c));case"fit-max-100":return Math.min(1,Math.min(b,c));case"fit-x-100":return Math.min(1,b);case"fit-y-100":return Math.min(1,c);default:throw cf(a.constraints.initialZoom)}}getBaseZoom(){let a=this.getCameraOptions();if(!a.constraints||"default"===a.constraints.baseZoom)return 1;let{zx:b,zy:c}=pQ(this,a);switch(a.constraints.baseZoom){case"fit-min":return Math.max(b,c);case"fit-max":return Math.min(b,c);case"fit-x":return b;case"fit-y":return c;case"fit-min-100":return Math.min(1,Math.max(b,c));case"fit-max-100":return Math.min(1,Math.min(b,c));case"fit-x-100":return Math.min(1,b);case"fit-y-100":return Math.min(1,c);default:throw cf(a.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(a){let b=d$({...this._cameraOptions.__unsafe__getWithoutCapture(),...a});return b.zoomSteps?.length<1&&(b.zoomSteps=[1]),this._cameraOptions.set(b),this.setCamera(this.getCamera()),this}getConstrainedCamera(a,b){let c=this.getCamera(),{x:d,y:e,z:f=c.z}=a;if(!b?.force){let a=this.getCameraOptions(),g=a.zoomSteps[0],h=b6(a.zoomSteps),i=this.getViewportScreenBounds();if(a.constraints){let{constraints:j}=a,k=Math.min(j.padding.y,i.w/2),l=Math.min(j.padding.x,i.h/2),m=lh.From(a.constraints.bounds),n=(i.w-2*l)/m.w,o=(i.h-2*k)/m.h,p=this.getBaseZoom(),q=h*p,r=g*p;if(b?.reset&&(f=this.getInitialZoom()),f<r||f>q){let{x:a,y:b,z:g}=c,h=-a+i.w/g/2,j=-b+i.h/g/2;f=jI(f,r,q);let k=-a+i.w/f/2,l=-b+i.h/f/2;d=a+k-h,e=b+l-j}let s=l/f-m.x,t=k/f-m.y,u=(i.w-2*l)/f-m.w,v=(i.h-2*k)/f-m.h,w=s+u*j.origin.x,y=t+v*j.origin.y,z="string"==typeof j.behavior?j.behavior:j.behavior.x,A="string"==typeof j.behavior?j.behavior:j.behavior.y;if(b?.reset)d=w,e=y;else{switch(z){case"fixed":d=w;break;case"contain":d=f<n?w:jI(d,s+u,s);break;case"inside":d=f<n?jI(d,s,(i.w-l)/f-m.w):jI(d,s+u,s);break;case"outside":d=jI(d,l/f-m.w,(i.w-l)/f);break;case"free":break;default:throw cf(z)}switch(A){case"fixed":e=y;break;case"contain":e=f<o?y:jI(e,t+v,t);break;case"inside":e=f<o?jI(e,t,(i.h-k)/f-m.h):jI(e,t+v,t);break;case"outside":e=jI(e,k/f-m.h,(i.h-k)/f);break;case"free":break;default:throw cf(A)}}}else if(f>h||f<g){let{x:a,y:b,z:j}=c;f=jI(f,g,h),d=a+(-a+i.w/f/2)-(-a+i.w/j/2),e=b+(-b+i.h/f/2)-(-b+i.h/j/2)}}return{x:d,y:e,z:f}}_setCamera(a,b){let c=this.getCamera(),{x:d,y:e,z:f}=this.getConstrainedCamera(a,b);return c.x===d&&c.y===e&&c.z===f||ep(()=>{let a={...c,x:d,y:e,z:f};this.run(()=>{this.store.put([a])},{history:"ignore"});let{currentScreenPoint:g,currentPagePoint:h}=this.inputs;(g.x/f-d!==h.x||g.y/f-e!==h.y)&&this.updatePointer({immediate:b?.immediate,pointerId:-10}),this._tickCameraState()}),this}setCamera(a,b){let{isLocked:c}=this._cameraOptions.__unsafe__getWithoutCapture();if(c&&!b?.force)return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();let d=jA.Cast(a);Number.isFinite(d.x)||(d.x=0),Number.isFinite(d.y)||(d.y=0),void 0!==d.z&&Number.isFinite(d.z)||(a.z=this.getZoomLevel());let e=this.getConstrainedCamera(d,b);if(b?.animation){let{width:a,height:c}=this.getViewportScreenBounds();this._animateToViewport(new lh(-e.x,-e.y,a/e.z,c/e.z),b)}else this._setCamera(e,{...b,force:!0});return this}centerOnPoint(a,b){let{isLocked:c}=this.getCameraOptions();if(c&&!b?.force)return this;let{width:d,height:e}=this.getViewportPageBounds();return this.setCamera(new jA(-(a.x-d/2),-(a.y-e/2),this.getCamera().z),b),this}zoomToFit(a){let b=[...this.getCurrentPageShapeIds()];if(b.length<=0)return this;let c=lh.Common(b5(b.map(a=>this.getShapePageBounds(a))));return this.zoomToBounds(c,a),this}resetZoom(a=this.getViewportScreenCenter(),b){let{isLocked:c,constraints:d}=this.getCameraOptions();if(c&&!b?.force)return this;let{x:e,y:f,z:g}=this.getCamera(),{x:h,y:i}=a,j=1;if(d){let a=this.getInitialZoom();g!==a&&(j=a)}return this.setCamera(new jA(e+(h/j-h)-(h/g-h),f+(i/j-i)-(i/g-i),j),b),this}zoomIn(a=this.getViewportScreenCenter(),b){let{isLocked:c}=this.getCameraOptions();if(c&&!b?.force)return this;let{x:d,y:e,z:f}=this.getCamera(),{zoomSteps:g}=this.getCameraOptions();if(null!==g&&g.length>1){let c=this.getBaseZoom(),h=b6(g)*c;for(let a=1;a<g.length;a++){let b=g[a-1]*c,d=g[a]*c;if(!(d-f<=(d-b)/2)){h=d;break}}this.setCamera(new jA(d+(a.x/h-a.x)-(a.x/f-a.x),e+(a.y/h-a.y)-(a.y/f-a.y),h),b)}return this}zoomOut(a=this.getViewportScreenCenter(),b){let{isLocked:c}=this.getCameraOptions();if(c&&!b?.force)return this;let{zoomSteps:d}=this.getCameraOptions();if(null!==d&&d.length>1){let c=this.getBaseZoom(),{x:e,y:f,z:g}=this.getCamera(),h=d[0]*c;for(let a=d.length-1;a>0;a--){let b=d[a-1]*c,e=d[a]*c;if(!(e-g>=(e-b)/2)){h=b;break}}this.setCamera(new jA(e+(a.x/h-a.x)-(a.x/g-a.x),f+(a.y/h-a.y)-(a.y/g-a.y),h),b)}return this}zoomToSelection(a){let{isLocked:b}=this.getCameraOptions();if(b&&!a?.force)return this;let c=this.getSelectionPageBounds();return c&&this.zoomToBounds(c,{targetZoom:Math.max(1,this.getZoomLevel()),...a}),this}zoomToSelectionIfOffscreen(a=16,b){let c=this.getSelectionPageBounds(),d=this.getViewportPageBounds();if(c&&!d.contains(c)){let e=c.clone().expandBy(a/this.getZoomLevel()).expand(d),f=d.clone().translate({x:(e.center.x-d.center.x)*2,y:(e.center.y-d.center.y)*2});this.zoomToBounds(f,b)}}zoomToBounds(a,b){let c=this._cameraOptions.__unsafe__getWithoutCapture();if(c.isLocked&&!b?.force)return this;let d=this.getViewportScreenBounds(),e=b?.inset??Math.min(128,.28*d.width),f=this.getBaseZoom(),g=c.zoomSteps[0],h=b6(c.zoomSteps),i=jI(Math.min((d.width-e)/a.w,(d.height-e)/a.h),g*f,h*f);return b?.targetZoom!==void 0&&(i=Math.min(b.targetZoom,i)),this.setCamera(new jA(-a.x+(d.width-a.w*i)/2/i,-a.y+(d.height-a.h*i)/2/i,i),b),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(a){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=a;let{elapsed:b,easing:c,duration:d,start:e,end:f}=this._viewportAnimation;if(b>d){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new jA(-f.x,-f.y,this.getViewportScreenBounds().width/f.width));return}let g=c(1-(d-b)/d),h=e.minX+(f.minX-e.minX)*g,i=e.minY+(f.minY-e.minY)*g,j=e.maxX+(f.maxX-e.maxX)*g;this._setCamera(new jA(-h,-i,this.getViewportScreenBounds().width/(j-h)),{force:!0})}_animateToViewport(a,b={animation:j3}){let{animation:c,...d}=b;if(!c)return;let{duration:e=0,easing:f=jx}=c,g=this.user.getAnimationSpeed(),h=this.getViewportPageBounds();return(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),0===e||0===g)?this._setCamera(new jA(-a.x,-a.y,this.getViewportScreenBounds().width/a.width),{...d}):(this._viewportAnimation={elapsed:0,duration:e/g,easing:f,start:h.clone(),end:a.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(a={}){let{isLocked:b}=this.getCameraOptions();if(b&&!a?.force||0===this.user.getAnimationSpeed())return this;this.stopCameraAnimation();let{speed:c,friction:d=this.options.cameraSlideFriction,direction:e,speedThreshold:f=.01}=a,g=Math.min(c,1),h=()=>{this.off("tick",i),this.off("stop-camera-animation",h)};this.once("stop-camera-animation",h);let i=a=>{let{x:b,y:c,z:i}=this.getCamera(),j=jA.Mul(e,g*a/i);(g*=1-d)<f?h():this._setCamera(new jA(b+j.x,c+j.y,i))};return this.on("tick",i),this}zoomToUser(a,b={animation:{duration:500}}){let c=this.getCollaborators().find(b=>b.userId===a);if(!c)return this;let d=c.cursor;return d&&this.run(()=>{null!==this.getInstanceState().followingUserId&&this.stopFollowingUser();let e=c.currentPageId===this.getCurrentPageId();e||this.setCurrentPage(c.currentPageId),b&&b.animation&&!e&&(b.animation=void 0),this.centerOnPoint(d,b);let{highlightedUserIds:f}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...f,a]}),this.timers.setTimeout(()=>{let b=[...this.getInstanceState().highlightedUserIds],c=b.indexOf(a);c<0||(b.splice(c,1),this.updateInstanceState({highlightedUserIds:b}))},this.options.collaboratorIdleTimeoutMs)}),this}updateViewportScreenBounds(a,b=!1){if(a instanceof lh)a.width=Math.max(a.width,1),a.height=Math.max(a.height,1);else{let b=a.getBoundingClientRect();a=new lh(b.left||b.x,b.top||b.y,Math.max(b.width,1),Math.max(b.height,1))}let c=[0!==a.minY,!jK(document.body.scrollWidth,a.maxX,1),!jK(document.body.scrollHeight,a.maxY,1),0!==a.minX],{_willSetInitialBounds:d}=this;this._willSetInitialBounds=!1;let{screenBounds:e,insets:f}=this.getInstanceState();if(a.equals(e)&&c.every((a,b)=>a===f[b]))return this;if(d)this.updateInstanceState({screenBounds:a.toJson(),insets:c}),this.setCamera(this.getCamera());else if(b&&!this.getInstanceState().followingUserId){let b=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:a.toJson(),insets:c}),this.centerOnPoint(b)}else this.updateInstanceState({screenBounds:a.toJson(),insets:c}),this._setCamera(jA.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){let{x:a,y:b,w:c,h:d}=this.getInstanceState().screenBounds;return new lh(a,b,c,d)}getViewportScreenCenter(){let a=this.getViewportScreenBounds();return new jA(a.w/2,a.h/2)}getViewportPageBounds(){let{w:a,h:b}=this.getViewportScreenBounds(),{x:c,y:d,z:e}=this.getCamera();return new lh(-c,-d,a/e,b/e)}screenToPage(a){let{screenBounds:b}=this.store.unsafeGetWithoutCapture(h$),{x:c,y:d,z:e=1}=this.getCamera();return new jA((a.x-b.x)/e-c,(a.y-b.y)/e-d,a.z??.5)}pageToScreen(a){let{screenBounds:b}=this.store.unsafeGetWithoutCapture(h$),{x:c,y:d,z:e=1}=this.getCamera();return new jA((a.x+c)*e+b.x,(a.y+d)*e+b.y,a.z??.5)}pageToViewport(a){let{x:b,y:c,z:d=1}=this.getCamera();return new jA((a.x+b)*d,(a.y+c)*d,a.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){let a=this._getCollaboratorsQuery().get();return a.length?[...new Set(a.map(a=>a.userId))].sort().map(b=>b8(a.filter(a=>a.userId===b),a=>a.lastActivityTimestamp??0)):ea}getCollaboratorsOnCurrentPage(){let a=this.getCurrentPageId();return this.getCollaborators().filter(b=>b.currentPageId===a)}startFollowingUser(a){if(this.stopFollowingUser(),this.user.getId()||console.warn("You should set the userId for the current instance before following a user"),!this._getFollowingPresence(a))return this;let b=eB("latestLeaderPresence",()=>this._getFollowingPresence(a));return ep(()=>{this.updateInstanceState({followingUserId:a},{history:"ignore"});let c=eg("update current page",()=>{let a=b.get();a?a.currentPageId!==this.getCurrentPageId()&&this.getPage(a.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:a.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"}):this.stopFollowingUser()}),d=()=>{c(),this._isLockedOnFollowingUser.set(!1),this.off("frame",e),this.off("stop-following",d)},e=()=>{var a,c,d,e;if(!b.get())return void this.stopFollowingUser();if(this._isLockedOnFollowingUser.get())return;let f=this.user.getAnimationSpeed();if(0===f)return void this._isLockedOnFollowingUser.set(!0);let g=this.getViewportPageBoundsForFollowing();if(!g)return void this.stopFollowingUser();let h=this.getViewportPageBounds(),i=Math.abs(g.minX-h.minX)+Math.abs(g.maxX-h.maxX),j=Math.abs(g.minY-h.minY)+Math.abs(g.maxY-h.maxY);if(i<this.options.followChaseViewportSnap&&j<this.options.followChaseViewportSnap)return void this._isLockedOnFollowingUser.set(!0);let k=jI(.5*f,.1,.8),l=new lh((a=h.minX,a+(g.minX-a)*k),(c=h.minY,c+(g.minY-c)*k),(d=h.width,d+(g.width-d)*k),(e=h.height,e+(g.height-e)*k)),m=new jA(-l.x,-l.y,this.getViewportScreenBounds().width/l.width);this.stopCameraAnimation(),this._setCamera(m)};this.once("stop-following",d),this.addListener("frame",e),e()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(a){let b=[],c=2*this.options.maxShapesPerPage,d=this.options.maxShapesPerPage,e=this.getErasingShapeIds(),f=(g,h,i)=>{let j=this.getShape(g);if(!j)return;if(this.isShapeHidden(j)){let a=i||e.includes(g);for(let b of this.getSortedChildIdsForParent(g))f(b,h,a);return}h*=j.opacity;let k=!1,l=this.getShapeUtil(j);a&&(k=!i&&e.includes(g))&&(h*=.32),b.push({id:g,shape:j,util:l,index:c,backgroundIndex:d,opacity:h}),c+=1,d+=1;let m=this.getSortedChildIdsForParent(g);if(!m.length)return;let n=null;for(let a of(l.providesBackgroundForChildren(j)&&(n=d,d=c,c+=this.options.maxShapesPerPage),m))f(a,h,i||k);null!==n&&(d=n)};for(let b of a?[this.getCurrentPage()]:this.getPages())for(let a of this.getSortedChildIdsForParent(b.id))f(a,1,!1);return b}_decayCameraStateTimeout(a){this._cameraStateTimeoutRemaining-=a,this._cameraStateTimeoutRemaining>0||(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,"idle"===this._cameraState.__unsafe__getWithoutCapture()&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(dC)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return Array.from(this._getAllPagesQuery().get()).sort(dz)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(a){return this.store.get("string"==typeof a?a:a.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(a){let b="string"==typeof a?a:a.id,c=this.store.query.exec("shape",{parentId:{eq:b}});return this.getShapeAndDescendantIds(c.map(a=>a.id))}setCurrentPage(a){let b="string"==typeof a?a:a.id;return this.store.has(b)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:b}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(a){return this.getIsReadonly()||!this.getPage(a.id)?this:this.run(()=>this.store.update(a.id,b=>({...b,...a})))}createPage(a){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;let b=this.getPages(),c=function(a,b){let c=a,d=new Set(b);for(;d.has(c);)c=/^.*(\d+)$/.exec(c)?.[1]?c.replace(/(\d+)(?=\D?)$/,a=>(+a+1).toString()):`${c} 1`;return c}(a.name??"Page 1",b.map(a=>a.name)),d=a.index;(!d||b.some(a=>a.index===d))&&(d=dw(b[b.length-1].index));let e=hU.create({meta:{},...a,name:c,index:d});this.store.put([e])}),this}deletePage(a){let b="string"==typeof a?a:a.id;return this.run(()=>{if(this.getIsReadonly())return;let a=this.getPages();if(1===a.length)return;let c=this.getPage(b);if(!c)return;if(b===this.getCurrentPageId()){let c=a.findIndex(a=>a.id===b),d=a[c-1]??a[c+1];this.setCurrentPage(d.id)}let d=this.getSortedChildIdsForParent(c.id);this.deleteShapes(d),this.store.remove([c.id])},{ignoreShapeLock:!0}),this}duplicatePage(a,b=hU.createId()){if(this.getPages().length>=this.options.maxPages)return this;let c="string"==typeof a?a:a.id,d=this.getPage(c);if(!d)return this;let e={...this.getCamera()},f=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(d.id));return this.run(()=>{let a=this.getPages(),c=dv(d.index,a[a.indexOf(d)+1]?.index);if(this.createPage({name:d.name+" Copy",id:b,index:c}),this.setCurrentPage(b),this.setCamera(e),f)return this.putContentOntoCurrentPage(f)}),this}renamePage(a,b){let c="string"==typeof a?a:a.id;return this.getIsReadonly()||this.updatePage({id:c,name:b}),this}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(a){return this.getIsReadonly()||a.length<=0||this.run(()=>this.store.put(a),{history:"ignore"}),this}updateAssets(a){return this.getIsReadonly()||a.length<=0||this.run(()=>{this.store.put(a.map(a=>({...this.store.get(a.id),...a})))},{history:"ignore"}),this}deleteAssets(a){if(this.getIsReadonly())return this;let b="string"==typeof a[0]?a:a.map(a=>a.id);return b.length<=0||this.run(()=>{this.store.props.assets.remove?.(b),this.store.remove(b)},{history:"ignore"}),this}getAsset(a){return this.store.get("string"==typeof a?a:a.id)}async resolveAssetUrl(a,b){if(!a)return null;let c=this.getAsset(a);if(!c)return null;let{screenScale:d=1,shouldResolveToOriginal:e=!1,dpr:f=this.getInstanceState().devicePixelRatio}=b,g=Math.pow(2,Math.ceil(Math.log2(d))),h="connection"in navigator?navigator.connection.effectiveType:null;return await this.store.props.assets.resolve(c,{screenScale:d||1,steppedScreenScale:g,dpr:f,networkEffectiveType:h,shouldResolveToOriginal:e})}async uploadAsset(a,b,c){return await this.store.props.assets.upload(a,b,c)}getShapeGeometry(a,b){let c=b?.context??"none";return this._shapeGeometryCaches[c]||(this._shapeGeometryCaches[c]=this.store.createComputedCache("bounds",a=>(this.fonts.trackFontsForShape(a),this.getShapeUtil(a).getGeometry(a,b)),{areRecordsEqual:mw})),this._shapeGeometryCaches[c].get("string"==typeof a?a:a.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",a=>this.getShapeUtil(a).getHandles?.(a),{areRecordsEqual:mw})}getShapeHandles(a){return this._getShapeHandlesCache().get("string"==typeof a?a:a.id)}getShapeLocalTransform(a){let b="string"==typeof a?a:a.id,c=this.getShape(b);if(!c)throw Error("Editor.getTransform: shape not found");return li.Identity().translate(c.x,c.y).rotate(c.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",a=>{if(hV(a.parentId))return this.getShapeLocalTransform(a);let b=this._getShapePageTransformCache().get(a.parentId)??li.Identity();return li.Compose(b,this.getShapeLocalTransform(a))})}getShapeParentTransform(a){let b="string"==typeof a?a:a.id,c=this.getShape(b);return!c||hV(c.parentId)?li.Identity():this._getShapePageTransformCache().get(c.parentId)??li.Identity()}getShapePageTransform(a){let b="string"==typeof a?a:a.id;return this._getShapePageTransformCache().get(b)??li.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",a=>{let b=this.getShapePageTransform(a);if(b)return lh.FromPoints(b.applyToPoints(this.getShapeGeometry(a).boundsVertices))})}getShapePageBounds(a){return this._getShapePageBoundsCache().get("string"==typeof a?a:a.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",a=>{let b=this._getShapeMaskCache().get(a.id);if(!b)return;if(0===b.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";let c=this._getShapePageTransformCache().get(a.id);if(!c)return;let d=li.applyToPoints(li.Inverse(c),b);return`polygon(${d.map(a=>`${a.x}px ${a.y}px`).join(",")})`})}getShapeClipPath(a){return this._getShapeClipPathCache().get("string"==typeof a?a:a.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",a=>{if(hV(a.parentId))return;let b=[];for(let c of this.getShapeAncestors(a.id)){let d=this.getShapeUtil(c),e=d.getClipPath?.(c);if(!e||d.shouldClipChild?.(a)===!1)continue;let f=this.getShapePageTransform(c.id);b.push(f.applyToPoints(e))}if(0!==b.length)return b.reduce((a,b)=>{let c=lo(a,b);return c?c.map(jA.Cast):[]})})}getShapeMask(a){return this._getShapeMaskCache().get("string"==typeof a?a:a.id)}getShapeMaskedPageBounds(a){return"string"!=typeof a&&(a=a.id),this._getShapeMaskedPageBoundsCache().get(a)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",a=>{let b=this._getShapePageBoundsCache().get(a.id);if(!b)return;let c=this._getShapeMaskCache().get(a.id);if(c){if(0===c.length)return;let{corners:a}=b;if(a.every((a,b)=>a&&jA.Equals(a,c[b])))return b.clone();let d=lo(c,a);if(!d)return;return lh.FromPoints(d)}return b})}getShapeAncestors(a,b=[]){let c="string"==typeof a?a:a.id,d=this.getShape(c);if(!d)return b;let e=d.parentId;if(hV(e))return b.reverse(),b;let f=this.store.get(e);return f?(b.push(f),this.getShapeAncestors(f,b)):b}findShapeAncestor(a,b){let c="string"==typeof a?a:a.id,d=this.getShape(c);if(!d)return;let e=d.parentId;if(hV(e))return;let f=this.getShape(e);if(f)return b(f)?f:this.findShapeAncestor(f,b)}hasAncestor(a,b){let c="string"==typeof a?a:a?.id,d=c&&this.getShape(c);return!!d&&(d.parentId===b||this.hasAncestor(this.getShapeParent(d),b))}findCommonAncestor(a,b){if(0===a.length)return;let c=b5(("string"==typeof a[0]?a:a.map(a=>a.id)).map(a=>this.getShape(a)));if(1===c.length){let a=c[0].parentId;if(hV(a))return;return b?this.findShapeAncestor(c[0],b)?.id:a}let[d,...e]=c,f=this.getShapeParent(d);for(;f;){if(b&&!b(f)){f=this.getShapeParent(f);continue}if(e.every(a=>this.hasAncestor(a,f.id)))return f.id;f=this.getShapeParent(f)}}isShapeOrAncestorLocked(a){let b=a&&this.getShape(a);return void 0!==b&&(!!b.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(b)))}getNotVisibleShapes(){return this._notVisibleShapes.get()}getCulledShapes(){let a=this.getNotVisibleShapes(),b=this.getSelectedShapeIds(),c=this.getEditingShapeId(),d=new Set(a);return c&&d.delete(c),b.forEach(a=>{d.delete(a)}),d}getCurrentPageBounds(){let a;return this.getCurrentPageShapeIdsSorted().forEach(b=>{let c=this.getShapeMaskedPageBounds(b);c&&(a=a?a.expand(c):c.clone())}),a}getSelectedShapeAtPoint(a){let b=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(a=>"group"!==a.type&&b.includes(a.id)).reverse().find(b=>this.isPointInShape(b,a,{hitInside:!0,margin:0}))}getShapeAtPoint(a,b={}){let c=this.getZoomLevel(),d=this.getViewportPageBounds(),{filter:e,margin:f=0,hitLocked:g=!1,hitLabels:h=!1,hitInside:i=!1,hitFrameInside:j=!1}=b,[k,l]=Array.isArray(f)?f:[f,f],m=1/0,n=null,o=1/0,p=null,q=(b.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(b=>{if(b.isLocked&&!g||this.isShapeHidden(b)||this.isShapeOfType(b,"group"))return!1;let c=this.getShapeMask(b);return(!c||!!jW(a,c))&&(!e||!!e(b))});for(let b=q.length-1;b>=0;b--){let e,f=q[b],g=this.getShapeGeometry(f),r=g instanceof lw,s=this.getPointInShapeSpace(f,a);if(this.isShapeOfType(f,"frame")||(this.isShapeOfType(f,"note")||this.isShapeOfType(f,"arrow")||this.isShapeOfType(f,"geo")&&"none"===f.props.fill)&&this.getShapeUtil(f).getText(f)?.trim()){for(let a of g.children)if(a.isLabel&&a.isPointInBounds(s))return f}if(this.isShapeOfType(f,"frame")){let a=g.distanceToPoint(s,j);if(j?a>0&&a<=l||a<=0&&a>-k:a>0&&a<=l)return p||f;if(g.hitTestPoint(s,0,!0))return p||n||(j?f:void 0);continue}if(r){let a=1/0;for(let b of g.children){if(b.isLabel&&!h)continue;let c=b.distanceToPoint(s,i);c<a&&(a=c)}e=a}else e=0===l&&(g.bounds.w<1||g.bounds.h<1)||g.bounds.containsPoint(s,l)?g.distanceToPoint(s,i):1/0;if(g.isClosed){if(e<=l||i&&e<=0&&e>-k)if(g.isFilled||r&&g.children[0].isFilled)return p||f;else{if(this.getShapePageBounds(f).contains(d))continue;if(i?e>0&&e<=l||e<=0&&e>-k:Math.abs(e)<=Math.max(k,l))Math.abs(e)<o&&(o=Math.abs(e),p=f);else if(!p){let{area:a}=g;a<m&&(m=a,n=f)}}}else if(e<this.options.hitTestMargin/c)return f}return p||n||void 0}getShapesAtPoint(a,b={}){return this.getCurrentPageShapesSorted().filter(c=>!this.isShapeHidden(c)&&this.isPointInShape(c,a,b)).reverse()}isPointInShape(a,b,c={}){let{hitInside:d=!1,margin:e=0}=c,f="string"==typeof a?a:a.id,g=this.getShapeMask(f);return(!g||!!jW(b,g))&&this.getShapeGeometry(f).hitTestPoint(this.getPointInShapeSpace(a,b),e,d)}getPointInShapeSpace(a,b){let c="string"==typeof a?a:a.id;return this._getShapePageTransformCache().get(c).clone().invert().applyToPoint(b)}getPointInParentSpace(a,b){let c="string"==typeof a?a:a.id,d=this.getShape(c);if(!d)return new jA(0,0);if(hV(d.parentId))return jA.From(b);let e=this.getShapePageTransform(d.parentId);return e?e.clone().invert().applyToPoint(b):jA.From(b)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),a=>this.store.get(a))}getCurrentPageShapesSorted(){let a=[],b=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let c=0,d=b.length;c<d;c++)!function a(b,c,d){let e=b.getShape(c);if(!e)return;d.push(e);let f=b.getSortedChildIdsForParent(c);for(let c=0,e=f.length;c<e;c++)a(b,f[c],d)}(this,b[c],a);return a}getCurrentPageRenderingShapesSorted(){let a=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:b})=>!a.has(b)&&!this.isShapeHidden(b))}isShapeOfType(a,b){let c="string"==typeof a?this.getShape(a):a;return!!c&&c.type===b}getShape(a){let b="string"==typeof a?a:a.id;if(hc(b))return this.store.get(b)}getShapeParent(a){let b="string"==typeof a?a:a?.id;if(!b)return;let c=this.getShape(b);if(void 0!==c&&hc(c.parentId))return this.getShape(c.parentId)}getShapeNearestSibling(a,b){return b?b.parentId===a.parentId?b:this.findShapeAncestor(b,b=>b.parentId===a.parentId):void 0}isShapeInPage(a,b=this.getCurrentPageId()){let c="string"==typeof a?a:a.id,d=this.getShape(c);if(!d)return!1;let e=!1;if(d.parentId===b)e=!0;else{let a=this.getShape(d.parentId);for(;a;){if(a.parentId===b){e=!0;break}a=this.getShape(a.parentId)}}return e}getAncestorPageId(a){let b="string"==typeof a?a:a?.id,c=b&&this.getShape(b);if(c)if(hV(c.parentId))return c.parentId;else return this.getAncestorPageId(this.getShape(c.parentId))}reparentShapes(a,b,c){let d="string"==typeof a[0]?a:a.map(a=>a.id);if(0===d.length)return this;let e=[],f=hV(b)?li.Identity():this.getShapePageTransform(b),g=f.rotation(),h=[],i=b5(this.getSortedChildIdsForParent(b).map(a=>this.getShape(a)));if(c){let a=i.find(a=>a.index===c);if(a){let b=i[i.indexOf(a)+1];h=b?ds(c,b.index,d.length):dt(c,d.length)}else{let a=i.sort(dz).find(a=>a.index>c);h=a?ds(c,a.index,d.length):dt(c,d.length)}}else{let a=i.length&&i[i.length-1];h=a?dt(a.index,d.length):dy(d.length)}let j=f.clone().invert(),k=b5(d.map(a=>this.getShape(a))).sort(dz);return this.run(()=>{for(let a=0;a<k.length;a++){let c=k[a],d=this.getShapePageTransform(c);if(!d)continue;let f=d.point();if(!f)continue;let i=j.applyToPoint(f),l=d.rotation()-g;if(c.id===b)throw Error("Attempted to reparent a shape to itself!");e.push({id:c.id,type:c.type,parentId:b,x:i.x,y:i.y,rotation:l,index:h[a]})}this.updateShapes(e)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(a){let b="string"==typeof a?a:a.id,c=this._parentIdsToChildIds.get()[b];return c&&0!==c.length?dw(this.getShape(c[c.length-1]).index):dw("a0")}getSortedChildIdsForParent(a){let b="string"==typeof a?a:a.id,c=this._parentIdsToChildIds.get()[b];return c||ea}visitDescendants(a,b){for(let c of this.getSortedChildIdsForParent(a))!1!==b(c)&&this.visitDescendants(c,b);return this}getShapeAndDescendantIds(a){let b=new Set;for(let c of a.map(a=>this.getShape(a)).sort(dz))b.add(c.id),this.visitDescendants(c,a=>{b.add(a)});return b}getDraggingOverShape(a,b){let c=b5(b.map(a=>this.getShape(a))).filter(a=>!a.isLocked&&!this.isShapeHidden(a));for(let d of this.getShapesAtPoint(a,{hitInside:!0,margin:0}).filter(a=>!b.includes(a)&&!a.isLocked&&!this.isShapeHidden(a)&&!c.includes(a))){let a=this.getShapeUtil(d);if(a.onDragShapesOver||a.onDragShapesIn||a.onDragShapesOut||a.onDropShapesOver)return d}}getOutermostSelectableShape(a,b){let c="string"==typeof a?a:a.id,d=this.getShape(c),e=d,f=d,g=this.getFocusedGroup();for(;f;){if(this.isShapeOfType(f,"group")&&g?.id!==f.id&&!this.hasAncestor(g,f.id)&&(b?.(f)??!0))e=f;else if(g?.id===f.id)break;f=this.getShapeParent(f)}return e}_getBindingsIndexCache(){let a=(a=>{let{store:b}=a,c=b.query.filterHistory("binding"),d=b.query.records("binding");return eB("arrowBindingsIndex",(a,b)=>{let e;if(et(a))return nf(d);let f=c.getDiffSince(b);if(f===ec)return nf(d);function g(b){let c=(e??=new Map(a)).get(b.fromId),d=c?.filter(a=>a.id!==b.id);d?.length?e.set(b.fromId,d):e.delete(b.fromId);let f=e.get(b.toId),g=f?.filter(a=>a.id!==b.id);g?.length?e.set(b.toId,g):e.delete(b.toId)}function h(b){let c=(e??=new Map(a)).get(b);return c?c===a.get(b)&&(c=c.slice(0),e.set(b,c)):(c=[],e.set(b,c)),c}function i(a){h(a.fromId).push(a),h(a.toId).push(a)}for(let a of f){for(let b of cX(a.added))i(b);for(let[b,c]of cX(a.updated))g(b),i(c);for(let b of cX(a.removed))g(b)}return e??a})})(this);return this.store.createComputedCache("bindingsIndex",b=>a.get().get(b.id),{areRecordsEqual:()=>!0})}getBinding(a){return this.store.get(a)}getBindingsFromShape(a,b){let c="string"==typeof a?a:a.id;return this.getBindingsInvolvingShape(c).filter(a=>a.fromId===c&&a.type===b)}getBindingsToShape(a,b){let c="string"==typeof a?a:a.id;return this.getBindingsInvolvingShape(c).filter(a=>a.toId===c&&a.type===b)}getBindingsInvolvingShape(a,b){let c="string"==typeof a?a:a.id,d=this._getBindingsIndexCache().get(c)??ea;return b?d.filter(a=>a.type===b):d}createBindings(a){let b=[];for(let c of a){let a=this.getShape(c.fromId),d=this.getShape(c.toId);if(!a||!d||!this.canBindShapes({fromShape:a,toShape:d,binding:c}))continue;let e=this.getBindingUtil(c.type).getDefaultProps(),f=this.store.schema.types.binding.create({...c,id:c.id??g2(),props:{...e,...c.props}});b.push(f)}return this.store.put(b),this}createBinding(a){return this.createBindings([a])}updateBindings(a){let b=[];for(let c of a){if(!c)continue;let a=this.getBinding(c.id);if(!a)continue;let d=pO(a,c);if(d===a)continue;let e=this.getShape(d.fromId),f=this.getShape(d.toId);e&&f&&this.canBindShapes({fromShape:e,toShape:f,binding:d})&&b.push(d)}return this.store.put(b),this}updateBinding(a){return this.updateBindings([a])}deleteBindings(a,{isolateShapes:b=!1}={}){let c=a.map(a=>"string"==typeof a?a:a.id);return b?this.store.atomic(()=>{for(let a of c){let b=this.getBinding(a);if(!b)continue;let c=this.getBindingUtil(b);c.onBeforeIsolateFromShape?.({binding:b,removedShape:this.getShape(b.toId)}),c.onBeforeIsolateToShape?.({binding:b,removedShape:this.getShape(b.fromId)}),this.store.remove([a])}}):this.store.remove(c),this}deleteBinding(a,b){return this.deleteBindings([a],b)}canBindShapes({fromShape:a,toShape:b,binding:c}){let d="string"==typeof a?a:a.type,e="string"==typeof b?b:b.type,f={fromShapeType:d,toShapeType:e,bindingType:"string"==typeof c?c:c.type};return d===e?this.getShapeUtil(d).canBind(f):this.getShapeUtil(d).canBind(f)&&this.getShapeUtil(e).canBind(f)}rotateShapesBy(a,b,c){let d="string"==typeof a[0]?a:a.map(a=>a.id);if(d.length<=0)return this;let e=nd({editor:this,ids:d});return e&&ne({delta:b,snapshot:e,editor:this,stage:"one-off",centerOverride:c?.center}),this}getChangesToTranslateShape(a,b){let c=a,d=this.getShapeUtil(a),e=d.onTranslateStart?.(c);e&&(c=pO(c,e)),c=pO(c,{id:a.id,type:a.type,x:b.x,y:b.y});let f=d.onTranslate?.(a,c);f&&(c=pO(c,f));let g=d.onTranslateEnd?.(a,c);return g&&(c=pO(c,g)),c}nudgeShapes(a,b){let c="string"==typeof a[0]?a:a.map(a=>a.id);if(c.length<=0)return this;let d=[];for(let a of c){let c=this.getShape(a),e=jA.From(b),f=this.getShapeParentTransform(c);f&&e.rot(-f.rotation()),d.push(this.getChangesToTranslateShape(c,e.add(c)))}return this.updateShapes(d),this}duplicateShapes(a,b){return this.run(()=>{let c="string"==typeof a[0]?a:a.map(a=>a.id),d=this._shouldIgnoreShapeLock?c:this._getUnlockedShapeIds(c);if(d.length<=0)return this;let e=new Set(d),f=this.getShapeAndDescendantIds(d),g=[...f].reverse(),h=new Map;for(let a of f)h.set(a,hd());let{shapesToCreateWithOriginals:i,bindingsToCreate:j}=pP(this,f,a=>{let c=[];for(let b of a){let a=this.getBinding(b);if(!a)continue;let d=g2();c.push({...a,id:d,fromId:ch(h.get(a.fromId)),toId:ch(h.get(a.toId))})}let d=[];for(let a of g){let c=ch(h.get(a)),f=this.getShape(a);if(!f)continue;let g=0,i=0;if(b&&e.has(a)){let a=this.getShapeParentTransform(f),c=new jA(b.x,b.y).rot(-a.rotation());g=c.x,i=c.y}d.push({shape:{...f,id:c,x:f.x+g,y:f.y+i,index:"a1",parentId:h.get(f.parentId)??f.parentId},originalShape:f})}return{shapesToCreateWithOriginals:d,bindingsToCreate:c}});i.forEach(({shape:a,originalShape:b})=>{let c=b.parentId,d=this.getSortedChildIdsForParent(c),e=d.indexOf(b.id),f=d[e+1],g=f?this.getShape(f):void 0;a.index=dv(b.index,g?.index)});let k=i.map(({shape:a})=>a);if(!this.canCreateShapes(k))return void pN(this);if(this.createShapes(k),this.createBindings(j),this.setSelectedShapes(b5(d.map(a=>{let b=h.get(a);return b&&this.getShape(b)?b:null}))),void 0!==b){let a=this.getSelectionPageBounds(),b=this.getViewportPageBounds();a&&!b.contains(a)&&this.centerOnPoint(a.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(a,b){let c="string"==typeof a[0]?a:a.map(a=>a.id);if(0===c.length||this.getIsReadonly()||b===this.getCurrentPageId()||!this.store.has(b))return this;let d=this.getContentFromCurrentPage(c);if(!d)return this;if(this.getPageShapeIds(b).size+d.shapes.length>this.options.maxShapesPerPage)return pN(this,b),this;let e=this.getCamera().z;return this.run(()=>{this.deleteShapes(c),this.setCurrentPage(b),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(d,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:e}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(a){let b="string"==typeof a[0]?a:a.map(a=>a.id);if(this.getIsReadonly()||0===b.length)return this;let c=!0,d=!0,e=[];for(let a of b){let b=this.getShape(a);b&&(e.push(b),b.isLocked?d=!1:c=!1)}return this.run(()=>{d?(this.updateShapes(e.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):c?this.updateShapes(e.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(e.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(a){let b=nb(this,"toBack","string"==typeof a[0]?a:a.map(a=>a.id),{considerAllShapes:!0});return b&&this.updateShapes(b),this}sendBackward(a,b={}){let c=nb(this,"backward","string"==typeof a[0]?a:a.map(a=>a.id),b);return c&&this.updateShapes(c),this}bringForward(a,b={}){let c=nb(this,"forward","string"==typeof a[0]?a:a.map(a=>a.id),b);return c&&this.updateShapes(c),this}bringToFront(a){let b=nb(this,"toFront","string"==typeof a[0]?a:a.map(a=>a.id));return b&&this.updateShapes(b),this}collectShapesViaArrowBindings(a){let{initialShapes:b,resultShapes:c,resultBounds:d,bindings:e,visited:f}=a;for(let g of e)for(let e of[g.fromId,g.toId])if(!f.has(e)){let g=b.find(a=>a.id===e);if(g&&!f.has(g.id)){f.add(g.id);let b=this.getShapePageBounds(g);if(!b)continue;c.push(g),d.push(b),this.collectShapesViaArrowBindings({...a,bindings:this.getBindingsInvolvingShape(g,"arrow")})}}}flipShapes(a,b){if(this.getIsReadonly())return this;let c=b5(("string"==typeof a[0]?a:a.map(a=>a.id)).map(a=>this.getShape(a)));for(let a of c)if(this.isShapeOfType(a,"group")){let b=b5(this.getSortedChildIdsForParent(a.id).map(a=>this.getShape(a)));c.push(...b)}let d=[],e=[];for(let a of c){let b=this.getShapeUtil(a);if(!b.canBeLaidOut(a,{type:"flip",shapes:c}))continue;let f=this.getShapePageBounds(a),g=this.getShapeGeometry(a).bounds,h=this.getShapePageTransform(a.id);f&&g&&h&&(d.push({shape:a,localBounds:g,pageTransform:h,isAspectRatioLocked:b.isAspectRatioLocked(a)}),e.push(f))}if(!d.length)return this;let f=lh.Common(e).center;return this.run(()=>{for(let{shape:a,localBounds:c,pageTransform:e,isAspectRatioLocked:g}of d)this.resizeShape(a.id,{x:"horizontal"===b?-1:1,y:"vertical"===b?-1:1},{initialBounds:c,initialPageTransform:e,initialShape:a,isAspectRatioLocked:g,mode:"scale_shape",scaleOrigin:f,scaleAxisRotation:0})}),this}stackShapes(a,b,c){let d,e,f,g,h=c??this.options.adjacentShapeMargin,i="string"==typeof a[0]?a:a.map(a=>a.id);if(this.getIsReadonly())return this;let j=b5(i.map(a=>this.getShape(a))),k=[],l=[],m=new Set;for(let a of j){if(m.has(a.id))continue;m.add(a.id);let b=this.getShapePageBounds(a);if(!b||!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"stack",shapes:j}))continue;let c=[a],d=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:j,resultShapes:c,resultBounds:d,visited:m});let e=lh.Common(d);e&&(k.push({shapes:c,pageBounds:e}),l.push(e))}let n=k.length;if(0===h&&n<3||n<2)return this;"horizontal"===b?(d="x",e="minX",f="maxX",g="width"):(d="y",e="minY",f="maxY",g="height");let o=0;if(0===h){let a={};k.sort((a,b)=>a.pageBounds[e]-b.pageBounds[e]);for(let b=0;b<n-1;b++){let c=k[b],d=k[b+1].pageBounds[e]-c.pageBounds[f];a[d]||(a[d]=0),a[d]++}let b=1;for(let[c,d]of Object.entries(a))d>b&&(b=d,o=parseFloat(c));if(1===b){let b=0;for(let[c,d]of Object.entries(a))o+=parseFloat(c)*d,b+=d;o/=b}}else o=h;let p=[],q=k[0].pageBounds[f];for(let a=1;a<k.length;a++){let{shapes:b,pageBounds:c}=k[a],e=new jA;for(let a of(e[d]=q+o-c[d],b)){let b=e.clone(),c=this.getShapeParent(a);if(c){let a=this.getShapePageTransform(c);a&&b.rot(-a.rotation())}b.add(a),p.push(this.getChangesToTranslateShape(a,b))}q+=c[g]+o}return this.updateShapes(p),this}packShapes(a,b){let c,d;if(this.getIsReadonly())return this;let e=b??this.options.adjacentShapeMargin,f=b5(("string"==typeof a[0]?a:a.map(a=>a.id)).map(a=>this.getShape(a))),g=[],h=[],i=new Set;for(let a of f){if(i.has(a.id))continue;i.add(a.id);let b=this.getShapePageBounds(a);if(!b||!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"pack",shapes:f}))continue;let c=[a],d=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:f,resultShapes:c,resultBounds:d,visited:i});let e=lh.Common(d);e&&(g.push({shapes:c,pageBounds:e,nextPageBounds:e.clone()}),h.push(e))}if(g.length<2)return this;let j=0;for(let{pageBounds:a}of g)j+=a.width*a.height;let k=lh.Common(h),l=k.width;g.sort((a,b)=>a.pageBounds.width-b.pageBounds.width).sort((a,b)=>a.pageBounds.height-b.pageBounds.height);let m=Math.max(Math.ceil(Math.sqrt(j/.95)),l),n=[new lh(k.x,k.y,m,1/0)],o=0,p=0;for(let{nextPageBounds:a}of g)for(let b=n.length-1;b>=0;b--)if(c=n[b],!(a.width>c.width)&&!(a.height>c.height)){a.x=c.x,a.y=c.y,p=Math.max(p,a.maxY),o=Math.max(o,a.maxX),a.width===c.width&&a.height===c.height?(d=n.pop(),b<n.length&&(n[b]=d)):a.height===c.height?(c.x+=a.width+e,c.width-=a.width+e):(a.width===c.width||n.push(new lh(c.x+(a.width+e),c.y,c.width-(a.width+e),a.height)),c.y+=a.height+e,c.height-=a.height+e);break}let q=lh.Common(g.map(a=>a.nextPageBounds)),r=jA.Sub(k.center,q.center),s=[];for(let{shapes:a,pageBounds:b,nextPageBounds:c}of g){let d=jA.Sub(c.point,b.point).add(r);for(let b of a){let a=d.clone();if(this.getShapeParent(b)){let c=this.getShapeParentTransform(b);c&&a.rot(-c.rotation())}a.add(b),s.push(this.getChangesToTranslateShape(b,a))}}return s.length&&this.updateShapes(s),this}alignShapes(a,b){if(this.getIsReadonly())return this;let c=b5(("string"==typeof a[0]?a:a.map(a=>a.id)).map(a=>this.getShape(a))),d=[],e=[],f=new Set;for(let a of c){if(f.has(a.id))continue;f.add(a.id);let b=this.getShapePageBounds(a);if(!b||!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"align",shapes:c}))continue;let g=[a],h=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:c,resultShapes:g,resultBounds:h,visited:f});let i=lh.Common(h);i&&(d.push({shapes:g,pageBounds:i}),e.push(i))}if(d.length<2)return this;let g=lh.Common(e),h=[];return d.forEach(({shapes:a,pageBounds:c})=>{let d=new jA;switch(b){case"top":d.y=g.minY-c.minY;break;case"center-vertical":d.y=g.midY-c.minY-c.height/2;break;case"bottom":d.y=g.maxY-c.minY-c.height;break;case"left":d.x=g.minX-c.minX;break;case"center-horizontal":d.x=g.midX-c.minX-c.width/2;break;case"right":d.x=g.maxX-c.minX-c.width}for(let b of a){let a=d.clone(),c=this.getShapeParent(b);if(c){let b=this.getShapePageTransform(c);b&&a.rot(-b.rotation())}a.add(b),h.push(this.getChangesToTranslateShape(b,a))}}),this.updateShapes(h),this}distributeShapes(a,b){let c,d,e,f;if(this.getIsReadonly())return this;let g="string"==typeof a[0]?a:a.map(a=>a.id),h=b5(g.map(a=>this.getShape(a))),i=[],j=[],k=new Set;for(let a of h){if(k.has(a.id))continue;k.add(a.id);let b=this.getShapePageBounds(a);if(!b||!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"distribute",shapes:h}))continue;let c=[a],d=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:h,resultShapes:c,resultBounds:d,visited:k});let e=lh.Common(d);e&&(i.push({shapes:c,pageBounds:e}),j.push(e))}if(i.length<3)return this;"horizontal"===b?(c="x",d="minX",e="maxX",f="width"):(c="y",d="minY",e="maxY",f="height");let l=[],m=i.sort((a,b)=>a.pageBounds[d]-b.pageBounds[d])[0],n=i.sort((a,b)=>b.pageBounds[e]-a.pageBounds[e])[0];if(m===n){let a=new Set(m.shapes.map(a=>a.id));return this.distributeShapes(g.filter(b=>!a.has(b)),b)}let o=i.filter(a=>a!==m&&a!==n).sort((a,b)=>a.pageBounds[d]===b.pageBounds[d]?a.shapes[0].id<b.shapes[0].id?-1:1:a.pageBounds[d]-b.pageBounds[d]),p=m.pageBounds[e],q=(n.pageBounds[d]-p-o.reduce((a,b)=>a+b.pageBounds[f],0))/(o.length+1);for(let a=p+q,b=0;b<o.length;b++){let{shapes:d,pageBounds:g}=o[b],h=new jA;for(let b of(h[c]=a-g[c],a+g[f]>n.pageBounds[e]-1&&(h[c]=n.pageBounds[e]-g[e]-1),d)){let a=h.clone(),c=this.getShapeParent(b);if(c){let b=this.getShapePageTransform(c);b&&a.rot(-b.rotation())}a.add(b),l.push(this.getChangesToTranslateShape(b,a))}a+=g[f]+q}return this.updateShapes(l),this}stretchShapes(a,b){let c,d,e,f="string"==typeof a[0]?a:a.map(a=>a.id);if(this.getIsReadonly())return this;let g=b5(f.map(a=>this.getShape(a))).filter(a=>this.getShapePageTransform(a)?.rotation()%(jE/2)==0),h=[],i=[],j=new Set;for(let a of g){if(j.has(a.id))continue;j.add(a.id);let b=this.getShapePageBounds(a);if(!b)continue;let c=[a],d=[b];if(!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"stretch"}))continue;this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:g,resultShapes:c,resultBounds:d,visited:j});let e=lh.Common(d);e&&(h.push({shapes:c,pageBounds:e}),i.push(e))}if(h.length<2)return this;let k=lh.Common(i);return"horizontal"===b?(c="x",d="minX",e="width"):(c="y",d="minY",e="height"),this.run(()=>{h.forEach(({shapes:a,pageBounds:b})=>{let f=new jA;f[c]=k[d]-b[d];let g=b.center.clone();g[c]=k[d];let h=new jA(1,1);for(let d of(h[c]=k[e]/b[e],a)){let a=f.clone(),b=this.getShapeParentTransform(d);b&&f.rot(-b.rotation()),a.add(d);let c=this.getChangesToTranslateShape(d,a);this.updateShape(c),this.resizeShape(d.id,h,{initialBounds:this.getShapeGeometry(d).bounds,scaleOrigin:g,isAspectRatioLocked:this.getShapeUtil(d).isAspectRatioLocked(d),scaleAxisRotation:0})}})}),this}resizeShape(a,b,c={}){let d="string"==typeof a?a:a.id;if(this.getIsReadonly())return this;Number.isFinite(b.x)||(b=new jA(1,b.y)),Number.isFinite(b.y)||(b=new jA(b.x,1));let e=c.initialShape??this.getShape(d);if(!e)return this;let f=c.scaleOrigin??this.getShapePageBounds(d)?.center;if(!f)return this;let g=c.initialPageTransform?li.Cast(c.initialPageTransform):this.getShapePageTransform(d);if(!g)return this;let h=g.rotation();if(null==h)return this;let i=c.scaleAxisRotation??h,j=c.initialBounds??this.getShapeGeometry(d).bounds;if(!j)return this;let k=c.isAspectRatioLocked??this.getShapeUtil(e).isAspectRatioLocked(e);if(!jR(h,i))return this._resizeUnalignedShape(d,b,{...c,initialBounds:j,scaleOrigin:f,scaleAxisRotation:i,initialPageTransform:g,isAspectRatioLocked:k,initialShape:e});let l=this.getShapeUtil(e);k&&(b=Math.abs(b.x)>Math.abs(b.y)?new jA(b.x,Math.sign(b.y)*Math.abs(b.x)):new jA(Math.sign(b.x)*Math.abs(b.y),b.y));let m=!1;if(l.onResize&&l.canResize(e)){let a=this._scalePagePoint(li.applyToPoint(g,new jA(0,0)),f,b,i),k=this.getPointInParentSpace(e.id,a),n=new jA(b.x,b.y),o=jK((h-i)%Math.PI,0);n.x=o?b.x:b.y,n.y=o?b.y:b.x;let p=li.applyToPoint(g,new jA),{x:q,y:r}=this.getPointInParentSpace(e.id,p),s=e;c.skipStartAndEndCallbacks||(s=pO(e,l.onResizeStart?.(e)??void 0));let t=l.onResize({...e,x:q,y:r},{newPoint:k,handle:c.dragHandle??"bottom_right",mode:c.mode??"scale_shape",scaleX:n.x,scaleY:n.y,initialBounds:j,initialShape:e});t&&(m=!0),s=pO(s,{id:d,type:e.type,x:k.x,y:k.y,...t}),c.skipStartAndEndCallbacks||(s=pO(s,l.onResizeEnd?.(e,s)??void 0)),this.updateShapes([s])}if(!m){let a=li.applyToPoint(g,j.center),c=this._scalePagePoint(a,f,b,i),h=this.getPointInParentSpace(e.id,a),k=this.getPointInParentSpace(e.id,c),l=jA.Sub(k,h);this.updateShapes([{id:d,type:e.type,x:e.x+l.x,y:e.y+l.y}])}return this}_scalePagePoint(a,b,c,d){let e=jA.RotWith(a,b,-d).sub(b),f=jA.MulV(e,c);return jA.Add(f,b).rotWith(b,d)}_resizeUnalignedShape(a,b,c){let{type:d}=c.initialShape,e=new jA(b.x,b.y);if(Math.abs(b.x)>Math.abs(b.y)?e.x=Math.sign(b.x)*Math.abs(b.y):e.y=Math.sign(b.y)*Math.abs(b.x),this.resizeShape(a,e,{initialShape:c.initialShape,initialBounds:c.initialBounds,isAspectRatioLocked:c.isAspectRatioLocked}),Math.sign(b.x)*Math.sign(b.y)<0){let{rotation:b}=li.Decompose(c.initialPageTransform);b-=2*b,this.updateShapes([{id:a,type:d,rotation:b}])}let f=li.applyToPoint(c.initialPageTransform,c.initialBounds.center),g=this._scalePagePoint(f,c.scaleOrigin,b,c.scaleAxisRotation),h=this.getShapePageBounds(a),i=this.getShapePageTransform(a),j=h.center,k=i.point();if(!j||!k)return this;let l=jA.Sub(g,j),m=jA.Add(k,l),{x:n,y:o}=this.getPointInParentSpace(a,m);return this.updateShapes([{id:a,type:d,x:n,y:o}]),this}getInitialMetaForShape(a){return{}}canCreateShape(a){return this.canCreateShapes([a])}canCreateShapes(a){return a.length+this.getCurrentPageShapeIds().size<=this.options.maxShapesPerPage}createShape(a){return this.createShapes([a]),this}createShapes(a){if(!Array.isArray(a))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly()||a.length<=0)return this;let b=this.getCurrentPageShapeIds();if(a.length+b.size>this.options.maxShapesPerPage)return pN(this),this;let c=this.getFocusedGroupId();return this.run(()=>{let b=this.getCurrentPageShapesSorted(),d=a.map(d=>{if(d.id||(d={id:hd(),...d}),!d.parentId||!(this.store.has(d.parentId)||a.some(a=>a.id===d.parentId))){let a=this.getFocusedGroupId();if(void 0!==d.x&&void 0!==d.y)for(let c=b.length-1;c>=0;c--){let e=b[c];if(this.getShapeUtil(e).canReceiveNewChildrenOfType(e,d.type)&&!this.isShapeHidden(e)&&this.isPointInShape(e,{x:d.x??0,y:d.y??0},{margin:0,hitInside:!0})){a=e.id;break}}let e=d.parentId;if(a===d.id&&(a=c),a!==e&&((d={...d}).parentId=a,hc(a))){let b=this.getPointInShapeSpace(this.getShape(a),{x:d.x??0,y:d.y??0});d.x=b.x,d.y=b.y,d.rotation=-this.getShapePageTransform(a).rotation()+(d.rotation??0)}}return d}),e=new Map,f=[],{opacityForNextShape:g}=this.getInstanceState();for(let a of d){let b=this.getShapeUtil(a),d=a.index;if(!d){let b=a.parentId??c;e.has(b)||e.set(b,this.getHighestIndexForParent(b)),d=e.get(b),e.set(b,dw(d))}let h=b.getDefaultProps();for(let[b,c]of this.styleProps[a.type])h[c]=this.getStyleForNextShape(b);let i=this.store.schema.types.shape.create({...a,index:d,opacity:a.opacity??g,parentId:a.parentId??c,props:"props"in a?{...h,...a.props}:h});if(void 0===i.index)throw Error("no index!");let j=this.getShapeUtil(i).onBeforeCreate?.(i);j&&(i=j),f.push(i)}f.forEach(a=>{a.meta={...this.getInitialMetaForShape(a),...a.meta}}),this.emit("created-shapes",f),this.emit("edit"),this.store.put(f)}),this}animateShape(a,b={animation:j3}){return this.animateShapes([a],b)}animateShapes(a,b={animation:j3}){let c,d,e;if(!b.animation)return this;let{duration:f=500,easing:g=jt}=b.animation,h=cA(void 0),i=f,j=[];for(let b=0,c=a.length;b<c;b++){if(!(d=a[b]))continue;let c=this.getShape(d.id);c&&(e={start:d$(c),end:pO(d$(c),d)},j.push(e),this.animatingShapes.set(c.id,h))}let k=b=>{if((i-=b)<0){let{animatingShapes:b}=this,c=a.filter(a=>a&&b.get(a.id)===h);c.length&&this.updateShapes(c),this.off("tick",k);return}c=g(1-i/f);let{animatingShapes:d}=this,e=[];for(let a=0,b=j.length;a<b;a++){let{start:b,end:f}=j[a];d.get(b.id)===h&&e.push({...f,x:b.x+(f.x-b.x)*c,y:b.y+(f.y-b.y)*c,opacity:b.opacity+(f.opacity-b.opacity)*c,rotation:b.rotation+(f.rotation-b.rotation)*c,props:this.getShapeUtil(f).getInterpolatedProps?.(b,f,c)??f.props})}this._updateShapes(e)};return this.on("tick",k),this}groupShapes(a,b={}){let{groupId:c=hd(),select:d=!0}=b;if(!Array.isArray(a))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;let e="string"==typeof a[0]?a:a.map(a=>a.id);if(e.length<=1)return this;let f=b5((this._shouldIgnoreShapeLock?e:this._getUnlockedShapeIds(e)).map(a=>this.getShape(a))),g=f.sort(dz).map(a=>a.id),{x:h,y:i}=lh.Common(b5(f.map(a=>this.getShapePageBounds(a)))).point,j=this.findCommonAncestor(f)??this.getCurrentPageId();if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();let k=f.filter(a=>a.parentId===j).sort(dz),l=k[k.length-1]?.index;return this.run(()=>{this.createShapes([{id:c,type:"group",parentId:j,index:l,x:h,y:i,opacity:1,props:{}}]),this.reparentShapes(g,c),d&&this.select(c)}),this}ungroupShapes(a,b={}){if(this.getIsReadonly())return this;let{select:c=!0}=b,d="string"==typeof a[0]?a:a.map(a=>a.id),e=b5((this._shouldIgnoreShapeLock?d:this._getUnlockedShapeIds(d)).map(a=>this.getShape(a)));if(0===e.length||"select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();let f=new Set,g=[];return e.forEach(a=>{this.isShapeOfType(a,"group")?g.push(a):f.add(a.id)}),0===g.length||this.run(()=>{let a;for(let b=0,c=g.length;b<c;b++){a=g[b];let c=this.getSortedChildIdsForParent(a.id);for(let a=0,b=c.length;a<b;a++)f.add(c[a]);this.reparentShapes(c,a.parentId,a.index)}this.deleteShapes(g.map(a=>a.id)),c&&this.select(...f)}),this}updateShape(a){return this.updateShapes([a]),this}updateShapes(a){let b=Array(a.length);for(let c=0,d=a.length;c<d;c++){let d=a[c];if(!d)continue;let e=this.getShape(d.id);if(e){if(!this._shouldIgnoreShapeLock){if(e.isLocked){if(!(Object.hasOwn(d,"isLocked")&&!d.isLocked))continue}else if(this.isShapeOrAncestorLocked(e))continue}this.animatingShapes.delete(d.id),b.push(d)}}return this._updateShapes(b),this}_updateShapes(a){this.getIsReadonly()||this.run(()=>{let b,c,d=[];for(let e=0,f=a.length;e<f;e++){let f=a[e];f&&(b=this.getShape(f.id))&&(c=pO(b,f))!==b&&(c=this.getShapeUtil(b).onBeforeUpdate?.(b,c)??c,d.push(c))}this.emit("edited-shapes",d),this.emit("edit"),this.store.put(d)})}_getUnlockedShapeIds(a){return a.filter(a=>!this.getShape(a)?.isLocked)}deleteShapes(a){if(this.getIsReadonly())return this;if(!Array.isArray(a))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");let b="string"==typeof a[0]?a:a.map(a=>a.id),c=this._shouldIgnoreShapeLock?b:this._getUnlockedShapeIds(b);if(0===c.length)return this;let d=new Set(c);for(let a of c)this.visitDescendants(a,a=>{d.add(a)});return this.emit("deleted-shapes",[...d]),this.emit("edit"),this.run(()=>this.store.remove([...d]))}deleteShape(a){return this.deleteShapes(["string"==typeof a?a:a.id]),this}_extractSharedStyles(a,b){if(this.isShapeOfType(a,"group")){let c=this._parentIdsToChildIds.get()[a.id];if(c)for(let a=0,d=c.length;a<d;a++)this._extractSharedStyles(this.getShape(c[a]),b)}else for(let[c,d]of this.styleProps[a.type])b.applyValue(c,cV(a.props,d))}_getSelectionSharedStyles(){let a=this.getSelectedShapes(),b=new m8;for(let c of a)this._extractSharedStyles(c,b);return b}getStyleForNextShape(a){let b=this.getInstanceState().stylesForNextShape[a.id];return void 0===b?a.defaultValue:b}getShapeStyleIfExists(a,b){let c=this.styleProps[a.type].get(b);if(void 0!==c)return cV(a.props,c)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();let a=this.root.getCurrent(),b=new m8;if(!a)return b;if(a.shapeType)if("frame"!==a.shapeType||this.getShapeUtil("frame").options.showColors)for(let c of this.styleProps[a.shapeType].keys())b.applyValue(c,this.getStyleForNextShape(c));else for(let c of this.styleProps[a.shapeType].keys())"tldraw:color"!==c.id&&b.applyValue(c,this.getStyleForNextShape(c));return b}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){let a=[],b=c=>{let d=this.getShape(c);if(d)if(this.isShapeOfType(d,"group"))for(let a of this.getSortedChildIdsForParent(d.id))b(a);else a.push(d)};for(let a of this.getSelectedShapeIds())b(a);let c=null;for(let b of a)if(null===c)c=b.opacity;else if(c!==b.opacity)return{type:"mixed"};if(null!==c)return{type:"shared",value:c}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(a,b){return this.updateInstanceState({opacityForNextShape:a},b),this}setOpacityForSelectedShapes(a){let b=this.getSelectedShapes();if(b.length>0){let c=[],d=a=>{if(this.isShapeOfType(a,"group"))for(let b of this.getSortedChildIdsForParent(a))d(this.getShape(b));else c.push(a)};for(let a of b)d(a);this.updateShapes(c.map(b=>({id:b.id,type:b.type,opacity:a})))}return this}setStyleForNextShapes(a,b,c){let d=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...d,[a.id]:b}},c),this}setStyleForSelectedShapes(a,b){let c=this.getSelectedShapes();if(c.length>0){let d=[],e=c=>{if(this.isShapeOfType(c,"group"))for(let a of this.getSortedChildIdsForParent(c.id))e(this.getShape(a));else{let e=this.getShapeUtil(c),f=this.styleProps[c.type].get(a);if(f){let a={id:c.id,type:c.type,props:{[f]:b}};d.push({util:e,originalShape:c,updatePartial:a})}}};for(let a of c)e(a);this.updateShapes(d.map(({updatePartial:a})=>a))}return this}registerExternalAssetHandler(a,b){return this.externalAssetContentHandlers[a]=b,this}createTemporaryAssetPreview(a,b){if(this.temporaryAssetPreview.has(a))return this.temporaryAssetPreview.get(a);let c=URL.createObjectURL(b);return this.temporaryAssetPreview.set(a,c),setTimeout(()=>{this.temporaryAssetPreview.delete(a),URL.revokeObjectURL(c)},this.options.temporaryAssetPreviewLifetimeMs),c}getTemporaryAssetPreview(a){return this.temporaryAssetPreview.get(a)}async getAssetForExternalContent(a){return await this.externalAssetContentHandlers[a.type]?.(a)}hasExternalAssetHandler(a){return!!this.externalAssetContentHandlers[a]}registerExternalContentHandler(a,b){return this.externalContentHandlers[a]=b,this}async putExternalContent(a,b={}){if(!(!b.force&&this.getIsReadonly()))return this.externalContentHandlers[a.type]?.(a)}async replaceExternalContent(a,b={}){if(!(!b.force&&this.getIsReadonly()))return this.externalContentHandlers[a.type]?.(a)}getContentFromCurrentPage(a){let b="string"==typeof a[0]?a:a.map(a=>a.id);if(!b||0===b.length)return;let c=this.getShapeAndDescendantIds(b);return pP(this,c,a=>{let b=[];for(let c of a){let a=this.getBinding(c);a&&b.push(a)}let d=[],e=[];for(let a of c){let b=this.getShape(a);if(b)if(c.has(b.parentId))e.push(b);else{let a=this.getShapePageTransform(b.id),c=a.point();e.push({...b,x:c.x,y:c.y,rotation:a.rotation(),parentId:this.getCurrentPageId()}),d.push(b.id)}}let f=[],g=new Set;for(let a of e){if(!("assetId"in a.props))continue;let b=a.props.assetId;if(!b||g.has(b))continue;g.add(b);let c=this.getAsset(b);c&&f.push(c)}return{schema:this.store.schema.serialize(),shapes:e,rootShapeIds:d,bindings:b,assets:f}})}async resolveAssetsInContent(a){if(!a)return;let b=[];return await Promise.allSettled(a.assets.map(async a=>{if("image"!==a.type&&"video"!==a.type||a.props.src?.startsWith("data:image")||a.props.src?.startsWith("data:video")||a.props.src?.startsWith("http"))b.push(a);else{let c=d$(a),d=await this.store.props.assets.resolve(a,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});c.props.src=await ct.blobToDataUrl(await cr(d).then(a=>a.blob())),b.push(c)}})),a.assets=b,a}putContentOntoCurrentPage(a,b={}){if(this.getIsReadonly())return this;if(!a.schema)throw Error("Could not put content:\ncontent is missing a schema.");let{select:c=!1,preserveIds:d=!1,preservePosition:e=!1}=b,{point:f}=b,g=this.getCurrentPageId(),{rootShapeIds:h}=a,i=[],j=[],k=[],l={store:{...Object.fromEntries(a.assets.map(a=>[a.id,a])),...Object.fromEntries(a.shapes.map(a=>[a.id,a])),...Object.fromEntries(a.bindings?.map(a=>[a.id,a])??[])},schema:a.schema},m=this.store.schema.migrateStoreSnapshot(l);if("error"===m.type)throw Error("Could not put content: could not migrate content");for(let a of Object.values(m.value))switch(a.typeName){case"asset":i.push(a);break;case"shape":j.push(a);break;case"binding":k.push(a)}let n=new Map(d?j.map(a=>[a.id,a.id]):j.map(a=>[a.id,hd()])),o=new Map(d?k.map(a=>[a.id,a.id]):k.map(a=>[a.id,g2()])),p=this.getCurrentPageId(),q=1/0,r=[];for(let a of this.getSelectedShapes()){if(0===q)break;let b=this.isShapeOfType(a,"frame"),c=this.getShapeAncestors(a);b&&c.push(a);let d=b?c.length+1:c.length;if(d<q)q=d,r=c,p=b?a.id:a.parentId;else if(d===q){if(r.length!==c.length)throw Error(`Ancestors: ${r.length} !== ${c.length}`);if(0===r.length){p=g;break}p=g;for(let a=0;a<r.length&&c[a]===r[a];a++)p=c[a].id}}let s=!1;if(!hV(p)){let a=this.getShape(p);if(a)if(this.getViewportPageBounds().includes(this.getShapePageBounds(a))){if(1===h.length){let b=j.find(a=>a.id===h[0]);this.isShapeOfType(a,"frame")&&this.isShapeOfType(b,"frame")&&b.props.w===a?.props.w&&b.props.h===a?.props.h&&(s=!0)}}else p=g;else p=g}s||(s=n.has(p)),s&&(p=this.getShape(p).parentId);let t=this.getHighestIndexForParent(p),u=[],v=j.map(a=>{let b=n.get(a.id),c={...a,id:b};return h.includes(a.id)&&(c.parentId=g,u.push(c)),n.has(c.parentId)?c.parentId=n.get(a.parentId):(h.push(c.id),c.index=t,t=dw(t)),c});if(v.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return pN(this),this;let w=k.map(a=>({...a,id:ch(o.get(a.id)),fromId:ch(n.get(a.fromId)),toId:ch(n.get(a.toId))})),y=[],z=[];for(let a of i)this.store.has(a.id)||(("image"===a.type&&a.props.src?.startsWith("data:image")||"video"===a.type&&a.props.src?.startsWith("data:video"))&&(z.push(d$(a)),a.props.src=null),y.push(a));return Promise.allSettled(z.map(async a=>{var b,c,d;let e=await (b=a.props.src,c=a.props.name,d=a.props.mimeType??"image/png",cr(b).then(function(a){return a.arrayBuffer()}).then(function(a){return new File([a],c,{type:d})})),f=await this.getAssetForExternalContent({type:"file",file:e,assetId:a.id});f?this.updateAssets([{...f,id:a.id}]):this.deleteAssets([a.id])})),this.run(()=>{y.length>0&&this.createAssets(y),this.createShapes(v),this.createBindings(w),c&&this.select(...u.map(a=>a.id)),p!==g&&this.reparentShapes(u.map(a=>a.id),p);let a=v.map(a=>this.getShape(a.id)),b=lh.Common(a.map(a=>this.getShapePageBounds(a)));if(void 0===f)if(hV(p)){let a=this.getViewportPageBounds();f=e||a.includes(lh.From(b))?b.center:a.center}else{let a=this.getShape(p);f=li.applyToPoint(this.getShapePageTransform(a),this.getShapeGeometry(a).bounds.center)}if(1===u.length){let a=u[0];if(this.isShapeOfType(a,"frame"))for(;this.getShapesAtPoint(f).some(b=>this.isShapeOfType(b,"frame")&&b.props.w===a.props.w&&b.props.h===a.props.h);)f.x+=b.w+16}let d=lh.Common(b5(u.map(({id:a})=>this.getShapePageBounds(a)))).center,h=jA.Sub(f,d);this.updateShapes(u.map(({id:a})=>{let b=this.getShape(a),c=this.getShapeParentTransform(a).decompose().rotation,d=jA.Rot(h,-c);return{id:b.id,type:b.type,x:b.x+d.x,y:b.y+d.y}}))}),this}async getSvgElement(a,b={}){let c=0===a.length?this.getCurrentPageShapeIdsSorted():"string"==typeof a[0]?a:a.map(a=>a.id);if(0!==c.length)return mZ(this,c,b)}async getSvgString(a,b={}){let c=await this.getSvgElement(a,b);if(c)return{svg:new XMLSerializer().serializeToString(c.svg),width:c.width,height:c.height}}async toImage(a,b={}){let c={format:"png",scale:1,pixelRatio:"svg"===b.format?void 0:2,...b},d=await this.getSvgString(a,c);if(!d)throw Error("Could not create SVG");switch(c.format){case"svg":return{blob:new Blob([d.svg],{type:"image/svg+xml"}),width:d.width,height:d.height};case"jpeg":case"png":case"webp":{let a=await m2(d.svg,{type:c.format,quality:c.quality,pixelRatio:c.pixelRatio,width:d.width,height:d.height});if(!a)throw Error("Could not construct image.");return{blob:a,width:d.width,height:d.height}}default:cf(c.format)}}async toImageDataUrl(a,b={}){let{blob:c,width:d,height:e}=await this.toImage(a,b);return{url:await ct.blobToDataUrl(c),width:d,height:e}}_updateInputsFromEvent(a){let{pointerVelocity:b,previousScreenPoint:c,previousPagePoint:d,currentScreenPoint:e,currentPagePoint:f,originScreenPoint:g,originPagePoint:h}=this.inputs,{screenBounds:i}=this.store.unsafeGetWithoutCapture(h$),{x:j,y:k,z:l}=eF(()=>this.getCamera()),m=a.point.x-i.x,n=a.point.y-i.y,o=a.point.z??.5;c.setTo(e),d.setTo(f),e.set(m,n);let p=m/l-j,q=n/l-k;isFinite(p)&&isFinite(q)&&f.set(p,q,o),this.inputs.isPen="pointer"===a.type&&a.isPen,("pointer_down"===a.name||this.inputs.isPinching)&&(b.set(0,0),g.setTo(e),h.setTo(f)),this.run(()=>{this.store.put([{id:h6,typeName:"pointer",x:f.x,y:f.y,lastActivityTimestamp:"pointer"===a.type&&-10===a.pointerId?this.store.unsafeGetWithoutCapture(h6)?.lastActivityTimestamp??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}updatePointer(a){let b={type:"pointer",target:"canvas",name:"pointer_move",point:a?.point??jA.Add(this.inputs.currentScreenPoint,this.store.unsafeGetWithoutCapture(h$).screenBounds),pointerId:a?.pointerId??0,button:a?.button??0,isPen:a?.isPen??this.inputs.isPen,shiftKey:a?.shiftKey??this.inputs.shiftKey,altKey:a?.altKey??this.inputs.altKey,ctrlKey:a?.ctrlKey??this.inputs.ctrlKey,metaKey:a?.metaKey??this.inputs.metaKey,accelKey:a?.accelKey??kg(this.inputs)};return a?.immediate?this._flushEventForTick(b):this.dispatch(b),this}focus({focusContainer:a=!0}={}){return this.getIsFocused()||(a&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0})),this}blur({blurContainer:a=!0}={}){return this.getIsFocused()&&(a?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1})),this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){var a=this.store;let b=le.get(a,lb).get();if(!b)throw Error("Session state is not ready yet");return{document:a.getStoreSnapshot(),session:b}}loadSnapshot(a,b){return ld(this.store,a,b),this}_zoomToFitPageContentAt100Percent(){let a=this.getCurrentPageBounds();a&&this.zoomToBounds(a,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(a){this.run(()=>{switch(a.type){case"page":{let b=this.getPage(a.pageId);b&&this.setCurrentPage(b),this._zoomToFitPageContentAt100Percent();return}case"shapes":{let b=b5(a.shapeIds.map(a=>this.getShape(a))),c={};for(let a of b){let b=this.getAncestorPageId(a);b&&(c[b]??=[],c[b].push(a))}let[d,e]=Object.entries(c).sort(([a,b],[c,d])=>d.length-b.length)[0]??["",[]];if(d&&e.length){this.setCurrentPage(d);let a=lh.Common(e.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(a,{immediate:!0,targetZoom:this.getBaseZoom()})}else this._zoomToFitPageContentAt100Percent();return}case"viewport":if(a.pageId){if(!this.getPage(a.pageId))return void this._zoomToFitPageContentAt100Percent();this.setCurrentPage(a.pageId)}this.zoomToBounds(a.bounds,{immediate:!0,inset:0});return;default:cf(a)}})}navigateToDeepLink(a){if(a&&"type"in a)return this._navigateToDeepLink(a),this;let b=new URL(a?.url??window.location.href).searchParams.get(a?.param??"d");if(!b)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(function(a){switch(a[0]){case"s":return{type:"shapes",shapeIds:a.slice(1).split(".").filter(Boolean).map(a=>hd(decodeURIComponent(a)))};case"p":return{type:"page",pageId:hU.createId(decodeURIComponent(a.slice(1)))};case"v":{let[b,c,d,e,f]=a.slice(1).split(".");return{type:"viewport",bounds:new lh(Number(b),Number(c),Number(d),Number(e)),pageId:f?hU.createId(decodeURIComponent(f)):void 0}}default:throw Error("Invalid deep link string")}}(b))}catch(a){console.warn(a),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(a){let b=new URL(a?.url??window.location.href);return b.searchParams.set(a?.param??"d",function(a){switch(a.type){case"shapes":{let b=a.shapeIds.map(a=>na(a.slice(6)));return`s${b.join(".")}`}case"page":return"p"+na(hU.parseId(a.pageId));case"viewport":{let{bounds:b,pageId:c}=a,d=`v${Math.round(b.x)}.${Math.round(b.y)}.${Math.round(b.w)}.${Math.round(b.h)}`;return c&&(d+="."+na(hU.parseId(c))),d}default:cf(a)}}(a?.to??{type:"viewport",pageId:1===this.options.maxPages?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),b}registerDeepLinkListener(a){if(a?.getUrl&&!a?.onChange)throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");let b=eB("url with state",()=>{let b=a?.getUrl?.(this)??window.location.href;return this.createDeepLink({param:a?.param,url:b,to:a?.getTarget?.(this)}).toString()}),c=a?.onChange??(()=>{let b=this.createDeepLink({param:a?.param,to:a?.getTarget?.(this)});window.history.replaceState({},document.title,b.toString())}),d=cm(a=>a(),a?.debounceMs??500),e=eg("update url on state change",()=>c(new URL(b.get()),this),{scheduleEffect:d});return()=>{e(),d.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:kg(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:kg(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:kg(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:kg(this.inputs),code:"MetaLeft"})}markEventAsHandled(a){let b="nativeEvent"in a?a.nativeEvent:a;this.handledEvents.add(b)}wasEventAlreadyHandled(a){let b="nativeEvent"in a?a.nativeEvent:a;return this.handledEvents.has(b)}dispatch(a){return this._pendingEventsForNextTick.push(a),("pointer"!==a.type||"pointer_move"!==a.name)&&"wheel"!==a.type&&"pinch"!==a.type&&this._flushEventsForTick(0),this}_flushEventsForTick(a){this.run(()=>{if(this._pendingEventsForNextTick.length>0){let a=[...this._pendingEventsForNextTick];for(let b of(this._pendingEventsForNextTick.length=0,a))this._flushEventForTick(b)}a>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:a}),this.scribbles.tick(a)})}_flushEventForTick(a){if(this.getCrashingError())return this;this.emit("before-event",a);let{inputs:b}=this,{type:c}=a;if("misc"===a.type){("cancel"===a.name||"complete"===a.name)&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(a);return}a.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,b.shiftKey=!0):!a.shiftKey&&b.shiftKey&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),a.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,b.altKey=!0):!a.altKey&&b.altKey&&-1===this._altKeyTimeout&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),a.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,b.ctrlKey=!0):!a.ctrlKey&&b.ctrlKey&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),a.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,b.metaKey=!0):!a.metaKey&&b.metaKey&&-1===this._metaKeyTimeout&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));let{originPagePoint:d,currentPagePoint:e}=b;b.isPointing||(b.isDragging=!1);let f=this.store.unsafeGetWithoutCapture(h$),g=this.store.get(this._getCurrentPageStateId()),h=this._cameraOptions.__unsafe__getWithoutCapture();switch(c){case"pinch":if(h.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(a),a.name){case"pinch_start":if(b.isPinching)return;b.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...g.selectedShapeIds]),this._didPinch=!0,b.isPinching=!0,this.interrupt());return;case"pinch":{if(!b.isPinching)return;let{point:{z:c=1},delta:{x:d,y:e}}=a,{x:g,y:i}=jA.SubXY(a.point,f.screenBounds.x,f.screenBounds.y);this.stopCameraAnimation(),f.followingUserId&&this.stopFollowingUser();let{x:j,y:k,z:l}=eF(()=>this.getCamera()),{panSpeed:m}=h;this._setCamera(new jA(j+d*m/l-g/l+g/c,k+e*m/l-i/l+i/c,c),{immediate:!0});return}case"pinch_end":{if(!b.isPinching)return this;b.isPinching=!1;let{_selectedShapeIdsAtPointerDown:a}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,a.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(a)}));return}}case"wheel":{if(h.isLocked)return;this._updateInputsFromEvent(a);let{panSpeed:b,zoomSpeed:c}=h,d=h.wheelBehavior,e=this.user.getUserPreferences().inputMode;if(null!==e&&(d="trackpad"===e?"pan":"zoom"),"none"!==d){this.stopCameraAnimation(),f.followingUserId&&this.stopFollowingUser();let{x:e,y:g,z:h}=eF(()=>this.getCamera()),{x:i,y:j,z:k=0}=a.delta,l=d;switch(a.ctrlKey&&(l="pan"===d?"zoom":"pan"),l){case"zoom":{let{x:a,y:b}=this.inputs.currentScreenPoint,f=k;"zoom"===d&&(f=Math.abs(j)>10?10*Math.sign(j)/100:j/100);let i=h+(f??0)*c*h;this._setCamera(new jA(e+a/i-a/h,g+b/i-b/h,i),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":this._setCamera(new jA(e+i*b/h,g+j*b/h,h),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}break}case"pointer":{if(b.isPinching)return;this._updateInputsFromEvent(a);let{isPen:c}=a,{isPenMode:g}=f;switch(a.name){case"pointer_down":if(g&&!c)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{let b=this.getViewportScreenBounds();this.dispatch({...a,point:this.inputs.originScreenPoint.clone().addXY(b.x,b.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),0===a.button&&(this.capturedPointerId=a.pointerId),b.buttons.add(a.button),b.isPointing=!0,b.isDragging=!1,!g&&c&&this.updateInstanceState({isPenMode:!0}),5===a.button?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):1===a.button&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break;case"pointer_move":{if(!c&&g)return;let{x:a,y:h,z:i}=eF(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){let{currentScreenPoint:b,previousScreenPoint:c}=this.inputs,d=jA.Sub(b,c);this.setCamera(new jA(a+d.x/i,h+d.y/i,i),{immediate:!0}),this.maybeTrackPerformance("Panning");return}b.isPointing&&!b.isDragging&&jA.Dist2(d,e)*this.getZoomLevel()>(f.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/i&&(b.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":if(b.isDragging=!1,b.isPointing=!1,clearTimeout(this._longPressTimeout),b.buttons.delete(a.button),f.isPenMode&&!c)return;if(this.capturedPointerId===a.pointerId&&(this.capturedPointerId=null,a.button=0),b.isPanning){b.keys.has("Space")||(b.isPanning=!1,b.isSpacebarPanning=!1);let c=this.inputs.pointerVelocity,d=Math.min(2,c.len());switch(a.button){case 0:this.setCursor({type:"grab",rotation:0});break;case 1:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}d>0&&this.slideCamera({speed:d,direction:c})}else 5===a.button&&(this.complete(),this.setCurrentTool(this._restoreToolId))}break}case"keyboard":switch("ShiftRight"===a.key&&(a.key="ShiftLeft"),"AltRight"===a.key&&(a.key="AltLeft"),"ControlRight"===a.code&&(a.code="ControlLeft"),"MetaRight"===a.code&&(a.code="MetaLeft"),a.name){case"key_down":if(b.keys.add(a.code),"Space"!==a.code||a.ctrlKey||(this.inputs.isPanning||(this._prevCursor=f.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let b;switch(a.code){case"ArrowUp":b=new jA(0,-1);break;case"ArrowRight":b=new jA(1,0);break;case"ArrowDown":b=new jA(0,1);break;case"ArrowLeft":b=new jA(-1,0)}if(b){let a=this.getViewportPageBounds(),c=a.clone().translate(b.mulV({x:a.w,y:a.h}));this._animateToViewport(c,{animation:{duration:320}})}}break;case"key_up":b.keys.delete(a.code),"Space"===a.code&&(this.inputs.buttons.has(1)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})))}}if("pointer"===a.type){1===a.button?a.name="middle_click":2===a.button&&(a.name="right_click");let{isPenMode:b}=this.store.unsafeGetWithoutCapture(h$);if(a.isPen===b){let b=this._clickManager.handlePointerEvent(a);if(a.name!==b.name){this.root.handleEvent(a),this.emit("event",a),this.root.handleEvent(b),this.emit("event",b);return}}}return this.root.handleEvent(a),this.emit("event",a),"pointer"===a.type&&"pointer_down"===a.name&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(a){j7.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(a),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}function pN(a,b=a.getCurrentPageId()){let c=a.getPage(b).name;a.emit("max-shapes",{name:c,pageId:b,count:a.options.maxShapesPerPage})}function pO(a,b){if(!b)return a;let c=null,d=Object.entries(b);for(let b=0,e=d.length;b<e;b++){let[e,f]=d[b];if(void 0!==f&&"id"!==e&&"type"!==e&&"typeName"!==e&&f!==a[e]){if(c||(c={...a}),"props"===e||"meta"===e){for(let[b,d]of(c[e]={...a[e]},Object.entries(f)))c[e][b]=d;continue}c[e]=f}}return c||a}function pP(a,b,c){let d;if(a.run(()=>{let e=a.store.extractingChanges(()=>{let e=new Set,f=new Set;for(let c of b)if(a.getShape(c))for(let d of a.getBindingsInvolvingShape(c)){let a=b.has(d.fromId),c=b.has(d.toId);if(a&&c){e.add(d.id);continue}a&&c||f.add(d.id)}a.deleteBindings([...f],{isolateShapes:!0});try{d=ce.ok(c(e))}catch(a){d=ce.err(a)}});a.store.applyDiff(fQ(e),{runCallbacks:!1})},{history:"ignore"}),d.ok)return d.value;throw d.error}function pQ(a,b){if(!b.constraints)throw Error("Should have constraints here");let{padding:{x:c,y:d}}=b.constraints,e=a.getViewportScreenBounds(),f=lh.From(b.constraints.bounds);return{zx:(e.w-2*c)/f.w,zy:(e.h-2*d)/f.h}}function pR(){let a=kp(),b=mD();return e$("isDarkMode",()=>b?.isDarkMode??a.user.getIsDarkMode(),[b,a])}pF(bA=[,,,pu(bz?.[px("metadata")]??null)],1,"getIsShapeHiddenCache",by,pM),pF(bA,1,"getCanUndo",bx,pM),pF(bA,1,"getCanRedo",bw,pM),pF(bA,1,"getPath",bv,pM),pF(bA,1,"getCurrentTool",bu,pM),pF(bA,1,"getCurrentToolId",bt,pM),pF(bA,1,"getDocumentSettings",bs,pM),pF(bA,1,"getInstanceState",br,pM),pF(bA,1,"getPageStates",bq,pM),pF(bA,1,"_getPageStatesQuery",bp,pM),pF(bA,1,"getCurrentPageState",bo,pM),pF(bA,1,"_getCurrentPageStateId",bn,pM),pF(bA,1,"getSelectedShapeIds",bm,pM),pF(bA,1,"getSelectedShapes",bl,pM),pF(bA,1,"getCurrentPageShapesInReadingOrder",bk,pM),pF(bA,1,"getOnlySelectedShapeId",bj,pM),pF(bA,1,"getOnlySelectedShape",bi,pM),pF(bA,1,"getSelectionPageBounds",bh,pM),pF(bA,1,"getSelectionRotation",bg,pM),pF(bA,1,"getSelectionRotatedPageBounds",bf,pM),pF(bA,1,"getSelectionRotatedScreenBounds",be,pM),pF(bA,1,"getFocusedGroupId",bd,pM),pF(bA,1,"getFocusedGroup",bc,pM),pF(bA,1,"getEditingShapeId",bb,pM),pF(bA,1,"getEditingShape",ba,pM),pF(bA,1,"getRichTextEditor",a9,pM),pF(bA,1,"getHoveredShapeId",a8,pM),pF(bA,1,"getHoveredShape",a7,pM),pF(bA,1,"getHintingShapeIds",a6,pM),pF(bA,1,"getHintingShape",a5,pM),pF(bA,1,"getErasingShapeIds",a4,pM),pF(bA,1,"getErasingShapes",a3,pM),pF(bA,1,"_unsafe_getCameraId",a2,pM),pF(bA,1,"getCamera",a1,pM),pF(bA,1,"getViewportPageBoundsForFollowing",a0,pM),pF(bA,1,"getCameraForFollowing",a_,pM),pF(bA,1,"getZoomLevel",a$,pM),pF(bA,1,"getViewportScreenBounds",aZ,pM),pF(bA,1,"getViewportScreenCenter",aY,pM),pF(bA,1,"getViewportPageBounds",aX,pM),pF(bA,1,"_getCollaboratorsQuery",aW,pM),pF(bA,1,"getCollaborators",aV,pM),pF(bA,1,"getCollaboratorsOnCurrentPage",aU,pM),pF(bA,1,"getRenderingShapes",aT,pM),pF(bA,1,"_getAllPagesQuery",aS,pM),pF(bA,1,"getPages",aR,pM),pF(bA,1,"getCurrentPageId",aQ,pM),pF(bA,1,"getCurrentPageShapeIdsSorted",aP,pM),pF(bA,1,"_getAllAssetsQuery",aO,pM),pF(bA,1,"_getShapeHandlesCache",aN,pM),pF(bA,1,"_getShapePageTransformCache",aM,pM),pF(bA,1,"_getShapePageBoundsCache",aL,pM),pF(bA,1,"_getShapeClipPathCache",aK,pM),pF(bA,1,"_getShapeMaskCache",aJ,pM),pF(bA,1,"_getShapeMaskedPageBoundsCache",aI,pM),pF(bA,1,"getNotVisibleShapes",aH,pM),pF(bA,1,"getCulledShapes",aG,pM),pF(bA,1,"getCurrentPageBounds",aF,pM),pF(bA,1,"getCurrentPageShapes",aE,pM),pF(bA,1,"getCurrentPageShapesSorted",aD,pM),pF(bA,1,"getCurrentPageRenderingShapesSorted",aC,pM),pF(bA,1,"_getBindingsIndexCache",aB,pM),pF(bA,1,"_getSelectionSharedStyles",aA,pM),pF(bA,1,"getSharedStyles",az,pM),pF(bA,1,"getSharedOpacity",ay,pM),pF(bA,1,"getIsFocused",ax,pM),pF(bA,1,"getIsReadonly",aw,pM),pF(bA,1,"_setShiftKeyTimeout",av,pM),pF(bA,1,"_setAltKeyTimeout",au,pM),pF(bA,1,"_setCtrlKeyTimeout",at,pM),pF(bA,1,"_setMetaKeyTimeout",as,pM),pE(bA,pM);let pS="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",pT="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",pU='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function pV(a,b,c,d,e,f=16,g=16){let h=jE/180*(-c-b),i=Math.sin(h),j=Math.cos(h);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${e};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${j-i}' dy='${+i+ +j}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${b+c} 16 16)${d?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+a.replaceAll('"',"'")+`</g></svg>") ${f} ${g}, pointer`}let pW=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],pX={none:()=>"none","ew-resize":(a,b,c)=>pV(pT,a,0,b,c),"ns-resize":(a,b,c)=>pV(pT,a,90,b,c),"nesw-resize":(a,b,c)=>pV(pS,a,0,b,c),"nwse-resize":(a,b,c)=>pV(pS,a,90,b,c),"nwse-rotate":(a,b,c)=>pV(pU,a,0,b,c),"nesw-rotate":(a,b,c)=>pV(pU,a,90,b,c),"senw-rotate":(a,b,c)=>pV(pU,a,180,b,c),"swne-rotate":(a,b,c)=>pV(pU,a,270,b,c)};function pY(a,b=0,c="black"){return pX[a](180*b/jE,!1,c)}let pZ=a=>a.props.src,p$={upload:async(a,b)=>({src:await ct.blobToDataUrl(b)})};function p_({initialData:a,defaultName:b="",id:c,assets:d=p$,onMount:e,collaboration:f,...g}={}){let h=new f2({id:c,schema:"schema"in g&&g.schema?g.schema:jm({shapes:"shapeUtils"in g&&g.shapeUtils?p0(lH(g.shapeUtils)):void 0,bindings:"bindingUtils"in g&&g.bindingUtils?p0(lf(g.bindingUtils)):void 0,migrations:"migrations"in g?g.migrations:void 0}),initialData:a,props:{defaultName:b,assets:{upload:d.upload,resolve:d.resolve??pZ,remove:d.remove??(()=>Promise.resolve())},onMount:a=>{cg(a instanceof pM),e?.(a)},collaboration:f}});if(g.snapshot){if(a)throw Error("Cannot provide both initialData and snapshot");ld(h,g.snapshot,{forceOverwriteSessionState:!0})}return h}function p0(a){return Object.fromEntries(a.map(a=>[a.type,{props:a.props,migrations:a.migrations}]))}let p1=new WeakMap,p2=new WeakMap,p3=new WeakMap,p4=new WeakMap,p5=new WeakMap,p6={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return p2.get(a);if("objectStoreNames"===b)return a.objectStoreNames||p3.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return p7(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function p7(a){if(a instanceof IDBRequest){let b;return(b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(p7(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)})).then(b=>{b instanceof IDBCursor&&p1.set(b,a)}).catch(()=>{}),p5.set(b,a),b}if(p4.has(a))return p4.get(a);let b=function(a){if("function"==typeof a)return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(p8(this),b),p7(p1.get(this))}:function(...b){return p7(a.apply(p8(this),b))}:function(b,...c){let d=a.call(p8(this),b,...c);return p3.set(d,b.sort?b.sort():[b]),p7(d)};return a instanceof IDBTransaction&&function(a){if(p2.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});p2.set(a,b)}(a),(h||(h=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(b=>a instanceof b)?new Proxy(a,p6):a}(a);return b!==a&&(p4.set(a,b),p5.set(b,a)),b}let p8=a=>p5.get(a);function p9(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,b),h=p7(g);return d&&g.addEventListener("upgradeneeded",a=>{d(p7(g.result),a.oldVersion,a.newVersion,p7(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}let qa=["get","getKey","getAll","getAllKeys","count"],qb=["put","add","delete","clear"],qc=new Map;function qd(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(qc.get(b))return qc.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=qb.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||qa.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return qc.set(b,f),f}p6={...n=p6,get:(a,b,c)=>qd(a,b)||n.get(a,b,c),has:(a,b)=>!!qd(a,b)||n.has(a,b)};let qe="TLDRAW_DB_NAME_INDEX_v2",qf="records",qg="schema",qh="session_state",qi="assets";async function qj(a){var b;let c,d="TLDRAW_DOCUMENT_v2"+a;return b=d,(c=new Set(qm())).add(b),dE(qe,JSON.stringify([...c])),await p9(d,4,{upgrade(a){a.objectStoreNames.contains(qf)||a.createObjectStore(qf),a.objectStoreNames.contains(qg)||a.createObjectStore(qg),a.objectStoreNames.contains(qh)||a.createObjectStore(qh),a.objectStoreNames.contains(qi)||a.createObjectStore(qi)}})}async function qk(a){let b=window.indexedDB.databases?(await window.indexedDB.databases()).map(a=>a.name):qm(),c="TLDRAW_ASSET_STORE_v1"+a;if(!b.find(a=>a===c))return;let d=await p9(c,1,{upgrade(a){a.objectStoreNames.contains("assets")||a.createObjectStore("assets")}});if(!d.objectStoreNames.contains("assets"))return;let e=d.transaction(["assets"],"readonly"),f=e.objectStore("assets"),g=await f.getAllKeys(),h=await Promise.all(g.map(async a=>[a,await f.get(a)]));await e.done;let i=await qj(a),j=i.transaction([qi],"readwrite"),k=j.objectStore(qi);for(let[a,b]of h)k.put(b,a);await j.done,d.close(),i.close(),await function(a,{blocked:b}={}){let c=indexedDB.deleteDatabase(a);return b&&c.addEventListener("blocked",a=>b(a.oldVersion,a)),p7(c).then(()=>void 0)}(c)}class ql{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(a){ql.connectedInstances.add(this),this.getDbPromise=(async()=>(await qk(a),await qj(a)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(cd)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),ql.connectedInstances.delete(this))}tx(a,b,c){let d=(async()=>{cg(!this.isClosed,"db is closed");let d=(await this.getDb()).transaction(b,a),e=d.done.catch(a=>{if(!this.isClosed)throw a});try{return await c(d)}finally{this.isClosed?d.abort():await e}})();return this.pendingTransactionSet.add(d),d.finally(()=>this.pendingTransactionSet.delete(d)),d}async load({sessionId:a}={}){return await this.tx("readonly",[qf,qg,qh],async b=>{let c=b.objectStore(qf),d=b.objectStore(qg),e=b.objectStore(qh),f=a?(await e.get(a))?.snapshot:null;if(!f){let a=await e.getAll();f=a.sort((a,b)=>a.updatedAt-b.updatedAt).pop()?.snapshot}return{records:await c.getAll(),schema:await d.get(qg),sessionStateSnapshot:f}})}async storeChanges({schema:a,changes:b,sessionId:c,sessionStateSnapshot:d}){await this.tx("readwrite",[qf,qg,qh],async e=>{let f=e.objectStore(qf),g=e.objectStore(qg),h=e.objectStore(qh);for(let[a,c]of Object.entries(b.added))await f.put(c,a);for(let[a,c]of Object.values(b.updated))await f.put(c,c.id);for(let a of Object.keys(b.removed))await f.delete(a);g.put(a.serialize(),qg),d&&c?h.put({snapshot:d,updatedAt:Date.now(),id:c},c):(d||c)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:a,snapshot:b,sessionId:c,sessionStateSnapshot:d}){await this.tx("readwrite",[qf,qg,qh],async e=>{let f=e.objectStore(qf),g=e.objectStore(qg),h=e.objectStore(qh);for(let[a,c]of(await f.clear(),Object.entries(b)))await f.put(c,a);g.put(a.serialize(),qg),d&&c?h.put({snapshot:d,updatedAt:Date.now(),id:c},c):(d||c)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[qh],async a=>{let b=a.objectStore(qh),c=(await b.getAll()).sort((a,b)=>a.updatedAt-b.updatedAt);if(c.length<10)return void await a.done;for(let{id:a}of c.slice(0,c.length-10))await b.delete(a)})}async getAsset(a){return await this.tx("readonly",[qi],async b=>{let c=b.objectStore(qi);return await c.get(a)})}async storeAsset(a,b){await this.tx("readwrite",[qi],async c=>{let d=c.objectStore(qi);await d.put(b,a)})}async removeAssets(a){await this.tx("readwrite",[qi],async b=>{let c=b.objectStore(qi);for(let b of a)await c.delete(b)})}}function qm(){let a=JSON.parse(dD(qe)||"[]")??[];return Array.isArray(a)?a:[]}let qn=Symbol("UPDATE_INSTANCE_STATE"),qo="undefined"==typeof BroadcastChannel?class{onmessage;constructor(a){}postMessage(a){}close(){}}:BroadcastChannel;class qp{constructor(a,{persistenceKey:b,sessionId:c=k7,onLoad:d,onLoadError:e},f=new qo(`tldraw-tab-sync-${b}`)){this.store=a,this.channel=f,this.persistenceKey=b,this.sessionId=c,this.db=new ql(b),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=lb(this.store),this.disposables.add(a.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema}),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(a.listen(()=>{this.diffQueue.push(qn),this.schedulePersist()},{scope:"session"})),this.connect(d,e),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>"document"===a.scope).map(a=>a.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...a){this.isDebugging&&console.debug(...a)}async connect(a,b){let c;this.debug("connecting");try{c=await this.db.load({sessionId:this.sessionId})}catch(a){b(a),window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`);return}if(this.debug("loaded data from store",c,"didDispose",this.didDispose),!this.didDispose)try{if(c){let a=Object.fromEntries(c.records.map(a=>[a.id,a])),d=c.sessionStateSnapshot??function(a){let b=[];for(let c of Object.values(a))c.typeName?.match(/^(instance.*|pointer|camera)$/)&&b.push(c);let c=b.filter(a=>"instance"===a.typeName&&a.id!==h$)[0];if(!c)return null;let d={version:k9,currentPageId:c.currentPageId,exportBackground:!!c.exportBackground,isFocusMode:!!c.isFocusMode,isDebugMode:!!c.isDebugMode,isToolLocked:!!c.isToolLocked,isGridMode:!1,pageStates:b.filter(a=>"instance_page_state"===a.typeName&&a.instanceId===c.id).map(b=>{let c=a[b.cameraId]??{x:0,y:0,z:1};return{pageId:b.pageId,camera:{x:c.x,y:c.y,z:c.z},selectedShapeIds:b.selectedShapeIds,focusedGroupId:b.focusedGroupId}})};try{return la.validate(d),d}catch{return null}}(a),e=this.store.schema.migrateStoreSnapshot({store:a,schema:c.schema??this.store.schema.serializeEarliestVersion()});if("error"===e.type){console.error("failed to migrate store",e),b(Error(`Failed to migrate store: ${e.reason}`));return}let f=Object.values(e.value).filter(a=>this.documentTypes.has(a.typeName));f.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(f,"initialize")}),d&&lc(this.store,d,{forceOverwrite:!0})}this.channel.onmessage=({data:a})=>{this.debug("got message",a);let c=this.store.schema.getMigrationsSince(a.schema);if(!c.ok)return Date.now()-this.initTime<5e3?void b(Error("Schema mismatch, please close other tabs and reload the page")):(this.debug("reloading"),this.isReloading=!0,void window?.location?.reload?.());if(c.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}"diff"===a.type&&(this.debug("applying diff"),ep(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(a.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),a(this)}catch(a){if(this.debug("error loading data from store",a),this.didDispose)return;b(a);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(a=>a())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||!this.store.isPossiblyCorrupted()&&(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist()}async doPersist(){if(cg(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");let a=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{let b=fS(a.filter(a=>a!==qn));await this.db.storeChanges({changes:b,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(a){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",a),window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`)}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function qq(a){let b=(0,eQ.useRef)(a),[c,d]=(0,eQ.useState)(a);return c!==b.current&&d(b.current),[c,(0,eQ.useCallback)(a=>{"function"==typeof a?b.current=a(b.current):b.current=a,d(b.current)},[])]}function qr(a){let b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(let b=0,d=a.length;b<d;b++)c[b]=a.charCodeAt(b);return b}let qs={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8,EVALUATION_LICENSE:16,NATIVE_LICENSE:32},qt=Math.max(...Object.values(qs)),qu={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},qv=Object.keys(qu).length,qw="sales@tldraw.com",qx=`${m9()}/watermarks/watermark-track.svg`;class qy{publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=eM("license state","pending");verbose=!0;constructor(a,b){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(),this.publicKey=b||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(a).then(a=>{let b=function(a,b,c){if(!a.isLicenseParseable)return c?"unlicensed":(b("no-key-provided"===a.reason?["No tldraw license key provided!","A license is required for production deployments.",`Please reach out to ${qw} to purchase a license.`]:["Invalid license key. tldraw requires a valid license for production use.",`Please reach out to ${qw} to purchase a license.`]),"unlicensed-production");if(!a.isDomainValid&&!a.isDevelopment)return b(["License key is not valid for this domain.","A license is required for production deployments.",`Please reach out to ${qw} to purchase a license.`]),"unlicensed-production";if(a.isEvaluationLicense)if(a.isEvaluationLicenseExpired)return b(["Your tldraw evaluation license has expired!",`Please reach out to ${qw} to purchase a full license.`]),"expired";else return"licensed";if(a.isPerpetualLicenseExpired||a.isAnnualLicenseExpired)return b(["Your tldraw license has been expired for more than 30 days!",`Please reach out to ${qw} to renew your license.`]),"expired";let d=a.daysSinceExpiry;return d>0&&!a.isEvaluationLicense?(b(["Your tldraw license has expired.",`License expired ${d} days ago.`,`Please reach out to ${qw} to renew your license.`]),"licensed"):a.isLicensedWithWatermark?"licensed-with-watermark":"licensed"}(a,a=>this.outputMessages(a),this.isDevelopment);this.maybeTrack(a,b),this.state.set(b)}).catch(a=>{console.error("License validation failed:",a),this.state.set("unlicensed")})}getIsDevelopment(){return!["https:","vscode-webview:"].includes(window.location.protocol)||"localhost"===window.location.hostname}getTrackType(a,b){return"unlicensed-production"===b?"unlicensed":this.isDevelopment||!a.isLicenseParseable?null:a.isEvaluationLicense?"evaluation":"licensed-with-watermark"===b?"with_watermark":null}maybeTrack(a,b){let c=this.getTrackType(a,b);if(!c)return;let d=new URL(qx);if(d.searchParams.set("version",kJ),d.searchParams.set("license_type",c),"license"in a){d.searchParams.set("license_id",a.license.id);let b=this.isFlagEnabled(a.license.flags,qs.EVALUATION_LICENSE)?"evaluation":this.isFlagEnabled(a.license.flags,qs.ANNUAL_LICENSE)?"annual":this.isFlagEnabled(a.license.flags,qs.PERPETUAL_LICENSE)?"perpetual":"unknown";d.searchParams.set("sku",b)}d.searchParams.set("url",window.location.href),d.searchParams.set("environment","production"),fetch(d.toString())}async extractLicenseKey(a){let b,c,d,[e,f]=a.split("."),[g,h]=e.split("/");if(!g.startsWith("tldraw-"))throw Error(`Unsupported prefix '${g}'`);let i=await (d=qr(atob(this.publicKey)),crypto.subtle.importKey("spki",new Uint8Array(d),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"]));try{b=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},i,new Uint8Array(qr(atob(f))),new Uint8Array(qr(atob(h))))}catch(a){throw console.error(a),Error("Could not perform signature validation")}if(!b)throw Error("Invalid signature");try{c=JSON.parse(atob(h))}catch{throw Error("Could not parse object")}return c.length>qv&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[qu.ID],hosts:c[qu.HOSTS],flags:c[qu.FLAGS],expiryDate:c[qu.EXPIRY_DATE]}}async getLicenseFromKey(a){if(!a)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let b=a.replace(/[\u200B-\u200D\uFEFF]/g,"");b=b.replace(/\r?\n|\r/g,"");try{let a=await this.extractLicenseKey(b),c=new Date(a.expiryDate),d=this.isFlagEnabled(a.flags,qs.ANNUAL_LICENSE),e=this.isFlagEnabled(a.flags,qs.PERPETUAL_LICENSE),f=this.isFlagEnabled(a.flags,qs.EVALUATION_LICENSE),g=this.getDaysSinceExpiry(c),h={license:a,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(a),expiryDate:c,isAnnualLicense:d,isAnnualLicenseExpired:d&&this.isAnnualLicenseExpired(c),isPerpetualLicense:e,isPerpetualLicenseExpired:e&&this.isPerpetualLicenseExpired(c),isInternalLicense:this.isFlagEnabled(a.flags,qs.INTERNAL_LICENSE),isNativeLicense:this.isNativeLicense(a),isLicensedWithWatermark:this.isFlagEnabled(a.flags,qs.WITH_WATERMARK),isEvaluationLicense:f,isEvaluationLicenseExpired:f&&this.isEvaluationLicenseExpired(c),daysSinceExpiry:g};return this.outputLicenseInfoIfNeeded(h),h}catch(a){return this.outputInvalidLicenseKey(a.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(a){let b=window.location.hostname.toLowerCase();return a.hosts.some(c=>{let d=c.toLowerCase().trim();if(d===b||`www.${d}`===b||d===`www.${b}`||"*"===c)return!0;if(this.isNativeLicense(a))return new RegExp(d).test(window.location.href);if(c.includes("*")){let a=new RegExp(c.replace(/\*/g,".*?"));return a.test(b)||a.test(`www.${b}`)}return"vscode-webview:"===window.location.protocol&&d===new URL(window.location.href).searchParams.get("extensionId")||!1})}isNativeLicense(a){return this.isFlagEnabled(a.flags,qs.NATIVE_LICENSE)}getExpirationDateWithoutGracePeriod(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())}getExpirationDateWithGracePeriod(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate()+30+1)}isAnnualLicenseExpired(a){let b=this.getExpirationDateWithGracePeriod(a);return new Date>=b}isPerpetualLicenseExpired(a){let b=this.getExpirationDateWithGracePeriod(a),c={major:new Date("2025-09-18T14:39:22.803Z"),minor:new Date("2025-11-19T11:47:45.748Z")};return c.major>=b||c.minor>=b}getDaysSinceExpiry(a){let b=new Date,c=this.getExpirationDateWithoutGracePeriod(a);return Math.max(0,Math.floor((b.getTime()-c.getTime())/864e5))}isEvaluationLicenseExpired(a){return new Date>=this.getExpirationDateWithoutGracePeriod(a)}isFlagEnabled(a,b){return(a&b)===b}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(a){this.outputMessages(["Invalid tldraw license key",`Reason: ${a}`])}outputLicenseInfoIfNeeded(a){a.license.flags>=2*qt&&this.outputMessages(["Warning: This tldraw license contains some unknown flags.","This will still work, however, you may want to update tldraw packages to a newer version to get access to new functionality."],"warning")}outputMessages(a,b="error"){if(!this.isTest&&this.verbose){for(let c of(this.outputDelimiter(),a)){let a="warning"===b?"orange":"crimson",d="warning"===b?"orange":"crimson";console.log(`%c${c}`,`color: ${a}; background: ${d}; padding: 2px; border-radius: 3px;`)}this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}static className="tl-watermark_SEE-LICENSE"}let qz={get url(){return`file://${a.P("node_modules/@tldraw/editor/dist-esm/lib/license/LicenseProvider.mjs")}`}},qA=(0,eQ.createContext)({});function qB(a){return"expired"===a||"unlicensed-production"===a}function qC({licenseKey:a=(void 0!==j?j:j=qE(()=>process.env.TLDRAW_LICENSE_KEY)||qE(()=>process.env.NEXT_PUBLIC_TLDRAW_LICENSE_KEY)||qE(()=>process.env.REACT_APP_TLDRAW_LICENSE_KEY)||qE(()=>process.env.GATSBY_TLDRAW_LICENSE_KEY)||qE(()=>process.env.VITE_TLDRAW_LICENSE_KEY)||qE(()=>process.env.PUBLIC_TLDRAW_LICENSE_KEY)||qE(()=>qz.env.TLDRAW_LICENSE_KEY)||qE(()=>qz.env.NEXT_PUBLIC_TLDRAW_LICENSE_KEY)||qE(()=>qz.env.REACT_APP_TLDRAW_LICENSE_KEY)||qE(()=>qz.env.GATSBY_TLDRAW_LICENSE_KEY)||qE(()=>qz.env.VITE_TLDRAW_LICENSE_KEY)||qE(()=>qz.env.PUBLIC_TLDRAW_LICENSE_KEY)||null)??void 0,children:b}){let[c]=(0,eQ.useState)(()=>new qy(a)),d=e$(c.state),[e,f]=(0,eQ.useState)(!0);return((0,eQ.useEffect)(()=>{if(qB(d)&&e){let a=setTimeout(()=>{f(!1)},5e3);return()=>clearTimeout(a)}},[d,e]),qB(d)&&!e)?(0,bT.jsx)(qD,{}):(0,bT.jsx)(qA.Provider,{value:c,children:b})}function qD(){return(0,bT.jsx)("div",{"data-testid":"tl-license-expired",style:{display:"none"}})}function qE(a){try{return a()}catch{return}}function qF(a){if(!a)throw Error("usePassThroughWheelEvents must be passed a ref");let b=kv(),c=kq();(0,eQ.useEffect)(()=>{function d(d){if(!c?.getInstanceState().isFocused||d.isSpecialRedispatchedEvent)return;let e=a.current;if(e&&e.scrollHeight>e.clientHeight)return;kb(d);let f=b.querySelector(".tl-canvas");if(!f)return;let g=new WheelEvent("wheel",d);g.isSpecialRedispatchedEvent=!0,f.dispatchEvent(g)}let e=a.current;if(e)return e.addEventListener("wheel",d,{passive:!1}),()=>{e.removeEventListener("wheel",d)}},[b,c,a])}let qG=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>')}`,qH=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>')}`,qI=(0,eQ.memo)(function(){var a;let b=(0,eQ.useContext)(qA),c=kp(),d=e$("is mobile",()=>c.getViewportScreenBounds().width<700,[c]),e=e$("watermarkState",()=>a.state.get(),[a=b]);return["licensed-with-watermark","unlicensed"].includes(e)?(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(qL,{}),(0,bT.jsx)(qK,{src:d?qH:qG,isUnlicensed:"unlicensed"===e})]}):null}),qJ=(0,eQ.memo)(function({isDebugMode:a,isMobile:b}){let c=kp(),d=ks(),e=(0,eQ.useRef)(null);return qF(e),(0,bT.jsx)("div",{ref:e,className:qy.className,"data-debug":a,"data-mobile":b,"data-unlicensed":!0,"data-testid":"tl-watermark-unlicensed",draggable:!1,...d,children:(0,bT.jsx)("button",{draggable:!1,role:"button",onPointerDown:a=>{c.markEventAsHandled(a),kb(a)},title:"The tldraw SDK requires a license key to work in production. You can get a free 100-day trial license at tldraw.dev/pricing.",onClick:()=>{kz.openWindow("https://tldraw.dev/pricing?utm_source=sdk&utm_medium=organic&utm_campaign=watermark","_blank",!0)},children:"Get a license for production"})})}),qK=(0,eQ.memo)(function({src:a,isUnlicensed:b}){let c=kp(),d=e$("debug mode",()=>c.getInstanceState().isDebugMode,[c]),e=e$("is mobile",()=>c.getViewportScreenBounds().width<700,[c]),f=ks(),g=(0,eQ.useRef)(null);qF(g);let h=`url('${a}') center 100% / 100% no-repeat`;return b?(0,bT.jsx)(qJ,{isDebugMode:d,isMobile:e}):(0,bT.jsx)("div",{ref:g,className:qy.className,"data-debug":d,"data-mobile":e,"data-testid":"tl-watermark-licensed",draggable:!1,...f,children:(0,bT.jsx)("button",{draggable:!1,role:"button",onPointerDown:a=>{c.markEventAsHandled(a),kb(a)},title:"Build infinite canvas applications with the tldraw SDK. Learn more at https://tldraw.dev.",onClick:()=>{kz.openWindow("https://tldraw.dev/?utm_source=sdk&utm_medium=organic&utm_campaign=watermark","_blank")},style:{mask:h,WebkitMask:h}})})}),qL=(0,eQ.memo)(function(){let a=kp(),b=qy.className,c=`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${b} {
	position: absolute;
	bottom: max(var(--tl-space-2), env(safe-area-inset-bottom));
	right: max(var(--tl-space-2), env(safe-area-inset-right));
	width: 96px;
	height: 32px;
	display: flex;
	align-items: center;
	justify-content: center;
	z-index: var(--tl-layer-watermark) !important;
	background-color: color-mix(in srgb, var(--tl-color-background) 62%, transparent);
	opacity: 1;
	border-radius: 5px;
	pointer-events: all;
	padding: 2px;
	box-sizing: content-box;
}

.${b} > button {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: all;
	cursor: inherit;
	color: var(--tl-color-text);
	opacity: .38;
	border: 0;
	padding: 0;
	background-color: currentColor;
}

.${b}[data-debug='true'] {
	bottom: max(46px, env(safe-area-inset-bottom));
}

.${b}[data-mobile='true'] {
	border-radius: 4px 0px 0px 4px;
	right: max(-2px, calc(env(safe-area-inset-right) - 2px));
	width: 8px;
	height: 48px;
}

.${b}[data-mobile='true'] > button {
	width: 8px;
	height: 32px;
}

.${b}[data-unlicensed='true'] > button {
	font-size: 100px;
	position: absolute;
	pointer-events: all;
	cursor: pointer;
	color: var(--tl-color-text);
	opacity: 0.8;
	border: 0;
	padding: 0;
	background-color: transparent;
	font-size: 11px;
	font-weight: 600;
	text-align: center;
}

.${b}[data-mobile='true'][data-unlicensed='true'] > button {
	display: none;
}

@media (hover: hover) {
	.${b} > button {
		pointer-events: none;
	}

	.${b}:hover {
		background-color: var(--tl-color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}

	.${b}:hover > button {
		animation: ${b}_delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}

	.${b} > button:focus-visible {
		opacity: 1;
	}
}

@keyframes ${b}_delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}`;return(0,bT.jsx)("style",{nonce:a.options.nonce,children:c})}),qM=[],qN=[],qO=[],qP=(0,eQ.memo)(function({store:a,components:b,className:c,user:d,options:e,...f}){let[g,h]=(0,eQ.useState)(null),i=(0,eQ.useMemo)(()=>d??k3(),[d]),j=b?.ErrorFallback===void 0?kF:b?.ErrorFallback,k={...f,shapeUtils:f.shapeUtils??qM,bindingUtils:f.bindingUtils??qN,tools:f.tools??qO,components:b,options:kK(e,kM)};return(0,bT.jsx)("div",{ref:h,"data-tldraw":kJ,draggable:!1,className:(0,j1.default)("tl-container tl-theme__light",c),tabIndex:-1,role:"application","aria-label":e?.branding??"tldraw",children:(0,bT.jsx)(kE,{fallback:j,onError:a=>co(a,{tags:{origin:"react.tldraw-before-app"}}),children:g&&(0,bT.jsx)(qC,{licenseKey:f.licenseKey,children:(0,bT.jsx)(ku,{container:g,children:(0,bT.jsx)(rd,{overrides:b,children:a?a instanceof f2?(0,bT.jsx)(qT,{...k,store:a,user:i}):(0,bT.jsx)(qR,{...k,store:a,user:i}):(0,bT.jsx)(qQ,{...k,store:a,user:i})})})})})})});function qQ(a){let{defaultName:b,snapshot:c,initialData:d,shapeUtils:e,bindingUtils:f,persistenceKey:g,sessionId:h,user:i,assets:j,migrations:k}=a,l=function(a){let[b,c]=qq({status:"loading"});return a=kK(a,kM),(0,eQ.useEffect)(()=>{let{persistenceKey:b,sessionId:d,...e}=a;if(!b)return void c({status:"not-synced",store:p_(e)});c({status:"loading"});let f=new cl,g={upload:async(a,b)=>(await j.db.storeAsset(a.id,b),{src:a.id}),resolve:async a=>a.props.src?a.props.src.startsWith("asset:")?await f.get(a,async()=>{let b=await j.db.getAsset(a.id);return b?URL.createObjectURL(b):null}):a.props.src:null,remove:async a=>{await j.db.removeAssets(a)},...e.assets},h=p_({...e,assets:g}),i=!1,j=new qp(h,{sessionId:d,persistenceKey:b,onLoad(){i||c({store:h,status:"synced-local"})},onLoadError(a){i||c({status:"error",error:a})}});return()=>{i=!0,j.close()}},[a,c]),b}({shapeUtils:e,bindingUtils:f,initialData:d,persistenceKey:g,sessionId:h,defaultName:b,snapshot:c,assets:j,migrations:k});return(0,bT.jsx)(qR,{...a,store:l,user:i})}let qR=(0,eQ.memo)(function({store:a,user:b,...c}){let d=kv();(0,eQ.useLayoutEffect)(()=>{"dark"===b.userPreferences.get().colorScheme&&(d.classList.remove("tl-theme__light"),d.classList.add("tl-theme__dark"))},[d,b]);let{LoadingScreen:e}=re();switch(a.status){case"error":throw a.error;case"loading":return e?(0,bT.jsx)(e,{}):null}return(0,bT.jsx)(qT,{...c,store:a.store,user:b})}),qS=()=>document.location.search.includes("tldraw_preserve_focus");function qT({onMount:a,children:b,store:c,tools:d,shapeUtils:e,bindingUtils:f,user:g,initialState:h,autoFocus:i=!0,inferDarkMode:j,cameraOptions:k,textOptions:l,options:m,licenseKey:n,deepLinks:o,getShapeVisibility:p,assetUrls:q}){let{ErrorFallback:r}=re(),s=kv(),[t,u]=qq(null),v=(0,eQ.useRef)(null),w=kK(!0===o?{}:o,kM),y=(0,eQ.useRef)({autoFocus:i&&!qS(),inferDarkMode:j,initialState:h,cameraOptions:k,deepLinks:w});(0,eQ.useLayoutEffect)(()=>{y.current={autoFocus:i&&!qS(),inferDarkMode:j,initialState:h,cameraOptions:k,deepLinks:w}},[i,j,h,k,w]),(0,eQ.useLayoutEffect)(()=>{let{autoFocus:a,inferDarkMode:b,initialState:h,cameraOptions:i,deepLinks:j}=y.current,k=new pM({store:c,shapeUtils:e,bindingUtils:f,tools:d,getContainer:()=>s,user:g,initialState:h,autoFocus:a,inferDarkMode:b,cameraOptions:i,textOptions:l,options:m,licenseKey:n,getShapeVisibility:p,fontAssetUrls:q?.fonts});return k.updateViewportScreenBounds(v.current??s),j&&(j?.getUrl?k.navigateToDeepLink({...j,url:j.getUrl(k)}):k.navigateToDeepLink(j)),u(k),()=>{k.dispose()}},[f,s,m,e,c,d,g,u,n,p,l,q]),(0,eQ.useLayoutEffect)(()=>{if(t&&w)return t.registerDeepLinkListener(w)},[t,w]),(0,eQ.useLayoutEffect)(()=>{t&&k&&t.setCameraOptions(k)},[t,k]);let z=(0,eQ.useSyncExternalStore)((0,eQ.useCallback)(a=>t?(t.on("crash",a),()=>t.off("crash",a)):()=>{},[t]),()=>t?.getCrashingError()??null);(0,eQ.useEffect)(function(){if(t&&i&&qS())return t.getContainer().addEventListener("pointerdown",a),document.body.addEventListener("pointerdown",b),()=>{t.getContainer()?.removeEventListener("pointerdown",a),document.body.removeEventListener("pointerdown",b)};function a(){t&&t.focus()}function b(){t&&t.blur()}},[t,i]);let[A,B]=(0,eQ.useState)(null),C=A;t!==C?.editor&&(C=null),(0,eQ.useLayoutEffect)(()=>{if(!t)return;if(0===t.options.maxFontsToLoadBeforeRender)return void B({editor:t,isLoaded:!0});let a=!1;return B({editor:t,isLoaded:!1}),t.fonts.loadRequiredFontsForCurrentPage(t.options.maxFontsToLoadBeforeRender).finally(()=>{a||B({editor:t,isLoaded:!0})}),()=>{a=!0}},[t]);let{Canvas:D,LoadingScreen:E}=re();return t&&C?.isLoaded?(0,bT.jsx)(kE,{fallback:r,onError:a=>t.annotateError(a,{origin:"react.tldraw",willCrashApp:!0}),children:z?(0,bT.jsx)(qV,{crashingError:z}):(0,bT.jsx)(kr,{editor:t,children:(0,bT.jsxs)(qU,{onMount:a,children:[b??(D?(0,bT.jsx)(D,{},t.contextId):null),(0,bT.jsx)(qI,{})]})})}):(0,bT.jsxs)(bT.Fragment,{children:[E&&(0,bT.jsx)(E,{}),(0,bT.jsx)("div",{className:"tl-canvas",ref:v})]})}function qU({children:a,onMount:b}){let c,d,e,f,g,h,i,j,k,l;return c=kp(),d=kv(),eQ.useEffect(()=>{let a=a=>d.style.setProperty("--tl-zoom",a.toString()),b=cm(a,100),e=new ef("useZoomCss",()=>{c.getCurrentPageShapeIds().size<300?a(c.getZoomLevel()):b(c.getZoomLevel())});return e.attach(),e.execute(),()=>{e.detach(),b.cancel()}},[c,d]),e=kp(),f=kv(),eY("useCursor",()=>{let{type:a,rotation:b}=e.getInstanceState().cursor;pW.includes(a)?f.style.setProperty("--tl-cursor",`var(--tl-cursor-${a})`):f.style.setProperty("--tl-cursor",pY(a,b,g?"white":"black"))},[e,f,g=pR()]),h=kp(),i=kv(),j=pR(),k=e$(j7.forceSrgb),eQ.default.useEffect(()=>{j?(i.setAttribute("data-color-mode","dark"),i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark")):(i.setAttribute("data-color-mode","light"),i.classList.remove("tl-theme__dark"),i.classList.add("tl-theme__light")),k?i.classList.add("tl-theme__force-sRGB"):i.classList.remove("tl-theme__force-sRGB")},[h,i,k,j]),function(){let[a,b]=(0,eQ.useState)(0);(0,eQ.useEffect)(()=>b(a=>a+1),[])}(),l=kp(),(0,eQ.useLayoutEffect)(()=>eg("stateAttribute",()=>{l.getContainer().setAttribute("data-state",l.getPath())}),[l]),qX(a=>{let c=a.store.props.onMount(a),d=b?.(a);return()=>{c?.(),d?.()}}),a}function qV({crashingError:a}){throw a}function qW({children:a}){return(0,bT.jsx)("div",{className:"tl-loading","aria-busy":"true",tabIndex:0,children:a})}function qX(a){let b=kp(),c=mA(b=>{let c;return b.run(()=>{c=a?.(b),b.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,c});eQ.default.useLayoutEffect(()=>{if(b)return c?.(b)},[b,c])}let qY=()=>{let{Spinner:a}=re();return(0,bT.jsx)(qW,{children:a?(0,bT.jsx)(a,{}):null})};function qZ(a,b=!0){let c=a.length;if(c<2)return"";let d=a[0],e=a[1];if(2===c)return`M${jC(d)}L${jC(e)}`;let f="";for(let b=2,g=c-1;b<g;b++)f+=jD(d=a[b],e=a[b+1]);return b?`M${jD(a[0],a[1])}Q${jC(a[1])}${jD(a[1],a[2])}T${f}${jD(a[c-1],a[0])}${jD(a[0],a[1])}Z`:`M${jC(a[0])}Q${jC(a[1])}${jD(a[1],a[2])}${a.length>3?"T":""}${f}L${jC(a[c-1])}`}function q$({scribble:a,zoom:b,color:c,opacity:d,className:e}){return a.points.length?(0,bT.jsx)("svg",{className:e?(0,j1.default)("tl-overlays__item",e):e,children:(0,bT.jsx)("path",{className:"tl-scribble",d:qZ(a.points,!1),stroke:c??`var(--tl-color-${a.color})`,fill:"none",strokeWidth:8/b,opacity:d??a.opacity})}):null}function q_({bounds:a,rotation:b}){let c=kp(),d=(0,eQ.useRef)(null),e=e$("only selected shape",()=>c.getOnlySelectedShape(),[c]),f=e?c.getShapeUtil(e).expandSelectionOutlinePx(e):0;return js(d,a?.x,a?.y,1,b,{x:-f,y:-f}),a=f instanceof lh?a.clone().expand(f).zeroFix():a.clone().expandBy(f).zeroFix(),(0,bT.jsx)("svg",{ref:d,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,bT.jsx)("rect",{className:(0,j1.default)("tl-selection__fg__outline"),width:jX(a.width),height:jX(a.height)})})}let q0=()=>(0,bT.jsx)("div",{className:"tl-shape-error-boundary"}),q1=(0,eQ.memo)(({shape:a,util:b})=>eR("Indicator: "+a.type,()=>b.indicator(b.editor.store.unsafeGetWithoutCapture(a.id))),(a,b)=>a.shape.props===b.shape.props&&a.shape.meta===b.shape.meta),q2=(0,eQ.memo)(({editor:a,id:b})=>{let c=e$("shape for indicator",()=>a.store.get(b),[a,b]),{ShapeIndicatorErrorFallback:d}=re();return!c||c.isLocked?null:(0,bT.jsx)(kE,{fallback:d,onError:b=>a.annotateError(b,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,bT.jsx)(q1,{shape:c,util:a.getShapeUtil(c)},c.id)})}),q3=(0,eQ.memo)(function({shapeId:a,className:b,color:c,hidden:d,opacity:e}){let f=kp(),g=(0,eQ.useRef)(null);return eY("indicator transform",()=>{if(d)return;let b=g.current;if(!b)return;let c=f.getShapePageTransform(a);c&&b.style.setProperty("transform",c.toCssString())},[f,a,d]),(0,eQ.useLayoutEffect)(()=>{let a=g.current;a&&a.style.setProperty("display",d?"none":"block")},[d]),(0,bT.jsx)("svg",{ref:g,className:(0,j1.default)("tl-overlays__item",b),"aria-hidden":"true",children:(0,bT.jsx)("g",{className:"tl-shape-indicator",stroke:c??"var(--tl-color-selected)",opacity:e,children:(0,bT.jsx)(q2,{editor:f,id:a})})})}),q4=()=>(0,bT.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),q5=(0,eQ.memo)(function({hideAll:a,showAll:b}){let c=kp();if(a&&b)throw Error("You cannot set both hideAll and showAll props to true, cmon now");let d=(0,eQ.useRef)(new Set),e=e$("should display selected ids",()=>{let a=d.current,b=new Set,e=c.getInstanceState(),f=e.isChangingStyle,g=c.isInAny("select.idle","select.editing_shape"),h=c.isInAny("select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle");if(f||!(g||h))return d.current=b,b;for(let a of c.getSelectedShapeIds())b.add(a);if(g&&e.isHoveringCanvas&&!e.isCoarsePointer){let a=c.getHoveredShapeId();a&&b.add(a)}if(a.size!==b.size)return d.current=b,b;for(let c of b)if(!a.has(c))return d.current=b,b;return a},[c]),f=e$("rendering shapes",()=>c.getRenderingShapes(),[c]),{ShapeIndicator:g}=re();return g?f.map(({id:c})=>(0,bT.jsx)(g,{shapeId:c,hidden:!b&&(a||!e.has(c))},c+"_indicator")):null}),q6=(0,eQ.forwardRef)(function({children:a,shape:b,isBackground:c,...d},e){let f="fill"in b.props&&"none"!==b.props.fill;return(0,bT.jsx)("div",{ref:e,"data-shape-type":b.type,"data-shape-is-filled":c?void 0:f,"data-shape-id":b.id,draggable:!1,...d,className:(0,j1.default)("tl-shape",c&&"tl-shape-background",d.className),children:a})});function q7({points:a,zoom:b}){let c,d,e,f,g=2.5/b,h=a.reduce((a,b)=>Math.min(a,b.x),1/0),i=a.reduce((a,b)=>Math.max(a,b.x),-1/0),j=a.reduce((a,b)=>Math.min(a,b.y),1/0),k=a.reduce((a,b)=>Math.max(a,b.y),-1/0);return a.some(a=>a.x===h&&a.y===j)?(c=h,d=j,e=i,f=k):(c=h,d=k,e=i,f=j),(0,bT.jsxs)("g",{className:"tl-snap-indicator",stroke:"lime",children:[(0,bT.jsx)("line",{x1:c,y1:d,x2:e,y2:f}),a.map((a,b)=>(0,bT.jsx)("g",{transform:`translate(${a.x},${a.y})`,children:(0,bT.jsx)("path",{className:"tl-snap-point",d:`M ${-g},${-g} L ${g},${g} M ${-g},${g} L ${g},${-g}`})},b))]})}function q8({gaps:a,direction:b,zoom:c}){let d=3.5/c,e=[-1/0,1/0],f=null,g="horizontal"===b;for(let b of a){if(f=jU(e[0],e[1],g?b.startEdge[0].y:b.startEdge[0].x,g?b.startEdge[1].y:b.startEdge[1].x))(f=jU((e=f)[0],e[1],g?b.endEdge[0].y:b.endEdge[0].x,g?b.endEdge[1].y:b.endEdge[1].x))&&(e=f)}if(null===e)return null;let h=(e[0]+e[1])/2;return(0,bT.jsx)("g",{className:"tl-snap-indicator",stroke:"cyan",children:a.map(({startEdge:a,endEdge:b},c)=>(0,bT.jsx)(eQ.Fragment,{children:g?(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("line",{x1:a[0].x,y1:h-2*d,x2:a[1].x,y2:h+2*d}),(0,bT.jsx)("line",{x1:b[0].x,y1:h-2*d,x2:b[1].x,y2:h+2*d}),(0,bT.jsx)("line",{x1:a[0].x,y1:h,x2:b[0].x,y2:h}),(0,bT.jsx)("line",{x1:(a[0].x+b[0].x)/2,y1:h-d,x2:(a[0].x+b[0].x)/2,y2:h+d})]}):(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("line",{x1:h-2*d,y1:a[0].y,x2:h+2*d,y2:a[1].y}),(0,bT.jsx)("line",{x1:h-2*d,y1:b[0].y,x2:h+2*d,y2:b[1].y}),(0,bT.jsx)("line",{x1:h,y1:a[0].y,x2:h,y2:b[0].y}),(0,bT.jsx)("line",{x1:h-d,y1:(a[0].y+b[0].y)/2,x2:h+d,y2:(a[0].y+b[0].y)/2})]})},c))})}function q9({className:a,line:b,zoom:c}){return(0,bT.jsx)("svg",{className:(0,j1.default)("tl-overlays__item",a),"aria-hidden":"true",children:"points"===b.type?(0,bT.jsx)(q7,{...b,zoom:c}):"gaps"===b.type?(0,bT.jsx)(q8,{...b,zoom:c}):null})}function ra(a){return(0,bT.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16","aria-hidden":"false",...a,className:(0,j1.default)("tl-spinner",a.className),children:(0,bT.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,bT.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,bT.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor"})]})})}let rb=()=>null,rc=(0,eQ.createContext)(null);function rd({overrides:a={},children:b}){let c=kK(a,kM),d=(0,eQ.useMemo)(()=>({Background:jr,Brush:j0,Canvas:r6,CollaboratorBrush:j0,CollaboratorCursor:ky,CollaboratorHint:kx,CollaboratorScribble:q$,CollaboratorShapeIndicator:q3,Cursor:ky,Grid:kG,Handle:kH,Handles:kI,InFrontOfTheCanvas:null,LoadingScreen:qY,OnTheCanvas:null,Overlays:null,Scribble:q$,SelectionBackground:null,SelectionForeground:q_,ShapeIndicator:q3,ShapeIndicators:q5,ShapeWrapper:q6,SnapIndicator:q9,Spinner:ra,SvgDefs:rb,ZoomBrush:j0,ErrorFallback:kF,ShapeErrorFallback:q0,ShapeIndicatorErrorFallback:q4,...c}),[c]);return(0,bT.jsx)(rc.Provider,{value:d,children:b})}function re(){let a=(0,eQ.useContext)(rc);if(!a)throw Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return a}let rf=["textarea","input"];a.s([],78452);let rg={toVector:(a,b)=>(void 0===a&&(a=b),Array.isArray(a)?a:[a,a]),add:(a,b)=>[a[0]+b[0],a[1]+b[1]],sub:(a,b)=>[a[0]-b[0],a[1]-b[1]],addTo(a,b){a[0]+=b[0],a[1]+=b[1]},subTo(a,b){a[0]-=b[0],a[1]-=b[1]}};function rh(a,b,c){return 0===b||Math.abs(b)===1/0?Math.pow(a,5*c):a*b*c/(b+c*a)}function ri(a,b,c,d=.15){return 0===d?Math.max(b,Math.min(a,c)):a<b?-rh(b-a,c-b,d)+b:a>c?+rh(a-c,c-b,d)+c:a}function rj(a,b,c){var d;return(b="symbol"==typeof(d=function(a,b){if("object"!=typeof a||null===a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=typeof d)return d;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}(b,"string"))?d:String(d))in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function rk(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function rl(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?rk(Object(c),!0).forEach(function(b){rj(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):rk(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}let rm={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function rn(a){return a?a[0].toUpperCase()+a.slice(1):""}let ro=["enter","leave"],rp=["gotpointercapture","lostpointercapture"];function rq(a){return"touches"in a}function rr(a,b){try{let c=b.clientX-a.clientX,d=b.clientY-a.clientY,e=(b.clientX+a.clientX)/2,f=(b.clientY+a.clientY)/2,g=Math.hypot(c,d);return{angle:-(180*Math.atan2(c,d))/Math.PI,distance:g,origin:[e,f]}}catch(a){}return null}function rs(a,b){let[c,d]=Array.from(a.touches).filter(a=>b.includes(a.identifier));return rr(c,d)}function rt(a){let{deltaX:b,deltaY:c,deltaMode:d}=a;return 1===d?(b*=40,c*=40):2===d&&(b*=800,c*=800),[b,c]}function ru(a,...b){return"function"==typeof a?a(...b):a}function rv(){}function rw(a,b){return Object.assign({},b,a||{})}class rx{constructor(a,b,c){this.ctrl=a,this.args=b,this.key=c,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(a){this.ctrl.state[this.key]=a}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:a,shared:b,ingKey:c,args:d}=this;b[c]=a._active=a.active=a._blocked=a._force=!1,a._step=[!1,!1],a.intentional=!1,a._movement=[0,0],a._distance=[0,0],a._direction=[0,0],a._delta=[0,0],a._bounds=[[-1/0,1/0],[-1/0,1/0]],a.args=d,a.axis=void 0,a.memo=void 0,a.elapsedTime=a.timeDelta=0,a.direction=[0,0],a.distance=[0,0],a.overflow=[0,0],a._movementBound=[!1,!1],a.velocity=[0,0],a.movement=[0,0],a.delta=[0,0],a.timeStamp=0}start(a){let b=this.state,c=this.config;b._active||(this.reset(),this.computeInitial(),b._active=!0,b.target=a.target,b.currentTarget=a.currentTarget,b.lastOffset=c.from?ru(c.from,b):b.offset,b.offset=b.lastOffset,b.startTime=b.timeStamp=a.timeStamp)}computeValues(a){let b=this.state;b._values=a,b.values=this.config.transform(a)}computeInitial(){let a=this.state;a._initial=a._values,a.initial=a.values}compute(a){let{state:b,config:c,shared:d}=this;b.args=this.args;let e=0;if(a&&(b.event=a,c.preventDefault&&a.cancelable&&b.event.preventDefault(),b.type=a.type,d.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,d.locked=!!document.pointerLockElement,Object.assign(d,function(a){let b={};if("buttons"in a&&(b.buttons=a.buttons),"shiftKey"in a){let{shiftKey:c,altKey:d,metaKey:e,ctrlKey:f}=a;Object.assign(b,{shiftKey:c,altKey:d,metaKey:e,ctrlKey:f})}return b}(a)),d.down=d.pressed=d.buttons%2==1||d.touches>0,e=a.timeStamp-b.timeStamp,b.timeStamp=a.timeStamp,b.elapsedTime=b.timeStamp-b.startTime),b._active){let a=b._delta.map(Math.abs);rg.addTo(b._distance,a)}this.axisIntent&&this.axisIntent(a);let[f,g]=b._movement,[h,i]=c.threshold,{_step:j,values:k}=b;if(c.hasCustomTransform?(!1===j[0]&&(j[0]=Math.abs(f)>=h&&k[0]),!1===j[1]&&(j[1]=Math.abs(g)>=i&&k[1])):(!1===j[0]&&(j[0]=Math.abs(f)>=h&&Math.sign(f)*h),!1===j[1]&&(j[1]=Math.abs(g)>=i&&Math.sign(g)*i)),b.intentional=!1!==j[0]||!1!==j[1],!b.intentional)return;let l=[0,0];if(c.hasCustomTransform){let[a,b]=k;l[0]=!1!==j[0]?a-j[0]:0,l[1]=!1!==j[1]?b-j[1]:0}else l[0]=!1!==j[0]?f-j[0]:0,l[1]=!1!==j[1]?g-j[1]:0;this.restrictToAxis&&!b._blocked&&this.restrictToAxis(l);let m=b.offset,n=b._active&&!b._blocked||b.active;n&&(b.first=b._active&&!b.active,b.last=!b._active&&b.active,b.active=d[this.ingKey]=b._active,a&&(b.first&&("bounds"in c&&(b._bounds=ru(c.bounds,b)),this.setup&&this.setup()),b.movement=l,this.computeOffset()));let[o,p]=b.offset,[[q,r],[s,t]]=b._bounds;b.overflow=[o<q?-1:+(o>r),p<s?-1:+(p>t)],b._movementBound[0]=!!b.overflow[0]&&(!1===b._movementBound[0]?b._movement[0]:b._movementBound[0]),b._movementBound[1]=!!b.overflow[1]&&(!1===b._movementBound[1]?b._movement[1]:b._movementBound[1]);let u=b._active&&c.rubberband||[0,0];if(b.offset=function(a,[b,c],[d,e]){let[[f,g],[h,i]]=a;return[ri(b,f,g,d),ri(c,h,i,e)]}(b._bounds,b.offset,u),b.delta=rg.sub(b.offset,m),this.computeMovement(),n&&(!b.last||e>32)){b.delta=rg.sub(b.offset,m);let a=b.delta.map(Math.abs);rg.addTo(b.distance,a),b.direction=b.delta.map(Math.sign),b._direction=b._delta.map(Math.sign),!b.first&&e>0&&(b.velocity=[a[0]/e,a[1]/e],b.timeDelta=e)}}emit(){let a=this.state,b=this.shared,c=this.config;if(a._active||this.clean(),(a._blocked||!a.intentional)&&!a._force&&!c.triggerAllEvents)return;let d=this.handler(rl(rl(rl({},b),a),{},{[this.aliasKey]:a.values}));void 0!==d&&(a.memo=d)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class ry extends rx{constructor(...a){super(...a),rj(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=rg.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=rg.sub(this.state.offset,this.state.lastOffset)}axisIntent(a){let b=this.state,c=this.config;if(!b.axis&&a){let d="object"==typeof c.axisThreshold?c.axisThreshold[rq(a)?"touch":"pointerType"in a?a.pointerType:"mouse"]:c.axisThreshold;b.axis=function([a,b],c){let d=Math.abs(a),e=Math.abs(b);return d>e&&d>c?"x":e>d&&e>c?"y":void 0}(b._movement,d)}b._blocked=(c.lockDirection||!!c.axis)&&!b.axis||!!c.axis&&c.axis!==b.axis}restrictToAxis(a){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":a[1]=0;break;case"y":a[0]=0}}}let rz=a=>a,rA={enabled:(a=!0)=>a,eventOptions:(a,b,c)=>rl(rl({},c.shared.eventOptions),a),preventDefault:(a=!1)=>a,triggerAllEvents:(a=!1)=>a,rubberband(a=0){switch(a){case!0:return[.15,.15];case!1:return[0,0];default:return rg.toVector(a)}},from:a=>"function"==typeof a?a:null!=a?rg.toVector(a):void 0,transform(a,b,c){let d=a||c.shared.transform;return this.hasCustomTransform=!!d,d||rz},threshold:a=>rg.toVector(a,0)},rB=0,rC=rl(rl({},rA),{},{axis(a,b,{axis:c}){if(this.lockDirection="lock"===c,!this.lockDirection)return c},axisThreshold:(a=rB)=>a,bounds(a={}){if("function"==typeof a)return b=>rC.bounds(a(b));if("current"in a)return()=>a.current;if("function"==typeof HTMLElement&&a instanceof HTMLElement)return a;let{left:b=-1/0,right:c=1/0,top:d=-1/0,bottom:e=1/0}=a;return[[b,c],[d,e]]}}),rD={isBrowser:!1,gesture:function(){try{return"constructor"in GestureEvent}catch(a){return!1}}(),touch:!1,touchscreen:!1,pointer:!1,pointerLock:!1},rE=10,rF={mouse:0,touch:0,pen:8};function rG(a){let[b,c]=a.overflow,[d,e]=a._delta,[f,g]=a._direction;(b<0&&d>0&&f<0||b>0&&d<0&&f>0)&&(a._movement[0]=a._movementBound[0]),(c<0&&e>0&&g<0||c>0&&e<0&&g>0)&&(a._movement[1]=a._movementBound[1])}rl(rl({},rC),{},{device(a,b,{pointer:{touch:c=!1,lock:d=!1,mouse:e=!1}={}}){return(this.pointerLock=d&&rD.pointerLock,rD.touch&&c)?"touch":this.pointerLock?"mouse":rD.pointer&&!e?"pointer":rD.touch?"touch":"mouse"},preventScrollAxis(a,b,{preventScroll:c}){if(this.preventScrollDelay="number"==typeof c?c:c||void 0===c&&a?250:void 0,rD.touchscreen&&!1!==c)return a||(void 0!==c?"y":void 0)},pointerCapture(a,b,{pointer:{capture:c=!0,buttons:d=1,keys:e=!0}={}}){return this.pointerButtons=d,this.keys=e,!this.pointerLock&&"pointer"===this.device&&c},threshold(a,b,{filterTaps:c=!1,tapsThreshold:d=3,axis:e}){let f=rg.toVector(a,c?d:+!!e);return this.filterTaps=c,this.tapsThreshold=d,f},swipe({velocity:a=.5,distance:b=50,duration:c=250}={}){return{velocity:this.transform(rg.toVector(a)),distance:this.transform(rg.toVector(b)),duration:c}},delay(a=0){switch(a){case!0:return 180;case!1:return 0;default:return a}},axisThreshold:a=>a?rl(rl({},rF),a):rF,keyboardDisplacement:(a=rE)=>a});let rH=rl(rl({},rA),{},{device(a,b,{shared:c,pointer:{touch:d=!1}={}}){if(c.target&&!rD.touch&&rD.gesture)return"gesture";if(rD.touch&&d)return"touch";if(rD.touchscreen){if(rD.pointer)return"pointer";if(rD.touch)return"touch"}},bounds(a,b,{scaleBounds:c={},angleBounds:d={}}){let e=a=>{let b=rw(ru(c,a),{min:-1/0,max:1/0});return[b.min,b.max]},f=a=>{let b=rw(ru(d,a),{min:-1/0,max:1/0});return[b.min,b.max]};return"function"!=typeof c&&"function"!=typeof d?[e(),f()]:a=>[e(a),f(a)]},threshold(a,b,c){return this.lockDirection="lock"===c.axis,rg.toVector(a,this.lockDirection?[.1,3]:0)},modifierKey:a=>void 0===a?"ctrlKey":a,pinchOnWheel:(a=!0)=>a});rl(rl({},rC),{},{mouseOnly:(a=!0)=>a}),rl(rl({},rC),{},{mouseOnly:(a=!0)=>a});let rI=new Map,rJ=new Map,rK={target(a){if(a)return()=>"current"in a?a.current:a},enabled:(a=!0)=>a,window:(a=rD.isBrowser?window:void 0)=>a,eventOptions:({passive:a=!0,capture:b=!1}={})=>({passive:a,capture:b}),transform:a=>a},rL=["target","eventOptions","window","enabled","transform"];function rM(a={},b){let c={};for(let[d,e]of Object.entries(b))switch(typeof e){case"function":c[d]=e.call(c,a[d],d,a);break;case"object":c[d]=rM(a[d],e);break;case"boolean":e&&(c[d]=a[d])}return c}class rN{constructor(a,b){rj(this,"_listeners",new Set),this._ctrl=a,this._gestureKey=b}add(a,b,c,d,e){let f=this._listeners,g=function(a,b=""){let c=rm[a];return a+(c&&c[b]||b)}(b,c),h=rl(rl({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),e);a.addEventListener(g,d,h);let i=()=>{a.removeEventListener(g,d,h),f.delete(i)};return f.add(i),i}clean(){this._listeners.forEach(a=>a()),this._listeners.clear()}}class rO{constructor(){rj(this,"_timeouts",new Map)}add(a,b,c=140,...d){this.remove(a),this._timeouts.set(a,window.setTimeout(b,c,...d))}remove(a){let b=this._timeouts.get(a);b&&window.clearTimeout(b)}clean(){this._timeouts.forEach(a=>void window.clearTimeout(a)),this._timeouts.clear()}}class rP{constructor(a){rj(this,"gestures",new Set),rj(this,"_targetEventStore",new rN(this)),rj(this,"gestureEventStores",{}),rj(this,"gestureTimeoutStores",{}),rj(this,"handlers",{}),rj(this,"config",{}),rj(this,"pointerIds",new Set),rj(this,"touchIds",new Set),rj(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(a,b){b.drag&&rQ(a,"drag"),b.wheel&&rQ(a,"wheel"),b.scroll&&rQ(a,"scroll"),b.move&&rQ(a,"move"),b.pinch&&rQ(a,"pinch"),b.hover&&rQ(a,"hover")}(this,a)}setEventIds(a){if(rq(a))return this.touchIds=new Set(Array.from(a.touches).filter(b=>{var c,d;return b.target===a.currentTarget||(null==(c=a.currentTarget)||null==(d=c.contains)?void 0:d.call(c,b.target))}).map(a=>a.identifier)),this.touchIds;if("pointerId"in a)return"pointerup"===a.type||"pointercancel"===a.type?this.pointerIds.delete(a.pointerId):"pointerdown"===a.type&&this.pointerIds.add(a.pointerId),this.pointerIds}applyHandlers(a,b){this.handlers=a,this.nativeHandlers=b}applyConfig(a,b){this.config=function(a,b,c={}){let{target:d,eventOptions:e,window:f,enabled:g,transform:h}=a,i=function(a,b){if(null==a)return{};var c,d,e=function(a,b){if(null==a)return{};var c,d,e={},f=Object.keys(a);for(d=0;d<f.length;d++)c=f[d],b.indexOf(c)>=0||(e[c]=a[c]);return e}(a,b);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(a);for(d=0;d<f.length;d++)c=f[d],!(b.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(a,c)&&(e[c]=a[c])}return e}(a,rL);if(c.shared=rM({target:d,eventOptions:e,window:f,enabled:g,transform:h},rK),b){let a=rJ.get(b);c[b]=rM(rl({shared:c.shared},i),a)}else for(let a in i){let b=rJ.get(a);b&&(c[a]=rM(rl({shared:c.shared},i[a]),b))}return c}(a,b,this.config)}clean(){for(let a of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[a].clean(),this.gestureTimeoutStores[a].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...a){let b,c=this.config.shared,d={};if(!c.target||(b=c.target())){if(c.enabled){for(let c of this.gestures){let e=this.config[c],f=rR(d,e.eventOptions,!!b);e.enabled&&new(rI.get(c))(this,a,c).bind(f)}let e=rR(d,c.eventOptions,!!b);for(let b in this.nativeHandlers)e(b,"",c=>this.nativeHandlers[b](rl(rl({},this.state.shared),{},{event:c,args:a})),void 0,!0)}for(let a in d)d[a]=function(...a){return 0===a.length?rv:1===a.length?a[0]:function(){let b;for(let c of a)b=c.apply(this,arguments)||b;return b}}(...d[a]);if(!b)return d;for(let a in d){let{device:c,capture:e,passive:f}=function(a){let b=a.substring(2).toLowerCase(),c=!!~b.indexOf("passive");c&&(b=b.replace("passive",""));let d=rp.includes(b)?"capturecapture":"capture",e=!!~b.indexOf(d);return e&&(b=b.replace("capture","")),{device:b,capture:e,passive:c}}(a);this._targetEventStore.add(b,c,"",d[a],{capture:e,passive:f})}}}}function rQ(a,b){a.gestures.add(b),a.gestureEventStores[b]=new rN(a,b),a.gestureTimeoutStores[b]=new rO}let rR=(a,b,c)=>(d,e,f,g={},h=!1)=>{var i,j;let k=null!=(i=g.capture)?i:b.capture,l=null!=(j=g.passive)?j:b.passive,m=h?d:function(a,b="",c=!1){let d=rm[a],e=d&&d[b]||b;return"on"+rn(a)+rn(e)+(!function(a=!1,b){return a&&!ro.includes(b)}(c,e)?"":"Capture")}(d,e,k);c&&l&&(m+="Passive"),a[m]=a[m]||[],a[m].push(f)},rS=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function rT(a,b,c,d,e,f){if(!a.has(c)||!rI.has(d))return;let g=c+"Start",h=c+"End";e[d]=a=>{let d;return a.first&&g in b&&b[g](a),c in b&&(d=b[c](a)),a.last&&h in b&&b[h](a),d},f[d]=f[d]||{}}a.i(27975),a.i(78452);let rU=/Mac|iPod|iPhone|iPad/.test("node");function rV(a){let{deltaY:b,deltaX:c}=a,d=0;return a.ctrlKey||a.altKey||a.metaKey?d=(Math.abs(b)>10?10*Math.sign(b):b)/100:a.shiftKey&&!rU&&(c=b,b=0),{x:-c,y:-b,z:-d}}let rW=([{key:"wheel",engine:class extends ry{constructor(...a){super(...a),rj(this,"ingKey","wheeling")}wheel(a){this.state._active||this.start(a),this.wheelChange(a),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(a){let b=this.state;b._delta=rt(a),rg.addTo(b._movement,b._delta),rG(b),this.compute(a),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(a){a("wheel","",this.wheel.bind(this))}},resolver:rC},{key:"pinch",engine:class extends rx{constructor(...a){super(...a),rj(this,"ingKey","pinching"),rj(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let a=this.state;a._touchIds=[],a.canceled=!1,a.cancel=this.cancel.bind(this),a.turns=0}computeOffset(){let{type:a,movement:b,lastOffset:c}=this.state;"wheel"===a?this.state.offset=rg.add(b,c):this.state.offset=[(1+b[0])*c[0],b[1]+c[1]]}computeMovement(){let{offset:a,lastOffset:b}=this.state;this.state.movement=[a[0]/b[0],a[1]-b[1]]}axisIntent(){let a=this.state,[b,c]=a._movement;if(!a.axis){let d=30*Math.abs(b)-Math.abs(c);d<0?a.axis="angle":d>0&&(a.axis="scale")}}restrictToAxis(a){this.config.lockDirection&&("scale"===this.state.axis?a[1]=0:"angle"===this.state.axis&&(a[0]=0))}cancel(){let a=this.state;a.canceled||setTimeout(()=>{a.canceled=!0,a._active=!1,this.compute(),this.emit()},0)}touchStart(a){this.ctrl.setEventIds(a);let b=this.state,c=this.ctrl.touchIds;if(b._active&&b._touchIds.every(a=>c.has(a))||c.size<2)return;this.start(a),b._touchIds=Array.from(c).slice(0,2);let d=rs(a,b._touchIds);d&&this.pinchStart(a,d)}pointerStart(a){if(null!=a.buttons&&a.buttons%2!=1)return;this.ctrl.setEventIds(a),a.target.setPointerCapture(a.pointerId);let b=this.state,c=b._pointerEvents,d=this.ctrl.pointerIds;if(b._active&&Array.from(c.keys()).every(a=>d.has(a))||(c.size<2&&c.set(a.pointerId,a),b._pointerEvents.size<2))return;this.start(a);let e=rr(...Array.from(c.values()));e&&this.pinchStart(a,e)}pinchStart(a,b){this.state.origin=b.origin,this.computeValues([b.distance,b.angle]),this.computeInitial(),this.compute(a),this.emit()}touchMove(a){if(!this.state._active)return;let b=rs(a,this.state._touchIds);b&&this.pinchMove(a,b)}pointerMove(a){let b=this.state._pointerEvents;if(b.has(a.pointerId)&&b.set(a.pointerId,a),!this.state._active)return;let c=rr(...Array.from(b.values()));c&&this.pinchMove(a,c)}pinchMove(a,b){let c=this.state,d=c._values[1],e=b.angle-d,f=0;Math.abs(e)>270&&(f+=Math.sign(e)),this.computeValues([b.distance,b.angle-360*f]),c.origin=b.origin,c.turns=f,c._movement=[c._values[0]/c._initial[0]-1,c._values[1]-c._initial[1]],this.compute(a),this.emit()}touchEnd(a){this.ctrl.setEventIds(a),this.state._active&&this.state._touchIds.some(a=>!this.ctrl.touchIds.has(a))&&(this.state._active=!1,this.compute(a),this.emit())}pointerEnd(a){let b=this.state;this.ctrl.setEventIds(a);try{a.target.releasePointerCapture(a.pointerId)}catch(a){}b._pointerEvents.has(a.pointerId)&&b._pointerEvents.delete(a.pointerId),b._active&&b._pointerEvents.size<2&&(b._active=!1,this.compute(a),this.emit())}gestureStart(a){a.cancelable&&a.preventDefault();let b=this.state;b._active||(this.start(a),this.computeValues([a.scale,a.rotation]),b.origin=[a.clientX,a.clientY],this.compute(a),this.emit())}gestureMove(a){if(a.cancelable&&a.preventDefault(),!this.state._active)return;let b=this.state;this.computeValues([a.scale,a.rotation]),b.origin=[a.clientX,a.clientY];let c=b._movement;b._movement=[a.scale-1,a.rotation],b._delta=rg.sub(b._movement,c),this.compute(a),this.emit()}gestureEnd(a){this.state._active&&(this.state._active=!1,this.compute(a),this.emit())}wheel(a){let b=this.config.modifierKey;(!b||(Array.isArray(b)?b.find(b=>a[b]):a[b]))&&(this.state._active?this.wheelChange(a):this.wheelStart(a),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(a){this.start(a),this.wheelChange(a)}wheelChange(a){"uv"in a||a.cancelable&&a.preventDefault();let b=this.state;b._delta=[-rt(a)[1]/100*b.offset[0],0],rg.addTo(b._movement,b._delta),rG(b),this.state.origin=[a.clientX,a.clientY],this.compute(a),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(a){let b=this.config.device;b&&(a(b,"start",this[b+"Start"].bind(this)),a(b,"change",this[b+"Move"].bind(this)),a(b,"end",this[b+"End"].bind(this)),a(b,"cancel",this[b+"End"].bind(this)),a("lostPointerCapture","",this[b+"End"].bind(this))),this.config.pinchOnWheel&&a("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:rH}].forEach(function(a){rI.set(a.key,a.engine),rJ.set(a.key,a.resolver)}),function(a,b){let{handlers:c,nativeHandlers:d,config:e}=function(a,b){let[c,d,e]=function(a){let b={},c={},d=new Set;for(let e in a)rS.test(e)?(d.add(RegExp.lastMatch),c[e]=a[e]):b[e]=a[e];return[c,b,d]}(a),f={};return rT(e,c,"onDrag","drag",f,b),rT(e,c,"onWheel","wheel",f,b),rT(e,c,"onScroll","scroll",f,b),rT(e,c,"onPinch","pinch",f,b),rT(e,c,"onMove","move",f,b),rT(e,c,"onHover","hover",f,b),{handlers:f,config:b,nativeHandlers:d}}(a,b||{});return function(a,b={},c,d){let e=eQ.default.useMemo(()=>new rP(a),[]);if(e.applyHandlers(a,d),e.applyConfig(b,c),eQ.default.useEffect(e.effect.bind(e)),eQ.default.useEffect(()=>e.clean.bind(e),[]),void 0===b.target)return e.bind.bind(e)}(c,e,void 0,d)});function rX(a,b,c){let d=a.getShape(b),e=a.getShapeHandles(d);return{shape:d,handle:e.find(a=>a.id===c)}}let rY=eV(function({showStroke:a=!0,showVertices:b=!0,showClosestPointOnOutline:c=!0}){let d=kp();!function(a=!0){let[b,c]=(0,eQ.useState)(0),d=kp();(0,eQ.useEffect)(()=>{if(!a)return;let b=()=>c(a=>a+1);return d.on("tick",b),()=>{d.off("tick",b)}},[d,a])}(c);let e=d.getZoomLevel(),f=d.getRenderingShapes(),{inputs:{currentPagePoint:g}}=d;return(0,bT.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:0x3b9ac9ff,top:0,left:0,overflow:"visible"},children:f.map(f=>{let h=d.getShape(f.id);if("group"===h.type)return null;let i=d.getShapeGeometry(h),j=d.getShapePageTransform(h),k=d.getPointInShapeSpace(h,g),l=i.nearestPoint(k),m=i.distanceToPoint(k,!0),n=Math.abs(m)*e,{vertices:o}=i;return(0,bT.jsxs)("g",{transform:j.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[a&&(0,bT.jsx)("g",{stroke:i.debugColor??"red",opacity:"1",strokeWidth:2/e,fill:"none",children:(0,bT.jsx)(rZ,{geometry:i})}),b&&o.map((a,b)=>(0,bT.jsx)("circle",{cx:a.x,cy:a.y,r:2/e,fill:`hsl(${cT(b,[0,o.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/e},`v${b}`)),c&&n<150&&(0,bT.jsx)("line",{x1:l.x,y1:l.y,x2:k.x,y2:k.y,opacity:1-n/150,stroke:m<0?"goldenrod":"dodgerblue",strokeWidth:2/e})]},f.id+"_outline")})})});function rZ({geometry:a}){return a instanceof lw?(0,bT.jsx)("g",{stroke:a.debugColor,children:[...a.children,...a.ignoredChildren].map((a,b)=>(0,bT.jsx)(rZ,{geometry:a},b))}):(0,bT.jsx)("path",{d:a.toSimpleSvgPath(),stroke:a.debugColor})}function r$(a){return(0,b2.default)(a)}function r_(){let a=kp();return e$(eX("userIds",()=>r$(a.getCollaborators().map(a=>a.userId)).sort(),{isEqual:(a,b)=>a.join(",")===b.join?.(",")},[a]))}function r0(a){let b=kp();return e$(`latestPresence:${a}`,()=>b.getCollaborators().find(b=>b.userId===a),[b,a])??null}let r1=eV(function(){return r_().map(a=>(0,bT.jsx)(r2,{collaboratorId:a},a))}),r2=eV(function({collaboratorId:a}){let b=kp(),c=r0(a),d=function(a,b){let c=(0,eQ.useRef)(b?.lastActivityTimestamp??-1),[d,e]=(0,eQ.useState)(()=>r4(a,Date.now()-c.current));return(0,eQ.useEffect)(()=>{let b=a.timers.setInterval(()=>{e(r4(a,Date.now()-c.current))},a.options.collaboratorCheckIntervalMs);return()=>clearInterval(b)},[a]),b&&(c.current=b.lastActivityTimestamp??1/0),d}(b,c);if(!(c&&c.currentPageId===b.getCurrentPageId()))return null;switch(d){case"inactive":{let{followingUserId:a,highlightedUserIds:d}=b.getInstanceState();if(!(a===c.userId||d.includes(c.userId)))return null;break}case"idle":{let{highlightedUserIds:a}=b.getInstanceState();if(c.followingUserId===b.user.getId()&&!(c.chatMessage||a.includes(c.userId)))return null}}return(0,bT.jsx)(r3,{latestPresence:c})}),r3=eV(function({latestPresence:a}){let b=kp(),{CollaboratorBrush:c,CollaboratorScribble:d,CollaboratorCursor:e,CollaboratorHint:f,CollaboratorShapeIndicator:g}=re(),h=b.getZoomLevel(),i=b.getViewportPageBounds(),{userId:j,chatMessage:k,brush:l,scribbles:m,selectedShapeIds:n,userName:o,cursor:p,color:q}=a;if(!p)return null;let r=!(p.x<i.minX-12/h||p.y<i.minY-16/h||p.x>i.maxX-12/h||p.y>i.maxY-16/h);return(0,bT.jsxs)(bT.Fragment,{children:[l&&c?(0,bT.jsx)(c,{className:"tl-collaborator__brush",userId:j,brush:l,color:q,opacity:.1},j+"_brush"):null,r&&e?(0,bT.jsx)(e,{className:"tl-collaborator__cursor",userId:j,point:p,color:q,zoom:h,name:"New User"!==o?o:null,chatMessage:k??""},j+"_cursor"):f?(0,bT.jsx)(f,{className:"tl-collaborator__cursor-hint",userId:j,point:p,color:q,zoom:h,viewport:i},j+"_cursor_hint"):null,d&&m.length?(0,bT.jsx)(bT.Fragment,{children:m.map(a=>(0,bT.jsx)(d,{className:"tl-collaborator__scribble",userId:j,scribble:a,color:q,zoom:h,opacity:"laser"===a.color?.5:.1},j+"_scribble_"+a.id))}):null,g&&n.filter(a=>!b.isShapeHidden(a)).map(a=>(0,bT.jsx)(g,{className:"tl-collaborator__shape-indicator",userId:j,shapeId:a,color:q,opacity:.5},j+"_"+a))]})});function r4(a,b){return b>a.options.collaboratorInactiveTimeoutMs?"inactive":b>a.options.collaboratorIdleTimeoutMs?"idle":"active"}function r5(){let a=kp(),b=e$("is menu open",()=>a.menus.hasAnyOpenMenus(),[a]),[c,d]=(0,eQ.useState)(!1),e=ks(),f=(0,eQ.useRef)({isDown:!1,isDragging:!1,start:new jA}),g=(0,eQ.useCallback)(b=>{0===b.button&&(d(!0),f.current={isDown:!0,isDragging:!1,start:new jA(b.clientX,b.clientY)},h.current=!1),a.menus.clearOpenMenus()},[a]),h=(0,eQ.useRef)(!1),i=(0,eQ.useCallback)(b=>{if(!f.current.isDown)return;let{x:c,y:d}=f.current.start;!h.current&&jA.Dist2(f.current.start,new jA(b.clientX,b.clientY))>a.options.dragDistanceSquared&&(h.current=!0,f.current={...f.current,isDown:!0,isDragging:!0},e.onPointerDown?.({...b,clientX:c,clientY:d,button:0})),h.current&&a.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...kh(a,b)})},[e,a]),j=(0,eQ.useCallback)(a=>{e.onPointerUp?.(a),d(!1),f.current={isDown:!1,isDragging:!1,start:new jA(a.clientX,a.clientY)},h.current=!1},[e]);return(b||c)&&(0,bT.jsx)("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...e,onPointerDown:g,onPointerMove:i,onPointerUp:j})}function r6({className:a}){let b,c,d,e,f,g,h,i,j=kp(),{SelectionBackground:l,Background:m,SvgDefs:n,ShapeIndicators:o}=re(),p=(0,eQ.useRef)(null),q=(0,eQ.useRef)(null),r=(0,eQ.useRef)(null),s=kv();b=kp(),(0,eQ.useLayoutEffect)(()=>{let a=(0,b1.default)(()=>{p.current&&b.updateViewportScreenBounds(p.current)},200,{trailing:!0}),c=b.timers.setInterval(a,1e3);window.addEventListener("resize",a);let d=new ResizeObserver(b=>{b[0].contentRect&&a()}),e=p.current,f=null;return e&&(d.observe(e),(f=(a=>{let b=a.parentElement;for(;b&&b!==document.body;){let{overflowY:a}=window.getComputedStyle(b);if(b.scrollHeight>b.clientHeight&&("auto"===a||"scroll"===a||"overlay"===a))return b;b=b.parentElement}return document})(e)).addEventListener("scroll",a)),()=>{clearInterval(c),window.removeEventListener("resize",a),d.disconnect(),f?.removeEventListener("scroll",a),a.cancel()}},[b,p]),c=kp(),d=kv(),e=e$("isEditing",()=>c.getEditingShapeId(),[c]),f=e$("isFocused",()=>c.getIsFocused(),[c]),(0,eQ.useEffect)(()=>{if(d)return d.addEventListener("dragover",a),d.addEventListener("drop",a),()=>{d.removeEventListener("dragover",a),d.removeEventListener("drop",a)};function a(a){if(a.isSpecialRedispatchedEvent)return;kb(a),a.stopPropagation();let b=d.querySelector(".tl-canvas");if(!b)return;let c=new DragEvent(a.type,a);c.isSpecialRedispatchedEvent=!0,b.dispatchEvent(c)}},[d]),(0,eQ.useEffect)(()=>{},[c]),(0,eQ.useEffect)(()=>{if(!f)return;let a=a=>{if(a.altKey&&(c.isIn("zoom")||!c.getPath().endsWith(".idle"))&&!kw(c)&&kb(a),c.wasEventAlreadyHandled(a))return;c.markEventAsHandled(a);let b=!!c.getSelectedShapeIds().length;switch(a.key){case"=":case"-":case"0":if(a.metaKey||a.ctrlKey)return void kb(a);break;case"Tab":if(kw(c))return;b&&!e&&kb(a);break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(kw(c))return;b&&(a.metaKey||a.ctrlKey)&&kb(a);break;case",":return;case"Escape":if((c.getEditingShape()||c.getSelectedShapeIds().length>0)&&kb(a),c.menus.getOpenMenus().length>0)return;c.inputs.keys.has("Escape")||(c.inputs.keys.add("Escape"),c.cancel(),d.focus());return;default:if(kw(c))return}let f={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:kg(a)};c.dispatch(f)},b=a=>{if(c.wasEventAlreadyHandled(a)||(c.markEventAsHandled(a),kw(c)||","===a.key))return;let b={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:kg(a)};c.dispatch(b)};function g(a){if(d.contains(a.target)){let b=a.touches[0].pageX,d=a.touches[0].radiusX||0;(b-d<10||b+d>c.getViewportScreenBounds().width-10)&&(a.target?.tagName==="BUTTON"&&a.target?.click(),kb(a))}}let h=a=>{d.contains(a.target)&&(a.ctrlKey||a.metaKey)&&kb(a)};return d.addEventListener("touchstart",g,{passive:!1}),d.addEventListener("wheel",h,{passive:!1}),document.addEventListener("gesturestart",kb),document.addEventListener("gesturechange",kb),document.addEventListener("gestureend",kb),d.addEventListener("keydown",a),d.addEventListener("keyup",b),()=>{d.removeEventListener("touchstart",g),d.removeEventListener("wheel",h),document.removeEventListener("gesturestart",kb),document.removeEventListener("gesturechange",kb),document.removeEventListener("gestureend",kb),d.removeEventListener("keydown",a),d.removeEventListener("keyup",b)}},[c,d,f,e]),g=kp(),(0,eQ.useEffect)(()=>{let a=g.getInstanceState().isCoarsePointer,b=b=>{let c="mouse"!==b.pointerType;a!==c&&(a=c,g.updateInstanceState({isCoarsePointer:c}))};window.addEventListener("pointerdown",b,{capture:!0});let c=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),d=()=>{let b=(0,c.matches);a===b&&(a=b,g.updateInstanceState({isCoarsePointer:b}))};return c&&(c.addEventListener("change",d),d()),()=>{window.removeEventListener("pointerdown",b,{capture:!0}),c&&c.removeEventListener("change",d)}},[g]),h=kp(),rW(eQ.useMemo(()=>{let a="not sure",b=1,c=1,d=0,e=new jA,f=new jA;return{onWheel:({event:b})=>{var c;if(!h.getInstanceState().isFocused||(a="not sure",c=Date.now(),void 0===k?(k=c,!1):c-k>120&&c-k<160?(k=c,!0):(k=c,!1)))return;let d=h.getEditingShapeId();if(d){let a=h.getShape(d);if(a&&h.getShapeUtil(a).canScroll(a)){let a=h.getShapePageBounds(d);if(a?.containsPoint(h.inputs.currentPagePoint))return}}kb(b),b.stopPropagation();let e=rV(b);if(0===e.x&&0===e.y)return;let f={type:"wheel",name:"wheel",delta:e,point:new jA(b.clientX,b.clientY),shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:kg(b)};h.dispatch(f)},onPinchStart:d=>{let g=p.current;a="not sure";let{event:i,origin:j,da:k}=d;i instanceof WheelEvent||(i.target===g||g?.contains(i.target))&&(f.x=j[0],f.y=j[1],e.x=j[0],e.y=j[1],b=k[0],c=h.getZoomLevel(),h.dispatch({type:"pinch",name:"pinch_start",point:{x:j[0],y:j[1],z:h.getZoomLevel()},delta:{x:0,y:0},shiftKey:i.shiftKey,altKey:i.altKey,ctrlKey:i.metaKey||i.ctrlKey,metaKey:i.metaKey,accelKey:kg(i)}))},onPinchEnd:b=>{let c=p.current,{event:d,origin:e,offset:f}=b;if(d instanceof WheelEvent||!(d.target===c||c?.contains(d.target)))return;let g=f[0]**h.getCameraOptions().zoomSpeed;a="not sure",h.timers.requestAnimationFrame(()=>{h.dispatch({type:"pinch",name:"pinch_end",point:{x:e[0],y:e[1],z:g},delta:{x:e[0],y:e[1]},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,metaKey:d.metaKey,accelKey:kg(d)})})},onPinch:g=>{let i=p.current,{event:j,origin:k,offset:l,da:m}=g;if(j instanceof WheelEvent||!(j.target===i||i?.contains(j.target)))return;let n="gesturechange"===g.type||"gestureend"===g.type;d=m[0];let o=k[0]-f.x,q=k[1]-f.y;switch(f.x=k[0],f.y=k[1],(c=>{if(c&&(a="zooming"),"zooming"===a)return;let g=Math.abs(d-b),h=jA.Dist(e,f);switch(a){case"not sure":g>24?a="zooming":h>16&&(a="panning");break;case"panning":g>64&&(a="zooming")}})(n),a){case"zooming":{let a=l[0]**h.getCameraOptions().zoomSpeed;h.dispatch({type:"pinch",name:"pinch",point:{x:k[0],y:k[1],z:a},delta:{x:o,y:q},shiftKey:j.shiftKey,altKey:j.altKey,ctrlKey:j.metaKey||j.ctrlKey,metaKey:j.metaKey,accelKey:kg(j)});break}case"panning":h.dispatch({type:"pinch",name:"pinch",point:{x:k[0],y:k[1],z:c},delta:{x:o,y:q},shiftKey:j.shiftKey,altKey:j.altKey,ctrlKey:j.metaKey||j.ctrlKey,metaKey:j.metaKey,accelKey:kg(j)})}}}},[h,p]),{target:p,eventOptions:{passive:!1},pinch:{from:()=>{let{zoomSpeed:a}=h.getCameraOptions();return[h.getZoomLevel()**(1/a),0]},scaleBounds:()=>{let a=h.getBaseZoom(),{zoomSteps:b,zoomSpeed:c}=h.getCameraOptions(),d=b[0]*a,e=b[b.length-1]*a;return{max:e**(1/c),min:d**(1/c)}}}}),i=kp(),(0,eQ.useEffect)(()=>{let a=p.current;if(!a)return;let b=a=>{if(a instanceof PointerEvent&&"pen"===a.pointerType){i.markEventAsHandled(a);let{target:b}=a;rf.includes(b.tagName?.toLocaleLowerCase())||b.isContentEditable||i.isIn("select.editing_shape")||kb(a)}};return a.addEventListener("touchstart",b),a.addEventListener("touchend",b),()=>{a.removeEventListener("touchstart",b),a.removeEventListener("touchend",b)}},[i,p]);let t=(0,eQ.useRef)({lodDisableTextOutline:!1,allowTextOutline:!0});eY("position layers",function(){let{x:a,y:b,z:c}=j.getCamera();if(t.current.allowTextOutline,t.current.allowTextOutline&&c<j.options.textShadowLod!==t.current.lodDisableTextOutline){let a=c<j.options.textShadowLod;s.style.setProperty("--tl-text-outline",a?"none":"var(--tl-text-outline-reference)"),t.current.lodDisableTextOutline=a}let d=c>=1?cT(c,[1,8],[.125,.5],!0):cT(c,[.1,1],[-2,.125],!0),e=`scale(${jX(c)}) translate(${jX(a+d)}px,${jX(b+d)}px)`;ke(q.current,"transform",e),ke(r.current,"transform",e)},[j,s]);let u=ks(),v=e$("shapeSvgDefs",()=>{let a=new Map;for(let b of cX(j.shapeUtils)){if(!b)return;for(let{key:c,component:d}of b.getCanvasSvgDefs())a.has(c)||a.set(c,(0,bT.jsx)(d,{},c))}return[...a.values()]},[j]),w=e$("debug_shapes",()=>j7.hideShapes.get(),[j7]),y=e$("debug_svg",()=>j7.debugSvg.get(),[j7]),z=e$("debug_geometry",()=>j7.debugGeometry.get(),[j7]),A=e$("isEditingAnything",()=>null!==j.getEditingShapeId(),[j]),B=e$("isSelectingAnything",()=>!!j.getSelectedShapeIds().length,[j]);return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)("div",{ref:p,draggable:!1,"data-iseditinganything":A,"data-isselectinganything":B,className:(0,j1.default)("tl-canvas",a),"data-testid":"canvas",...u,children:[(0,bT.jsx)("svg",{className:"tl-svg-context","aria-hidden":"true",children:(0,bT.jsxs)("defs",{children:[v,(0,bT.jsx)(sk,{}),(0,bT.jsx)(sl,{}),n&&(0,bT.jsx)(n,{})]})}),m&&(0,bT.jsx)("div",{className:"tl-background__wrapper",children:(0,bT.jsx)(m,{})}),(0,bT.jsx)(r8,{}),(0,bT.jsxs)("div",{ref:q,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,bT.jsx)(sp,{}),l&&(0,bT.jsx)(so,{}),w?null:y?(0,bT.jsx)(sh,{}):(0,bT.jsx)(si,{})]}),(0,bT.jsx)("div",{className:"tl-overlays",children:(0,bT.jsxs)("div",{ref:r,className:"tl-html-layer",children:[z?(0,bT.jsx)(rY,{}):null,(0,bT.jsx)(sa,{}),(0,bT.jsx)(r9,{}),(0,bT.jsx)(sb,{}),o&&(0,bT.jsx)(o,{}),(0,bT.jsx)(sj,{}),(0,bT.jsx)(sc,{}),(0,bT.jsx)(sn,{}),(0,bT.jsx)(sd,{}),(0,bT.jsx)(sg,{}),(0,bT.jsx)(r1,{})]})}),(0,bT.jsx)(sq,{})]}),(0,bT.jsx)("div",{className:"tl-canvas__in-front",onPointerDown:j.markEventAsHandled,onPointerUp:j.markEventAsHandled,onTouchStart:j.markEventAsHandled,onTouchEnd:j.markEventAsHandled,children:(0,bT.jsx)(r7,{})}),(0,bT.jsx)(r5,{})]})}function r7(){let{InFrontOfTheCanvas:a}=re();return a?(0,bT.jsx)(a,{}):null}function r8(){let a=kp(),b=e$("gridSize",()=>a.getDocumentSettings().gridSize,[a]),{x:c,y:d,z:e}=e$("camera",()=>a.getCamera(),[a]),f=e$("isGridMode",()=>a.getInstanceState().isGridMode,[a]),{Grid:g}=re();return g&&f?(0,bT.jsx)(g,{x:c,y:d,z:e,size:b}):null}function r9(){let a=kp(),b=e$("scribbles",()=>a.getInstanceState().scribbles,[a]),c=e$("zoomLevel",()=>a.getZoomLevel(),[a]),{Scribble:d}=re();return d&&b.length?b.map(a=>(0,bT.jsx)(d,{className:"tl-user-scribble",scribble:a,zoom:c},a.id)):null}function sa(){let a=kp(),b=e$("brush",()=>a.getInstanceState().brush,[a]),{Brush:c}=re();return c&&b?(0,bT.jsx)(c,{className:"tl-user-brush",brush:b}):null}function sb(){let a=kp(),b=e$("zoomBrush",()=>a.getInstanceState().zoomBrush,[a]),{ZoomBrush:c}=re();return c&&b?(0,bT.jsx)(c,{className:"tl-user-brush tl-zoom-brush",brush:b}):null}function sc(){let a=kp(),b=e$("snapLines",()=>a.snaps.getIndicators(),[a]),c=e$("zoomLevel",()=>a.getZoomLevel(),[a]),{SnapIndicator:d}=re();return d&&b.length>0?b.map(a=>(0,bT.jsx)(d,{className:"tl-user-snapline",line:a,zoom:c},a.id)):null}function sd(){let a=kp(),b=e$("handles shapeIdWithHandles",()=>{let{isReadonly:b,isChangingStyle:c}=a.getInstanceState();if(b||c)return!1;let d=a.getOnlySelectedShape();return!!d&&!!a.getShapeHandles(d)&&d.id},[a]);return b?(0,bT.jsx)(se,{shapeId:b}):null}function se({shapeId:a}){let b=kp(),{Handles:c}=re(),d=e$("zoomLevel",()=>b.getZoomLevel(),[b]),e=e$("coarse pointer",()=>b.getInstanceState().isCoarsePointer,[b]),f=e$("handles transform",()=>b.getShapePageTransform(a),[b,a]),g=e$("handles",()=>{let c=b.getShapeHandles(a);if(!c)return null;let f=(e?b.options.coarseHandleRadius:b.options.handleRadius)/d*2;return c.filter(a=>"virtual"!==a.type||!c.some(b=>b!==a&&"vertex"===b.type&&jA.Dist(a,b)<f)).sort(a=>"vertex"===a.type?1:-1)},[b,d,e,a]),h=e$("isHidden",()=>b.isShapeHidden(a),[b,a]);return c&&g&&f&&!h?(0,bT.jsx)(c,{children:(0,bT.jsx)("g",{transform:li.toCssString(f),children:g.map(b=>(0,bT.jsx)(sf,{shapeId:a,handle:b,zoom:d,isCoarse:e},b.id))})}):null}function sf({shapeId:a,handle:b,zoom:c,isCoarse:d}){var e;let f,g=(e=b.id,f=kp(),eQ.useMemo(()=>{let b,c;return{onPointerDown:b=>{if(f.wasEventAlreadyHandled(b))return;kc(ka(b.currentTarget),b);let{shape:c,handle:d}=rX(f,a,e);d&&f.dispatch({type:"pointer",target:"handle",handle:d,shape:c,name:"pointer_down",...kh(f,b)})},onPointerMove:d=>{if(f.wasEventAlreadyHandled(d)||d.clientX===b&&d.clientY===c)return;b=d.clientX,c=d.clientY;let{shape:g,handle:h}=rX(f,a,e);h&&f.dispatch({type:"pointer",target:"handle",handle:h,shape:g,name:"pointer_move",...kh(f,d)})},onPointerUp:b=>{if(f.wasEventAlreadyHandled(b))return;kd(ka(b.currentTarget),b);let{shape:c,handle:d}=rX(f,a,e);d&&f.dispatch({type:"pointer",target:"handle",handle:d,shape:c,name:"pointer_up",...kh(f,b)})}}},[f,a,e])),{Handle:h}=re();return h?(0,bT.jsx)("g",{role:"button","aria-label":b.label||"handle",transform:`translate(${b.x}, ${b.y})`,...g,children:(0,bT.jsx)(h,{shapeId:a,handle:b,zoom:c,isCoarse:d})}):null}function sg(){let{Overlays:a}=re();return a?(0,bT.jsx)("div",{className:"tl-custom-overlays tl-overlays__item",children:(0,bT.jsx)(a,{})}):null}function sh(){let a=kp();return e$("rendering shapes",()=>a.getRenderingShapes(),[a]).map(a=>(0,bT.jsxs)(eQ.Fragment,{children:[(0,bT.jsx)(mx,{...a}),(0,bT.jsx)(sm,{id:a.id,mode:"iframe"})]},a.id+"_fragment"))}function si(){let a=kp(),b=e$("rendering shapes",()=>a.getRenderingShapes(),[a]);return(0,bT.jsxs)(bT.Fragment,{children:[b.map(a=>(0,bT.jsx)(mx,{...a},a.id+"_shape")),!1]})}function sj(){let a=kp(),{ShapeIndicator:b}=re(),c=e$("hinting shape ids",()=>b4(a.getHintingShapeIds()),[a]);return c.length&&b?c.map(a=>(0,bT.jsx)(b,{className:"tl-user-indicator__hint",shapeId:a},a+"_hinting")):null}function sk(){return(0,bT.jsxs)("g",{id:kk("cursor"),children:[(0,bT.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,bT.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,bT.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,bT.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,bT.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,bT.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,bT.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,bT.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,bT.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function sl(){let a=kk("cursor_hint");return(0,bT.jsx)("path",{id:a,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function sm({id:a,mode:b}){let c=kp(),[d,e]=(0,eQ.useState)(null),f=e$("is in root",()=>{let b=c.getShape(a);return b?.parentId===c.getCurrentPageId()},[c,a]);return((0,eQ.useEffect)(()=>{if(!f)return;let b=null,d=eg("shape to svg",async()=>{let d=Math.random();b=d;let f=10*!c.isShapeOfType(a,"frame"),g=c.getShapePageBounds(a);if(!g)return;g=g.clone().expandBy(f);let h=await c.getSvgString([a],{padding:f});b===d&&h&&e({src:`data:image/svg+xml;utf8,${encodeURIComponent(h.svg)}`,bounds:g})});return()=>{b=null,d()}},[c,a,f]),f&&d)?"iframe"===b?(0,bT.jsx)("iframe",{src:d.src,width:d.bounds.width,height:d.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${d.bounds.x}px, ${d.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):(0,bT.jsx)("img",{src:d.src,width:d.bounds.width,height:d.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${d.bounds.x}px, ${d.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):null}function sn(){let a=kp(),b=e$("selection rotation",function(){return a.getSelectionRotation()},[a]),c=e$("selection bounds",()=>a.getSelectionRotatedPageBounds(),[a]),{SelectionForeground:d}=re();return c&&d?(0,bT.jsx)(d,{bounds:c,rotation:b}):null}function so(){let a=kp(),b=e$("selection rotation",()=>a.getSelectionRotation(),[a]),c=e$("selection bounds",()=>a.getSelectionRotatedPageBounds(),[a]),{SelectionBackground:d}=re();return c&&d?(0,bT.jsx)(d,{bounds:c,rotation:b}):null}function sp(){let{OnTheCanvas:a}=re();return a?(0,bT.jsx)(a,{}):null}function sq(){let a=kp(),b=e$("camera state",()=>a.getCameraState(),[a]);return(0,bT.jsx)("div",{className:(0,j1.default)("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":"idle"===b})})}function sr({children:a,className:b="",...c}){return(0,bT.jsx)("div",{...c,className:(0,j1.default)("tl-html-container",b),children:a})}class ss{constructor(a){this.editor=a}static props;static migrations;static type}function st(a,b,c={}){let{newPoint:d,handle:e,scaleX:f,scaleY:g}=b,{minWidth:h=1,maxWidth:i=1/0,minHeight:j=1,maxHeight:k=1/0}=c,l=a.props.w*f,m=a.props.h*g,n=new jA(0,0);if(l>0){if(l<h){switch(e){case"top_left":case"left":case"bottom_left":n.x=l-h;break;case"top":case"bottom":n.x=(l-h)/2;break;default:n.x=0}l=h}}else if(n.x=l,(l=-l)<h){switch(e){case"top_left":case"left":case"bottom_left":n.x=-l;break;default:n.x=-h}l=h}if(m>0){if(m<j){switch(e){case"top_left":case"top":case"top_right":n.y=m-j;break;case"right":case"left":n.y=(m-j)/2;break;default:n.y=0}m=j}}else if(n.y=m,(m=-m)<j){switch(e){case"top_left":case"top":case"top_right":n.y=-m;break;default:n.y=-j}m=j}let{x:o,y:p}=n.rot(a.rotation).add(d);return{...a,x:o,y:p,props:{w:Math.min(i,l),h:Math.min(k,m)}}}class su extends lC{getGeometry(a){return new lA({width:a.props.w,height:a.props.h,isFilled:!0})}onResize(a,b){return st(a,b)}getHandleSnapGeometry(a){return{points:this.getGeometry(a).bounds.cornersAndCenter}}getInterpolatedProps(a,b,c){var d,e;return{...b.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c)}}}function sv(a,{initialBounds:b,scaleX:c,scaleY:d,newPoint:e,handle:f}){let g;switch(f){case"bottom_left":case"bottom_right":case"top_left":case"top_right":g=Math.max(.01,Math.max(Math.abs(c),Math.abs(d)));break;case"left":case"right":g=Math.max(.01,Math.abs(c));break;case"bottom":case"top":g=Math.max(.01,Math.abs(d));break;default:throw cf(f)}let h=new jA(0,0);c<0&&(h.x=-(b.width*g)),d<0&&(h.y=-(b.height*g));let{x:i,y:j}=jA.Add(e,h.rot(a.rotation));return{x:i,y:j,props:{scale:g*a.props.scale}}}class sw extends ps{static id="idle";onPointerDown(a){this.parent.transition("pointing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}class sx extends ps{static id="pointing";onPointerMove(a){let{editor:b}=this;if(b.inputs.isDragging){let{originPagePoint:c}=b.inputs,d=this.parent.shapeType,e=hd(),f=b.markHistoryStoppingPoint(`creating_box:${e}`),g=sy(c,b);if(this.editor.createShapes([{id:e,type:d,x:g.x,y:g.y,props:{w:1,h:1}}]),!b.getShape(e))return void this.cancel();b.select(e);let h=this.parent;this.editor.setCurrentTool("select.resizing",{...a,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:f,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:h.onCreate?a=>h.onCreate?.(a):void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){let{originPagePoint:a}=this.editor.inputs,b=this.parent.shapeType,c=hd();this.editor.markHistoryStoppingPoint(`creating_box:${c}`),this.editor.createShapes([{id:c,type:b,x:a.x,y:a.y}]);let d=this.editor.getShape(c);if(!d)return void this.cancel();let{w:e,h:f}=d.props,g=new jA(e/2,f/2),h=this.editor.getShapeParentTransform(d);h&&g.rot(-h.rotation());let i=1;this.editor.user.getIsDynamicResizeMode()&&(e*=i=1/this.editor.getZoomLevel(),f*=i,g.mul(i));let j=d$(d),k=sy(new jA(d.x-g.x,d.y-g.y),this.editor);j.x=k.x,j.y=k.y,j.props.w=e,j.props.h=f,"scale"in d.props&&(j.props.scale=i),this.editor.updateShape(j),this.editor.setSelectedShapes([c]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}}function sy(a,b){let c=b.getInstanceState().isGridMode,d=b.getDocumentSettings().gridSize;return c?a.clone().snapToGrid(d):a.clone()}class sz extends ps{static id="box";static initial="idle";static children(){return[sw,sx]}}function sA(a){let b=kp();return e$("isEditing",()=>b.getEditingShapeId()===a,[b,a])}function sB(a){let b=kp();return(0,eQ.useMemo)(function(){let c,d;return{onPointerDown:c=>{if(b.wasEventAlreadyHandled(c))return;if(2===c.button)return void b.dispatch({type:"pointer",target:"selection",handle:a,name:"right_click",...kh(b,c)});if(0!==c.button)return;let d=ka(c.currentTarget);kc(d,c),d.addEventListener("pointerup",function a(){d.removeEventListener("pointerup",a),kd(d,c)}),b.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:a,...kh(b,c)}),b.markEventAsHandled(c)},onPointerMove:function(e){b.wasEventAlreadyHandled(e)||0!==e.button||(e.clientX!==c||e.clientY!==d)&&(c=e.clientX,d=e.clientY,b.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:a,...kh(b,e)}))},onPointerUp:c=>{b.wasEventAlreadyHandled(c)||0===c.button&&b.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:a,...kh(b,c)})}}},[b,a])}function sC(a,b=20){return Math.max(8,Math.ceil(a/b))}class sD extends lu{_center;_radius;_start;_end;_largeArcFlag;_sweepFlag;_measure;_angleStart;_angleEnd;constructor(a){super({...a,isFilled:!1,isClosed:!1});const{center:b,sweepFlag:c,largeArcFlag:d,start:e,end:f}=a;if(e.equals(f))throw Error("Arc must have different start and end points.");this._angleStart=jA.Angle(b,e),this._angleEnd=jA.Angle(b,f),this._radius=jA.Dist(b,e),this._measure=function(a,b,c,d){let e=(b-a)%jG*2%jG-(b-a)%jG;return d?(jG-Math.abs(e))*(c?1:-1):e}(this._angleStart,this._angleEnd,c,d),this._start=e,this._end=f,this._sweepFlag=c,this._largeArcFlag=d,this._center=b}nearestPoint(a){let b,c,{_center:d,_measure:e,_radius:f,_angleEnd:g,_angleStart:h,_start:i,_end:j}=this,k=j$(e,h,g,d.angle(a));if(k<=0)return i;if(k>=1)return j;let l=jA.Sub(a,d).uni().mul(f).add(d),m=1/0;for(let d of[i,j,l])(c=jA.Dist2(a,d))<m&&(b=d,m=c);if(!b)throw Error("nearest point not found");return b}hitTestLineSegment(a,b){let{_center:c,_radius:d,_measure:e,_angleStart:f,_angleEnd:g}=this,h=lk(a,b,c,d);return null!==h&&h.some(a=>{let b=j$(e,f,g,c.angle(a));return b>=0&&b<=1})}getVertices(){let{_center:a,_measure:b,length:c,_radius:d,_angleStart:e}=this,f=[];for(let g=0,h=sC(Math.abs(c));g<h+1;g++){let c=e+g/h*b;f.push(jS(a,d,c))}return f}getSvgPathData(a=!0){let{_start:b,_end:c,_radius:d,_largeArcFlag:e,_sweepFlag:f}=this;return`${a?`M${b.toFixed()}`:""} A${d} ${d} 0 ${e} ${f} ${c.toFixed()}`}getLength(){return Math.abs(this._measure*this._radius)}}class sE extends lu{constructor(a){super({isClosed:!0,...a}),this.config=a;const{x:b=0,y:c=0,radius:d}=a;this._x=b,this._y=c,this._center=new jA(d+b,d+c),this._radius=d}_center;_radius;_x;_y;getBounds(){return new lh(this._x,this._y,2*this._radius,2*this._radius)}getVertices(){let{_center:a,_radius:b}=this,c=[];for(let d=0,e=sC(jG*b);d<e;d++){let f=d/e*jG;c.push(jS(a,b,f))}return c}nearestPoint(a){let{_center:b,_radius:c}=this;return b.equals(a)?jA.AddXY(b,c,0):jA.Sub(a,b).uni().mul(c).add(b)}hitTestLineSegment(a,b,c=0){let{_center:d,_radius:e}=this;return null!==lk(a,b,d,e+c)}getSvgPathData(){let{_center:a,_radius:b}=this;return`M${a.x+b},${a.y} a${b},${b} 0 1,0 ${2*b},0a${b},${b} 0 1,0 -${2*b},0`}}class sF extends ly{_a;_b;_c;_d;_resolution;constructor(a){const{start:b,cp1:c,cp2:d,end:e}=a;super({...a,points:[b,e]}),this._a=b,this._b=c,this._c=d,this._d=e,this._resolution=a.resolution??10}getVertices(){let a=[],{_a:b,_b:c,_c:d,_d:e}=this;for(let f=0,g=this._resolution;f<=g;f++){let h=f/g;a.push(new jA((1-h)*(1-h)*(1-h)*b.x+(1-h)*(1-h)*3*h*c.x+3*(1-h)*(h*h)*d.x+h*h*h*e.x,(1-h)*(1-h)*(1-h)*b.y+(1-h)*(1-h)*3*h*c.y+3*(1-h)*(h*h)*d.y+h*h*h*e.y))}return a}nearestPoint(a){let b,c,d,e=1/0;for(let f of this.segments)d=f.nearestPoint(a),(c=jA.Dist2(d,a))<e&&(b=d,e=c);if(!b)throw Error("nearest point not found");return b}getSvgPathData(a=!0){let{_a:b,_b:c,_c:d,_d:e}=this;return`${a?`M ${b.toFixed()} `:""} C${c.toFixed()} ${d.toFixed()} ${e.toFixed()}`}static GetAtT(a,b){let{_a:c,_b:d,_c:e,_d:f}=a;return new jA((1-b)*(1-b)*(1-b)*c.x+(1-b)*(1-b)*3*b*d.x+3*(1-b)*(b*b)*e.x+b*b*b*f.x,(1-b)*(1-b)*(1-b)*c.y+(1-b)*(1-b)*3*b*d.y+3*(1-b)*(b*b)*e.y+b*b*b*f.y)}getLength(a,b=32){let c,d=this._a,e=0;for(let a=1;a<=b;a++)c=sF.GetAtT(this,a/b),e+=jA.Dist(d,c),d=c;return e}}class sG extends lu{constructor(a){super({...a,isClosed:!0}),this.config=a;const{width:b,height:c}=a;this._w=b,this._h=c}_w;_h;_edges;get edges(){if(!this._edges){let{vertices:a}=this;this._edges=[];for(let b=0,c=a.length;b<c;b++){let d=a[b],e=a[(b+1)%c];this._edges.push(new lx({start:d,end:e}))}}return this._edges}getVertices(){let a=Math.max(1,this._w),b=Math.max(1,this._h),c=a/2,d=b/2,e=Math.pow(c-d,2)/Math.pow(c+d,2),f=sC(jE*(c+d)*(1+3*e/(10+Math.sqrt(4-3*e)))),g=jG/f,h=Math.cos(g),i=Math.sin(g),j=0,k=1,l=0,m=1,n=Array(f);for(let e=0;e<f;e++)n[e]=new jA(jI(c+c*k,0,a),jI(d+d*j,0,b)),l=i*k+h*j,m=h*k-i*j,j=l,k=m;return n}nearestPoint(a){let b,c,d,e=1/0;for(let f of this.edges)d=f.nearestPoint(a),(c=jA.Dist2(d,a))<e&&(b=d,e=c);if(!b)throw Error("nearest point not found");return b}hitTestLineSegment(a,b){return this.edges.some(c=>c.hitTestLineSegment(a,b))}getBounds(){return new lh(0,0,this._w,this._h)}getLength(){var a;let b,{_w:c,_h:d}=this,e=Math.max(0,d/2);return b=Math.pow((a=Math.max(0,c/2))-e,2)/Math.pow(a+e,2),jE*(a+e)*(1+3*b/(10+Math.sqrt(4-3*b)))}getSvgPathData(a=!1){let{_w:b,_h:c}=this,d=b/2,e=c/2,f=Math.max(0,d),g=Math.max(0,e);return`${a?`M${d-f},${e}`:""} a${f},${g},0,1,1,${2*f},0a${f},${g},0,1,1,-${2*f},0`}}function sH(a,b,c){let d=new Set;for(let c of b){let b=a.getShape(c);if(!b)continue;d.add(b);let e=a.getShape(b.parentId);e&&d.add(e)}let e=new Map;for(let b of d){let d=a.getSortedChildIdsForParent(b);if(c?.filter&&!c.filter(b))e.set(b,d);else{let c=function(a,b,c){if(0===c.length)return ea;let d=a.getShapePageBounds(b);if(!d)return ea;let e=a.getShapeGeometry(b),f=a.getShapePageTransform(b).applyToPoints(e.vertices),g=a.getShape(b);if(!g)return ea;let h=a.getShapePageTransform(b),i=a.getShapeUtil(g.type).getClipPath?.(g),j=i?h.applyToPoints(i):void 0,k=j?lo(j,f):f;return k?c.filter(b=>{let c=a.getShapePageBounds(b);if(!c||!d.includes(c))return!1;let e=a.getShapePageTransform(b).clone().invert().applyToPoints(k);return a.getShapeGeometry(b).overlapsPolygon(e)}):ea}(a,b.id,d);c.length<d.length&&e.set(b,d.filter(a=>!c.includes(a)))}}let f=a.getCurrentPageShapesSorted().map(a=>a.id),g={};for(let[b,d]of e){let e=b5(d.map(b=>a.getShape(b))),{reparenting:h,remainingShapesToReparent:i}=function(a,b,c){let d=new Set(b),e=new Set;for(let c of b){let b=a.getShapeParent(c);b&&a.isShapeOfType(b,"group")&&!e.has(b)&&e.add(b)}for(let b of e){for(let c of b5(a.getSortedChildIdsForParent(b).map(b=>a.getShape(b))))d.delete(c);d.add(b)}let f=new Map,g=new Map,h=new Set(d),i=a.getCurrentPageShapesSorted().filter(b=>a.getShapeUtil(b).canReceiveNewChildrenOfType?.(b,b.type)&&!h.has(b));for(let b=i.length-1;b>=0;b--){let d=i[b],e=a.findShapeAncestor(d,b=>a.isShapeOfType(b,"group"))?.id,j=a.getShapeGeometry(d),k=a.getShapePageTransform(d),l=a.getShapeMask(d),m=k.applyToPoints(j.vertices),n=l?lo(l,m):m;if(!n)continue;let o=[];for(let b of h){if(d.id===b.id||c&&!c(b,d)||(f.has(b.id)||f.set(b.id,a.findShapeAncestor(b,b=>a.isShapeOfType(b,"group"))?.id),f.get(b.id)!==e||a.findShapeAncestor(d,a=>b.id===a.id)))continue;let g=a.getShapePageTransform(b).clone().invert().applyToPoints(n);if(a.getShapeGeometry(b).overlapsPolygon(g)){if(!a.getShapeUtil(d).canReceiveNewChildrenOfType?.(d,b.type))continue;b.parentId!==d.id&&o.push(b),h.delete(b);continue}}o.length&&g.set(d.id,o)}return{reparenting:g,remainingShapesToReparent:h}}(a,e,(a,d)=>(!c?.filter||!!c.filter(d))&&d.id!==b.id&&f.indexOf(d.id)<f.indexOf(a.id));if(h.forEach((a,b)=>{0!==a.length&&(g[b]||(g[b]={parentId:b,shapeIds:[]}),g[b].shapeIds.push(...a.map(a=>a.id)))}),i.size>0){let c=a.findShapeAncestor(b,b=>a.isShapeOfType(b,"group"))?.id??a.getCurrentPageId();i.forEach(d=>{if(!g[c]){let d,e=a.getSortedChildIdsForParent(c),f=e.indexOf(b.id);if(f>-1){let c=e[f+1],g=c?a.getShape(c).index:dw(b.index);d=dv(b.index,g)}g[c]={parentId:c,shapeIds:[],index:d}}g[c].shapeIds.push(d.id)})}}a.run(()=>{Object.values(g).forEach(({parentId:b,shapeIds:c,index:d})=>{0!==c.length&&(c.sort((a,b)=>f.indexOf(a)<f.indexOf(b)?-1:1),a.reparentShapes(c,b,d))})})}function sI(a){this.content=a}sI.prototype={constructor:sI,find:function(a){for(var b=0;b<this.content.length;b+=2)if(this.content[b]===a)return b;return -1},get:function(a){var b=this.find(a);return -1==b?void 0:this.content[b+1]},update:function(a,b,c){var d=c&&c!=a?this.remove(c):this,e=d.find(a),f=d.content.slice();return -1==e?f.push(c||a,b):(f[e+1]=b,c&&(f[e]=c)),new sI(f)},remove:function(a){var b=this.find(a);if(-1==b)return this;var c=this.content.slice();return c.splice(b,2),new sI(c)},addToStart:function(a,b){return new sI([a,b].concat(this.remove(a).content))},addToEnd:function(a,b){var c=this.remove(a).content.slice();return c.push(a,b),new sI(c)},addBefore:function(a,b,c){var d=this.remove(b),e=d.content.slice(),f=d.find(a);return e.splice(-1==f?e.length:f,0,b,c),new sI(e)},forEach:function(a){for(var b=0;b<this.content.length;b+=2)a(this.content[b],this.content[b+1])},prepend:function(a){return(a=sI.from(a)).size?new sI(a.content.concat(this.subtract(a).content)):this},append:function(a){return(a=sI.from(a)).size?new sI(this.subtract(a).content.concat(a.content)):this},subtract:function(a){var b=this;a=sI.from(a);for(var c=0;c<a.content.length;c+=2)b=b.remove(a.content[c]);return b},toObject:function(){var a={};return this.forEach(function(b,c){a[b]=c}),a},get size(){return this.content.length>>1}},sI.from=function(a){if(a instanceof sI)return a;var b=[];if(a)for(var c in a)b.push(c,a[c]);return new sI(b)};class sJ{constructor(a,b){if(this.content=a,this.size=b||0,null==b)for(let b=0;b<a.length;b++)this.size+=a[b].nodeSize}nodesBetween(a,b,c,d=0,e){for(let f=0,g=0;g<b;f++){let h=this.content[f],i=g+h.nodeSize;if(i>a&&!1!==c(h,d+g,e||null,f)&&h.content.size){let e=g+1;h.nodesBetween(Math.max(0,a-e),Math.min(h.content.size,b-e),c,d+e)}g=i}}descendants(a){this.nodesBetween(0,this.size,a)}textBetween(a,b,c,d){let e="",f=!0;return this.nodesBetween(a,b,(g,h)=>{let i=g.isText?g.text.slice(Math.max(a,h)-h,b-h):g.isLeaf?d?"function"==typeof d?d(g):d:g.type.spec.leafText?g.type.spec.leafText(g):"":"";g.isBlock&&(g.isLeaf&&i||g.isTextblock)&&c&&(f?f=!1:e+=c),e+=i},0),e}append(a){if(!a.size)return this;if(!this.size)return a;let b=this.lastChild,c=a.firstChild,d=this.content.slice(),e=0;for(b.isText&&b.sameMarkup(c)&&(d[d.length-1]=b.withText(b.text+c.text),e=1);e<a.content.length;e++)d.push(a.content[e]);return new sJ(d,this.size+a.size)}cut(a,b=this.size){if(0==a&&b==this.size)return this;let c=[],d=0;if(b>a)for(let e=0,f=0;f<b;e++){let g=this.content[e],h=f+g.nodeSize;h>a&&((f<a||h>b)&&(g=g.isText?g.cut(Math.max(0,a-f),Math.min(g.text.length,b-f)):g.cut(Math.max(0,a-f-1),Math.min(g.content.size,b-f-1))),c.push(g),d+=g.nodeSize),f=h}return new sJ(c,d)}cutByIndex(a,b){return a==b?sJ.empty:0==a&&b==this.content.length?this:new sJ(this.content.slice(a,b))}replaceChild(a,b){let c=this.content[a];if(c==b)return this;let d=this.content.slice(),e=this.size+b.nodeSize-c.nodeSize;return d[a]=b,new sJ(d,e)}addToStart(a){return new sJ([a].concat(this.content),this.size+a.nodeSize)}addToEnd(a){return new sJ(this.content.concat(a),this.size+a.nodeSize)}eq(a){if(this.content.length!=a.content.length)return!1;for(let b=0;b<this.content.length;b++)if(!this.content[b].eq(a.content[b]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(a){let b=this.content[a];if(!b)throw RangeError("Index "+a+" out of range for "+this);return b}maybeChild(a){return this.content[a]||null}forEach(a){for(let b=0,c=0;b<this.content.length;b++){let d=this.content[b];a(d,c,b),c+=d.nodeSize}}findDiffStart(a,b=0){return function a(b,c,d){for(let e=0;;e++){if(e==b.childCount||e==c.childCount)return b.childCount==c.childCount?null:d;let f=b.child(e),g=c.child(e);if(f==g){d+=f.nodeSize;continue}if(!f.sameMarkup(g))return d;if(f.isText&&f.text!=g.text){for(let a=0;f.text[a]==g.text[a];a++)d++;return d}if(f.content.size||g.content.size){let b=a(f.content,g.content,d+1);if(null!=b)return b}d+=f.nodeSize}}(this,a,b)}findDiffEnd(a,b=this.size,c=a.size){return function a(b,c,d,e){for(let f=b.childCount,g=c.childCount;;){if(0==f||0==g)return f==g?null:{a:d,b:e};let h=b.child(--f),i=c.child(--g),j=h.nodeSize;if(h==i){d-=j,e-=j;continue}if(!h.sameMarkup(i))return{a:d,b:e};if(h.isText&&h.text!=i.text){let a=0,b=Math.min(h.text.length,i.text.length);for(;a<b&&h.text[h.text.length-a-1]==i.text[i.text.length-a-1];)a++,d--,e--;return{a:d,b:e}}if(h.content.size||i.content.size){let b=a(h.content,i.content,d-1,e-1);if(b)return b}d-=j,e-=j}}(this,a,b,c)}findIndex(a){if(0==a)return sL(0,a);if(a==this.size)return sL(this.content.length,a);if(a>this.size||a<0)throw RangeError(`Position ${a} outside of fragment (${this})`);for(let b=0,c=0;;b++){let d=c+this.child(b).nodeSize;if(d>=a){if(d==a)return sL(b+1,d);return sL(b,c)}c=d}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(a=>a.toJSON()):null}static fromJSON(a,b){if(!b)return sJ.empty;if(!Array.isArray(b))throw RangeError("Invalid input for Fragment.fromJSON");return new sJ(b.map(a.nodeFromJSON))}static fromArray(a){if(!a.length)return sJ.empty;let b,c=0;for(let d=0;d<a.length;d++){let e=a[d];c+=e.nodeSize,d&&e.isText&&a[d-1].sameMarkup(e)?(b||(b=a.slice(0,d)),b[b.length-1]=e.withText(b[b.length-1].text+e.text)):b&&b.push(e)}return new sJ(b||a,c)}static from(a){if(!a)return sJ.empty;if(a instanceof sJ)return a;if(Array.isArray(a))return this.fromArray(a);if(a.attrs)return new sJ([a],a.nodeSize);throw RangeError("Can not convert "+a+" to a Fragment"+(a.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}sJ.empty=new sJ([],0);let sK={index:0,offset:0};function sL(a,b){return sK.index=a,sK.offset=b,sK}function sM(a,b){if(a===b)return!0;if(!(a&&"object"==typeof a)||!(b&&"object"==typeof b))return!1;let c=Array.isArray(a);if(Array.isArray(b)!=c)return!1;if(c){if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!sM(a[c],b[c]))return!1}else{for(let c in a)if(!(c in b)||!sM(a[c],b[c]))return!1;for(let c in b)if(!(c in a))return!1}return!0}class sN{constructor(a,b){this.type=a,this.attrs=b}addToSet(a){let b,c=!1;for(let d=0;d<a.length;d++){let e=a[d];if(this.eq(e))return a;if(this.type.excludes(e.type))b||(b=a.slice(0,d));else{if(e.type.excludes(this.type))return a;!c&&e.type.rank>this.type.rank&&(b||(b=a.slice(0,d)),b.push(this),c=!0),b&&b.push(e)}}return b||(b=a.slice()),c||b.push(this),b}removeFromSet(a){for(let b=0;b<a.length;b++)if(this.eq(a[b]))return a.slice(0,b).concat(a.slice(b+1));return a}isInSet(a){for(let b=0;b<a.length;b++)if(this.eq(a[b]))return!0;return!1}eq(a){return this==a||this.type==a.type&&sM(this.attrs,a.attrs)}toJSON(){let a={type:this.type.name};for(let b in this.attrs){a.attrs=this.attrs;break}return a}static fromJSON(a,b){if(!b)throw RangeError("Invalid input for Mark.fromJSON");let c=a.marks[b.type];if(!c)throw RangeError(`There is no mark type ${b.type} in this schema`);let d=c.create(b.attrs);return c.checkAttrs(d.attrs),d}static sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!a[c].eq(b[c]))return!1;return!0}static setFrom(a){if(!a||Array.isArray(a)&&0==a.length)return sN.none;if(a instanceof sN)return[a];let b=a.slice();return b.sort((a,b)=>a.type.rank-b.type.rank),b}}sN.none=[];class sO extends Error{}class sP{constructor(a,b,c){this.content=a,this.openStart=b,this.openEnd=c}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(a,b){let c=function a(b,c,d,e){let{index:f,offset:g}=b.findIndex(c),h=b.maybeChild(f);if(g==c||h.isText)return e&&!e.canReplace(f,f,d)?null:b.cut(0,c).append(d).append(b.cut(c));let i=a(h.content,c-g-1,d,h);return i&&b.replaceChild(f,h.copy(i))}(this.content,a+this.openStart,b);return c&&new sP(c,this.openStart,this.openEnd)}removeBetween(a,b){return new sP(function a(b,c,d){let{index:e,offset:f}=b.findIndex(c),g=b.maybeChild(e),{index:h,offset:i}=b.findIndex(d);if(f==c||g.isText){if(i!=d&&!b.child(h).isText)throw RangeError("Removing non-flat range");return b.cut(0,c).append(b.cut(d))}if(e!=h)throw RangeError("Removing non-flat range");return b.replaceChild(e,g.copy(a(g.content,c-f-1,d-f-1)))}(this.content,a+this.openStart,b+this.openStart),this.openStart,this.openEnd)}eq(a){return this.content.eq(a.content)&&this.openStart==a.openStart&&this.openEnd==a.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let a={content:this.content.toJSON()};return this.openStart>0&&(a.openStart=this.openStart),this.openEnd>0&&(a.openEnd=this.openEnd),a}static fromJSON(a,b){if(!b)return sP.empty;let c=b.openStart||0,d=b.openEnd||0;if("number"!=typeof c||"number"!=typeof d)throw RangeError("Invalid input for Slice.fromJSON");return new sP(sJ.fromJSON(a,b.content),c,d)}static maxOpen(a,b=!0){let c=0,d=0;for(let d=a.firstChild;d&&!d.isLeaf&&(b||!d.type.spec.isolating);d=d.firstChild)c++;for(let c=a.lastChild;c&&!c.isLeaf&&(b||!c.type.spec.isolating);c=c.lastChild)d++;return new sP(a,c,d)}}function sQ(a,b){if(!b.type.compatibleContent(a.type))throw new sO("Cannot join "+b.type.name+" onto "+a.type.name)}function sR(a,b,c){let d=a.node(c);return sQ(d,b.node(c)),d}function sS(a,b){let c=b.length-1;c>=0&&a.isText&&a.sameMarkup(b[c])?b[c]=a.withText(b[c].text+a.text):b.push(a)}function sT(a,b,c,d){let e=(b||a).node(c),f=0,g=b?b.index(c):e.childCount;a&&(f=a.index(c),a.depth>c?f++:a.textOffset&&(sS(a.nodeAfter,d),f++));for(let a=f;a<g;a++)sS(e.child(a),d);b&&b.depth==c&&b.textOffset&&sS(b.nodeBefore,d)}function sU(a,b){return a.type.checkContent(b),a.copy(b)}function sV(a,b,c){let d=[];return sT(null,a,c,d),a.depth>c&&sS(sU(sR(a,b,c+1),sV(a,b,c+1)),d),sT(b,null,c,d),new sJ(d)}sP.empty=new sP(sJ.empty,0,0);class sW{constructor(a,b,c){this.pos=a,this.path=b,this.parentOffset=c,this.depth=b.length/3-1}resolveDepth(a){return null==a?this.depth:a<0?this.depth+a:a}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(a){return this.path[3*this.resolveDepth(a)]}index(a){return this.path[3*this.resolveDepth(a)+1]}indexAfter(a){return a=this.resolveDepth(a),this.index(a)+(a!=this.depth||this.textOffset?1:0)}start(a){return 0==(a=this.resolveDepth(a))?0:this.path[3*a-1]+1}end(a){return a=this.resolveDepth(a),this.start(a)+this.node(a).content.size}before(a){if(!(a=this.resolveDepth(a)))throw RangeError("There is no position before the top-level node");return a==this.depth+1?this.pos:this.path[3*a-1]}after(a){if(!(a=this.resolveDepth(a)))throw RangeError("There is no position after the top-level node");return a==this.depth+1?this.pos:this.path[3*a-1]+this.path[3*a].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let a=this.parent,b=this.index(this.depth);if(b==a.childCount)return null;let c=this.pos-this.path[this.path.length-1],d=a.child(b);return c?a.child(b).cut(c):d}get nodeBefore(){let a=this.index(this.depth),b=this.pos-this.path[this.path.length-1];return b?this.parent.child(a).cut(0,b):0==a?null:this.parent.child(a-1)}posAtIndex(a,b){b=this.resolveDepth(b);let c=this.path[3*b],d=0==b?0:this.path[3*b-1]+1;for(let b=0;b<a;b++)d+=c.child(b).nodeSize;return d}marks(){let a=this.parent,b=this.index();if(0==a.content.size)return sN.none;if(this.textOffset)return a.child(b).marks;let c=a.maybeChild(b-1),d=a.maybeChild(b);if(!c){let a=c;c=d,d=a}let e=c.marks;for(var f=0;f<e.length;f++)!1!==e[f].type.spec.inclusive||d&&e[f].isInSet(d.marks)||(e=e[f--].removeFromSet(e));return e}marksAcross(a){let b=this.parent.maybeChild(this.index());if(!b||!b.isInline)return null;let c=b.marks,d=a.parent.maybeChild(a.index());for(var e=0;e<c.length;e++)!1!==c[e].type.spec.inclusive||d&&c[e].isInSet(d.marks)||(c=c[e--].removeFromSet(c));return c}sharedDepth(a){for(let b=this.depth;b>0;b--)if(this.start(b)<=a&&this.end(b)>=a)return b;return 0}blockRange(a=this,b){if(a.pos<this.pos)return a.blockRange(this);for(let c=this.depth-(this.parent.inlineContent||this.pos==a.pos?1:0);c>=0;c--)if(a.pos<=this.end(c)&&(!b||b(this.node(c))))return new s$(this,a,c);return null}sameParent(a){return this.pos-this.parentOffset==a.pos-a.parentOffset}max(a){return a.pos>this.pos?a:this}min(a){return a.pos<this.pos?a:this}toString(){let a="";for(let b=1;b<=this.depth;b++)a+=(a?"/":"")+this.node(b).type.name+"_"+this.index(b-1);return a+":"+this.parentOffset}static resolve(a,b){if(!(b>=0&&b<=a.content.size))throw RangeError("Position "+b+" out of range");let c=[],d=0,e=b;for(let b=a;;){let{index:a,offset:f}=b.content.findIndex(e),g=e-f;if(c.push(b,a,d+f),!g||(b=b.child(a)).isText)break;e=g-1,d+=f+1}return new sW(b,c,e)}static resolveCached(a,b){let c=sZ.get(a);if(c)for(let a=0;a<c.elts.length;a++){let d=c.elts[a];if(d.pos==b)return d}else sZ.set(a,c=new sX);let d=c.elts[c.i]=sW.resolve(a,b);return c.i=(c.i+1)%sY,d}}class sX{constructor(){this.elts=[],this.i=0}}let sY=12,sZ=new WeakMap;class s${constructor(a,b,c){this.$from=a,this.$to=b,this.depth=c}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}let s_=Object.create(null);class s0{constructor(a,b,c,d=sN.none){this.type=a,this.attrs=b,this.marks=d,this.content=c||sJ.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(a){return this.content.child(a)}maybeChild(a){return this.content.maybeChild(a)}forEach(a){this.content.forEach(a)}nodesBetween(a,b,c,d=0){this.content.nodesBetween(a,b,c,d,this)}descendants(a){this.nodesBetween(0,this.content.size,a)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(a,b,c,d){return this.content.textBetween(a,b,c,d)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(a){return this==a||this.sameMarkup(a)&&this.content.eq(a.content)}sameMarkup(a){return this.hasMarkup(a.type,a.attrs,a.marks)}hasMarkup(a,b,c){return this.type==a&&sM(this.attrs,b||a.defaultAttrs||s_)&&sN.sameSet(this.marks,c||sN.none)}copy(a=null){return a==this.content?this:new s0(this.type,this.attrs,a,this.marks)}mark(a){return a==this.marks?this:new s0(this.type,this.attrs,this.content,a)}cut(a,b=this.content.size){return 0==a&&b==this.content.size?this:this.copy(this.content.cut(a,b))}slice(a,b=this.content.size,c=!1){if(a==b)return sP.empty;let d=this.resolve(a),e=this.resolve(b),f=c?0:d.sharedDepth(b),g=d.start(f);return new sP(d.node(f).content.cut(d.pos-g,e.pos-g),d.depth-f,e.depth-f)}replace(a,b,c){var d=this.resolve(a),e=this.resolve(b);if(c.openStart>d.depth)throw new sO("Inserted content deeper than insertion position");if(d.depth-c.openStart!=e.depth-c.openEnd)throw new sO("Inconsistent open depths");return function a(b,c,d,e){let f=b.index(e),g=b.node(e);if(f==c.index(e)&&e<b.depth-d.openStart){let h=a(b,c,d,e+1);return g.copy(g.content.replaceChild(f,h))}if(!d.content.size)return sU(g,sV(b,c,e));if(d.openStart||d.openEnd||b.depth!=e||c.depth!=e){let{start:a,end:f}=function(a,b){let c=b.depth-a.openStart,d=b.node(c).copy(a.content);for(let a=c-1;a>=0;a--)d=b.node(a).copy(sJ.from(d));return{start:d.resolveNoCache(a.openStart+c),end:d.resolveNoCache(d.content.size-a.openEnd-c)}}(d,b);return sU(g,function a(b,c,d,e,f){let g=b.depth>f&&sR(b,c,f+1),h=e.depth>f&&sR(d,e,f+1),i=[];return sT(null,b,f,i),g&&h&&c.index(f)==d.index(f)?(sQ(g,h),sS(sU(g,a(b,c,d,e,f+1)),i)):(g&&sS(sU(g,sV(b,c,f+1)),i),sT(c,d,f,i),h&&sS(sU(h,sV(d,e,f+1)),i)),sT(e,null,f,i),new sJ(i)}(b,a,f,c,e))}{let a=b.parent,e=a.content;return sU(a,e.cut(0,b.parentOffset).append(d.content).append(e.cut(c.parentOffset)))}}(d,e,c,0)}nodeAt(a){for(let b=this;;){let{index:c,offset:d}=b.content.findIndex(a);if(!(b=b.maybeChild(c)))return null;if(d==a||b.isText)return b;a-=d+1}}childAfter(a){let{index:b,offset:c}=this.content.findIndex(a);return{node:this.content.maybeChild(b),index:b,offset:c}}childBefore(a){if(0==a)return{node:null,index:0,offset:0};let{index:b,offset:c}=this.content.findIndex(a);if(c<a)return{node:this.content.child(b),index:b,offset:c};let d=this.content.child(b-1);return{node:d,index:b-1,offset:c-d.nodeSize}}resolve(a){return sW.resolveCached(this,a)}resolveNoCache(a){return sW.resolve(this,a)}rangeHasMark(a,b,c){let d=!1;return b>a&&this.nodesBetween(a,b,a=>(c.isInSet(a.marks)&&(d=!0),!d)),d}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let a=this.type.name;return this.content.size&&(a+="("+this.content.toStringInner()+")"),s2(this.marks,a)}contentMatchAt(a){let b=this.type.contentMatch.matchFragment(this.content,0,a);if(!b)throw Error("Called contentMatchAt on a node with invalid content");return b}canReplace(a,b,c=sJ.empty,d=0,e=c.childCount){let f=this.contentMatchAt(a).matchFragment(c,d,e),g=f&&f.matchFragment(this.content,b);if(!g||!g.validEnd)return!1;for(let a=d;a<e;a++)if(!this.type.allowsMarks(c.child(a).marks))return!1;return!0}canReplaceWith(a,b,c,d){if(d&&!this.type.allowsMarks(d))return!1;let e=this.contentMatchAt(a).matchType(c),f=e&&e.matchFragment(this.content,b);return!!f&&f.validEnd}canAppend(a){return a.content.size?this.canReplace(this.childCount,this.childCount,a.content):this.type.compatibleContent(a.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let a=sN.none;for(let b=0;b<this.marks.length;b++){let c=this.marks[b];c.type.checkAttrs(c.attrs),a=c.addToSet(a)}if(!sN.sameSet(a,this.marks))throw RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(a=>a.type.name)}`);this.content.forEach(a=>a.check())}toJSON(){let a={type:this.type.name};for(let b in this.attrs){a.attrs=this.attrs;break}return this.content.size&&(a.content=this.content.toJSON()),this.marks.length&&(a.marks=this.marks.map(a=>a.toJSON())),a}static fromJSON(a,b){let c;if(!b)throw RangeError("Invalid input for Node.fromJSON");if(b.marks){if(!Array.isArray(b.marks))throw RangeError("Invalid mark data for Node.fromJSON");c=b.marks.map(a.markFromJSON)}if("text"==b.type){if("string"!=typeof b.text)throw RangeError("Invalid text node in JSON");return a.text(b.text,c)}let d=sJ.fromJSON(a,b.content),e=a.nodeType(b.type).create(b.attrs,d,c);return e.type.checkAttrs(e.attrs),e}}s0.prototype.text=void 0;class s1 extends s0{constructor(a,b,c,d){if(super(a,b,null,d),!c)throw RangeError("Empty text nodes are not allowed");this.text=c}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):s2(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(a,b){return this.text.slice(a,b)}get nodeSize(){return this.text.length}mark(a){return a==this.marks?this:new s1(this.type,this.attrs,this.text,a)}withText(a){return a==this.text?this:new s1(this.type,this.attrs,a,this.marks)}cut(a=0,b=this.text.length){return 0==a&&b==this.text.length?this:this.withText(this.text.slice(a,b))}eq(a){return this.sameMarkup(a)&&this.text==a.text}toJSON(){let a=super.toJSON();return a.text=this.text,a}}function s2(a,b){for(let c=a.length-1;c>=0;c--)b=a[c].type.name+"("+b+")";return b}class s3{constructor(a){this.validEnd=a,this.next=[],this.wrapCache=[]}static parse(a,b){var c;let d,e=new s4(a,b);if(null==e.next)return s3.empty;let f=function a(b){let c=[];do c.push(function(b){let c=[];do c.push(function(b){let c=function(b){if(b.eat("(")){let c=a(b);return b.eat(")")||b.err("Missing closing paren"),c}if(/\W/.test(b.next))b.err("Unexpected token '"+b.next+"'");else{let a=(function(a,b){let c=a.nodeTypes,d=c[b];if(d)return[d];let e=[];for(let a in c){let d=c[a];d.isInGroup(b)&&e.push(d)}return 0==e.length&&a.err("No node type or group '"+b+"' found"),e})(b,b.next).map(a=>(null==b.inline?b.inline=a.isInline:b.inline!=a.isInline&&b.err("Mixing inline and block content"),{type:"name",value:a}));return b.pos++,1==a.length?a[0]:{type:"choice",exprs:a}}}(b);for(;;)if(b.eat("+"))c={type:"plus",expr:c};else if(b.eat("*"))c={type:"star",expr:c};else if(b.eat("?"))c={type:"opt",expr:c};else if(b.eat("{"))c=function(a,b){let c=s5(a),d=c;return a.eat(",")&&(d="}"!=a.next?s5(a):-1),a.eat("}")||a.err("Unclosed braced range"),{type:"range",min:c,max:d,expr:b}}(b,c);else break;return c}(b));while(b.next&&")"!=b.next&&"|"!=b.next)return 1==c.length?c[0]:{type:"seq",exprs:c}}(b));while(b.eat("|"))return 1==c.length?c[0]:{type:"choice",exprs:c}}(e);e.next&&e.err("Unexpected trailing text");let g=(c=function(a){let b=[[]];return e(function a(b,f){if("choice"==b.type)return b.exprs.reduce((b,c)=>b.concat(a(c,f)),[]);if("seq"==b.type)for(let d=0;;d++){let g=a(b.exprs[d],f);if(d==b.exprs.length-1)return g;e(g,f=c())}else if("star"==b.type){let g=c();return d(f,g),e(a(b.expr,g),g),[d(g)]}else if("plus"==b.type){let g=c();return e(a(b.expr,f),g),e(a(b.expr,g),g),[d(g)]}else if("opt"==b.type)return[d(f)].concat(a(b.expr,f));else if("range"==b.type){let g=f;for(let d=0;d<b.min;d++){let d=c();e(a(b.expr,g),d),g=d}if(-1==b.max)e(a(b.expr,g),g);else for(let f=b.min;f<b.max;f++){let f=c();d(g,f),e(a(b.expr,g),f),g=f}return[d(g)]}else if("name"==b.type)return[d(f,void 0,b.value)];else throw Error("Unknown expr type")}(a,0),c()),b;function c(){return b.push([])-1}function d(a,c,d){let e={term:d,to:c};return b[a].push(e),e}function e(a,b){a.forEach(a=>a.to=b)}}(f),d=Object.create(null),function a(b){let e=[];b.forEach(a=>{c[a].forEach(({term:a,to:b})=>{let d;if(a){for(let b=0;b<e.length;b++)e[b][0]==a&&(d=e[b][1]);s7(c,b).forEach(b=>{d||e.push([a,d=[]]),-1==d.indexOf(b)&&d.push(b)})}})});let f=d[b.join(",")]=new s3(b.indexOf(c.length-1)>-1);for(let b=0;b<e.length;b++){let c=e[b][1].sort(s6);f.next.push({type:e[b][0],next:d[c.join(",")]||a(c)})}return f}(s7(c,0)));return function(a,b){for(let c=0,d=[a];c<d.length;c++){let a=d[c],e=!a.validEnd,f=[];for(let b=0;b<a.next.length;b++){let{type:c,next:g}=a.next[b];f.push(c.name),e&&!(c.isText||c.hasRequiredAttrs())&&(e=!1),-1==d.indexOf(g)&&d.push(g)}e&&b.err("Only non-generatable nodes ("+f.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(g,e),g}matchType(a){for(let b=0;b<this.next.length;b++)if(this.next[b].type==a)return this.next[b].next;return null}matchFragment(a,b=0,c=a.childCount){let d=this;for(let e=b;d&&e<c;e++)d=d.matchType(a.child(e).type);return d}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let a=0;a<this.next.length;a++){let{type:b}=this.next[a];if(!(b.isText||b.hasRequiredAttrs()))return b}return null}compatible(a){for(let b=0;b<this.next.length;b++)for(let c=0;c<a.next.length;c++)if(this.next[b].type==a.next[c].type)return!0;return!1}fillBefore(a,b=!1,c=0){let d=[this];return function e(f,g){let h=f.matchFragment(a,c);if(h&&(!b||h.validEnd))return sJ.from(g.map(a=>a.createAndFill()));for(let a=0;a<f.next.length;a++){let{type:b,next:c}=f.next[a];if(!(b.isText||b.hasRequiredAttrs())&&-1==d.indexOf(c)){d.push(c);let a=e(c,g.concat(b));if(a)return a}}return null}(this,[])}findWrapping(a){for(let b=0;b<this.wrapCache.length;b+=2)if(this.wrapCache[b]==a)return this.wrapCache[b+1];let b=this.computeWrapping(a);return this.wrapCache.push(a,b),b}computeWrapping(a){let b=Object.create(null),c=[{match:this,type:null,via:null}];for(;c.length;){let d=c.shift(),e=d.match;if(e.matchType(a)){let a=[];for(let b=d;b.type;b=b.via)a.push(b.type);return a.reverse()}for(let a=0;a<e.next.length;a++){let{type:f,next:g}=e.next[a];f.isLeaf||f.hasRequiredAttrs()||f.name in b||d.type&&!g.validEnd||(c.push({match:f.contentMatch,type:f,via:d}),b[f.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(a){if(a>=this.next.length)throw RangeError(`There's no ${a}th edge in this content match`);return this.next[a]}toString(){let a=[];return!function b(c){a.push(c);for(let d=0;d<c.next.length;d++)-1==a.indexOf(c.next[d].next)&&b(c.next[d].next)}(this),a.map((b,c)=>{let d=c+(b.validEnd?"*":" ")+" ";for(let c=0;c<b.next.length;c++)d+=(c?", ":"")+b.next[c].type.name+"->"+a.indexOf(b.next[c].next);return d}).join("\n")}}s3.empty=new s3(!0);class s4{constructor(a,b){this.string=a,this.nodeTypes=b,this.inline=null,this.pos=0,this.tokens=a.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(a){return this.next==a&&(this.pos++||!0)}err(a){throw SyntaxError(a+" (in content expression '"+this.string+"')")}}function s5(a){/\D/.test(a.next)&&a.err("Expected number, got '"+a.next+"'");let b=Number(a.next);return a.pos++,b}function s6(a,b){return b-a}function s7(a,b){let c=[];return function b(d){let e=a[d];if(1==e.length&&!e[0].term)return b(e[0].to);c.push(d);for(let a=0;a<e.length;a++){let{term:d,to:f}=e[a];d||-1!=c.indexOf(f)||b(f)}}(b),c.sort(s6)}function s8(a){let b=Object.create(null);for(let c in a){let d=a[c];if(!d.hasDefault)return null;b[c]=d.default}return b}function s9(a,b){let c=Object.create(null);for(let d in a){let e=b&&b[d];if(void 0===e){let b=a[d];if(b.hasDefault)e=b.default;else throw RangeError("No value supplied for attribute "+d)}c[d]=e}return c}function ta(a,b,c,d){for(let d in b)if(!(d in a))throw RangeError(`Unsupported attribute ${d} for ${c} of type ${d}`);for(let c in a){let d=a[c];d.validate&&d.validate(b[c])}}function tb(a,b){let c=Object.create(null);if(b)for(let d in b)c[d]=new td(a,d,b[d]);return c}class tc{constructor(a,b,c){this.name=a,this.schema=b,this.spec=c,this.markSet=null,this.groups=c.group?c.group.split(" "):[],this.attrs=tb(a,c.attrs),this.defaultAttrs=s8(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(c.inline||"text"==a),this.isText="text"==a}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==s3.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(a){return this.groups.indexOf(a)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let a in this.attrs)if(this.attrs[a].isRequired)return!0;return!1}compatibleContent(a){return this==a||this.contentMatch.compatible(a.contentMatch)}computeAttrs(a){return!a&&this.defaultAttrs?this.defaultAttrs:s9(this.attrs,a)}create(a=null,b,c){if(this.isText)throw Error("NodeType.create can't construct text nodes");return new s0(this,this.computeAttrs(a),sJ.from(b),sN.setFrom(c))}createChecked(a=null,b,c){return b=sJ.from(b),this.checkContent(b),new s0(this,this.computeAttrs(a),b,sN.setFrom(c))}createAndFill(a=null,b,c){if(a=this.computeAttrs(a),(b=sJ.from(b)).size){let a=this.contentMatch.fillBefore(b);if(!a)return null;b=a.append(b)}let d=this.contentMatch.matchFragment(b),e=d&&d.fillBefore(sJ.empty,!0);return e?new s0(this,a,b.append(e),sN.setFrom(c)):null}validContent(a){let b=this.contentMatch.matchFragment(a);if(!b||!b.validEnd)return!1;for(let b=0;b<a.childCount;b++)if(!this.allowsMarks(a.child(b).marks))return!1;return!0}checkContent(a){if(!this.validContent(a))throw RangeError(`Invalid content for node ${this.name}: ${a.toString().slice(0,50)}`)}checkAttrs(a){ta(this.attrs,a,"node",this.name)}allowsMarkType(a){return null==this.markSet||this.markSet.indexOf(a)>-1}allowsMarks(a){if(null==this.markSet)return!0;for(let b=0;b<a.length;b++)if(!this.allowsMarkType(a[b].type))return!1;return!0}allowedMarks(a){let b;if(null==this.markSet)return a;for(let c=0;c<a.length;c++)this.allowsMarkType(a[c].type)?b&&b.push(a[c]):b||(b=a.slice(0,c));return b?b.length?b:sN.none:a}static compile(a,b){let c=Object.create(null);a.forEach((a,d)=>c[a]=new tc(a,b,d));let d=b.spec.topNode||"doc";if(!c[d])throw RangeError("Schema is missing its top node type ('"+d+"')");if(!c.text)throw RangeError("Every schema needs a 'text' type");for(let a in c.text.attrs)throw RangeError("The text node type should not have attributes");return c}}class td{constructor(a,b,c){this.hasDefault=Object.prototype.hasOwnProperty.call(c,"default"),this.default=c.default,this.validate="string"==typeof c.validate?function(a,b,c){let d=c.split("|");return c=>{let e=null===c?"null":typeof c;if(0>d.indexOf(e))throw RangeError(`Expected value of type ${d} for attribute ${b} on type ${a}, got ${e}`)}}(a,b,c.validate):c.validate}get isRequired(){return!this.hasDefault}}class te{constructor(a,b,c,d){this.name=a,this.rank=b,this.schema=c,this.spec=d,this.attrs=tb(a,d.attrs),this.excluded=null;let e=s8(this.attrs);this.instance=e?new sN(this,e):null}create(a=null){return!a&&this.instance?this.instance:new sN(this,s9(this.attrs,a))}static compile(a,b){let c=Object.create(null),d=0;return a.forEach((a,e)=>c[a]=new te(a,d++,b,e)),c}removeFromSet(a){for(var b=0;b<a.length;b++)a[b].type==this&&(a=a.slice(0,b).concat(a.slice(b+1)),b--);return a}isInSet(a){for(let b=0;b<a.length;b++)if(a[b].type==this)return a[b]}checkAttrs(a){ta(this.attrs,a,"mark",this.name)}excludes(a){return this.excluded.indexOf(a)>-1}}class tf{constructor(a){this.linebreakReplacement=null,this.cached=Object.create(null);let b=this.spec={};for(let c in a)b[c]=a[c];b.nodes=sI.from(a.nodes),b.marks=sI.from(a.marks||{}),this.nodes=tc.compile(this.spec.nodes,this),this.marks=te.compile(this.spec.marks,this);let c=Object.create(null);for(let a in this.nodes){if(a in this.marks)throw RangeError(a+" can not be both a node and a mark");let b=this.nodes[a],d=b.spec.content||"",e=b.spec.marks;if(b.contentMatch=c[d]||(c[d]=s3.parse(d,this.nodes)),b.inlineContent=b.contentMatch.inlineContent,b.spec.linebreakReplacement){if(this.linebreakReplacement)throw RangeError("Multiple linebreak nodes defined");if(!b.isInline||!b.isLeaf)throw RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=b}b.markSet="_"==e?null:e?tg(this,e.split(" ")):""!=e&&b.inlineContent?null:[]}for(let a in this.marks){let b=this.marks[a],c=b.spec.excludes;b.excluded=null==c?[b]:""==c?[]:tg(this,c.split(" "))}this.nodeFromJSON=a=>s0.fromJSON(this,a),this.markFromJSON=a=>sN.fromJSON(this,a),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(a,b=null,c,d){if("string"==typeof a)a=this.nodeType(a);else if(a instanceof tc){if(a.schema!=this)throw RangeError("Node type from different schema used ("+a.name+")")}else throw RangeError("Invalid node type: "+a);return a.createChecked(b,c,d)}text(a,b){let c=this.nodes.text;return new s1(c,c.defaultAttrs,a,sN.setFrom(b))}mark(a,b){return"string"==typeof a&&(a=this.marks[a]),a.create(b)}nodeType(a){let b=this.nodes[a];if(!b)throw RangeError("Unknown node type: "+a);return b}}function tg(a,b){let c=[];for(let d=0;d<b.length;d++){let e=b[d],f=a.marks[e],g=f;if(f)c.push(f);else for(let b in a.marks){let d=a.marks[b];("_"==e||d.spec.group&&d.spec.group.split(" ").indexOf(e)>-1)&&c.push(g=d)}if(!g)throw SyntaxError("Unknown mark type: '"+b[d]+"'")}return c}class th{constructor(a,b){this.schema=a,this.rules=b,this.tags=[],this.styles=[];let c=this.matchedStyles=[];b.forEach(a=>{if(null!=a.tag)this.tags.push(a);else if(null!=a.style){let b=/[^=]*/.exec(a.style)[0];0>c.indexOf(b)&&c.push(b),this.styles.push(a)}}),this.normalizeLists=!this.tags.some(b=>{if(!/^(ul|ol)\b/.test(b.tag)||!b.node)return!1;let c=a.nodes[b.node];return c.contentMatch.matchType(c)})}parse(a,b={}){let c=new tn(this,b,!1);return c.addAll(a,sN.none,b.from,b.to),c.finish()}parseSlice(a,b={}){let c=new tn(this,b,!0);return c.addAll(a,sN.none,b.from,b.to),sP.maxOpen(c.finish())}matchTag(a,b,c){for(let f=c?this.tags.indexOf(c)+1:0;f<this.tags.length;f++){var d,e;let c=this.tags[f];if(d=a,e=c.tag,(d.matches||d.msMatchesSelector||d.webkitMatchesSelector||d.mozMatchesSelector).call(d,e)&&(void 0===c.namespace||a.namespaceURI==c.namespace)&&(!c.context||b.matchesContext(c.context))){if(c.getAttrs){let b=c.getAttrs(a);if(!1===b)continue;c.attrs=b||void 0}return c}}}matchStyle(a,b,c,d){for(let e=d?this.styles.indexOf(d)+1:0;e<this.styles.length;e++){let d=this.styles[e],f=d.style;if(0==f.indexOf(a)&&(!d.context||c.matchesContext(d.context))&&(!(f.length>a.length)||61==f.charCodeAt(a.length)&&f.slice(a.length+1)==b)){if(d.getAttrs){let a=d.getAttrs(b);if(!1===a)continue;d.attrs=a||void 0}return d}}}static schemaRules(a){let b=[];function c(a){let c=null==a.priority?50:a.priority,d=0;for(;d<b.length;d++){let a=b[d];if((null==a.priority?50:a.priority)<c)break}b.splice(d,0,a)}for(let b in a.marks){let d=a.marks[b].spec.parseDOM;d&&d.forEach(a=>{c(a=to(a)),a.mark||a.ignore||a.clearMark||(a.mark=b)})}for(let b in a.nodes){let d=a.nodes[b].spec.parseDOM;d&&d.forEach(a=>{c(a=to(a)),a.node||a.ignore||a.mark||(a.node=b)})}return b}static fromSchema(a){return a.cached.domParser||(a.cached.domParser=new th(a,th.schemaRules(a)))}}let ti={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},tj={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},tk={ol:!0,ul:!0};function tl(a,b,c){return null!=b?!!b|2*("full"===b):a&&"pre"==a.whitespace?3:-5&c}class tm{constructor(a,b,c,d,e,f){this.type=a,this.attrs=b,this.marks=c,this.solid=d,this.options=f,this.content=[],this.activeMarks=sN.none,this.match=e||(4&f?null:a.contentMatch)}findWrapping(a){if(!this.match){if(!this.type)return[];let b=this.type.contentMatch.fillBefore(sJ.from(a));if(b)this.match=this.type.contentMatch.matchFragment(b);else{let b=this.type.contentMatch,c;return(c=b.findWrapping(a.type))?(this.match=b,c):null}}return this.match.findWrapping(a.type)}finish(a){if(!(1&this.options)){let a=this.content[this.content.length-1],b;a&&a.isText&&(b=/[ \t\r\n\u000c]+$/.exec(a.text))&&(a.text.length==b[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-b[0].length)))}let b=sJ.from(this.content);return!a&&this.match&&(b=b.append(this.match.fillBefore(sJ.empty,!0))),this.type?this.type.create(this.attrs,b,this.marks):b}inlineContext(a){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:a.parentNode&&!ti.hasOwnProperty(a.parentNode.nodeName.toLowerCase())}}class tn{constructor(a,b,c){this.parser=a,this.options=b,this.isOpen=c,this.open=0,this.localPreserveWS=!1;let d=b.topNode,e,f=tl(null,b.preserveWhitespace,0)|4*!!c;e=d?new tm(d.type,d.attrs,sN.none,!0,b.topMatch||d.type.contentMatch,f):c?new tm(null,null,sN.none,!0,null,f):new tm(a.schema.topNodeType,null,sN.none,!0,null,f),this.nodes=[e],this.find=b.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(a,b){3==a.nodeType?this.addTextNode(a,b):1==a.nodeType&&this.addElement(a,b)}addTextNode(a,b){let c=a.nodeValue,d=this.top,e=2&d.options?"full":this.localPreserveWS||(1&d.options)>0,{schema:f}=this.parser;if("full"===e||d.inlineContext(a)||/[^ \t\r\n\u000c]/.test(c)){if(e)if("full"===e)c=c.replace(/\r\n?/g,"\n");else if(f.linebreakReplacement&&/[\r\n]/.test(c)&&this.top.findWrapping(f.linebreakReplacement.create())){let a=c.split(/\r?\n|\r/);for(let c=0;c<a.length;c++)c&&this.insertNode(f.linebreakReplacement.create(),b,!0),a[c]&&this.insertNode(f.text(a[c]),b,!/\S/.test(a[c]));c=""}else c=c.replace(/\r?\n|\r/g," ");else if(c=c.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(c)&&this.open==this.nodes.length-1){let b=d.content[d.content.length-1],e=a.previousSibling;(!b||e&&"BR"==e.nodeName||b.isText&&/[ \t\r\n\u000c]$/.test(b.text))&&(c=c.slice(1))}c&&this.insertNode(f.text(c),b,!/\S/.test(c)),this.findInText(a)}else this.findInside(a)}addElement(a,b,c){let d=this.localPreserveWS,e=this.top;("PRE"==a.tagName||/pre/.test(a.style&&a.style.whiteSpace))&&(this.localPreserveWS=!0);let f=a.nodeName.toLowerCase(),g;tk.hasOwnProperty(f)&&this.parser.normalizeLists&&function(a){for(let b=a.firstChild,c=null;b;b=b.nextSibling){let a=1==b.nodeType?b.nodeName.toLowerCase():null;a&&tk.hasOwnProperty(a)&&c?(c.appendChild(b),b=c):"li"==a?c=b:a&&(c=null)}}(a);let h=this.options.ruleFromNode&&this.options.ruleFromNode(a)||(g=this.parser.matchTag(a,this,c));f:if(h?h.ignore:tj.hasOwnProperty(f))this.findInside(a),this.ignoreFallback(a,b);else if(!h||h.skip||h.closeParent){h&&h.closeParent?this.open=Math.max(0,this.open-1):h&&h.skip.nodeType&&(a=h.skip);let c,d=this.needsBlock;if(ti.hasOwnProperty(f))e.content.length&&e.content[0].isInline&&this.open&&(this.open--,e=this.top),c=!0,e.type||(this.needsBlock=!0);else if(!a.firstChild){this.leafFallback(a,b);break f}let g=h&&h.skip?b:this.readStyles(a,b);g&&this.addAll(a,g),c&&this.sync(e),this.needsBlock=d}else{let c=this.readStyles(a,b);c&&this.addElementByRule(a,h,c,!1===h.consuming?g:void 0)}this.localPreserveWS=d}leafFallback(a,b){"BR"==a.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(a.ownerDocument.createTextNode("\n"),b)}ignoreFallback(a,b){"BR"!=a.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),b,!0)}readStyles(a,b){let c=a.style;if(c&&c.length)for(let a=0;a<this.parser.matchedStyles.length;a++){let d=this.parser.matchedStyles[a],e=c.getPropertyValue(d);if(e)for(let a;;){let c=this.parser.matchStyle(d,e,this,a);if(!c)break;if(c.ignore)return null;if(b=c.clearMark?b.filter(a=>!c.clearMark(a)):b.concat(this.parser.schema.marks[c.mark].create(c.attrs)),!1===c.consuming)a=c;else break}}return b}addElementByRule(a,b,c,d){let e,f;if(b.node)if((f=this.parser.schema.nodes[b.node]).isLeaf)this.insertNode(f.create(b.attrs),c,"BR"==a.nodeName)||this.leafFallback(a,c);else{let a=this.enter(f,b.attrs||null,c,b.preserveWhitespace);a&&(e=!0,c=a)}else{let a=this.parser.schema.marks[b.mark];c=c.concat(a.create(b.attrs))}let g=this.top;if(f&&f.isLeaf)this.findInside(a);else if(d)this.addElement(a,c,d);else if(b.getContent)this.findInside(a),b.getContent(a,this.parser.schema).forEach(a=>this.insertNode(a,c,!1));else{let d=a;"string"==typeof b.contentElement?d=a.querySelector(b.contentElement):"function"==typeof b.contentElement?d=b.contentElement(a):b.contentElement&&(d=b.contentElement),this.findAround(a,d,!0),this.addAll(d,c),this.findAround(a,d,!1)}e&&this.sync(g)&&this.open--}addAll(a,b,c,d){let e=c||0;for(let f=c?a.childNodes[c]:a.firstChild,g=null==d?null:a.childNodes[d];f!=g;f=f.nextSibling,++e)this.findAtPoint(a,e),this.addDOM(f,b);this.findAtPoint(a,e)}findPlace(a,b,c){let d,e;for(let b=this.open,f=0;b>=0;b--){let g=this.nodes[b],h=g.findWrapping(a);if(h&&(!d||d.length>h.length+f)&&(d=h,e=g,!h.length))break;if(g.solid){if(c)break;f+=2}}if(!d)return null;this.sync(e);for(let a=0;a<d.length;a++)b=this.enterInner(d[a],null,b,!1);return b}insertNode(a,b,c){if(a.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(b=this.enterInner(a,null,b))}let d=this.findPlace(a,b,c);if(d){this.closeExtra();let b=this.top;b.match&&(b.match=b.match.matchType(a.type));let c=sN.none;for(let e of d.concat(a.marks))(b.type?b.type.allowsMarkType(e.type):tp(e.type,a.type))&&(c=e.addToSet(c));return b.content.push(a.mark(c)),!0}return!1}enter(a,b,c,d){let e=this.findPlace(a.create(b),c,!1);return e&&(e=this.enterInner(a,b,c,!0,d)),e}enterInner(a,b,c,d=!1,e){this.closeExtra();let f=this.top;f.match=f.match&&f.match.matchType(a);let g=tl(a,e,f.options);4&f.options&&0==f.content.length&&(g|=4);let h=sN.none;return c=c.filter(b=>(f.type?!f.type.allowsMarkType(b.type):!tp(b.type,a))||(h=b.addToSet(h),!1)),this.nodes.push(new tm(a,b,h,d,null,g)),this.open++,c}closeExtra(a=!1){let b=this.nodes.length-1;if(b>this.open){for(;b>this.open;b--)this.nodes[b-1].content.push(this.nodes[b].finish(a));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(a){for(let b=this.open;b>=0;b--)if(this.nodes[b]==a)return this.open=b,!0;else this.localPreserveWS&&(this.nodes[b].options|=1);return!1}get currentPos(){this.closeExtra();let a=0;for(let b=this.open;b>=0;b--){let c=this.nodes[b].content;for(let b=c.length-1;b>=0;b--)a+=c[b].nodeSize;b&&a++}return a}findAtPoint(a,b){if(this.find)for(let c=0;c<this.find.length;c++)this.find[c].node==a&&this.find[c].offset==b&&(this.find[c].pos=this.currentPos)}findInside(a){if(this.find)for(let b=0;b<this.find.length;b++)null==this.find[b].pos&&1==a.nodeType&&a.contains(this.find[b].node)&&(this.find[b].pos=this.currentPos)}findAround(a,b,c){if(a!=b&&this.find)for(let d=0;d<this.find.length;d++)null==this.find[d].pos&&1==a.nodeType&&a.contains(this.find[d].node)&&b.compareDocumentPosition(this.find[d].node)&(c?2:4)&&(this.find[d].pos=this.currentPos)}findInText(a){if(this.find)for(let b=0;b<this.find.length;b++)this.find[b].node==a&&(this.find[b].pos=this.currentPos-(a.nodeValue.length-this.find[b].offset))}matchesContext(a){if(a.indexOf("|")>-1)return a.split(/\s*\|\s*/).some(this.matchesContext,this);let b=a.split("/"),c=this.options.context,d=!this.isOpen&&(!c||c.parent.type==this.nodes[0].type),e=-(c?c.depth+1:0)+ +!d,f=(a,g)=>{for(;a>=0;a--){let h=b[a];if(""==h){if(a==b.length-1||0==a)continue;for(;g>=e;g--)if(f(a-1,g))return!0;return!1}{let a=g>0||0==g&&d?this.nodes[g].type:c&&g>=e?c.node(g-e).type:null;if(!a||a.name!=h&&!a.isInGroup(h))return!1;g--}}return!0};return f(b.length-1,this.open)}textblockFromContext(){let a=this.options.context;if(a)for(let b=a.depth;b>=0;b--){let c=a.node(b).contentMatchAt(a.indexAfter(b)).defaultType;if(c&&c.isTextblock&&c.defaultAttrs)return c}for(let a in this.parser.schema.nodes){let b=this.parser.schema.nodes[a];if(b.isTextblock&&b.defaultAttrs)return b}}}function to(a){let b={};for(let c in a)b[c]=a[c];return b}function tp(a,b){let c=b.schema.nodes;for(let d in c){let e=c[d];if(!e.allowsMarkType(a))continue;let f=[],g=a=>{f.push(a);for(let c=0;c<a.edgeCount;c++){let{type:d,next:e}=a.edge(c);if(d==b||0>f.indexOf(e)&&g(e))return!0}};if(g(e.contentMatch))return!0}}class tq{constructor(a,b){this.nodes=a,this.marks=b}serializeFragment(a,b={},c){c||(c=ts(b).createDocumentFragment());let d=c,e=[];return a.forEach(a=>{if(e.length||a.marks.length){let c=0,f=0;for(;c<e.length&&f<a.marks.length;){let b=a.marks[f];if(!this.marks[b.type.name]){f++;continue}if(!b.eq(e[c][0])||!1===b.type.spec.spanning)break;c++,f++}for(;c<e.length;)d=e.pop()[1];for(;f<a.marks.length;){let c=a.marks[f++],g=this.serializeMark(c,a.isInline,b);g&&(e.push([c,d]),d.appendChild(g.dom),d=g.contentDOM||g.dom)}}d.appendChild(this.serializeNodeInner(a,b))}),c}serializeNodeInner(a,b){let{dom:c,contentDOM:d}=tu(ts(b),this.nodes[a.type.name](a),null,a.attrs);if(d){if(a.isLeaf)throw RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(a.content,b,d)}return c}serializeNode(a,b={}){let c=this.serializeNodeInner(a,b);for(let d=a.marks.length-1;d>=0;d--){let e=this.serializeMark(a.marks[d],a.isInline,b);e&&((e.contentDOM||e.dom).appendChild(c),c=e.dom)}return c}serializeMark(a,b,c={}){let d=this.marks[a.type.name];return d&&tu(ts(c),d(a,b),null,a.attrs)}static renderSpec(a,b,c=null,d){return tu(a,b,c,d)}static fromSchema(a){return a.cached.domSerializer||(a.cached.domSerializer=new tq(this.nodesFromSchema(a),this.marksFromSchema(a)))}static nodesFromSchema(a){let b=tr(a.nodes);return b.text||(b.text=a=>a.text),b}static marksFromSchema(a){return tr(a.marks)}}function tr(a){let b={};for(let c in a){let d=a[c].spec.toDOM;d&&(b[c]=d)}return b}function ts(a){return a.document||window.document}let tt=new WeakMap;function tu(a,b,c,d){let e,f,g;if("string"==typeof b)return{dom:a.createTextNode(b)};if(null!=b.nodeType)return{dom:b};if(b.dom&&null!=b.dom.nodeType)return b;let h=b[0],i;if("string"!=typeof h)throw RangeError("Invalid array passed to renderSpec");if(d&&(void 0===(f=tt.get(d))&&tt.set(d,(g=null,!function a(b){if(b&&"object"==typeof b)if(Array.isArray(b))if("string"==typeof b[0])g||(g=[]),g.push(b);else for(let c=0;c<b.length;c++)a(b[c]);else for(let c in b)a(b[c])}(d),f=g)),i=f)&&i.indexOf(b)>-1)throw RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let j=h.indexOf(" ");j>0&&(c=h.slice(0,j),h=h.slice(j+1));let k=c?a.createElementNS(c,h):a.createElement(h),l=b[1],m=1;if(l&&"object"==typeof l&&null==l.nodeType&&!Array.isArray(l)){for(let a in m=2,l)if(null!=l[a]){let b=a.indexOf(" ");b>0?k.setAttributeNS(a.slice(0,b),a.slice(b+1),l[a]):"style"==a&&k.style?k.style.cssText=l[a]:k.setAttribute(a,l[a])}}for(let f=m;f<b.length;f++){let g=b[f];if(0===g){if(f<b.length-1||f>m)throw RangeError("Content hole must be the only child of its parent node");return{dom:k,contentDOM:k}}{let{dom:b,contentDOM:f}=tu(a,g,c,d);if(k.appendChild(b),f){if(e)throw RangeError("Multiple content holes");e=f}}}return{dom:k,contentDOM:e}}class tv{constructor(a,b,c){this.pos=a,this.delInfo=b,this.recover=c}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class tw{constructor(a,b=!1){if(this.ranges=a,this.inverted=b,!a.length&&tw.empty)return tw.empty}recover(a){let b=0,c=65535&a;if(!this.inverted)for(let a=0;a<c;a++)b+=this.ranges[3*a+2]-this.ranges[3*a+1];return this.ranges[3*c]+b+(a-(65535&a))/65536}mapResult(a,b=1){return this._map(a,b,!1)}map(a,b=1){return this._map(a,b,!0)}_map(a,b,c){let d=0,e=this.inverted?2:1,f=this.inverted?1:2;for(let g=0;g<this.ranges.length;g+=3){let h=this.ranges[g]-(this.inverted?d:0);if(h>a)break;let i=this.ranges[g+e],j=this.ranges[g+f],k=h+i;if(a<=k){let e=i?a==h?-1:a==k?1:b:b,f=h+d+(e<0?0:j);if(c)return f;let l=a==(b<0?h:k)?null:g/3+(a-h)*65536,m=a==h?2:a==k?1:4;return(b<0?a!=h:a!=k)&&(m|=8),new tv(f,m,l)}d+=j-i}return c?a+d:new tv(a+d,0,null)}touches(a,b){let c=0,d=65535&b,e=this.inverted?2:1,f=this.inverted?1:2;for(let b=0;b<this.ranges.length;b+=3){let g=this.ranges[b]-(this.inverted?c:0);if(g>a)break;let h=this.ranges[b+e];if(a<=g+h&&b==3*d)return!0;c+=this.ranges[b+f]-h}return!1}forEach(a){let b=this.inverted?2:1,c=this.inverted?1:2;for(let d=0,e=0;d<this.ranges.length;d+=3){let f=this.ranges[d],g=f-(this.inverted?e:0),h=f+(this.inverted?0:e),i=this.ranges[d+b],j=this.ranges[d+c];a(g,g+i,h,h+j),e+=j-i}}invert(){return new tw(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(a){return 0==a?tw.empty:new tw(a<0?[0,-a,0]:[0,0,a])}}tw.empty=new tw([]);class tx{constructor(a,b,c=0,d=a?a.length:0){this.mirror=b,this.from=c,this.to=d,this._maps=a||[],this.ownData=!(a||b)}get maps(){return this._maps}slice(a=0,b=this.maps.length){return new tx(this._maps,this.mirror,a,b)}appendMap(a,b){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(a),null!=b&&this.setMirror(this._maps.length-1,b)}appendMapping(a){for(let b=0,c=this._maps.length;b<a._maps.length;b++){let d=a.getMirror(b);this.appendMap(a._maps[b],null!=d&&d<b?c+d:void 0)}}getMirror(a){if(this.mirror){for(let b=0;b<this.mirror.length;b++)if(this.mirror[b]==a)return this.mirror[b+(b%2?-1:1)]}}setMirror(a,b){this.mirror||(this.mirror=[]),this.mirror.push(a,b)}appendMappingInverted(a){for(let b=a.maps.length-1,c=this._maps.length+a._maps.length;b>=0;b--){let d=a.getMirror(b);this.appendMap(a._maps[b].invert(),null!=d&&d>b?c-d-1:void 0)}}invert(){let a=new tx;return a.appendMappingInverted(this),a}map(a,b=1){if(this.mirror)return this._map(a,b,!0);for(let c=this.from;c<this.to;c++)a=this._maps[c].map(a,b);return a}mapResult(a,b=1){return this._map(a,b,!1)}_map(a,b,c){let d=0;for(let c=this.from;c<this.to;c++){let e=this._maps[c].mapResult(a,b);if(null!=e.recover){let b=this.getMirror(c);if(null!=b&&b>c&&b<this.to){c=b,a=this._maps[b].recover(e.recover);continue}}d|=e.delInfo,a=e.pos}return c?a:new tv(a,d,null)}}let ty=Object.create(null);class tz{getMap(){return tw.empty}merge(a){return null}static fromJSON(a,b){if(!b||!b.stepType)throw RangeError("Invalid input for Step.fromJSON");let c=ty[b.stepType];if(!c)throw RangeError(`No step type ${b.stepType} defined`);return c.fromJSON(a,b)}static jsonID(a,b){if(a in ty)throw RangeError("Duplicate use of step JSON ID "+a);return ty[a]=b,b.prototype.jsonID=a,b}}class tA{constructor(a,b){this.doc=a,this.failed=b}static ok(a){return new tA(a,null)}static fail(a){return new tA(null,a)}static fromReplace(a,b,c,d){try{return tA.ok(a.replace(b,c,d))}catch(a){if(a instanceof sO)return tA.fail(a.message);throw a}}}function tB(a,b,c){let d=[];for(let e=0;e<a.childCount;e++){let f=a.child(e);f.content.size&&(f=f.copy(tB(f.content,b,f))),f.isInline&&(f=b(f,c,e)),d.push(f)}return sJ.fromArray(d)}class tC extends tz{constructor(a,b,c){super(),this.from=a,this.to=b,this.mark=c}apply(a){let b=a.slice(this.from,this.to),c=a.resolve(this.from),d=c.node(c.sharedDepth(this.to)),e=new sP(tB(b.content,(a,b)=>a.isAtom&&b.type.allowsMarkType(this.mark.type)?a.mark(this.mark.addToSet(a.marks)):a,d),b.openStart,b.openEnd);return tA.fromReplace(a,this.from,this.to,e)}invert(){return new tD(this.from,this.to,this.mark)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deleted&&c.deleted||b.pos>=c.pos?null:new tC(b.pos,c.pos,this.mark)}merge(a){return a instanceof tC&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from?new tC(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for AddMarkStep.fromJSON");return new tC(b.from,b.to,a.markFromJSON(b.mark))}}tz.jsonID("addMark",tC);class tD extends tz{constructor(a,b,c){super(),this.from=a,this.to=b,this.mark=c}apply(a){let b=a.slice(this.from,this.to),c=new sP(tB(b.content,a=>a.mark(this.mark.removeFromSet(a.marks)),a),b.openStart,b.openEnd);return tA.fromReplace(a,this.from,this.to,c)}invert(){return new tC(this.from,this.to,this.mark)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deleted&&c.deleted||b.pos>=c.pos?null:new tD(b.pos,c.pos,this.mark)}merge(a){return a instanceof tD&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from?new tD(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for RemoveMarkStep.fromJSON");return new tD(b.from,b.to,a.markFromJSON(b.mark))}}tz.jsonID("removeMark",tD);class tE extends tz{constructor(a,b){super(),this.pos=a,this.mark=b}apply(a){let b=a.nodeAt(this.pos);if(!b)return tA.fail("No node at mark step's position");let c=b.type.create(b.attrs,null,this.mark.addToSet(b.marks));return tA.fromReplace(a,this.pos,this.pos+1,new sP(sJ.from(c),0,+!b.isLeaf))}invert(a){let b=a.nodeAt(this.pos);if(b){let a=this.mark.addToSet(b.marks);if(a.length==b.marks.length){for(let c=0;c<b.marks.length;c++)if(!b.marks[c].isInSet(a))return new tE(this.pos,b.marks[c]);return new tE(this.pos,this.mark)}}return new tF(this.pos,this.mark)}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new tE(b.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new tE(b.pos,a.markFromJSON(b.mark))}}tz.jsonID("addNodeMark",tE);class tF extends tz{constructor(a,b){super(),this.pos=a,this.mark=b}apply(a){let b=a.nodeAt(this.pos);if(!b)return tA.fail("No node at mark step's position");let c=b.type.create(b.attrs,null,this.mark.removeFromSet(b.marks));return tA.fromReplace(a,this.pos,this.pos+1,new sP(sJ.from(c),0,+!b.isLeaf))}invert(a){let b=a.nodeAt(this.pos);return b&&this.mark.isInSet(b.marks)?new tE(this.pos,this.mark):this}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new tF(b.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new tF(b.pos,a.markFromJSON(b.mark))}}tz.jsonID("removeNodeMark",tF);class tG extends tz{constructor(a,b,c,d=!1){super(),this.from=a,this.to=b,this.slice=c,this.structure=d}apply(a){return this.structure&&tI(a,this.from,this.to)?tA.fail("Structure replace would overwrite content"):tA.fromReplace(a,this.from,this.to,this.slice)}getMap(){return new tw([this.from,this.to-this.from,this.slice.size])}invert(a){return new tG(this.from,this.from+this.slice.size,a.slice(this.from,this.to))}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deletedAcross&&c.deletedAcross?null:new tG(b.pos,Math.max(b.pos,c.pos),this.slice,this.structure)}merge(a){if(!(a instanceof tG)||a.structure||this.structure)return null;if(this.from+this.slice.size!=a.from||this.slice.openEnd||a.slice.openStart)if(a.to!=this.from||this.slice.openStart||a.slice.openEnd)return null;else{let b=this.slice.size+a.slice.size==0?sP.empty:new sP(a.slice.content.append(this.slice.content),a.slice.openStart,this.slice.openEnd);return new tG(a.from,this.to,b,this.structure)}{let b=this.slice.size+a.slice.size==0?sP.empty:new sP(this.slice.content.append(a.slice.content),this.slice.openStart,a.slice.openEnd);return new tG(this.from,this.to+(a.to-a.from),b,this.structure)}}toJSON(){let a={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for ReplaceStep.fromJSON");return new tG(b.from,b.to,sP.fromJSON(a,b.slice),!!b.structure)}}tz.jsonID("replace",tG);class tH extends tz{constructor(a,b,c,d,e,f,g=!1){super(),this.from=a,this.to=b,this.gapFrom=c,this.gapTo=d,this.slice=e,this.insert=f,this.structure=g}apply(a){if(this.structure&&(tI(a,this.from,this.gapFrom)||tI(a,this.gapTo,this.to)))return tA.fail("Structure gap-replace would overwrite content");let b=a.slice(this.gapFrom,this.gapTo);if(b.openStart||b.openEnd)return tA.fail("Gap is not a flat range");let c=this.slice.insertAt(this.insert,b.content);return c?tA.fromReplace(a,this.from,this.to,c):tA.fail("Content does not fit in gap")}getMap(){return new tw([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(a){let b=this.gapTo-this.gapFrom;return new tH(this.from,this.from+this.slice.size+b,this.from+this.insert,this.from+this.insert+b,a.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1),d=this.from==this.gapFrom?b.pos:a.map(this.gapFrom,-1),e=this.to==this.gapTo?c.pos:a.map(this.gapTo,1);return b.deletedAcross&&c.deletedAcross||d<b.pos||e>c.pos?null:new tH(b.pos,c.pos,d,e,this.slice,this.insert,this.structure)}toJSON(){let a={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to||"number"!=typeof b.gapFrom||"number"!=typeof b.gapTo||"number"!=typeof b.insert)throw RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new tH(b.from,b.to,b.gapFrom,b.gapTo,sP.fromJSON(a,b.slice),b.insert,!!b.structure)}}function tI(a,b,c){let d=a.resolve(b),e=c-b,f=d.depth;for(;e>0&&f>0&&d.indexAfter(f)==d.node(f).childCount;)f--,e--;if(e>0){let a=d.node(f).maybeChild(d.indexAfter(f));for(;e>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,e--}}return!1}function tJ(a,b,c,d=c.contentMatch,e=!0){let f=a.doc.nodeAt(b),g=[],h=b+1;for(let b=0;b<f.childCount;b++){let i=f.child(b),j=h+i.nodeSize,k=d.matchType(i.type);if(k){d=k;for(let b=0;b<i.marks.length;b++)c.allowsMarkType(i.marks[b].type)||a.step(new tD(h,j,i.marks[b]));if(e&&i.isText&&"pre"!=c.whitespace){let a,b=/\r?\n|\r/g,d;for(;a=b.exec(i.text);)d||(d=new sP(sJ.from(c.schema.text(" ",c.allowedMarks(i.marks))),0,0)),g.push(new tG(h+a.index,h+a.index+a[0].length,d))}}else g.push(new tG(h,j,sP.empty));h=j}if(!d.validEnd){let b=d.fillBefore(sJ.empty,!0);a.replace(h,h,new sP(b,0,0))}for(let b=g.length-1;b>=0;b--)a.step(g[b])}function tK(a){let b=a.parent.content.cutByIndex(a.startIndex,a.endIndex);for(let c=a.depth,d=0,e=0;;--c){let f=a.$from.node(c),g=a.$from.index(c)+d,h=a.$to.indexAfter(c)-e;if(c<a.depth&&f.canReplace(g,h,b))return c;if(0==c||f.type.spec.isolating||!((0==g||f.canReplace(g,f.childCount))&&(h==f.childCount||f.canReplace(0,h))))break;g&&(d=1),h<f.childCount&&(e=1)}return null}function tL(a,b,c=null,d=a){let e=function(a,b){let{parent:c,startIndex:d,endIndex:e}=a,f=c.contentMatchAt(d).findWrapping(b);if(!f)return null;let g=f.length?f[0]:b;return c.canReplaceWith(d,e,g)?f:null}(a,b),f=e&&function(a,b){let{parent:c,startIndex:d,endIndex:e}=a,f=c.child(d),g=b.contentMatch.findWrapping(f.type);if(!g)return null;let h=(g.length?g[g.length-1]:b).contentMatch;for(let a=d;h&&a<e;a++)h=h.matchType(c.child(a).type);return h&&h.validEnd?g:null}(d,b);return f?e.map(tM).concat({type:b,attrs:c}).concat(f.map(tM)):null}function tM(a){return{type:a,attrs:null}}function tN(a,b,c,d){b.forEach((e,f)=>{if(e.isText){let g,h=/\r?\n|\r/g;for(;g=h.exec(e.text);){let e=a.mapping.slice(d).map(c+1+f+g.index);a.replaceWith(e,e+1,b.type.schema.linebreakReplacement.create())}}})}function tO(a,b,c,d){b.forEach((e,f)=>{if(e.type==e.type.schema.linebreakReplacement){let e=a.mapping.slice(d).map(c+1+f);a.replaceWith(e,e+1,b.type.schema.text("\n"))}})}function tP(a,b,c=1,d){let e=a.resolve(b),f=e.depth-c,g=d&&d[d.length-1]||e.parent;if(f<0||e.parent.type.spec.isolating||!e.parent.canReplace(e.index(),e.parent.childCount)||!g.type.validContent(e.parent.content.cutByIndex(e.index(),e.parent.childCount)))return!1;for(let a=e.depth-1,b=c-2;a>f;a--,b--){let c=e.node(a),f=e.index(a);if(c.type.spec.isolating)return!1;let g=c.content.cutByIndex(f,c.childCount),h=d&&d[b+1];h&&(g=g.replaceChild(0,h.type.create(h.attrs)));let i=d&&d[b]||c;if(!c.canReplace(f+1,c.childCount)||!i.type.validContent(g))return!1}let h=e.indexAfter(f),i=d&&d[0];return e.node(f).canReplaceWith(h,h,i?i.type:e.node(f+1).type)}function tQ(a,b){let c=a.resolve(b),d=c.index();return tR(c.nodeBefore,c.nodeAfter)&&c.parent.canReplace(d,d+1)}function tR(a,b){return!!(a&&b&&!a.isLeaf&&function(a,b){b.content.size||a.type.compatibleContent(b.type);let c=a.contentMatchAt(a.childCount),{linebreakReplacement:d}=a.type.schema;for(let e=0;e<b.childCount;e++){let f=b.child(e),g=f.type==d?a.type.schema.nodes.text:f.type;if(!(c=c.matchType(g))||!a.type.allowsMarks(f.marks))return!1}return c.validEnd}(a,b))}function tS(a,b,c=-1){let d=a.resolve(b);for(let a=d.depth;;a--){let e,f,g=d.index(a);if(a==d.depth?(e=d.nodeBefore,f=d.nodeAfter):c>0?(e=d.node(a+1),g++,f=d.node(a).maybeChild(g)):(e=d.node(a).maybeChild(g-1),f=d.node(a+1)),e&&!e.isTextblock&&tR(e,f)&&d.node(a).canReplace(g,g+1))return b;if(0==a)break;b=c<0?d.before(a):d.after(a)}}function tT(a,b,c){let d=a.resolve(b);if(!c.content.size)return b;let e=c.content;for(let a=0;a<c.openStart;a++)e=e.firstChild.content;for(let a=1;a<=(0==c.openStart&&c.size?2:1);a++)for(let b=d.depth;b>=0;b--){let c=b==d.depth?0:d.pos<=(d.start(b+1)+d.end(b+1))/2?-1:1,f=d.index(b)+ +(c>0),g=d.node(b),h=!1;if(1==a)h=g.canReplace(f,f,e);else{let a=g.contentMatchAt(f).findWrapping(e.firstChild.type);h=a&&g.canReplaceWith(f,f,a[0])}if(h)return 0==c?d.pos:c<0?d.before(b+1):d.after(b+1)}return null}function tU(a,b,c=b,d=sP.empty){if(b==c&&!d.size)return null;let e=a.resolve(b),f=a.resolve(c);return tV(e,f,d)?new tG(b,c,d):new tW(e,f,d).fit()}function tV(a,b,c){return!c.openStart&&!c.openEnd&&a.start()==b.start()&&a.parent.canReplace(a.index(),b.index(),c.content)}tz.jsonID("replaceAround",tH);class tW{constructor(a,b,c){this.$from=a,this.$to=b,this.unplaced=c,this.frontier=[],this.placed=sJ.empty;for(let b=0;b<=a.depth;b++){let c=a.node(b);this.frontier.push({type:c.type,match:c.contentMatchAt(a.indexAfter(b))})}for(let b=a.depth;b>0;b--)this.placed=sJ.from(a.node(b).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let a=this.findFittable();a?this.placeNodes(a):this.openMore()||this.dropNode()}let a=this.mustMoveInline(),b=this.placed.size-this.depth-this.$from.depth,c=this.$from,d=this.close(a<0?this.$to:c.doc.resolve(a));if(!d)return null;let e=this.placed,f=c.depth,g=d.depth;for(;f&&g&&1==e.childCount;)e=e.firstChild.content,f--,g--;let h=new sP(e,f,g);return a>-1?new tH(c.pos,a,this.$to.pos,this.$to.end(),h,b):h.size||c.pos!=this.$to.pos?new tG(c.pos,d.pos,h):null}findFittable(){let a=this.unplaced.openStart;for(let b=this.unplaced.content,c=0,d=this.unplaced.openEnd;c<a;c++){let e=b.firstChild;if(b.childCount>1&&(d=0),e.type.spec.isolating&&d<=c){a=c;break}b=e.content}for(let b=1;b<=2;b++)for(let c=1==b?a:this.unplaced.openStart;c>=0;c--){let a=null,d=(c?(a=tZ(this.unplaced.content,c-1).firstChild).content:this.unplaced.content).firstChild;for(let e=this.depth;e>=0;e--){let{type:f,match:g}=this.frontier[e],h,i=null;if(1==b&&(d?g.matchType(d.type)||(i=g.fillBefore(sJ.from(d),!1)):a&&f.compatibleContent(a.type)))return{sliceDepth:c,frontierDepth:e,parent:a,inject:i};if(2==b&&d&&(h=g.findWrapping(d.type)))return{sliceDepth:c,frontierDepth:e,parent:a,wrap:h};if(a&&g.matchType(a.type))break}}}openMore(){let{content:a,openStart:b,openEnd:c}=this.unplaced,d=tZ(a,b);return!!d.childCount&&!d.firstChild.isLeaf&&(this.unplaced=new sP(a,b+1,Math.max(c,d.size+b>=a.size-c?b+1:0)),!0)}dropNode(){let{content:a,openStart:b,openEnd:c}=this.unplaced,d=tZ(a,b);if(d.childCount<=1&&b>0){let e=a.size-b<=b+d.size;this.unplaced=new sP(tX(a,b-1,1),b-1,e?b-1:c)}else this.unplaced=new sP(tX(a,b,1),b,c)}placeNodes({sliceDepth:a,frontierDepth:b,parent:c,inject:d,wrap:e}){for(;this.depth>b;)this.closeFrontierNode();if(e)for(let a=0;a<e.length;a++)this.openFrontierNode(e[a]);let f=this.unplaced,g=c?c.content:f.content,h=f.openStart-a,i=0,j=[],{match:k,type:l}=this.frontier[b];if(d){for(let a=0;a<d.childCount;a++)j.push(d.child(a));k=k.matchFragment(d)}let m=g.size+a-(f.content.size-f.openEnd);for(;i<g.childCount;){let a=g.child(i),b=k.matchType(a.type);if(!b)break;(++i>1||0==h||a.content.size)&&(k=b,j.push(function a(b,c,d){if(c<=0)return b;let e=b.content;return c>1&&(e=e.replaceChild(0,a(e.firstChild,c-1,1==e.childCount?d-1:0))),c>0&&(e=b.type.contentMatch.fillBefore(e).append(e),d<=0&&(e=e.append(b.type.contentMatch.matchFragment(e).fillBefore(sJ.empty,!0)))),b.copy(e)}(a.mark(l.allowedMarks(a.marks)),1==i?h:0,i==g.childCount?m:-1)))}let n=i==g.childCount;n||(m=-1),this.placed=tY(this.placed,b,sJ.from(j)),this.frontier[b].match=k,n&&m<0&&c&&c.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let a=0,b=g;a<m;a++){let a=b.lastChild;this.frontier.push({type:a.type,match:a.contentMatchAt(a.childCount)}),b=a.content}this.unplaced=n?0==a?sP.empty:new sP(tX(f.content,a-1,1),a-1,m<0?f.openEnd:a-1):new sP(tX(f.content,a,i),f.openStart,f.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return -1;let a=this.frontier[this.depth],b;if(!a.type.isTextblock||!t$(this.$to,this.$to.depth,a.type,a.match,!1)||this.$to.depth==this.depth&&(b=this.findCloseLevel(this.$to))&&b.depth==this.depth)return -1;let{depth:c}=this.$to,d=this.$to.after(c);for(;c>1&&d==this.$to.end(--c);)++d;return d}findCloseLevel(a){g:for(let b=Math.min(this.depth,a.depth);b>=0;b--){let{match:c,type:d}=this.frontier[b],e=b<a.depth&&a.end(b+1)==a.pos+(a.depth-(b+1)),f=t$(a,b,d,c,e);if(f){for(let c=b-1;c>=0;c--){let{match:b,type:d}=this.frontier[c],e=t$(a,c,d,b,!0);if(!e||e.childCount)continue g}return{depth:b,fit:f,move:e?a.doc.resolve(a.after(b+1)):a}}}}close(a){let b=this.findCloseLevel(a);if(!b)return null;for(;this.depth>b.depth;)this.closeFrontierNode();b.fit.childCount&&(this.placed=tY(this.placed,b.depth,b.fit)),a=b.move;for(let c=b.depth+1;c<=a.depth;c++){let b=a.node(c),d=b.type.contentMatch.fillBefore(b.content,!0,a.index(c));this.openFrontierNode(b.type,b.attrs,d)}return a}openFrontierNode(a,b=null,c){let d=this.frontier[this.depth];d.match=d.match.matchType(a),this.placed=tY(this.placed,this.depth,sJ.from(a.create(b,c))),this.frontier.push({type:a,match:a.contentMatch})}closeFrontierNode(){let a=this.frontier.pop().match.fillBefore(sJ.empty,!0);a.childCount&&(this.placed=tY(this.placed,this.frontier.length,a))}}function tX(a,b,c){return 0==b?a.cutByIndex(c,a.childCount):a.replaceChild(0,a.firstChild.copy(tX(a.firstChild.content,b-1,c)))}function tY(a,b,c){return 0==b?a.append(c):a.replaceChild(a.childCount-1,a.lastChild.copy(tY(a.lastChild.content,b-1,c)))}function tZ(a,b){for(let c=0;c<b;c++)a=a.firstChild.content;return a}function t$(a,b,c,d,e){let f=a.node(b),g=e?a.indexAfter(b):a.index(b);if(g==f.childCount&&!c.compatibleContent(f.type))return null;let h=d.fillBefore(f.content,!0,g);return h&&!function(a,b,c){for(let d=c;d<b.childCount;d++)if(!a.allowsMarks(b.child(d).marks))return!0;return!1}(c,f.content,g)?h:null}function t_(a,b){let c=[],d=Math.min(a.depth,b.depth);for(let e=d;e>=0;e--){let d=a.start(e);if(d<a.pos-(a.depth-e)||b.end(e)>b.pos+(b.depth-e)||a.node(e).type.spec.isolating||b.node(e).type.spec.isolating)break;(d==b.start(e)||e==a.depth&&e==b.depth&&a.parent.inlineContent&&b.parent.inlineContent&&e&&b.start(e-1)==d-1)&&c.push(e)}return c}class t0 extends tz{constructor(a,b,c){super(),this.pos=a,this.attr=b,this.value=c}apply(a){let b=a.nodeAt(this.pos);if(!b)return tA.fail("No node at attribute step's position");let c=Object.create(null);for(let a in b.attrs)c[a]=b.attrs[a];c[this.attr]=this.value;let d=b.type.create(c,null,b.marks);return tA.fromReplace(a,this.pos,this.pos+1,new sP(sJ.from(d),0,+!b.isLeaf))}getMap(){return tw.empty}invert(a){return new t0(this.pos,this.attr,a.nodeAt(this.pos).attrs[this.attr])}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new t0(b.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(a,b){if("number"!=typeof b.pos||"string"!=typeof b.attr)throw RangeError("Invalid input for AttrStep.fromJSON");return new t0(b.pos,b.attr,b.value)}}tz.jsonID("attr",t0);class t1 extends tz{constructor(a,b){super(),this.attr=a,this.value=b}apply(a){let b=Object.create(null);for(let c in a.attrs)b[c]=a.attrs[c];b[this.attr]=this.value;let c=a.type.create(b,a.content,a.marks);return tA.ok(c)}getMap(){return tw.empty}invert(a){return new t1(this.attr,a.attrs[this.attr])}map(a){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(a,b){if("string"!=typeof b.attr)throw RangeError("Invalid input for DocAttrStep.fromJSON");return new t1(b.attr,b.value)}}tz.jsonID("docAttr",t1);let t2=class extends Error{};(t2=function a(b){let c=Error.call(this,b);return c.__proto__=a.prototype,c}).prototype=Object.create(Error.prototype),t2.prototype.constructor=t2,t2.prototype.name="TransformError";class t3{constructor(a){this.doc=a,this.steps=[],this.docs=[],this.mapping=new tx}get before(){return this.docs.length?this.docs[0]:this.doc}step(a){let b=this.maybeStep(a);if(b.failed)throw new t2(b.failed);return this}maybeStep(a){let b=a.apply(this.doc);return b.failed||this.addStep(a,b.doc),b}get docChanged(){return this.steps.length>0}addStep(a,b){this.docs.push(this.doc),this.steps.push(a),this.mapping.appendMap(a.getMap()),this.doc=b}replace(a,b=a,c=sP.empty){let d=tU(this.doc,a,b,c);return d&&this.step(d),this}replaceWith(a,b,c){return this.replace(a,b,new sP(sJ.from(c),0,0))}delete(a,b){return this.replace(a,b,sP.empty)}insert(a,b){return this.replaceWith(a,a,b)}replaceRange(a,b,c){return!function(a,b,c,d){if(!d.size)return a.deleteRange(b,c);let e=a.doc.resolve(b),f=a.doc.resolve(c);if(tV(e,f,d))return a.step(new tG(b,c,d));let g=t_(e,f);0==g[g.length-1]&&g.pop();let h=-(e.depth+1);g.unshift(h);for(let a=e.depth,b=e.pos-1;a>0;a--,b--){let c=e.node(a).type.spec;if(c.defining||c.definingAsContext||c.isolating)break;g.indexOf(a)>-1?h=a:e.before(a)==b&&g.splice(1,0,-a)}let i=g.indexOf(h),j=[],k=d.openStart;for(let a=d.content,b=0;;b++){let c=a.firstChild;if(j.push(c),b==d.openStart)break;a=c.content}for(let a=k-1;a>=0;a--){var l;let b=j[a],c=(l=b.type).spec.defining||l.spec.definingForContent;if(c&&!b.sameMarkup(e.node(Math.abs(h)-1)))k=a;else if(c||!b.type.isTextblock)break}for(let b=d.openStart;b>=0;b--){let h=(b+k+1)%(d.openStart+1),l=j[h];if(l)for(let b=0;b<g.length;b++){let j=g[(b+i)%g.length],k=!0;j<0&&(k=!1,j=-j);let m=e.node(j-1),n=e.index(j-1);if(m.canReplaceWith(n,n,l.type,l.marks))return a.replace(e.before(j),k?f.after(j):c,new sP(function a(b,c,d,e,f){if(c<d){let f=b.firstChild;b=b.replaceChild(0,f.copy(a(f.content,c+1,d,e,f)))}if(c>e){let a=f.contentMatchAt(0),c=a.fillBefore(b).append(b);b=c.append(a.matchFragment(c).fillBefore(sJ.empty,!0))}return b}(d.content,0,d.openStart,h),h,d.openEnd))}}let m=a.steps.length;for(let h=g.length-1;h>=0&&(a.replace(b,c,d),!(a.steps.length>m));h--){let a=g[h];a<0||(b=e.before(a),c=f.after(a))}}(this,a,b,c),this}replaceRangeWith(a,b,c){var d=a,e=b;if(!c.isInline&&d==e&&this.doc.resolve(d).parent.content.size){let a=function(a,b,c){let d=a.resolve(b);if(d.parent.canReplaceWith(d.index(),d.index(),c))return b;if(0==d.parentOffset)for(let a=d.depth-1;a>=0;a--){let b=d.index(a);if(d.node(a).canReplaceWith(b,b,c))return d.before(a+1);if(b>0)return null}if(d.parentOffset==d.parent.content.size)for(let a=d.depth-1;a>=0;a--){let b=d.indexAfter(a);if(d.node(a).canReplaceWith(b,b,c))return d.after(a+1);if(b<d.node(a).childCount)break}return null}(this.doc,d,c.type);null!=a&&(d=e=a)}return this.replaceRange(d,e,new sP(sJ.from(c),0,0)),this}deleteRange(a,b){return!function(a,b,c){let d=a.doc.resolve(b),e=a.doc.resolve(c),f=t_(d,e);for(let b=0;b<f.length;b++){let c=f[b],g=b==f.length-1;if(g&&0==c||d.node(c).type.contentMatch.validEnd)return a.delete(d.start(c),e.end(c));if(c>0&&(g||d.node(c-1).canReplace(d.index(c-1),e.indexAfter(c-1))))return a.delete(d.before(c),e.after(c))}for(let f=1;f<=d.depth&&f<=e.depth;f++)if(b-d.start(f)==d.depth-f&&c>d.end(f)&&e.end(f)-c!=e.depth-f&&d.start(f-1)==e.start(f-1)&&d.node(f-1).canReplace(d.index(f-1),e.index(f-1)))return a.delete(d.before(f),c);a.delete(b,c)}(this,a,b),this}lift(a,b){return!function(a,b,c){let{$from:d,$to:e,depth:f}=b,g=d.before(f+1),h=e.after(f+1),i=g,j=h,k=sJ.empty,l=0;for(let a=f,b=!1;a>c;a--)b||d.index(a)>0?(b=!0,k=sJ.from(d.node(a).copy(k)),l++):i--;let m=sJ.empty,n=0;for(let a=f,b=!1;a>c;a--)b||e.after(a+1)<e.end(a)?(b=!0,m=sJ.from(e.node(a).copy(m)),n++):j++;a.step(new tH(i,j,g,h,new sP(k.append(m),l,n),k.size-l,!0))}(this,a,b),this}join(a,b=1){return!function(a,b,c){let d=null,{linebreakReplacement:e}=a.doc.type.schema,f=a.doc.resolve(b-c),g=f.node().type;if(e&&g.inlineContent){let a="pre"==g.whitespace,b=!!g.contentMatch.matchType(e);a&&!b?d=!1:!a&&b&&(d=!0)}let h=a.steps.length;if(!1===d){let d=a.doc.resolve(b+c);tO(a,d.node(),d.before(),h)}g.inlineContent&&tJ(a,b+c-1,g,f.node().contentMatchAt(f.index()),null==d);let i=a.mapping.slice(h),j=i.map(b-c);if(a.step(new tG(j,i.map(b+c,-1),sP.empty,!0)),!0===d){let b=a.doc.resolve(j);tN(a,b.node(),b.before(),a.steps.length)}}(this,a,b),this}wrap(a,b){return!function(a,b,c){let d=sJ.empty;for(let a=c.length-1;a>=0;a--){if(d.size){let b=c[a].type.contentMatch.matchFragment(d);if(!b||!b.validEnd)throw RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}d=sJ.from(c[a].type.create(c[a].attrs,d))}let e=b.start,f=b.end;a.step(new tH(e,f,e,f,new sP(d,0,0),c.length,!0))}(this,a,b),this}setBlockType(a,b=a,c,d=null){var e=this;if(!c.isTextblock)throw RangeError("Type given to setBlockType should be a textblock");let f=e.steps.length;return e.doc.nodesBetween(a,b,(a,b)=>{var g,h,i;let j,k,l="function"==typeof d?d(a):d;if(a.isTextblock&&!a.hasMarkup(c,l)&&(g=e.doc,h=e.mapping.slice(f).map(b),i=c,k=(j=g.resolve(h)).index(),j.parent.canReplaceWith(k,k+1,i))){let d=null;if(c.schema.linebreakReplacement){let a="pre"==c.whitespace,b=!!c.contentMatch.matchType(c.schema.linebreakReplacement);a&&!b?d=!1:!a&&b&&(d=!0)}!1===d&&tO(e,a,b,f),tJ(e,e.mapping.slice(f).map(b,1),c,void 0,null===d);let g=e.mapping.slice(f),h=g.map(b,1),i=g.map(b+a.nodeSize,1);return e.step(new tH(h,i,h+1,i-1,new sP(sJ.from(c.create(l,null,a.marks)),0,0),1,!0)),!0===d&&tN(e,a,b,f),!1}}),this}setNodeMarkup(a,b,c=null,d){return!function(a,b,c,d,e){let f=a.doc.nodeAt(b);if(!f)throw RangeError("No node at given position");c||(c=f.type);let g=c.create(d,null,e||f.marks);if(f.isLeaf)return a.replaceWith(b,b+f.nodeSize,g);if(!c.validContent(f.content))throw RangeError("Invalid content for node type "+c.name);a.step(new tH(b,b+f.nodeSize,b+1,b+f.nodeSize-1,new sP(sJ.from(g),0,0),1,!0))}(this,a,b,c,d),this}setNodeAttribute(a,b,c){return this.step(new t0(a,b,c)),this}setDocAttribute(a,b){return this.step(new t1(a,b)),this}addNodeMark(a,b){return this.step(new tE(a,b)),this}removeNodeMark(a,b){let c=this.doc.nodeAt(a);if(!c)throw RangeError("No node at position "+a);if(b instanceof sN)b.isInSet(c.marks)&&this.step(new tF(a,b));else{let d=c.marks,e,f=[];for(;e=b.isInSet(d);)f.push(new tF(a,e)),d=e.removeFromSet(d);for(let a=f.length-1;a>=0;a--)this.step(f[a])}return this}split(a,b=1,c){return!function(a,b,c=1,d){let e=a.doc.resolve(b),f=sJ.empty,g=sJ.empty;for(let a=e.depth,b=e.depth-c,h=c-1;a>b;a--,h--){f=sJ.from(e.node(a).copy(f));let b=d&&d[h];g=sJ.from(b?b.type.create(b.attrs,g):e.node(a).copy(g))}a.step(new tG(b,b,new sP(f.append(g),c,c),!0))}(this,a,b,c),this}addMark(a,b,c){var d;let e,f,g,h;return d=this,g=[],h=[],d.doc.nodesBetween(a,b,(d,i,j)=>{if(!d.isInline)return;let k=d.marks;if(!c.isInSet(k)&&j.type.allowsMarkType(c.type)){let j=Math.max(i,a),l=Math.min(i+d.nodeSize,b),m=c.addToSet(k);for(let a=0;a<k.length;a++)k[a].isInSet(m)||(e&&e.to==j&&e.mark.eq(k[a])?e.to=l:g.push(e=new tD(j,l,k[a])));f&&f.to==j?f.to=l:h.push(f=new tC(j,l,c))}}),g.forEach(a=>d.step(a)),h.forEach(a=>d.step(a)),this}removeMark(a,b,c){var d;let e,f;return d=this,e=[],f=0,d.doc.nodesBetween(a,b,(d,g)=>{if(!d.isInline)return;f++;let h=null;if(c instanceof te){let a=d.marks,b;for(;b=c.isInSet(a);)(h||(h=[])).push(b),a=b.removeFromSet(a)}else c?c.isInSet(d.marks)&&(h=[c]):h=d.marks;if(h&&h.length){let c=Math.min(g+d.nodeSize,b);for(let b=0;b<h.length;b++){let d=h[b],i;for(let a=0;a<e.length;a++){let b=e[a];b.step==f-1&&d.eq(e[a].style)&&(i=b)}i?(i.to=c,i.step=f):e.push({style:d,from:Math.max(g,a),to:c,step:f})}}}),e.forEach(a=>d.step(new tD(a.from,a.to,a.style))),this}clearIncompatible(a,b,c){return tJ(this,a,b,c),this}}let t4=Object.create(null);class t5{constructor(a,b,c){this.$anchor=a,this.$head=b,this.ranges=c||[new t6(a.min(b),a.max(b))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let a=this.ranges;for(let b=0;b<a.length;b++)if(a[b].$from.pos!=a[b].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(a,b=sP.empty){let c=b.content.lastChild,d=null;for(let a=0;a<b.openEnd;a++)d=c,c=c.lastChild;let e=a.steps.length,f=this.ranges;for(let g=0;g<f.length;g++){let{$from:h,$to:i}=f[g],j=a.mapping.slice(e);a.replaceRange(j.map(h.pos),j.map(i.pos),g?sP.empty:b),0==g&&ug(a,e,(c?c.isInline:d&&d.isTextblock)?-1:1)}}replaceWith(a,b){let c=a.steps.length,d=this.ranges;for(let e=0;e<d.length;e++){let{$from:f,$to:g}=d[e],h=a.mapping.slice(c),i=h.map(f.pos),j=h.map(g.pos);e?a.deleteRange(i,j):(a.replaceRangeWith(i,j,b),ug(a,c,b.isInline?-1:1))}}static findFrom(a,b,c=!1){let d=a.parent.inlineContent?new t9(a):uf(a.node(0),a.parent,a.pos,a.index(),b,c);if(d)return d;for(let d=a.depth-1;d>=0;d--){let e=b<0?uf(a.node(0),a.node(d),a.before(d+1),a.index(d),b,c):uf(a.node(0),a.node(d),a.after(d+1),a.index(d)+1,b,c);if(e)return e}return null}static near(a,b=1){return this.findFrom(a,b)||this.findFrom(a,-b)||new ud(a.node(0))}static atStart(a){return uf(a,a,0,0,1)||new ud(a)}static atEnd(a){return uf(a,a,a.content.size,a.childCount,-1)||new ud(a)}static fromJSON(a,b){if(!b||!b.type)throw RangeError("Invalid input for Selection.fromJSON");let c=t4[b.type];if(!c)throw RangeError(`No selection type ${b.type} defined`);return c.fromJSON(a,b)}static jsonID(a,b){if(a in t4)throw RangeError("Duplicate use of selection JSON ID "+a);return t4[a]=b,b.prototype.jsonID=a,b}getBookmark(){return t9.between(this.$anchor,this.$head).getBookmark()}}t5.prototype.visible=!0;class t6{constructor(a,b){this.$from=a,this.$to=b}}let t7=!1;function t8(a){t7||a.parent.inlineContent||(t7=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+a.parent.type.name+")"))}class t9 extends t5{constructor(a,b=a){t8(a),t8(b),super(a,b)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(a,b){let c=a.resolve(b.map(this.head));if(!c.parent.inlineContent)return t5.near(c);let d=a.resolve(b.map(this.anchor));return new t9(d.parent.inlineContent?d:c,c)}replace(a,b=sP.empty){if(super.replace(a,b),b==sP.empty){let b=this.$from.marksAcross(this.$to);b&&a.ensureMarks(b)}}eq(a){return a instanceof t9&&a.anchor==this.anchor&&a.head==this.head}getBookmark(){return new ua(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(a,b){if("number"!=typeof b.anchor||"number"!=typeof b.head)throw RangeError("Invalid input for TextSelection.fromJSON");return new t9(a.resolve(b.anchor),a.resolve(b.head))}static create(a,b,c=b){let d=a.resolve(b);return new this(d,c==b?d:a.resolve(c))}static between(a,b,c){let d=a.pos-b.pos;if((!c||d)&&(c=d>=0?1:-1),!b.parent.inlineContent){let a=t5.findFrom(b,c,!0)||t5.findFrom(b,-c,!0);if(!a)return t5.near(b,c);b=a.$head}return a.parent.inlineContent||(0==d?a=b:(a=(t5.findFrom(a,-c,!0)||t5.findFrom(a,c,!0)).$anchor).pos<b.pos!=d<0&&(a=b)),new t9(a,b)}}t5.jsonID("text",t9);class ua{constructor(a,b){this.anchor=a,this.head=b}map(a){return new ua(a.map(this.anchor),a.map(this.head))}resolve(a){return t9.between(a.resolve(this.anchor),a.resolve(this.head))}}class ub extends t5{constructor(a){let b=a.nodeAfter;super(a,a.node(0).resolve(a.pos+b.nodeSize)),this.node=b}map(a,b){let{deleted:c,pos:d}=b.mapResult(this.anchor),e=a.resolve(d);return c?t5.near(e):new ub(e)}content(){return new sP(sJ.from(this.node),0,0)}eq(a){return a instanceof ub&&a.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new uc(this.anchor)}static fromJSON(a,b){if("number"!=typeof b.anchor)throw RangeError("Invalid input for NodeSelection.fromJSON");return new ub(a.resolve(b.anchor))}static create(a,b){return new ub(a.resolve(b))}static isSelectable(a){return!a.isText&&!1!==a.type.spec.selectable}}ub.prototype.visible=!1,t5.jsonID("node",ub);class uc{constructor(a){this.anchor=a}map(a){let{deleted:b,pos:c}=a.mapResult(this.anchor);return b?new ua(c,c):new uc(c)}resolve(a){let b=a.resolve(this.anchor),c=b.nodeAfter;return c&&ub.isSelectable(c)?new ub(b):t5.near(b)}}class ud extends t5{constructor(a){super(a.resolve(0),a.resolve(a.content.size))}replace(a,b=sP.empty){if(b==sP.empty){a.delete(0,a.doc.content.size);let b=t5.atStart(a.doc);b.eq(a.selection)||a.setSelection(b)}else super.replace(a,b)}toJSON(){return{type:"all"}}static fromJSON(a){return new ud(a)}map(a){return new ud(a)}eq(a){return a instanceof ud}getBookmark(){return ue}}t5.jsonID("all",ud);let ue={map(){return this},resolve:a=>new ud(a)};function uf(a,b,c,d,e,f=!1){if(b.inlineContent)return t9.create(a,c);for(let g=d-(e>0?0:1);e>0?g<b.childCount:g>=0;g+=e){let d=b.child(g);if(d.isAtom){if(!f&&ub.isSelectable(d))return ub.create(a,c-(e<0?d.nodeSize:0))}else{let b=uf(a,d,c+e,e<0?d.childCount:0,e,f);if(b)return b}c+=d.nodeSize*e}return null}function ug(a,b,c){let d,e=a.steps.length-1;if(e<b)return;let f=a.steps[e];(f instanceof tG||f instanceof tH)&&(a.mapping.maps[e].forEach((a,b,c,e)=>{null==d&&(d=e)}),a.setSelection(t5.near(a.doc.resolve(d),c)))}class uh extends t3{constructor(a){super(a.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=a.selection,this.storedMarks=a.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(a){if(a.$from.doc!=this.doc)throw RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(1|this.updated)&-3,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(a){return this.storedMarks=a,this.updated|=2,this}ensureMarks(a){return sN.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this}addStoredMark(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(a,b){super.addStep(a,b),this.updated=-3&this.updated,this.storedMarks=null}setTime(a){return this.time=a,this}replaceSelection(a){return this.selection.replace(this,a),this}replaceSelectionWith(a,b=!0){let c=this.selection;return b&&(a=a.mark(this.storedMarks||(c.empty?c.$from.marks():c.$from.marksAcross(c.$to)||sN.none))),c.replaceWith(this,a),this}deleteSelection(){return this.selection.replace(this),this}insertText(a,b,c){let d=this.doc.type.schema;if(null==b)return a?this.replaceSelectionWith(d.text(a),!0):this.deleteSelection();{if(null==c&&(c=b),!a)return this.deleteRange(b,c);let e=this.storedMarks;if(!e){let a=this.doc.resolve(b);e=c==b?a.marks():a.marksAcross(this.doc.resolve(c))}return this.replaceRangeWith(b,c,d.text(a,e)),this.selection.empty||this.selection.to!=b+a.length||this.setSelection(t5.near(this.selection.$to)),this}}setMeta(a,b){return this.meta["string"==typeof a?a:a.key]=b,this}getMeta(a){return this.meta["string"==typeof a?a:a.key]}get isGeneric(){for(let a in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function ui(a,b){return b&&a?a.bind(b):a}class uj{constructor(a,b,c){this.name=a,this.init=ui(b.init,c),this.apply=ui(b.apply,c)}}let uk=[new uj("doc",{init:a=>a.doc||a.schema.topNodeType.createAndFill(),apply:a=>a.doc}),new uj("selection",{init:(a,b)=>a.selection||t5.atStart(b.doc),apply:a=>a.selection}),new uj("storedMarks",{init:a=>a.storedMarks||null,apply:(a,b,c,d)=>d.selection.$cursor?a.storedMarks:null}),new uj("scrollToSelection",{init:()=>0,apply:(a,b)=>a.scrolledIntoView?b+1:b})];class ul{constructor(a,b){this.schema=a,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=uk.slice(),b&&b.forEach(a=>{if(this.pluginsByKey[a.key])throw RangeError("Adding different instances of a keyed plugin ("+a.key+")");this.plugins.push(a),this.pluginsByKey[a.key]=a,a.spec.state&&this.fields.push(new uj(a.key,a.spec.state,a))})}}class um{constructor(a){this.config=a}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(a){return this.applyTransaction(a).state}filterTransaction(a,b=-1){for(let c=0;c<this.config.plugins.length;c++)if(c!=b){let b=this.config.plugins[c];if(b.spec.filterTransaction&&!b.spec.filterTransaction.call(b,a,this))return!1}return!0}applyTransaction(a){if(!this.filterTransaction(a))return{state:this,transactions:[]};let b=[a],c=this.applyInner(a),d=null;for(;;){let e=!1;for(let f=0;f<this.config.plugins.length;f++){let g=this.config.plugins[f];if(g.spec.appendTransaction){let h=d?d[f].n:0,i=d?d[f].state:this,j=h<b.length&&g.spec.appendTransaction.call(g,h?b.slice(h):b,i,c);if(j&&c.filterTransaction(j,f)){if(j.setMeta("appendedTransaction",a),!d){d=[];for(let a=0;a<this.config.plugins.length;a++)d.push(a<f?{state:c,n:b.length}:{state:this,n:0})}b.push(j),c=c.applyInner(j),e=!0}d&&(d[f]={state:c,n:b.length})}}if(!e)return{state:c,transactions:b}}}applyInner(a){if(!a.before.eq(this.doc))throw RangeError("Applying a mismatched transaction");let b=new um(this.config),c=this.config.fields;for(let d=0;d<c.length;d++){let e=c[d];b[e.name]=e.apply(a,this[e.name],this,b)}return b}get tr(){return new uh(this)}static create(a){let b=new ul(a.doc?a.doc.type.schema:a.schema,a.plugins),c=new um(b);for(let d=0;d<b.fields.length;d++)c[b.fields[d].name]=b.fields[d].init(a,c);return c}reconfigure(a){let b=new ul(this.schema,a.plugins),c=b.fields,d=new um(b);for(let b=0;b<c.length;b++){let e=c[b].name;d[e]=this.hasOwnProperty(e)?this[e]:c[b].init(a,d)}return d}toJSON(a){let b={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(b.storedMarks=this.storedMarks.map(a=>a.toJSON())),a&&"object"==typeof a)for(let c in a){if("doc"==c||"selection"==c)throw RangeError("The JSON fields `doc` and `selection` are reserved");let d=a[c],e=d.spec.state;e&&e.toJSON&&(b[c]=e.toJSON.call(d,this[d.key]))}return b}static fromJSON(a,b,c){if(!b)throw RangeError("Invalid input for EditorState.fromJSON");if(!a.schema)throw RangeError("Required config field 'schema' missing");let d=new ul(a.schema,a.plugins),e=new um(d);return d.fields.forEach(d=>{if("doc"==d.name)e.doc=s0.fromJSON(a.schema,b.doc);else if("selection"==d.name)e.selection=t5.fromJSON(e.doc,b.selection);else if("storedMarks"==d.name)b.storedMarks&&(e.storedMarks=b.storedMarks.map(a.schema.markFromJSON));else{if(c)for(let f in c){let g=c[f],h=g.spec.state;if(g.key==d.name&&h&&h.fromJSON&&Object.prototype.hasOwnProperty.call(b,f)){e[d.name]=h.fromJSON.call(g,a,b[f],e);return}}e[d.name]=d.init(a,e)}}),e}}class un{constructor(a){this.spec=a,this.props={},a.props&&function a(b,c,d){for(let e in b){let f=b[e];f instanceof Function?f=f.bind(c):"handleDOMEvents"==e&&(f=a(f,c,{})),d[e]=f}return d}(a.props,this,this.props),this.key=a.key?a.key.key:up("plugin")}getState(a){return a[this.key]}}let uo=Object.create(null);function up(a){return a in uo?a+"$"+ ++uo[a]:(uo[a]=0,a+"$")}class uq{constructor(a="key"){this.key=up(a)}get(a){return a.config.pluginsByKey[this.key]}getState(a){return a[this.key]}}let ur=function(a){for(var b=0;;b++)if(!(a=a.previousSibling))return b},us=function(a){let b=a.assignedSlot||a.parentNode;return b&&11==b.nodeType?b.host:b},ut=null,uu=function(a,b,c){let d=ut||(ut=document.createRange());return d.setEnd(a,null==c?a.nodeValue.length:c),d.setStart(a,b||0),d},uv=function(){ut=null},uw=function(a,b,c,d){return c&&(uy(a,b,c,d,-1)||uy(a,b,c,d,1))},ux=/^(img|br|input|textarea|hr)$/i;function uy(a,b,c,d,e){for(var f;;){if(a==c&&b==d)return!0;if(b==(e<0?0:uz(a))){let c=a.parentNode;if(!c||1!=c.nodeType||uA(a)||ux.test(a.nodeName)||"false"==a.contentEditable)return!1;b=ur(a)+(e<0?0:1),a=c}else{if(1!=a.nodeType)return!1;let c=a.childNodes[b+(e<0?-1:0)];if(1==c.nodeType&&"false"==c.contentEditable)if(null==(f=c.pmViewDesc)||!f.ignoreForSelection)return!1;else b+=e;else a=c,b=e<0?uz(a):0}}}function uz(a){return 3==a.nodeType?a.nodeValue.length:a.childNodes.length}function uA(a){let b;for(let c=a;c&&!(b=c.pmViewDesc);c=c.parentNode);return b&&b.node&&b.node.isBlock&&(b.dom==a||b.contentDOM==a)}let uB=function(a){return a.focusNode&&uw(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset)};function uC(a,b){let c=document.createEvent("Event");return c.initEvent("keydown",!0,!0),c.keyCode=a,c.key=c.code=b,c}let uD="undefined"!=typeof navigator?navigator:null,uE="undefined"!=typeof document?document:null,uF=uD&&uD.userAgent||"",uG=/Edge\/(\d+)/.exec(uF),uH=/MSIE \d/.exec(uF),uI=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(uF),uJ=!!(uH||uI||uG),uK=uH?document.documentMode:uI?+uI[1]:uG?+uG[1]:0,uL=!uJ&&/gecko\/(\d+)/i.test(uF);uL&&(/Firefox\/(\d+)/.exec(uF)||[0,0])[1];let uM=!uJ&&/Chrome\/(\d+)/.exec(uF),uN=!!uM,uO=uM?+uM[1]:0,uP=!uJ&&!!uD&&/Apple Computer/.test(uD.vendor),uQ=uP&&(/Mobile\/\w+/.test(uF)||!!uD&&uD.maxTouchPoints>2),uR=uQ||!!uD&&/Mac/.test(uD.platform),uS=!!uD&&/Win/.test(uD.platform),uT=/Android \d/.test(uF),uU=!!uE&&"webkitFontSmoothing"in uE.documentElement.style,uV=uU?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function uW(a,b){return"number"==typeof a?a:a[b]}function uX(a,b,c){let d=a.someProp("scrollThreshold")||0,e=a.someProp("scrollMargin")||5,f=a.dom.ownerDocument;for(let g=c||a.dom;g;){if(1!=g.nodeType){g=us(g);continue}let a=g,c=a==f.body,h=c?function(a){let b=a.defaultView&&a.defaultView.visualViewport;return b?{left:0,right:b.width,top:0,bottom:b.height}:{left:0,right:a.documentElement.clientWidth,top:0,bottom:a.documentElement.clientHeight}}(f):function(a){let b=a.getBoundingClientRect(),c=b.width/a.offsetWidth||1,d=b.height/a.offsetHeight||1;return{left:b.left,right:b.left+a.clientWidth*c,top:b.top,bottom:b.top+a.clientHeight*d}}(a),i=0,j=0;if(b.top<h.top+uW(d,"top")?j=-(h.top-b.top+uW(e,"top")):b.bottom>h.bottom-uW(d,"bottom")&&(j=b.bottom-b.top>h.bottom-h.top?b.top+uW(e,"top")-h.top:b.bottom-h.bottom+uW(e,"bottom")),b.left<h.left+uW(d,"left")?i=-(h.left-b.left+uW(e,"left")):b.right>h.right-uW(d,"right")&&(i=b.right-h.right+uW(e,"right")),i||j)if(c)f.defaultView.scrollBy(i,j);else{let c=a.scrollLeft,d=a.scrollTop;j&&(a.scrollTop+=j),i&&(a.scrollLeft+=i);let e=a.scrollLeft-c,f=a.scrollTop-d;b={left:b.left-e,top:b.top-f,right:b.right-e,bottom:b.bottom-f}}let k=c?"fixed":getComputedStyle(g).position;if(/^(fixed|sticky)$/.test(k))break;g="absolute"==k?g.offsetParent:us(g)}}function uY(a){let b=[],c=a.ownerDocument;for(let d=a;d&&(b.push({dom:d,top:d.scrollTop,left:d.scrollLeft}),a!=c);d=us(d));return b}function uZ(a,b){for(let c=0;c<a.length;c++){let{dom:d,top:e,left:f}=a[c];d.scrollTop!=e+b&&(d.scrollTop=e+b),d.scrollLeft!=f&&(d.scrollLeft=f)}}let u$=null;function u_(a,b){return a.left>=b.left-1&&a.left<=b.right+1&&a.top>=b.top-1&&a.top<=b.bottom+1}function u0(a){return a.top<a.bottom||a.left<a.right}function u1(a,b){let c=a.getClientRects();if(c.length){let a=c[b<0?0:c.length-1];if(u0(a))return a}return Array.prototype.find.call(c,u0)||a.getBoundingClientRect()}let u2=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function u3(a,b,c){let{node:d,offset:e,atom:f}=a.docView.domFromPos(b,c<0?-1:1),g=uU||uL;if(3==d.nodeType)if(g&&(u2.test(d.nodeValue)||(c<0?!e:e==d.nodeValue.length))){let a=u1(uu(d,e,e),c);if(uL&&e&&/\s/.test(d.nodeValue[e-1])&&e<d.nodeValue.length){let b=u1(uu(d,e-1,e-1),-1);if(b.top==a.top){let c=u1(uu(d,e,e+1),-1);if(c.top!=a.top)return u4(c,c.left<b.left)}}return a}else{let a=e,b=e,f=c<0?1:-1;return c<0&&!e?(b++,f=-1):c>=0&&e==d.nodeValue.length?(a--,f=1):c<0?a--:b++,u4(u1(uu(d,a,b),f),f<0)}if(!a.state.doc.resolve(b-(f||0)).parent.inlineContent){if(null==f&&e&&(c<0||e==uz(d))){let a=d.childNodes[e-1];if(1==a.nodeType)return u5(a.getBoundingClientRect(),!1)}if(null==f&&e<uz(d)){let a=d.childNodes[e];if(1==a.nodeType)return u5(a.getBoundingClientRect(),!0)}return u5(d.getBoundingClientRect(),c>=0)}if(null==f&&e&&(c<0||e==uz(d))){let a=d.childNodes[e-1],b=3==a.nodeType?uu(a,uz(a)-!g):1!=a.nodeType||"BR"==a.nodeName&&a.nextSibling?null:a;if(b)return u4(u1(b,1),!1)}if(null==f&&e<uz(d)){let a=d.childNodes[e];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let b=a?3==a.nodeType?uu(a,0,+!g):1==a.nodeType?a:null:null;if(b)return u4(u1(b,-1),!0)}return u4(u1(3==d.nodeType?uu(d):d,-c),c>=0)}function u4(a,b){if(0==a.width)return a;let c=b?a.left:a.right;return{top:a.top,bottom:a.bottom,left:c,right:c}}function u5(a,b){if(0==a.height)return a;let c=b?a.top:a.bottom;return{top:c,bottom:c,left:a.left,right:a.right}}function u6(a,b,c){let d=a.state,e=a.root.activeElement;d!=b&&a.updateState(b),e!=a.dom&&a.focus();try{return c()}finally{d!=b&&a.updateState(d),e!=a.dom&&e&&e.focus()}}let u7=/[\u0590-\u08ac]/,u8=null,u9=null,va=!1;class vb{constructor(a,b,c,d){this.parent=a,this.children=b,this.dom=c,this.contentDOM=d,this.dirty=0,c.pmViewDesc=this}matchesWidget(a){return!1}matchesMark(a){return!1}matchesNode(a,b,c){return!1}matchesHack(a){return!1}parseRule(){return null}stopEvent(a){return!1}get size(){let a=0;for(let b=0;b<this.children.length;b++)a+=this.children[b].size;return a}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let a=0;a<this.children.length;a++)this.children[a].destroy()}posBeforeChild(a){for(let b=0,c=this.posAtStart;;b++){let d=this.children[b];if(d==a)return c;c+=d.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(a,b,c){let d;if(this.contentDOM&&this.contentDOM.contains(1==a.nodeType?a:a.parentNode))if(c<0){let c,d;if(a==this.contentDOM)c=a.childNodes[b-1];else{for(;a.parentNode!=this.contentDOM;)a=a.parentNode;c=a.previousSibling}for(;c&&!((d=c.pmViewDesc)&&d.parent==this);)c=c.previousSibling;return c?this.posBeforeChild(d)+d.size:this.posAtStart}else{let c,d;if(a==this.contentDOM)c=a.childNodes[b];else{for(;a.parentNode!=this.contentDOM;)a=a.parentNode;c=a.nextSibling}for(;c&&!((d=c.pmViewDesc)&&d.parent==this);)c=c.nextSibling;return c?this.posBeforeChild(d):this.posAtEnd}if(a==this.dom&&this.contentDOM)d=b>ur(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))d=2&a.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==b)for(let b=a;;b=b.parentNode){if(b==this.dom){d=!1;break}if(b.previousSibling)break}if(null==d&&b==a.childNodes.length)for(let b=a;;b=b.parentNode){if(b==this.dom){d=!0;break}if(b.nextSibling)break}}return(null==d?c>0:d)?this.posAtEnd:this.posAtStart}nearestDesc(a,b=!1){for(let c=!0,d=a;d;d=d.parentNode){let e=this.getDesc(d),f;if(e&&(!b||e.node))if(!c||!(f=e.nodeDOM)||(1==f.nodeType?f.contains(1==a.nodeType?a:a.parentNode):f==a))return e;else c=!1}}getDesc(a){let b=a.pmViewDesc;for(let a=b;a;a=a.parent)if(a==this)return b}posFromDOM(a,b,c){for(let d=a;d;d=d.parentNode){let e=this.getDesc(d);if(e)return e.localPosFromDOM(a,b,c)}return -1}descAt(a){for(let b=0,c=0;b<this.children.length;b++){let d=this.children[b],e=c+d.size;if(c==a&&e!=c){for(;!d.border&&d.children.length;)for(let a=0;a<d.children.length;a++){let b=d.children[a];if(b.size){d=b;break}}return d}if(a<e)return d.descAt(a-c-d.border);c=e}}domFromPos(a,b){if(!this.contentDOM)return{node:this.dom,offset:0,atom:a+1};let c=0,d=0;for(let b=0;c<this.children.length;c++){let e=this.children[c],f=b+e.size;if(f>a||e instanceof vi){d=a-b;break}b=f}if(d)return this.children[c].domFromPos(d-this.children[c].border,b);for(let a;c&&!(a=this.children[c-1]).size&&a instanceof vc&&a.side>=0;c--);if(b<=0){let a,d=!0;for(;(a=c?this.children[c-1]:null)&&a.dom.parentNode!=this.contentDOM;c--,d=!1);return a&&b&&d&&!a.border&&!a.domAtom?a.domFromPos(a.size,b):{node:this.contentDOM,offset:a?ur(a.dom)+1:0}}{let a,d=!0;for(;(a=c<this.children.length?this.children[c]:null)&&a.dom.parentNode!=this.contentDOM;c++,d=!1);return a&&d&&!a.border&&!a.domAtom?a.domFromPos(0,b):{node:this.contentDOM,offset:a?ur(a.dom):this.contentDOM.childNodes.length}}}parseRange(a,b,c=0){if(0==this.children.length)return{node:this.contentDOM,from:a,to:b,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let d=-1,e=-1;for(let f=c,g=0;;g++){let c=this.children[g],h=f+c.size;if(-1==d&&a<=h){let e=f+c.border;if(a>=e&&b<=h-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(a,b,e);a=f;for(let b=g;b>0;b--){let c=this.children[b-1];if(c.size&&c.dom.parentNode==this.contentDOM&&!c.emptyChildAt(1)){d=ur(c.dom)+1;break}a-=c.size}-1==d&&(d=0)}if(d>-1&&(h>b||g==this.children.length-1)){b=h;for(let a=g+1;a<this.children.length;a++){let c=this.children[a];if(c.size&&c.dom.parentNode==this.contentDOM&&!c.emptyChildAt(-1)){e=ur(c.dom);break}b+=c.size}-1==e&&(e=this.contentDOM.childNodes.length);break}f=h}return{node:this.contentDOM,from:a,to:b,fromOffset:d,toOffset:e}}emptyChildAt(a){if(this.border||!this.contentDOM||!this.children.length)return!1;let b=this.children[a<0?0:this.children.length-1];return 0==b.size||b.emptyChildAt(a)}domAfterPos(a){let{node:b,offset:c}=this.domFromPos(a,0);if(1!=b.nodeType||c==b.childNodes.length)throw RangeError("No node after pos "+a);return b.childNodes[c]}setSelection(a,b,c,d=!1){let e=Math.min(a,b),f=Math.max(a,b);for(let g=0,h=0;g<this.children.length;g++){let i=this.children[g],j=h+i.size;if(e>h&&f<j)return i.setSelection(a-h-i.border,b-h-i.border,c,d);h=j}let g=this.domFromPos(a,a?-1:1),h=b==a?g:this.domFromPos(b,b?-1:1),i=c.root.getSelection(),j=c.domSelectionRange(),k=!1;if((uL||uP)&&a==b){let{node:a,offset:b}=g;if(3==a.nodeType){if((k=!!(b&&"\n"==a.nodeValue[b-1]))&&b==a.nodeValue.length)for(let b=a,c;b;b=b.parentNode){if(c=b.nextSibling){"BR"==c.nodeName&&(g=h={node:c.parentNode,offset:ur(c)+1});break}let a=b.pmViewDesc;if(a&&a.node&&a.node.isBlock)break}}else{let c=a.childNodes[b-1];k=c&&("BR"==c.nodeName||"false"==c.contentEditable)}}if(uL&&j.focusNode&&j.focusNode!=h.node&&1==j.focusNode.nodeType){let a=j.focusNode.childNodes[j.focusOffset];a&&"false"==a.contentEditable&&(d=!0)}if(!(d||k&&uP)&&uw(g.node,g.offset,j.anchorNode,j.anchorOffset)&&uw(h.node,h.offset,j.focusNode,j.focusOffset))return;let l=!1;if((i.extend||a==b)&&!(k&&uL)){i.collapse(g.node,g.offset);try{a!=b&&i.extend(h.node,h.offset),l=!0}catch(a){}}if(!l){if(a>b){let a=g;g=h,h=a}let c=document.createRange();c.setEnd(h.node,h.offset),c.setStart(g.node,g.offset),i.removeAllRanges(),i.addRange(c)}}ignoreMutation(a){return!this.contentDOM&&"selection"!=a.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(a,b){for(let c=0,d=0;d<this.children.length;d++){let e=this.children[d],f=c+e.size;if(c==f?a<=f&&b>=c:a<f&&b>c){let d=c+e.border,g=f-e.border;if(a>=d&&b<=g){this.dirty=a==c||b==f?2:1,a==d&&b==g&&(e.contentLost||e.dom.parentNode!=this.contentDOM)?e.dirty=3:e.markDirty(a-d,b-d);return}e.dirty=e.dom!=e.contentDOM||e.dom.parentNode!=this.contentDOM||e.children.length?3:2}c=f}this.dirty=2}markParentsDirty(){let a=1;for(let b=this.parent;b;b=b.parent,a++){let c=1==a?2:1;b.dirty<c&&(b.dirty=c)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(a){return!1}}class vc extends vb{constructor(a,b,c,d){let e,f=b.type.toDOM;if("function"==typeof f&&(f=f(c,()=>e?e.parent?e.parent.posBeforeChild(e):void 0:d)),!b.type.spec.raw){if(1!=f.nodeType){let a=document.createElement("span");a.appendChild(f),f=a}f.contentEditable="false",f.classList.add("ProseMirror-widget")}super(a,[],f,null),this.widget=b,this.widget=b,e=this}matchesWidget(a){return 0==this.dirty&&a.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(a){let b=this.widget.spec.stopEvent;return!!b&&b(a)}ignoreMutation(a){return"selection"!=a.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class vd extends vb{constructor(a,b,c,d){super(a,[],b,null),this.textDOM=c,this.text=d}get size(){return this.text.length}localPosFromDOM(a,b){return a!=this.textDOM?this.posAtStart+(b?this.size:0):this.posAtStart+b}domFromPos(a){return{node:this.textDOM,offset:a}}ignoreMutation(a){return"characterData"===a.type&&a.target.nodeValue==a.oldValue}}class ve extends vb{constructor(a,b,c,d,e){super(a,[],c,d),this.mark=b,this.spec=e}static create(a,b,c,d){let e=d.nodeViews[b.type.name],f=e&&e(b,d,c);return f&&f.dom||(f=tq.renderSpec(document,b.type.spec.toDOM(b,c),null,b.attrs)),new ve(a,b,f.dom,f.contentDOM||f.dom,f)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(a){return 3!=this.dirty&&this.mark.eq(a)}markDirty(a,b){if(super.markDirty(a,b),0!=this.dirty){let a=this.parent;for(;!a.node;)a=a.parent;a.dirty<this.dirty&&(a.dirty=this.dirty),this.dirty=0}}slice(a,b,c){let d=ve.create(this.parent,this.mark,!0,c),e=this.children,f=this.size;b<f&&(e=vt(e,b,f,c)),a>0&&(e=vt(e,0,a,c));for(let a=0;a<e.length;a++)e[a].parent=d;return d.children=e,d}ignoreMutation(a){return this.spec.ignoreMutation?this.spec.ignoreMutation(a):super.ignoreMutation(a)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class vf extends vb{constructor(a,b,c,d,e,f,g,h,i){super(a,[],e,f),this.node=b,this.outerDeco=c,this.innerDeco=d,this.nodeDOM=g}static create(a,b,c,d,e,f){let g=e.nodeViews[b.type.name],h,i=g&&g(b,e,()=>h?h.parent?h.parent.posBeforeChild(h):void 0:f,c,d),j=i&&i.dom,k=i&&i.contentDOM;if(b.isText)if(j){if(3!=j.nodeType)throw RangeError("Text must be rendered as a DOM text node")}else j=document.createTextNode(b.text);else if(!j){let a=tq.renderSpec(document,b.type.spec.toDOM(b),null,b.attrs);({dom:j,contentDOM:k}=a)}k||b.isText||"BR"==j.nodeName||(j.hasAttribute("contenteditable")||(j.contentEditable="false"),b.type.spec.draggable&&(j.draggable=!0));let l=j;return(j=vo(j,c,b),i)?h=new vj(a,b,c,d,j,k||null,l,i,e,f+1):b.isText?new vh(a,b,c,d,j,l,e):new vf(a,b,c,d,j,k||null,l,e,f+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let a={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(a.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let b=this.children.length-1;b>=0;b--){let c=this.children[b];if(this.dom.contains(c.dom.parentNode)){a.contentElement=c.dom.parentNode;break}}a.contentElement||(a.getContent=()=>sJ.empty)}else a.contentElement=this.contentDOM;else a.getContent=()=>this.node.content;return a}matchesNode(a,b,c){return 0==this.dirty&&a.eq(this.node)&&vp(b,this.outerDeco)&&c.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return+!this.node.isLeaf}updateChildren(a,b){let c=this.node.inlineContent,d=b,e=a.composing?this.localCompositionInfo(a,b):null,f=e&&e.pos>-1?e:null,g=e&&e.pos<0,h=new vr(this,f&&f.node,a);(function(a,b,c,d){let e=b.locals(a),f=0;if(0==e.length){for(let c=0;c<a.childCount;c++){let g=a.child(c);d(g,e,b.forChild(f,g),c),f+=g.nodeSize}return}let g=0,h=[],i=null;for(let j=0;;){let k,l,m,n;for(;g<e.length&&e[g].to==f;){let a=e[g++];a.widget&&(k?(l||(l=[k])).push(a):k=a)}if(k)if(l){l.sort(vs);for(let a=0;a<l.length;a++)c(l[a],j,!!i)}else c(k,j,!!i);if(i)n=-1,m=i,i=null;else if(j<a.childCount)n=j,m=a.child(j++);else break;for(let a=0;a<h.length;a++)h[a].to<=f&&h.splice(a--,1);for(;g<e.length&&e[g].from<=f&&e[g].to>f;)h.push(e[g++]);let o=f+m.nodeSize;if(m.isText){let a=o;g<e.length&&e[g].from<a&&(a=e[g].from);for(let b=0;b<h.length;b++)h[b].to<a&&(a=h[b].to);a<o&&(i=m.cut(a-f),m=m.cut(0,a-f),o=a,n=-1)}else for(;g<e.length&&e[g].to<o;)g++;let p=m.isInline&&!m.isLeaf?h.filter(a=>!a.inline):h.slice();d(m,p,b.forChild(f,m),n),f=o}})(this.node,this.innerDeco,(b,e,f)=>{b.spec.marks?h.syncToMarks(b.spec.marks,c,a):b.type.side>=0&&!f&&h.syncToMarks(e==this.node.childCount?sN.none:this.node.child(e).marks,c,a),h.placeWidget(b,a,d)},(b,f,i,j)=>{let k;h.syncToMarks(b.marks,c,a),h.findNodeMatch(b,f,i,j)||g&&a.state.selection.from>d&&a.state.selection.to<d+b.nodeSize&&(k=h.findIndexWithChild(e.node))>-1&&h.updateNodeAt(b,f,i,k,a)||h.updateNextNode(b,f,i,a,j,d)||h.addNode(b,f,i,a,d),d+=b.nodeSize}),h.syncToMarks([],c,a),this.node.isTextblock&&h.addTextblockHacks(),h.destroyRest(),(h.changed||2==this.dirty)&&(f&&this.protectLocalComposition(a,f),function a(b,c,d){let e=b.firstChild,f=!1;for(let g=0;g<c.length;g++){let h=c[g],i=h.dom;if(i.parentNode==b){for(;i!=e;)e=vq(e),f=!0;e=e.nextSibling}else f=!0,b.insertBefore(i,e);if(h instanceof ve){let c=e?e.previousSibling:b.lastChild;a(h.contentDOM,h.children,d),e=c?c.nextSibling:b.firstChild}}for(;e;)e=vq(e),f=!0;f&&d.trackWrites==b&&(d.trackWrites=null)}(this.contentDOM,this.children,a),uQ&&function(a){if("UL"==a.nodeName||"OL"==a.nodeName){let b=a.style.cssText;a.style.cssText=b+"; list-style: square !important",window.getComputedStyle(a).listStyle,a.style.cssText=b}}(this.dom))}localCompositionInfo(a,b){let{from:c,to:d}=a.state.selection;if(!(a.state.selection instanceof t9)||c<b||d>b+this.node.content.size)return null;let e=a.input.compositionNode;if(!e||!this.dom.contains(e.parentNode))return null;if(!this.node.inlineContent)return{node:e,pos:-1,text:""};{let a=e.nodeValue,f=function(a,b,c,d){for(let e=0,f=0;e<a.childCount&&f<=d;){let g=a.child(e++),h=f;if(f+=g.nodeSize,!g.isText)continue;let i=g.text;for(;e<a.childCount;){let b=a.child(e++);if(f+=b.nodeSize,!b.isText)break;i+=b.text}if(f>=c){if(f>=d&&i.slice(d-b.length-h,d-h)==b)return d-b.length;let a=h<d?i.lastIndexOf(b,d-h-1):-1;if(a>=0&&a+b.length+h>=c)return h+a;if(c==d&&i.length>=d+b.length-h&&i.slice(d-h,d-h+b.length)==b)return d}}return -1}(this.node.content,a,c-b,d-b);return f<0?null:{node:e,pos:f,text:a}}}protectLocalComposition(a,{node:b,pos:c,text:d}){if(this.getDesc(b))return;let e=b;for(;e.parentNode!=this.contentDOM;e=e.parentNode){for(;e.previousSibling;)e.parentNode.removeChild(e.previousSibling);for(;e.nextSibling;)e.parentNode.removeChild(e.nextSibling);e.pmViewDesc&&(e.pmViewDesc=void 0)}let f=new vd(this,e,b,d);a.input.compositionNodes.push(f),this.children=vt(this.children,c,c+d.length,a,f)}update(a,b,c,d){return 3!=this.dirty&&!!a.sameMarkup(this.node)&&(this.updateInner(a,b,c,d),!0)}updateInner(a,b,c,d){this.updateOuterDeco(b),this.node=a,this.innerDeco=c,this.contentDOM&&this.updateChildren(d,this.posAtStart),this.dirty=0}updateOuterDeco(a){if(vp(a,this.outerDeco))return;let b=1!=this.nodeDOM.nodeType,c=this.dom;this.dom=vn(this.dom,this.nodeDOM,vm(this.outerDeco,this.node,b),vm(a,this.node,b)),this.dom!=c&&(c.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=a}selectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function vg(a,b,c,d,e){vo(d,b,a);let f=new vf(void 0,a,b,c,d,d,d,e,0);return f.contentDOM&&f.updateChildren(e,0),f}class vh extends vf{constructor(a,b,c,d,e,f,g){super(a,b,c,d,e,null,f,g,0)}parseRule(){let a=this.nodeDOM.parentNode;for(;a&&a!=this.dom&&!a.pmIsDeco;)a=a.parentNode;return{skip:a||!0}}update(a,b,c,d){return 3!=this.dirty&&(0==this.dirty||!!this.inParent())&&!!a.sameMarkup(this.node)&&(this.updateOuterDeco(b),(0!=this.dirty||a.text!=this.node.text)&&a.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=a.text,d.trackWrites==this.nodeDOM&&(d.trackWrites=null)),this.node=a,this.dirty=0,!0)}inParent(){let a=this.parent.contentDOM;for(let b=this.nodeDOM;b;b=b.parentNode)if(b==a)return!0;return!1}domFromPos(a){return{node:this.nodeDOM,offset:a}}localPosFromDOM(a,b,c){return a==this.nodeDOM?this.posAtStart+Math.min(b,this.node.text.length):super.localPosFromDOM(a,b,c)}ignoreMutation(a){return"characterData"!=a.type&&"selection"!=a.type}slice(a,b,c){let d=this.node.cut(a,b),e=document.createTextNode(d.text);return new vh(this.parent,d,this.outerDeco,this.innerDeco,e,e,c)}markDirty(a,b){super.markDirty(a,b),this.dom!=this.nodeDOM&&(0==a||b==this.nodeDOM.nodeValue.length)&&(this.dirty=3)}get domAtom(){return!1}isText(a){return this.node.text==a}}class vi extends vb{parseRule(){return{ignore:!0}}matchesHack(a){return 0==this.dirty&&this.dom.nodeName==a}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class vj extends vf{constructor(a,b,c,d,e,f,g,h,i,j){super(a,b,c,d,e,f,g,i,j),this.spec=h}update(a,b,c,d){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==a.type||this.spec.multiType)){let e=this.spec.update(a,b,c);return e&&this.updateInner(a,b,c,d),e}return(!!this.contentDOM||!!a.isLeaf)&&super.update(a,b,c,d)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(a,b,c,d){this.spec.setSelection?this.spec.setSelection(a,b,c.root):super.setSelection(a,b,c,d)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(a){return!!this.spec.stopEvent&&this.spec.stopEvent(a)}ignoreMutation(a){return this.spec.ignoreMutation?this.spec.ignoreMutation(a):super.ignoreMutation(a)}}let vk=function(a){a&&(this.nodeName=a)};vk.prototype=Object.create(null);let vl=[new vk];function vm(a,b,c){if(0==a.length)return vl;let d=c?vl[0]:new vk,e=[d];for(let f=0;f<a.length;f++){let g=a[f].type.attrs;if(g)for(let a in g.nodeName&&e.push(d=new vk(g.nodeName)),g){let f=g[a];null!=f&&(c&&1==e.length&&e.push(d=new vk(b.isInline?"span":"div")),"class"==a?d.class=(d.class?d.class+" ":"")+f:"style"==a?d.style=(d.style?d.style+";":"")+f:"nodeName"!=a&&(d[a]=f))}}return e}function vn(a,b,c,d){if(c==vl&&d==vl)return b;let e=b;for(let b=0;b<d.length;b++){let f=d[b],g=c[b];if(b){let b;g&&g.nodeName==f.nodeName&&e!=a&&(b=e.parentNode)&&b.nodeName.toLowerCase()==f.nodeName||((b=document.createElement(f.nodeName)).pmIsDeco=!0,b.appendChild(e),g=vl[0]),e=b}!function(a,b,c){for(let d in b)"class"==d||"style"==d||"nodeName"==d||d in c||a.removeAttribute(d);for(let d in c)"class"!=d&&"style"!=d&&"nodeName"!=d&&c[d]!=b[d]&&a.setAttribute(d,c[d]);if(b.class!=c.class){let d=b.class?b.class.split(" ").filter(Boolean):[],e=c.class?c.class.split(" ").filter(Boolean):[];for(let b=0;b<d.length;b++)-1==e.indexOf(d[b])&&a.classList.remove(d[b]);for(let b=0;b<e.length;b++)-1==d.indexOf(e[b])&&a.classList.add(e[b]);0==a.classList.length&&a.removeAttribute("class")}if(b.style!=c.style){if(b.style){let c=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,d;for(;d=c.exec(b.style);)a.style.removeProperty(d[1])}c.style&&(a.style.cssText+=c.style)}}(e,g||vl[0],f)}return e}function vo(a,b,c){return vn(a,a,vl,vm(b,c,1!=a.nodeType))}function vp(a,b){if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!a[c].type.eq(b[c].type))return!1;return!0}function vq(a){let b=a.nextSibling;return a.parentNode.removeChild(a),b}class vr{constructor(a,b,c){this.lock=b,this.view=c,this.index=0,this.stack=[],this.changed=!1,this.top=a,this.preMatch=function(a,b){let c=b,d=c.children.length,e=a.childCount,f=new Map,g=[];a:for(;e>0;){let h;for(;;)if(d){let a=c.children[d-1];if(a instanceof ve)c=a,d=a.children.length;else{h=a,d--;break}}else if(c==b)break a;else d=c.parent.children.indexOf(c),c=c.parent;let i=h.node;if(i){if(i!=a.child(e-1))break;--e,f.set(h,e),g.push(h)}}return{index:e,matched:f,matches:g.reverse()}}(a.node.content,a)}destroyBetween(a,b){if(a!=b){for(let c=a;c<b;c++)this.top.children[c].destroy();this.top.children.splice(a,b-a),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(a,b,c){let d=0,e=this.stack.length>>1,f=Math.min(e,a.length);for(;d<f&&(d==e-1?this.top:this.stack[d+1<<1]).matchesMark(a[d])&&!1!==a[d].type.spec.spanning;)d++;for(;d<e;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),e--;for(;e<a.length;){this.stack.push(this.top,this.index+1);let d=-1;for(let b=this.index;b<Math.min(this.index+3,this.top.children.length);b++){let c=this.top.children[b];if(c.matchesMark(a[e])&&!this.isLocked(c.dom)){d=b;break}}if(d>-1)d>this.index&&(this.changed=!0,this.destroyBetween(this.index,d)),this.top=this.top.children[this.index];else{let d=ve.create(this.top,a[e],b,c);this.top.children.splice(this.index,0,d),this.top=d,this.changed=!0}this.index=0,e++}}findNodeMatch(a,b,c,d){let e=-1,f;if(d>=this.preMatch.index&&(f=this.preMatch.matches[d-this.preMatch.index]).parent==this.top&&f.matchesNode(a,b,c))e=this.top.children.indexOf(f,this.index);else for(let d=this.index,f=Math.min(this.top.children.length,d+5);d<f;d++){let f=this.top.children[d];if(f.matchesNode(a,b,c)&&!this.preMatch.matched.has(f)){e=d;break}}return!(e<0)&&(this.destroyBetween(this.index,e),this.index++,!0)}updateNodeAt(a,b,c,d,e){let f=this.top.children[d];return 3==f.dirty&&f.dom==f.contentDOM&&(f.dirty=2),!!f.update(a,b,c,e)&&(this.destroyBetween(this.index,d),this.index++,!0)}findIndexWithChild(a){for(;;){let b=a.parentNode;if(!b)return -1;if(b==this.top.contentDOM){let b=a.pmViewDesc;if(b){for(let a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==b)return a}return -1}a=b}}updateNextNode(a,b,c,d,e,f){for(let g=this.index;g<this.top.children.length;g++){let h=this.top.children[g];if(h instanceof vf){let i=this.preMatch.matched.get(h);if(null!=i&&i!=e)return!1;let j=h.dom,k,l=this.isLocked(j)&&!(a.isText&&h.node&&h.node.isText&&h.nodeDOM.nodeValue==a.text&&3!=h.dirty&&vp(b,h.outerDeco));if(!l&&h.update(a,b,c,d))return this.destroyBetween(this.index,g),h.dom!=j&&(this.changed=!0),this.index++,!0;if(!l&&(k=this.recreateWrapper(h,a,b,c,d,f)))return this.destroyBetween(this.index,g),this.top.children[this.index]=k,k.contentDOM&&(k.dirty=2,k.updateChildren(d,f+1),k.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(a,b,c,d,e,f){if(a.dirty||b.isAtom||!a.children.length||!a.node.content.eq(b.content)||!vp(c,a.outerDeco)||!d.eq(a.innerDeco))return null;let g=vf.create(this.top,b,c,d,e,f);if(g.contentDOM)for(let b of(g.children=a.children,a.children=[],g.children))b.parent=g;return a.destroy(),g}addNode(a,b,c,d,e){let f=vf.create(this.top,a,b,c,d,e);f.contentDOM&&f.updateChildren(d,e+1),this.top.children.splice(this.index++,0,f),this.changed=!0}placeWidget(a,b,c){let d=this.index<this.top.children.length?this.top.children[this.index]:null;if(d&&d.matchesWidget(a)&&(a==d.widget||!d.widget.type.toDOM.parentNode))this.index++;else{let d=new vc(this.top,a,b,c);this.top.children.splice(this.index++,0,d),this.changed=!0}}addTextblockHacks(){let a=this.top.children[this.index-1],b=this.top;for(;a instanceof ve;)a=(b=a).children[b.children.length-1];(!a||!(a instanceof vh)||/\n$/.test(a.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(a.node.text))&&((uP||uN)&&a&&"false"==a.dom.contentEditable&&this.addHackNode("IMG",b),this.addHackNode("BR",this.top))}addHackNode(a,b){if(b==this.top&&this.index<b.children.length&&b.children[this.index].matchesHack(a))this.index++;else{let c=document.createElement(a);"IMG"==a&&(c.className="ProseMirror-separator",c.alt=""),"BR"==a&&(c.className="ProseMirror-trailingBreak");let d=new vi(this.top,[],c,null);b!=this.top?b.children.push(d):b.children.splice(this.index++,0,d),this.changed=!0}}isLocked(a){return this.lock&&(a==this.lock||1==a.nodeType&&a.contains(this.lock.parentNode))}}function vs(a,b){return a.type.side-b.type.side}function vt(a,b,c,d,e){let f=[];for(let g=0,h=0;g<a.length;g++){let i=a[g],j=h,k=h+=i.size;j>=c||k<=b?f.push(i):(j<b&&f.push(i.slice(0,b-j,d)),e&&(f.push(e),e=void 0),k>c&&f.push(i.slice(c-j,i.size,d)))}return f}function vu(a,b=null){let c=a.domSelectionRange(),d=a.state.doc;if(!c.focusNode)return null;let e=a.docView.nearestDesc(c.focusNode),f=e&&0==e.size,g=a.docView.posFromDOM(c.focusNode,c.focusOffset,1);if(g<0)return null;let h=d.resolve(g),i,j;if(uB(c)){for(i=g;e&&!e.node;)e=e.parent;let a=e.node;if(e&&a.isAtom&&ub.isSelectable(a)&&e.parent&&!(a.isInline&&function(a,b,c){for(let d=0==b,e=b==uz(a);d||e;){if(a==c)return!0;let b=ur(a);if(!(a=a.parentNode))return!1;d=d&&0==b,e=e&&b==uz(a)}}(c.focusNode,c.focusOffset,e.dom))){let a=e.posBefore;j=new ub(g==a?h:d.resolve(a))}}else{if(c instanceof a.dom.ownerDocument.defaultView.Selection&&c.rangeCount>1){let b=g,e=g;for(let d=0;d<c.rangeCount;d++){let f=c.getRangeAt(d);b=Math.min(b,a.docView.posFromDOM(f.startContainer,f.startOffset,1)),e=Math.max(e,a.docView.posFromDOM(f.endContainer,f.endOffset,-1))}if(b<0)return null;[i,g]=e==a.state.selection.anchor?[e,b]:[b,e],h=d.resolve(g)}else i=a.docView.posFromDOM(c.anchorNode,c.anchorOffset,1);if(i<0)return null}let k=d.resolve(i);if(!j){let c="pointer"==b||a.state.selection.head<h.pos&&!f?1:-1;j=vD(a,k,h,c)}return j}function vv(a){return a.editable?a.hasFocus():vF(a)&&document.activeElement&&document.activeElement.contains(a.dom)}function vw(a,b=!1){let c=a.state.selection;if(vB(a,c),vv(a)){if(!b&&a.input.mouseDown&&a.input.mouseDown.allowDefault&&uN){let b=a.domSelectionRange(),c=a.domObserver.currentSelection;if(b.anchorNode&&c.anchorNode&&uw(b.anchorNode,b.anchorOffset,c.anchorNode,c.anchorOffset)){a.input.mouseDown.delayedSelectionSync=!0,a.domObserver.setCurSelection();return}}if(a.domObserver.disconnectSelection(),a.cursorWrapper)!function(a){let b=a.domSelection();if(!b)return;let c=a.cursorWrapper.dom,d="IMG"==c.nodeName;d?b.collapse(c.parentNode,ur(c)+1):b.collapse(c,0),!d&&!a.state.selection.visible&&uJ&&uK<=11&&(c.disabled=!0,c.disabled=!1)}(a);else{var d;let e,f,g,h,{anchor:i,head:j}=c,k,l;vx&&!(c instanceof t9)&&(c.$from.parent.inlineContent||(k=vy(a,c.from)),c.empty||c.$from.parent.inlineContent||(l=vy(a,c.to))),a.docView.setSelection(i,j,a,b),vx&&(k&&vA(k),l&&vA(l)),c.visible?a.dom.classList.remove("ProseMirror-hideselection"):(a.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&((e=(d=a).dom.ownerDocument).removeEventListener("selectionchange",d.input.hideSelectionGuard),g=(f=d.domSelectionRange()).anchorNode,h=f.anchorOffset,e.addEventListener("selectionchange",d.input.hideSelectionGuard=()=>{(f.anchorNode!=g||f.anchorOffset!=h)&&(e.removeEventListener("selectionchange",d.input.hideSelectionGuard),setTimeout(()=>{(!vv(d)||d.state.selection.visible)&&d.dom.classList.remove("ProseMirror-hideselection")},20))})))}a.domObserver.setCurSelection(),a.domObserver.connectSelection()}}let vx=uP||uN&&uO<63;function vy(a,b){let{node:c,offset:d}=a.docView.domFromPos(b,0),e=d<c.childNodes.length?c.childNodes[d]:null,f=d?c.childNodes[d-1]:null;if(uP&&e&&"false"==e.contentEditable)return vz(e);if((!e||"false"==e.contentEditable)&&(!f||"false"==f.contentEditable)){if(e)return vz(e);else if(f)return vz(f)}}function vz(a){return a.contentEditable="true",uP&&a.draggable&&(a.draggable=!1,a.wasDraggable=!0),a}function vA(a){a.contentEditable="false",a.wasDraggable&&(a.draggable=!0,a.wasDraggable=null)}function vB(a,b){if(b instanceof ub){let c=a.docView.descAt(b.from);c!=a.lastSelectedViewDesc&&(vC(a),c&&c.selectNode(),a.lastSelectedViewDesc=c)}else vC(a)}function vC(a){a.lastSelectedViewDesc&&(a.lastSelectedViewDesc.parent&&a.lastSelectedViewDesc.deselectNode(),a.lastSelectedViewDesc=void 0)}function vD(a,b,c,d){return a.someProp("createSelectionBetween",d=>d(a,b,c))||t9.between(b,c,d)}function vE(a){return(!a.editable||!!a.hasFocus())&&vF(a)}function vF(a){let b=a.domSelectionRange();if(!b.anchorNode)return!1;try{return a.dom.contains(3==b.anchorNode.nodeType?b.anchorNode.parentNode:b.anchorNode)&&(a.editable||a.dom.contains(3==b.focusNode.nodeType?b.focusNode.parentNode:b.focusNode))}catch(a){return!1}}function vG(a,b){let{$anchor:c,$head:d}=a.selection,e=b>0?c.max(d):c.min(d),f=e.parent.inlineContent?e.depth?a.doc.resolve(b>0?e.after():e.before()):null:e;return f&&t5.findFrom(f,b)}function vH(a,b){return a.dispatch(a.state.tr.setSelection(b).scrollIntoView()),!0}function vI(a,b,c){let d=a.state.selection;if(d instanceof t9){if(c.indexOf("s")>-1){let{$head:c}=d,e=c.textOffset?null:b<0?c.nodeBefore:c.nodeAfter;if(!e||e.isText||!e.isLeaf)return!1;let f=a.state.doc.resolve(c.pos+e.nodeSize*(b<0?-1:1));return vH(a,new t9(d.$anchor,f))}else if(!d.empty)return!1;else if(a.endOfTextblock(b>0?"forward":"backward")){let c=vG(a.state,b);return!!c&&c instanceof ub&&vH(a,c)}else if(!(uR&&c.indexOf("m")>-1)){let c=d.$head,e=c.textOffset?null:b<0?c.nodeBefore:c.nodeAfter,f;if(!e||e.isText)return!1;let g=b<0?c.pos-e.nodeSize:c.pos;return!!(e.isAtom||(f=a.docView.descAt(g))&&!f.contentDOM)&&(ub.isSelectable(e)?vH(a,new ub(b<0?a.state.doc.resolve(c.pos-e.nodeSize):c)):!!uU&&vH(a,new t9(a.state.doc.resolve(b<0?g:g+e.nodeSize))))}}else{if(d instanceof ub&&d.node.isInline)return vH(a,new t9(b>0?d.$to:d.$from));let c=vG(a.state,b);return!!c&&vH(a,c)}}function vJ(a){return 3==a.nodeType?a.nodeValue.length:a.childNodes.length}function vK(a,b){let c=a.pmViewDesc;return c&&0==c.size&&(b<0||a.nextSibling||"BR"!=a.nodeName)}function vL(a,b){return b<0?function(a){let b=a.domSelectionRange(),c=b.focusNode,d=b.focusOffset;if(!c)return;let e,f,g=!1;for(uL&&1==c.nodeType&&d<vJ(c)&&vK(c.childNodes[d],-1)&&(g=!0);;)if(d>0)if(1!=c.nodeType)break;else{let a=c.childNodes[d-1];if(vK(a,-1))e=c,f=--d;else if(3==a.nodeType)d=(c=a).nodeValue.length;else break}else if(vM(c))break;else{let b=c.previousSibling;for(;b&&vK(b,-1);)e=c.parentNode,f=ur(b),b=b.previousSibling;if(b)d=vJ(c=b);else{if((c=c.parentNode)==a.dom)break;d=0}}g?vN(a,c,d):e&&vN(a,e,f)}(a):function(a){let b,c,d=a.domSelectionRange(),e=d.focusNode,f=d.focusOffset;if(!e)return;let g=vJ(e);for(;;)if(f<g){if(1!=e.nodeType)break;if(vK(e.childNodes[f],1))b=e,c=++f;else break}else if(vM(e))break;else{let d=e.nextSibling;for(;d&&vK(d,1);)b=d.parentNode,c=ur(d)+1,d=d.nextSibling;if(d)f=0,g=vJ(e=d);else{if((e=e.parentNode)==a.dom)break;f=g=0}}b&&vN(a,b,c)}(a)}function vM(a){let b=a.pmViewDesc;return b&&b.node&&b.node.isBlock}function vN(a,b,c){if(3!=b.nodeType){let a,d;(d=function(a,b){for(;a&&b==a.childNodes.length&&!uA(a);)b=ur(a)+1,a=a.parentNode;for(;a&&b<a.childNodes.length;){let c=a.childNodes[b];if(3==c.nodeType)return c;if(1==c.nodeType&&"false"==c.contentEditable)break;a=c,b=0}}(b,c))?(b=d,c=0):(a=function(a,b){for(;a&&!b&&!uA(a);)b=ur(a),a=a.parentNode;for(;a&&b;){let c=a.childNodes[b-1];if(3==c.nodeType)return c;if(1==c.nodeType&&"false"==c.contentEditable)break;b=(a=c).childNodes.length}}(b,c))&&(b=a,c=a.nodeValue.length)}let d=a.domSelection();if(!d)return;if(uB(d)){let a=document.createRange();a.setEnd(b,c),a.setStart(b,c),d.removeAllRanges(),d.addRange(a)}else d.extend&&d.extend(b,c);a.domObserver.setCurSelection();let{state:e}=a;setTimeout(()=>{a.state==e&&vw(a)},50)}function vO(a,b){let c=a.state.doc.resolve(b);if(!(uN||uS)&&c.parent.inlineContent){let d=a.coordsAtPos(b);if(b>c.start()){let c=a.coordsAtPos(b-1),e=(c.top+c.bottom)/2;if(e>d.top&&e<d.bottom&&Math.abs(c.left-d.left)>1)return c.left<d.left?"ltr":"rtl"}if(b<c.end()){let c=a.coordsAtPos(b+1),e=(c.top+c.bottom)/2;if(e>d.top&&e<d.bottom&&Math.abs(c.left-d.left)>1)return c.left>d.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(a.dom).direction?"rtl":"ltr"}function vP(a,b,c){let d=a.state.selection;if(d instanceof t9&&!d.empty||c.indexOf("s")>-1||uR&&c.indexOf("m")>-1)return!1;let{$from:e,$to:f}=d;if(!e.parent.inlineContent||a.endOfTextblock(b<0?"up":"down")){let c=vG(a.state,b);if(c&&c instanceof ub)return vH(a,c)}if(!e.parent.inlineContent){let c=b<0?e:f,g=d instanceof ud?t5.near(c,b):t5.findFrom(c,b);return!!g&&vH(a,g)}return!1}function vQ(a,b){if(!(a.state.selection instanceof t9))return!0;let{$head:c,$anchor:d,empty:e}=a.state.selection;if(!c.sameParent(d))return!0;if(!e)return!1;if(a.endOfTextblock(b>0?"forward":"backward"))return!0;let f=!c.textOffset&&(b<0?c.nodeBefore:c.nodeAfter);if(f&&!f.isText){let d=a.state.tr;return b<0?d.delete(c.pos-f.nodeSize,c.pos):d.delete(c.pos,c.pos+f.nodeSize),a.dispatch(d),!0}return!1}function vR(a,b,c){a.domObserver.stop(),b.contentEditable=c,a.domObserver.start()}function vS(a,b){a.someProp("transformCopied",c=>{b=c(b,a)});let c=[],{content:d,openStart:e,openEnd:f}=b;for(;e>1&&f>1&&1==d.childCount&&1==d.firstChild.childCount;){e--,f--;let a=d.firstChild;c.push(a.type.name,a.attrs!=a.type.defaultAttrs?a.attrs:null),d=a.content}let g=a.someProp("clipboardSerializer")||tq.fromSchema(a.state.schema),h=v$(),i=h.createElement("div");i.appendChild(g.serializeFragment(d,{document:h}));let j=i.firstChild,k,l=0;for(;j&&1==j.nodeType&&(k=vY[j.nodeName.toLowerCase()]);){for(let a=k.length-1;a>=0;a--){let b=h.createElement(k[a]);for(;i.firstChild;)b.appendChild(i.firstChild);i.appendChild(b),l++}j=i.firstChild}return j&&1==j.nodeType&&j.setAttribute("data-pm-slice",`${e} ${f}${l?` -${l}`:""} ${JSON.stringify(c)}`),{dom:i,text:a.someProp("clipboardTextSerializer",c=>c(b,a))||b.content.textBetween(0,b.content.size,"\n\n"),slice:b}}function vT(a,b,c,d,e){let f,g,h=e.parent.type.spec.code;if(!c&&!b)return null;let i=!!b&&(d||h||!c);if(i){if(a.someProp("transformPastedText",c=>{b=c(b,h||d,a)}),h)return g=new sP(sJ.from(a.state.schema.text(b.replace(/\r\n?/g,"\n"))),0,0),a.someProp("transformPasted",b=>{g=b(g,a,!0)}),g;let c=a.someProp("clipboardTextParser",c=>c(b,e,d,a));if(c)g=c;else{let c=e.marks(),{schema:d}=a.state,g=tq.fromSchema(d);f=document.createElement("div"),b.split(/(?:\r\n?|\n)+/).forEach(a=>{let b=f.appendChild(document.createElement("p"));a&&b.appendChild(g.serializeNode(d.text(a,c)))})}}else a.someProp("transformPastedHTML",b=>{c=b(c,a)}),f=function(a){var b;let c,d=/^(\s*<meta [^>]*>)*/.exec(a);d&&(a=a.slice(d[0].length));let e=v$().createElement("div"),f=/<([a-z][^>\s]+)/i.exec(a),g;if((g=f&&vY[f[1].toLowerCase()])&&(a=g.map(a=>"<"+a+">").join("")+a+g.map(a=>"</"+a+">").reverse().join("")),e.innerHTML=(b=a,(c=window.trustedTypes)?(v_||(v_=c.defaultPolicy||c.createPolicy("ProseMirrorClipboard",{createHTML:a=>a})),v_.createHTML(b)):b),g)for(let a=0;a<g.length;a++)e=e.querySelector(g[a])||e;return e}(c),uU&&function(a){let b=a.querySelectorAll(uN?"span:not([class]):not([style])":"span.Apple-converted-space");for(let c=0;c<b.length;c++){let d=b[c];1==d.childNodes.length&&" "==d.textContent&&d.parentNode&&d.parentNode.replaceChild(a.ownerDocument.createTextNode(" "),d)}}(f);let j=f&&f.querySelector("[data-pm-slice]"),k=j&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(j.getAttribute("data-pm-slice")||"");if(k&&k[3])for(let a=+k[3];a>0;a--){let a=f.firstChild;for(;a&&1!=a.nodeType;)a=a.nextSibling;if(!a)break;f=a}if(g||(g=(a.someProp("clipboardParser")||a.someProp("domParser")||th.fromSchema(a.state.schema)).parseSlice(f,{preserveWhitespace:!!(i||k),context:e,ruleFromNode:a=>"BR"!=a.nodeName||a.nextSibling||!a.parentNode||vU.test(a.parentNode.nodeName)?null:{ignore:!0}})),k)g=function(a,b){if(!a.size)return a;let c=a.content.firstChild.type.schema,d;try{d=JSON.parse(b)}catch(b){return a}let{content:e,openStart:f,openEnd:g}=a;for(let a=d.length-2;a>=0;a-=2){let b=c.nodes[d[a]];if(!b||b.hasRequiredAttrs())break;e=sJ.from(b.create(d[a+1],e)),f++,g++}return new sP(e,f,g)}(vX(g,+k[1],+k[2]),k[4]);else if((g=sP.maxOpen(function(a,b){if(a.childCount<2)return a;for(let c=b.depth;c>=0;c--){let d=b.node(c).contentMatchAt(b.index(c)),e,f=[];if(a.forEach(a=>{if(!f)return;let b=d.findWrapping(a.type),c;if(!b)return f=null;if(c=f.length&&e.length&&function a(b,c,d,e,f){if(f<b.length&&f<c.length&&b[f]==c[f]){let g=a(b,c,d,e.lastChild,f+1);if(g)return e.copy(e.content.replaceChild(e.childCount-1,g));if(e.contentMatchAt(e.childCount).matchType(f==b.length-1?d.type:b[f+1]))return e.copy(e.content.append(sJ.from(vV(d,b,f+1))))}}(b,e,a,f[f.length-1],0))f[f.length-1]=c;else{f.length&&(f[f.length-1]=function a(b,c){if(0==c)return b;let d=b.content.replaceChild(b.childCount-1,a(b.lastChild,c-1)),e=b.contentMatchAt(b.childCount).fillBefore(sJ.empty,!0);return b.copy(d.append(e))}(f[f.length-1],e.length));let c=vV(a,b);f.push(c),d=d.matchType(c.type),e=b}}),f)return sJ.from(f)}return a}(g.content,e),!0)).openStart||g.openEnd){let a=0,b=0;for(let b=g.content.firstChild;a<g.openStart&&!b.type.spec.isolating;a++,b=b.firstChild);for(let a=g.content.lastChild;b<g.openEnd&&!a.type.spec.isolating;b++,a=a.lastChild);g=vX(g,a,b)}return a.someProp("transformPasted",b=>{g=b(g,a,i)}),g}let vU=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function vV(a,b,c=0){for(let d=b.length-1;d>=c;d--)a=b[d].create(null,sJ.from(a));return a}function vW(a,b,c,d,e,f){let g=b<0?a.firstChild:a.lastChild,h=g.content;return a.childCount>1&&(f=0),e<d-1&&(h=vW(h,b,c,d,e+1,f)),e>=c&&(h=b<0?g.contentMatchAt(0).fillBefore(h,f<=e).append(h):h.append(g.contentMatchAt(g.childCount).fillBefore(sJ.empty,!0))),a.replaceChild(b<0?0:a.childCount-1,g.copy(h))}function vX(a,b,c){return b<a.openStart&&(a=new sP(vW(a.content,-1,b,a.openStart,0,a.openEnd),b,a.openEnd)),c<a.openEnd&&(a=new sP(vW(a.content,1,c,a.openEnd,0,0),a.openStart,c)),a}let vY={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},vZ=null;function v$(){return vZ||(vZ=document.implementation.createHTMLDocument("title"))}let v_=null,v0={},v1={},v2={touchstart:!0,touchmove:!0};class v3{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function v4(a,b){a.input.lastSelectionOrigin=b,a.input.lastSelectionTime=Date.now()}function v5(a){a.someProp("handleDOMEvents",b=>{for(let c in b)a.input.eventHandlers[c]||a.dom.addEventListener(c,a.input.eventHandlers[c]=b=>v6(a,b))})}function v6(a,b){return a.someProp("handleDOMEvents",c=>{let d=c[b.type];return!!d&&(d(a,b)||b.defaultPrevented)})}function v7(a){return{left:a.clientX,top:a.clientY}}function v8(a,b,c,d,e){if(-1==d)return!1;let f=a.state.doc.resolve(d);for(let d=f.depth+1;d>0;d--)if(a.someProp(b,b=>d>f.depth?b(a,c,f.nodeAfter,f.before(d),e,!0):b(a,c,f.node(d),f.before(d),e,!1)))return!0;return!1}function v9(a,b,c){if(a.focused||a.focus(),a.state.selection.eq(b))return;let d=a.state.tr.setSelection(b);"pointer"==c&&d.setMeta("pointer",!0),a.dispatch(d)}v1.keydown=(a,b)=>{if((a.input.shiftKey=16==b.keyCode||b.shiftKey,!wc(a,b))&&(a.input.lastKeyCode=b.keyCode,a.input.lastKeyCodeTime=Date.now(),!uT||!uN||13!=b.keyCode))if(229!=b.keyCode&&a.domObserver.forceFlush(),!uQ||13!=b.keyCode||b.ctrlKey||b.altKey||b.metaKey)a.someProp("handleKeyDown",c=>c(a,b))||function(a,b){let c,d=b.keyCode,e=(c="",b.ctrlKey&&(c+="c"),b.metaKey&&(c+="m"),b.altKey&&(c+="a"),b.shiftKey&&(c+="s"),c);if(8==d||uR&&72==d&&"c"==e)return vQ(a,-1)||vL(a,-1);if(46==d&&!b.shiftKey||uR&&68==d&&"c"==e)return vQ(a,1)||vL(a,1);if(13==d||27==d)return!0;if(37==d||uR&&66==d&&"c"==e){let b=37==d?"ltr"==vO(a,a.state.selection.from)?-1:1:-1;return vI(a,b,e)||vL(a,b)}if(39==d||uR&&70==d&&"c"==e){let b=39==d?"ltr"==vO(a,a.state.selection.from)?1:-1:1;return vI(a,b,e)||vL(a,b)}else if(38==d||uR&&80==d&&"c"==e)return vP(a,-1,e)||vL(a,-1);else if(40==d||uR&&78==d&&"c"==e)return function(a){if(!uP||a.state.selection.$head.parentOffset>0)return!1;let{focusNode:b,focusOffset:c}=a.domSelectionRange();if(b&&1==b.nodeType&&0==c&&b.firstChild&&"false"==b.firstChild.contentEditable){let c=b.firstChild;vR(a,c,"true"),setTimeout(()=>vR(a,c,"false"),20)}return!1}(a)||vP(a,1,e)||vL(a,1);else if(e==(uR?"m":"c")&&(66==d||73==d||89==d||90==d))return!0;return!1}(a,b)?b.preventDefault():v4(a,"key");else{let b=Date.now();a.input.lastIOSEnter=b,a.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{a.input.lastIOSEnter==b&&(a.someProp("handleKeyDown",b=>b(a,uC(13,"Enter"))),a.input.lastIOSEnter=0)},200)}},v1.keyup=(a,b)=>{16==b.keyCode&&(a.input.shiftKey=!1)},v1.keypress=(a,b)=>{if(wc(a,b)||!b.charCode||b.ctrlKey&&!b.altKey||uR&&b.metaKey)return;if(a.someProp("handleKeyPress",c=>c(a,b)))return void b.preventDefault();let c=a.state.selection;if(!(c instanceof t9)||!c.$from.sameParent(c.$to)){let d=String.fromCharCode(b.charCode),e=()=>a.state.tr.insertText(d).scrollIntoView();/[\r\n]/.test(d)||a.someProp("handleTextInput",b=>b(a,c.$from.pos,c.$to.pos,d,e))||a.dispatch(e()),b.preventDefault()}};let wa=uR?"metaKey":"ctrlKey";v0.mousedown=(a,b)=>{var c;let d,e;a.input.shiftKey=b.shiftKey;let f=wg(a),g=Date.now(),h="singleClick";g-a.input.lastClick.time<500&&(d=(c=a.input.lastClick).x-b.clientX)*d+(e=c.y-b.clientY)*e<100&&!b[wa]&&a.input.lastClick.button==b.button&&("singleClick"==a.input.lastClick.type?h="doubleClick":"doubleClick"==a.input.lastClick.type&&(h="tripleClick")),a.input.lastClick={time:g,x:b.clientX,y:b.clientY,type:h,button:b.button};let i=a.posAtCoords(v7(b));i&&("singleClick"==h?(a.input.mouseDown&&a.input.mouseDown.done(),a.input.mouseDown=new wb(a,i,b,!!f)):("doubleClick"==h?function(a,b,c,d){return v8(a,"handleDoubleClickOn",b,c,d)||a.someProp("handleDoubleClick",c=>c(a,b,d))}:function(a,b,c,d){return v8(a,"handleTripleClickOn",b,c,d)||a.someProp("handleTripleClick",c=>c(a,b,d))||function(a,b,c){if(0!=c.button)return!1;let d=a.state.doc;if(-1==b)return!!d.inlineContent&&(v9(a,t9.create(d,0,d.content.size),"pointer"),!0);let e=d.resolve(b);for(let b=e.depth+1;b>0;b--){let c=b>e.depth?e.nodeAfter:e.node(b),f=e.before(b);if(c.inlineContent)v9(a,t9.create(d,f+1,f+1+c.content.size),"pointer");else{if(!ub.isSelectable(c))continue;v9(a,ub.create(d,f),"pointer")}return!0}}(a,c,d)})(a,i.pos,i.inside,b)?b.preventDefault():v4(a,"pointer"))};class wb{constructor(a,b,c,d){let e,f;if(this.view=a,this.pos=b,this.event=c,this.flushed=d,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=a.state.doc,this.selectNode=!!c[wa],this.allowDefault=c.shiftKey,b.inside>-1)e=a.state.doc.nodeAt(b.inside),f=b.inside;else{let c=a.state.doc.resolve(b.pos);e=c.parent,f=c.depth?c.before():0}const g=d?null:c.target,h=g?a.docView.nearestDesc(g,!0):null;this.target=h&&1==h.nodeDOM.nodeType?h.nodeDOM:null;let{selection:i}=a.state;(0==c.button&&e.type.spec.draggable&&!1!==e.type.spec.selectable||i instanceof ub&&i.from<=f&&i.to>f)&&(this.mightDrag={node:e,pos:f,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&uL&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),a.root.addEventListener("mouseup",this.up=this.up.bind(this)),a.root.addEventListener("mousemove",this.move=this.move.bind(this)),v4(a,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>vw(this.view)),this.view.input.mouseDown=null}up(a){if(this.done(),!this.view.dom.contains(a.target))return;let b=this.pos;if(this.view.state.doc!=this.startDoc&&(b=this.view.posAtCoords(v7(a))),this.updateAllowDefault(a),this.allowDefault||!b)v4(this.view,"pointer");else{var c,d,e,f;(c=this.view,d=b.pos,e=b.inside,f=this.selectNode,v8(c,"handleClickOn",d,e,a)||c.someProp("handleClick",b=>b(c,d,a))||(f?function(a,b){if(-1==b)return!1;let c=a.state.selection,d,e;c instanceof ub&&(d=c.node);let f=a.state.doc.resolve(b);for(let a=f.depth+1;a>0;a--){let b=a>f.depth?f.nodeAfter:f.node(a);if(ub.isSelectable(b)){e=d&&c.$from.depth>0&&a>=c.$from.depth&&f.before(c.$from.depth+1)==c.$from.pos?f.before(c.$from.depth):f.before(a);break}}return null!=e&&(v9(a,ub.create(a.state.doc,e),"pointer"),!0)}(c,e):function(a,b){if(-1==b)return!1;let c=a.state.doc.resolve(b),d=c.nodeAfter;return!!(d&&d.isAtom&&ub.isSelectable(d))&&(v9(a,new ub(c),"pointer"),!0)}(c,e)))?a.preventDefault():0==a.button&&(this.flushed||uP&&this.mightDrag&&!this.mightDrag.node.isAtom||uN&&!this.view.state.selection.visible&&2>=Math.min(Math.abs(b.pos-this.view.state.selection.from),Math.abs(b.pos-this.view.state.selection.to)))?(v9(this.view,t5.near(this.view.state.doc.resolve(b.pos)),"pointer"),a.preventDefault()):v4(this.view,"pointer")}}move(a){this.updateAllowDefault(a),v4(this.view,"pointer"),0==a.buttons&&this.done()}updateAllowDefault(a){!this.allowDefault&&(Math.abs(this.event.x-a.clientX)>4||Math.abs(this.event.y-a.clientY)>4)&&(this.allowDefault=!0)}}function wc(a,b){return!!a.composing||!!(uP&&500>Math.abs(b.timeStamp-a.input.compositionEndedAt))&&(a.input.compositionEndedAt=-2e8,!0)}v0.touchstart=a=>{a.input.lastTouch=Date.now(),wg(a),v4(a,"pointer")},v0.touchmove=a=>{a.input.lastTouch=Date.now(),v4(a,"pointer")},v0.contextmenu=a=>wg(a);let wd=uT?5e3:-1;function we(a,b){clearTimeout(a.input.composingTimeout),b>-1&&(a.input.composingTimeout=setTimeout(()=>wg(a),b))}function wf(a){let b;for(a.composing&&(a.input.composing=!1,a.input.compositionEndedAt=((b=document.createEvent("Event")).initEvent("event",!0,!0),b.timeStamp));a.input.compositionNodes.length>0;)a.input.compositionNodes.pop().markParentsDirty()}function wg(a,b=!1){if(!uT||!(a.domObserver.flushingSoon>=0)){if(a.domObserver.forceFlush(),wf(a),b||a.docView&&a.docView.dirty){let c=vu(a),d=a.state.selection;return c&&!c.eq(d)?a.dispatch(a.state.tr.setSelection(c)):(a.markCursor||b)&&!d.$from.node(d.$from.sharedDepth(d.to)).inlineContent?a.dispatch(a.state.tr.deleteSelection()):a.updateState(a.state),!0}return!1}}v1.compositionstart=v1.compositionupdate=a=>{if(!a.composing){a.domObserver.flush();let{state:b}=a,c=b.selection.$to;if(b.selection instanceof t9&&(b.storedMarks||!c.textOffset&&c.parentOffset&&c.nodeBefore.marks.some(a=>!1===a.type.spec.inclusive)))a.markCursor=a.state.storedMarks||c.marks(),wg(a,!0),a.markCursor=null;else if(wg(a,!b.selection.empty),uL&&b.selection.empty&&c.parentOffset&&!c.textOffset&&c.nodeBefore.marks.length){let b=a.domSelectionRange();for(let c=b.focusNode,d=b.focusOffset;c&&1==c.nodeType&&0!=d;){let b=d<0?c.lastChild:c.childNodes[d-1];if(!b)break;if(3==b.nodeType){let c=a.domSelection();c&&c.collapse(b,b.nodeValue.length);break}c=b,d=-1}}a.input.composing=!0}we(a,wd)},v1.compositionend=(a,b)=>{a.composing&&(a.input.composing=!1,a.input.compositionEndedAt=b.timeStamp,a.input.compositionPendingChanges=a.domObserver.pendingRecords().length?a.input.compositionID:0,a.input.compositionNode=null,a.input.compositionPendingChanges&&Promise.resolve().then(()=>a.domObserver.flush()),a.input.compositionID++,we(a,20))};let wh=uJ&&uK<15||uQ&&uV<604;function wi(a,b,c,d,e){let f=vT(a,b,c,d,a.state.selection.$from);if(a.someProp("handlePaste",b=>b(a,e,f||sP.empty)))return!0;if(!f)return!1;let g=0==f.openStart&&0==f.openEnd&&1==f.content.childCount?f.content.firstChild:null,h=g?a.state.tr.replaceSelectionWith(g,d):a.state.tr.replaceSelection(f);return a.dispatch(h.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function wj(a){let b=a.getData("text/plain")||a.getData("Text");if(b)return b;let c=a.getData("text/uri-list");return c?c.replace(/\r?\n/g," "):""}v0.copy=v1.cut=(a,b)=>{let c=a.state.selection,d="cut"==b.type;if(c.empty)return;let e=wh?null:b.clipboardData,{dom:f,text:g}=vS(a,c.content());e?(b.preventDefault(),e.clearData(),e.setData("text/html",f.innerHTML),e.setData("text/plain",g)):function(a,b){if(!a.dom.parentNode)return;let c=a.dom.parentNode.appendChild(document.createElement("div"));c.appendChild(b),c.style.cssText="position: fixed; left: -10000px; top: 10px";let d=getSelection(),e=document.createRange();e.selectNodeContents(b),a.dom.blur(),d.removeAllRanges(),d.addRange(e),setTimeout(()=>{c.parentNode&&c.parentNode.removeChild(c),a.focus()},50)}(a,f),d&&a.dispatch(a.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},v1.paste=(a,b)=>{if(a.composing&&!uT)return;let c=wh?null:b.clipboardData,d=a.input.shiftKey&&45!=a.input.lastKeyCode;c&&wi(a,wj(c),c.getData("text/html"),d,b)?b.preventDefault():function(a,b){if(!a.dom.parentNode)return;let c=a.input.shiftKey||a.state.selection.$from.parent.type.spec.code,d=a.dom.parentNode.appendChild(document.createElement(c?"textarea":"div"));c||(d.contentEditable="true"),d.style.cssText="position: fixed; left: -10000px; top: 10px",d.focus();let e=a.input.shiftKey&&45!=a.input.lastKeyCode;setTimeout(()=>{a.focus(),d.parentNode&&d.parentNode.removeChild(d),c?wi(a,d.value,null,e,b):wi(a,d.textContent,d.innerHTML,e,b)},50)}(a,b)};class wk{constructor(a,b,c){this.slice=a,this.move=b,this.node=c}}let wl=uR?"altKey":"ctrlKey";function wm(a,b){let c=a.someProp("dragCopies",a=>!a(b));return null!=c?c:!b[wl]}for(let a in v0.dragstart=(a,b)=>{let c,d=a.input.mouseDown;if(d&&d.done(),!b.dataTransfer)return;let e=a.state.selection,f=e.empty?null:a.posAtCoords(v7(b));if(f&&f.pos>=e.from&&f.pos<=(e instanceof ub?e.to-1:e.to));else if(d&&d.mightDrag)c=ub.create(a.state.doc,d.mightDrag.pos);else if(b.target&&1==b.target.nodeType){let d=a.docView.nearestDesc(b.target,!0);d&&d.node.type.spec.draggable&&d!=a.docView&&(c=ub.create(a.state.doc,d.posBefore))}let g=(c||a.state.selection).content(),{dom:h,text:i,slice:j}=vS(a,g);b.dataTransfer.files.length&&uN&&!(uO>120)||b.dataTransfer.clearData(),b.dataTransfer.setData(wh?"Text":"text/html",h.innerHTML),b.dataTransfer.effectAllowed="copyMove",wh||b.dataTransfer.setData("text/plain",i),a.dragging=new wk(j,wm(a,b),c)},v0.dragend=a=>{let b=a.dragging;window.setTimeout(()=>{a.dragging==b&&(a.dragging=null)},50)},v1.dragover=v1.dragenter=(a,b)=>b.preventDefault(),v1.drop=(a,b)=>{let c=a.dragging;if(a.dragging=null,!b.dataTransfer)return;let d=a.posAtCoords(v7(b));if(!d)return;let e=a.state.doc.resolve(d.pos),f=c&&c.slice;f?a.someProp("transformPasted",b=>{f=b(f,a,!1)}):f=vT(a,wj(b.dataTransfer),wh?null:b.dataTransfer.getData("text/html"),!1,e);let g=!!(c&&wm(a,b));if(a.someProp("handleDrop",c=>c(a,b,f||sP.empty,g)))return void b.preventDefault();if(!f)return;b.preventDefault();let h=f?tT(a.state.doc,e.pos,f):e.pos;null==h&&(h=e.pos);let i=a.state.tr;if(g){let{node:a}=c;a?a.replace(i):i.deleteSelection()}let j=i.mapping.map(h),k=0==f.openStart&&0==f.openEnd&&1==f.content.childCount,l=i.doc;if(k?i.replaceRangeWith(j,j,f.content.firstChild):i.replaceRange(j,j,f),i.doc.eq(l))return;let m=i.doc.resolve(j);if(k&&ub.isSelectable(f.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(f.content.firstChild))i.setSelection(new ub(m));else{let b=i.mapping.map(h);i.mapping.maps[i.mapping.maps.length-1].forEach((a,c,d,e)=>b=e),i.setSelection(vD(a,m,i.doc.resolve(b)))}a.focus(),a.dispatch(i.setMeta("uiEvent","drop"))},v0.focus=a=>{a.input.lastFocus=Date.now(),a.focused||(a.domObserver.stop(),a.dom.classList.add("ProseMirror-focused"),a.domObserver.start(),a.focused=!0,setTimeout(()=>{a.docView&&a.hasFocus()&&!a.domObserver.currentSelection.eq(a.domSelectionRange())&&vw(a)},20))},v0.blur=(a,b)=>{a.focused&&(a.domObserver.stop(),a.dom.classList.remove("ProseMirror-focused"),a.domObserver.start(),b.relatedTarget&&a.dom.contains(b.relatedTarget)&&a.domObserver.currentSelection.clear(),a.focused=!1)},v0.beforeinput=(a,b)=>{if(uN&&uT&&"deleteContentBackward"==b.inputType){a.domObserver.flushSoon();let{domChangeCount:b}=a.input;setTimeout(()=>{if(a.input.domChangeCount!=b||(a.dom.blur(),a.focus(),a.someProp("handleKeyDown",b=>b(a,uC(8,"Backspace")))))return;let{$cursor:c}=a.state.selection;c&&c.pos>0&&a.dispatch(a.state.tr.delete(c.pos-1,c.pos).scrollIntoView())},50)}},v1)v0[a]=v1[a];function wn(a,b){if(a==b)return!0;for(let c in a)if(a[c]!==b[c])return!1;for(let c in b)if(!(c in a))return!1;return!0}class wo{constructor(a,b){this.toDOM=a,this.spec=b||wt,this.side=this.spec.side||0}map(a,b,c,d){let{pos:e,deleted:f}=a.mapResult(b.from+d,this.side<0?-1:1);return f?null:new wr(e-c,e-c,this)}valid(){return!0}eq(a){return this==a||a instanceof wo&&(this.spec.key&&this.spec.key==a.spec.key||this.toDOM==a.toDOM&&wn(this.spec,a.spec))}destroy(a){this.spec.destroy&&this.spec.destroy(a)}}class wp{constructor(a,b){this.attrs=a,this.spec=b||wt}map(a,b,c,d){let e=a.map(b.from+d,this.spec.inclusiveStart?-1:1)-c,f=a.map(b.to+d,this.spec.inclusiveEnd?1:-1)-c;return e>=f?null:new wr(e,f,this)}valid(a,b){return b.from<b.to}eq(a){return this==a||a instanceof wp&&wn(this.attrs,a.attrs)&&wn(this.spec,a.spec)}static is(a){return a.type instanceof wp}destroy(){}}class wq{constructor(a,b){this.attrs=a,this.spec=b||wt}map(a,b,c,d){let e=a.mapResult(b.from+d,1);if(e.deleted)return null;let f=a.mapResult(b.to+d,-1);return f.deleted||f.pos<=e.pos?null:new wr(e.pos-c,f.pos-c,this)}valid(a,b){let{index:c,offset:d}=a.content.findIndex(b.from),e;return d==b.from&&!(e=a.child(c)).isText&&d+e.nodeSize==b.to}eq(a){return this==a||a instanceof wq&&wn(this.attrs,a.attrs)&&wn(this.spec,a.spec)}destroy(){}}class wr{constructor(a,b,c){this.from=a,this.to=b,this.type=c}copy(a,b){return new wr(a,b,this.type)}eq(a,b=0){return this.type.eq(a.type)&&this.from+b==a.from&&this.to+b==a.to}map(a,b,c){return this.type.map(a,this,b,c)}static widget(a,b,c){return new wr(a,a,new wo(b,c))}static inline(a,b,c,d){return new wr(a,b,new wp(c,d))}static node(a,b,c,d){return new wr(a,b,new wq(c,d))}get spec(){return this.type.spec}get inline(){return this.type instanceof wp}get widget(){return this.type instanceof wo}}let ws=[],wt={};class wu{constructor(a,b){this.local=a.length?a:ws,this.children=b.length?b:ws}static create(a,b){return b.length?wA(b,a,0,wt):wv}find(a,b,c){let d=[];return this.findInner(null==a?0:a,null==b?1e9:b,d,0,c),d}findInner(a,b,c,d,e){for(let f=0;f<this.local.length;f++){let g=this.local[f];g.from<=b&&g.to>=a&&(!e||e(g.spec))&&c.push(g.copy(g.from+d,g.to+d))}for(let f=0;f<this.children.length;f+=3)if(this.children[f]<b&&this.children[f+1]>a){let g=this.children[f]+1;this.children[f+2].findInner(a-g,b-g,c,d+g,e)}}map(a,b,c){return this==wv||0==a.maps.length?this:this.mapInner(a,b,0,0,c||wt)}mapInner(a,b,c,d,e){let f;for(let g=0;g<this.local.length;g++){let h=this.local[g].map(a,c,d);h&&h.type.valid(b,h)?(f||(f=[])).push(h):e.onRemove&&e.onRemove(this.local[g].spec)}return this.children.length?function(a,b,c,d,e,f,g){let h=a.slice();for(let a=0,b=f;a<c.maps.length;a++){let d=0;c.maps[a].forEach((a,c,e,f)=>{let g=f-e-(c-a);for(let e=0;e<h.length;e+=3){let f=h[e+1];if(f<0||a>f+b-d)continue;let i=h[e]+b-d;c>=i?h[e+1]=a<=i?-2:-1:a>=b&&g&&(h[e]+=g,h[e+1]+=g)}d+=g}),b=c.maps[a].map(b,-1)}let i=!1;for(let b=0;b<h.length;b+=3)if(h[b+1]<0){if(-2==h[b+1]){i=!0,h[b+1]=-1;continue}let j=c.map(a[b]+f),k=j-e;if(k<0||k>=d.content.size){i=!0;continue}let l=c.map(a[b+1]+f,-1)-e,{index:m,offset:n}=d.content.findIndex(k),o=d.maybeChild(m);if(o&&n==k&&n+o.nodeSize==l){let d=h[b+2].mapInner(c,o,j+1,a[b]+f+1,g);d!=wv?(h[b]=k,h[b+1]=l,h[b+2]=d):(h[b+1]=-2,i=!0)}else i=!0}if(i){let i=wA(function(a,b,c,d,e,f,g){for(let h=0;h<a.length;h+=3)-1==a[h+1]&&function a(b,f){for(let a=0;a<b.local.length;a++){let h=b.local[a].map(d,e,f);h?c.push(h):g.onRemove&&g.onRemove(b.local[a].spec)}for(let c=0;c<b.children.length;c+=3)a(b.children[c+2],b.children[c]+f+1)}(a[h+2],b[h]+f+1);return c}(h,a,b,c,e,f,g),d,0,g);b=i.local;for(let a=0;a<h.length;a+=3)h[a+1]<0&&(h.splice(a,3),a-=3);for(let a=0,b=0;a<i.children.length;a+=3){let c=i.children[a];for(;b<h.length&&h[b]<c;)b+=3;h.splice(b,0,i.children[a],i.children[a+1],i.children[a+2])}}return new wu(b.sort(wB),h)}(this.children,f||[],a,b,c,d,e):f?new wu(f.sort(wB),ws):wv}add(a,b){return b.length?this==wv?wu.create(a,b):this.addInner(a,b,0):this}addInner(a,b,c){let d,e=0;a.forEach((a,f)=>{let g=f+c,h;if(h=wy(b,a,g)){for(d||(d=this.children.slice());e<d.length&&d[e]<f;)e+=3;d[e]==f?d[e+2]=d[e+2].addInner(a,h,g+1):d.splice(e,0,f,f+a.nodeSize,wA(h,a,g+1,wt)),e+=3}});let f=wx(e?wz(b):b,-c);for(let b=0;b<f.length;b++)f[b].type.valid(a,f[b])||f.splice(b--,1);return new wu(f.length?this.local.concat(f).sort(wB):this.local,d||this.children)}remove(a){return 0==a.length||this==wv?this:this.removeInner(a,0)}removeInner(a,b){let c=this.children,d=this.local;for(let d=0;d<c.length;d+=3){let e,f=c[d]+b,g=c[d+1]+b;for(let b=0,c;b<a.length;b++)(c=a[b])&&c.from>f&&c.to<g&&(a[b]=null,(e||(e=[])).push(c));if(!e)continue;c==this.children&&(c=this.children.slice());let h=c[d+2].removeInner(e,f+1);h!=wv?c[d+2]=h:(c.splice(d,3),d-=3)}if(d.length){for(let c=0,e;c<a.length;c++)if(e=a[c])for(let a=0;a<d.length;a++)d[a].eq(e,b)&&(d==this.local&&(d=this.local.slice()),d.splice(a--,1))}return c==this.children&&d==this.local?this:d.length||c.length?new wu(d,c):wv}forChild(a,b){let c,d;if(this==wv)return this;if(b.isLeaf)return wu.empty;for(let b=0;b<this.children.length;b+=3)if(this.children[b]>=a){this.children[b]==a&&(c=this.children[b+2]);break}let e=a+1,f=e+b.content.size;for(let a=0;a<this.local.length;a++){let b=this.local[a];if(b.from<f&&b.to>e&&b.type instanceof wp){let a=Math.max(e,b.from)-e,c=Math.min(f,b.to)-e;a<c&&(d||(d=[])).push(b.copy(a,c))}}if(d){let a=new wu(d.sort(wB),ws);return c?new ww([a,c]):a}return c||wv}eq(a){if(this==a)return!0;if(!(a instanceof wu)||this.local.length!=a.local.length||this.children.length!=a.children.length)return!1;for(let b=0;b<this.local.length;b++)if(!this.local[b].eq(a.local[b]))return!1;for(let b=0;b<this.children.length;b+=3)if(this.children[b]!=a.children[b]||this.children[b+1]!=a.children[b+1]||!this.children[b+2].eq(a.children[b+2]))return!1;return!0}locals(a){return wC(this.localsInner(a))}localsInner(a){if(this==wv)return ws;if(a.inlineContent||!this.local.some(wp.is))return this.local;let b=[];for(let a=0;a<this.local.length;a++)this.local[a].type instanceof wp||b.push(this.local[a]);return b}forEachSet(a){a(this)}}wu.empty=new wu([],[]),wu.removeOverlap=wC;let wv=wu.empty;class ww{constructor(a){this.members=a}map(a,b){let c=this.members.map(c=>c.map(a,b,wt));return ww.from(c)}forChild(a,b){if(b.isLeaf)return wu.empty;let c=[];for(let d=0;d<this.members.length;d++){let e=this.members[d].forChild(a,b);e!=wv&&(e instanceof ww?c=c.concat(e.members):c.push(e))}return ww.from(c)}eq(a){if(!(a instanceof ww)||a.members.length!=this.members.length)return!1;for(let b=0;b<this.members.length;b++)if(!this.members[b].eq(a.members[b]))return!1;return!0}locals(a){let b,c=!0;for(let d=0;d<this.members.length;d++){let e=this.members[d].localsInner(a);if(e.length)if(b){c&&(b=b.slice(),c=!1);for(let a=0;a<e.length;a++)b.push(e[a])}else b=e}return b?wC(c?b:b.sort(wB)):ws}static from(a){switch(a.length){case 0:return wv;case 1:return a[0];default:return new ww(a.every(a=>a instanceof wu)?a:a.reduce((a,b)=>a.concat(b instanceof wu?b:b.members),[]))}}forEachSet(a){for(let b=0;b<this.members.length;b++)this.members[b].forEachSet(a)}}function wx(a,b){if(!b||!a.length)return a;let c=[];for(let d=0;d<a.length;d++){let e=a[d];c.push(new wr(e.from+b,e.to+b,e.type))}return c}function wy(a,b,c){if(b.isLeaf)return null;let d=c+b.nodeSize,e=null;for(let b=0,f;b<a.length;b++)(f=a[b])&&f.from>c&&f.to<d&&((e||(e=[])).push(f),a[b]=null);return e}function wz(a){let b=[];for(let c=0;c<a.length;c++)null!=a[c]&&b.push(a[c]);return b}function wA(a,b,c,d){let e=[],f=!1;b.forEach((b,g)=>{let h=wy(a,b,g+c);if(h){f=!0;let a=wA(h,b,c+g+1,d);a!=wv&&e.push(g,g+b.nodeSize,a)}});let g=wx(f?wz(a):a,-c).sort(wB);for(let a=0;a<g.length;a++)g[a].type.valid(b,g[a])||(d.onRemove&&d.onRemove(g[a].spec),g.splice(a--,1));return g.length||e.length?new wu(g,e):wv}function wB(a,b){return a.from-b.from||a.to-b.to}function wC(a){let b=a;for(let c=0;c<b.length-1;c++){let d=b[c];if(d.from!=d.to)for(let e=c+1;e<b.length;e++){let f=b[e];if(f.from==d.from){f.to!=d.to&&(b==a&&(b=a.slice()),b[e]=f.copy(f.from,d.to),wD(b,e+1,f.copy(d.to,f.to)));continue}f.from<d.to&&(b==a&&(b=a.slice()),b[c]=d.copy(d.from,f.from),wD(b,e,d.copy(f.from,d.to)));break}}return b}function wD(a,b,c){for(;b<a.length&&wB(c,a[b])>0;)b++;a.splice(b,0,c)}function wE(a){let b=[];return a.someProp("decorations",c=>{let d=c(a.state);d&&d!=wv&&b.push(d)}),a.cursorWrapper&&b.push(wu.create(a.state.doc,[a.cursorWrapper.deco])),ww.from(b)}let wF={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},wG=uJ&&uK<=11;class wH{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(a){this.anchorNode=a.anchorNode,this.anchorOffset=a.anchorOffset,this.focusNode=a.focusNode,this.focusOffset=a.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(a){return a.anchorNode==this.anchorNode&&a.anchorOffset==this.anchorOffset&&a.focusNode==this.focusNode&&a.focusOffset==this.focusOffset}}class wI{constructor(a,b){this.view=a,this.handleDOMChange=b,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new wH,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(a=>{for(let b=0;b<a.length;b++)this.queue.push(a[b]);uJ&&uK<=11&&a.some(a=>"childList"==a.type&&a.removedNodes.length||"characterData"==a.type&&a.oldValue.length>a.target.nodeValue.length)?this.flushSoon():this.flush()}),wG&&(this.onCharData=a=>{this.queue.push({target:a.target,type:"characterData",oldValue:a.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,wF)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let a=this.observer.takeRecords();if(a.length){for(let b=0;b<a.length;b++)this.queue.push(a[b]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(vE(this.view)){if(this.suppressingSelectionUpdates)return vw(this.view);if(uJ&&uK<=11&&!this.view.state.selection.empty){let a=this.view.domSelectionRange();if(a.focusNode&&uw(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(a){if(!a.focusNode)return!0;let b=new Set,c;for(let c=a.focusNode;c;c=us(c))b.add(c);for(let d=a.anchorNode;d;d=us(d))if(b.has(d)){c=d;break}let d=c&&this.view.docView.nearestDesc(c);if(d&&d.ignoreMutation({type:"selection",target:3==c.nodeType?c.parentNode:c}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let a of this.observer.takeRecords())this.queue.push(a);return this.queue}flush(){var a;let{view:b}=this;if(!b.docView||this.flushingSoon>-1)return;let c=this.pendingRecords();c.length&&(this.queue=[]);let d=b.domSelectionRange(),e=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(d)&&vE(b)&&!this.ignoreSelectionChange(d),f=-1,g=-1,h=!1,i=[];if(b.editable)for(let a=0;a<c.length;a++){let b=this.registerMutation(c[a],i);b&&(f=f<0?b.from:Math.min(b.from,f),g=g<0?b.to:Math.max(b.to,g),b.typeOver&&(h=!0))}if(uL&&i.length){let a=i.filter(a=>"BR"==a.nodeName);if(2==a.length){let[b,c]=a;b.parentNode&&b.parentNode.parentNode==c.parentNode?c.remove():b.remove()}else{let{focusNode:c}=this.currentSelection;for(let d of a){let a=d.parentNode;a&&"LI"==a.nodeName&&(!c||function(a,b){for(let c=b.parentNode;c&&c!=a.dom;c=c.parentNode){let b=a.docView.nearestDesc(c,!0);if(b&&b.node.isBlock)return c}return null}(b,c)!=a)&&d.remove()}}}let j=null;f<0&&e&&b.input.lastFocus>Date.now()-200&&Math.max(b.input.lastTouch,b.input.lastClick.time)<Date.now()-300&&uB(d)&&(j=vu(b))&&j.eq(t5.near(b.state.doc.resolve(0),1))?(b.input.lastFocus=0,vw(b),this.currentSelection.set(d),b.scrollToSelection()):(f>-1||e)&&(f>-1&&(b.docView.markDirty(f,g),a=b,!wJ.has(a)&&(wJ.set(a,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(a.dom).whiteSpace))&&(a.requiresGeckoHackNode=uL,wK||(console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),wK=!0))),this.handleDOMChange(f,g,h,i),b.docView&&b.docView.dirty?b.updateState(b.state):this.currentSelection.eq(d)||vw(b),this.currentSelection.set(d))}registerMutation(a,b){if(b.indexOf(a.target)>-1)return null;let c=this.view.docView.nearestDesc(a.target);if("attributes"==a.type&&(c==this.view.docView||"contenteditable"==a.attributeName||"style"==a.attributeName&&!a.oldValue&&!a.target.getAttribute("style"))||!c||c.ignoreMutation(a))return null;if("childList"==a.type){for(let c=0;c<a.addedNodes.length;c++){let d=a.addedNodes[c];b.push(d),3==d.nodeType&&(this.lastChangedTextNode=d)}if(c.contentDOM&&c.contentDOM!=c.dom&&!c.contentDOM.contains(a.target))return{from:c.posBefore,to:c.posAfter};let d=a.previousSibling,e=a.nextSibling;if(uJ&&uK<=11&&a.addedNodes.length)for(let b=0;b<a.addedNodes.length;b++){let{previousSibling:c,nextSibling:f}=a.addedNodes[b];(!c||0>Array.prototype.indexOf.call(a.addedNodes,c))&&(d=c),(!f||0>Array.prototype.indexOf.call(a.addedNodes,f))&&(e=f)}let f=d&&d.parentNode==a.target?ur(d)+1:0,g=c.localPosFromDOM(a.target,f,-1),h=e&&e.parentNode==a.target?ur(e):a.target.childNodes.length;return{from:g,to:c.localPosFromDOM(a.target,h,1)}}return"attributes"==a.type?{from:c.posAtStart-c.border,to:c.posAtEnd+c.border}:(this.lastChangedTextNode=a.target,{from:c.posAtStart,to:c.posAtEnd,typeOver:a.target.nodeValue==a.oldValue})}}let wJ=new WeakMap,wK=!1;function wL(a,b){let c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset,g=a.domAtPos(a.state.selection.anchor);return uw(g.node,g.offset,e,f)&&([c,d,e,f]=[e,f,c,d]),{anchorNode:c,anchorOffset:d,focusNode:e,focusOffset:f}}function wM(a){let b=a.pmViewDesc;if(b)return b.parseRule();if("BR"==a.nodeName&&a.parentNode){if(uP&&/^(ul|ol)$/i.test(a.parentNode.nodeName)){let a=document.createElement("div");return a.appendChild(document.createElement("li")),{skip:a}}else if(a.parentNode.lastChild==a||uP&&/^(tr|table)$/i.test(a.parentNode.nodeName))return{ignore:!0}}else if("IMG"==a.nodeName&&a.getAttribute("mark-placeholder"))return{ignore:!0};return null}let wN=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function wO(a,b,c){return Math.max(c.anchor,c.head)>b.content.size?null:vD(a,b.resolve(c.anchor),b.resolve(c.head))}function wP(a,b,c){let d=a.depth,e=b?a.end():a.pos;for(;d>0&&(b||a.indexAfter(d)==a.node(d).childCount);)d--,e++,b=!1;if(c){let b=a.node(d).maybeChild(a.indexAfter(d));for(;b&&!b.isLeaf;)b=b.firstChild,e++}return e}function wQ(a){if(2!=a.length)return!1;let b=a.charCodeAt(0),c=a.charCodeAt(1);return b>=56320&&b<=57343&&c>=55296&&c<=56319}class wR{constructor(a,b){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new v3,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=b,this.state=b.state,this.directPlugins=b.plugins||[],this.directPlugins.forEach(wW),this.dispatch=this.dispatch.bind(this),this.dom=a&&a.mount||document.createElement("div"),a&&(a.appendChild?a.appendChild(this.dom):"function"==typeof a?a(this.dom):a.mount&&(this.mounted=!0)),this.editable=wU(this),wT(this),this.nodeViews=wV(this),this.docView=vg(this.state.doc,wS(this),wE(this),this.dom,this),this.domObserver=new wI(this,(a,b,c,d)=>(function(a,b,c,d,e){let f,g,h,i=a.input.compositionPendingChanges||(a.composing?a.input.compositionID:0);if(a.input.compositionPendingChanges=0,b<0){let b=a.input.lastSelectionTime>Date.now()-50?a.input.lastSelectionOrigin:null,c=vu(a,b);if(c&&!a.state.selection.eq(c)){if(uN&&uT&&13===a.input.lastKeyCode&&Date.now()-100<a.input.lastKeyCodeTime&&a.someProp("handleKeyDown",b=>b(a,uC(13,"Enter"))))return;let d=a.state.tr.setSelection(c);"pointer"==b?d.setMeta("pointer",!0):"key"==b&&d.scrollIntoView(),i&&d.setMeta("composition",i),a.dispatch(d)}return}let j=a.state.doc.resolve(b),k=j.sharedDepth(c);b=j.before(k+1),c=a.state.doc.resolve(c).after(k+1);let l=a.state.selection,m=function(a,b,c){let d,{node:e,fromOffset:f,toOffset:g,from:h,to:i}=a.docView.parseRange(b,c),j=a.domSelectionRange(),k=j.anchorNode;if(k&&a.dom.contains(1==k.nodeType?k:k.parentNode)&&(d=[{node:k,offset:j.anchorOffset}],uB(j)||d.push({node:j.focusNode,offset:j.focusOffset})),uN&&8===a.input.lastKeyCode)for(let a=g;a>f;a--){let b=e.childNodes[a-1],c=b.pmViewDesc;if("BR"==b.nodeName&&!c){g=a;break}if(!c||c.size)break}let l=a.state.doc,m=a.someProp("domParser")||th.fromSchema(a.state.schema),n=l.resolve(h),o=null,p=m.parse(e,{topNode:n.parent,topMatch:n.parent.contentMatchAt(n.index()),topOpen:!0,from:f,to:g,preserveWhitespace:"pre"!=n.parent.type.whitespace||"full",findPositions:d,ruleFromNode:wM,context:n});if(d&&null!=d[0].pos){let a=d[0].pos,b=d[1]&&d[1].pos;null==b&&(b=a),o={anchor:a+h,head:b+h}}return{doc:p,sel:o,from:h,to:i}}(a,b,c),n=a.state.doc,o=n.slice(m.from,m.to);8===a.input.lastKeyCode&&Date.now()-100<a.input.lastKeyCodeTime?(f=a.state.selection.to,g="end"):(f=a.state.selection.from,g="start"),a.input.lastKeyCode=null;let p=function(a,b,c,d,e){let f=a.findDiffStart(b,c);if(null==f)return null;let{a:g,b:h}=a.findDiffEnd(b,c+a.size,c+b.size);if("end"==e){let a=Math.max(0,f-Math.min(g,h));d-=g+a-f}if(g<f&&a.size<b.size){let a=d<=f&&d>=g?f-d:0;(f-=a)&&f<b.size&&wQ(b.textBetween(f-1,f+1))&&(f+=a?1:-1),h=f+(h-g),g=f}else if(h<f){let b=d<=f&&d>=h?f-d:0;(f-=b)&&f<a.size&&wQ(a.textBetween(f-1,f+1))&&(f+=b?1:-1),g=f+(g-h),h=f}return{start:f,endA:g,endB:h}}(o.content,m.doc.content,m.from,f,g);if(p&&a.input.domChangeCount++,(uQ&&a.input.lastIOSEnter>Date.now()-225||uT)&&e.some(a=>1==a.nodeType&&!wN.test(a.nodeName))&&(!p||p.endA>=p.endB)&&a.someProp("handleKeyDown",b=>b(a,uC(13,"Enter")))){a.input.lastIOSEnter=0;return}if(!p)if(d&&l instanceof t9&&!l.empty&&l.$head.sameParent(l.$anchor)&&!a.composing&&!(m.sel&&m.sel.anchor!=m.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(m.sel){let b=wO(a,a.state.doc,m.sel);if(b&&!b.eq(a.state.selection)){let c=a.state.tr.setSelection(b);i&&c.setMeta("composition",i),a.dispatch(c)}}return}a.state.selection.from<a.state.selection.to&&p.start==p.endB&&a.state.selection instanceof t9&&(p.start>a.state.selection.from&&p.start<=a.state.selection.from+2&&a.state.selection.from>=m.from?p.start=a.state.selection.from:p.endA<a.state.selection.to&&p.endA>=a.state.selection.to-2&&a.state.selection.to<=m.to&&(p.endB+=a.state.selection.to-p.endA,p.endA=a.state.selection.to)),uJ&&uK<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>m.from&&"  "==m.doc.textBetween(p.start-m.from-1,p.start-m.from+1)&&(p.start--,p.endA--,p.endB--);let q=m.doc.resolveNoCache(p.start-m.from),r=m.doc.resolveNoCache(p.endB-m.from),s=n.resolve(p.start),t=q.sameParent(r)&&q.parent.inlineContent&&s.end()>=p.endA;if((uQ&&a.input.lastIOSEnter>Date.now()-225&&(!t||e.some(a=>"DIV"==a.nodeName||"P"==a.nodeName))||!t&&q.pos<m.doc.content.size&&(!q.sameParent(r)||!q.parent.inlineContent)&&q.pos<r.pos&&!/\S/.test(m.doc.textBetween(q.pos,r.pos,"","")))&&a.someProp("handleKeyDown",b=>b(a,uC(13,"Enter")))){a.input.lastIOSEnter=0;return}if(a.state.selection.anchor>p.start&&function(a,b,c,d,e){if(c-b<=e.pos-d.pos||wP(d,!0,!1)<e.pos)return!1;let f=a.resolve(b);if(!d.parent.isTextblock){let a=f.nodeAfter;return null!=a&&c==b+a.nodeSize}if(f.parentOffset<f.parent.content.size||!f.parent.isTextblock)return!1;let g=a.resolve(wP(f,!0,!0));return!(!g.parent.isTextblock||g.pos>c||wP(g,!0,!1)<c)&&d.parent.content.cut(d.parentOffset).eq(g.parent.content)}(n,p.start,p.endA,q,r)&&a.someProp("handleKeyDown",b=>b(a,uC(8,"Backspace")))){uT&&uN&&a.domObserver.suppressSelectionUpdates();return}uN&&p.endB==p.start&&(a.input.lastChromeDelete=Date.now()),uT&&!t&&q.start()!=r.start()&&0==r.parentOffset&&q.depth==r.depth&&m.sel&&m.sel.anchor==m.sel.head&&m.sel.head==p.endA&&(p.endB-=2,r=m.doc.resolveNoCache(p.endB-m.from),setTimeout(()=>{a.someProp("handleKeyDown",function(b){return b(a,uC(13,"Enter"))})},20));let u=p.start,v=p.endA,w=b=>{let c=b||a.state.tr.replace(u,v,m.doc.slice(p.start-m.from,p.endB-m.from));if(m.sel){let b=wO(a,c.doc,m.sel);b&&!(uN&&a.composing&&b.empty&&(p.start!=p.endB||a.input.lastChromeDelete<Date.now()-100)&&(b.head==u||b.head==c.mapping.map(v)-1)||uJ&&b.empty&&b.head==u)&&c.setSelection(b)}return i&&c.setMeta("composition",i),c.scrollIntoView()};if(t)if(q.pos==r.pos){uJ&&uK<=11&&0==q.parentOffset&&(a.domObserver.suppressSelectionUpdates(),setTimeout(()=>vw(a),20));let b=w(a.state.tr.delete(u,v)),c=n.resolve(p.start).marksAcross(n.resolve(p.endA));c&&b.ensureMarks(c),a.dispatch(b)}else if(p.endA==p.endB&&(h=function(a,b){let c=a.firstChild.marks,d=b.firstChild.marks,e=c,f=d,g,h,i;for(let a=0;a<d.length;a++)e=d[a].removeFromSet(e);for(let a=0;a<c.length;a++)f=c[a].removeFromSet(f);if(1==e.length&&0==f.length)h=e[0],g="add",i=a=>a.mark(h.addToSet(a.marks));else{if(0!=e.length||1!=f.length)return null;h=f[0],g="remove",i=a=>a.mark(h.removeFromSet(a.marks))}let j=[];for(let a=0;a<b.childCount;a++)j.push(i(b.child(a)));if(sJ.from(j).eq(a))return{mark:h,type:g}}(q.parent.content.cut(q.parentOffset,r.parentOffset),s.parent.content.cut(s.parentOffset,p.endA-s.start())))){let b=w(a.state.tr);"add"==h.type?b.addMark(u,v,h.mark):b.removeMark(u,v,h.mark),a.dispatch(b)}else if(q.parent.child(q.index()).isText&&q.index()==r.index()-!r.textOffset){let b=q.parent.textBetween(q.parentOffset,r.parentOffset),c=()=>w(a.state.tr.insertText(b,u,v));a.someProp("handleTextInput",d=>d(a,u,v,b,c))||a.dispatch(c())}else a.dispatch(w());else a.dispatch(w())})(this,a,b,c,d)),this.domObserver.start(),function(a){for(let b in v0){let c=v0[b];a.dom.addEventListener(b,a.input.eventHandlers[b]=b=>{!function(a,b){if(!b.bubbles)return!0;if(b.defaultPrevented)return!1;for(let c=b.target;c!=a.dom;c=c.parentNode)if(!c||11==c.nodeType||c.pmViewDesc&&c.pmViewDesc.stopEvent(b))return!1;return!0}(a,b)||v6(a,b)||!a.editable&&b.type in v1||c(a,b)},v2[b]?{passive:!0}:void 0)}uP&&a.dom.addEventListener("input",()=>null),v5(a)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let a=this._props;for(let b in this._props={},a)this._props[b]=a[b];this._props.state=this.state}return this._props}update(a){a.handleDOMEvents!=this._props.handleDOMEvents&&v5(this);let b=this._props;this._props=a,a.plugins&&(a.plugins.forEach(wW),this.directPlugins=a.plugins),this.updateStateInner(a.state,b)}setProps(a){let b={};for(let a in this._props)b[a]=this._props[a];for(let c in b.state=this.state,a)b[c]=a[c];this.update(b)}updateState(a){this.updateStateInner(a,this._props)}updateStateInner(a,b){var c,d,e;let f=this.state,g=!1,h=!1;a.storedMarks&&this.composing&&(wf(this),h=!0),this.state=a;let i=f.plugins!=a.plugins||this._props.plugins!=b.plugins;if(i||this._props.plugins!=b.plugins||this._props.nodeViews!=b.nodeViews){let a=wV(this);(function(a,b){let c=0,d=0;for(let d in a){if(a[d]!=b[d])return!0;c++}for(let a in b)d++;return c!=d})(a,this.nodeViews)&&(this.nodeViews=a,g=!0)}(i||b.handleDOMEvents!=this._props.handleDOMEvents)&&v5(this),this.editable=wU(this),wT(this);let j=wE(this),k=wS(this),l=f.plugins==a.plugins||f.doc.eq(a.doc)?a.scrollToSelection>f.scrollToSelection?"to selection":"preserve":"reset",m=g||!this.docView.matchesNode(a.doc,k,j);(m||!a.selection.eq(f.selection))&&(h=!0);let n="preserve"==l&&h&&null==this.dom.style.overflowAnchor&&function(a){let b,c,d=a.dom.getBoundingClientRect(),e=Math.max(0,d.top);for(let f=(d.left+d.right)/2,g=e+1;g<Math.min(innerHeight,d.bottom);g+=5){let d=a.root.elementFromPoint(f,g);if(!d||d==a.dom||!a.dom.contains(d))continue;let h=d.getBoundingClientRect();if(h.top>=e-20){b=d,c=h.top;break}}return{refDOM:b,refTop:c,stack:uY(a.dom)}}(this);if(h){let b,c,h;this.domObserver.stop();let i=m&&(uJ||uN)&&!this.composing&&!f.selection.empty&&!a.selection.empty&&(d=f.selection,e=a.selection,h=Math.min(d.$anchor.sharedDepth(d.head),e.$anchor.sharedDepth(e.head)),d.$anchor.start(h)!=e.$anchor.start(h));if(m){let b=uN?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=function(a){let b=a.domSelectionRange();if(!b.focusNode)return null;let c=function(a,b){for(;;){if(3==a.nodeType&&b)return a;if(1==a.nodeType&&b>0){if("false"==a.contentEditable)return null;b=uz(a=a.childNodes[b-1])}else{if(!a.parentNode||uA(a))return null;b=ur(a),a=a.parentNode}}}(b.focusNode,b.focusOffset),d=function(a,b){for(;;){if(3==a.nodeType&&b<a.nodeValue.length)return a;if(1==a.nodeType&&b<a.childNodes.length){if("false"==a.contentEditable)return null;a=a.childNodes[b],b=0}else{if(!a.parentNode||uA(a))return null;b=ur(a)+1,a=a.parentNode}}}(b.focusNode,b.focusOffset);if(c&&d&&c!=d){let b=d.pmViewDesc,e=a.domObserver.lastChangedTextNode;if(c==e||d==e)return e;if(!b||!b.isText(d.nodeValue))return d;if(a.input.compositionNode==d){let a=c.pmViewDesc;if(!(!a||!a.isText(c.nodeValue)))return d}}return c||d}(this)),(g||!this.docView.update(a.doc,k,j,this))&&(this.docView.updateOuterDeco(k),this.docView.destroy(),this.docView=vg(a.doc,k,j,this.dom,this)),b&&!this.trackWrites&&(i=!0)}i||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&(b=this.docView.domFromPos(this.state.selection.anchor,0),c=this.domSelectionRange(),uw(b.node,b.offset,c.anchorNode,c.anchorOffset)))?vw(this,i):(vB(this,a.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(f),(null==(c=this.dragging)?void 0:c.node)&&!f.doc.eq(a.doc)&&this.updateDraggedNode(this.dragging,f),"reset"==l?this.dom.scrollTop=0:"to selection"==l?this.scrollToSelection():n&&function({refDOM:a,refTop:b,stack:c}){let d=a?a.getBoundingClientRect().top:0;uZ(c,0==d?0:d-b)}(n)}scrollToSelection(){let a=this.domSelectionRange().focusNode;if(a&&this.dom.contains(1==a.nodeType?a:a.parentNode))if(this.someProp("handleScrollToSelection",a=>a(this)));else if(this.state.selection instanceof ub){let b=this.docView.domAfterPos(this.state.selection.from);1==b.nodeType&&uX(this,b.getBoundingClientRect(),a)}else uX(this,this.coordsAtPos(this.state.selection.head,1),a)}destroyPluginViews(){let a;for(;a=this.pluginViews.pop();)a.destroy&&a.destroy()}updatePluginViews(a){if(a&&a.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let b=0;b<this.pluginViews.length;b++){let c=this.pluginViews[b];c.update&&c.update(this,a)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let a=0;a<this.directPlugins.length;a++){let b=this.directPlugins[a];b.spec.view&&this.pluginViews.push(b.spec.view(this))}for(let a=0;a<this.state.plugins.length;a++){let b=this.state.plugins[a];b.spec.view&&this.pluginViews.push(b.spec.view(this))}}}updateDraggedNode(a,b){let c=a.node,d=-1;if(this.state.doc.nodeAt(c.from)==c.node)d=c.from;else{let a=c.from+(this.state.doc.content.size-b.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==c.node&&(d=a)}this.dragging=new wk(a.slice,a.move,d<0?void 0:ub.create(this.state.doc,d))}someProp(a,b){let c=this._props&&this._props[a],d;if(null!=c&&(d=b?b(c):c))return d;for(let c=0;c<this.directPlugins.length;c++){let e=this.directPlugins[c].props[a];if(null!=e&&(d=b?b(e):e))return d}let e=this.state.plugins;if(e)for(let c=0;c<e.length;c++){let f=e[c].props[a];if(null!=f&&(d=b?b(f):f))return d}}hasFocus(){if(uJ){let a=this.root.activeElement;if(a==this.dom)return!0;if(!a||!this.dom.contains(a))return!1;for(;a&&this.dom!=a&&this.dom.contains(a);){if("false"==a.contentEditable)return!1;a=a.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(a){if(a.setActive)return a.setActive();if(u$)return a.focus(u$);let b=uY(a);a.focus(null==u$?{get preventScroll(){return u$={preventScroll:!0},!0}}:void 0),u$||(u$=!1,uZ(b,0))}(this.dom),vw(this),this.domObserver.start()}get root(){let a=this._root;if(null==a){for(let a=this.dom.parentNode;a;a=a.parentNode)if(9==a.nodeType||11==a.nodeType&&a.host)return a.getSelection||(Object.getPrototypeOf(a).getSelection=()=>a.ownerDocument.getSelection()),this._root=a}return a||document}updateRoot(){this._root=null}posAtCoords(a){return function(a,b){var c;let d,e,f=a.dom.ownerDocument,g,h=0,i=function(a,b,c){if(a.caretPositionFromPoint)try{let d=a.caretPositionFromPoint(b,c);if(d)return{node:d.offsetNode,offset:Math.min(uz(d.offsetNode),d.offset)}}catch(a){}if(a.caretRangeFromPoint){let d=a.caretRangeFromPoint(b,c);if(d)return{node:d.startContainer,offset:Math.min(uz(d.startContainer),d.startOffset)}}}(f,b.left,b.top);i&&({node:g,offset:h}=i);let j=(a.root.elementFromPoint?a.root:f).elementFromPoint(b.left,b.top);if(!j||!a.dom.contains(1!=j.nodeType?j.parentNode:j)){let c=a.dom.getBoundingClientRect();if(!u_(b,c)||!(j=function a(b,c,d){let e=b.childNodes.length;if(e&&d.top<d.bottom)for(let f=Math.max(0,Math.min(e-1,Math.floor(e*(c.top-d.top)/(d.bottom-d.top))-2)),g=f;;){let d=b.childNodes[g];if(1==d.nodeType){let b=d.getClientRects();for(let e=0;e<b.length;e++){let f=b[e];if(u_(c,f))return a(d,c,f)}}if((g=(g+1)%e)==f)break}return b}(a.dom,b,c)))return null}if(uP)for(let a=j;g&&a;a=us(a))a.draggable&&(g=void 0);if(j=(d=(c=j).parentNode)&&/^li$/i.test(d.nodeName)&&b.left<c.getBoundingClientRect().left?d:c,g){let c;if(uL&&1==g.nodeType&&(h=Math.min(h,g.childNodes.length))<g.childNodes.length){let a=g.childNodes[h],c;"IMG"==a.nodeName&&(c=a.getBoundingClientRect()).right<=b.left&&c.bottom>b.top&&h++}uU&&h&&1==g.nodeType&&1==(c=g.childNodes[h-1]).nodeType&&"false"==c.contentEditable&&c.getBoundingClientRect().top>=b.top&&h--,g==a.dom&&h==g.childNodes.length-1&&1==g.lastChild.nodeType&&b.top>g.lastChild.getBoundingClientRect().bottom?e=a.state.doc.content.size:(0==h||1!=g.nodeType||"BR"!=g.childNodes[h-1].nodeName)&&(e=function(a,b,c,d){let e=-1;for(let c=b,f=!1;c!=a.dom;){let b=a.docView.nearestDesc(c,!0),g;if(!b)return null;if(1==b.dom.nodeType&&(b.node.isBlock&&b.parent||!b.contentDOM)&&((g=b.dom.getBoundingClientRect()).width||g.height)&&(b.node.isBlock&&b.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(b.dom.nodeName)&&(!f&&g.left>d.left||g.top>d.top?e=b.posBefore:(!f&&g.right<d.left||g.bottom<d.top)&&(e=b.posAfter),f=!0),!b.contentDOM&&e<0&&!b.node.isText))return(b.node.isBlock?d.top<(g.top+g.bottom)/2:d.left<(g.left+g.right)/2)?b.posBefore:b.posAfter;c=b.dom.parentNode}return e>-1?e:a.docView.posFromDOM(b,c,-1)}(a,g,h,b))}null==e&&(e=function(a,b,c){let{node:d,offset:e}=function a(b,c){let d,e,f,g=2e8,h,i=0,j=c.top,k=c.top;for(let a=b.firstChild,l=0;a;a=a.nextSibling,l++){let b;if(1==a.nodeType)b=a.getClientRects();else{if(3!=a.nodeType)continue;b=uu(a).getClientRects()}for(let m=0;m<b.length;m++){let n=b[m];if(n.top<=j&&n.bottom>=k){j=Math.max(n.bottom,j),k=Math.min(n.top,k);let b=n.left>c.left?n.left-c.left:n.right<c.left?c.left-n.right:0;if(b<g){f=a,g=b,h=b&&3==f.nodeType?{left:n.right<c.left?n.right:n.left,top:c.top}:c,1==a.nodeType&&b&&(i=l+ +(c.left>=(n.left+n.right)/2));continue}}else n.top>c.top&&!d&&n.left<=c.left&&n.right>=c.left&&(d=a,e={left:Math.max(n.left,Math.min(n.right,c.left)),top:n.top});!f&&(c.left>=n.right&&c.top>=n.top||c.left>=n.left&&c.top>=n.bottom)&&(i=l+1)}}return(!f&&d&&(f=d,h=e,g=0),f&&3==f.nodeType)?function(a,b){let c=a.nodeValue.length,d=document.createRange();for(let e=0;e<c;e++){d.setEnd(a,e+1),d.setStart(a,e);let c=u1(d,1);if(c.top!=c.bottom&&u_(b,c))return{node:a,offset:e+ +(b.left>=(c.left+c.right)/2)}}return{node:a,offset:0}}(f,h):!f||g&&1==f.nodeType?{node:b,offset:i}:a(f,h)}(b,c),f=-1;if(1==d.nodeType&&!d.firstChild){let a=d.getBoundingClientRect();f=a.left!=a.right&&c.left>(a.left+a.right)/2?1:-1}return a.docView.posFromDOM(d,e,f)}(a,j,b));let k=a.docView.nearestDesc(j,!0);return{pos:e,inside:k?k.posAtStart-k.border:-1}}(this,a)}coordsAtPos(a,b=1){return u3(this,a,b)}domAtPos(a,b=0){return this.docView.domFromPos(a,b)}nodeDOM(a){let b=this.docView.descAt(a);return b?b.nodeDOM:null}posAtDOM(a,b,c=-1){let d=this.docView.posFromDOM(a,b,c);if(null==d)throw RangeError("DOM position not inside the editor");return d}endOfTextblock(a,b){return function(a,b,c){let d,e;return u8==b&&u9==c?va:(u8=b,u9=c,va="up"==c||"down"==c?(d=b.selection,e="up"==c?d.$from:d.$to,u6(a,b,()=>{let{node:b}=a.docView.domFromPos(e.pos,"up"==c?-1:1);for(;;){let c=a.docView.nearestDesc(b,!0);if(!c)break;if(c.node.isBlock){b=c.contentDOM||c.dom;break}b=c.dom.parentNode}let d=u3(a,e.pos,1);for(let a=b.firstChild;a;a=a.nextSibling){let b;if(1==a.nodeType)b=a.getClientRects();else{if(3!=a.nodeType)continue;b=uu(a,0,a.nodeValue.length).getClientRects()}for(let a=0;a<b.length;a++){let e=b[a];if(e.bottom>e.top+1&&("up"==c?d.top-e.top>(e.bottom-d.top)*2:e.bottom-d.bottom>(d.bottom-e.top)*2))return!1}}return!0})):function(a,b,c){let{$head:d}=b.selection;if(!d.parent.isTextblock)return!1;let e=d.parentOffset,f=e==d.parent.content.size,g=a.domSelection();return g?u7.test(d.parent.textContent)&&g.modify?u6(a,b,()=>{let{focusNode:b,focusOffset:e,anchorNode:f,anchorOffset:h}=a.domSelectionRange(),i=g.caretBidiLevel;g.modify("move",c,"character");let j=d.depth?a.docView.domAfterPos(d.before()):a.dom,{focusNode:k,focusOffset:l}=a.domSelectionRange(),m=k&&!j.contains(1==k.nodeType?k:k.parentNode)||b==k&&e==l;try{g.collapse(f,h),b&&(b!=f||e!=h)&&g.extend&&g.extend(b,e)}catch(a){}return null!=i&&(g.caretBidiLevel=i),m}):"left"==c||"backward"==c?!e:f:d.pos==d.start()||d.pos==d.end()}(a,b,c))}(this,b||this.state,a)}pasteHTML(a,b){return wi(this,"",a,!1,b||new ClipboardEvent("paste"))}pasteText(a,b){return wi(this,a,null,!0,b||new ClipboardEvent("paste"))}serializeForClipboard(a){return vS(this,a)}destroy(){if(this.docView){for(let a in this.domObserver.stop(),this.input.eventHandlers)this.dom.removeEventListener(a,this.input.eventHandlers[a]);clearTimeout(this.input.composingTimeout),clearTimeout(this.input.lastIOSEnterFallbackTimeout),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],wE(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,uv()}}get isDestroyed(){return null==this.docView}dispatchEvent(a){!v6(this,a)&&v0[a.type]&&(this.editable||!(a.type in v1))&&v0[a.type](this,a)}domSelectionRange(){let a=this.domSelection();return a?uP&&11===this.root.nodeType&&function(a){let b=a.activeElement;for(;b&&b.shadowRoot;)b=b.shadowRoot.activeElement;return b}(this.dom.ownerDocument)==this.dom&&function(a,b){let c;if(b.getComposedRanges){let c=b.getComposedRanges(a.root)[0];if(c)return wL(a,c)}function d(a){a.preventDefault(),a.stopImmediatePropagation(),c=a.getTargetRanges()[0]}return a.dom.addEventListener("beforeinput",d,!0),document.execCommand("indent"),a.dom.removeEventListener("beforeinput",d,!0),c?wL(a,c):null}(this,a)||a:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function wS(a){let b=Object.create(null);return b.class="ProseMirror",b.contenteditable=String(a.editable),a.someProp("attributes",c=>{if("function"==typeof c&&(c=c(a.state)),c)for(let a in c)"class"==a?b.class+=" "+c[a]:"style"==a?b.style=(b.style?b.style+";":"")+c[a]:b[a]||"contenteditable"==a||"nodeName"==a||(b[a]=String(c[a]))}),b.translate||(b.translate="no"),[wr.node(0,a.state.doc.content.size,b)]}function wT(a){if(a.markCursor){let b=document.createElement("img");b.className="ProseMirror-separator",b.setAttribute("mark-placeholder","true"),b.setAttribute("alt",""),a.cursorWrapper={dom:b,deco:wr.widget(a.state.selection.from,b,{raw:!0,marks:a.markCursor})}}else a.cursorWrapper=null}function wU(a){return!a.someProp("editable",b=>!1===b(a.state))}function wV(a){let b=Object.create(null);function c(a){for(let c in a)Object.prototype.hasOwnProperty.call(b,c)||(b[c]=a[c])}return a.someProp("nodeViews",c),a.someProp("markViews",c),b}function wW(a){if(a.spec.state||a.spec.filterTransaction||a.spec.appendTransaction)throw RangeError("Plugins passed directly to the view must not have a state component")}wR.prototype.dispatch=function(a){let b=this._props.dispatchTransaction;b?b.call(this,a):this.updateState(this.state.apply(a))};for(var wX={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},wY={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},wZ="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),w$="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),w_=0;w_<10;w_++)wX[48+w_]=wX[96+w_]=String(w_);for(var w_=1;w_<=24;w_++)wX[w_+111]="F"+w_;for(var w_=65;w_<=90;w_++)wX[w_]=String.fromCharCode(w_+32),wY[w_]=String.fromCharCode(w_);for(var w0 in wX)wY.hasOwnProperty(w0)||(wY[w0]=wX[w0]);let w1="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),w2="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function w3(a,b,c=!0){return b.altKey&&(a="Alt-"+a),b.ctrlKey&&(a="Ctrl-"+a),b.metaKey&&(a="Meta-"+a),c&&b.shiftKey&&(a="Shift-"+a),a}function w4(a){return new un({props:{handleKeyDown:w5(a)}})}function w5(a){let b=function(a){let b=Object.create(null);for(let c in a)b[function(a){let b,c,d,e,f=a.split(/-(?!$)/),g=f[f.length-1];"Space"==g&&(g=" ");for(let a=0;a<f.length-1;a++){let g=f[a];if(/^(cmd|meta|m)$/i.test(g))e=!0;else if(/^a(lt)?$/i.test(g))b=!0;else if(/^(c|ctrl|control)$/i.test(g))c=!0;else if(/^s(hift)?$/i.test(g))d=!0;else if(/^mod$/i.test(g))w1?e=!0:c=!0;else throw Error("Unrecognized modifier name: "+g)}return b&&(g="Alt-"+g),c&&(g="Ctrl-"+g),e&&(g="Meta-"+g),d&&(g="Shift-"+g),g}(c)]=a[c];return b}(a);return function(a,c){var d;let e=("Esc"==(d=!(wZ&&c.metaKey&&c.shiftKey&&!c.ctrlKey&&!c.altKey||w$&&c.shiftKey&&c.key&&1==c.key.length||"Unidentified"==c.key)&&c.key||(c.shiftKey?wY:wX)[c.keyCode]||c.key||"Unidentified")&&(d="Escape"),"Del"==d&&(d="Delete"),"Left"==d&&(d="ArrowLeft"),"Up"==d&&(d="ArrowUp"),"Right"==d&&(d="ArrowRight"),"Down"==d&&(d="ArrowDown"),d),f,g=b[w3(e,c)];if(g&&g(a.state,a.dispatch,a))return!0;if(1==e.length&&" "!=e){if(c.shiftKey){let d=b[w3(e,c,!1)];if(d&&d(a.state,a.dispatch,a))return!0}if((c.altKey||c.metaKey||c.ctrlKey)&&!(w2&&c.ctrlKey&&c.altKey)&&(f=wX[c.keyCode])&&f!=e){let d=b[w3(f,c)];if(d&&d(a.state,a.dispatch,a))return!0}}return!1}}let w6=(a,b)=>!a.selection.empty&&(b&&b(a.tr.deleteSelection().scrollIntoView()),!0);function w7(a,b){let{$cursor:c}=a.selection;return c&&(b?b.endOfTextblock("backward",a):!(c.parentOffset>0))?c:null}let w8=(a,b,c)=>{let d=w7(a,c);if(!d)return!1;let e=xe(d);if(!e){let c=d.blockRange(),e=c&&tK(c);return null!=e&&(b&&b(a.tr.lift(c,e).scrollIntoView()),!0)}let f=e.nodeBefore;if(xs(a,e,b,-1))return!0;if(0==d.parent.content.size&&(xc(f,"end")||ub.isSelectable(f)))for(let c=d.depth;;c--){let g=tU(a.doc,d.before(c),d.after(c),sP.empty);if(g&&g.slice.size<g.to-g.from){if(b){let c=a.tr.step(g);c.setSelection(xc(f,"end")?t5.findFrom(c.doc.resolve(c.mapping.map(e.pos,-1)),-1):ub.create(c.doc,e.pos-f.nodeSize)),b(c.scrollIntoView())}return!0}if(1==c||d.node(c-1).childCount>1)break}return!!f.isAtom&&e.depth==d.depth-1&&(b&&b(a.tr.delete(e.pos-f.nodeSize,e.pos).scrollIntoView()),!0)},w9=(a,b,c)=>{let d=w7(a,c);if(!d)return!1;let e=xe(d);return!!e&&xb(a,e,b)},xa=(a,b,c)=>{let d=xf(a,c);if(!d)return!1;let e=xi(d);return!!e&&xb(a,e,b)};function xb(a,b,c){let d=b.nodeBefore,e=b.pos-1;for(;!d.isTextblock;e--){if(d.type.spec.isolating)return!1;let a=d.lastChild;if(!a)return!1;d=a}let f=b.nodeAfter,g=b.pos+1;for(;!f.isTextblock;g++){if(f.type.spec.isolating)return!1;let a=f.firstChild;if(!a)return!1;f=a}let h=tU(a.doc,e,g,sP.empty);if(!h||h.from!=e||h instanceof tG&&h.slice.size>=g-e)return!1;if(c){let b=a.tr.step(h);b.setSelection(t9.create(b.doc,e)),c(b.scrollIntoView())}return!0}function xc(a,b,c=!1){for(let d=a;d;d="start"==b?d.firstChild:d.lastChild){if(d.isTextblock)return!0;if(c&&1!=d.childCount)break}return!1}let xd=(a,b,c)=>{let{$head:d,empty:e}=a.selection,f=d;if(!e)return!1;if(d.parent.isTextblock){if(c?!c.endOfTextblock("backward",a):d.parentOffset>0)return!1;f=xe(d)}let g=f&&f.nodeBefore;return!!g&&!!ub.isSelectable(g)&&(b&&b(a.tr.setSelection(ub.create(a.doc,f.pos-g.nodeSize)).scrollIntoView()),!0)};function xe(a){if(!a.parent.type.spec.isolating)for(let b=a.depth-1;b>=0;b--){if(a.index(b)>0)return a.doc.resolve(a.before(b+1));if(a.node(b).type.spec.isolating)break}return null}function xf(a,b){let{$cursor:c}=a.selection;return c&&(b?b.endOfTextblock("forward",a):!(c.parentOffset<c.parent.content.size))?c:null}let xg=(a,b,c)=>{let d=xf(a,c);if(!d)return!1;let e=xi(d);if(!e)return!1;let f=e.nodeAfter;if(xs(a,e,b,1))return!0;if(0==d.parent.content.size&&(xc(f,"start")||ub.isSelectable(f))){let c=tU(a.doc,d.before(),d.after(),sP.empty);if(c&&c.slice.size<c.to-c.from){if(b){let d=a.tr.step(c);d.setSelection(xc(f,"start")?t5.findFrom(d.doc.resolve(d.mapping.map(e.pos)),1):ub.create(d.doc,d.mapping.map(e.pos))),b(d.scrollIntoView())}return!0}}return!!f.isAtom&&e.depth==d.depth-1&&(b&&b(a.tr.delete(e.pos,e.pos+f.nodeSize).scrollIntoView()),!0)},xh=(a,b,c)=>{let{$head:d,empty:e}=a.selection,f=d;if(!e)return!1;if(d.parent.isTextblock){if(c?!c.endOfTextblock("forward",a):d.parentOffset<d.parent.content.size)return!1;f=xi(d)}let g=f&&f.nodeAfter;return!!g&&!!ub.isSelectable(g)&&(b&&b(a.tr.setSelection(ub.create(a.doc,f.pos)).scrollIntoView()),!0)};function xi(a){if(!a.parent.type.spec.isolating)for(let b=a.depth-1;b>=0;b--){let c=a.node(b);if(a.index(b)+1<c.childCount)return a.doc.resolve(a.after(b+1));if(c.type.spec.isolating)break}return null}let xj=(a,b)=>{let c=a.selection,d=c instanceof ub,e;if(d){if(c.node.isTextblock||!tQ(a.doc,c.from))return!1;e=c.from}else if(null==(e=tS(a.doc,c.from,-1)))return!1;if(b){let c=a.tr.join(e);d&&c.setSelection(ub.create(c.doc,e-a.doc.resolve(e).nodeBefore.nodeSize)),b(c.scrollIntoView())}return!0},xk=(a,b)=>{let c=a.selection,d;if(c instanceof ub){if(c.node.isTextblock||!tQ(a.doc,c.to))return!1;d=c.to}else if(null==(d=tS(a.doc,c.to,1)))return!1;return b&&b(a.tr.join(d).scrollIntoView()),!0},xl=(a,b)=>{let{$from:c,$to:d}=a.selection,e=c.blockRange(d),f=e&&tK(e);return null!=f&&(b&&b(a.tr.lift(e,f).scrollIntoView()),!0)},xm=(a,b)=>{let{$head:c,$anchor:d}=a.selection;return!!c.parent.type.spec.code&&!!c.sameParent(d)&&(b&&b(a.tr.insertText("\n").scrollIntoView()),!0)};function xn(a){for(let b=0;b<a.edgeCount;b++){let{type:c}=a.edge(b);if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}let xo=(a,b)=>{let{$head:c,$anchor:d}=a.selection;if(!c.parent.type.spec.code||!c.sameParent(d))return!1;let e=c.node(-1),f=c.indexAfter(-1),g=xn(e.contentMatchAt(f));if(!g||!e.canReplaceWith(f,f,g))return!1;if(b){let d=c.after(),e=a.tr.replaceWith(d,d,g.createAndFill());e.setSelection(t5.near(e.doc.resolve(d),1)),b(e.scrollIntoView())}return!0},xp=(a,b)=>{let c=a.selection,{$from:d,$to:e}=c;if(c instanceof ud||d.parent.inlineContent||e.parent.inlineContent)return!1;let f=xn(e.parent.contentMatchAt(e.indexAfter()));if(!f||!f.isTextblock)return!1;if(b){let c=(!d.parentOffset&&e.index()<e.parent.childCount?d:e).pos,g=a.tr.insert(c,f.createAndFill());g.setSelection(t9.create(g.doc,c+1)),b(g.scrollIntoView())}return!0},xq=(a,b)=>{let{$cursor:c}=a.selection;if(!c||c.parent.content.size)return!1;if(c.depth>1&&c.after()!=c.end(-1)){let d=c.before();if(tP(a.doc,d))return b&&b(a.tr.split(d).scrollIntoView()),!0}let d=c.blockRange(),e=d&&tK(d);return null!=e&&(b&&b(a.tr.lift(d,e).scrollIntoView()),!0)},xr=(a,b)=>{let{$from:c,to:d}=a.selection,e,f=c.sharedDepth(d);return 0!=f&&(e=c.before(f),b&&b(a.tr.setSelection(ub.create(a.doc,e))),!0)};function xs(a,b,c,d){let e,f,g,h=b.nodeBefore,i=b.nodeAfter,j,k,l=h.type.spec.isolating||i.type.spec.isolating;if(!l&&(e=b.nodeBefore,f=b.nodeAfter,g=b.index(),e&&f&&e.type.compatibleContent(f.type)&&(!e.content.size&&b.parent.canReplace(g-1,g)?(c&&c(a.tr.delete(b.pos-e.nodeSize,b.pos).scrollIntoView()),!0):!!b.parent.canReplace(g,g+1)&&!!(f.isTextblock||tQ(a.doc,b.pos))&&(c&&c(a.tr.join(b.pos).scrollIntoView()),!0))))return!0;let m=!l&&b.parent.canReplace(b.index(),b.index()+1);if(m&&(j=(k=h.contentMatchAt(h.childCount)).findWrapping(i.type))&&k.matchType(j[0]||i.type).validEnd){if(c){let d=b.pos+i.nodeSize,e=sJ.empty;for(let a=j.length-1;a>=0;a--)e=sJ.from(j[a].create(null,e));e=sJ.from(h.copy(e));let f=a.tr.step(new tH(b.pos-1,d,b.pos,d,new sP(e,1,0),j.length,!0)),g=f.doc.resolve(d+2*j.length);g.nodeAfter&&g.nodeAfter.type==h.type&&tQ(f.doc,g.pos)&&f.join(g.pos),c(f.scrollIntoView())}return!0}let n=i.type.spec.isolating||d>0&&l?null:t5.findFrom(b,1),o=n&&n.$from.blockRange(n.$to),p=o&&tK(o);if(null!=p&&p>=b.depth)return c&&c(a.tr.lift(o,p).scrollIntoView()),!0;if(m&&xc(i,"start",!0)&&xc(h,"end")){let d=h,e=[];for(;e.push(d),!d.isTextblock;)d=d.lastChild;let f=i,g=1;for(;!f.isTextblock;f=f.firstChild)g++;if(d.canReplace(d.childCount,d.childCount,f.content)){if(c){let d=sJ.empty;for(let a=e.length-1;a>=0;a--)d=sJ.from(e[a].copy(d));c(a.tr.step(new tH(b.pos-e.length,b.pos+i.nodeSize,b.pos+g,b.pos+i.nodeSize-g,new sP(d,e.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function xt(a){return function(b,c){let d=b.selection,e=a<0?d.$from:d.$to,f=e.depth;for(;e.node(f).isInline;){if(!f)return!1;f--}return!!e.node(f).isTextblock&&(c&&c(b.tr.setSelection(t9.create(b.doc,a<0?e.start(f):e.end(f)))),!0)}}let xu=xt(-1),xv=xt(1);function xw(a,b=null){return function(c,d){let{$from:e,$to:f}=c.selection,g=e.blockRange(f),h=g&&tL(g,a,b);return!!h&&(d&&d(c.tr.wrap(g,h).scrollIntoView()),!0)}}function xx(a,b=null){return function(c,d){let e=!1;for(let d=0;d<c.selection.ranges.length&&!e;d++){let{$from:{pos:f},$to:{pos:g}}=c.selection.ranges[d];c.doc.nodesBetween(f,g,(d,f)=>{if(e)return!1;if(!(!d.isTextblock||d.hasMarkup(a,b)))if(d.type==a)e=!0;else{let b=c.doc.resolve(f),d=b.index();e=b.parent.canReplaceWith(d,d+1,a)}})}if(!e)return!1;if(d){let e=c.tr;for(let d=0;d<c.selection.ranges.length;d++){let{$from:{pos:f},$to:{pos:g}}=c.selection.ranges[d];e.setBlockType(f,g,a,b)}d(e.scrollIntoView())}return!0}}function xy(...a){return function(b,c,d){for(let e=0;e<a.length;e++)if(a[e](b,c,d))return!0;return!1}}let xz=xy(w6,w8,xd),xA=xy(w6,xg,xh),xB={Enter:xy(xm,xp,xq,(a,b)=>{let{$from:c,$to:d}=a.selection;if(a.selection instanceof ub&&a.selection.node.isBlock)return!!c.parentOffset&&!!tP(a.doc,c.pos)&&(b&&b(a.tr.split(c.pos).scrollIntoView()),!0);if(!c.depth)return!1;let e=[],f,g,h=!1,i=!1;for(let a=c.depth;;a--){if(c.node(a).isBlock){let b;h=c.end(a)==c.pos+(c.depth-a),i=c.start(a)==c.pos-(c.depth-a),g=xn(c.node(a-1).contentMatchAt(c.indexAfter(a-1)));e.unshift(b||(h&&g?{type:g}:null)),f=a;break}if(1==a)return!1;e.unshift(null)}let j=a.tr;(a.selection instanceof t9||a.selection instanceof ud)&&j.deleteSelection();let k=j.mapping.map(c.pos),l=tP(j.doc,k,e.length,e);if(l||(e[0]=g?{type:g}:null,l=tP(j.doc,k,e.length,e)),!l)return!1;if(j.split(k,e.length,e),!h&&i&&c.node(f).type!=g){let a=j.mapping.map(c.before(f)),b=j.doc.resolve(a);g&&c.node(f-1).canReplaceWith(b.index(),b.index()+1,g)&&j.setNodeMarkup(j.mapping.map(c.before(f)),g)}return b&&b(j.scrollIntoView()),!0}),"Mod-Enter":xo,Backspace:xz,"Mod-Backspace":xz,"Shift-Backspace":xz,Delete:xA,"Mod-Delete":xA,"Mod-a":(a,b)=>(b&&b(a.tr.setSelection(new ud(a.doc))),!0)},xC={"Ctrl-h":xB.Backspace,"Alt-Backspace":xB["Mod-Backspace"],"Ctrl-d":xB.Delete,"Ctrl-Alt-Backspace":xB["Mod-Delete"],"Alt-Delete":xB["Mod-Delete"],"Alt-d":xB["Mod-Delete"],"Ctrl-a":xu,"Ctrl-e":xv};for(let a in xB)xC[a]=xB[a];function xD(a,b=null){return function(c,d){let{$from:e,$to:f}=c.selection,g=e.blockRange(f);if(!g)return!1;let h=d?c.tr:null;return!!function(a,b,c,d=null){let e=!1,f=b,g=b.$from.doc;if(b.depth>=2&&b.$from.node(b.depth-1).type.compatibleContent(c)&&0==b.startIndex){if(0==b.$from.index(b.depth-1))return!1;let a=g.resolve(b.start-2);f=new s$(a,a,b.depth),b.endIndex<b.parent.childCount&&(b=new s$(b.$from,g.resolve(b.$to.end(b.depth)),b.depth)),e=!0}let h=tL(f,c,d,b);return!!h&&(a&&function(a,b,c,d,e){let f=sJ.empty;for(let a=c.length-1;a>=0;a--)f=sJ.from(c[a].type.create(c[a].attrs,f));a.step(new tH(b.start-2*!!d,b.end,b.start,b.end,new sP(f,0,0),c.length,!0));let g=0;for(let a=0;a<c.length;a++)c[a].type==e&&(g=a+1);let h=c.length-g,i=b.start+c.length-2*!!d,j=b.parent;for(let c=b.startIndex,d=b.endIndex,e=!0;c<d;c++,e=!1)!e&&tP(a.doc,i,h)&&(a.split(i,h),i+=2*h),i+=j.child(c).nodeSize}(a,b,h,e,c),!0)}(h,g,a,b)&&(d&&d(h.scrollIntoView()),!0)}}function xE(a){return function(b,c){let{$from:d,$to:e}=b.selection,f=d.blockRange(e,b=>b.childCount>0&&b.firstChild.type==a);return!!f&&(!c||(d.node(f.depth-1).type==a?function(a,b,c,d){let e=a.tr,f=d.end,g=d.$to.end(d.depth);f<g&&(e.step(new tH(f-1,g,f,g,new sP(sJ.from(c.create(null,d.parent.copy())),1,0),1,!0)),d=new s$(e.doc.resolve(d.$from.pos),e.doc.resolve(g),d.depth));let h=tK(d);if(null==h)return!1;e.lift(d,h);let i=e.doc.resolve(e.mapping.map(f,-1)-1);return tQ(e.doc,i.pos)&&i.nodeBefore.type==i.nodeAfter.type&&e.join(i.pos),b(e.scrollIntoView()),!0}(b,c,a,f):function(a,b,c){let d=a.tr,e=c.parent;for(let a=c.end,b=c.endIndex-1,f=c.startIndex;b>f;b--)a-=e.child(b).nodeSize,d.delete(a-1,a+1);let f=d.doc.resolve(c.start),g=f.nodeAfter;if(d.mapping.map(c.end)!=c.start+f.nodeAfter.nodeSize)return!1;let h=0==c.startIndex,i=c.endIndex==e.childCount,j=f.node(-1),k=f.index(-1);if(!j.canReplace(k+ +!h,k+1,g.content.append(i?sJ.empty:sJ.from(e))))return!1;let l=f.pos,m=l+g.nodeSize;return d.step(new tH(l-!!h,m+ +!!i,l+1,m-1,new sP((h?sJ.empty:sJ.from(e.copy(sJ.empty))).append(i?sJ.empty:sJ.from(e.copy(sJ.empty))),+!h,+!i),+!h)),b(d.scrollIntoView()),!0}(b,c,f)))}}function xF(a){return function(b,c){let{$from:d,$to:e}=b.selection,f=d.blockRange(e,b=>b.childCount>0&&b.firstChild.type==a);if(!f)return!1;let g=f.startIndex;if(0==g)return!1;let h=f.parent,i=h.child(g-1);if(i.type!=a)return!1;if(c){let d=i.lastChild&&i.lastChild.type==h.type,e=sJ.from(d?a.create():null),g=new sP(sJ.from(a.create(null,sJ.from(h.type.create(null,e)))),d?3:1,0),j=f.start,k=f.end;c(b.tr.step(new tH(j-(d?3:1),k,j,k,g,1,!0)).scrollIntoView())}return!0}}"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();var xG=Object.defineProperty,xH=(a,b)=>{for(var c in b)xG(a,c,{get:b[c],enumerable:!0})};function xI(a){let{state:b,transaction:c}=a,{selection:d}=c,{doc:e}=c,{storedMarks:f}=c;return{...b,apply:b.apply.bind(b),applyTransaction:b.applyTransaction.bind(b),plugins:b.plugins,schema:b.schema,reconfigure:b.reconfigure.bind(b),toJSON:b.toJSON.bind(b),get storedMarks(){return f},get selection(){return d},get doc(){return e},get tr(){return d=c.selection,e=c.doc,f=c.storedMarks,c}}}var xJ=class{constructor(a){this.editor=a.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=a.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:a,editor:b,state:c}=this,{view:d}=b,{tr:e}=c,f=this.buildProps(e);return Object.fromEntries(Object.entries(a).map(([a,b])=>[a,(...a)=>{let c=b(...a)(f);return e.getMeta("preventDispatch")||this.hasCustomState||d.dispatch(e),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g=[],h=!!a,i=a||e.tr,j=()=>(h||!b||i.getMeta("preventDispatch")||this.hasCustomState||f.dispatch(i),g.every(a=>!0===a)),k={...Object.fromEntries(Object.entries(c).map(([a,c])=>[a,(...a)=>{let d=this.buildProps(i,b),e=c(...a)(d);return g.push(e),k}])),run:j};return k}createCan(a){let{rawCommands:b,state:c}=this,d=a||c.tr,e=this.buildProps(d,!1);return{...Object.fromEntries(Object.entries(b).map(([a,b])=>[a,(...a)=>b(...a)({...e,dispatch:void 0})])),chain:()=>this.createChain(d,!1)}}buildProps(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g={tr:a,editor:d,view:f,state:xI({state:e,transaction:a}),dispatch:b?()=>void 0:void 0,chain:()=>this.createChain(a,b),can:()=>this.createCan(a),get commands(){return Object.fromEntries(Object.entries(c).map(([a,b])=>[a,(...a)=>b(...a)(g)]))}};return g}};function xK(a){throw Error("[tiptap error]: there is no window object available, so this function cannot be used")}function xL(a,b,c){if(a instanceof s0||a instanceof sJ)return a;c={slice:!0,parseOptions:{},...c};let d="object"==typeof a&&null!==a,e="string"==typeof a;if(d)try{if(Array.isArray(a)&&a.length>0)return sJ.fromArray(a.map(a=>b.nodeFromJSON(a)));let d=b.nodeFromJSON(a);return c.errorOnInvalidContent&&d.check(),d}catch(d){if(c.errorOnInvalidContent)throw Error("[tiptap error]: Invalid JSON content",{cause:d});return console.warn("[tiptap warn]: Invalid content.","Passed value:",a,"Error:",d),xL("",b,c)}if(e){if(c.errorOnInvalidContent){let d=!1,e="",f=new tf({topNode:b.spec.topNode,marks:b.spec.marks,nodes:b.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:a=>(d=!0,e="string"==typeof a?a:a.outerHTML,null)}]}})});if(c.slice?th.fromSchema(f).parseSlice(xK(a),c.parseOptions):th.fromSchema(f).parse(xK(a),c.parseOptions),c.errorOnInvalidContent&&d)throw Error("[tiptap error]: Invalid HTML content",{cause:Error(`Invalid element found: ${e}`)})}let d=th.fromSchema(b);return c.slice?d.parseSlice(xK(a),c.parseOptions).content:d.parse(xK(a),c.parseOptions)}return xL("",b,c)}function xM(a){return b=>(function(a,b){for(let c=a.depth;c>0;c-=1){let d=a.node(c);if(b(d))return{pos:c>0?a.before(c):0,start:a.start(c),depth:c,node:d}}})(b.$from,a)}function xN(a,b,c){return void 0===a.config[b]&&a.parent?xN(a.parent,b,c):"function"==typeof a.config[b]?a.config[b].bind({...c,parent:a.parent?xN(a.parent,b,c):null}):a.config[b]}function xO(a){return a.map(a=>{let b={name:a.name,options:a.options,storage:a.storage},c=xN(a,"addExtensions",b);return c?[a,...xO(c())]:a}).flat(10)}function xP(a,b){let c=tq.fromSchema(b).serializeFragment(a),d=document.implementation.createHTMLDocument().createElement("div");return d.appendChild(c),d.innerHTML}function xQ(a,b,...c){return"function"==typeof a?b?a.bind(b)(...c):a(...c):a}function xR(a){let b=a.filter(a=>"extension"===a.type);return{baseExtensions:b,nodeExtensions:a.filter(a=>"node"===a.type),markExtensions:a.filter(a=>"mark"===a.type)}}function xS(a){let b=[],{nodeExtensions:c,markExtensions:d}=xR(a),e=[...c,...d],f={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return a.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage,extensions:e},d=xN(a,"addGlobalAttributes",c);d&&d().forEach(a=>{a.types.forEach(c=>{Object.entries(a.attributes).forEach(([a,d])=>{b.push({type:c,name:a,attribute:{...f,...d}})})})})}),e.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage},d=xN(a,"addAttributes",c);d&&Object.entries(d()).forEach(([c,d])=>{let e={...f,...d};"function"==typeof(null==e?void 0:e.default)&&(e.default=e.default()),(null==e?void 0:e.isRequired)&&(null==e?void 0:e.default)===void 0&&delete e.default,b.push({type:a.name,name:c,attribute:e})})}),b}function xT(a,b){return b.filter(b=>b.type===a.type.name).filter(a=>a.attribute.rendered).map(b=>b.attribute.renderHTML?b.attribute.renderHTML(a.attrs)||{}:{[b.name]:a.attrs[b.name]}).reduce((a,b)=>(function(...a){return a.filter(a=>!!a).reduce((a,b)=>{let c={...a};return Object.entries(b).forEach(([a,b])=>{if(!c[a]){c[a]=b;return}if("class"===a){let d=b?String(b).split(" "):[],e=c[a]?c[a].split(" "):[],f=d.filter(a=>!e.includes(a));c[a]=[...e,...f].join(" ")}else if("style"===a){let d=b?b.split(";").map(a=>a.trim()).filter(Boolean):[],e=c[a]?c[a].split(";").map(a=>a.trim()).filter(Boolean):[],f=new Map;e.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),d.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),c[a]=Array.from(f.entries()).map(([a,b])=>`${a}: ${b}`).join("; ")}else c[a]=b}),c},{})})(a,b),{})}function xU(a,b){return"style"in a?a:{...a,getAttrs:c=>{let d=a.getAttrs?a.getAttrs(c):a.attrs;if(!1===d)return!1;let e=b.reduce((a,b)=>{var d;let e=b.attribute.parseHTML?b.attribute.parseHTML(c):"string"!=typeof(d=c.getAttribute(b.name))?d:d.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(d):"true"===d||"false"!==d&&d;return null==e?a:{...a,[b.name]:e}},{});return{...d,...e}}}}function xV(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>!("attrs"===a&&function(a={}){return 0===Object.keys(a).length&&a.constructor===Object}(b))&&null!=b))}function xW(a,b){var c;let d=xS(a),{nodeExtensions:e,markExtensions:f}=xR(a),g=null==(c=e.find(a=>xN(a,"topNode")))?void 0:c.name;return new tf({topNode:g,nodes:Object.fromEntries(e.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=xV({...a.reduce((a,b)=>{let d=xN(b,"extendNodeSchema",f);return{...a,...d?d(c):{}}},{}),content:xQ(xN(c,"content",f)),marks:xQ(xN(c,"marks",f)),group:xQ(xN(c,"group",f)),inline:xQ(xN(c,"inline",f)),atom:xQ(xN(c,"atom",f)),selectable:xQ(xN(c,"selectable",f)),draggable:xQ(xN(c,"draggable",f)),code:xQ(xN(c,"code",f)),whitespace:xQ(xN(c,"whitespace",f)),linebreakReplacement:xQ(xN(c,"linebreakReplacement",f)),defining:xQ(xN(c,"defining",f)),isolating:xQ(xN(c,"isolating",f)),attrs:Object.fromEntries(e.map(a=>{var b,c;return[a.name,{default:null==(b=null==a?void 0:a.attribute)?void 0:b.default,validate:null==(c=null==a?void 0:a.attribute)?void 0:c.validate}]}))}),h=xQ(xN(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>xU(a,e)));let i=xN(c,"renderHTML",f);i&&(g.toDOM=a=>i({node:a,HTMLAttributes:xT(a,e)}));let j=xN(c,"renderText",f);return j&&(g.toText=j),[c.name,g]})),marks:Object.fromEntries(f.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=xV({...a.reduce((a,b)=>{let d=xN(b,"extendMarkSchema",f);return{...a,...d?d(c):{}}},{}),inclusive:xQ(xN(c,"inclusive",f)),excludes:xQ(xN(c,"excludes",f)),group:xQ(xN(c,"group",f)),spanning:xQ(xN(c,"spanning",f)),code:xQ(xN(c,"code",f)),attrs:Object.fromEntries(e.map(a=>{var b,c;return[a.name,{default:null==(b=null==a?void 0:a.attribute)?void 0:b.default,validate:null==(c=null==a?void 0:a.attribute)?void 0:c.validate}]}))}),h=xQ(xN(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>xU(a,e)));let i=xN(c,"renderHTML",f);return i&&(g.toDOM=a=>i({mark:a,HTMLAttributes:xT(a,e)})),[c.name,g]}))})}function xX(a){return a.sort((a,b)=>{let c=xN(a,"priority")||100,d=xN(b,"priority")||100;return c>d?-1:+(c<d)})}function xY(a){var b;let c=xX(xO(a)),d=Array.from(new Set((b=c.map(a=>a.name)).filter((a,c)=>b.indexOf(a)!==c)));return d.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${d.map(a=>`'${a}'`).join(", ")}]. This can lead to issues.`),c}function xZ(a,b){if("string"==typeof a){if(!b.marks[a])throw Error(`There is no mark type named '${a}'. Maybe you forgot to add the extension?`);return b.marks[a]}return a}function x$(a,b){if("string"==typeof a){if(!b.nodes[a])throw Error(`There is no node type named '${a}'. Maybe you forgot to add the extension?`);return b.nodes[a]}return a}function x_(a,b){return b.nodes[a]?"node":b.marks[a]?"mark":null}function x0(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function x1(a,b,c={strict:!0}){let d=Object.keys(b);return!d.length||d.every(d=>c.strict?b[d]===a[d]:x0(b[d])?b[d].test(a[d]):b[d]===a[d])}function x2(a,b,c={}){return a.find(a=>a.type===b&&x1(Object.fromEntries(Object.keys(c).map(b=>[b,a.attrs[b]])),c))}function x3(a,b,c={}){return!!x2(a,b,c)}function x4(a,b,c){var d;if(!a||!b)return;let e=a.parent.childAfter(a.parentOffset);if(e.node&&e.node.marks.some(a=>a.type===b)||(e=a.parent.childBefore(a.parentOffset)),!e.node||!e.node.marks.some(a=>a.type===b)||(c=c||(null==(d=e.node.marks[0])?void 0:d.attrs),!x2([...e.node.marks],b,c)))return;let f=e.index,g=a.start()+e.offset,h=f+1,i=g+e.node.nodeSize;for(;f>0&&x3([...a.parent.child(f-1).marks],b,c);)f-=1,g-=a.parent.child(f).nodeSize;for(;h<a.parent.childCount&&x3([...a.parent.child(h).marks],b,c);)i+=a.parent.child(h).nodeSize,h+=1;return{from:g,to:i}}function x5(a,b){return b.nodes[a]||b.marks[a]||null}function x6(a,b,c){return Object.fromEntries(Object.entries(c).filter(([c])=>{let d=a.find(a=>a.type===b&&a.name===c);return!!d&&d.attribute.keepOnSplit}))}function x7(a,b,c={}){let{from:d,to:e,empty:f}=a.selection,g=b?x$(b,a.schema):null,h=[];a.doc.nodesBetween(d,e,(a,b)=>{if(a.isText)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);h.push({node:a,from:c,to:f})});let i=e-d,j=h.filter(a=>!g||g.name===a.node.type.name).filter(a=>x1(a.node.attrs,c,{strict:!1}));return f?!!j.length:j.reduce((a,b)=>a+b.to-b.from,0)>=i}function x8(a,b){return Array.isArray(b)?b.some(b=>("string"==typeof b?b:b.name)===a.name):b}function x9(a,b){let{nodeExtensions:c}=xR(b),d=c.find(b=>b.name===a);if(!d)return!1;let e={name:d.name,options:d.options,storage:d.storage},f=xQ(xN(d,"group",e));return"string"==typeof f&&f.split(" ").includes("list")}function ya(a){return a instanceof t9}function yb(a=0,b=0,c=0){return Math.min(Math.max(a,b),c)}function yc(a){var b;let{editor:c,from:d,to:e,text:f,rules:g,plugin:h}=a,{view:i}=c;if(i.composing)return!1;let j=i.state.doc.resolve(d);if(j.parent.type.spec.code||(null==(b=j.nodeBefore||j.nodeAfter)?void 0:b.marks.find(a=>a.type.spec.code)))return!1;let k=!1,l=((a,b=500)=>{let c="",d=a.parentOffset;return a.parent.nodesBetween(Math.max(0,d-b),d,(a,b,e,f)=>{var g,h;let i=(null==(h=(g=a.type.spec).toText)?void 0:h.call(g,{node:a,pos:b,parent:e,index:f}))||a.textContent||"%leaf%";c+=a.isAtom&&!a.isText?i:i.slice(0,Math.max(0,d-b))}),c})(j)+f;return g.forEach(a=>{if(k)return;let b=((a,b)=>{if(x0(b))return b.exec(a);let c=b(a);if(!c)return null;let d=[c.text];return d.index=c.index,d.input=a,d.data=c.data,c.replaceWith&&(c.text.includes(c.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),d.push(c.replaceWith)),d})(l,a.find);if(!b)return;let g=i.state.tr,j=xI({state:i.state,transaction:g}),m={from:d-(b[0].length-f.length),to:e},{commands:n,chain:o,can:p}=new xJ({editor:c,state:j});null!==a.handler({state:j,range:m,match:b,commands:n,chain:o,can:p})&&g.steps.length&&(a.undoable&&g.setMeta(h,{transform:g,from:d,to:e,text:f}),i.dispatch(g),k=!0)}),k}function yd(a){return"Object"===Object.prototype.toString.call(a).slice(8,-1)&&a.constructor===Object&&Object.getPrototypeOf(a)===Object.prototype}var ye=class{constructor(a={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...a},this.name=this.config.name}get options(){return{...xQ(xN(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...xQ(xN(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(a={}){let b=this.extend({...this.config,addOptions:()=>(function a(b,c){let d={...b};return yd(b)&&yd(c)&&Object.keys(c).forEach(e=>{yd(c[e])&&yd(b[e])?d[e]=a(b[e],c[e]):d[e]=c[e]}),d})(this.options,a)});return b.name=this.name,b.parent=this.parent,b}extend(a={}){let b=new this.constructor({...this.config,...a});return b.parent=this,this.child=b,b.name="name"in a?a.name:b.parent.name,b}},yf=class a extends ye{constructor(){super(...arguments),this.type="mark"}static create(b={}){return new a("function"==typeof b?b():b)}static handleExit({editor:a,mark:b}){let{tr:c}=a.state,d=a.state.selection.$from;if(d.pos===d.end()){let e=d.marks();if(!e.find(a=>(null==a?void 0:a.type.name)===b.name))return!1;let f=e.find(a=>(null==a?void 0:a.type.name)===b.name);return f&&c.removeStoredMark(f),c.insertText(" ",d.pos),a.view.dispatch(c),!0}return!1}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},yg=null,yh=class{constructor(a,b){this.splittableMarks=[],this.editor=b,this.extensions=xY(a),this.schema=xW(this.extensions,b),this.setupExtensions()}get commands(){return this.extensions.reduce((a,b)=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:this.editor,type:x5(b.name,this.schema)},d=xN(b,"addCommands",c);return d?{...a,...d()}:a},{})}get plugins(){let{editor:a}=this;return xX([...this.extensions].reverse()).flatMap(b=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:x5(b.name,this.schema)},d=[],e=xN(b,"addKeyboardShortcuts",c),f={};if("mark"===b.type&&xN(b,"exitable",c)&&(f.ArrowRight=()=>yf.handleExit({editor:a,mark:b})),e){let b=Object.fromEntries(Object.entries(e()).map(([b,c])=>[b,()=>c({editor:a})]));f={...f,...b}}let g=w4(f);d.push(g);let h=xN(b,"addInputRules",c);if(x8(b,a.options.enableInputRules)&&h){let b=h();if(b&&b.length){let c=function(a){let{editor:b,rules:c}=a,d=new un({state:{init:()=>null,apply(a,e,f){let g=a.getMeta(d);if(g)return g;let h=a.getMeta("applyInputRules");return h&&setTimeout(()=>{let{text:a}=h;"string"==typeof a||(a=xP(sJ.from(a),f.schema));let{from:e}=h,g=e+a.length;yc({editor:b,from:e,to:g,text:a,rules:c,plugin:d})}),a.selectionSet||a.docChanged?null:e}},props:{handleTextInput:(a,e,f,g)=>yc({editor:b,from:e,to:f,text:g,rules:c,plugin:d}),handleDOMEvents:{compositionend:a=>(setTimeout(()=>{let{$cursor:e}=a.state.selection;e&&yc({editor:b,from:e.pos,to:e.pos,text:"",rules:c,plugin:d})}),!1)},handleKeyDown(a,e){if("Enter"!==e.key)return!1;let{$cursor:f}=a.state.selection;return!!f&&yc({editor:b,from:f.pos,to:f.pos,text:"\n",rules:c,plugin:d})}},isInputRules:!0});return d}({editor:a,rules:b}),e=Array.isArray(c)?c:[c];d.push(...e)}}let i=xN(b,"addPasteRules",c);if(x8(b,a.options.enablePasteRules)&&i){let b=i();if(b&&b.length){let c=function(a){let b,{editor:c,rules:d}=a,e=null,f=!1,g=!1,h="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{b="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{b=null}let i=({state:a,from:d,to:e,rule:f,pasteEvt:g})=>{let i=a.tr;if(function(a){let{editor:b,state:c,from:d,to:e,rule:f,pasteEvent:g,dropEvent:h}=a,{commands:i,chain:j,can:k}=new xJ({editor:b,state:c}),l=[];return c.doc.nodesBetween(d,e,(a,b)=>{var m,n,o,p,q;if((null==(n=null==(m=a.type)?void 0:m.spec)?void 0:n.code)||!(a.isText||a.isTextblock||a.isInline))return;let r=null!=(q=null!=(p=null==(o=a.content)?void 0:o.size)?p:a.nodeSize)?q:0,s=Math.max(d,b),t=Math.min(e,b+r);s>=t||((a,b,c)=>{if(x0(b))return[...a.matchAll(b)];let d=b(a,c);return d?d.map(b=>{let c=[b.text];return c.index=b.index,c.input=a,c.data=b.data,b.replaceWith&&(b.text.includes(b.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),c.push(b.replaceWith)),c}):[]})(a.isText?a.text||"":a.textBetween(s-b,t-b,void 0,"￼"),f.find,g).forEach(a=>{if(void 0===a.index)return;let b=s+a.index+1,d=b+a[0].length,e={from:c.tr.mapping.map(b),to:c.tr.mapping.map(d)},m=f.handler({state:c,range:e,match:a,commands:i,chain:j,can:k,pasteEvent:g,dropEvent:h});l.push(m)})}),l.every(a=>null!==a)}({editor:c,state:xI({state:a,transaction:i}),from:Math.max(d-1,0),to:e.b-1,rule:f,pasteEvent:g,dropEvent:b})&&i.steps.length){try{b="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{b=null}return h="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,i}};return d.map(a=>new un({view(a){let b=b=>{var d;(e=(null==(d=a.dom.parentElement)?void 0:d.contains(b.target))?a.dom.parentElement:null)&&(yg=c)},d=()=>{yg&&(yg=null)};return window.addEventListener("dragstart",b),window.addEventListener("dragend",d),{destroy(){window.removeEventListener("dragstart",b),window.removeEventListener("dragend",d)}}},props:{handleDOMEvents:{drop:(a,c)=>{if(g=e===a.dom.parentElement,b=c,!g){let a=yg;(null==a?void 0:a.isEditable)&&setTimeout(()=>{let b=a.state.selection;b&&a.commands.deleteRange({from:b.from,to:b.to})},10)}return!1},paste:(a,b)=>{var c;let d=null==(c=b.clipboardData)?void 0:c.getData("text/html");return h=b,f=!!(null==d?void 0:d.includes("data-pm-slice")),!1}}},appendTransaction:(b,c,d)=>{let e=b[0],j="paste"===e.getMeta("uiEvent")&&!f,k="drop"===e.getMeta("uiEvent")&&!g,l=e.getMeta("applyPasteRules"),m=!!l;if(!j&&!k&&!m)return;if(m){var n,o;let b,{text:c}=l;"string"==typeof c||(c=xP(sJ.from(c),d.schema));let{from:e}=l,f=e+c.length;return i({rule:a,state:d,from:e,to:{b:f},pasteEvt:(n=c,null==(o=(b=new ClipboardEvent("paste",{clipboardData:new DataTransfer})).clipboardData)||o.setData("text/html",n),b)})}let p=c.doc.content.findDiffStart(d.doc.content),q=c.doc.content.findDiffEnd(d.doc.content);if("number"==typeof p&&q&&p!==q.b)return i({rule:a,state:d,from:p,to:q,pasteEvt:h})}}))}({editor:a,rules:b});d.push(...c)}}let j=xN(b,"addProseMirrorPlugins",c);if(j){let a=j();d.push(...a)}return d})}get attributes(){return xS(this.extensions)}get nodeViews(){let{editor:a}=this,{nodeExtensions:b}=xR(this.extensions);return Object.fromEntries(b.filter(a=>!!xN(a,"addNodeView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:x$(b.name,this.schema)},e=xN(b,"addNodeView",d);return e?[b.name,(d,f,g,h,i)=>{let j=xT(d,c);return e()({node:d,view:f,getPos:g,decorations:h,innerDecorations:i,editor:a,extension:b,HTMLAttributes:j})}]:[]}))}get markViews(){let{editor:a}=this,{markExtensions:b}=xR(this.extensions);return Object.fromEntries(b.filter(a=>!!xN(a,"addMarkView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:xZ(b.name,this.schema)},e=xN(b,"addMarkView",d);return e?[b.name,(d,f,g)=>{let h=xT(d,c);return e()({mark:d,view:f,inline:g,editor:a,extension:b,HTMLAttributes:h,updateAttributes:b=>{!function(a,b,c={}){let{state:d}=b,{doc:e,tr:f}=d;e.descendants((b,d)=>{let e=f.mapping.map(d),g=f.mapping.map(d)+b.nodeSize,h=null;if(b.marks.forEach(b=>{if(b!==a)return!1;h=b}),!h)return;let i=!1;if(Object.keys(c).forEach(a=>{c[a]!==h.attrs[a]&&(i=!0)}),i){let b=a.type.create({...a.attrs,...c});f.removeMark(e,g,a.type),f.addMark(e,g,b)}}),f.docChanged&&b.view.dispatch(f)}(d,a,b)}})}]:[]}))}setupExtensions(){let a=this.extensions;this.editor.extensionStorage=Object.fromEntries(a.map(a=>[a.name,a.storage])),a.forEach(a=>{var b;let c={name:a.name,options:a.options,storage:this.editor.extensionStorage[a.name],editor:this.editor,type:x5(a.name,this.schema)};"mark"===a.type&&(null==(b=xQ(xN(a,"keepOnSplit",c)))||b)&&this.splittableMarks.push(a.name);let d=xN(a,"onBeforeCreate",c),e=xN(a,"onCreate",c),f=xN(a,"onUpdate",c),g=xN(a,"onSelectionUpdate",c),h=xN(a,"onTransaction",c),i=xN(a,"onFocus",c),j=xN(a,"onBlur",c),k=xN(a,"onDestroy",c);d&&this.editor.on("beforeCreate",d),e&&this.editor.on("create",e),f&&this.editor.on("update",f),g&&this.editor.on("selectionUpdate",g),h&&this.editor.on("transaction",h),i&&this.editor.on("focus",i),j&&this.editor.on("blur",j),k&&this.editor.on("destroy",k)})}};yh.resolve=xY,yh.sort=xX,yh.flatten=xO,xH({},{ClipboardTextSerializer:()=>yj,Commands:()=>zl,Delete:()=>zm,Drop:()=>zn,Editable:()=>zo,FocusEvents:()=>zq,Keymap:()=>zr,Paste:()=>zs,Tabindex:()=>zt,focusEventsPluginKey:()=>zp});var yi=class a extends ye{constructor(){super(...arguments),this.type="extension"}static create(b={}){return new a("function"==typeof b?b():b)}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},yj=yi.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new un({key:new uq("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:a}=this,{state:b,schema:c}=a,{doc:d,selection:e}=b,{ranges:f}=e,g=Math.min(...f.map(a=>a.$from.pos)),h=Math.max(...f.map(a=>a.$to.pos)),i=Object.fromEntries(Object.entries(c.nodes).filter(([,a])=>a.spec.toText).map(([a,b])=>[a,b.spec.toText]));return function(a,b,c){let{from:d,to:e}=b,{blockSeparator:f="\n\n",textSerializers:g={}}=c||{},h="";return a.nodesBetween(d,e,(a,c,i,j)=>{var k;a.isBlock&&c>d&&(h+=f);let l=null==g?void 0:g[a.type.name];if(l)return i&&(h+=l({node:a,pos:c,parent:i,index:j,range:b})),!1;a.isText&&(h+=null==(k=null==a?void 0:a.text)?void 0:k.slice(Math.max(d,c)-c,e-c))}),h}(d,{from:g,to:h},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:i})}}})]}}),yk={};xH(yk,{blur:()=>yl,clearContent:()=>ym,clearNodes:()=>yn,command:()=>yo,createParagraphNear:()=>yp,cut:()=>yq,deleteCurrentNode:()=>yr,deleteNode:()=>ys,deleteRange:()=>yt,deleteSelection:()=>yu,enter:()=>yv,exitCode:()=>yw,extendMarkRange:()=>yx,first:()=>yy,focus:()=>yA,forEach:()=>yB,insertContent:()=>yC,insertContentAt:()=>yD,joinBackward:()=>yG,joinDown:()=>yF,joinForward:()=>yH,joinItemBackward:()=>yI,joinItemForward:()=>yJ,joinTextblockBackward:()=>yK,joinTextblockForward:()=>yL,joinUp:()=>yE,keyboardShortcut:()=>yN,lift:()=>yO,liftEmptyBlock:()=>yP,liftListItem:()=>yQ,newlineInCode:()=>yR,resetAttributes:()=>yT,scrollIntoView:()=>yU,selectAll:()=>yV,selectNodeBackward:()=>yW,selectNodeForward:()=>yX,selectParentNode:()=>yY,selectTextblockEnd:()=>yZ,selectTextblockStart:()=>y$,setContent:()=>y_,setMark:()=>y0,setMeta:()=>y1,setNode:()=>y2,setNodeSelection:()=>y3,setTextSelection:()=>y4,sinkListItem:()=>y5,splitBlock:()=>y7,splitListItem:()=>y8,toggleList:()=>zb,toggleMark:()=>zc,toggleNode:()=>zd,toggleWrap:()=>ze,undoInputRule:()=>zf,unsetAllMarks:()=>zg,unsetMark:()=>zh,updateAttributes:()=>zi,wrapIn:()=>zj,wrapInList:()=>zk});var yl=()=>({editor:a,view:b})=>(requestAnimationFrame(()=>{var c;a.isDestroyed||(b.dom.blur(),null==(c=null==window?void 0:window.getSelection())||c.removeAllRanges())}),!0),ym=(a=!0)=>({commands:b})=>b.setContent("",{emitUpdate:a}),yn=()=>({state:a,tr:b,dispatch:c})=>{let{selection:d}=b,{ranges:e}=d;return!c||(e.forEach(({$from:c,$to:d})=>{a.doc.nodesBetween(c.pos,d.pos,(a,c)=>{if(a.type.isText)return;let{doc:d,mapping:e}=b,f=d.resolve(e.map(c)),g=d.resolve(e.map(c+a.nodeSize)),h=f.blockRange(g);if(!h)return;let i=tK(h);if(a.type.isTextblock){let{defaultType:a}=f.parent.contentMatchAt(f.index());b.setNodeMarkup(h.start,a)}(i||0===i)&&b.lift(h,i)})}),!0)},yo=a=>b=>a(b),yp=()=>({state:a,dispatch:b})=>xp(a,b),yq=(a,b)=>({editor:c,tr:d})=>{let{state:e}=c,f=e.doc.slice(a.from,a.to);d.deleteRange(a.from,a.to);let g=d.mapping.map(b);return d.insert(g,f.content),d.setSelection(new t9(d.doc.resolve(Math.max(g-1,0)))),!0},yr=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,d=c.$anchor.node();if(d.content.size>0)return!1;let e=a.selection.$anchor;for(let c=e.depth;c>0;c-=1)if(e.node(c).type===d.type){if(b){let b=e.before(c),d=e.after(c);a.delete(b,d).scrollIntoView()}return!0}return!1},ys=a=>({tr:b,state:c,dispatch:d})=>{let e=x$(a,c.schema),f=b.selection.$anchor;for(let a=f.depth;a>0;a-=1)if(f.node(a).type===e){if(d){let c=f.before(a),d=f.after(a);b.delete(c,d).scrollIntoView()}return!0}return!1},yt=a=>({tr:b,dispatch:c})=>{let{from:d,to:e}=a;return c&&b.delete(d,e),!0},yu=()=>({state:a,dispatch:b})=>w6(a,b),yv=()=>({commands:a})=>a.keyboardShortcut("Enter"),yw=()=>({state:a,dispatch:b})=>xo(a,b),yx=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=xZ(a,d.schema),{doc:g,selection:h}=c,{$from:i,from:j,to:k}=h;if(e){let a=x4(i,f,b);if(a&&a.from<=j&&a.to>=k){let b=t9.create(g,a.from,a.to);c.setSelection(b)}}return!0},yy=a=>b=>{let c="function"==typeof a?a(b):a;for(let a=0;a<c.length;a+=1)if(c[a](b))return!0;return!1};function yz(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var yA=(a=null,b={})=>({editor:c,view:d,tr:e,dispatch:f})=>{b={scrollIntoView:!0,...b};let g=()=>{(yz()||"Android"===navigator.platform||/android/i.test(navigator.userAgent))&&d.dom.focus(),requestAnimationFrame(()=>{!c.isDestroyed&&(d.focus(),(null==b?void 0:b.scrollIntoView)&&c.commands.scrollIntoView())})};if(d.hasFocus()&&null===a||!1===a)return!0;if(f&&null===a&&!ya(c.state.selection))return g(),!0;let h=function(a,b=null){if(!b)return null;let c=t5.atStart(a),d=t5.atEnd(a);if("start"===b||!0===b)return c;if("end"===b)return d;let e=c.from,f=d.to;return"all"===b?t9.create(a,yb(0,e,f),yb(a.content.size,e,f)):t9.create(a,yb(b,e,f),yb(b,e,f))}(e.doc,a)||c.state.selection,i=c.state.selection.eq(h);return f&&(i||e.setSelection(h),i&&e.storedMarks&&e.setStoredMarks(e.storedMarks),g()),!0},yB=(a,b)=>c=>a.every((a,d)=>b(a,{...c,index:d})),yC=(a,b)=>({tr:c,commands:d})=>d.insertContentAt({from:c.selection.from,to:c.selection.to},a,b),yD=(a,b,c)=>({tr:d,dispatch:e,editor:f})=>{var g;if(e){let e,h;c={parseOptions:f.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...c};let i=a=>{f.emit("contentError",{editor:f,error:a,disableCollaboration:()=>{"collaboration"in f.storage&&"object"==typeof f.storage.collaboration&&f.storage.collaboration&&(f.storage.collaboration.isDisabled=!0)}})},j={preserveWhitespace:"full",...c.parseOptions};if(!c.errorOnInvalidContent&&!f.options.enableContentCheck&&f.options.emitContentError)try{xL(b,f.schema,{parseOptions:j,errorOnInvalidContent:!0})}catch(a){i(a)}try{e=xL(b,f.schema,{parseOptions:j,errorOnInvalidContent:null!=(g=c.errorOnInvalidContent)?g:f.options.enableContentCheck})}catch(a){return i(a),!1}let{from:k,to:l}="number"==typeof a?{from:a,to:a}:{from:a.from,to:a.to},m=!0,n=!0;if((!("type"in e)?e:[e]).forEach(a=>{a.check(),m=!!m&&a.isText&&0===a.marks.length,n=!!n&&a.isBlock}),k===l&&n){let{parent:a}=d.doc.resolve(k);!a.isTextblock||a.type.spec.code||a.childCount||(k-=1,l+=1)}if(m){if(Array.isArray(b))h=b.map(a=>a.text||"").join("");else if(b instanceof sJ){let a="";b.forEach(b=>{b.text&&(a+=b.text)}),h=a}else h="object"==typeof b&&b&&b.text?b.text:b;d.insertText(h,k,l)}else{h=e;let a=d.doc.resolve(k),b=a.node(),c=0===a.parentOffset,f=b.isText||b.isTextblock,g=b.content.size>0;c&&f&&g&&(k=Math.max(0,k-1)),d.replaceWith(k,l,h)}c.updateSelection&&function(a,b,c){let d=a.steps.length-1;if(d<b)return;let e=a.steps[d];if(!(e instanceof tG||e instanceof tH))return;let f=a.mapping.maps[d],g=0;f.forEach((a,b,c,d)=>{0===g&&(g=d)}),a.setSelection(t5.near(a.doc.resolve(g),-1))}(d,d.steps.length-1,0),c.applyInputRules&&d.setMeta("applyInputRules",{from:k,text:h}),c.applyPasteRules&&d.setMeta("applyPasteRules",{from:k,text:h})}return!0},yE=()=>({state:a,dispatch:b})=>xj(a,b),yF=()=>({state:a,dispatch:b})=>xk(a,b),yG=()=>({state:a,dispatch:b})=>w8(a,b),yH=()=>({state:a,dispatch:b})=>xg(a,b),yI=()=>({state:a,dispatch:b,tr:c})=>{try{let d=tS(a.doc,a.selection.$from.pos,-1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},yJ=()=>({state:a,dispatch:b,tr:c})=>{try{let d=tS(a.doc,a.selection.$from.pos,1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},yK=()=>({state:a,dispatch:b})=>w9(a,b),yL=()=>({state:a,dispatch:b})=>xa(a,b);function yM(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var yN=a=>({editor:b,view:c,tr:d,dispatch:e})=>{let f=(function(a){let b,c,d,e,f=a.split(/-(?!$)/),g=f[f.length-1];"Space"===g&&(g=" ");for(let a=0;a<f.length-1;a+=1){let g=f[a];if(/^(cmd|meta|m)$/i.test(g))e=!0;else if(/^a(lt)?$/i.test(g))b=!0;else if(/^(c|ctrl|control)$/i.test(g))c=!0;else if(/^s(hift)?$/i.test(g))d=!0;else if(/^mod$/i.test(g))yz()||yM()?e=!0:c=!0;else throw Error(`Unrecognized modifier name: ${g}`)}return b&&(g=`Alt-${g}`),c&&(g=`Ctrl-${g}`),e&&(g=`Meta-${g}`),d&&(g=`Shift-${g}`),g})(a).split(/-(?!$)/),g=f.find(a=>!["Alt","Ctrl","Meta","Shift"].includes(a)),h=new KeyboardEvent("keydown",{key:"Space"===g?" ":g,altKey:f.includes("Alt"),ctrlKey:f.includes("Ctrl"),metaKey:f.includes("Meta"),shiftKey:f.includes("Shift"),bubbles:!0,cancelable:!0}),i=b.captureTransaction(()=>{c.someProp("handleKeyDown",a=>a(c,h))});return null==i||i.steps.forEach(a=>{let b=a.map(d.mapping);b&&e&&d.maybeStep(b)}),!0},yO=(a,b={})=>({state:c,dispatch:d})=>{let e=x$(a,c.schema);return!!x7(c,e,b)&&xl(c,d)},yP=()=>({state:a,dispatch:b})=>xq(a,b),yQ=a=>({state:b,dispatch:c})=>xE(x$(a,b.schema))(b,c),yR=()=>({state:a,dispatch:b})=>xm(a,b);function yS(a,b){let c="string"==typeof b?[b]:b;return Object.keys(a).reduce((b,d)=>(c.includes(d)||(b[d]=a[d]),b),{})}var yT=(a,b)=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=x_("string"==typeof a?a:a.name,d.schema);return!!h&&("node"===h&&(f=x$(a,d.schema)),"mark"===h&&(g=xZ(a,d.schema)),e&&c.selection.ranges.forEach(a=>{d.doc.nodesBetween(a.$from.pos,a.$to.pos,(a,d)=>{f&&f===a.type&&c.setNodeMarkup(d,void 0,yS(a.attrs,b)),g&&a.marks.length&&a.marks.forEach(e=>{g===e.type&&c.addMark(d,d+a.nodeSize,g.create(yS(e.attrs,b)))})})}),!0)},yU=()=>({tr:a,dispatch:b})=>(b&&a.scrollIntoView(),!0),yV=()=>({tr:a,dispatch:b})=>{if(b){let b=new ud(a.doc);a.setSelection(b)}return!0},yW=()=>({state:a,dispatch:b})=>xd(a,b),yX=()=>({state:a,dispatch:b})=>xh(a,b),yY=()=>({state:a,dispatch:b})=>xr(a,b),yZ=()=>({state:a,dispatch:b})=>xv(a,b),y$=()=>({state:a,dispatch:b})=>xu(a,b),y_=(a,{errorOnInvalidContent:b,emitUpdate:c=!0,parseOptions:d={}}={})=>({editor:e,tr:f,dispatch:g,commands:h})=>{let{doc:i}=f;if("full"!==d.preserveWhitespace){let h=function(a,b,c={},d={}){return xL(a,b,{slice:!1,parseOptions:c,errorOnInvalidContent:d.errorOnInvalidContent})}(a,e.schema,d,{errorOnInvalidContent:null!=b?b:e.options.enableContentCheck});return g&&f.replaceWith(0,i.content.size,h).setMeta("preventUpdate",!c),!0}return g&&f.setMeta("preventUpdate",!c),h.insertContentAt({from:0,to:i.content.size},a,{parseOptions:d,errorOnInvalidContent:null!=b?b:e.options.enableContentCheck})},y0=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let{selection:f}=c,{empty:g,ranges:h}=f,i=xZ(a,d.schema);if(e)if(g){let a=function(a,b){let c=xZ(b,a.schema),{from:d,to:e,empty:f}=a.selection,g=[];f?(a.storedMarks&&g.push(...a.storedMarks),g.push(...a.selection.$head.marks())):a.doc.nodesBetween(d,e,a=>{g.push(...a.marks)});let h=g.find(a=>a.type.name===c.name);return h?{...h.attrs}:{}}(d,i);c.addStoredMark(i.create({...a,...b}))}else h.forEach(a=>{let e=a.$from.pos,f=a.$to.pos;d.doc.nodesBetween(e,f,(a,d)=>{let g=Math.max(d,e),h=Math.min(d+a.nodeSize,f);a.marks.find(a=>a.type===i)?a.marks.forEach(a=>{i===a.type&&c.addMark(g,h,i.create({...a.attrs,...b}))}):c.addMark(g,h,i.create(b))})});return function(a,b,c){var d;let{selection:e}=b,f=null;if(ya(e)&&(f=e.$cursor),f){let b=null!=(d=a.storedMarks)?d:f.marks();return f.parent.type.allowsMarkType(c)&&(!!c.isInSet(b)||!b.some(a=>a.type.excludes(c)))}let{ranges:g}=e;return g.some(({$from:b,$to:d})=>{let e=0===b.depth&&a.doc.inlineContent&&a.doc.type.allowsMarkType(c);return a.doc.nodesBetween(b.pos,d.pos,(a,b,d)=>{if(e)return!1;if(a.isInline){let b=!d||d.type.allowsMarkType(c),f=!!c.isInSet(a.marks)||!a.marks.some(a=>a.type.excludes(c));e=b&&f}return!e}),e})}(d,c,i)},y1=(a,b)=>({tr:c})=>(c.setMeta(a,b),!0),y2=(a,b={})=>({state:c,dispatch:d,chain:e})=>{let f,g=x$(a,c.schema);return(c.selection.$anchor.sameParent(c.selection.$head)&&(f=c.selection.$anchor.parent.attrs),g.isTextblock)?e().command(({commands:a})=>!!xx(g,{...f,...b})(c)||a.clearNodes()).command(({state:a})=>xx(g,{...f,...b})(a,d)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},y3=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,d=yb(a,0,c.content.size),e=ub.create(c,d);b.setSelection(e)}return!0},y4=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,{from:d,to:e}="number"==typeof a?{from:a,to:a}:a,f=t9.atStart(c).from,g=t9.atEnd(c).to,h=yb(d,f,g),i=yb(e,f,g),j=t9.create(c,h,i);b.setSelection(j)}return!0},y5=a=>({state:b,dispatch:c})=>xF(x$(a,b.schema))(b,c);function y6(a,b){let c=a.storedMarks||a.selection.$to.parentOffset&&a.selection.$from.marks();if(c){let d=c.filter(a=>null==b?void 0:b.includes(a.type.name));a.tr.ensureMarks(d)}}var y7=({keepMarks:a=!0}={})=>({tr:b,state:c,dispatch:d,editor:e})=>{let{selection:f,doc:g}=b,{$from:h,$to:i}=f,j=x6(e.extensionManager.attributes,h.node().type.name,h.node().attrs);if(f instanceof ub&&f.node.isBlock)return!!h.parentOffset&&!!tP(g,h.pos)&&(d&&(a&&y6(c,e.extensionManager.splittableMarks),b.split(h.pos).scrollIntoView()),!0);if(!h.parent.isBlock)return!1;let k=i.parentOffset===i.parent.content.size,l=0===h.depth?void 0:function(a){for(let b=0;b<a.edgeCount;b+=1){let{type:c}=a.edge(b);if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}(h.node(-1).contentMatchAt(h.indexAfter(-1))),m=k&&l?[{type:l,attrs:j}]:void 0,n=tP(b.doc,b.mapping.map(h.pos),1,m);if(!m&&!n&&tP(b.doc,b.mapping.map(h.pos),1,l?[{type:l}]:void 0)&&(n=!0,m=l?[{type:l,attrs:j}]:void 0),d){if(n&&(f instanceof t9&&b.deleteSelection(),b.split(b.mapping.map(h.pos),1,m),l&&!k&&!h.parentOffset&&h.parent.type!==l)){let a=b.mapping.map(h.before()),c=b.doc.resolve(a);h.node(-1).canReplaceWith(c.index(),c.index()+1,l)&&b.setNodeMarkup(b.mapping.map(h.before()),l)}a&&y6(c,e.extensionManager.splittableMarks),b.scrollIntoView()}return n},y8=(a,b={})=>({tr:c,state:d,dispatch:e,editor:f})=>{var g;let h=x$(a,d.schema),{$from:i,$to:j}=d.selection,k=d.selection.node;if(k&&k.isBlock||i.depth<2||!i.sameParent(j))return!1;let l=i.node(-1);if(l.type!==h)return!1;let m=f.extensionManager.attributes;if(0===i.parent.content.size&&i.node(-1).childCount===i.indexAfter(-1)){if(2===i.depth||i.node(-3).type!==h||i.index(-2)!==i.node(-2).childCount-1)return!1;if(e){let a=sJ.empty,d=i.index(-1)?1:i.index(-2)?2:3;for(let b=i.depth-d;b>=i.depth-3;b-=1)a=sJ.from(i.node(b).copy(a));let e=i.indexAfter(-1)<i.node(-2).childCount?1:i.indexAfter(-2)<i.node(-3).childCount?2:3,f={...x6(m,i.node().type.name,i.node().attrs),...b},j=(null==(g=h.contentMatch.defaultType)?void 0:g.createAndFill(f))||void 0;a=a.append(sJ.from(h.createAndFill(null,j)||void 0));let k=i.before(i.depth-(d-1));c.replace(k,i.after(-e),new sP(a,4-d,0));let l=-1;c.doc.nodesBetween(k,c.doc.content.size,(a,b)=>{if(l>-1)return!1;a.isTextblock&&0===a.content.size&&(l=b+1)}),l>-1&&c.setSelection(t9.near(c.doc.resolve(l))),c.scrollIntoView()}return!0}let n=j.pos===i.end()?l.contentMatchAt(0).defaultType:null,o={...x6(m,l.type.name,l.attrs),...b},p={...x6(m,i.node().type.name,i.node().attrs),...b};c.delete(i.pos,j.pos);let q=n?[{type:h,attrs:o},{type:n,attrs:p}]:[{type:h,attrs:o}];if(!tP(c.doc,i.pos,2))return!1;if(e){let{selection:a,storedMarks:b}=d,{splittableMarks:g}=f.extensionManager,h=b||a.$to.parentOffset&&a.$from.marks();if(c.split(i.pos,2,q).scrollIntoView(),!h||!e)return!0;let j=h.filter(a=>g.includes(a.type.name));c.ensureMarks(j)}return!0},y9=(a,b)=>{let c=xM(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(Math.max(0,c.pos-1)).before(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&tQ(a.doc,c.pos))||(a.join(c.pos),!0)},za=(a,b)=>{let c=xM(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(c.start).after(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&tQ(a.doc,d))||(a.join(d),!0)},zb=(a,b,c,d={})=>({editor:e,tr:f,state:g,dispatch:h,chain:i,commands:j,can:k})=>{let{extensions:l,splittableMarks:m}=e.extensionManager,n=x$(a,g.schema),o=x$(b,g.schema),{selection:p,storedMarks:q}=g,{$from:r,$to:s}=p,t=r.blockRange(s),u=q||p.$to.parentOffset&&p.$from.marks();if(!t)return!1;let v=xM(a=>x9(a.type.name,l))(p);if(t.depth>=1&&v&&t.depth-v.depth<=1){if(v.node.type===n)return j.liftListItem(o);if(x9(v.node.type.name,l)&&n.validContent(v.node.content)&&h)return i().command(()=>(f.setNodeMarkup(v.pos,n),!0)).command(()=>y9(f,n)).command(()=>za(f,n)).run()}return c&&u&&h?i().command(()=>{let a=k().wrapInList(n,d),b=u.filter(a=>m.includes(a.type.name));return f.ensureMarks(b),!!a||j.clearNodes()}).wrapInList(n,d).command(()=>y9(f,n)).command(()=>za(f,n)).run():i().command(()=>!!k().wrapInList(n,d)||j.clearNodes()).wrapInList(n,d).command(()=>y9(f,n)).command(()=>za(f,n)).run()},zc=(a,b={},c={})=>({state:d,commands:e})=>{let{extendEmptyMarkRange:f=!1}=c,g=xZ(a,d.schema);return!function(a,b,c={}){let{empty:d,ranges:e}=a.selection,f=b?xZ(b,a.schema):null;if(d)return!!(a.storedMarks||a.selection.$from.marks()).filter(a=>!f||f.name===a.type.name).find(a=>x1(a.attrs,c,{strict:!1}));let g=0,h=[];if(e.forEach(({$from:b,$to:c})=>{let d=b.pos,e=c.pos;a.doc.nodesBetween(d,e,(a,b)=>{if(!a.isText&&!a.marks.length)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);g+=f-c,h.push(...a.marks.map(a=>({mark:a,from:c,to:f})))})}),0===g)return!1;let i=h.filter(a=>!f||f.name===a.mark.type.name).filter(a=>x1(a.mark.attrs,c,{strict:!1})).reduce((a,b)=>a+b.to-b.from,0),j=h.filter(a=>!f||a.mark.type!==f&&a.mark.type.excludes(f)).reduce((a,b)=>a+b.to-b.from,0);return(i>0?i+j:i)>=g}(d,g,b)?e.setMark(g,b):e.unsetMark(g,{extendEmptyMarkRange:f})},zd=(a,b,c={})=>({state:d,commands:e})=>{let f,g=x$(a,d.schema),h=x$(b,d.schema),i=x7(d,g,c);return(d.selection.$anchor.sameParent(d.selection.$head)&&(f=d.selection.$anchor.parent.attrs),i)?e.setNode(h,f):e.setNode(g,{...f,...c})},ze=(a,b={})=>({state:c,commands:d})=>{let e=x$(a,c.schema);return x7(c,e,b)?d.lift(e):d.wrapIn(e,b)},zf=()=>({state:a,dispatch:b})=>{let c=a.plugins;for(let d=0;d<c.length;d+=1){let e,f=c[d];if(f.spec.isInputRules&&(e=f.getState(a))){if(b){let b=a.tr,c=e.transform;for(let a=c.steps.length-1;a>=0;a-=1)b.step(c.steps[a].invert(c.docs[a]));if(e.text){let c=b.doc.resolve(e.from).marks();b.replaceWith(e.from,e.to,a.schema.text(e.text,c))}else b.delete(e.from,e.to)}return!0}}return!1},zg=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,{empty:d,ranges:e}=c;return!!d||(b&&e.forEach(b=>{a.removeMark(b.$from.pos,b.$to.pos)}),!0)},zh=(a,b={})=>({tr:c,state:d,dispatch:e})=>{var f;let{extendEmptyMarkRange:g=!1}=b,{selection:h}=c,i=xZ(a,d.schema),{$from:j,empty:k,ranges:l}=h;if(!e)return!0;if(k&&g){let{from:a,to:b}=h,d=null==(f=j.marks().find(a=>a.type===i))?void 0:f.attrs,e=x4(j,i,d);e&&(a=e.from,b=e.to),c.removeMark(a,b,i)}else l.forEach(a=>{c.removeMark(a.$from.pos,a.$to.pos,i)});return c.removeStoredMark(i),!0},zi=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=x_("string"==typeof a?a:a.name,d.schema);return!!h&&("node"===h&&(f=x$(a,d.schema)),"mark"===h&&(g=xZ(a,d.schema)),e&&c.selection.ranges.forEach(a=>{let e,h,i,j,k=a.$from.pos,l=a.$to.pos;c.selection.empty?d.doc.nodesBetween(k,l,(a,b)=>{f&&f===a.type&&(i=Math.max(b,k),j=Math.min(b+a.nodeSize,l),e=b,h=a)}):d.doc.nodesBetween(k,l,(a,d)=>{d<k&&f&&f===a.type&&(i=Math.max(d,k),j=Math.min(d+a.nodeSize,l),e=d,h=a),d>=k&&d<=l&&(f&&f===a.type&&c.setNodeMarkup(d,void 0,{...a.attrs,...b}),g&&a.marks.length&&a.marks.forEach(e=>{if(g===e.type){let f=Math.max(d,k),h=Math.min(d+a.nodeSize,l);c.addMark(f,h,g.create({...e.attrs,...b}))}}))}),h&&(void 0!==e&&c.setNodeMarkup(e,void 0,{...h.attrs,...b}),g&&h.marks.length&&h.marks.forEach(a=>{g===a.type&&c.addMark(i,j,g.create({...a.attrs,...b}))}))}),!0)},zj=(a,b={})=>({state:c,dispatch:d})=>xw(x$(a,c.schema),b)(c,d),zk=(a,b={})=>({state:c,dispatch:d})=>xD(x$(a,c.schema),b)(c,d),zl=yi.create({name:"commands",addCommands:()=>({...yk})}),zm=yi.create({name:"delete",onUpdate({transaction:a,appendedTransactions:b}){var c,d,e;let f=()=>{var c,d,e,f,g,h;let i;if(null!=(f=null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.filterTransaction)?void 0:e.call(d,a))?f:a.getMeta("y-sync$"))return;let j=(g=a.before,h=[a,...b],i=new t3(g),h.forEach(a=>{a.steps.forEach(a=>{i.step(a)})}),i);(function(a){let b,{mapping:c,steps:d}=a,e=[];return c.maps.forEach((a,b)=>{let f=[];if(a.ranges.length)a.forEach((a,b)=>{f.push({from:a,to:b})});else{let{from:a,to:c}=d[b];if(void 0===a||void 0===c)return;f.push({from:a,to:c})}f.forEach(({from:a,to:d})=>{let f=c.slice(b).map(a,-1),g=c.slice(b).map(d),h=c.invert().map(f,-1),i=c.invert().map(g);e.push({oldRange:{from:h,to:i},newRange:{from:f,to:g}})})}),1===(b=function(a,b=JSON.stringify){let c={};return a.filter(a=>{let d=b(a);return!Object.prototype.hasOwnProperty.call(c,d)&&(c[d]=!0)})}(e)).length?b:b.filter((a,c)=>!b.filter((a,b)=>b!==c).some(b=>a.oldRange.from>=b.oldRange.from&&a.oldRange.to<=b.oldRange.to&&a.newRange.from>=b.newRange.from&&a.newRange.to<=b.newRange.to))})(j).forEach(b=>{j.mapping.mapResult(b.oldRange.from).deletedAfter&&j.mapping.mapResult(b.oldRange.to).deletedBefore&&j.before.nodesBetween(b.oldRange.from,b.oldRange.to,(c,d)=>{let e=d+c.nodeSize-2,f=b.oldRange.from<=d&&e<=b.oldRange.to;this.editor.emit("delete",{type:"node",node:c,from:d,to:e,newFrom:j.mapping.map(d),newTo:j.mapping.map(e),deletedRange:b.oldRange,newRange:b.newRange,partial:!f,editor:this.editor,transaction:a,combinedTransform:j})})});let k=j.mapping;j.steps.forEach((b,c)=>{var d,e;if(b instanceof tD){let f=k.slice(c).map(b.from,-1),g=k.slice(c).map(b.to),h=k.invert().map(f,-1),i=k.invert().map(g),l=null==(d=j.doc.nodeAt(f-1))?void 0:d.marks.some(a=>a.eq(b.mark)),m=null==(e=j.doc.nodeAt(g))?void 0:e.marks.some(a=>a.eq(b.mark));this.editor.emit("delete",{type:"mark",mark:b.mark,from:b.from,to:b.to,deletedRange:{from:h,to:i},newRange:{from:f,to:g},partial:!!(m||l),editor:this.editor,transaction:a,combinedTransform:j})}})};null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.async)||e?setTimeout(f,0):f()}}),zn=yi.create({name:"drop",addProseMirrorPlugins(){return[new un({key:new uq("tiptapDrop"),props:{handleDrop:(a,b,c,d)=>{this.editor.emit("drop",{editor:this.editor,event:b,slice:c,moved:d})}}})]}}),zo=yi.create({name:"editable",addProseMirrorPlugins(){return[new un({key:new uq("editable"),props:{editable:()=>this.editor.options.editable}})]}}),zp=new uq("focusEvents"),zq=yi.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:a}=this;return[new un({key:zp,props:{handleDOMEvents:{focus:(b,c)=>{a.isFocused=!0;let d=a.state.tr.setMeta("focus",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1},blur:(b,c)=>{a.isFocused=!1;let d=a.state.tr.setMeta("blur",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1}}}})]}}),zr=yi.create({name:"keymap",addKeyboardShortcuts(){let a=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:b})=>{let{selection:c,doc:d}=b,{empty:e,$anchor:f}=c,{pos:g,parent:h}=f,i=f.parent.isTextblock&&g>0?b.doc.resolve(g-1):f,j=i.parent.type.spec.isolating,k=f.pos-f.parentOffset,l=j&&1===i.parent.childCount?k===f.pos:t5.atStart(d).from===g;return!!e&&!!h.type.isTextblock&&!h.textContent.length&&!!l&&(!l||"paragraph"!==f.parent.type.name)&&a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),b=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),c={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:a,"Mod-Backspace":a,"Shift-Backspace":a,Delete:b,"Mod-Delete":b,"Mod-a":()=>this.editor.commands.selectAll()},d={...c},e={...c,"Ctrl-h":a,"Alt-Backspace":a,"Ctrl-d":b,"Ctrl-Alt-Backspace":b,"Alt-Delete":b,"Alt-d":b,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return yz()||yM()?e:d},addProseMirrorPlugins(){return[new un({key:new uq("clearDocument"),appendTransaction:(a,b,c)=>{if(a.some(a=>a.getMeta("composition")))return;let d=a.some(a=>a.docChanged)&&!b.doc.eq(c.doc),e=a.some(a=>a.getMeta("preventClearDocument"));if(!d||e)return;let{empty:f,from:g,to:h}=b.selection,i=t5.atStart(b.doc).from,j=t5.atEnd(b.doc).to;if(f||g!==i||h!==j||!function a(b,{checkChildren:c=!0,ignoreWhitespace:d=!1}={}){var e;if(d){if("hardBreak"===b.type.name)return!0;if(b.isText)return/^\s*$/m.test(null!=(e=b.text)?e:"")}if(b.isText)return!b.text;if(b.isAtom||b.isLeaf)return!1;if(0===b.content.childCount)return!0;if(c){let e=!0;return b.content.forEach(b=>{!1!==e&&(a(b,{ignoreWhitespace:d,checkChildren:c})||(e=!1))}),e}return!1}(c.doc))return;let k=c.tr,l=xI({state:c,transaction:k}),{commands:m}=new xJ({editor:this.editor,state:l});if(m.clearNodes(),k.steps.length)return k}})]}}),zs=yi.create({name:"paste",addProseMirrorPlugins(){return[new un({key:new uq("tiptapPaste"),props:{handlePaste:(a,b,c)=>{this.editor.emit("paste",{editor:this.editor,event:b,slice:c})}}})]}}),zt=yi.create({name:"tabindex",addProseMirrorPlugins(){return[new un({key:new uq("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});let zu=new cl;function zv(a,b,c){let{tipTapConfig:d,addFontsFromNode:e}=a.getTextOptions();cg(d,"textOptions.tipTapConfig must be set to use rich text"),cg(e,"textOptions.addFontsFromNode must be set to use rich text");let f=zu.get(d,()=>xW(xY(d.extensions??[]),void 0)),g=s0.fromJSON(f,b),h=new Set;function i(a){h.add(a)}return!function a(b,c){for(let d of(c=e(b,c,i),b.children))a(d,c)}(g,c),Array.from(h)}function zw(a,b="_blank",c){return kz.openWindow(a,b,c)}bV("@tldraw/editor","4.2.0","esm"),a.s([],2921),a.i(75599);var zx=b_,zy=b1;a.s(["DEFAULT_SUPPORTED_IMAGE_TYPES",()=>cL,"DEFAULT_SUPPORTED_MEDIA_TYPES",()=>cN,"DEFAULT_SUPPORTED_MEDIA_TYPE_LIST",()=>cO,"DEFAULT_SUPPORT_VIDEO_TYPES",()=>cM,"ExecutionQueue",()=>cq,"FileHelpers",()=>ct,"Image",()=>cs,"MediaHelpers",()=>cP,"PerformanceTracker",()=>dc,"PngHelpers",()=>cH,"Result",()=>ce,"STRUCTURED_CLONE_OBJECT_PROTOTYPE",()=>d0,"Timers",()=>dU,"WeakCache",()=>cl,"ZERO_INDEX_KEY",()=>"a0","annotateError",()=>co,"areArraysShallowEqual",()=>ca,"areObjectsShallowEqual",()=>c1,"assert",()=>cg,"assertExists",()=>ch,"bind",()=>ck,"clearLocalStorage",()=>dG,"clearSessionStorage",()=>dK,"compact",()=>b5,"debounce",()=>cm,"dedupe",()=>b4,"deleteFromLocalStorage",()=>dF,"deleteFromSessionStorage",()=>dJ,"exhaustiveSwitchError",()=>cf,"fetch",()=>cr,"filterEntries",()=>c_,"fpsThrottle",()=>dS,"getChangedKeys",()=>c4,"getErrorAnnotations",()=>cp,"getFirstFromIterable",()=>cE,"getFromLocalStorage",()=>dD,"getFromSessionStorage",()=>dH,"getHashForBuffer",()=>cw,"getHashForObject",()=>cv,"getHashForString",()=>cu,"getIndexAbove",()=>dw,"getIndexBelow",()=>dx,"getIndexBetween",()=>dv,"getIndices",()=>dy,"getIndicesAbove",()=>dt,"getIndicesBelow",()=>du,"getIndicesBetween",()=>ds,"getOwnProperty",()=>cV,"groupBy",()=>c2,"hasOwnProperty",()=>cU,"invLerp",()=>cR,"isDefined",()=>dW,"isEqual",()=>zx.default,"isEqualAllowingForFloatingPointErrors",()=>c5,"isEqualWith",()=>b0.default,"isNativeStructuredClone",()=>d_,"isNonNull",()=>dX,"isNonNullish",()=>dY,"last",()=>b6,"lerp",()=>cQ,"lns",()=>cx,"mapObjectMapValues",()=>c0,"maxBy",()=>b8,"measureAverageDuration",()=>db,"measureCbDuration",()=>c8,"measureDuration",()=>c9,"mergeArraysAndReplaceDefaults",()=>cb,"minBy",()=>b7,"mockUniqueId",()=>cB,"modulate",()=>cT,"noop",()=>cd,"objectMapEntries",()=>cY,"objectMapEntriesIterable",()=>cZ,"objectMapFromEntries",()=>c$,"objectMapKeys",()=>cW,"objectMapValues",()=>cX,"omit",()=>c3,"omitFromStackTrace",()=>cc,"partition",()=>b9,"promiseWithResolve",()=>ci,"registerTldrawLibraryVersion",()=>bV,"restoreUniqueId",()=>cC,"retry",()=>dB,"rng",()=>cS,"rotateArray",()=>b3,"safeParseUrl",()=>dV,"setInLocalStorage",()=>dE,"setInSessionStorage",()=>dI,"sleep",()=>cj,"sortById",()=>dC,"sortByIndex",()=>dz,"sortByMaybeIndex",()=>dA,"stringEnum",()=>dL,"structuredClone",()=>d$,"throttle",()=>zy.default,"throttleToNextFrame",()=>dT,"uniq",()=>b2.default,"uniqueId",()=>cD,"validateIndexKey",()=>dr,"warnDeprecatedGetter",()=>d2,"warnOnce",()=>d3],8574);class zz{static lineThroughPoints(a,b){let c=new zz;c.moveTo(a[0].x,a[0].y,{...b,offset:b?.endOffsets??b?.offset});for(let d=1;d<a.length;d++){let e=d===a.length-1;c.lineTo(a[d].x,a[d].y,e?{offset:b?.endOffsets}:void 0)}return c}static cubicSplineThroughPoints(a,b){let c=new zz,d=a.length,e=d-2;c.moveTo(a[0].x,a[0].y,{...b,offset:b?.endOffsets??b?.offset});for(let f=0;f<d-1;f++){let d,g,h,i,j,k=0===f?a[0]:a[f-1],l=a[f],m=a[f+1],n=f===e?m:a[f+2];0===f?(d=k.x,g=k.y):(d=l.x+(m.x-k.x)/6*1.25,g=l.y+(m.y-k.y)/6*1.25),f===e?(h=m.x,i=m.y,j={offset:b?.endOffsets}):(h=m.x-(n.x-l.x)/6*1.25,i=m.y-(n.y-l.y)/6*1.25),c.cubicBezierTo(m.x,m.y,d,g,h,i,j)}return c}constructor(){}commands=[];lastMoveTo=null;assertHasMoveTo(){return cg(this.lastMoveTo,"Start an SVGPathBuilder with `.moveTo()`"),this.lastMoveTo}moveTo(a,b,c){return this.lastMoveTo={type:"move",x:a,y:b,closeIdx:null,isClose:!1,opts:c},this.commands.push(this.lastMoveTo),this}lineTo(a,b,c){return this.assertHasMoveTo(),this.commands.push({type:"line",x:a,y:b,isClose:!1,opts:c}),this}circularArcTo(a,b,c,d,e,f){return this.arcTo(a,a,b,c,0,d,e,f)}arcTo(a,b,c,d,e,f,g,h){this.assertHasMoveTo();let i=this.commands[this.commands.length-1].x,j=this.commands[this.commands.length-1].y;if(i===f&&j===g)return this;if(0===a||0===b)return this.lineTo(f,g,h);let k=Math.sin(e),l=Math.cos(e),m=Math.abs(a),n=Math.abs(b),o=(i-f)/2,p=(j-g)/2,q=l*o+k*p,r=-k*o+l*p,s=q*q/(m*m)+r*r/(n*n);if(s>1){let a=Math.sqrt(s);m*=a,n*=a}let t=(m*m*n*n-m*m*r*r-n*n*q*q)/(m*m*r*r+n*n*q*q),u=(c!==d?1:-1)*Math.sqrt(t=t<0?0:t),v=m*r/n*u,w=-(n*q)/m*u,y=l*v-k*w+(i+f)/2,z=k*v+l*w+(j+g)/2,A=Math.atan2((r-w)/n,(q-v)/m),B=Math.atan2((-r-w)/n,(-q-v)/m);!d&&B>A?B-=2*Math.PI:d&&B<A&&(B+=2*Math.PI);let C=B-A,D=Math.max(m,n)*Math.abs(C),E=Math.min(4,Math.ceil(Math.abs(C)/(Math.PI/2))),F=Math.ceil(sC(D)/E),G=C/E,H=a=>({x:y+m*Math.cos(a)*l-n*Math.sin(a)*k,y:z+m*Math.cos(a)*k+n*Math.sin(a)*l}),I=a=>({x:-m*Math.sin(a)*l-n*Math.cos(a)*k,y:-m*Math.sin(a)*k+n*Math.cos(a)*l});for(let a=0;a<E;a++){let b=A+a*G,c=A+(a+1)*G,d=c-b,e=H(b),f=H(c),g=I(b),i=I(c),j=4/3*Math.tan(d/4),k=e.x+j*g.x,l=e.y+j*g.y,m=f.x-j*i.x,n=f.y-j*i.y,o=0===a?h:{...h,mergeWithPrevious:!0};this.cubicBezierToWithResolution(f.x,f.y,k,l,m,n,o,F)}return this}cubicBezierTo(a,b,c,d,e,f,g){return this.cubicBezierToWithResolution(a,b,c,d,e,f,g)}cubicBezierToWithResolution(a,b,c,d,e,f,g,h){return this.assertHasMoveTo(),this.commands.push({type:"cubic",x:a,y:b,cp1:{x:c,y:d},cp2:{x:e,y:f},isClose:!1,opts:g,resolution:h}),this}close(){let a=this.assertHasMoveTo(),b=this.commands[this.commands.length-1];return jK(a.x,b.x)&&jK(a.y,b.y)?b.isClose=!0:this.commands.push({type:"line",x:a.x,y:a.y,isClose:!0}),a.closeIdx=this.commands.length-1,this.lastMoveTo=null,this}toD(a={}){let{startIdx:b=0,endIdx:c=this.commands.length,onlyFilled:d=!1}=a,e=[],f=!1,g=!1,h=!1,i=a=>{if(g||0===a)return;g=!0;let b=this.commands[a-1];e.push("M",jX(b.x),jX(b.y))};for(let a=b;a<c;a++){let b=this.commands[a];switch(b.type){case"move":{let a=b.opts?.geometry!==!1&&(b.opts?.geometry?.isFilled??!1);d&&!a?f=!0:(f=!1,g=!0,h=!0,e.push("M",jX(b.x),jX(b.y)));break}case"line":if(f)break;i(a),b.isClose&&h?e.push("Z"):e.push("L",jX(b.x),jX(b.y));break;case"cubic":if(f)break;i(a),e.push("C",jX(b.cp1.x),jX(b.cp1.y),jX(b.cp2.x),jX(b.cp2.y),jX(b.x),jX(b.y));break;default:cf(b,"type")}}return e.join(" ")}toSvg(a){if(a.forceSolid)return this.toSolidSvg(a);switch(a.style){case"solid":return this.toSolidSvg(a);case"dashed":case"dotted":return this.toDashedSvg(a);case"draw":return this.toDrawSvg(a);default:cf(a,"style")}}toGeometry(){let a=[],b=null;for(let c=0;c<this.commands.length;c++){let d=this.commands[c];"move"===d.type&&(b&&b.opts?.geometry!==!1&&a.push(new zB(this,b.startIdx,c,{...b.opts?.geometry,isFilled:b.opts?.geometry?.isFilled??!1,isClosed:null!==b.moveCommand.closeIdx})),b={startIdx:c,moveCommand:d,opts:d.opts,isClosed:!1}),d.isClose&&(cg(b,"No current move command"),b.isClosed=!0)}return(b&&b.opts?.geometry!==!1&&a.push(new zB(this,b.startIdx,this.commands.length,{...b.opts?.geometry,isFilled:b.opts?.geometry?.isFilled??!1,isClosed:null!==b.moveCommand.closeIdx})),cg(a.length>0),1===a.length)?a[0]:new lw({children:a})}toSolidSvg(a){let{strokeWidth:b,props:c}=a;return(0,bT.jsx)("path",{strokeWidth:b,d:this.toD({onlyFilled:a.onlyFilled}),...c})}toDashedSvg(a){let b,{style:c,strokeWidth:d,snap:e,lengthRatio:f,props:{markerStart:g,markerEnd:h,...i}={}}=a,j=[],k=!1,l=!1,m=null,n=()=>{if(!m)return;let{startIdx:b,endIdx:i,isFirst:k,isLast:l,length:n,lineOpts:o,pathIsClosed:p}=m;if(m=null,b===i&&"move"===this.commands[b].type)return;let q=o?.dashStart??a.start,r=o?.dashEnd??a.end,{strokeDasharray:s,strokeDashoffset:t}=lD(n,d,{style:c,snap:e,lengthRatio:f,start:k?q??(p?"outset":"none"):"outset",end:l?r??(p?"outset":"none"):"outset"}),u=this.toD({startIdx:b,endIdx:i+1});j.push((0,bT.jsx)("path",{d:u,strokeDasharray:s,strokeDashoffset:t,markerStart:k?g:void 0,markerEnd:l?h:void 0},j.length))};for(let c=0;c<this.commands.length;c++){let d=this.commands[c],e=this.commands[c-1];if("move"===d.type){k=null!==d.closeIdx;let c=d.opts?.geometry!==!1&&(d.opts?.geometry?.isFilled??!1);a.onlyFilled&&!c?l=!0:(l=!1,b=d.opts);continue}if(l)continue;let f=this.calculateSegmentLength(e,d),g="move"===e.type,h=d.isClose||c===this.commands.length-1||this.commands[c+1]?.type==="move";m&&d.opts?.mergeWithPrevious?(m.length+=f,m.endIdx=c,m.isLast=h):(n(),m={startIdx:c,endIdx:c,isFirst:g,isLast:h,length:f,lineOpts:b,pathIsClosed:k})}return n(),(0,bT.jsx)("g",{strokeWidth:d,...i,children:j})}toDrawSvg(a){return(0,bT.jsx)("path",{strokeWidth:a.strokeWidth,d:this.toDrawD(a),...a.props})}toDrawD(a){let{strokeWidth:b,randomSeed:c,offset:d=b/3,roundness:e=2*b,passes:f=2,onlyFilled:g=!1}=a,h=[],i=this.getCommandInfo(),j=[],k=null;for(let a=0;a<this.commands.length;a++){let b=this.commands[a],c=b.opts?.offset??d,f=b.opts?.roundness??e;"move"===b.type&&(k=a);let g=b.isClose?ch(k)+1:this.commands[a+1]&&"move"!==this.commands[a+1].type?a+1:void 0,h=void 0!==g&&this.commands[g]&&this.commands[g]?.type!=="move"?i[g]:void 0,l=zA[b.type],m=void 0!==g&&zA[this.commands[g].type],n=i[a],o=n?.tangentEnd,p=h?.tangentStart,q=l&&m&&o&&p&&jA.Len2(o)>.01&&jA.Len2(p)>.01?cT(Math.abs(jA.AngleBetween(o,p)),[Math.PI/2,Math.PI],[f,0],!0):0,r=jI(c,0,(Math.min(n?.length??1/0,h?.length??1/0)-2*q)/4),s=Math.min(q,(n?.length??1/0)/4),t=Math.min(q,(h?.length??1/0)/4),u={command:b,offsetAmount:r,roundnessBefore:s,roundnessAfter:t,tangentToPrev:i[a]?.tangentEnd,tangentToNext:h?.tangentStart,moveDidClose:!1};if(j.push(u),b.isClose&&null!==k){let a=j[k];a.moveDidClose=!0,a.roundnessAfter=t}else"move"===b.type&&(k=a)}for(let a=0;a<f;a++){let b=cS(c+a),d={x:0,y:0},e=!1;for(let{command:a,offsetAmount:c,roundnessBefore:f,roundnessAfter:i,tangentToNext:k,tangentToPrev:l}of j){let j=a.isClose?d:{x:b()*c,y:b()*c};if("move"===a.type){d=j;let b=a.opts?.geometry!==!1&&(a.opts?.geometry?.isFilled??!1);e=!!g&&!b}if(e)continue;let m=jA.Add(a,j),n=k&&i>0?jA.Mul(k,-i).add(m):m,o=l&&f>0?jA.Mul(l,f).add(m):m;if(n===m||o===m)switch(a.type){case"move":h.push("M",jX(n.x),jX(n.y));break;case"line":h.push("L",jX(n.x),jX(n.y));break;case"cubic":{let b=jA.Add(a.cp1,j),c=jA.Add(a.cp2,j);h.push("C",jX(b.x),jX(b.y),jX(c.x),jX(c.y),jX(n.x),jX(n.y));break}default:cf(a,"type")}else switch(a.type){case"move":h.push("M",jX(n.x),jX(n.y));break;case"line":h.push("L",jX(o.x),jX(o.y),"Q",jX(m.x),jX(m.y),jX(n.x),jX(n.y));break;case"cubic":{let b=jA.Add(a.cp1,j),c=jA.Add(a.cp2,j);h.push("C",jX(b.x),jX(b.y),jX(c.x),jX(c.y),jX(m.x),jX(m.y));break}default:cf(a,"type")}}}return h.join(" ")}calculateSegmentLength(a,b){switch(b.type){case"move":return 0;case"line":return jA.Dist(a,b);case"cubic":return zC.length(a.x,a.y,b.cp1.x,b.cp1.y,b.cp2.x,b.cp2.y,b.x,b.y);default:cf(b,"type")}}getCommands(){return this.commands}getCommandInfo(){let a=[];for(let b=1;b<this.commands.length;b++){let c,d,e=this.commands[b-1],f=this.commands[b];if(f._info){a[b]=f._info;continue}if("move"!==f.type){switch(f.type){case"line":c=d=jA.Sub(e,f).uni();break;case"cubic":c=jA.Sub(f.cp1,e).uni(),d=jA.Sub(f.cp2,f).uni();break;default:cf(f,"type")}f._info={tangentStart:c,tangentEnd:d,length:this.calculateSegmentLength(e,f)},a[b]=f._info}}return a}}let zA={line:!0,move:!0,cubic:!1};class zB extends lu{constructor(a,b,c,d){super(d),this.path=a,this.startIdx=b,this.endIdx=c}_segments=null;getSegments(){if(this._segments)return this._segments;this._segments=[];let a=this.path.commands[this.startIdx];cg("move"===a.type);for(let b=this.startIdx+1;b<this.endIdx;b++){let c=this.path.commands[b];switch(cg("move"!==c.type),c.type){case"line":this._segments.push(new lx({start:jA.From(a),end:jA.From(c)}));break;case"cubic":this._segments.push(new sF({start:jA.From(a),cp1:jA.From(c.cp1),cp2:jA.From(c.cp2),end:jA.From(c),resolution:c.resolution}));break;default:cf(c,"type")}a=c}return this._segments}getVertices(a){let b=this.getSegments().flatMap(b=>b.getVertices(a)).filter((a,b,c)=>{let d=c[b-1];return!d||!jA.Equals(d,a)});if(this.isClosed){let a=b[b.length-1],c=b[0];jA.Equals(a,c)||b.push(c)}return b}nearestPoint(a,b){let c=null,d=1/0;for(let b of this.getSegments()){let e=b.nearestPoint(a),f=jA.Dist2(a,e);f<d&&(d=f,c=e)}return cg(c,"No nearest point found"),c}hitTestLineSegment(a,b,c=0,d){return super.hitTestLineSegment(a,b,c,d)}getSvgPathData(){return this.path.toD({startIdx:this.startIdx,endIdx:this.endIdx})}}let zC={base3(a,b,c,d,e){let f=a*(-3*b+9*c-9*d+3*e)+6*b-12*c+6*d;return a*f-3*b+3*c},length(a,b,c,d,e,f,g,h,i=1){let j=(i=i>1?1:i<0?0:i)/2,k=0;k=0;for(let i=0;i<12;i++){let l=j*zC.Tvalues[i]+j,m=zC.base3(l,a,c,e,g),n=zC.base3(l,b,d,f,h),o=m*m+n*n;k+=zC.Cvalues[i]*Math.sqrt(o)}return j*k},Tvalues:[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues:[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472]};function zD(){let a=kq(),b=e$("animationSpeed",()=>a?.user.getAnimationSpeed(),[a]),[c,d]=(0,eQ.useState)(!1);return(0,eQ.useEffect)(()=>{if(void 0!==b)return void d(0===b)},[b]),c}a.i(65124),a.s(["track",()=>eV,"useAtom",()=>eW,"useComputed",()=>eX,"useQuickReactor",()=>eY,"useReactor",()=>eZ,"useStateTracking",()=>eR,"useValue",()=>e$],43382),a.i(63617),a.s(["ArraySet",()=>eb,"EMPTY_ARRAY",()=>ea,"EffectScheduler",()=>ef,"RESET_VALUE",()=>ec,"UNINITIALIZED",()=>es,"atom",()=>eM,"computed",()=>eB,"deferAsyncEffects",()=>eq,"getComputedInstance",()=>eA,"isAtom",()=>eN,"isSignal",()=>eO,"isUninitialized",()=>et,"localStorageAtom",()=>eP,"react",()=>eg,"reactor",()=>eh,"transact",()=>ep,"transaction",()=>eo,"unsafe__withoutCapture",()=>eF,"whyAmIRunning",()=>eJ,"withDiff",()=>ev],45987);let zE=(0,eQ.createContext)(null);function zF({children:a}){let b=eW("a11y",{msg:"",priority:"assertive"}),c=(0,eQ.useContext)(zE),d=(0,eQ.useMemo)(()=>({currentMsg:b,announce(a){a&&b.set(a)}}),[b]);return c?(0,bT.jsx)(bT.Fragment,{children:a}):(0,bT.jsx)(zE.Provider,{value:d,children:a})}function zG(){let a=(0,eQ.useContext)(zE);if(!a)throw Error("useA11y must be used within a A11yContext.Provider");return a}let zH=(0,eQ.createContext)(null);function zI({assetUrls:a,children:b}){return(0,eQ.useEffect)(()=>{for(let b of Object.values(a.icons)){if(!b)continue;let a=cs();a.crossOrigin="anonymous",a.src=b,a.decode()}for(let b of Object.values(a.embedIcons)){if(!b)continue;let a=cs();a.crossOrigin="anonymous",a.src=b,a.decode()}},[a]),(0,bT.jsx)(zH.Provider,{value:a,children:b})}function zJ(){let a=(0,eQ.useContext)(zH);if(!a)throw Error("useAssetUrls must be used within an AssetUrlsProvider");return a}let zK={"action.toggle-auto-pan":"Auto (trackpad)","action.toggle-auto-zoom":"Auto (mouse)","action.toggle-auto-none":"Auto","action.toggle-mouse":"Mouse","action.toggle-trackpad":"Trackpad","action.convert-to-bookmark":"Convert to bookmark","action.convert-to-embed":"Convert to embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.download-original":"Download original","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-kbd-shortcuts":"Open keyboard shortcuts","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-keyboard-shortcuts.menu":"Enable keyboard shortcuts","action.toggle-keyboard-shortcuts":"Toggle keyboard shortcuts","action.enhanced-a11y-mode.menu":"Enhanced accessibility mode","action.enhanced-a11y-mode":"Toggle enhanced accessibility mode","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.maximum-size":"Maximum file size is {size}","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.files.amount-too-many":"Too many files","assets.url.failed":"Couldn’t load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","fill-style.lined-fill":"Lined fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.cloud":"Cloud","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.heart":"Heart","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus":"Rhombus","geo-style.rhombus-2":"Rhombus left","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","arrow-kind-style.arc":"Arc","arrow-kind-style.elbow":"Elbow","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.heart":"Heart","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.media":"Media","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","tool.image-zoom":"Zoom","tool.replace-media":"Replace media","tool.flip-horz":"Flip horizontally","tool.flip-vert":"Flip vertically","tool.rotate-cw":"Rotate","tool.aspect-ratio":"Aspect ratio","tool.aspect-ratio.original":"Original","tool.aspect-ratio.square":"Square (1:1)","tool.aspect-ratio.circle":"Circle (1:1)","tool.aspect-ratio.landscape":"Landscape (4:3)","tool.aspect-ratio.portrait":"Portrait (3:4)","tool.aspect-ratio.wide":"Wide (16:9)","tool.image-toolbar-title":"Image tools","tool.image-crop":"Crop image","tool.image-crop-confirm":"Confirm","tool.media-alt-text":"Alternative text","tool.media-alt-text-desc":"Give a description…","tool.media-alt-text-confirm":"Confirm","tool.rich-text-bold":"Bold","tool.rich-text-italic":"Italic","tool.rich-text-code":"Code","tool.rich-text-highlight":"Highlight","tool.rich-text-strikethrough":"Strikethrough","tool.rich-text-link":"Link","tool.rich-text-link-visit":"Visit link","tool.rich-text-link-remove":"Remove link","tool.rich-text-header":"Header","tool.rich-text-bulletList":"Bulleted list","tool.rich-text-toolbar-title":"Text formatting","tool.rich-text-orderedList":"Ordered list","tool.bookmark":"Bookmark","a11y.status":"Status","a11y.skip-to-main-content":"Move focus to canvas","a11y.shape-index":"{num} of {total}","a11y.shape-image":"Image","a11y.shape-video":"Video","a11y.multiple-shapes":"{num} shapes selected","a11y.select-shape":"Select next shape","a11y.select-shape-direction":"Select shape in direction","a11y.enter-leave-container":"Enter/leave container","a11y.repeat-shape":"Repeat shape","a11y.move-shape":"Move shape","a11y.move-shape-faster":"Move shape faster","a11y.rotate-shape-cw":"Rotate shape clockwise","a11y.rotate-shape-ccw":"Rotate shape counterclockwise","a11y.rotate-shape-cw-fine":"Rotate shape clockwise (fine)","a11y.rotate-shape-ccw-fine":"Rotate shape counterclockwise (fine)","a11y.enlarge-shape":"Enlarge shape","a11y.shrink-shape":"Shrink shape","a11y.pan-camera":"Pan camera","a11y.adjust-shape-styles":"Adjust shape styles","a11y.open-context-menu":"Open context menu","a11y.open-keyboard-shortcuts":"Open keyboard shortcuts","menu.title":"Menu","menu.theme":"Theme","menu.accessibility":"Accessibility","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","menu.input-mode":"Input mode","context-menu.title":"Context menu","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.copy-link":"Copy editor link","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can’t be shared because it’s too large. We’re working on it!","share-menu.upload-failed":"Sorry, we couldn’t upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.avatar-color":"Avatar color","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following you","people-menu.user":"(You)","people-menu.invite":"Invite others","people-menu.anonymous-user":"New user","help-menu.import-tldr-file":"Import file…","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","edit-link-dialog.external-link":"External link","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site’s URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","shortcuts-dialog.a11y":"Accessibility","shortcuts-dialog.text-formatting":"Text formatting","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.arrow-kind":"Line","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","style-panel.selected":"selected","tool-panel.title":"Tools","tool-panel.more":"More","navigation-zone.title":"Navigation","navigation-zone.minimap":"Minimap","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","toast.success":"Success","toast.error":"Error","toast.info":"Info","toast.warning":"Warning","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn’t look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don’t ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don’t ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don’t ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We’ve updated this document to work with the current version of tldraw. If you’d like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don’t ask again","cursor-chat.type-to-chat":"Type to chat…","app.loading":"Loading tldraw…","handle.resize-top":"Resize top","handle.resize-bottom":"Resize bottom","handle.resize-left":"Resize left","handle.resize-right":"Resize right","handle.resize-top-left":"Resize top left","handle.resize-top-right":"Resize top right","handle.resize-bottom-left":"Resize bottom left","handle.resize-bottom-right":"Resize bottom right","handle.rotate.top_left_rotate":"Rotate top left","handle.rotate.top_right_rotate":"Rotate top right","handle.rotate.bottom_left_rotate":"Rotate bottom left","handle.rotate.bottom_right_rotate":"Rotate bottom right","handle.rotate.mobile_rotate":"Rotate","handle.crop.top":"Crop top","handle.crop.bottom":"Crop bottom","handle.crop.left":"Crop left","handle.crop.right":"Crop right","handle.crop.top-left":"Crop top left","handle.crop.top-right":"Crop top right","handle.crop.bottom-left":"Crop bottom left","handle.crop.bottom-right":"Crop bottom right","ui.close":"Close","ui.checked":"Checked","ui.unchecked":"Unchecked"};a.i(31103),a.s(["ArrowShapeArrowheadEndStyle",()=>hy,"ArrowShapeArrowheadStartStyle",()=>hx,"ArrowShapeKindStyle",()=>hv,"AssetRecordType",()=>iz,"CameraRecordType",()=>hJ,"DefaultColorStyle",()=>hm,"DefaultColorThemePalette",()=>hk,"DefaultDashStyle",()=>hq,"DefaultFillStyle",()=>hr,"DefaultFontFamilies",()=>ht,"DefaultFontStyle",()=>hs,"DefaultHorizontalAlignStyle",()=>iO,"DefaultLabelColorStyle",()=>hn,"DefaultSizeStyle",()=>hu,"DefaultTextAlignStyle",()=>i8,"DefaultVerticalAlignStyle",()=>iP,"DocumentRecordType",()=>ii,"ElbowArrowSnap",()=>hD,"EnumStyleProp",()=>g8,"GeoShapeGeoStyle",()=>iQ,"ImageShapeCrop",()=>iY,"InstancePageStateRecordType",()=>h2,"InstancePresenceRecordType",()=>ia,"LANGUAGES",()=>jo,"LineShapeSplineStyle",()=>i0,"PageRecordType",()=>hU,"PointerRecordType",()=>h5,"StyleProp",()=>g7,"TLDOCUMENT_ID",()=>ij,"TLINSTANCE_ID",()=>h$,"TLPOINTER_ID",()=>h6,"TL_CANVAS_UI_COLOR_TYPES",()=>hN,"TL_CURSOR_TYPES",()=>hK,"TL_HANDLE_TYPES",()=>jn,"TL_SCRIBBLE_STATES",()=>hP,"arrowBindingMigrations",()=>hG,"arrowBindingProps",()=>hE,"arrowBindingVersions",()=>hF,"arrowShapeMigrations",()=>hC,"arrowShapeProps",()=>hz,"arrowShapeVersions",()=>hA,"assetIdValidator",()=>gR,"assetMigrations",()=>iy,"assetValidator",()=>ix,"bindingIdValidator",()=>gZ,"bookmarkShapeMigrations",()=>iC,"bookmarkShapeProps",()=>iA,"boxModelValidator",()=>gU,"canvasUiColorTypeValidator",()=>hO,"createAssetValidator",()=>gS,"createBindingId",()=>g2,"createBindingPropsMigrationIds",()=>g4,"createBindingPropsMigrationSequence",()=>g3,"createBindingValidator",()=>g$,"createPresenceStateDerivation",()=>ib,"createShapeId",()=>hd,"createShapePropsMigrationIds",()=>hg,"createShapePropsMigrationSequence",()=>hf,"createShapeValidator",()=>gY,"createTLSchema",()=>jm,"defaultBindingSchemas",()=>jl,"defaultColorNames",()=>hj,"defaultShapeSchemas",()=>jk,"drawShapeMigrations",()=>iG,"drawShapeProps",()=>iE,"embedShapeMigrations",()=>iL,"embedShapeProps",()=>iJ,"frameShapeMigrations",()=>iN,"frameShapeProps",()=>iM,"geoShapeMigrations",()=>iT,"geoShapeProps",()=>iR,"getColorValue",()=>hp,"getDefaultColorTheme",()=>hl,"getDefaultTranslationLocale",()=>jp,"getDefaultUserPresence",()=>ic,"getShapePropKeysByStyle",()=>he,"groupShapeMigrations",()=>iV,"groupShapeProps",()=>iU,"highlightShapeMigrations",()=>iX,"highlightShapeProps",()=>iW,"idValidator",()=>gQ,"imageShapeMigrations",()=>i_,"imageShapeProps",()=>iZ,"isBinding",()=>g0,"isBindingId",()=>g1,"isDocument",()=>ie,"isPageId",()=>hV,"isShape",()=>hb,"isShapeId",()=>hc,"lineShapeMigrations",()=>i4,"lineShapeProps",()=>i2,"noteShapeMigrations",()=>i7,"noteShapeProps",()=>i5,"opacityValidator",()=>gV,"pageIdValidator",()=>hR,"parentIdValidator",()=>gW,"pluckPreservingValues",()=>hX,"richTextValidator",()=>g5,"rootBindingMigrations",()=>g_,"rootShapeMigrations",()=>ha,"scribbleValidator",()=>hQ,"shapeIdValidator",()=>gX,"textShapeMigrations",()=>jb,"textShapeProps",()=>i9,"toRichText",()=>g6,"vecModelValidator",()=>gT,"videoShapeMigrations",()=>je,"videoShapeProps",()=>jc],52441);let zL=new Set(["ar","fa","he","ur","ku"]),zM={locale:"en",label:"English",messages:zK,dir:"ltr"};async function zN(a,b){if(!(await cr(b.translations.en)).ok)return console.warn("No main translations found."),zM;if("en"===a)return zM;let c=jo.find(b=>b.locale===a);if(!c)return console.warn(`No translation found for locale ${a}`),zM;let d=await cr(b.translations[c.locale]),e=await d.json();if(!e)return console.warn(`No messages found for locale ${a}`),zM;let f=[];for(let a in zM.messages)e[a]||f.push(a);return f.length,{locale:a,label:c.label,dir:zL.has(c.locale)?"rtl":"ltr",messages:{...zM.messages,...e}}}let zO=eQ.createContext(null);function zP({overrides:a,locale:b,children:c}){let d=zJ(),[e,f]=eQ.useState(()=>a&&a.en?{locale:"en",label:"English",dir:"ltr",messages:{...zK,...a.en}}:{locale:"en",label:"English",dir:"ltr",messages:zK});return eQ.useEffect(()=>{let c=!1;return async function(){let e=await zN(b,d);e&&!c&&(a&&a[b]?f({...e,messages:{...e.messages,...a[b]}}):f(e))}(),()=>{c=!0}},[d,b,a]),(0,bT.jsx)(zO.Provider,{value:e,children:c})}function zQ(){let a=function(){let a=eQ.useContext(zO);if(!a)throw Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return a}();return eQ.useCallback(function(b){return a.messages[b]??b},[a])}let zR={normal:"tlui-button__normal",primary:"tlui-button__primary",danger:"tlui-button__danger",low:"tlui-button__low",icon:"tlui-button__icon",tool:"tlui-button__tool",menu:"tlui-button__menu",help:"tlui-button__help"},zS=eQ.forwardRef(function({children:a,type:b,htmlButtonType:c,isActive:d,...e},f){return(0,bT.jsx)("button",{ref:f,type:c||"button",draggable:!1,"data-isactive":d,...e,className:(0,j1.default)("tlui-button",zR[b],e.className),children:a})});function zT(){let a=kp(),b=zQ(),c=(0,eQ.useRef)(null),d=(0,eQ.useCallback)(b=>{a.markEventAsHandled(b),c.current?.blur();let d=a.getCurrentPageShapesInReadingOrder();d.length&&(a.setSelectedShapes([d[0].id]),a.zoomToSelectionIfOffscreen(256,{animation:{duration:a.options.animationMediumMs},inset:0}),a.timers.setTimeout(()=>a.getContainer().focus(),100))},[a]);return(0,bT.jsx)(zS,{ref:c,type:"low",tabIndex:0,className:"tl-skip-to-main-content",onClick:d,children:b("a11y.skip-to-main-content")})}let zU=(0,eQ.memo)(function(){let a=zG(),b=zQ(),c=e$("a11y-msg",()=>a.currentMsg.get(),[]);return zX(c.msg),zW(),c.msg&&(0,bT.jsx)("div",{"aria-label":b("a11y.status"),"aria-live":c.priority||"assertive",role:"status","aria-hidden":"false",style:{position:"absolute",top:"-10000px",left:"-10000px"},children:c.msg})});function zV(a){let{editor:b,selectedShapeIds:c,msg:d}=a,e="",f=c.length;if(f>1)e=d("a11y.multiple-shapes").replace("{num}",f.toString());else if(1===f){let a=c[0],f=b.getShape(a);if(!f)return"";let g=b.getShapeUtil(f.type),h=["image","video"].includes(f.type),i="";i=d("geo"===f.type?`geo-style.${f.props.geo}`:h?`a11y.shape-${f.type}`:`tool.${f.type}`);let j=b.getCurrentPageShapesInReadingOrder(),k=(j.findIndex(b=>b.id===a)+1).toString(),l=j.length.toString(),m=d("a11y.shape-index").replace("{num}",k).replace("{total}",l),n=g.getAriaDescriptor(f)||g.getText(f)||"";e=(n?`${n}, `:"")+`${i}. ${m}`}return e}let zW=()=>{let a=kq(),b=zG(),c=zQ(),d=(0,eQ.useRef)([]);eZ("announce selection",()=>{if(a&&a.isIn("select.idle")){let e=a.getSelectedShapeIds();e!==d.current&&(d.current=e,eF(()=>{let d=zV({editor:a,selectedShapeIds:e,msg:c});d&&b.announce({msg:d})}))}},[a,b,c])},zX=a=>{let b=kv();(0,eQ.useEffect)(()=>{if(j7.a11y.get()){let b=a=>{console.debug(`%ca11y%c: ${a}`,"color: white; background: #40C057; padding: 2px;border-radius: 3px;","font-weight: normal")},c=a=>{let c=document.activeElement;if("Tab"===a.key&&c&&c!==document.body&&!c.classList.contains("tl-container")){let a=c.getAttribute("aria-label")||c.getAttribute("title")||c.textContent;a&&b(a)}};return a&&b(a),document.addEventListener("keyup",c),()=>document.removeEventListener("keyup",c)}},[b,a])};function zY(a,b){let c=b?a.getAsset(b):null;if(c&&!c.props.image)if(!c.props.title)return 46;else return 101;return 320}function zZ(a,b){return{...b,props:{...b.props,h:zY(a,b.props.assetId)}}}let z$=cm(async(a,b)=>{if(a.isDisposed)return;let{url:c}=b.props,d=await a.getAssetForExternalContent({type:"url",url:c});d&&a.run(()=>{a.createAssets([d]),a.updateShapes([{id:b.id,type:b.type,props:{assetId:d.id}}])})},500);async function z_(a,{url:b,center:c=a.getViewportPageBounds().center}){try{let d=await a.getAssetForExternalContent({type:"url",url:b}),e=hd(),f={id:e,type:"bookmark",x:c.x-150,y:c.y-160,rotation:0,opacity:1,props:{url:b,assetId:d?.id||null,w:300,h:zY(a,d?.id)}};a.run(()=>{d&&a.createAssets([d]),a.createShapes([f])});let g=a.getShape(e);return ce.ok(g)}catch(a){return ce.err(a instanceof Error?a.message:"Failed to create bookmark")}}function z0(a,b,c={padding:50}){let d=lh.FromPoints(a.flatMap(a=>{if(!a)return[];let c=b.getShapeGeometry(a.id),d=b.getShapeLocalTransform(a);return d?.applyToPoints(c.vertices)??[]})),e=c.padding??50,f=d.w+2*e,g=d.h+2*e;return{w:f,h:g,dx:e-d.minX,dy:e-d.minY}}function z1(a,b,c={}){let d=a.getShape(b);if(!d)return;let e=a.getSortedChildIdsForParent(d.id),f=b5(e.map(b=>a.getShape(b)));if(!f.length)return;let{w:g,h,dx:i,dy:j}=z0(f,a,c);if(0===i&&0===j&&d.props.w===g&&d.props.h===h)return;let k=new jA(i,j).rot(d.rotation);a.run(()=>{let b=e.map(b=>{let c=a.getShape(b);return{id:c.id,type:c.type,x:c.x+i,y:c.y+j}});b.push({id:d.id,type:d.type,x:d.x-k.x,y:d.y-k.y,props:{w:g,h}}),a.updateShapes(b)})}a.i(53207);var z2=gO;a.s(["ArrayOfValidator",()=>ga,"DictValidator",()=>gd,"ObjectValidator",()=>gb,"T",0,z2,"UnionValidator",()=>gc,"Validator",()=>f9],66247);var z2=gO;function z3({children:a}){return(0,bT.jsx)("span",{className:"tlui-button__label",children:a})}function z4(a,b,{checkForDefaultPrevented:c=!0}={}){return function(d){if(a?.(d),!1===c||!d.defaultPrevented)return b?.(d)}}function z5(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}function z6(...a){return b=>{let c=!1,d=a.map(a=>{let d=z5(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():z5(a[b],null)}}}}function z7(...a){return eQ.useCallback(z6(...a),a)}function z8(a,b=[]){let c=[],d=()=>{let b=c.map(a=>eQ.createContext(a));return function(c){let d=c?.[a]||b;return eQ.useMemo(()=>({[`__scope${a}`]:{...c,[a]:d}}),[c,d])}};return d.scopeName=a,[function(b,d){let e=eQ.createContext(d),f=c.length;c=[...c,d];let g=b=>{let{scope:c,children:d,...g}=b,h=c?.[a]?.[f]||e,i=eQ.useMemo(()=>g,Object.values(g));return(0,bT.jsx)(h.Provider,{value:i,children:d})};return g.displayName=b+"Provider",[g,function(c,g){let h=g?.[a]?.[f]||e,i=eQ.useContext(h);if(i)return i;if(void 0!==d)return d;throw Error(`\`${c}\` must be used within \`${b}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let c=()=>{let c=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let d=c.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return eQ.useMemo(()=>({[`__scope${b.scopeName}`]:d}),[d])}};return c.scopeName=b.scopeName,c}(d,...b)]}var z9=globalThis?.document?eQ.useLayoutEffect:()=>{},Aa=eQ[" useId ".trim().toString()]||(()=>void 0),Ab=0;function Ac(a){let[b,c]=eQ.useState(Aa());return z9(()=>{a||c(a=>a??String(Ab++))},[a]),a||(b?`radix-${b}`:"")}eQ[" useEffectEvent ".trim().toString()],eQ[" useInsertionEffect ".trim().toString()];var Ad=eQ[" useInsertionEffect ".trim().toString()]||z9;function Ae({prop:a,defaultProp:b,onChange:c=()=>{},caller:d}){let[e,f,g]=function({defaultProp:a,onChange:b}){let[c,d]=eQ.useState(a),e=eQ.useRef(c),f=eQ.useRef(b);return Ad(()=>{f.current=b},[b]),eQ.useEffect(()=>{e.current!==c&&(f.current?.(c),e.current=c)},[c,e]),[c,d,f]}({defaultProp:b,onChange:c}),h=void 0!==a,i=h?a:e;{let b=eQ.useRef(void 0!==a);eQ.useEffect(()=>{let a=b.current;if(a!==h){let b=h?"controlled":"uncontrolled";console.warn(`${d} is changing from ${a?"controlled":"uncontrolled"} to ${b}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}b.current=h},[h,d])}return[i,eQ.useCallback(b=>{if(h){let c="function"==typeof b?b(a):b;c!==a&&g.current?.(c)}else f(b)},[h,a,f,g])]}function Af(a){var b;let c,d=(b=a,(c=eQ.forwardRef((a,b)=>{let{children:c,...d}=a;if(eQ.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==eQ.Fragment&&(h.ref=b?z6(b,g):g),eQ.cloneElement(c,h)}return eQ.Children.count(c)>1?eQ.Children.only(null):null})).displayName=`${b}.SlotClone`,c),e=eQ.forwardRef((a,b)=>{let{children:c,...e}=a,f=eQ.Children.toArray(c),g=f.find(Ak);if(g){let a=g.props.children,c=f.map(b=>b!==g?b:eQ.Children.count(a)>1?eQ.Children.only(null):eQ.isValidElement(a)?a.props.children:null);return(0,bT.jsx)(d,{...e,ref:b,children:eQ.isValidElement(a)?eQ.cloneElement(a,void 0,c):null})}return(0,bT.jsx)(d,{...e,ref:b,children:c})});return e.displayName=`${a}.Slot`,e}Symbol("RADIX:SYNC_STATE");var Ag=Af("Slot"),Ah=Symbol("radix.slottable");function Ai(a){let b=({children:a})=>(0,bT.jsx)(bT.Fragment,{children:a});return b.displayName=`${a}.Slottable`,b.__radixId=Ah,b}var Aj=Ai("Slottable");function Ak(a){return eQ.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===Ah}a.s(["Root",()=>Ag,"Slot",()=>Ag,"Slottable",()=>Aj,"createSlot",()=>Af,"createSlottable",()=>Ai],11011);var Al=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{let c=Af(`Primitive.${b}`),d=eQ.forwardRef((a,d)=>{let{asChild:e,...f}=a;return(0,bT.jsx)(e?c:b,{...f,ref:d})});return d.displayName=`Primitive.${b}`,{...a,[b]:d}},{});function Am(a,b){a&&lI.flushSync(()=>a.dispatchEvent(b))}function An(a){let b=eQ.useRef(a);return eQ.useEffect(()=>{b.current=a}),eQ.useMemo(()=>(...a)=>b.current?.(...a),[])}var Ao="dismissableLayer.update",Ap=eQ.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Aq=eQ.forwardRef((a,b)=>{let{disableOutsidePointerEvents:c=!1,onEscapeKeyDown:d,onPointerDownOutside:e,onFocusOutside:f,onInteractOutside:g,onDismiss:h,...i}=a,j=eQ.useContext(Ap),[k,l]=eQ.useState(null),m=k?.ownerDocument??globalThis?.document,[,n]=eQ.useState({}),o=z7(b,a=>l(a)),p=Array.from(j.layers),[q]=[...j.layersWithOutsidePointerEventsDisabled].slice(-1),r=p.indexOf(q),s=k?p.indexOf(k):-1,t=j.layersWithOutsidePointerEventsDisabled.size>0,u=s>=r,v=function(a,b=globalThis?.document){let c=An(a),d=eQ.useRef(!1),e=eQ.useRef(()=>{});return eQ.useEffect(()=>{let a=a=>{if(a.target&&!d.current){let d=function(){At("dismissableLayer.pointerDownOutside",c,f,{discrete:!0})},f={originalEvent:a};"touch"===a.pointerType?(b.removeEventListener("click",e.current),e.current=d,b.addEventListener("click",e.current,{once:!0})):d()}else b.removeEventListener("click",e.current);d.current=!1},f=window.setTimeout(()=>{b.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(f),b.removeEventListener("pointerdown",a),b.removeEventListener("click",e.current)}},[b,c]),{onPointerDownCapture:()=>d.current=!0}}(a=>{let b=a.target,c=[...j.branches].some(a=>a.contains(b));u&&!c&&(e?.(a),g?.(a),a.defaultPrevented||h?.())},m),w=function(a,b=globalThis?.document){let c=An(a),d=eQ.useRef(!1);return eQ.useEffect(()=>{let a=a=>{a.target&&!d.current&&At("dismissableLayer.focusOutside",c,{originalEvent:a},{discrete:!1})};return b.addEventListener("focusin",a),()=>b.removeEventListener("focusin",a)},[b,c]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}(a=>{let b=a.target;![...j.branches].some(a=>a.contains(b))&&(f?.(a),g?.(a),a.defaultPrevented||h?.())},m);return!function(a,b=globalThis?.document){let c=An(a);eQ.useEffect(()=>{let a=a=>{"Escape"===a.key&&c(a)};return b.addEventListener("keydown",a,{capture:!0}),()=>b.removeEventListener("keydown",a,{capture:!0})},[c,b])}(a=>{s===j.layers.size-1&&(d?.(a),!a.defaultPrevented&&h&&(a.preventDefault(),h()))},m),eQ.useEffect(()=>{if(k)return c&&(0===j.layersWithOutsidePointerEventsDisabled.size&&(bB=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),j.layersWithOutsidePointerEventsDisabled.add(k)),j.layers.add(k),As(),()=>{c&&1===j.layersWithOutsidePointerEventsDisabled.size&&(m.body.style.pointerEvents=bB)}},[k,m,c,j]),eQ.useEffect(()=>()=>{k&&(j.layers.delete(k),j.layersWithOutsidePointerEventsDisabled.delete(k),As())},[k,j]),eQ.useEffect(()=>{let a=()=>n({});return document.addEventListener(Ao,a),()=>document.removeEventListener(Ao,a)},[]),(0,bT.jsx)(Al.div,{...i,ref:o,style:{pointerEvents:t?u?"auto":"none":void 0,...a.style},onFocusCapture:z4(a.onFocusCapture,w.onFocusCapture),onBlurCapture:z4(a.onBlurCapture,w.onBlurCapture),onPointerDownCapture:z4(a.onPointerDownCapture,v.onPointerDownCapture)})});Aq.displayName="DismissableLayer";var Ar=eQ.forwardRef((a,b)=>{let c=eQ.useContext(Ap),d=eQ.useRef(null),e=z7(b,d);return eQ.useEffect(()=>{let a=d.current;if(a)return c.branches.add(a),()=>{c.branches.delete(a)}},[c.branches]),(0,bT.jsx)(Al.div,{...a,ref:e})});function As(){let a=new CustomEvent(Ao);document.dispatchEvent(a)}function At(a,b,c,{discrete:d}){let e=c.originalEvent.target,f=new CustomEvent(a,{bubbles:!1,cancelable:!0,detail:c});b&&e.addEventListener(a,b,{once:!0}),d?Am(e,f):e.dispatchEvent(f)}Ar.displayName="DismissableLayerBranch";var Au="focusScope.autoFocusOnMount",Av="focusScope.autoFocusOnUnmount",Aw={bubbles:!1,cancelable:!0},Ax=eQ.forwardRef((a,b)=>{let{loop:c=!1,trapped:d=!1,onMountAutoFocus:e,onUnmountAutoFocus:f,...g}=a,[h,i]=eQ.useState(null),j=An(e),k=An(f),l=eQ.useRef(null),m=z7(b,a=>i(a)),n=eQ.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;eQ.useEffect(()=>{if(d){let a=function(a){if(n.paused||!h)return;let b=a.target;h.contains(b)?l.current=b:AA(l.current,{select:!0})},b=function(a){if(n.paused||!h)return;let b=a.relatedTarget;null!==b&&(h.contains(b)||AA(l.current,{select:!0}))};document.addEventListener("focusin",a),document.addEventListener("focusout",b);let c=new MutationObserver(function(a){if(document.activeElement===document.body)for(let b of a)b.removedNodes.length>0&&AA(h)});return h&&c.observe(h,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",a),document.removeEventListener("focusout",b),c.disconnect()}}},[d,h,n.paused]),eQ.useEffect(()=>{if(h){AB.add(n);let a=document.activeElement;if(!h.contains(a)){let b=new CustomEvent(Au,Aw);h.addEventListener(Au,j),h.dispatchEvent(b),b.defaultPrevented||(function(a,{select:b=!1}={}){let c=document.activeElement;for(let d of a)if(AA(d,{select:b}),document.activeElement!==c)return}(Ay(h).filter(a=>"A"!==a.tagName),{select:!0}),document.activeElement===a&&AA(h))}return()=>{h.removeEventListener(Au,j),setTimeout(()=>{let b=new CustomEvent(Av,Aw);h.addEventListener(Av,k),h.dispatchEvent(b),b.defaultPrevented||AA(a??document.body,{select:!0}),h.removeEventListener(Av,k),AB.remove(n)},0)}}},[h,j,k,n]);let o=eQ.useCallback(a=>{if(!c&&!d||n.paused)return;let b="Tab"===a.key&&!a.altKey&&!a.ctrlKey&&!a.metaKey,e=document.activeElement;if(b&&e){var f;let b,d=a.currentTarget,[g,h]=[Az(b=Ay(f=d),f),Az(b.reverse(),f)];g&&h?a.shiftKey||e!==h?a.shiftKey&&e===g&&(a.preventDefault(),c&&AA(h,{select:!0})):(a.preventDefault(),c&&AA(g,{select:!0})):e===d&&a.preventDefault()}},[c,d,n.paused]);return(0,bT.jsx)(Al.div,{tabIndex:-1,...g,ref:m,onKeyDown:o})});function Ay(a){let b=[],c=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{let b="INPUT"===a.tagName&&"hidden"===a.type;return a.disabled||a.hidden||b?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)b.push(c.currentNode);return b}function Az(a,b){for(let c of a)if(!function(a,{upTo:b}){if("hidden"===getComputedStyle(a).visibility)return!0;for(;a&&(void 0===b||a!==b);){if("none"===getComputedStyle(a).display)return!0;a=a.parentElement}return!1}(c,{upTo:b}))return c}function AA(a,{select:b=!1}={}){if(a&&a.focus){var c;let d=document.activeElement;a.focus({preventScroll:!0}),a!==d&&(c=a)instanceof HTMLInputElement&&"select"in c&&b&&a.select()}}Ax.displayName="FocusScope";var AB=(o=[],{add(a){let b=o[0];a!==b&&b?.pause(),(o=AC(o,a)).unshift(a)},remove(a){o=AC(o,a),o[0]?.resume()}});function AC(a,b){let c=[...a],d=c.indexOf(b);return -1!==d&&c.splice(d,1),c}var AD=eQ.forwardRef((a,b)=>{let{container:c,...d}=a,[e,f]=eQ.useState(!1);z9(()=>f(!0),[]);let g=c||e&&globalThis?.document?.body;return g?lI.default.createPortal((0,bT.jsx)(Al.div,{...d,ref:b}),g):null});AD.displayName="Portal";var AE=a=>{var b;let c,d,{present:e,children:f}=a,g=function(a){var b,c;let[d,e]=eQ.useState(),f=eQ.useRef(null),g=eQ.useRef(a),h=eQ.useRef("none"),[i,j]=(b=a?"mounted":"unmounted",c={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},eQ.useReducer((a,b)=>c[a][b]??a,b));return eQ.useEffect(()=>{let a=AF(f.current);h.current="mounted"===i?a:"none"},[i]),z9(()=>{let b=f.current,c=g.current;if(c!==a){let d=h.current,e=AF(b);a?j("MOUNT"):"none"===e||b?.display==="none"?j("UNMOUNT"):c&&d!==e?j("ANIMATION_OUT"):j("UNMOUNT"),g.current=a}},[a,j]),z9(()=>{if(d){let a,b=d.ownerDocument.defaultView??window,c=c=>{let e=AF(f.current).includes(CSS.escape(c.animationName));if(c.target===d&&e&&(j("ANIMATION_END"),!g.current)){let c=d.style.animationFillMode;d.style.animationFillMode="forwards",a=b.setTimeout(()=>{"forwards"===d.style.animationFillMode&&(d.style.animationFillMode=c)})}},e=a=>{a.target===d&&(h.current=AF(f.current))};return d.addEventListener("animationstart",e),d.addEventListener("animationcancel",c),d.addEventListener("animationend",c),()=>{b.clearTimeout(a),d.removeEventListener("animationstart",e),d.removeEventListener("animationcancel",c),d.removeEventListener("animationend",c)}}j("ANIMATION_END")},[d,j]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:eQ.useCallback(a=>{f.current=a?getComputedStyle(a):null,e(a)},[])}}(e),h="function"==typeof f?f({present:g.isPresent}):eQ.Children.only(f),i=z7(g.ref,(b=h,(d=(c=Object.getOwnPropertyDescriptor(b.props,"ref")?.get)&&"isReactWarning"in c&&c.isReactWarning)?b.ref:(d=(c=Object.getOwnPropertyDescriptor(b,"ref")?.get)&&"isReactWarning"in c&&c.isReactWarning)?b.props.ref:b.props.ref||b.ref));return"function"==typeof f||g.isPresent?eQ.cloneElement(h,{ref:i}):null};function AF(a){return a?.animationName||"none"}AE.displayName="Presence";var AG=0;function AH(){eQ.useEffect(()=>{let a=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",a[0]??AI()),document.body.insertAdjacentElement("beforeend",a[1]??AI()),AG++,()=>{1===AG&&document.querySelectorAll("[data-radix-focus-guard]").forEach(a=>a.remove()),AG--}},[])}function AI(){let a=document.createElement("span");return a.setAttribute("data-radix-focus-guard",""),a.tabIndex=0,a.style.outline="none",a.style.opacity="0",a.style.position="fixed",a.style.pointerEvents="none",a}var AJ=function(){return(AJ=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function AK(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}var AL=("function"==typeof SuppressedError&&SuppressedError,"right-scroll-bar-position"),AM="width-before-scroll-bar";function AN(a,b){return"function"==typeof a?a(b):a&&(a.current=b),a}var AO=eQ.useEffect,AP=new WeakMap,AQ=(void 0===r&&(r={}),(void 0===s&&(s=function(a){return a}),t=[],u=!1,v={read:function(){if(u)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:null},useMedium:function(a){var b=s(a,u);return t.push(b),function(){t=t.filter(function(a){return a!==b})}},assignSyncMedium:function(a){for(u=!0;t.length;){var b=t;t=[],b.forEach(a)}t={push:function(b){return a(b)},filter:function(){return t}}},assignMedium:function(a){u=!0;var b=[];if(t.length){var c=t;t=[],c.forEach(a),b=t}var d=function(){var c=b;b=[],c.forEach(a)},e=function(){return Promise.resolve().then(d)};e(),t={push:function(a){b.push(a),e()},filter:function(a){return b=b.filter(a),t}}}}).options=AJ({async:!0,ssr:!1},r),v),AR=function(){},AS=eQ.forwardRef(function(a,b){var c,d,e,f,g=eQ.useRef(null),h=eQ.useState({onScrollCapture:AR,onWheelCapture:AR,onTouchMoveCapture:AR}),i=h[0],j=h[1],k=a.forwardProps,l=a.children,m=a.className,n=a.removeScrollBar,o=a.enabled,p=a.shards,q=a.sideCar,r=a.noRelative,s=a.noIsolation,t=a.inert,u=a.allowPinchZoom,v=a.as,w=a.gapMode,y=AK(a,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),z=(c=[g,b],d=function(a){return c.forEach(function(b){return AN(b,a)})},(e=(0,eQ.useState)(function(){return{value:null,callback:d,facade:{get current(){return e.value},set current(value){var a=e.value;a!==value&&(e.value=value,e.callback(value,a))}}}})[0]).callback=d,f=e.facade,AO(function(){var a=AP.get(f);if(a){var b=new Set(a),d=new Set(c),e=f.current;b.forEach(function(a){d.has(a)||AN(a,null)}),d.forEach(function(a){b.has(a)||AN(a,e)})}AP.set(f,c)},[c]),f),A=AJ(AJ({},y),i);return eQ.createElement(eQ.Fragment,null,o&&eQ.createElement(q,{sideCar:AQ,removeScrollBar:n,shards:p,noRelative:r,noIsolation:s,inert:t,setCallbacks:j,allowPinchZoom:!!u,lockRef:g,gapMode:w}),k?eQ.cloneElement(eQ.Children.only(l),AJ(AJ({},A),{ref:z})):eQ.createElement(void 0===v?"div":v,AJ({},A,{className:m,ref:z}),l))});AS.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},AS.classNames={fullWidth:AM,zeroRight:AL};var AT=function(a){var b=a.sideCar,c=AK(a,["sideCar"]);if(!b)throw Error("Sidecar: please provide `sideCar` property to import the right car");var d=b.read();if(!d)throw Error("Sidecar medium not found");return eQ.createElement(d,AJ({},c))};AT.isSideCarExport=!0;var AU=function(){var a=0,b=null;return{add:function(c){if(0==a&&(b=function(){if(!document)return null;var a=document.createElement("style");a.type="text/css";var b=bC||("undefined"!=typeof __webpack_nonce__?__webpack_nonce__:void 0);return b&&a.setAttribute("nonce",b),a}())){var d,e;(d=b).styleSheet?d.styleSheet.cssText=c:d.appendChild(document.createTextNode(c)),e=b,(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}a++},remove:function(){--a||!b||(b.parentNode&&b.parentNode.removeChild(b),b=null)}}},AV=function(){var a=AU();return function(b,c){eQ.useEffect(function(){return a.add(b),function(){a.remove()}},[b&&c])}},AW=function(){var a=AV();return function(b){return a(b.styles,b.dynamic),null}},AX={left:0,top:0,right:0,gap:0},AY=AW(),AZ="data-scroll-locked",A$=function(a,b,c,d){var e=a.left,f=a.top,g=a.right,h=a.gap;return void 0===c&&(c="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(d,";\n   padding-right: ").concat(h,"px ").concat(d,";\n  }\n  body[").concat(AZ,"] {\n    overflow: hidden ").concat(d,";\n    overscroll-behavior: contain;\n    ").concat([b&&"position: relative ".concat(d,";"),"margin"===c&&"\n    padding-left: ".concat(e,"px;\n    padding-top: ").concat(f,"px;\n    padding-right: ").concat(g,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(h,"px ").concat(d,";\n    "),"padding"===c&&"padding-right: ".concat(h,"px ").concat(d,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(AL," {\n    right: ").concat(h,"px ").concat(d,";\n  }\n  \n  .").concat(AM," {\n    margin-right: ").concat(h,"px ").concat(d,";\n  }\n  \n  .").concat(AL," .").concat(AL," {\n    right: 0 ").concat(d,";\n  }\n  \n  .").concat(AM," .").concat(AM," {\n    margin-right: 0 ").concat(d,";\n  }\n  \n  body[").concat(AZ,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(h,"px;\n  }\n")},A_=function(){var a=parseInt(document.body.getAttribute(AZ)||"0",10);return isFinite(a)?a:0},A0=function(){eQ.useEffect(function(){return document.body.setAttribute(AZ,(A_()+1).toString()),function(){var a=A_()-1;a<=0?document.body.removeAttribute(AZ):document.body.setAttribute(AZ,a.toString())}},[])},A1=function(a){var b=a.noRelative,c=a.noImportant,d=a.gapMode,e=void 0===d?"margin":d;A0();var f=eQ.useMemo(function(){return void 0===e,AX},[e]);return eQ.createElement(AY,{styles:A$(f,!b,e,c?"":"!important")})},A2=function(a,b){if(!(a instanceof Element))return!1;var c=window.getComputedStyle(a);return"hidden"!==c[b]&&(c.overflowY!==c.overflowX||"TEXTAREA"===a.tagName||"visible"!==c[b])},A3=function(a,b){var c=b.ownerDocument,d=b;do{if("undefined"!=typeof ShadowRoot&&d instanceof ShadowRoot&&(d=d.host),A4(a,d)){var e=A5(a,d);if(e[1]>e[2])return!0}d=d.parentNode}while(d&&d!==c.body)return!1},A4=function(a,b){return"v"===a?A2(b,"overflowY"):A2(b,"overflowX")},A5=function(a,b){return"v"===a?[b.scrollTop,b.scrollHeight,b.clientHeight]:[b.scrollLeft,b.scrollWidth,b.clientWidth]},A6=function(a,b,c,d,e){var f,g=(f=window.getComputedStyle(b).direction,"h"===a&&"rtl"===f?-1:1),h=g*d,i=c.target,j=b.contains(i),k=!1,l=h>0,m=0,n=0;do{if(!i)break;var o=A5(a,i),p=o[0],q=o[1]-o[2]-g*p;(p||q)&&A4(a,i)&&(m+=q,n+=p);var r=i.parentNode;i=r&&r.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.host:r}while(!j&&i!==document.body||j&&(b.contains(i)||b===i))return l&&(e&&1>Math.abs(m)||!e&&h>m)?k=!0:!l&&(e&&1>Math.abs(n)||!e&&-h>n)&&(k=!0),k},A7=function(a){return"changedTouches"in a?[a.changedTouches[0].clientX,a.changedTouches[0].clientY]:[0,0]},A8=function(a){return[a.deltaX,a.deltaY]},A9=function(a){return a&&"current"in a?a.current:a},Ba=0,Bb=[];let Bc=(w=function(a){var b=eQ.useRef([]),c=eQ.useRef([0,0]),d=eQ.useRef(),e=eQ.useState(Ba++)[0],f=eQ.useState(AW)[0],g=eQ.useRef(a);eQ.useEffect(function(){g.current=a},[a]),eQ.useEffect(function(){if(a.inert){document.body.classList.add("block-interactivity-".concat(e));var b=(function(a,b,c){if(c||2==arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))})([a.lockRef.current],(a.shards||[]).map(A9),!0).filter(Boolean);return b.forEach(function(a){return a.classList.add("allow-interactivity-".concat(e))}),function(){document.body.classList.remove("block-interactivity-".concat(e)),b.forEach(function(a){return a.classList.remove("allow-interactivity-".concat(e))})}}},[a.inert,a.lockRef.current,a.shards]);var h=eQ.useCallback(function(a,b){if("touches"in a&&2===a.touches.length||"wheel"===a.type&&a.ctrlKey)return!g.current.allowPinchZoom;var e,f=A7(a),h=c.current,i="deltaX"in a?a.deltaX:h[0]-f[0],j="deltaY"in a?a.deltaY:h[1]-f[1],k=a.target,l=Math.abs(i)>Math.abs(j)?"h":"v";if("touches"in a&&"h"===l&&"range"===k.type)return!1;var m=A3(l,k);if(!m)return!0;if(m?e=l:(e="v"===l?"h":"v",m=A3(l,k)),!m)return!1;if(!d.current&&"changedTouches"in a&&(i||j)&&(d.current=e),!e)return!0;var n=d.current||e;return A6(n,b,a,"h"===n?i:j,!0)},[]),i=eQ.useCallback(function(a){if(Bb.length&&Bb[Bb.length-1]===f){var c="deltaY"in a?A8(a):A7(a),d=b.current.filter(function(b){var d;return b.name===a.type&&(b.target===a.target||a.target===b.shadowParent)&&(d=b.delta,d[0]===c[0]&&d[1]===c[1])})[0];if(d&&d.should){a.cancelable&&a.preventDefault();return}if(!d){var e=(g.current.shards||[]).map(A9).filter(Boolean).filter(function(b){return b.contains(a.target)});(e.length>0?h(a,e[0]):!g.current.noIsolation)&&a.cancelable&&a.preventDefault()}}},[]),j=eQ.useCallback(function(a,c,d,e){var f={name:a,delta:c,target:d,should:e,shadowParent:function(a){for(var b=null;null!==a;)a instanceof ShadowRoot&&(b=a.host,a=a.host),a=a.parentNode;return b}(d)};b.current.push(f),setTimeout(function(){b.current=b.current.filter(function(a){return a!==f})},1)},[]),k=eQ.useCallback(function(a){c.current=A7(a),d.current=void 0},[]),l=eQ.useCallback(function(b){j(b.type,A8(b),b.target,h(b,a.lockRef.current))},[]),m=eQ.useCallback(function(b){j(b.type,A7(b),b.target,h(b,a.lockRef.current))},[]);eQ.useEffect(function(){return Bb.push(f),a.setCallbacks({onScrollCapture:l,onWheelCapture:l,onTouchMoveCapture:m}),document.addEventListener("wheel",i,!1),document.addEventListener("touchmove",i,!1),document.addEventListener("touchstart",k,!1),function(){Bb=Bb.filter(function(a){return a!==f}),document.removeEventListener("wheel",i,!1),document.removeEventListener("touchmove",i,!1),document.removeEventListener("touchstart",k,!1)}},[]);var n=a.removeScrollBar,o=a.inert;return eQ.createElement(eQ.Fragment,null,o?eQ.createElement(f,{styles:"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")}):null,n?eQ.createElement(A1,{noRelative:a.noRelative,gapMode:a.gapMode}):null)},AQ.useMedium(w),AT);var Bd=eQ.forwardRef(function(a,b){return eQ.createElement(AS,AJ({},a,{ref:b,sideCar:Bc}))});Bd.classNames=AS.classNames;var Be=new WeakMap,Bf=new WeakMap,Bg={},Bh=0,Bi=function(a){return a&&(a.host||Bi(a.parentNode))},Bj=function(a,b,c,d){var e=(Array.isArray(a)?a:[a]).map(function(a){if(b.contains(a))return a;var c=Bi(a);return c&&b.contains(c)?c:(console.error("aria-hidden",a,"in not contained inside",b,". Doing nothing"),null)}).filter(function(a){return!!a});Bg[c]||(Bg[c]=new WeakMap);var f=Bg[c],g=[],h=new Set,i=new Set(e),j=function(a){!a||h.has(a)||(h.add(a),j(a.parentNode))};e.forEach(j);var k=function(a){!a||i.has(a)||Array.prototype.forEach.call(a.children,function(a){if(h.has(a))k(a);else try{var b=a.getAttribute(d),e=null!==b&&"false"!==b,i=(Be.get(a)||0)+1,j=(f.get(a)||0)+1;Be.set(a,i),f.set(a,j),g.push(a),1===i&&e&&Bf.set(a,!0),1===j&&a.setAttribute(c,"true"),e||a.setAttribute(d,"true")}catch(b){console.error("aria-hidden: cannot operate on ",a,b)}})};return k(b),h.clear(),Bh++,function(){g.forEach(function(a){var b=Be.get(a)-1,e=f.get(a)-1;Be.set(a,b),f.set(a,e),b||(Bf.has(a)||a.removeAttribute(d),Bf.delete(a)),e||a.removeAttribute(c)}),--Bh||(Be=new WeakMap,Be=new WeakMap,Bf=new WeakMap,Bg={})}},Bk=function(a,b,c){void 0===c&&(c="data-aria-hidden");var d=Array.from(Array.isArray(a)?a:[a]),e=b||("undefined"==typeof document?null:(Array.isArray(a)?a[0]:a).ownerDocument.body);return e?(d.push.apply(d,Array.from(e.querySelectorAll("[aria-live], script"))),Bj(d,e,c,"aria-hidden")):function(){return null}},Bl="Dialog",[Bm,Bn]=z8(Bl),[Bo,Bp]=Bm(Bl),Bq=a=>{let{__scopeDialog:b,children:c,open:d,defaultOpen:e,onOpenChange:f,modal:g=!0}=a,h=eQ.useRef(null),i=eQ.useRef(null),[j,k]=Ae({prop:d,defaultProp:e??!1,onChange:f,caller:Bl});return(0,bT.jsx)(Bo,{scope:b,triggerRef:h,contentRef:i,contentId:Ac(),titleId:Ac(),descriptionId:Ac(),open:j,onOpenChange:k,onOpenToggle:eQ.useCallback(()=>k(a=>!a),[k]),modal:g,children:c})};Bq.displayName=Bl;var Br="DialogTrigger",Bs=eQ.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=Bp(Br,c),f=z7(b,e.triggerRef);return(0,bT.jsx)(Al.button,{type:"button","aria-haspopup":"dialog","aria-expanded":e.open,"aria-controls":e.contentId,"data-state":BM(e.open),...d,ref:f,onClick:z4(a.onClick,e.onOpenToggle)})});Bs.displayName=Br;var Bt="DialogPortal",[Bu,Bv]=Bm(Bt,{forceMount:void 0}),Bw=a=>{let{__scopeDialog:b,forceMount:c,children:d,container:e}=a,f=Bp(Bt,b);return(0,bT.jsx)(Bu,{scope:b,forceMount:c,children:eQ.Children.map(d,a=>(0,bT.jsx)(AE,{present:c||f.open,children:(0,bT.jsx)(AD,{asChild:!0,container:e,children:a})}))})};Bw.displayName=Bt;var Bx="DialogOverlay",By=eQ.forwardRef((a,b)=>{let c=Bv(Bx,a.__scopeDialog),{forceMount:d=c.forceMount,...e}=a,f=Bp(Bx,a.__scopeDialog);return f.modal?(0,bT.jsx)(AE,{present:d||f.open,children:(0,bT.jsx)(BA,{...e,ref:b})}):null});By.displayName=Bx;var Bz=Af("DialogOverlay.RemoveScroll"),BA=eQ.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=Bp(Bx,c);return(0,bT.jsx)(Bd,{as:Bz,allowPinchZoom:!0,shards:[e.contentRef],children:(0,bT.jsx)(Al.div,{"data-state":BM(e.open),...d,ref:b,style:{pointerEvents:"auto",...d.style}})})}),BB="DialogContent",BC=eQ.forwardRef((a,b)=>{let c=Bv(BB,a.__scopeDialog),{forceMount:d=c.forceMount,...e}=a,f=Bp(BB,a.__scopeDialog);return(0,bT.jsx)(AE,{present:d||f.open,children:f.modal?(0,bT.jsx)(BD,{...e,ref:b}):(0,bT.jsx)(BE,{...e,ref:b})})});BC.displayName=BB;var BD=eQ.forwardRef((a,b)=>{let c=Bp(BB,a.__scopeDialog),d=eQ.useRef(null),e=z7(b,c.contentRef,d);return eQ.useEffect(()=>{let a=d.current;if(a)return Bk(a)},[]),(0,bT.jsx)(BF,{...a,ref:e,trapFocus:c.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:z4(a.onCloseAutoFocus,a=>{a.preventDefault(),c.triggerRef.current?.focus()}),onPointerDownOutside:z4(a.onPointerDownOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey;(2===b.button||c)&&a.preventDefault()}),onFocusOutside:z4(a.onFocusOutside,a=>a.preventDefault())})}),BE=eQ.forwardRef((a,b)=>{let c=Bp(BB,a.__scopeDialog),d=eQ.useRef(!1),e=eQ.useRef(!1);return(0,bT.jsx)(BF,{...a,ref:b,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),b.defaultPrevented||(d.current||c.triggerRef.current?.focus(),b.preventDefault()),d.current=!1,e.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||(d.current=!0,"pointerdown"===b.detail.originalEvent.type&&(e.current=!0));let f=b.target;c.triggerRef.current?.contains(f)&&b.preventDefault(),"focusin"===b.detail.originalEvent.type&&e.current&&b.preventDefault()}})}),BF=eQ.forwardRef((a,b)=>{let{__scopeDialog:c,trapFocus:d,onOpenAutoFocus:e,onCloseAutoFocus:f,...g}=a,h=Bp(BB,c),i=eQ.useRef(null),j=z7(b,i);return AH(),(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Ax,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:e,onUnmountAutoFocus:f,children:(0,bT.jsx)(Aq,{role:"dialog",id:h.contentId,"aria-describedby":h.descriptionId,"aria-labelledby":h.titleId,"data-state":BM(h.open),...g,ref:j,onDismiss:()=>h.onOpenChange(!1)})}),(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(BQ,{titleId:h.titleId}),(0,bT.jsx)(BR,{contentRef:i,descriptionId:h.descriptionId})]})]})}),BG="DialogTitle",BH=eQ.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=Bp(BG,c);return(0,bT.jsx)(Al.h2,{id:e.titleId,...d,ref:b})});BH.displayName=BG;var BI="DialogDescription",BJ=eQ.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=Bp(BI,c);return(0,bT.jsx)(Al.p,{id:e.descriptionId,...d,ref:b})});BJ.displayName=BI;var BK="DialogClose",BL=eQ.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=Bp(BK,c);return(0,bT.jsx)(Al.button,{type:"button",...d,ref:b,onClick:z4(a.onClick,()=>e.onOpenChange(!1))})});function BM(a){return a?"open":"closed"}BL.displayName=BK;var BN="DialogTitleWarning",[BO,BP]=(y={contentName:BB,titleName:BG,docsSlug:"dialog"},l=eQ.createContext(y),(m=a=>{let{children:b,...c}=a,d=eQ.useMemo(()=>c,Object.values(c));return(0,bT.jsx)(l.Provider,{value:d,children:b})}).displayName=BN+"Provider",[m,function(a){let b=eQ.useContext(l);if(b)return b;if(void 0!==y)return y;throw Error(`\`${a}\` must be used within \`${BN}\``)}]),BQ=({titleId:a})=>{let b=BP(BN),c=`\`${b.contentName}\` requires a \`${b.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${b.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${b.docsSlug}`;return eQ.useEffect(()=>{a&&(document.getElementById(a)||console.error(c))},[c,a]),null},BR=({contentRef:a,descriptionId:b})=>{let c=BP("DialogDescriptionWarning"),d=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${c.contentName}}.`;return eQ.useEffect(()=>{let c=a.current?.getAttribute("aria-describedby");b&&c&&(document.getElementById(b)||console.warn(d))},[d,a,b]),null};a.s(["Close",()=>BL,"Content",()=>BC,"Description",()=>BJ,"Dialog",()=>Bq,"DialogClose",()=>BL,"DialogContent",()=>BC,"DialogDescription",()=>BJ,"DialogOverlay",()=>By,"DialogPortal",()=>Bw,"DialogTitle",()=>BH,"DialogTrigger",()=>Bs,"Overlay",()=>By,"Portal",()=>Bw,"Root",()=>Bq,"Title",()=>BH,"Trigger",()=>Bs,"WarningProvider",()=>BO,"createDialogScope",()=>Bn],97942);var BS=a.i(97942),BS=BS;let BT=(0,eQ.memo)(function({label:a,small:b,invertIcon:c,icon:d,color:e,className:f,...g}){return"string"==typeof d?(0,bT.jsx)(BU,{label:a,small:b,invertIcon:c,icon:d,color:e,className:f,...g}):(0,eQ.cloneElement)(d,{...g,className:(0,j1.default)({"tlui-icon__small":b},f,d.props.className),"aria-label":a,style:{color:e,transform:c?"scale(-1, 1)":void 0,...d.props.style}})});function BU({label:a,small:b,invertIcon:c,icon:d,color:e,className:f,...g}){let h=zJ(),i=h.icons[d]??h.icons["question-mark-circle"],j=(0,eQ.useRef)(null);return((0,eQ.useLayoutEffect)(()=>{i||console.error(`Icon not found: ${d}. Add it to the assetUrls.icons object.`),j?.current&&(j.current.style.webkitMask=`url(${i}) center 100% / 100% no-repeat`)},[j,i,d]),"none"===d)?(0,bT.jsx)("div",{className:(0,j1.default)("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":b},f),...g}):(0,bT.jsx)("div",{...g,ref:j,"aria-label":a,role:"img",className:(0,j1.default)("tlui-icon",{"tlui-icon__small":b},f),style:{color:e,mask:`url(${i}) center 100% / 100% no-repeat`,transform:c?"scale(-1, 1)":void 0}})}function BV({icon:a,small:b,invertIcon:c}){return(0,bT.jsx)(BT,{"aria-hidden":"true",label:"",className:"tlui-button__icon",icon:a,small:b,invertIcon:c})}function BW({className:a,children:b}){return(0,bT.jsx)("div",{className:(0,j1.default)("tlui-dialog__header",a),children:b})}function BX({className:a,children:b,style:c}){return(0,bT.jsx)(BS.Title,{dir:"ltr",className:(0,j1.default)("tlui-dialog__header__title",a),style:c,children:b})}function BY(){let a=zQ();return(0,bT.jsx)("div",{className:"tlui-dialog__header__close",children:(0,bT.jsx)(BS.DialogClose,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,bT.jsx)(zS,{type:"icon","aria-label":a("ui.close"),onTouchEnd:a=>a.target.click(),children:(0,bT.jsx)(BV,{small:!0,icon:"cross-2"})})})})}function BZ({className:a,children:b,style:c}){return(0,bT.jsx)("div",{className:(0,j1.default)("tlui-dialog__body",a),style:c,tabIndex:0,children:b})}function B$({className:a,children:b}){return(0,bT.jsx)("div",{className:(0,j1.default)("tlui-dialog__footer",a),children:b})}let B_=eQ.forwardRef(function({className:a,label:b,icon:c,iconLeft:d,iconLabel:e,autoSelect:f=!1,autoFocus:g=!1,defaultValue:h,placeholder:i,onComplete:j,onValueChange:k,onCancel:l,onFocus:m,onBlur:n,shouldManuallyMaintainScrollPositionWhenFocused:o=!1,children:p,value:q,"data-testid":r,disabled:s,"aria-label":t},u){let v=kq(),w=eQ.useRef(null);eQ.useImperativeHandle(u,()=>w.current);let y=zQ(),z=eQ.useRef(h??""),A=eQ.useRef(h??""),B=eQ.useRef(!1),[C,D]=eQ.useState(!1),E=eQ.useCallback(a=>{D(!0);let b=a.currentTarget;A.current=b.value,v?v.timers.requestAnimationFrame(()=>{f&&b.select()}):m4.requestAnimationFrame("anon",()=>{f&&b.select()}),m?.()},[f,v,m]),F=eQ.useCallback(a=>{let b=a.currentTarget.value;A.current=b,k?.(b)},[k]),G=eQ.useCallback(a=>{switch(a.key){case"Enter":if(B.current)return;a.currentTarget.blur(),a.stopPropagation(),j?.(a.currentTarget.value);break;case"Escape":a.currentTarget.value=z.current,l?.(a.currentTarget.value),a.currentTarget.blur(),a.stopPropagation()}},[j,l]),H=eQ.useCallback(a=>{D(!1);let b=a.currentTarget.value;n?.(b)},[n]),I=eQ.useCallback(()=>B.current=!0,[]),J=eQ.useCallback(()=>B.current=!1,[]);return eQ.useEffect(()=>{1},[C,v,o]),(0,bT.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,b&&(0,bT.jsx)("label",{children:y(b)}),d&&(0,bT.jsx)(BT,{label:e?y(e):"",icon:d,className:"tlui-icon-left",small:!0}),(0,bT.jsx)("input",{ref:w,className:(0,j1.default)("tlui-input",a),type:"text",defaultValue:h,onKeyDownCapture:G,onChange:F,onFocus:E,onBlur:H,onCompositionStart:I,onCompositionEnd:J,autoFocus:g,"aria-label":t,placeholder:i,value:q,"data-testid":r,disabled:s}),c&&(0,bT.jsx)(BT,{label:e?y(e):"",icon:c,small:!!b})]})});function B0(a){return z2.linkUrl.isValid(a)?{isValid:!0,hasProtocol:!0}:z2.linkUrl.isValid("https://"+a)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}let B1=eV(function({onClose:a}){let b=kp().getOnlySelectedShape();return b&&"url"in b.props&&"string"==typeof b.props.url?(0,bT.jsx)(B2,{onClose:a,selectedShape:b}):null}),B2=eV(function({onClose:a,selectedShape:b}){let c=kp(),d=zQ(),e=(0,eQ.useRef)(null);(0,eQ.useEffect)(()=>{c.timers.requestAnimationFrame(()=>e.current?.focus())},[c]);let f=(0,eQ.useRef)(b.props.url),[g,h]=(0,eQ.useState)(()=>{let a=B0(b.props.url),c=!0===a.isValid?a.hasProtocol?b.props.url:"https://"+b.props.url:"https://";return{actual:c,safe:c,valid:!0}}),i=(0,eQ.useCallback)(a=>{let b=a.replace(/https?:\/\/(https?:\/\/)/,(a,b)=>b),c=B0(b),d=!0===c.isValid?c.hasProtocol?b:"https://"+b:"https://";h({actual:b,safe:d,valid:c.isValid})},[]),j=(0,eQ.useCallback)(()=>{let b=c.getOnlySelectedShape();b&&(c.updateShapes([{id:b.id,type:b.type,props:{url:""}}]),a())},[c,a]),k=(0,eQ.useCallback)(()=>{let b=c.getOnlySelectedShape();b&&(b&&"url"in b.props&&b.props.url!==g.safe&&c.updateShapes([{id:b.id,type:b.type,props:{url:g.safe}}]),a())},[c,a,g]),l=(0,eQ.useCallback)(()=>{a()},[a]);if(!b)return a(),null;let m=f.current&&!g.valid;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(BW,{children:[(0,bT.jsx)(BX,{children:d("edit-link-dialog.title")}),(0,bT.jsx)(BY,{})]}),(0,bT.jsx)(BZ,{children:(0,bT.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,bT.jsx)(B_,{ref:e,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,autoSelect:!0,placeholder:"https://example.com",value:g.actual,onValueChange:i,onComplete:k,onCancel:l}),(0,bT.jsx)("div",{children:d(g.valid?"edit-link-dialog.detail":"edit-link-dialog.invalid-url")})]})}),(0,bT.jsxs)(B$,{className:"tlui-dialog__footer__actions",children:[(0,bT.jsx)(zS,{type:"normal",onClick:l,onTouchEnd:l,children:(0,bT.jsx)(z3,{children:d("edit-link-dialog.cancel")})}),m?(0,bT.jsx)(zS,{type:"danger",onTouchEnd:j,onClick:j,children:(0,bT.jsx)(z3,{children:d("edit-link-dialog.clear")})}):(0,bT.jsx)(zS,{type:"primary",disabled:!g.valid,onTouchEnd:k,onClick:k,children:(0,bT.jsx)(z3,{children:d("edit-link-dialog.save")})})]})]})}),B3=/(^\/[f|p|r|ro|s|v]\/[^/]+\/?$)/,B4=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(B3))return b.searchParams.append("embed","true"),a},fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(B3))return b.searchParams.delete("embed"),a},embedOnPaste:!1},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:a=>{if(a.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto|design)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!a.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${a}`},fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/embed\/?$/)){let a=b.searchParams.get("url");if(a)return a}},embedOnPaste:!0},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:a=>{if(a.includes("/maps/embed?"))return a;if(a.includes("/maps/")){let b,c=a.match(/@(.*?),(.*?),(.*?)(z|m)/);if(c){let[,d,e,f,g]=c,h="z"===g?"roadmap":"satellite",i="roadmap"===h?f:-Math.log2(parseInt(f)/0xe16861)/.8,j=new URL(a).host.replace("www.","");b=`https://${j}/maps/embed/v1/view?key=${process.env.NEXT_PUBLIC_GC_API_KEY}&center=${d},${e}&zoom=${i}&maptype=${h}`}else b="";return b}},fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&b.searchParams.has("center")&&b.searchParams.get("zoom")){let a=b.searchParams.get("zoom")??"12",c=b.searchParams.get("maptype")??"roadmap",d="roadmap"===c?a:0xe16861*Math.pow(2,-.8*parseInt(a)),[e,f]=b.searchParams.get("center").split(",");return`https://www.google.com/maps/@${e},${f},${d}${"roadmap"===c?"z":"m"}`}},embedOnPaste:!0},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:a=>{let b=dV(a),c=b&&b.pathname.match(/\/v\/(.+)\/?/);if(c)return`https://www.val.town/embed/${c[1]}`},fromEmbedUrl:a=>{let b=dV(a),c=b&&b.pathname.match(/\/embed\/(.+)\/?/);if(c)return`https://www.val.town/v/${c[1]}`},embedOnPaste:!0},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:a=>{let b=dV(a),c=b&&b.pathname.match(/\/s\/([^/]+)\/?/);if(c)return`https://codesandbox.io/embed/${c[1]}`},fromEmbedUrl:a=>{let b=dV(a),c=b&&b.pathname.match(/\/embed\/([^/]+)\/?/);if(c)return`https://codesandbox.io/s/${c[1]}`},embedOnPaste:!0},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:a=>{let b=a.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(b){let[a,c,d]=b;return`https://codepen.io/${c}/embed/${d}`}},fromEmbedUrl:a=>{let b=a.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(b){let[a,c,d]=b;return`https://codepen.io/${c}/pen/${d}`}},embedOnPaste:!0},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,embedOnPaste:!0,toEmbedUrl:a=>{let b=a.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(b){let[a,c]=b;return`https://scratch.mit.edu/projects/embed/${c}`}},fromEmbedUrl:a=>{let b=a.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(b){let[a,c]=b;return`https://scratch.mit.edu/projects/${c}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(!b)return;let c=b.hostname.replace(/^www./,"");if("youtu.be"===c){let a=b.pathname.split("/").filter(Boolean)[0],c=new URLSearchParams(b.search),d=c.get("t");d&&(c.set("start",d),c.delete("t"));let e=c.toString()?"?"+c.toString():"";return`https://www.youtube.com/embed/${a}${e}`}if(("youtube.com"===c||"m.youtube.com"===c)&&b.pathname.match(/^\/watch/)){let a=b.searchParams.get("v"),c=new URLSearchParams(b.search);c.delete("v");let d=c.get("t");d&&(c.set("start",d),c.delete("t"));let e=c.toString()?"?"+c.toString():"";return`https://www.youtube.com/embed/${a}${e}`}},fromEmbedUrl:a=>{let b=dV(a);if(b&&"youtube.com"===b.hostname.replace(/^www./,"")){let a=b.pathname.match(/^\/embed\/([^/]+)\/?/);if(a){let c=new URLSearchParams(b.search);c.set("v",a?.[1]??"");let d=c.get("start");return d&&(c.set("t",d),c.delete("start")),`https://www.youtube.com/watch?${c.toString()}`}}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a),c=b?.searchParams.get("cid");if(b?.pathname.match(/\/calendar\/u\/0/)&&c){for(let a of(b.pathname="/calendar/embed",Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.searchParams.set("src",c),b.href}},fromEmbedUrl:a=>{let b=dV(a),c=b?.searchParams.get("src");if(b?.pathname.match(/\/calendar\/embed/)&&c){for(let a of(b.pathname="/calendar/u/0",Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.searchParams.set("cid",c),b.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(b?.pathname.match(/^\/presentation/)&&b?.pathname.match(/\/pub\/?$/)){for(let a of(b.pathname=b.pathname.replace(/\/pub$/,"/embed"),Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.href}},fromEmbedUrl:a=>{let b=dV(a);if(b?.pathname.match(/^\/presentation/)&&b?.pathname.match(/\/embed\/?$/)){for(let a of(b.pathname=b.pathname.replace(/\/embed$/,"/pub"),Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/)){if(!a.split("/").pop())return;return a}},fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/)){if(!a.split("/").pop())return;return a}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/\/@([^/]+)\/([^/]+)/))return b.searchParams.append("embed","true"),b.href},fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/\/@([^/]+)\/([^/]+)/)&&b.searchParams.has("embed"))return b.searchParams.delete("embed"),b.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/map\//))return b.origin+"/embed"+b.pathname},fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/embed\/map\//))return b.pathname=b.pathname.replace(/^\/embed/,""),b.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/(artist|album)\//))return b.origin+"/embed"+b.pathname},fromEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/embed\/(artist|album)\//))return b.origin+b.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(b&&"vimeo.com"===b.hostname&&b.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+b.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:a=>{let b=dV(a);if(b&&"player.vimeo.com"===b.hostname){let a=b.pathname.match(/^\/video\/([^/]+)\/?$/);if(a)return"https://vimeo.com/"+a[1]}}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(b&&b.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${b.origin}/embed${b.pathname}?cell=*`;if(b&&b.pathname.match(/^\/d\/([^/]+)\/?$/)){let a=b.pathname.replace(/^\/d/,"");return`${b.origin}/embed${a}?cell=*`}},fromEmbedUrl:a=>{let b=dV(a);return b&&b.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${b.origin}${b.pathname.replace("/embed","")}#cell-*`:b&&b.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${b.origin}${b.pathname.replace("/embed","/d")}#cell-*`:void 0}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dV(a);if(b&&"www.desmos.com"===b.hostname&&b.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&""===b.search&&""===b.hash)return`${a}?embed`},fromEmbedUrl:a=>{let b=dV(a);if(b&&"www.desmos.com"===b.hostname&&b.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===b.search&&""===b.hash)return a.replace("?embed","")}}],B5={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},B6=B4.map(a=>a.type);function B7(){let a=kq();if(a&&a.hasShapeUtil("embed"))return a.getShapeUtil("embed")}function B8(){let a=B7();return b=>a?a.getEmbedDefinition(b):void 0}let B9=eV(function({onClose:a}){let b,c=kp(),d=zQ(),e=zJ(),[f,g]=(0,eQ.useState)(null),[h,i]=(0,eQ.useState)(""),[j,k]=(0,eQ.useState)(null),[l,m]=(0,eQ.useState)(!1),n=(0,eQ.useRef)(-1),o=(b=B7())?b.getEmbedDefinitions():[],p=B8();return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(BW,{children:[(0,bT.jsx)(BX,{children:f?`${d("embed-dialog.title")} \u2014 ${f.title}`:d("embed-dialog.title")}),(0,bT.jsx)(BY,{})]}),f?(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(BZ,{className:"tlui-embed-dialog__enter",children:[(0,bT.jsx)(B_,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:a=>{i(a);let b=p(a);k(b&&b.definition.type===f.type?b:null),m(!1),clearTimeout(n.current),n.current=c.timers.setTimeout(()=>m(!b),320)}}),""===h?(0,bT.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,bT.jsx)("span",{children:d("embed-dialog.instruction")})," ",f.instructionLink&&(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:f.instructionLink,className:"tlui-embed-dialog__instruction__link",children:"Learn more"}),"."]})]}):(0,bT.jsx)("div",{className:"tlui-embed-dialog__warning",children:l?d("embed-dialog.invalid-url"):" "})]}),(0,bT.jsxs)(B$,{className:"tlui-dialog__footer__actions",children:[(0,bT.jsx)(zS,{type:"normal",onClick:()=>{g(null),k(null),i("")},children:(0,bT.jsx)(z3,{children:d("embed-dialog.back")})}),(0,bT.jsx)("div",{className:"tlui-embed__spacer"}),(0,bT.jsx)(zS,{type:"normal",onClick:a,children:(0,bT.jsx)(z3,{children:d("embed-dialog.cancel")})}),(0,bT.jsx)(zS,{type:"primary",disabled:!j,onClick:()=>{j&&(c.putExternalContent({type:"embed",url:h,point:c.getViewportPageBounds().center,embed:j.definition}),a())},children:(0,bT.jsx)(z3,{children:d("embed-dialog.create")})})]})]}):(0,bT.jsx)(bT.Fragment,{children:(0,bT.jsx)(BZ,{className:"tlui-embed-dialog__list",children:o.map(a=>{var b;let c=(b=a.type,B6.includes(b))?e.embedIcons[a.type]:"icon"in a?a.icon:void 0;return(0,bT.jsxs)(zS,{type:"menu",onClick:()=>g(a),children:[(0,bT.jsx)(z3,{children:a.title}),c&&(0,bT.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${c})`}})]},a.type)})})})]})}),Ca=[0,389,436,476,580,640,840,1023];var Cb=((z=Cb||{})[z.ZERO=0]="ZERO",z[z.MOBILE_XXS=1]="MOBILE_XXS",z[z.MOBILE_XS=2]="MOBILE_XS",z[z.MOBILE_SM=3]="MOBILE_SM",z[z.MOBILE=4]="MOBILE",z[z.TABLET_SM=5]="TABLET_SM",z[z.TABLET=6]="TABLET",z[z.DESKTOP=7]="DESKTOP",z);let Cc=eQ.default.createContext(null);function Cd({forceMobile:a=!1,children:b}){let c=kq(),d=e$("breakpoint",()=>{let{width:b}=c?.getViewportScreenBounds()??{width:window.innerWidth},d=a?Cb.MOBILE_SM:Ca.length-1;for(let a=0;a<d;a++)if(b>Ca[a]&&b<=Ca[a+1])return a;return d},[c]);return(0,bT.jsx)(Cc.Provider,{value:d,children:b})}function Ce(){let a=(0,eQ.useContext)(Cc);if(null===a)throw Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return a}let Cf=(0,eQ.createContext)(null);function Cg(){let a=(0,eQ.useContext)(Cf);if(!a)throw Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return a}function Ch({type:a,sourceId:b,children:c}){return(0,bT.jsx)(Cf.Provider,{value:{type:a,sourceId:b},children:c})}function Ci(){let a=kq();return a?.store.props.collaboration!==void 0}function Cj(a){let b=a+"CollectionProvider",[c,d]=z8(b),[e,f]=c(b,{collectionRef:{current:null},itemMap:new Map}),g=a=>{let{scope:b,children:c}=a,d=eQ.default.useRef(null),f=eQ.default.useRef(new Map).current;return(0,bT.jsx)(e,{scope:b,itemMap:f,collectionRef:d,children:c})};g.displayName=b;let h=a+"CollectionSlot",i=Af(h),j=eQ.default.forwardRef((a,b)=>{let{scope:c,children:d}=a,e=z7(b,f(h,c).collectionRef);return(0,bT.jsx)(i,{ref:e,children:d})});j.displayName=h;let k=a+"CollectionItemSlot",l="data-radix-collection-item",m=Af(k),n=eQ.default.forwardRef((a,b)=>{let{scope:c,children:d,...e}=a,g=eQ.default.useRef(null),h=z7(b,g),i=f(k,c);return eQ.default.useEffect(()=>(i.itemMap.set(g,{ref:g,...e}),()=>void i.itemMap.delete(g))),(0,bT.jsx)(m,{...{[l]:""},ref:h,children:d})});return n.displayName=k,[{Provider:g,Slot:j,ItemSlot:n},function(b){let c=f(a+"CollectionConsumer",b);return eQ.default.useCallback(()=>{let a=c.collectionRef.current;if(!a)return[];let b=Array.from(a.querySelectorAll(`[${l}]`));return Array.from(c.itemMap.values()).sort((a,c)=>b.indexOf(a.ref.current)-b.indexOf(c.ref.current))},[c.collectionRef,c.itemMap])},d]}var Ck=new WeakMap;function Cl(a,b){var c,d;let e,f,g;if("at"in Array.prototype)return Array.prototype.at.call(a,b);let h=(c=a,d=b,e=c.length,(g=(f=Cm(d))>=0?f:e+f)<0||g>=e?-1:g);return -1===h?void 0:a[h]}function Cm(a){return a!=a||0===a?0:Math.trunc(a)}(class a extends Map{#a;constructor(a){super(a),this.#a=[...super.keys()],Ck.set(this,!0)}set(a,b){return Ck.get(this)&&(this.has(a)?this.#a[this.#a.indexOf(a)]=a:this.#a.push(a)),super.set(a,b),this}insert(a,b,c){let d,e=this.has(b),f=this.#a.length,g=Cm(a),h=g>=0?g:f+g,i=h<0||h>=f?-1:h;if(i===this.size||e&&i===this.size-1||-1===i)return this.set(b,c),this;let j=this.size+ +!e;g<0&&h++;let k=[...this.#a],l=!1;for(let a=h;a<j;a++)if(h===a){let f=k[a];k[a]===b&&(f=k[a+1]),e&&this.delete(b),d=this.get(f),this.set(b,c)}else{l||k[a-1]!==b||(l=!0);let c=k[l?a:a-1],e=d;d=this.get(c),this.delete(c),this.set(c,e)}return this}with(b,c,d){let e=new a(this);return e.insert(b,c,d),e}before(a){let b=this.#a.indexOf(a)-1;if(!(b<0))return this.entryAt(b)}setBefore(a,b,c){let d=this.#a.indexOf(a);return -1===d?this:this.insert(d,b,c)}after(a){let b=this.#a.indexOf(a);if(-1!==(b=-1===b||b===this.size-1?-1:b+1))return this.entryAt(b)}setAfter(a,b,c){let d=this.#a.indexOf(a);return -1===d?this:this.insert(d+1,b,c)}first(){return this.entryAt(0)}last(){return this.entryAt(-1)}clear(){return this.#a=[],super.clear()}delete(a){let b=super.delete(a);return b&&this.#a.splice(this.#a.indexOf(a),1),b}deleteAt(a){let b=this.keyAt(a);return void 0!==b&&this.delete(b)}at(a){let b=Cl(this.#a,a);if(void 0!==b)return this.get(b)}entryAt(a){let b=Cl(this.#a,a);if(void 0!==b)return[b,this.get(b)]}indexOf(a){return this.#a.indexOf(a)}keyAt(a){return Cl(this.#a,a)}from(a,b){let c=this.indexOf(a);if(-1===c)return;let d=c+b;return d<0&&(d=0),d>=this.size&&(d=this.size-1),this.at(d)}keyFrom(a,b){let c=this.indexOf(a);if(-1===c)return;let d=c+b;return d<0&&(d=0),d>=this.size&&(d=this.size-1),this.keyAt(d)}find(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return d;c++}}findIndex(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return c;c++}return -1}filter(b,c){let d=[],e=0;for(let a of this)Reflect.apply(b,c,[a,e,this])&&d.push(a),e++;return new a(d)}map(b,c){let d=[],e=0;for(let a of this)d.push([a[0],Reflect.apply(b,c,[a,e,this])]),e++;return new a(d)}reduce(...a){let[b,c]=a,d=0,e=c??this.at(0);for(let c of this)e=0===d&&1===a.length?c:Reflect.apply(b,this,[e,c,d,this]),d++;return e}reduceRight(...a){let[b,c]=a,d=c??this.at(-1);for(let c=this.size-1;c>=0;c--){let e=this.at(c);d=c===this.size-1&&1===a.length?e:Reflect.apply(b,this,[d,e,c,this])}return d}toSorted(b){return new a([...this.entries()].sort(b))}toReversed(){let b=new a;for(let a=this.size-1;a>=0;a--){let c=this.keyAt(a),d=this.get(c);b.set(c,d)}return b}toSpliced(...b){let c=[...this.entries()];return c.splice(...b),new a(c)}slice(b,c){let d=new a,e=this.size-1;if(void 0===b)return d;b<0&&(b+=this.size),void 0!==c&&c>0&&(e=c-1);for(let a=b;a<=e;a++){let b=this.keyAt(a),c=this.get(b);d.set(b,c)}return d}every(a,b){let c=0;for(let d of this){if(!Reflect.apply(a,b,[d,c,this]))return!1;c++}return!0}some(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return!0;c++}return!1}});var Cn=eQ.createContext(void 0);function Co(a){let b=eQ.useContext(Cn);return a||b||"ltr"}let Cp=["top","right","bottom","left"],Cq=Math.min,Cr=Math.max,Cs=Math.round,Ct=Math.floor,Cu=a=>({x:a,y:a}),Cv={left:"right",right:"left",bottom:"top",top:"bottom"},Cw={start:"end",end:"start"};function Cx(a,b){return"function"==typeof a?a(b):a}function Cy(a){return a.split("-")[0]}function Cz(a){return a.split("-")[1]}function CA(a){return"x"===a?"y":"x"}function CB(a){return"y"===a?"height":"width"}let CC=new Set(["top","bottom"]);function CD(a){return CC.has(Cy(a))?"y":"x"}function CE(a){return a.replace(/start|end/g,a=>Cw[a])}let CF=["left","right"],CG=["right","left"],CH=["top","bottom"],CI=["bottom","top"];function CJ(a){return a.replace(/left|right|bottom|top/g,a=>Cv[a])}function CK(a){return"number"!=typeof a?{top:0,right:0,bottom:0,left:0,...a}:{top:a,right:a,bottom:a,left:a}}function CL(a){let{x:b,y:c,width:d,height:e}=a;return{width:d,height:e,top:c,left:b,right:b+d,bottom:c+e,x:b,y:c}}function CM(a,b,c){let d,{reference:e,floating:f}=a,g=CD(b),h=CA(CD(b)),i=CB(h),j=Cy(b),k="y"===g,l=e.x+e.width/2-f.width/2,m=e.y+e.height/2-f.height/2,n=e[i]/2-f[i]/2;switch(j){case"top":d={x:l,y:e.y-f.height};break;case"bottom":d={x:l,y:e.y+e.height};break;case"right":d={x:e.x+e.width,y:m};break;case"left":d={x:e.x-f.width,y:m};break;default:d={x:e.x,y:e.y}}switch(Cz(b)){case"start":d[h]-=n*(c&&k?-1:1);break;case"end":d[h]+=n*(c&&k?-1:1)}return d}let CN=async(a,b,c)=>{let{placement:d="bottom",strategy:e="absolute",middleware:f=[],platform:g}=c,h=f.filter(Boolean),i=await (null==g.isRTL?void 0:g.isRTL(b)),j=await g.getElementRects({reference:a,floating:b,strategy:e}),{x:k,y:l}=CM(j,d,i),m=d,n={},o=0;for(let c=0;c<h.length;c++){let{name:f,fn:p}=h[c],{x:q,y:r,data:s,reset:t}=await p({x:k,y:l,initialPlacement:d,placement:m,strategy:e,middlewareData:n,rects:j,platform:g,elements:{reference:a,floating:b}});k=null!=q?q:k,l=null!=r?r:l,n={...n,[f]:{...n[f],...s}},t&&o<=50&&(o++,"object"==typeof t&&(t.placement&&(m=t.placement),t.rects&&(j=!0===t.rects?await g.getElementRects({reference:a,floating:b,strategy:e}):t.rects),{x:k,y:l}=CM(j,m,i)),c=-1)}return{x:k,y:l,placement:m,strategy:e,middlewareData:n}};async function CO(a,b){var c;void 0===b&&(b={});let{x:d,y:e,platform:f,rects:g,elements:h,strategy:i}=a,{boundary:j="clippingAncestors",rootBoundary:k="viewport",elementContext:l="floating",altBoundary:m=!1,padding:n=0}=Cx(b,a),o=CK(n),p=h[m?"floating"===l?"reference":"floating":l],q=CL(await f.getClippingRect({element:null==(c=await (null==f.isElement?void 0:f.isElement(p)))||c?p:p.contextElement||await (null==f.getDocumentElement?void 0:f.getDocumentElement(h.floating)),boundary:j,rootBoundary:k,strategy:i})),r="floating"===l?{x:d,y:e,width:g.floating.width,height:g.floating.height}:g.reference,s=await (null==f.getOffsetParent?void 0:f.getOffsetParent(h.floating)),t=await (null==f.isElement?void 0:f.isElement(s))&&await (null==f.getScale?void 0:f.getScale(s))||{x:1,y:1},u=CL(f.convertOffsetParentRelativeRectToViewportRelativeRect?await f.convertOffsetParentRelativeRectToViewportRelativeRect({elements:h,rect:r,offsetParent:s,strategy:i}):r);return{top:(q.top-u.top+o.top)/t.y,bottom:(u.bottom-q.bottom+o.bottom)/t.y,left:(q.left-u.left+o.left)/t.x,right:(u.right-q.right+o.right)/t.x}}function CP(a,b){return{top:a.top-b.height,right:a.right-b.width,bottom:a.bottom-b.height,left:a.left-b.width}}function CQ(a){return Cp.some(b=>a[b]>=0)}let CR=new Set(["left","top"]);async function CS(a,b){let{placement:c,platform:d,elements:e}=a,f=await (null==d.isRTL?void 0:d.isRTL(e.floating)),g=Cy(c),h=Cz(c),i="y"===CD(c),j=CR.has(g)?-1:1,k=f&&i?-1:1,l=Cx(b,a),{mainAxis:m,crossAxis:n,alignmentAxis:o}="number"==typeof l?{mainAxis:l,crossAxis:0,alignmentAxis:null}:{mainAxis:l.mainAxis||0,crossAxis:l.crossAxis||0,alignmentAxis:l.alignmentAxis};return h&&"number"==typeof o&&(n="end"===h?-1*o:o),i?{x:n*k,y:m*j}:{x:m*j,y:n*k}}function CT(a){return function(a){return!1}(a)?(a.nodeName||"").toLowerCase():"#document"}function CU(a){var b;return(null==a||null==(b=a.ownerDocument)?void 0:b.defaultView)||window}function CV(a){var b;return null==(b=(function(a){return!1}(a)?a.ownerDocument:a.document)||window.document)?void 0:b.documentElement}function CW(a){return!1}let CX=new Set(["inline","contents"]);function CY(a){let{overflow:b,overflowX:c,overflowY:d,display:e}=C7(a);return/auto|scroll|overlay|hidden|clip/.test(b+d+c)&&!CX.has(e)}let CZ=new Set(["table","td","th"]),C$=[":popover-open",":modal"];function C_(a){return C$.some(b=>{try{return a.matches(b)}catch(a){return!1}})}let C0=["transform","translate","scale","rotate","perspective"],C1=["transform","translate","scale","rotate","perspective","filter"],C2=["paint","layout","strict","content"];function C3(a){let b=C4(),c=a;return C0.some(a=>!!c[a]&&"none"!==c[a])||!!c.containerType&&"normal"!==c.containerType||!b&&!!c.backdropFilter&&"none"!==c.backdropFilter||!b&&!!c.filter&&"none"!==c.filter||C1.some(a=>(c.willChange||"").includes(a))||C2.some(a=>(c.contain||"").includes(a))}function C4(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}let C5=new Set(["html","body","#document"]);function C6(a){return C5.has(CT(a))}function C7(a){return CU(a).getComputedStyle(a)}function C8(a){return{scrollLeft:a.scrollX,scrollTop:a.scrollY}}function C9(a){if("html"===CT(a))return a;let b=a.assignedSlot||a.parentNode||!1||CV(a);return b}function Da(a,b,c){var d;void 0===b&&(b=[]),void 0===c&&(c=!0);let e=function a(b){let c=C9(b);return C6(c)?b.ownerDocument?b.ownerDocument.body:b.body:a(c)}(a),f=e===(null==(d=a.ownerDocument)?void 0:d.body),g=CU(e);if(f){let a=Db(g);return b.concat(g,g.visualViewport||[],CY(e)?e:[],a&&c?Da(a):[])}return b.concat(e,Da(e,[],c))}function Db(a){return a.parent&&Object.getPrototypeOf(a.parent)?a.frameElement:null}function Dc(a){let b=C7(a),c=parseFloat(b.width)||0,d=parseFloat(b.height)||0,e=!1,f=e?a.offsetWidth:c,g=e?a.offsetHeight:d,h=Cs(c)!==f||Cs(d)!==g;return h&&(c=f,d=g),{width:c,height:d,$:h}}function Dd(a){return 0,a.contextElement}function De(a){let b=Dd(a);1;return Cu(1)}let Df=Cu(0);function Dg(a){let b=CU(a);return C4()&&b.visualViewport?{x:b.visualViewport.offsetLeft,y:b.visualViewport.offsetTop}:Df}function Dh(a,b,c,d){var e;void 0===b&&(b=!1),void 0===c&&(c=!1);let f=a.getBoundingClientRect(),g=Dd(a),h=Cu(1);b&&(d||(h=De(a)));let i=(void 0===(e=c)&&(e=!1),d&&(!e||d===CU(g))&&e)?Dg(g):Cu(0),j=(f.left+i.x)/h.x,k=(f.top+i.y)/h.y,l=f.width/h.x,m=f.height/h.y;if(g){let a=CU(g),b=d,c=a,e=Db(c);for(;e&&d&&b!==c;){let a=De(e),b=e.getBoundingClientRect(),d=C7(e),f=b.left+(e.clientLeft+parseFloat(d.paddingLeft))*a.x,g=b.top+(e.clientTop+parseFloat(d.paddingTop))*a.y;j*=a.x,k*=a.y,l*=a.x,m*=a.y,j+=f,k+=g,e=Db(c=CU(e))}}return CL({width:l,height:m,x:j,y:k})}function Di(a,b){let c=C8(a).scrollLeft;return b?b.left+c:Dh(CV(a)).left+c}function Dj(a,b){let c=a.getBoundingClientRect();return{x:c.left+b.scrollLeft-Di(a,c),y:c.top+b.scrollTop}}function Dk(a,b,c){var d;let e;if("viewport"===b)e=function(a,b){let c=CU(a),d=CV(a),e=c.visualViewport,f=d.clientWidth,g=d.clientHeight,h=0,i=0;if(e){f=e.width,g=e.height;let a=C4();(!a||a&&"fixed"===b)&&(h=e.offsetLeft,i=e.offsetTop)}let j=Di(d);if(j<=0){let a=d.ownerDocument,b=a.body,c=getComputedStyle(b),e="CSS1Compat"===a.compatMode&&parseFloat(c.marginLeft)+parseFloat(c.marginRight)||0,g=Math.abs(d.clientWidth-b.clientWidth-e);g<=25&&(f-=g)}else j<=25&&(f+=j);return{width:f,height:g,x:h,y:i}}(a,c);else if("document"===b){let b,c,f,g,h,i,j;d=CV(a),b=CV(d),c=C8(d),f=d.ownerDocument.body,g=Cr(b.scrollWidth,b.clientWidth,f.scrollWidth,f.clientWidth),h=Cr(b.scrollHeight,b.clientHeight,f.scrollHeight,f.clientHeight),i=-c.scrollLeft+Di(d),j=-c.scrollTop,"rtl"===C7(f).direction&&(i+=Cr(b.clientWidth,f.clientWidth)-g),e={width:g,height:h,x:i,y:j}}else{1;{let c=Dg(a);e={x:b.x-c.x,y:b.y-c.y,width:b.width,height:b.height}}}return CL(e)}function Dl(a){return"static"===C7(a).position}function Dm(a,b){1;return null}function Dn(a,b){var c;let d=CU(a);if(C_(a))return d;1;{let b=C9(a);for(;b&&!C6(b);){0;b=C9(b)}return d}}let Do=async function(a){let b=this.getOffsetParent||Dn,c=this.getDimensions,d=await c(a.floating);return{reference:function(a,b,c){var d;let e=(d=0,!1),f=CV(b),g="fixed"===c,h=Dh(a,!0,g,b),i={scrollLeft:0,scrollTop:0},j=Cu(0);if(e||!e&&!g)if(("body"!==CT(b)||CY(f))&&(i=C8(b)),e){let a=Dh(b,!0,g,b);j.x=a.x+b.clientLeft,j.y=a.y+b.clientTop}else f&&(j.x=Di(f));g&&!e&&f&&(j.x=Di(f));let k=!f||e||g?Cu(0):Dj(f,i);return{x:h.left+i.scrollLeft-j.x-k.x,y:h.top+i.scrollTop-j.y-k.y,width:h.width,height:h.height}}(a.reference,await b(a.floating),a.strategy),floating:{x:0,y:0,width:d.width,height:d.height}}},Dp={convertOffsetParentRelativeRectToViewportRelativeRect:function(a){var b,c;let{elements:d,rect:e,offsetParent:f,strategy:g}=a,h="fixed"===g,i=CV(f),j=!!d&&C_(d.floating);if(f===i||j&&h)return e;let k={scrollLeft:0,scrollTop:0},l=Cu(1),m=Cu(0),n=(b=0,!1);(n||!n&&!h)&&(("body"!==CT(f)||CY(i))&&(k=C8(f)),c=0,0);let o=!i||n||h?Cu(0):Dj(i,k);return{width:e.width*l.x,height:e.height*l.y,x:e.x*l.x-k.scrollLeft*l.x+m.x+o.x,y:e.y*l.y-k.scrollTop*l.y+m.y+o.y}},getDocumentElement:CV,getClippingRect:function(a){let{element:b,boundary:c,rootBoundary:d,strategy:e}=a,f=[..."clippingAncestors"===c?C_(b)?[]:function(a,b){var c;let d=b.get(a);if(d)return d;let e=Da(a,[],!1).filter(a=>{var b;return b=0,!1}),f="fixed"===C7(a).position,g=f?C9(a):a;return c=0,b.set(a,e),e}(b,this._c):[].concat(c),d],g=f[0],h=f.reduce((a,c)=>{let d=Dk(b,c,e);return a.top=Cr(d.top,a.top),a.right=Cq(d.right,a.right),a.bottom=Cq(d.bottom,a.bottom),a.left=Cr(d.left,a.left),a},Dk(b,g,e));return{width:h.right-h.left,height:h.bottom-h.top,x:h.left,y:h.top}},getOffsetParent:Dn,getElementRects:Do,getClientRects:function(a){return Array.from(a.getClientRects())},getDimensions:function(a){let{width:b,height:c}=Dc(a);return{width:b,height:c}},getScale:De,isElement:CW,isRTL:function(a){return"rtl"===C7(a).direction}};function Dq(a,b){return a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height}let Dr=a=>({name:"arrow",options:a,async fn(b){let{x:c,y:d,placement:e,rects:f,platform:g,elements:h,middlewareData:i}=b,{element:j,padding:k=0}=Cx(a,b)||{};if(null==j)return{};let l=CK(k),m={x:c,y:d},n=CA(CD(e)),o=CB(n),p=await g.getDimensions(j),q="y"===n,r=q?"clientHeight":"clientWidth",s=f.reference[o]+f.reference[n]-m[n]-f.floating[o],t=m[n]-f.reference[n],u=await (null==g.getOffsetParent?void 0:g.getOffsetParent(j)),v=u?u[r]:0;v&&await (null==g.isElement?void 0:g.isElement(u))||(v=h.floating[r]||f.floating[o]);let w=v/2-p[o]/2-1,y=Cq(l[q?"top":"left"],w),z=Cq(l[q?"bottom":"right"],w),A=v-p[o]-z,B=v/2-p[o]/2+(s/2-t/2),C=Cr(y,Cq(B,A)),D=!i.arrow&&null!=Cz(e)&&B!==C&&f.reference[o]/2-(B<y?y:z)-p[o]/2<0,E=D?B<y?B-y:B-A:0;return{[n]:m[n]+E,data:{[n]:C,centerOffset:B-C-E,...D&&{alignmentOffset:E}},reset:D}}});var Ds="undefined"!=typeof document?eQ.useLayoutEffect:function(){};function Dt(a,b){let c,d,e;if(a===b)return!0;if(typeof a!=typeof b)return!1;if("function"==typeof a&&a.toString()===b.toString())return!0;if(a&&b&&"object"==typeof a){if(Array.isArray(a)){if((c=a.length)!==b.length)return!1;for(d=c;0!=d--;)if(!Dt(a[d],b[d]))return!1;return!0}if((c=(e=Object.keys(a)).length)!==Object.keys(b).length)return!1;for(d=c;0!=d--;)if(!({}).hasOwnProperty.call(b,e[d]))return!1;for(d=c;0!=d--;){let c=e[d];if(("_owner"!==c||!a.$$typeof)&&!Dt(a[c],b[c]))return!1}return!0}return a!=a&&b!=b}function Du(a,b){let c=1;return Math.round(b*c)/c}function Dv(a){let b=eQ.useRef(a);return Ds(()=>{b.current=a}),b}var Dw=eQ.forwardRef((a,b)=>{let{children:c,width:d=10,height:e=5,...f}=a;return(0,bT.jsx)(Al.svg,{...f,ref:b,width:d,height:e,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:a.asChild?c:(0,bT.jsx)("polygon",{points:"0,0 30,0 15,10"})})});function Dx(a){let[b,c]=eQ.useState(void 0);return z9(()=>{if(a){c({width:a.offsetWidth,height:a.offsetHeight});let b=new ResizeObserver(b=>{let d,e;if(!Array.isArray(b)||!b.length)return;let f=b[0];if("borderBoxSize"in f){let a=f.borderBoxSize,b=Array.isArray(a)?a[0]:a;d=b.inlineSize,e=b.blockSize}else d=a.offsetWidth,e=a.offsetHeight;c({width:d,height:e})});return b.observe(a,{box:"border-box"}),()=>b.unobserve(a)}c(void 0)},[a]),b}Dw.displayName="Arrow";var Dy="Popper",[Dz,DA]=z8(Dy),[DB,DC]=Dz(Dy),DD=a=>{let{__scopePopper:b,children:c}=a,[d,e]=eQ.useState(null);return(0,bT.jsx)(DB,{scope:b,anchor:d,onAnchorChange:e,children:c})};DD.displayName=Dy;var DE="PopperAnchor",DF=eQ.forwardRef((a,b)=>{let{__scopePopper:c,virtualRef:d,...e}=a,f=DC(DE,c),g=eQ.useRef(null),h=z7(b,g),i=eQ.useRef(null);return eQ.useEffect(()=>{let a=i.current;i.current=d?.current||g.current,a!==i.current&&f.onAnchorChange(i.current)}),d?null:(0,bT.jsx)(Al.div,{...e,ref:h})});DF.displayName=DE;var DG="PopperContent",[DH,DI]=Dz(DG),DJ=eQ.forwardRef((a,b)=>{var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;let{__scopePopper:y,side:z="bottom",sideOffset:A=0,align:B="center",alignOffset:C=0,arrowPadding:D=0,avoidCollisions:E=!0,collisionBoundary:F=[],collisionPadding:G=0,sticky:H="partial",hideWhenDetached:I=!1,updatePositionStrategy:J="optimized",onPlaced:K,...L}=a,M=DC(DG,y),[N,O]=eQ.useState(null),P=z7(b,a=>O(a)),[Q,R]=eQ.useState(null),S=Dx(Q),T=S?.width??0,U=S?.height??0,V="number"==typeof G?G:{top:0,right:0,bottom:0,left:0,...G},W=Array.isArray(F)?F:[F],X=W.length>0,Y={padding:V,boundary:W.filter(DN),altBoundary:X},{refs:Z,floatingStyles:$,placement:_,isPositioned:aa,middlewareData:ab}=function(a){void 0===a&&(a={});let{placement:b="bottom",strategy:c="absolute",middleware:d=[],platform:e,elements:{reference:f,floating:g}={},transform:h=!0,whileElementsMounted:i,open:j}=a,[k,l]=eQ.useState({x:0,y:0,strategy:c,placement:b,middlewareData:{},isPositioned:!1}),[m,n]=eQ.useState(d);Dt(m,d)||n(d);let[o,p]=eQ.useState(null),[q,r]=eQ.useState(null),s=eQ.useCallback(a=>{a!==w.current&&(w.current=a,p(a))},[]),t=eQ.useCallback(a=>{a!==y.current&&(y.current=a,r(a))},[]),u=f||o,v=g||q,w=eQ.useRef(null),y=eQ.useRef(null),z=eQ.useRef(k),A=null!=i,B=Dv(i),C=Dv(e),D=Dv(j),E=eQ.useCallback(()=>{var a,d;let e,f,g;if(!w.current||!y.current)return;let h={placement:b,strategy:c,middleware:m};C.current&&(h.platform=C.current),(a=w.current,d=y.current,e=new Map,g={...(f={platform:Dp,...h}).platform,_c:e},CN(a,d,{...f,platform:g})).then(a=>{let b={...a,isPositioned:!1!==D.current};F.current&&!Dt(z.current,b)&&(z.current=b,lI.flushSync(()=>{l(b)}))})},[m,b,c,C,D]);Ds(()=>{!1===j&&z.current.isPositioned&&(z.current.isPositioned=!1,l(a=>({...a,isPositioned:!1})))},[j]);let F=eQ.useRef(!1);Ds(()=>(F.current=!0,()=>{F.current=!1}),[]),Ds(()=>{if(u&&(w.current=u),v&&(y.current=v),u&&v){if(B.current)return B.current(u,v,E);E()}},[u,v,E,B,A]);let G=eQ.useMemo(()=>({reference:w,floating:y,setReference:s,setFloating:t}),[s,t]),H=eQ.useMemo(()=>({reference:u,floating:v}),[u,v]),I=eQ.useMemo(()=>{let a={position:c,left:0,top:0};if(!H.floating)return a;let b=Du(H.floating,k.x),d=Du(H.floating,k.y);if(h)return{...a,transform:"translate("+b+"px, "+d+"px)",...(H.floating,false)};return{position:c,left:b,top:d}},[c,h,H.floating,k.x,k.y]);return eQ.useMemo(()=>({...k,update:E,refs:G,elements:H,floatingStyles:I}),[k,E,G,H,I])}({strategy:"fixed",placement:z+("center"!==B?"-"+B:""),whileElementsMounted:(...a)=>(function(a,b,c,d){let e;void 0===d&&(d={});let{ancestorScroll:f=!0,ancestorResize:g=!0,elementResize:h="function"==typeof ResizeObserver,layoutShift:i="function"==typeof IntersectionObserver,animationFrame:j=!1}=d,k=Dd(a),l=f||g?[...k?Da(k):[],...Da(b)]:[];l.forEach(a=>{f&&a.addEventListener("scroll",c,{passive:!0}),g&&a.addEventListener("resize",c)});let m=k&&i?function(a,b){let c,d=null,e=CV(a);function f(){var a;clearTimeout(c),null==(a=d)||a.disconnect(),d=null}return!function g(h,i){void 0===h&&(h=!1),void 0===i&&(i=1),f();let j=a.getBoundingClientRect(),{left:k,top:l,width:m,height:n}=j;if(h||b(),!m||!n)return;let o={rootMargin:-Ct(l)+"px "+-Ct(e.clientWidth-(k+m))+"px "+-Ct(e.clientHeight-(l+n))+"px "+-Ct(k)+"px",threshold:Cr(0,Cq(1,i))||1},p=!0;function q(b){let d=b[0].intersectionRatio;if(d!==i){if(!p)return g();d?g(!1,d):c=setTimeout(()=>{g(!1,1e-7)},1e3)}1!==d||Dq(j,a.getBoundingClientRect())||g(),p=!1}try{d=new IntersectionObserver(q,{...o,root:e.ownerDocument})}catch(a){d=new IntersectionObserver(q,o)}d.observe(a)}(!0),f}(k,c):null,n=-1,o=null;h&&(o=new ResizeObserver(a=>{let[d]=a;d&&d.target===k&&o&&(o.unobserve(b),cancelAnimationFrame(n),n=requestAnimationFrame(()=>{var a;null==(a=o)||a.observe(b)})),c()}),k&&!j&&o.observe(k),o.observe(b));let p=j?Dh(a):null;return j&&function b(){let d=Dh(a);p&&!Dq(p,d)&&c(),p=d,e=requestAnimationFrame(b)}(),c(),()=>{var a;l.forEach(a=>{f&&a.removeEventListener("scroll",c),g&&a.removeEventListener("resize",c)}),null==m||m(),null==(a=o)||a.disconnect(),o=null,j&&cancelAnimationFrame(e)}})(...a,{animationFrame:"always"===J}),elements:{reference:M.anchor},middleware:[{...{name:"offset",options:e=c={mainAxis:A+U,alignmentAxis:C},async fn(a){var b,c;let{x:d,y:f,placement:g,middlewareData:h}=a,i=await CS(a,e);return g===(null==(b=h.offset)?void 0:b.placement)&&null!=(c=h.arrow)&&c.alignmentOffset?{}:{x:d+i.x,y:f+i.y,data:{...i,placement:g}}}},options:[c,d]},E&&{...{name:"shift",options:k=i={mainAxis:!0,crossAxis:!1,limiter:"partial"===H?{...(void 0===(h=f)&&(h={}),{options:h,fn(a){let{x:b,y:c,placement:d,rects:e,middlewareData:f}=a,{offset:g=0,mainAxis:i=!0,crossAxis:j=!0}=Cx(h,a),k={x:b,y:c},l=CD(d),m=CA(l),n=k[m],o=k[l],p=Cx(g,a),q="number"==typeof p?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(i){let a="y"===m?"height":"width",b=e.reference[m]-e.floating[a]+q.mainAxis,c=e.reference[m]+e.reference[a]-q.mainAxis;n<b?n=b:n>c&&(n=c)}if(j){var r,s;let a="y"===m?"width":"height",b=CR.has(Cy(d)),c=e.reference[l]-e.floating[a]+(b&&(null==(r=f.offset)?void 0:r[l])||0)+(b?0:q.crossAxis),g=e.reference[l]+e.reference[a]+(b?0:(null==(s=f.offset)?void 0:s[l])||0)-(b?q.crossAxis:0);o<c?o=c:o>g&&(o=g)}return{[m]:n,[l]:o}}}),options:[f,g]}:void 0,...Y},async fn(a){let{x:b,y:c,placement:d}=a,{mainAxis:e=!0,crossAxis:f=!1,limiter:g={fn:a=>{let{x:b,y:c}=a;return{x:b,y:c}}},...h}=Cx(k,a),i={x:b,y:c},j=await CO(a,h),l=CD(Cy(d)),m=CA(l),n=i[m],o=i[l];if(e){let a="y"===m?"top":"left",b="y"===m?"bottom":"right",c=n+j[a],d=n-j[b];n=Cr(c,Cq(n,d))}if(f){let a="y"===l?"top":"left",b="y"===l?"bottom":"right",c=o+j[a],d=o-j[b];o=Cr(c,Cq(o,d))}let p=g.fn({...a,[m]:n,[l]:o});return{...p,data:{x:p.x-b,y:p.y-c,enabled:{[m]:e,[l]:f}}}}},options:[i,j]},E&&{...{name:"flip",options:n=l={...Y},async fn(a){var b,c,d,e,f,g,h,i;let j,k,l,{placement:m,middlewareData:o,rects:p,initialPlacement:q,platform:r,elements:s}=a,{mainAxis:t=!0,crossAxis:u=!0,fallbackPlacements:v,fallbackStrategy:w="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:z=!0,...A}=Cx(n,a);if(null!=(b=o.arrow)&&b.alignmentOffset)return{};let B=Cy(m),C=CD(q),D=Cy(q)===q,E=await (null==r.isRTL?void 0:r.isRTL(s.floating)),F=v||(D||!z?[CJ(q)]:(j=CJ(q),[CE(q),j,CE(j)])),G="none"!==y;!v&&G&&F.push(...(k=Cz(q),l=function(a,b,c){switch(a){case"top":case"bottom":if(c)return b?CG:CF;return b?CF:CG;case"left":case"right":return b?CH:CI;default:return[]}}(Cy(q),"start"===y,E),k&&(l=l.map(a=>a+"-"+k),z&&(l=l.concat(l.map(CE)))),l));let H=[q,...F],I=await CO(a,A),J=[],K=(null==(c=o.flip)?void 0:c.overflows)||[];if(t&&J.push(I[B]),u){let a,b,c,d,e=(g=m,h=p,void 0===(i=E)&&(i=!1),a=Cz(g),c=CB(b=CA(CD(g))),d="x"===b?a===(i?"end":"start")?"right":"left":"start"===a?"bottom":"top",h.reference[c]>h.floating[c]&&(d=CJ(d)),[d,CJ(d)]);J.push(I[e[0]],I[e[1]])}if(K=[...K,{placement:m,overflows:J}],!J.every(a=>a<=0)){let a=((null==(d=o.flip)?void 0:d.index)||0)+1,b=H[a];if(b&&("alignment"!==u||C===CD(b)||K.every(a=>CD(a.placement)!==C||a.overflows[0]>0)))return{data:{index:a,overflows:K},reset:{placement:b}};let c=null==(e=K.filter(a=>a.overflows[0]<=0).sort((a,b)=>a.overflows[1]-b.overflows[1])[0])?void 0:e.placement;if(!c)switch(w){case"bestFit":{let a=null==(f=K.filter(a=>{if(G){let b=CD(a.placement);return b===C||"y"===b}return!0}).map(a=>[a.placement,a.overflows.filter(a=>a>0).reduce((a,b)=>a+b,0)]).sort((a,b)=>a[1]-b[1])[0])?void 0:f[0];a&&(c=a);break}case"initialPlacement":c=q}if(m!==c)return{reset:{placement:c}}}return{}}},options:[l,m]},{...{name:"size",options:q=o={...Y,apply:({elements:a,rects:b,availableWidth:c,availableHeight:d})=>{let{width:e,height:f}=b.reference,g=a.floating.style;g.setProperty("--radix-popper-available-width",`${c}px`),g.setProperty("--radix-popper-available-height",`${d}px`),g.setProperty("--radix-popper-anchor-width",`${e}px`),g.setProperty("--radix-popper-anchor-height",`${f}px`)}},async fn(a){var b,c;let d,e,{placement:f,rects:g,platform:h,elements:i}=a,{apply:j=()=>{},...k}=Cx(q,a),l=await CO(a,k),m=Cy(f),n=Cz(f),o="y"===CD(f),{width:p,height:r}=g.floating;"top"===m||"bottom"===m?(d=m,e=n===(await (null==h.isRTL?void 0:h.isRTL(i.floating))?"start":"end")?"left":"right"):(e=m,d="end"===n?"top":"bottom");let s=r-l.top-l.bottom,t=p-l.left-l.right,u=Cq(r-l[d],s),v=Cq(p-l[e],t),w=!a.middlewareData.shift,y=u,z=v;if(null!=(b=a.middlewareData.shift)&&b.enabled.x&&(z=t),null!=(c=a.middlewareData.shift)&&c.enabled.y&&(y=s),w&&!n){let a=Cr(l.left,0),b=Cr(l.right,0),c=Cr(l.top,0),d=Cr(l.bottom,0);o?z=p-2*(0!==a||0!==b?a+b:Cr(l.left,l.right)):y=r-2*(0!==c||0!==d?c+d:Cr(l.top,l.bottom))}await j({...a,availableWidth:z,availableHeight:y});let A=await h.getDimensions(i.floating);return p!==A.width||r!==A.height?{reset:{rects:!0}}:{}}},options:[o,p]},Q&&{...{name:"arrow",options:t=r={element:Q,padding:D},fn(a){let{element:b,padding:c}="function"==typeof t?t(a):t;return b&&({}).hasOwnProperty.call(b,"current")?null!=b.current?Dr({element:b.current,padding:c}).fn(a):{}:b?Dr({element:b,padding:c}).fn(a):{}}},options:[r,s]},DO({arrowWidth:T,arrowHeight:U}),I&&{...{name:"hide",options:w=u={strategy:"referenceHidden",...Y},async fn(a){let{rects:b}=a,{strategy:c="referenceHidden",...d}=Cx(w,a);switch(c){case"referenceHidden":{let c=CP(await CO(a,{...d,elementContext:"reference"}),b.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:CQ(c)}}}case"escaped":{let c=CP(await CO(a,{...d,altBoundary:!0}),b.floating);return{data:{escapedOffsets:c,escaped:CQ(c)}}}default:return{}}}},options:[u,v]}]}),[ac,ad]=DP(_),ae=An(K);z9(()=>{aa&&ae?.()},[aa,ae]);let af=ab.arrow?.x,ag=ab.arrow?.y,ah=ab.arrow?.centerOffset!==0,[ai,aj]=eQ.useState();return z9(()=>{N&&aj(window.getComputedStyle(N).zIndex)},[N]),(0,bT.jsx)("div",{ref:Z.setFloating,"data-radix-popper-content-wrapper":"",style:{...$,transform:aa?$.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ai,"--radix-popper-transform-origin":[ab.transformOrigin?.x,ab.transformOrigin?.y].join(" "),...ab.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:a.dir,children:(0,bT.jsx)(DH,{scope:y,placedSide:ac,onArrowChange:R,arrowX:af,arrowY:ag,shouldHideArrow:ah,children:(0,bT.jsx)(Al.div,{"data-side":ac,"data-align":ad,...L,ref:P,style:{...L.style,animation:aa?void 0:"none"}})})})});DJ.displayName=DG;var DK="PopperArrow",DL={top:"bottom",right:"left",bottom:"top",left:"right"},DM=eQ.forwardRef(function(a,b){let{__scopePopper:c,...d}=a,e=DI(DK,c),f=DL[e.placedSide];return(0,bT.jsx)("span",{ref:e.onArrowChange,style:{position:"absolute",left:e.arrowX,top:e.arrowY,[f]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[e.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[e.placedSide],visibility:e.shouldHideArrow?"hidden":void 0},children:(0,bT.jsx)(Dw,{...d,ref:b,style:{...d.style,display:"block"}})})});function DN(a){return null!==a}DM.displayName=DK;var DO=a=>({name:"transformOrigin",options:a,fn(b){let{placement:c,rects:d,middlewareData:e}=b,f=e.arrow?.centerOffset!==0,g=f?0:a.arrowWidth,h=f?0:a.arrowHeight,[i,j]=DP(c),k={start:"0%",center:"50%",end:"100%"}[j],l=(e.arrow?.x??0)+g/2,m=(e.arrow?.y??0)+h/2,n="",o="";return"bottom"===i?(n=f?k:`${l}px`,o=`${-h}px`):"top"===i?(n=f?k:`${l}px`,o=`${d.floating.height+h}px`):"right"===i?(n=`${-h}px`,o=f?k:`${m}px`):"left"===i&&(n=`${d.floating.width+h}px`,o=f?k:`${m}px`),{data:{x:n,y:o}}}});function DP(a){let[b,c="center"]=a.split("-");return[b,c]}var DQ="rovingFocusGroup.onEntryFocus",DR={bubbles:!1,cancelable:!0},DS="RovingFocusGroup",[DT,DU,DV]=Cj(DS),[DW,DX]=z8(DS,[DV]),[DY,DZ]=DW(DS),D$=eQ.forwardRef((a,b)=>(0,bT.jsx)(DT.Provider,{scope:a.__scopeRovingFocusGroup,children:(0,bT.jsx)(DT.Slot,{scope:a.__scopeRovingFocusGroup,children:(0,bT.jsx)(D_,{...a,ref:b})})}));D$.displayName=DS;var D_=eQ.forwardRef((a,b)=>{let{__scopeRovingFocusGroup:c,orientation:d,loop:e=!1,dir:f,currentTabStopId:g,defaultCurrentTabStopId:h,onCurrentTabStopIdChange:i,onEntryFocus:j,preventScrollOnEntryFocus:k=!1,...l}=a,m=eQ.useRef(null),n=z7(b,m),o=Co(f),[p,q]=Ae({prop:g,defaultProp:h??null,onChange:i,caller:DS}),[r,s]=eQ.useState(!1),t=An(j),u=DU(c),v=eQ.useRef(!1),[w,y]=eQ.useState(0);return eQ.useEffect(()=>{let a=m.current;if(a)return a.addEventListener(DQ,t),()=>a.removeEventListener(DQ,t)},[t]),(0,bT.jsx)(DY,{scope:c,orientation:d,dir:o,loop:e,currentTabStopId:p,onItemFocus:eQ.useCallback(a=>q(a),[q]),onItemShiftTab:eQ.useCallback(()=>s(!0),[]),onFocusableItemAdd:eQ.useCallback(()=>y(a=>a+1),[]),onFocusableItemRemove:eQ.useCallback(()=>y(a=>a-1),[]),children:(0,bT.jsx)(Al.div,{tabIndex:r||0===w?-1:0,"data-orientation":d,...l,ref:n,style:{outline:"none",...a.style},onMouseDown:z4(a.onMouseDown,()=>{v.current=!0}),onFocus:z4(a.onFocus,a=>{let b=!v.current;if(a.target===a.currentTarget&&b&&!r){let b=new CustomEvent(DQ,DR);if(a.currentTarget.dispatchEvent(b),!b.defaultPrevented){let a=u().filter(a=>a.focusable);D3([a.find(a=>a.active),a.find(a=>a.id===p),...a].filter(Boolean).map(a=>a.ref.current),k)}}v.current=!1}),onBlur:z4(a.onBlur,()=>s(!1))})})}),D0="RovingFocusGroupItem",D1=eQ.forwardRef((a,b)=>{let{__scopeRovingFocusGroup:c,focusable:d=!0,active:e=!1,tabStopId:f,children:g,...h}=a,i=Ac(),j=f||i,k=DZ(D0,c),l=k.currentTabStopId===j,m=DU(c),{onFocusableItemAdd:n,onFocusableItemRemove:o,currentTabStopId:p}=k;return eQ.useEffect(()=>{if(d)return n(),()=>o()},[d,n,o]),(0,bT.jsx)(DT.ItemSlot,{scope:c,id:j,focusable:d,active:e,children:(0,bT.jsx)(Al.span,{tabIndex:l?0:-1,"data-orientation":k.orientation,...h,ref:b,onMouseDown:z4(a.onMouseDown,a=>{d?k.onItemFocus(j):a.preventDefault()}),onFocus:z4(a.onFocus,()=>k.onItemFocus(j)),onKeyDown:z4(a.onKeyDown,a=>{if("Tab"===a.key&&a.shiftKey)return void k.onItemShiftTab();if(a.target!==a.currentTarget)return;let b=function(a,b,c){var d;let e=(d=a.key,"rtl"!==c?d:"ArrowLeft"===d?"ArrowRight":"ArrowRight"===d?"ArrowLeft":d);if(!("vertical"===b&&["ArrowLeft","ArrowRight"].includes(e))&&!("horizontal"===b&&["ArrowUp","ArrowDown"].includes(e)))return D2[e]}(a,k.orientation,k.dir);if(void 0!==b){if(a.metaKey||a.ctrlKey||a.altKey||a.shiftKey)return;a.preventDefault();let e=m().filter(a=>a.focusable).map(a=>a.ref.current);if("last"===b)e.reverse();else if("prev"===b||"next"===b){var c,d;"prev"===b&&e.reverse();let f=e.indexOf(a.currentTarget);e=k.loop?(c=e,d=f+1,c.map((a,b)=>c[(d+b)%c.length])):e.slice(f+1)}setTimeout(()=>D3(e))}}),children:"function"==typeof g?g({isCurrentTabStop:l,hasTabStop:null!=p}):g})})});D1.displayName=D0;var D2={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function D3(a,b=!1){let c=document.activeElement;for(let d of a)if(d===c||(d.focus({preventScroll:b}),document.activeElement!==c))return}var D4=["Enter"," "],D5=["ArrowUp","PageDown","End"],D6=["ArrowDown","PageUp","Home",...D5],D7={ltr:[...D4,"ArrowRight"],rtl:[...D4,"ArrowLeft"]},D8={ltr:["ArrowLeft"],rtl:["ArrowRight"]},D9="Menu",[Ea,Eb,Ec]=Cj(D9),[Ed,Ee]=z8(D9,[Ec,DA,DX]),Ef=DA(),Eg=DX(),[Eh,Ei]=Ed(D9),[Ej,Ek]=Ed(D9),El=a=>{let{__scopeMenu:b,open:c=!1,children:d,dir:e,onOpenChange:f,modal:g=!0}=a,h=Ef(b),[i,j]=eQ.useState(null),k=eQ.useRef(!1),l=An(f),m=Co(e);return eQ.useEffect(()=>{let a=()=>{k.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>k.current=!1;return document.addEventListener("keydown",a,{capture:!0}),()=>{document.removeEventListener("keydown",a,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),(0,bT.jsx)(DD,{...h,children:(0,bT.jsx)(Eh,{scope:b,open:c,onOpenChange:l,content:i,onContentChange:j,children:(0,bT.jsx)(Ej,{scope:b,onClose:eQ.useCallback(()=>l(!1),[l]),isUsingKeyboardRef:k,dir:m,modal:g,children:d})})})};El.displayName=D9;var Em=eQ.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a,e=Ef(c);return(0,bT.jsx)(DF,{...e,...d,ref:b})});Em.displayName="MenuAnchor";var En="MenuPortal",[Eo,Ep]=Ed(En,{forceMount:void 0}),Eq=a=>{let{__scopeMenu:b,forceMount:c,children:d,container:e}=a,f=Ei(En,b);return(0,bT.jsx)(Eo,{scope:b,forceMount:c,children:(0,bT.jsx)(AE,{present:c||f.open,children:(0,bT.jsx)(AD,{asChild:!0,container:e,children:d})})})};Eq.displayName=En;var Er="MenuContent",[Es,Et]=Ed(Er),Eu=eQ.forwardRef((a,b)=>{let c=Ep(Er,a.__scopeMenu),{forceMount:d=c.forceMount,...e}=a,f=Ei(Er,a.__scopeMenu),g=Ek(Er,a.__scopeMenu);return(0,bT.jsx)(Ea.Provider,{scope:a.__scopeMenu,children:(0,bT.jsx)(AE,{present:d||f.open,children:(0,bT.jsx)(Ea.Slot,{scope:a.__scopeMenu,children:g.modal?(0,bT.jsx)(Ev,{...e,ref:b}):(0,bT.jsx)(Ew,{...e,ref:b})})})})}),Ev=eQ.forwardRef((a,b)=>{let c=Ei(Er,a.__scopeMenu),d=eQ.useRef(null),e=z7(b,d);return eQ.useEffect(()=>{let a=d.current;if(a)return Bk(a)},[]),(0,bT.jsx)(Ey,{...a,ref:e,trapFocus:c.open,disableOutsidePointerEvents:c.open,disableOutsideScroll:!0,onFocusOutside:z4(a.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>c.onOpenChange(!1)})}),Ew=eQ.forwardRef((a,b)=>{let c=Ei(Er,a.__scopeMenu);return(0,bT.jsx)(Ey,{...a,ref:b,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>c.onOpenChange(!1)})}),Ex=Af("MenuContent.ScrollLock"),Ey=eQ.forwardRef((a,b)=>{let{__scopeMenu:c,loop:d=!1,trapFocus:e,onOpenAutoFocus:f,onCloseAutoFocus:g,disableOutsidePointerEvents:h,onEntryFocus:i,onEscapeKeyDown:j,onPointerDownOutside:k,onFocusOutside:l,onInteractOutside:m,onDismiss:n,disableOutsideScroll:o,...p}=a,q=Ei(Er,c),r=Ek(Er,c),s=Ef(c),t=Eg(c),u=Eb(c),[v,w]=eQ.useState(null),y=eQ.useRef(null),z=z7(b,y,q.onContentChange),A=eQ.useRef(0),B=eQ.useRef(""),C=eQ.useRef(0),D=eQ.useRef(null),E=eQ.useRef("right"),F=eQ.useRef(0),G=o?Bd:eQ.Fragment;eQ.useEffect(()=>()=>window.clearTimeout(A.current),[]),AH();let H=eQ.useCallback(a=>{var b,c;return E.current===D.current?.side&&(b=a,!!(c=D.current?.area)&&function(a,b){let{x:c,y:d}=a,e=!1;for(let a=0,f=b.length-1;a<b.length;f=a++){let g=b[a],h=b[f],i=g.x,j=g.y,k=h.x,l=h.y;j>d!=l>d&&c<(k-i)*(d-j)/(l-j)+i&&(e=!e)}return e}({x:b.clientX,y:b.clientY},c))},[]);return(0,bT.jsx)(Es,{scope:c,searchRef:B,onItemEnter:eQ.useCallback(a=>{H(a)&&a.preventDefault()},[H]),onItemLeave:eQ.useCallback(a=>{H(a)||(y.current?.focus(),w(null))},[H]),onTriggerLeave:eQ.useCallback(a=>{H(a)&&a.preventDefault()},[H]),pointerGraceTimerRef:C,onPointerGraceIntentChange:eQ.useCallback(a=>{D.current=a},[]),children:(0,bT.jsx)(G,{...o?{as:Ex,allowPinchZoom:!0}:void 0,children:(0,bT.jsx)(Ax,{asChild:!0,trapped:e,onMountAutoFocus:z4(f,a=>{a.preventDefault(),y.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:g,children:(0,bT.jsx)(Aq,{asChild:!0,disableOutsidePointerEvents:h,onEscapeKeyDown:j,onPointerDownOutside:k,onFocusOutside:l,onInteractOutside:m,onDismiss:n,children:(0,bT.jsx)(D$,{asChild:!0,...t,dir:r.dir,orientation:"vertical",loop:d,currentTabStopId:v,onCurrentTabStopIdChange:w,onEntryFocus:z4(i,a=>{r.isUsingKeyboardRef.current||a.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,bT.jsx)(DJ,{role:"menu","aria-orientation":"vertical","data-state":E$(q.open),"data-radix-menu-content":"",dir:r.dir,...s,...p,ref:z,style:{outline:"none",...p.style},onKeyDown:z4(p.onKeyDown,a=>{let b=a.target.closest("[data-radix-menu-content]")===a.currentTarget,c=a.ctrlKey||a.altKey||a.metaKey,d=1===a.key.length;if(b){var e;let b,f,g,h,i,j;"Tab"===a.key&&a.preventDefault(),!c&&d&&(e=a.key,b=B.current+e,f=u().filter(a=>!a.disabled),g=document.activeElement,h=f.find(a=>a.ref.current===g)?.textValue,i=function(a,b,c){var d;let e=b.length>1&&Array.from(b).every(a=>a===b[0])?b[0]:b,f=c?a.indexOf(c):-1,g=(d=Math.max(f,0),a.map((b,c)=>a[(d+c)%a.length]));1===e.length&&(g=g.filter(a=>a!==c));let h=g.find(a=>a.toLowerCase().startsWith(e.toLowerCase()));return h!==c?h:void 0}(f.map(a=>a.textValue),b,h),j=f.find(a=>a.textValue===i)?.ref.current,function a(b){B.current=b,window.clearTimeout(A.current),""!==b&&(A.current=window.setTimeout(()=>a(""),1e3))}(b),j&&setTimeout(()=>j.focus()))}let f=y.current;if(a.target!==f||!D6.includes(a.key))return;a.preventDefault();let g=u().filter(a=>!a.disabled).map(a=>a.ref.current);D5.includes(a.key)&&g.reverse(),function(a){let b=document.activeElement;for(let c of a)if(c===b||(c.focus(),document.activeElement!==b))return}(g)}),onBlur:z4(a.onBlur,a=>{a.currentTarget.contains(a.target)||(window.clearTimeout(A.current),B.current="")}),onPointerMove:z4(a.onPointerMove,E1(a=>{let b=a.target,c=F.current!==a.clientX;a.currentTarget.contains(b)&&c&&(E.current=a.clientX>F.current?"right":"left",F.current=a.clientX)}))})})})})})})});Eu.displayName=Er;var Ez=eQ.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a;return(0,bT.jsx)(Al.div,{role:"group",...d,ref:b})});Ez.displayName="MenuGroup";var EA=eQ.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a;return(0,bT.jsx)(Al.div,{...d,ref:b})});EA.displayName="MenuLabel";var EB="MenuItem",EC="menu.itemSelect",ED=eQ.forwardRef((a,b)=>{let{disabled:c=!1,onSelect:d,...e}=a,f=eQ.useRef(null),g=Ek(EB,a.__scopeMenu),h=Et(EB,a.__scopeMenu),i=z7(b,f),j=eQ.useRef(!1);return(0,bT.jsx)(EE,{...e,ref:i,disabled:c,onClick:z4(a.onClick,()=>{let a=f.current;if(!c&&a){let b=new CustomEvent(EC,{bubbles:!0,cancelable:!0});a.addEventListener(EC,a=>d?.(a),{once:!0}),Am(a,b),b.defaultPrevented?j.current=!1:g.onClose()}}),onPointerDown:b=>{a.onPointerDown?.(b),j.current=!0},onPointerUp:z4(a.onPointerUp,a=>{j.current||a.currentTarget?.click()}),onKeyDown:z4(a.onKeyDown,a=>{let b=""!==h.searchRef.current;c||b&&" "===a.key||D4.includes(a.key)&&(a.currentTarget.click(),a.preventDefault())})})});ED.displayName=EB;var EE=eQ.forwardRef((a,b)=>{let{__scopeMenu:c,disabled:d=!1,textValue:e,...f}=a,g=Et(EB,c),h=Eg(c),i=eQ.useRef(null),j=z7(b,i),[k,l]=eQ.useState(!1),[m,n]=eQ.useState("");return eQ.useEffect(()=>{let a=i.current;a&&n((a.textContent??"").trim())},[f.children]),(0,bT.jsx)(Ea.ItemSlot,{scope:c,disabled:d,textValue:e??m,children:(0,bT.jsx)(D1,{asChild:!0,...h,focusable:!d,children:(0,bT.jsx)(Al.div,{role:"menuitem","data-highlighted":k?"":void 0,"aria-disabled":d||void 0,"data-disabled":d?"":void 0,...f,ref:j,onPointerMove:z4(a.onPointerMove,E1(a=>{d?g.onItemLeave(a):(g.onItemEnter(a),a.defaultPrevented||a.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:z4(a.onPointerLeave,E1(a=>g.onItemLeave(a))),onFocus:z4(a.onFocus,()=>l(!0)),onBlur:z4(a.onBlur,()=>l(!1))})})})}),EF=eQ.forwardRef((a,b)=>{let{checked:c=!1,onCheckedChange:d,...e}=a;return(0,bT.jsx)(EN,{scope:a.__scopeMenu,checked:c,children:(0,bT.jsx)(ED,{role:"menuitemcheckbox","aria-checked":E_(c)?"mixed":c,...e,ref:b,"data-state":E0(c),onSelect:z4(e.onSelect,()=>d?.(!!E_(c)||!c),{checkForDefaultPrevented:!1})})})});EF.displayName="MenuCheckboxItem";var EG="MenuRadioGroup",[EH,EI]=Ed(EG,{value:void 0,onValueChange:()=>{}}),EJ=eQ.forwardRef((a,b)=>{let{value:c,onValueChange:d,...e}=a,f=An(d);return(0,bT.jsx)(EH,{scope:a.__scopeMenu,value:c,onValueChange:f,children:(0,bT.jsx)(Ez,{...e,ref:b})})});EJ.displayName=EG;var EK="MenuRadioItem",EL=eQ.forwardRef((a,b)=>{let{value:c,...d}=a,e=EI(EK,a.__scopeMenu),f=c===e.value;return(0,bT.jsx)(EN,{scope:a.__scopeMenu,checked:f,children:(0,bT.jsx)(ED,{role:"menuitemradio","aria-checked":f,...d,ref:b,"data-state":E0(f),onSelect:z4(d.onSelect,()=>e.onValueChange?.(c),{checkForDefaultPrevented:!1})})})});EL.displayName=EK;var EM="MenuItemIndicator",[EN,EO]=Ed(EM,{checked:!1}),EP=eQ.forwardRef((a,b)=>{let{__scopeMenu:c,forceMount:d,...e}=a,f=EO(EM,c);return(0,bT.jsx)(AE,{present:d||E_(f.checked)||!0===f.checked,children:(0,bT.jsx)(Al.span,{...e,ref:b,"data-state":E0(f.checked)})})});EP.displayName=EM;var EQ=eQ.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a;return(0,bT.jsx)(Al.div,{role:"separator","aria-orientation":"horizontal",...d,ref:b})});EQ.displayName="MenuSeparator";var ER=eQ.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a,e=Ef(c);return(0,bT.jsx)(DM,{...e,...d,ref:b})});ER.displayName="MenuArrow";var ES="MenuSub",[ET,EU]=Ed(ES),EV=a=>{let{__scopeMenu:b,children:c,open:d=!1,onOpenChange:e}=a,f=Ei(ES,b),g=Ef(b),[h,i]=eQ.useState(null),[j,k]=eQ.useState(null),l=An(e);return eQ.useEffect(()=>(!1===f.open&&l(!1),()=>l(!1)),[f.open,l]),(0,bT.jsx)(DD,{...g,children:(0,bT.jsx)(Eh,{scope:b,open:d,onOpenChange:l,content:j,onContentChange:k,children:(0,bT.jsx)(ET,{scope:b,contentId:Ac(),triggerId:Ac(),trigger:h,onTriggerChange:i,children:c})})})};EV.displayName=ES;var EW="MenuSubTrigger",EX=eQ.forwardRef((a,b)=>{let c=Ei(EW,a.__scopeMenu),d=Ek(EW,a.__scopeMenu),e=EU(EW,a.__scopeMenu),f=Et(EW,a.__scopeMenu),g=eQ.useRef(null),{pointerGraceTimerRef:h,onPointerGraceIntentChange:i}=f,j={__scopeMenu:a.__scopeMenu},k=eQ.useCallback(()=>{g.current&&window.clearTimeout(g.current),g.current=null},[]);return eQ.useEffect(()=>k,[k]),eQ.useEffect(()=>{let a=h.current;return()=>{window.clearTimeout(a),i(null)}},[h,i]),(0,bT.jsx)(Em,{asChild:!0,...j,children:(0,bT.jsx)(EE,{id:e.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":e.contentId,"data-state":E$(c.open),...a,ref:z6(b,e.onTriggerChange),onClick:b=>{a.onClick?.(b),a.disabled||b.defaultPrevented||(b.currentTarget.focus(),c.open||c.onOpenChange(!0))},onPointerMove:z4(a.onPointerMove,E1(b=>{f.onItemEnter(b),!b.defaultPrevented&&(a.disabled||c.open||g.current||(f.onPointerGraceIntentChange(null),g.current=window.setTimeout(()=>{c.onOpenChange(!0),k()},100)))})),onPointerLeave:z4(a.onPointerLeave,E1(a=>{k();let b=c.content?.getBoundingClientRect();if(b){let d=c.content?.dataset.side,e="right"===d,g=b[e?"left":"right"],i=b[e?"right":"left"];f.onPointerGraceIntentChange({area:[{x:a.clientX+(e?-5:5),y:a.clientY},{x:g,y:b.top},{x:i,y:b.top},{x:i,y:b.bottom},{x:g,y:b.bottom}],side:d}),window.clearTimeout(h.current),h.current=window.setTimeout(()=>f.onPointerGraceIntentChange(null),300)}else{if(f.onTriggerLeave(a),a.defaultPrevented)return;f.onPointerGraceIntentChange(null)}})),onKeyDown:z4(a.onKeyDown,b=>{let e=""!==f.searchRef.current;a.disabled||e&&" "===b.key||D7[d.dir].includes(b.key)&&(c.onOpenChange(!0),c.content?.focus(),b.preventDefault())})})})});EX.displayName=EW;var EY="MenuSubContent",EZ=eQ.forwardRef((a,b)=>{let c=Ep(Er,a.__scopeMenu),{forceMount:d=c.forceMount,...e}=a,f=Ei(Er,a.__scopeMenu),g=Ek(Er,a.__scopeMenu),h=EU(EY,a.__scopeMenu),i=eQ.useRef(null),j=z7(b,i);return(0,bT.jsx)(Ea.Provider,{scope:a.__scopeMenu,children:(0,bT.jsx)(AE,{present:d||f.open,children:(0,bT.jsx)(Ea.Slot,{scope:a.__scopeMenu,children:(0,bT.jsx)(Ey,{id:h.contentId,"aria-labelledby":h.triggerId,...e,ref:j,align:"start",side:"rtl"===g.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:a=>{g.isUsingKeyboardRef.current&&i.current?.focus(),a.preventDefault()},onCloseAutoFocus:a=>a.preventDefault(),onFocusOutside:z4(a.onFocusOutside,a=>{a.target!==h.trigger&&f.onOpenChange(!1)}),onEscapeKeyDown:z4(a.onEscapeKeyDown,a=>{g.onClose(),a.preventDefault()}),onKeyDown:z4(a.onKeyDown,a=>{let b=a.currentTarget.contains(a.target),c=D8[g.dir].includes(a.key);b&&c&&(f.onOpenChange(!1),h.trigger?.focus(),a.preventDefault())})})})})})});function E$(a){return a?"open":"closed"}function E_(a){return"indeterminate"===a}function E0(a){return E_(a)?"indeterminate":a?"checked":"unchecked"}function E1(a){return b=>"mouse"===b.pointerType?a(b):void 0}EZ.displayName=EY;var E2="ContextMenu",[E3,E4]=z8(E2,[Ee]),E5=Ee(),[E6,E7]=E3(E2),E8=a=>{let{__scopeContextMenu:b,children:c,onOpenChange:d,dir:e,modal:f=!0}=a,[g,h]=eQ.useState(!1),i=E5(b),j=An(d),k=eQ.useCallback(a=>{h(a),j(a)},[j]);return(0,bT.jsx)(E6,{scope:b,open:g,onOpenChange:k,modal:f,children:(0,bT.jsx)(El,{...i,dir:e,open:g,onOpenChange:k,modal:f,children:c})})};E8.displayName=E2;var E9="ContextMenuTrigger",Fa=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,disabled:d=!1,...e}=a,f=E7(E9,c),g=E5(c),h=eQ.useRef({x:0,y:0}),i=eQ.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...h.current})}),j=eQ.useRef(0),k=eQ.useCallback(()=>window.clearTimeout(j.current),[]),l=a=>{h.current={x:a.clientX,y:a.clientY},f.onOpenChange(!0)};return eQ.useEffect(()=>k,[k]),eQ.useEffect(()=>void(d&&k()),[d,k]),(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Em,{...g,virtualRef:i}),(0,bT.jsx)(Al.span,{"data-state":f.open?"open":"closed","data-disabled":d?"":void 0,...e,ref:b,style:{WebkitTouchCallout:"none",...a.style},onContextMenu:d?a.onContextMenu:z4(a.onContextMenu,a=>{k(),l(a),a.preventDefault()}),onPointerDown:d?a.onPointerDown:z4(a.onPointerDown,Fr(a=>{k(),j.current=window.setTimeout(()=>l(a),700)})),onPointerMove:d?a.onPointerMove:z4(a.onPointerMove,Fr(k)),onPointerCancel:d?a.onPointerCancel:z4(a.onPointerCancel,Fr(k)),onPointerUp:d?a.onPointerUp:z4(a.onPointerUp,Fr(k))})]})});Fa.displayName=E9;var Fb=a=>{let{__scopeContextMenu:b,...c}=a,d=E5(b);return(0,bT.jsx)(Eq,{...d,...c})};Fb.displayName="ContextMenuPortal";var Fc="ContextMenuContent",Fd=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E7(Fc,c),f=E5(c),g=eQ.useRef(!1);return(0,bT.jsx)(Eu,{...f,...d,ref:b,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),!b.defaultPrevented&&g.current&&b.preventDefault(),g.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||e.modal||(g.current=!0)},style:{...a.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Fd.displayName=Fc;var Fe=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(Ez,{...e,...d,ref:b})});Fe.displayName="ContextMenuGroup";var Ff=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(EA,{...e,...d,ref:b})});Ff.displayName="ContextMenuLabel";var Fg=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(ED,{...e,...d,ref:b})});Fg.displayName="ContextMenuItem";var Fh=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(EF,{...e,...d,ref:b})});Fh.displayName="ContextMenuCheckboxItem";var Fi=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(EJ,{...e,...d,ref:b})});Fi.displayName="ContextMenuRadioGroup";var Fj=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(EL,{...e,...d,ref:b})});Fj.displayName="ContextMenuRadioItem";var Fk=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(EP,{...e,...d,ref:b})});Fk.displayName="ContextMenuItemIndicator";var Fl=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(EQ,{...e,...d,ref:b})});Fl.displayName="ContextMenuSeparator";var Fm=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(ER,{...e,...d,ref:b})});Fm.displayName="ContextMenuArrow";var Fn="ContextMenuSub",Fo=a=>{let{__scopeContextMenu:b,children:c,onOpenChange:d,open:e,defaultOpen:f}=a,g=E5(b),[h,i]=Ae({prop:e,defaultProp:f??!1,onChange:d,caller:Fn});return(0,bT.jsx)(EV,{...g,open:h,onOpenChange:i,children:c})};Fo.displayName=Fn;var Fp=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(EX,{...e,...d,ref:b})});Fp.displayName="ContextMenuSubTrigger";var Fq=eQ.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=E5(c);return(0,bT.jsx)(EZ,{...e,...d,ref:b,style:{...a.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});function Fr(a){return b=>"mouse"!==b.pointerType?a(b):void 0}Fq.displayName="ContextMenuSubContent",a.s(["Arrow",()=>Fm,"CheckboxItem",()=>Fh,"Content",()=>Fd,"ContextMenu",()=>E8,"ContextMenuArrow",()=>Fm,"ContextMenuCheckboxItem",()=>Fh,"ContextMenuContent",()=>Fd,"ContextMenuGroup",()=>Fe,"ContextMenuItem",()=>Fg,"ContextMenuItemIndicator",()=>Fk,"ContextMenuLabel",()=>Ff,"ContextMenuPortal",()=>Fb,"ContextMenuRadioGroup",()=>Fi,"ContextMenuRadioItem",()=>Fj,"ContextMenuSeparator",()=>Fl,"ContextMenuSub",()=>Fo,"ContextMenuSubContent",()=>Fq,"ContextMenuSubTrigger",()=>Fp,"ContextMenuTrigger",()=>Fa,"Group",()=>Fe,"Item",()=>Fg,"ItemIndicator",()=>Fk,"Label",()=>Ff,"Portal",()=>Fb,"RadioGroup",()=>Fi,"RadioItem",()=>Fj,"Root",()=>E8,"Separator",()=>Fl,"Sub",()=>Fo,"SubContent",()=>Fq,"SubTrigger",()=>Fp,"Trigger",()=>Fa,"createContextMenuScope",()=>E4],63286);var Fs=a.i(63286),Fs=Fs;function Ft(){let a=kq();return e$("isReadonlyMode",()=>!!a?.getIsReadonly(),[a])}let Fu="__CTRL__",Fv="__CTRL__",Fw="__ALT__";function Fx(a){return","===a?[","]:a.split(",")[0].split(/(\[\[[^\]]+\]\])/g).map(a=>a.startsWith("[[")?a.replace(/[[\]]/g,""):a.replace(/cmd\+/g,Fu).replace(/ctrl\+/g,Fv).replace(/alt\+/g,Fw).replace(/shift\+/g,"⇧").replace(/\$/g,Fu).replace(/\?/g,Fw).replace(/!/g,"⇧").match(/__CTRL__|__ALT__|./g)||[]).flat().map((a,b)=>{let c;return"+"===a[0]?[]:(c="__CTRL__"===a?"Ctrl":"__ALT__"===a?"Alt":a[0].toUpperCase()+a.slice(1),b?["+",c]:c)}).flat()}function Fy(a){return"— "+Fx(a).join(" ")}function Fz(a){let b=zQ();return(0,bT.jsx)(ra,{"aria-label":b("app.loading"),...a})}var FA="DropdownMenu",[FB,FC]=z8(FA,[Ee]),FD=Ee(),[FE,FF]=FB(FA),FG=a=>{let{__scopeDropdownMenu:b,children:c,dir:d,open:e,defaultOpen:f,onOpenChange:g,modal:h=!0}=a,i=FD(b),j=eQ.useRef(null),[k,l]=Ae({prop:e,defaultProp:f??!1,onChange:g,caller:FA});return(0,bT.jsx)(FE,{scope:b,triggerId:Ac(),triggerRef:j,contentId:Ac(),open:k,onOpenChange:l,onOpenToggle:eQ.useCallback(()=>l(a=>!a),[l]),modal:h,children:(0,bT.jsx)(El,{...i,open:k,onOpenChange:l,dir:d,modal:h,children:c})})};FG.displayName=FA;var FH="DropdownMenuTrigger",FI=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,disabled:d=!1,...e}=a,f=FF(FH,c),g=FD(c);return(0,bT.jsx)(Em,{asChild:!0,...g,children:(0,bT.jsx)(Al.button,{type:"button",id:f.triggerId,"aria-haspopup":"menu","aria-expanded":f.open,"aria-controls":f.open?f.contentId:void 0,"data-state":f.open?"open":"closed","data-disabled":d?"":void 0,disabled:d,...e,ref:z6(b,f.triggerRef),onPointerDown:z4(a.onPointerDown,a=>{!d&&0===a.button&&!1===a.ctrlKey&&(f.onOpenToggle(),f.open||a.preventDefault())}),onKeyDown:z4(a.onKeyDown,a=>{!d&&(["Enter"," "].includes(a.key)&&f.onOpenToggle(),"ArrowDown"===a.key&&f.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});FI.displayName=FH;var FJ=a=>{let{__scopeDropdownMenu:b,...c}=a,d=FD(b);return(0,bT.jsx)(Eq,{...d,...c})};FJ.displayName="DropdownMenuPortal";var FK="DropdownMenuContent",FL=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FF(FK,c),f=FD(c),g=eQ.useRef(!1);return(0,bT.jsx)(Eu,{id:e.contentId,"aria-labelledby":e.triggerId,...f,...d,ref:b,onCloseAutoFocus:z4(a.onCloseAutoFocus,a=>{g.current||e.triggerRef.current?.focus(),g.current=!1,a.preventDefault()}),onInteractOutside:z4(a.onInteractOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey,d=2===b.button||c;(!e.modal||d)&&(g.current=!0)}),style:{...a.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});FL.displayName=FK;var FM=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(Ez,{...e,...d,ref:b})});FM.displayName="DropdownMenuGroup";var FN=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(EA,{...e,...d,ref:b})});FN.displayName="DropdownMenuLabel";var FO=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(ED,{...e,...d,ref:b})});FO.displayName="DropdownMenuItem";var FP=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(EF,{...e,...d,ref:b})});FP.displayName="DropdownMenuCheckboxItem";var FQ=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(EJ,{...e,...d,ref:b})});FQ.displayName="DropdownMenuRadioGroup";var FR=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(EL,{...e,...d,ref:b})});FR.displayName="DropdownMenuRadioItem";var FS=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(EP,{...e,...d,ref:b})});FS.displayName="DropdownMenuItemIndicator";var FT=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(EQ,{...e,...d,ref:b})});FT.displayName="DropdownMenuSeparator";var FU=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(ER,{...e,...d,ref:b})});FU.displayName="DropdownMenuArrow";var FV=a=>{let{__scopeDropdownMenu:b,children:c,open:d,onOpenChange:e,defaultOpen:f}=a,g=FD(b),[h,i]=Ae({prop:d,defaultProp:f??!1,onChange:e,caller:"DropdownMenuSub"});return(0,bT.jsx)(EV,{...g,open:h,onOpenChange:i,children:c})},FW=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(EX,{...e,...d,ref:b})});FW.displayName="DropdownMenuSubTrigger";var FX=eQ.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=FD(c);return(0,bT.jsx)(EZ,{...e,...d,ref:b,style:{...a.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});FX.displayName="DropdownMenuSubContent",a.s(["Arrow",()=>FU,"CheckboxItem",()=>FP,"Content",()=>FL,"DropdownMenu",()=>FG,"DropdownMenuArrow",()=>FU,"DropdownMenuCheckboxItem",()=>FP,"DropdownMenuContent",()=>FL,"DropdownMenuGroup",()=>FM,"DropdownMenuItem",()=>FO,"DropdownMenuItemIndicator",()=>FS,"DropdownMenuLabel",()=>FN,"DropdownMenuPortal",()=>FJ,"DropdownMenuRadioGroup",()=>FQ,"DropdownMenuRadioItem",()=>FR,"DropdownMenuSeparator",()=>FT,"DropdownMenuSub",()=>FV,"DropdownMenuSubContent",()=>FX,"DropdownMenuSubTrigger",()=>FW,"DropdownMenuTrigger",()=>FI,"Group",()=>FM,"Item",()=>FO,"ItemIndicator",()=>FS,"Label",()=>FN,"Portal",()=>FJ,"RadioGroup",()=>FQ,"RadioItem",()=>FR,"Root",()=>FG,"Separator",()=>FT,"Sub",()=>FV,"SubContent",()=>FX,"SubTrigger",()=>FW,"Trigger",()=>FI,"createDropdownMenuScope",()=>FC],27736);var FY=a.i(27736),FY=FY;let FZ=()=>void 0,F$=eQ.createContext(null);function F_({onEvent:a,children:b}){return(0,bT.jsx)(F$.Provider,{value:a??FZ,children:b})}function F0(){return eQ.useContext(F$)??FZ}function F1(a,b){var c;let d,e,f,g=kq(),h=(0,eQ.useCallback)(a=>{a&&g?.complete(),b?.(a)},[g,b]),i=F0(),j=(0,eQ.useCallback)(b=>{i(b,{source:"unknown",id:a})},[a,i]);return c=g?`${a}-${g.contextId}`:a,d=(0,eQ.useRef)(!1),e=(0,eQ.useCallback)(a=>{d.current=a,a?m3.addOpenMenu(c):m3.deleteOpenMenu(c),h?.(a)},[c,h]),f=e$("is menu open",()=>m3.getOpenMenus().includes(c),[c]),(0,eQ.useEffect)(()=>(d.current&&(j?.("open-menu"),m3.addOpenMenu(c)),()=>{d.current&&(m3.deleteOpenMenu(c),m3.getOpenMenus().forEach(a=>{a.startsWith(c)&&(j?.("close-menu"),m3.deleteOpenMenu(a))}),d.current=!1)}),[c,j]),[f,e]}function F2({id:a,children:b,modal:c=!1,debugOpen:d=!1}){let[e,f]=F1(a);return(0,bT.jsx)(FY.Root,{open:d||e,dir:"ltr",modal:c,onOpenChange:f,children:b})}function F3({children:a,...b}){return(0,bT.jsx)(FY.Trigger,{dir:"ltr",asChild:!0,onTouchEnd:a=>kb(a),...b,children:a})}function F4({className:a,side:b="bottom",align:c="start",sideOffset:d=8,alignOffset:e=8,children:f}){let g=kv();return(0,bT.jsx)(FY.Portal,{container:g,children:(0,bT.jsx)(FY.Content,{className:(0,j1.default)("tlui-menu",a),side:b,sideOffset:d,align:c,alignOffset:e,collisionPadding:4,children:f})})}function F5({id:a,children:b}){let[c,d]=F1(a);return(0,bT.jsx)(FY.Sub,{open:c,onOpenChange:d,children:b})}function F6({id:a,label:b,title:c,disabled:d}){return(0,bT.jsx)(FY.SubTrigger,{dir:"ltr",asChild:!0,disabled:d,children:(0,bT.jsxs)(zS,{"data-testid":a,type:"menu",className:"tlui-menu__submenu__trigger",disabled:d,title:c,children:[(0,bT.jsx)(z3,{children:b}),(0,bT.jsx)(BV,{icon:"chevron-right",small:!0})]})})}function F7({id:a,alignOffset:b=-1,sideOffset:c=-6,size:d="small",children:e}){let f=kv();return(0,bT.jsx)(FY.Portal,{container:f,children:(0,bT.jsx)(FY.SubContent,{"data-testid":a,className:"tlui-menu tlui-menu__submenu__content",alignOffset:b,sideOffset:c,collisionPadding:4,"data-size":d,children:e})})}function F8({className:a,children:b}){return(0,bT.jsx)("div",{dir:"ltr",className:(0,j1.default)("tlui-menu__group",a),children:b})}function F9({noClose:a,children:b}){return(0,bT.jsx)(FY.Item,{dir:"ltr",asChild:!0,onClick:a?kb:void 0,children:b})}function Ga({children:a,onSelect:b,...c}){let d=zQ();return(0,bT.jsxs)(FY.CheckboxItem,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:a=>{b?.(a),kb(a)},...c,children:[(0,bT.jsx)("div",{className:"tlui-button__checkbox__indicator",children:(0,bT.jsx)(FY.ItemIndicator,{dir:"ltr",children:(0,bT.jsx)(BT,{label:d("ui.checked"),icon:"check",small:!0})})}),a]})}function Gb({children:a,visibleOnMobileLayout:b=!1}){let c=Ce();return!b&&c<Cb.MOBILE?null:(0,bT.jsx)("kbd",{className:"tlui-kbd",children:Fx(a).map((a,b)=>(0,bT.jsx)("span",{children:a},b))})}var Gc="horizontal",Gd=["horizontal","vertical"],Ge=eQ.forwardRef((a,b)=>{var c;let{decorative:d,orientation:e=Gc,...f}=a,g=(c=e,Gd.includes(c))?e:Gc;return(0,bT.jsx)(Al.div,{"data-orientation":g,...d?{role:"none"}:{"aria-orientation":"vertical"===g?g:void 0,role:"separator"},...f,ref:b})});Ge.displayName="Separator";var Gf="Toggle",Gg=eQ.forwardRef((a,b)=>{let{pressed:c,defaultPressed:d,onPressedChange:e,...f}=a,[g,h]=Ae({prop:c,onChange:e,defaultProp:d??!1,caller:Gf});return(0,bT.jsx)(Al.button,{type:"button","aria-pressed":g,"data-state":g?"on":"off","data-disabled":a.disabled?"":void 0,...f,ref:b,onClick:z4(a.onClick,()=>{a.disabled||h(!g)})})});Gg.displayName=Gf;var Gh="ToggleGroup",[Gi,Gj]=z8(Gh,[DX]),Gk=DX(),Gl=eQ.default.forwardRef((a,b)=>{let{type:c,...d}=a;if("single"===c)return(0,bT.jsx)(Go,{...d,ref:b});if("multiple"===c)return(0,bT.jsx)(Gp,{...d,ref:b});throw Error(`Missing prop \`type\` expected on \`${Gh}\``)});Gl.displayName=Gh;var[Gm,Gn]=Gi(Gh),Go=eQ.default.forwardRef((a,b)=>{let{value:c,defaultValue:d,onValueChange:e=()=>{},...f}=a,[g,h]=Ae({prop:c,defaultProp:d??"",onChange:e,caller:Gh});return(0,bT.jsx)(Gm,{scope:a.__scopeToggleGroup,type:"single",value:eQ.default.useMemo(()=>g?[g]:[],[g]),onItemActivate:h,onItemDeactivate:eQ.default.useCallback(()=>h(""),[h]),children:(0,bT.jsx)(Gs,{...f,ref:b})})}),Gp=eQ.default.forwardRef((a,b)=>{let{value:c,defaultValue:d,onValueChange:e=()=>{},...f}=a,[g,h]=Ae({prop:c,defaultProp:d??[],onChange:e,caller:Gh}),i=eQ.default.useCallback(a=>h((b=[])=>[...b,a]),[h]),j=eQ.default.useCallback(a=>h((b=[])=>b.filter(b=>b!==a)),[h]);return(0,bT.jsx)(Gm,{scope:a.__scopeToggleGroup,type:"multiple",value:g,onItemActivate:i,onItemDeactivate:j,children:(0,bT.jsx)(Gs,{...f,ref:b})})});Gl.displayName=Gh;var[Gq,Gr]=Gi(Gh),Gs=eQ.default.forwardRef((a,b)=>{let{__scopeToggleGroup:c,disabled:d=!1,rovingFocus:e=!0,orientation:f,dir:g,loop:h=!0,...i}=a,j=Gk(c),k=Co(g),l={role:"group",dir:k,...i};return(0,bT.jsx)(Gq,{scope:c,rovingFocus:e,disabled:d,children:e?(0,bT.jsx)(D$,{asChild:!0,...j,orientation:f,dir:k,loop:h,children:(0,bT.jsx)(Al.div,{...l,ref:b})}):(0,bT.jsx)(Al.div,{...l,ref:b})})}),Gt="ToggleGroupItem",Gu=eQ.default.forwardRef((a,b)=>{let c=Gn(Gt,a.__scopeToggleGroup),d=Gr(Gt,a.__scopeToggleGroup),e=Gk(a.__scopeToggleGroup),f=c.value.includes(a.value),g=d.disabled||a.disabled,h={...a,pressed:f,disabled:g},i=eQ.default.useRef(null);return d.rovingFocus?(0,bT.jsx)(D1,{asChild:!0,...e,focusable:!g,active:f,ref:i,children:(0,bT.jsx)(Gv,{...h,ref:b})}):(0,bT.jsx)(Gv,{...h,ref:b})});Gu.displayName=Gt;var Gv=eQ.default.forwardRef((a,b)=>{let{__scopeToggleGroup:c,value:d,...e}=a,f=Gn(Gt,c),g={role:"radio","aria-checked":a.pressed,"aria-pressed":void 0},h="single"===f.type?g:void 0;return(0,bT.jsx)(Gg,{...h,...e,ref:b,onPressedChange:a=>{a?f.onItemActivate(d):f.onItemDeactivate(d)}})}),Gw="Toolbar",[Gx,Gy]=z8(Gw,[DX,Gj]),Gz=DX(),GA=Gj(),[GB,GC]=Gx(Gw),GD=eQ.forwardRef((a,b)=>{let{__scopeToolbar:c,orientation:d="horizontal",dir:e,loop:f=!0,...g}=a,h=Gz(c),i=Co(e);return(0,bT.jsx)(GB,{scope:c,orientation:d,dir:i,children:(0,bT.jsx)(D$,{asChild:!0,...h,orientation:d,dir:i,loop:f,children:(0,bT.jsx)(Al.div,{role:"toolbar","aria-orientation":d,dir:i,...g,ref:b})})})});GD.displayName=Gw;var GE="ToolbarSeparator",GF=eQ.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=GC(GE,c);return(0,bT.jsx)(Ge,{orientation:"horizontal"===e.orientation?"vertical":"horizontal",...d,ref:b})});GF.displayName=GE;var GG=eQ.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=Gz(c);return(0,bT.jsx)(D1,{asChild:!0,...e,focusable:!a.disabled,children:(0,bT.jsx)(Al.button,{type:"button",...d,ref:b})})});GG.displayName="ToolbarButton";var GH=eQ.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=Gz(c);return(0,bT.jsx)(D1,{asChild:!0,...e,focusable:!0,children:(0,bT.jsx)(Al.a,{...d,ref:b,onKeyDown:z4(a.onKeyDown,a=>{" "===a.key&&a.currentTarget.click()})})})});GH.displayName="ToolbarLink";var GI="ToolbarToggleGroup",GJ=eQ.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=GC(GI,c),f=GA(c);return(0,bT.jsx)(Gl,{"data-orientation":e.orientation,dir:e.dir,...f,...d,ref:b,rovingFocus:!1})});GJ.displayName=GI;var GK=eQ.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=GA(c),f={__scopeToolbar:a.__scopeToolbar};return(0,bT.jsx)(GG,{asChild:!0,...f,children:(0,bT.jsx)(Gu,{...e,...d,ref:b})})});GK.displayName="ToolbarToggleItem",a.s(["Button",()=>GG,"Link",()=>GH,"Root",()=>GD,"Separator",()=>GF,"ToggleGroup",()=>GJ,"ToggleItem",()=>GK,"Toolbar",()=>GD,"ToolbarButton",()=>GG,"ToolbarLink",()=>GH,"ToolbarSeparator",()=>GF,"ToolbarToggleGroup",()=>GJ,"ToolbarToggleItem",()=>GK,"createToolbarScope",()=>Gy],50084);var GL=a.i(50084),GL=GL,GM=a.i(11011),GM=GM;let GN=(0,eQ.createContext)({orientation:"horizontal",tooltipSide:"bottom"});function GO({children:a,orientation:b,tooltipSide:c}){let d=GP(),e=c??(b===d.orientation?d.tooltipSide:"horizontal"===b?"bottom":"right");return(0,bT.jsx)(GN.Provider,{value:{orientation:b,tooltipSide:e},children:a})}function GP(){return(0,eQ.useContext)(GN)}let GQ=(0,eQ.forwardRef)(({asChild:a,className:b,tooltipSide:c,...d},e)=>{let f=a?GM.Root:"div";return(0,bT.jsx)(GO,{orientation:"horizontal",tooltipSide:c,children:(0,bT.jsx)(f,{ref:e,className:(0,j1.default)("tlui-row",b),...d})})}),GR=(0,eQ.forwardRef)(({asChild:a,className:b,tooltipSide:c,...d},e)=>{let f=a?GM.Root:"div";return(0,bT.jsx)(GO,{orientation:"vertical",tooltipSide:c,children:(0,bT.jsx)(f,{ref:e,className:(0,j1.default)("tlui-column",b),...d})})}),GS=(0,eQ.forwardRef)(({asChild:a,className:b,tooltipSide:c,...d},e)=>{let f=a?GM.Root:"div";return(0,bT.jsx)(GO,{orientation:"horizontal",tooltipSide:c,children:(0,bT.jsx)(f,{ref:e,className:(0,j1.default)("tlui-grid",b),...d})})});var GT=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),GU=eQ.forwardRef((a,b)=>(0,bT.jsx)(Al.span,{...a,ref:b,style:{...GT,...a.style}}));GU.displayName="VisuallyHidden";var[GV,GW]=z8("Tooltip",[DA]),GX=DA(),GY="TooltipProvider",GZ="tooltip.open",[G$,G_]=GV(GY),G0=a=>{let{__scopeTooltip:b,delayDuration:c=700,skipDelayDuration:d=300,disableHoverableContent:e=!1,children:f}=a,g=eQ.useRef(!0),h=eQ.useRef(!1),i=eQ.useRef(0);return eQ.useEffect(()=>{let a=i.current;return()=>window.clearTimeout(a)},[]),(0,bT.jsx)(G$,{scope:b,isOpenDelayedRef:g,delayDuration:c,onOpen:eQ.useCallback(()=>{window.clearTimeout(i.current),g.current=!1},[]),onClose:eQ.useCallback(()=>{window.clearTimeout(i.current),i.current=window.setTimeout(()=>g.current=!0,d)},[d]),isPointerInTransitRef:h,onPointerInTransitChange:eQ.useCallback(a=>{h.current=a},[]),disableHoverableContent:e,children:f})};G0.displayName=GY;var G1="Tooltip",[G2,G3]=GV(G1),G4=a=>{let{__scopeTooltip:b,children:c,open:d,defaultOpen:e,onOpenChange:f,disableHoverableContent:g,delayDuration:h}=a,i=G_(G1,a.__scopeTooltip),j=GX(b),[k,l]=eQ.useState(null),m=Ac(),n=eQ.useRef(0),o=g??i.disableHoverableContent,p=h??i.delayDuration,q=eQ.useRef(!1),[r,s]=Ae({prop:d,defaultProp:e??!1,onChange:a=>{a?(i.onOpen(),document.dispatchEvent(new CustomEvent(GZ))):i.onClose(),f?.(a)},caller:G1}),t=eQ.useMemo(()=>r?q.current?"delayed-open":"instant-open":"closed",[r]),u=eQ.useCallback(()=>{window.clearTimeout(n.current),n.current=0,q.current=!1,s(!0)},[s]),v=eQ.useCallback(()=>{window.clearTimeout(n.current),n.current=0,s(!1)},[s]),w=eQ.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(()=>{q.current=!0,s(!0),n.current=0},p)},[p,s]);return eQ.useEffect(()=>()=>{n.current&&(window.clearTimeout(n.current),n.current=0)},[]),(0,bT.jsx)(DD,{...j,children:(0,bT.jsx)(G2,{scope:b,contentId:m,open:r,stateAttribute:t,trigger:k,onTriggerChange:l,onTriggerEnter:eQ.useCallback(()=>{i.isOpenDelayedRef.current?w():u()},[i.isOpenDelayedRef,w,u]),onTriggerLeave:eQ.useCallback(()=>{o?v():(window.clearTimeout(n.current),n.current=0)},[v,o]),onOpen:u,onClose:v,disableHoverableContent:o,children:c})})};G4.displayName=G1;var G5="TooltipTrigger",G6=eQ.forwardRef((a,b)=>{let{__scopeTooltip:c,...d}=a,e=G3(G5,c),f=G_(G5,c),g=GX(c),h=z7(b,eQ.useRef(null),e.onTriggerChange),i=eQ.useRef(!1),j=eQ.useRef(!1),k=eQ.useCallback(()=>i.current=!1,[]);return eQ.useEffect(()=>()=>document.removeEventListener("pointerup",k),[k]),(0,bT.jsx)(DF,{asChild:!0,...g,children:(0,bT.jsx)(Al.button,{"aria-describedby":e.open?e.contentId:void 0,"data-state":e.stateAttribute,...d,ref:h,onPointerMove:z4(a.onPointerMove,a=>{"touch"!==a.pointerType&&(j.current||f.isPointerInTransitRef.current||(e.onTriggerEnter(),j.current=!0))}),onPointerLeave:z4(a.onPointerLeave,()=>{e.onTriggerLeave(),j.current=!1}),onPointerDown:z4(a.onPointerDown,()=>{e.open&&e.onClose(),i.current=!0,document.addEventListener("pointerup",k,{once:!0})}),onFocus:z4(a.onFocus,()=>{i.current||e.onOpen()}),onBlur:z4(a.onBlur,e.onClose),onClick:z4(a.onClick,e.onClose)})})});G6.displayName=G5;var G7="TooltipPortal",[G8,G9]=GV(G7,{forceMount:void 0}),Ha=a=>{let{__scopeTooltip:b,forceMount:c,children:d,container:e}=a,f=G3(G7,b);return(0,bT.jsx)(G8,{scope:b,forceMount:c,children:(0,bT.jsx)(AE,{present:c||f.open,children:(0,bT.jsx)(AD,{asChild:!0,container:e,children:d})})})};Ha.displayName=G7;var Hb="TooltipContent",Hc=eQ.forwardRef((a,b)=>{let c=G9(Hb,a.__scopeTooltip),{forceMount:d=c.forceMount,side:e="top",...f}=a,g=G3(Hb,a.__scopeTooltip);return(0,bT.jsx)(AE,{present:d||g.open,children:g.disableHoverableContent?(0,bT.jsx)(Hh,{side:e,...f,ref:b}):(0,bT.jsx)(Hd,{side:e,...f,ref:b})})}),Hd=eQ.forwardRef((a,b)=>{let c=G3(Hb,a.__scopeTooltip),d=G_(Hb,a.__scopeTooltip),e=eQ.useRef(null),f=z7(b,e),[g,h]=eQ.useState(null),{trigger:i,onClose:j}=c,k=e.current,{onPointerInTransitChange:l}=d,m=eQ.useCallback(()=>{h(null),l(!1)},[l]),n=eQ.useCallback((a,b)=>{let c,d=a.currentTarget,e={x:a.clientX,y:a.clientY},f=function(a,b){let c=Math.abs(b.top-a.y),d=Math.abs(b.bottom-a.y),e=Math.abs(b.right-a.x),f=Math.abs(b.left-a.x);switch(Math.min(c,d,e,f)){case f:return"left";case e:return"right";case c:return"top";case d:return"bottom";default:throw Error("unreachable")}}(e,d.getBoundingClientRect());h(((c=[...function(a,b,c=5){let d=[];switch(b){case"top":d.push({x:a.x-c,y:a.y+c},{x:a.x+c,y:a.y+c});break;case"bottom":d.push({x:a.x-c,y:a.y-c},{x:a.x+c,y:a.y-c});break;case"left":d.push({x:a.x+c,y:a.y-c},{x:a.x+c,y:a.y+c});break;case"right":d.push({x:a.x-c,y:a.y-c},{x:a.x-c,y:a.y+c})}return d}(e,f),...function(a){let{top:b,right:c,bottom:d,left:e}=a;return[{x:e,y:b},{x:c,y:b},{x:c,y:d},{x:e,y:d}]}(b.getBoundingClientRect())].slice()).sort((a,b)=>a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:1*!!(a.y>b.y)),function(a){if(a.length<=1)return a.slice();let b=[];for(let c=0;c<a.length;c++){let d=a[c];for(;b.length>=2;){let a=b[b.length-1],c=b[b.length-2];if((a.x-c.x)*(d.y-c.y)>=(a.y-c.y)*(d.x-c.x))b.pop();else break}b.push(d)}b.pop();let c=[];for(let b=a.length-1;b>=0;b--){let d=a[b];for(;c.length>=2;){let a=c[c.length-1],b=c[c.length-2];if((a.x-b.x)*(d.y-b.y)>=(a.y-b.y)*(d.x-b.x))c.pop();else break}c.push(d)}return(c.pop(),1===b.length&&1===c.length&&b[0].x===c[0].x&&b[0].y===c[0].y)?b:b.concat(c)}(c))),l(!0)},[l]);return eQ.useEffect(()=>()=>m(),[m]),eQ.useEffect(()=>{if(i&&k){let a=a=>n(a,k),b=a=>n(a,i);return i.addEventListener("pointerleave",a),k.addEventListener("pointerleave",b),()=>{i.removeEventListener("pointerleave",a),k.removeEventListener("pointerleave",b)}}},[i,k,n,m]),eQ.useEffect(()=>{if(g){let a=a=>{let b=a.target,c={x:a.clientX,y:a.clientY},d=i?.contains(b)||k?.contains(b),e=!function(a,b){let{x:c,y:d}=a,e=!1;for(let a=0,f=b.length-1;a<b.length;f=a++){let g=b[a],h=b[f],i=g.x,j=g.y,k=h.x,l=h.y;j>d!=l>d&&c<(k-i)*(d-j)/(l-j)+i&&(e=!e)}return e}(c,g);d?m():e&&(m(),j())};return document.addEventListener("pointermove",a),()=>document.removeEventListener("pointermove",a)}},[i,k,g,j,m]),(0,bT.jsx)(Hh,{...a,ref:f})}),[He,Hf]=GV(G1,{isInside:!1}),Hg=Ai("TooltipContent"),Hh=eQ.forwardRef((a,b)=>{let{__scopeTooltip:c,children:d,"aria-label":e,onEscapeKeyDown:f,onPointerDownOutside:g,...h}=a,i=G3(Hb,c),j=GX(c),{onClose:k}=i;return eQ.useEffect(()=>(document.addEventListener(GZ,k),()=>document.removeEventListener(GZ,k)),[k]),eQ.useEffect(()=>{if(i.trigger){let a=a=>{let b=a.target;b?.contains(i.trigger)&&k()};return window.addEventListener("scroll",a,{capture:!0}),()=>window.removeEventListener("scroll",a,{capture:!0})}},[i.trigger,k]),(0,bT.jsx)(Aq,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:a=>a.preventDefault(),onDismiss:k,children:(0,bT.jsxs)(DJ,{"data-state":i.stateAttribute,...j,...h,ref:b,style:{...h.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,bT.jsx)(Hg,{children:d}),(0,bT.jsx)(He,{scope:c,isInside:!0,children:(0,bT.jsx)(GU,{id:i.contentId,role:"tooltip",children:e||d})})]})})});Hc.displayName=Hb;var Hi="TooltipArrow",Hj=eQ.forwardRef((a,b)=>{let{__scopeTooltip:c,...d}=a,e=GX(c);return Hf(Hi,c).isInside?null:(0,bT.jsx)(DM,{...e,...d,ref:b})});Hj.displayName=Hi,a.s(["Arrow",()=>Hj,"Content",()=>Hc,"Portal",()=>Ha,"Provider",()=>G0,"Root",()=>G4,"Tooltip",()=>G4,"TooltipArrow",()=>Hj,"TooltipContent",()=>Hc,"TooltipPortal",()=>Ha,"TooltipProvider",()=>G0,"TooltipTrigger",()=>G6,"Trigger",()=>G6,"createTooltipScope",()=>GW],99811);var Hk=a.i(99811),Hk=Hk;class Hl{static instance=null;currentTooltip=eM("current tooltip",null);destroyTimeoutId=null;static getInstance(){return Hl.instance||(Hl.instance=new Hl),Hl.instance}showTooltip(a,b,c,d,e,f,g){this.destroyTimeoutId&&(clearTimeout(this.destroyTimeoutId),this.destroyTimeoutId=null),this.currentTooltip.set({id:a,content:b,side:d,sideOffset:e,showOnMobile:f,targetElement:c,delayDuration:g})}updateCurrentTooltip(a,b){this.currentTooltip.update(c=>c?.id===a?b(c):c)}hideTooltip(a,b,c=!1){let d=()=>{this.currentTooltip.get()?.id===b&&(this.currentTooltip.set(null),this.destroyTimeoutId=null)};a&&!c?this.destroyTimeoutId=a.timers.setTimeout(d,300):d()}hideAllTooltips(){this.currentTooltip.set(null),this.destroyTimeoutId=null}getCurrentTooltipData(){let a=this.currentTooltip.get();return a&&(this.supportsHover()||a.showOnMobile)?a:null}supportsHoverAtom=null;supportsHover(){if(!this.supportsHoverAtom){let a=window.matchMedia("(hover: hover)"),b=eM("has hover",a.matches);this.supportsHoverAtom=b,a.addEventListener("change",a=>{b.set(a.matches)})}return this.supportsHoverAtom.get()}}let Hm=Hl.getInstance(),Hn=(0,eQ.createContext)(!1);function Ho({children:a}){return(0,bT.jsx)(Hk.Provider,{skipDelayDuration:700,children:(0,bT.jsxs)(Hn.Provider,{value:!0,children:[a,(0,bT.jsx)(Hp,{})]})})}function Hp(){let[a,b]=(0,eQ.useState)(!1),c=(0,eQ.useRef)(null),d=(0,eQ.useRef)(!0),e=kq(),f=e$("current tooltip",()=>Hm.getCurrentTooltipData(),[]),g=e$("camera state",()=>e?.getCameraState(),[e]);return((0,eQ.useEffect)(()=>{"moving"===g&&a&&f&&Hm.hideTooltip(e,f.id,!0)},[g,a,f,e]),(0,eQ.useEffect)(()=>{function b(b){"Escape"===b.key&&f&&a&&(Hm.hideTooltip(e,f.id),b.stopPropagation())}return document.addEventListener("keydown",b,{capture:!0}),()=>{document.removeEventListener("keydown",b,{capture:!0})}},[e,f,a]),(0,eQ.useEffect)(()=>{let a=null;if(f&&c.current){let e=f.targetElement.getBoundingClientRect(),g=c.current;g.style.position="fixed",g.style.left=`${e.left}px`,g.style.top=`${e.top}px`,g.style.width=`${e.width}px`,g.style.height=`${e.height}px`,g.style.pointerEvents="none",g.style.zIndex="9999",d.current?a=setTimeout(()=>{b(!0),d.current=!1},f.delayDuration):b(!0)}else b(!1),d.current=!0;return()=>{null!==a&&clearTimeout(a)}},[f]),f)?(0,bT.jsxs)(Hk.Root,{open:a,delayDuration:0,children:[(0,bT.jsx)(Hk.Trigger,{asChild:!0,children:(0,bT.jsx)("div",{ref:c})}),(0,bT.jsxs)(Hk.Content,{className:"tlui-tooltip",side:f.side,sideOffset:f.sideOffset,avoidCollisions:!0,collisionPadding:8,dir:"ltr",children:[f.content,(0,bT.jsx)(Hk.Arrow,{className:"tlui-tooltip__arrow"})]})]}):null}let Hq=(0,eQ.forwardRef)(({children:a,content:b,side:c,sideOffset:d=5,disabled:e=!1,showOnMobile:f=!1,delayDuration:g},h)=>{let i,j=kq(),k=(0,eQ.useRef)(cA(void 0)),l=(0,eQ.useContext)(Hn),m=e$("enhancedA11yMode",()=>j?.user.getEnhancedA11yMode(),[j]),n=GP(),o=c??n.tooltipSide;if((0,eQ.useEffect)(()=>{let a=k.current;return()=>{l&&Hm.hideTooltip(j,a,!0)}},[j,l]),(0,eQ.useLayoutEffect)(()=>{l&&Hm.getCurrentTooltipData()?.id===k.current&&Hm.updateCurrentTooltip(k.current,a=>({...a,content:b,side:o,sideOffset:d,showOnMobile:f}))},[b,o,d,f,l]),e||!b)return(0,bT.jsx)(bT.Fragment,{children:a});if(i=m?0:g??(j?.options.tooltipDelayMs||700),!l||m)return(0,bT.jsxs)(Hk.Root,{delayDuration:i,disableHoverableContent:!m,children:[(0,bT.jsx)(Hk.Trigger,{asChild:!0,ref:h,children:a}),(0,bT.jsxs)(Hk.Content,{className:"tlui-tooltip",side:o,sideOffset:d,avoidCollisions:!0,collisionPadding:8,dir:"ltr",children:[b,(0,bT.jsx)(Hk.Arrow,{className:"tlui-tooltip__arrow"})]})]});let p=eQ.default.Children.only(a);return cg(eQ.default.isValidElement(p),"TldrawUiTooltip children must be a single element"),eQ.default.cloneElement(a,{onMouseEnter:a=>{p.props.onMouseEnter?.(a),Hm.showTooltip(k.current,b,a.currentTarget,o,d,f,i)},onMouseLeave:a=>{p.props.onMouseLeave?.(a),Hm.hideTooltip(j,k.current)},onFocus:a=>{p.props.onFocus?.(a),Hm.showTooltip(k.current,b,a.currentTarget,o,d,f,i)},onBlur:a=>{p.props.onBlur?.(a),Hm.hideTooltip(j,k.current)}})}),Hr={horizontal:GQ,vertical:GR,grid:GS},Hs=eQ.default.forwardRef(({children:a,className:b,label:c,orientation:d="horizontal",tooltipSide:e,...f},g)=>{let h=Hr[d];return(0,bT.jsx)(h,{asChild:!0,tooltipSide:e,children:(0,bT.jsx)(GL.Root,{ref:g,...f,className:(0,j1.default)("tlui-toolbar",b),"aria-label":c,orientation:"grid"===d?"horizontal":d,children:a})})}),Ht=eQ.default.forwardRef(({asChild:a,children:b,type:c,isActive:d,tooltip:e,...f},g)=>{let h=(0,bT.jsx)(GL.Button,{ref:g,asChild:a,draggable:!1,"data-isactive":d,...f,"aria-label":f.title,title:void 0,className:(0,j1.default)("tlui-button",`tlui-button__${c}`,f.className),children:b}),i=e||f.title;return(0,bT.jsx)(Hq,{content:i,children:h})}),Hu=({children:a,className:b,type:c,asChild:d,...e})=>(0,bT.jsx)(GL.ToggleGroup,{asChild:d,type:c,...e,role:"radiogroup",className:(0,j1.default)("tlui-toolbar-toggle-group",b),children:a}),Hv=({children:a,className:b,type:c,value:d,tooltip:e,...f})=>{let g=(0,bT.jsx)(GL.ToggleItem,{...f,title:void 0,className:(0,j1.default)("tlui-button",`tlui-button__${c}`,"tlui-toolbar-toggle-group-item",b),value:d,children:a}),h=e||f.title;return(0,bT.jsx)(Hq,{content:h,children:g})};function Hw({disabled:a=!1,spinner:b=!1,readonlyOk:c=!1,id:d,kbd:e,label:f,icon:g,iconLeft:h,onSelect:i,noClose:j,isSelected:k,onDragStart:l}){let{type:m,sourceId:n}=Cg(),o=zQ(),[p,q]=(0,eQ.useState)(!1);if(Ft()&&!c)return null;let r=Qg(f,m),s=e?Fy(e):void 0,t=r?o(r):void 0,u=t&&s?`${t} ${s}`:t;switch(m){case"menu":return(0,bT.jsx)(F9,{children:(0,bT.jsxs)(zS,{type:"menu","data-testid":`${n}.${d}`,disabled:a,onClick:a=>{j&&kb(a),p?q(!1):i(n)},children:[h&&(0,bT.jsx)(BV,{icon:h,small:!0}),(0,bT.jsx)(z3,{children:t}),e&&(0,bT.jsx)(Gb,{children:e})]})});case"context-menu":if(a)return null;return(0,bT.jsxs)(Fs.Item,{dir:"ltr",draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${n}.${d}`,onSelect:a=>{j&&kb(a),p?q(!1):i(n)},children:[(0,bT.jsx)("span",{className:"tlui-button__label",draggable:!1,children:t}),h&&(0,bT.jsx)(BV,{icon:h,small:!0}),e&&(0,bT.jsx)(Gb,{children:e}),b&&(0,bT.jsx)(Fz,{})]});case"small-icons":case"icons":return(0,bT.jsx)(Ht,{"data-testid":`${n}.${d}`,type:"icon",title:u,disabled:a,onClick:()=>i(n),children:(0,bT.jsx)(BV,{icon:g,small:!0})});case"keyboard-shortcuts":if(!e)return console.warn(`Menu item '${f}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null;return(0,bT.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${n}.${d}`,children:[(0,bT.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:t}),(0,bT.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,bT.jsx)(Gb,{visibleOnMobileLayout:!0,children:e})})]});case"helper-buttons":return(0,bT.jsxs)(zS,{type:"low",onClick:()=>i(n),children:[(0,bT.jsx)(BV,{icon:g}),(0,bT.jsx)(z3,{children:t})]});case"toolbar":if(l)return(0,bT.jsx)(Hx,{id:d,icon:g,onSelect:i,onDragStart:l,labelStr:t,titleStr:u,disabled:a,isSelected:k});return(0,bT.jsx)(Ht,{"aria-label":t,"aria-pressed":k?"true":"false","data-testid":`tools.${d}`,"data-value":d,disabled:a,onClick:()=>i("toolbar"),onTouchStart:a=>{kb(a),i("toolbar")},title:u,type:"tool",children:(0,bT.jsx)(BV,{icon:g})});case"toolbar-overflow":if(l)return(0,bT.jsx)(Hx,{id:d,icon:g,onSelect:i,onDragStart:l,labelStr:t,titleStr:u,disabled:a,isSelected:k,overflow:!0});return(0,bT.jsx)(Ht,{"aria-label":t,"aria-pressed":k?"true":"false",isActive:k,"data-testid":`tools.more.${d}`,"data-value":d,disabled:a,onClick:()=>i("toolbar"),title:u,type:"icon",children:(0,bT.jsx)(BV,{icon:g})});default:throw cf(m)}}function Hx({id:a,labelStr:b,titleStr:c,disabled:d,isSelected:e,icon:f,onSelect:g,onDragStart:h,overflow:i}){let j,k=(j=kp(),(0,eQ.useMemo)(()=>{let a={name:"idle"};return{onPointerDown:function(b){a={name:"pointing",screenSpaceStart:{x:b.clientX,y:b.clientY}},b.currentTarget.setPointerCapture(b.pointerId)},onPointerMove:function(b){if(!b.isSpecialRedispatchedEvent&&"pointing"===a.name&&jA.Dist2(a.screenSpaceStart,{x:b.clientX,y:b.clientY})>(j.getInstanceState().isCoarsePointer?j.options.uiCoarseDragDistanceSquared:j.options.uiDragDistanceSquared)){let c=a.screenSpaceStart;a={name:"dragging",screenSpaceStart:c},j.run(()=>{j.setCurrentTool("select"),j.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...kh(j,b),point:c}),j.selectNone(),h?.("toolbar",{type:"pointer",target:"canvas",name:"pointer_move",...kh(j,b),point:c}),Hm.hideAllTooltips(),j.getContainer().focus()})}},onPointerUp:function(a){a.isSpecialRedispatchedEvent||(a.currentTarget.releasePointerCapture(a.pointerId),j.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...kh(j,a)}))},onClick:function(){if("dragging"===a.name||"dragged"===a.name)return a={name:"idle"},!0;a={name:"idle"},g?.("toolbar")}}},[h,j,g]));return i?(0,bT.jsx)(Ht,{"aria-label":b,"aria-pressed":e?"true":"false",isActive:e,className:"tlui-button-grid__button","data-testid":`tools.more.${a}`,"data-value":a,disabled:d,title:c,type:"icon",...k,children:(0,bT.jsx)(BV,{icon:f})}):(0,bT.jsx)(Ht,{"aria-label":b,"aria-pressed":e?"true":"false","data-testid":`tools.${a}`,"data-value":a,disabled:d,onTouchStart:a=>{kb(a),g("toolbar")},title:c,type:"tool",...k,children:(0,bT.jsx)(BV,{icon:f})})}function Hy({actionId:a="",...b}){let c=Qf()[a];return c?(0,bT.jsx)(Hw,{...c,...b}):null}function Hz({id:a,label:b,className:c,children:d}){let e=Cg(),{orientation:f}=GP(),g=zQ(),h=Qg(b,e.type),i=h?g(h):void 0;switch(e.type){case"menu":return(0,bT.jsx)(F8,{className:c,"data-testid":`${e.sourceId}-group.${a}`,children:d});case"context-menu":return(0,bT.jsx)("div",{dir:"ltr",className:(0,j1.default)("tlui-menu__group",c),"data-testid":`${e.sourceId}-group.${a}`,children:d});case"keyboard-shortcuts":return(0,bT.jsxs)("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${e.sourceId}-group.${a}`,children:[(0,bT.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:i}),(0,bT.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:d})]});case"toolbar":return(0,bT.jsx)("horizontal"===f?GQ:GR,{className:"tlui-main-toolbar__group","data-testid":`${e.sourceId}-group.${a}`,children:d});case"toolbar-overflow":return(0,bT.jsx)(GS,{className:"tlui-main-toolbar__group","data-testid":`${e.sourceId}-group.${a}`,children:d});default:return d}}let HA=(0,eQ.createContext)(null);function HB({context:a,children:b}){let c=(0,eQ.useContext)(HA),d=F0(),e=eW("dialogs",[]),f=(0,eQ.useMemo)(()=>({dialogs:e,addDialog(b){let c=b.id??cA(void 0);return e.update(a=>[...a.filter(a=>a.id!==b.id),{...b,id:c}]),d("open-menu",{source:"dialog",id:c}),m3.addOpenMenu(c,a),c},removeDialog(b){let c=e.get().find(a=>a.id===b);return c&&(c.onClose?.(),d("close-menu",{source:"dialog",id:b}),m3.deleteOpenMenu(b,a),e.update(a=>a.filter(a=>a!==c))),b},clearDialogs(){let b=e.get();0!==b.length&&(b.forEach(b=>{b.onClose?.(),d("close-menu",{source:"dialog",id:b.id}),m3.deleteOpenMenu(b.id,a)}),e.set([]))}}),[d,e,a]);return c?(0,bT.jsx)(bT.Fragment,{children:b}):(0,bT.jsx)(HA.Provider,{value:f,children:b})}function HC(){let a=(0,eQ.useContext)(HA);if(!a)throw Error("useDialogs must be used within a DialogsProvider");return a}var HD="ToastProvider",[HE,HF,HG]=Cj("Toast"),[HH,HI]=z8("Toast",[HG]),[HJ,HK]=HH(HD),HL=a=>{let{__scopeToast:b,label:c="Notification",duration:d=5e3,swipeDirection:e="right",swipeThreshold:f=50,children:g}=a,[h,i]=eQ.useState(null),[j,k]=eQ.useState(0),l=eQ.useRef(!1),m=eQ.useRef(!1);return c.trim()||console.error(`Invalid prop \`label\` supplied to \`${HD}\`. Expected non-empty \`string\`.`),(0,bT.jsx)(HE.Provider,{scope:b,children:(0,bT.jsx)(HJ,{scope:b,label:c,duration:d,swipeDirection:e,swipeThreshold:f,toastCount:j,viewport:h,onViewportChange:i,onToastAdd:eQ.useCallback(()=>k(a=>a+1),[]),onToastRemove:eQ.useCallback(()=>k(a=>a-1),[]),isFocusedToastEscapeKeyDownRef:l,isClosePausedRef:m,children:g})})};HL.displayName=HD;var HM="ToastViewport",HN=["F8"],HO="toast.viewportPause",HP="toast.viewportResume",HQ=eQ.forwardRef((a,b)=>{let{__scopeToast:c,hotkey:d=HN,label:e="Notifications ({hotkey})",...f}=a,g=HK(HM,c),h=HF(c),i=eQ.useRef(null),j=eQ.useRef(null),k=eQ.useRef(null),l=eQ.useRef(null),m=z7(b,l,g.onViewportChange),n=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),o=g.toastCount>0;eQ.useEffect(()=>{let a=a=>{0!==d.length&&d.every(b=>a[b]||a.code===b)&&l.current?.focus()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[d]),eQ.useEffect(()=>{let a=i.current,b=l.current;if(o&&a&&b){let c=()=>{if(!g.isClosePausedRef.current){let a=new CustomEvent(HO);b.dispatchEvent(a),g.isClosePausedRef.current=!0}},d=()=>{if(g.isClosePausedRef.current){let a=new CustomEvent(HP);b.dispatchEvent(a),g.isClosePausedRef.current=!1}},e=b=>{a.contains(b.relatedTarget)||d()},f=()=>{a.contains(document.activeElement)||d()};return a.addEventListener("focusin",c),a.addEventListener("focusout",e),a.addEventListener("pointermove",c),a.addEventListener("pointerleave",f),window.addEventListener("blur",c),window.addEventListener("focus",d),()=>{a.removeEventListener("focusin",c),a.removeEventListener("focusout",e),a.removeEventListener("pointermove",c),a.removeEventListener("pointerleave",f),window.removeEventListener("blur",c),window.removeEventListener("focus",d)}}},[o,g.isClosePausedRef]);let p=eQ.useCallback(({tabbingDirection:a})=>{let b=h().map(b=>{let c=b.ref.current,d=[c,...function(a){let b=[],c=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{let b="INPUT"===a.tagName&&"hidden"===a.type;return a.disabled||a.hidden||b?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)b.push(c.currentNode);return b}(c)];return"forwards"===a?d:d.reverse()});return("forwards"===a?b.reverse():b).flat()},[h]);return eQ.useEffect(()=>{let a=l.current;if(a){let b=b=>{let c=b.altKey||b.ctrlKey||b.metaKey;if("Tab"===b.key&&!c){let c=document.activeElement,d=b.shiftKey;if(b.target===a&&d)return void j.current?.focus();let e=p({tabbingDirection:d?"backwards":"forwards"}),f=e.findIndex(a=>a===c);H6(e.slice(f+1))?b.preventDefault():d?j.current?.focus():k.current?.focus()}};return a.addEventListener("keydown",b),()=>a.removeEventListener("keydown",b)}},[h,p]),(0,bT.jsxs)(Ar,{ref:i,role:"region","aria-label":e.replace("{hotkey}",n),tabIndex:-1,style:{pointerEvents:o?void 0:"none"},children:[o&&(0,bT.jsx)(HS,{ref:j,onFocusFromOutsideViewport:()=>{H6(p({tabbingDirection:"forwards"}))}}),(0,bT.jsx)(HE.Slot,{scope:c,children:(0,bT.jsx)(Al.ol,{tabIndex:-1,...f,ref:m})}),o&&(0,bT.jsx)(HS,{ref:k,onFocusFromOutsideViewport:()=>{H6(p({tabbingDirection:"backwards"}))}})]})});HQ.displayName=HM;var HR="ToastFocusProxy",HS=eQ.forwardRef((a,b)=>{let{__scopeToast:c,onFocusFromOutsideViewport:d,...e}=a,f=HK(HR,c);return(0,bT.jsx)(GU,{tabIndex:0,...e,ref:b,style:{position:"fixed"},onFocus:a=>{let b=a.relatedTarget;f.viewport?.contains(b)||d()}})});HS.displayName=HR;var HT="Toast",HU=eQ.forwardRef((a,b)=>{let{forceMount:c,open:d,defaultOpen:e,onOpenChange:f,...g}=a,[h,i]=Ae({prop:d,defaultProp:e??!0,onChange:f,caller:HT});return(0,bT.jsx)(AE,{present:c||h,children:(0,bT.jsx)(HX,{open:h,...g,ref:b,onClose:()=>i(!1),onPause:An(a.onPause),onResume:An(a.onResume),onSwipeStart:z4(a.onSwipeStart,a=>{a.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:z4(a.onSwipeMove,a=>{let{x:b,y:c}=a.detail.delta;a.currentTarget.setAttribute("data-swipe","move"),a.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${b}px`),a.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${c}px`)}),onSwipeCancel:z4(a.onSwipeCancel,a=>{a.currentTarget.setAttribute("data-swipe","cancel"),a.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),a.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),a.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),a.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:z4(a.onSwipeEnd,a=>{let{x:b,y:c}=a.detail.delta;a.currentTarget.setAttribute("data-swipe","end"),a.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),a.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),a.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${b}px`),a.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${c}px`),i(!1)})})})});HU.displayName=HT;var[HV,HW]=HH(HT,{onClose(){}}),HX=eQ.forwardRef((a,b)=>{let{__scopeToast:c,type:d="foreground",duration:e,open:f,onClose:g,onEscapeKeyDown:h,onPause:i,onResume:j,onSwipeStart:k,onSwipeMove:l,onSwipeCancel:m,onSwipeEnd:n,...o}=a,p=HK(HT,c),[q,r]=eQ.useState(null),s=z7(b,a=>r(a)),t=eQ.useRef(null),u=eQ.useRef(null),v=e||p.duration,w=eQ.useRef(0),y=eQ.useRef(v),z=eQ.useRef(0),{onToastAdd:A,onToastRemove:B}=p,C=An(()=>{q?.contains(document.activeElement)&&p.viewport?.focus(),g()}),D=eQ.useCallback(a=>{a&&a!==1/0&&(window.clearTimeout(z.current),w.current=new Date().getTime(),z.current=window.setTimeout(C,a))},[C]);eQ.useEffect(()=>{let a=p.viewport;if(a){let b=()=>{D(y.current),j?.()},c=()=>{let a=new Date().getTime()-w.current;y.current=y.current-a,window.clearTimeout(z.current),i?.()};return a.addEventListener(HO,c),a.addEventListener(HP,b),()=>{a.removeEventListener(HO,c),a.removeEventListener(HP,b)}}},[p.viewport,v,i,j,D]),eQ.useEffect(()=>{f&&!p.isClosePausedRef.current&&D(v)},[f,v,p.isClosePausedRef,D]),eQ.useEffect(()=>(A(),()=>B()),[A,B]);let E=eQ.useMemo(()=>q?function a(b){let c=[];return Array.from(b.childNodes).forEach(b=>{var d;if(b.nodeType===b.TEXT_NODE&&b.textContent&&c.push(b.textContent),(d=b).nodeType===d.ELEMENT_NODE){let d=b.ariaHidden||b.hidden||"none"===b.style.display,e=""===b.dataset.radixToastAnnounceExclude;if(!d)if(e){let a=b.dataset.radixToastAnnounceAlt;a&&c.push(a)}else c.push(...a(b))}}),c}(q):null,[q]);return p.viewport?(0,bT.jsxs)(bT.Fragment,{children:[E&&(0,bT.jsx)(HY,{__scopeToast:c,role:"status","aria-live":"foreground"===d?"assertive":"polite",children:E}),(0,bT.jsx)(HV,{scope:c,onClose:C,children:lI.createPortal((0,bT.jsx)(HE.ItemSlot,{scope:c,children:(0,bT.jsx)(Aq,{asChild:!0,onEscapeKeyDown:z4(h,()=>{p.isFocusedToastEscapeKeyDownRef.current||C(),p.isFocusedToastEscapeKeyDownRef.current=!1}),children:(0,bT.jsx)(Al.li,{tabIndex:0,"data-state":f?"open":"closed","data-swipe-direction":p.swipeDirection,...o,ref:s,style:{userSelect:"none",touchAction:"none",...a.style},onKeyDown:z4(a.onKeyDown,a=>{"Escape"===a.key&&(h?.(a.nativeEvent),a.nativeEvent.defaultPrevented||(p.isFocusedToastEscapeKeyDownRef.current=!0,C()))}),onPointerDown:z4(a.onPointerDown,a=>{0===a.button&&(t.current={x:a.clientX,y:a.clientY})}),onPointerMove:z4(a.onPointerMove,a=>{if(!t.current)return;let b=a.clientX-t.current.x,c=a.clientY-t.current.y,d=!!u.current,e=["left","right"].includes(p.swipeDirection),f=["left","up"].includes(p.swipeDirection)?Math.min:Math.max,g=e?f(0,b):0,h=e?0:f(0,c),i="touch"===a.pointerType?10:2,j={x:g,y:h},m={originalEvent:a,delta:j};d?(u.current=j,H4("toast.swipeMove",l,m,{discrete:!1})):H5(j,p.swipeDirection,i)?(u.current=j,H4("toast.swipeStart",k,m,{discrete:!1}),a.target.setPointerCapture(a.pointerId)):(Math.abs(b)>i||Math.abs(c)>i)&&(t.current=null)}),onPointerUp:z4(a.onPointerUp,a=>{let b=u.current,c=a.target;if(c.hasPointerCapture(a.pointerId)&&c.releasePointerCapture(a.pointerId),u.current=null,t.current=null,b){let c=a.currentTarget,d={originalEvent:a,delta:b};H5(b,p.swipeDirection,p.swipeThreshold)?H4("toast.swipeEnd",n,d,{discrete:!0}):H4("toast.swipeCancel",m,d,{discrete:!0}),c.addEventListener("click",a=>a.preventDefault(),{once:!0})}})})})}),p.viewport)})]}):null}),HY=a=>{let{__scopeToast:b,children:c,...d}=a,e=HK(HT,b),[f,g]=eQ.useState(!1),[h,i]=eQ.useState(!1);return function(a=()=>{}){let b=An(a);z9(()=>{let a=0,c=0;return a=window.requestAnimationFrame(()=>c=window.requestAnimationFrame(b)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(c)}},[b])}(()=>g(!0)),eQ.useEffect(()=>{let a=window.setTimeout(()=>i(!0),1e3);return()=>window.clearTimeout(a)},[]),h?null:(0,bT.jsx)(AD,{asChild:!0,children:(0,bT.jsx)(GU,{...d,children:f&&(0,bT.jsxs)(bT.Fragment,{children:[e.label," ",c]})})})},HZ=eQ.forwardRef((a,b)=>{let{__scopeToast:c,...d}=a;return(0,bT.jsx)(Al.div,{...d,ref:b})});HZ.displayName="ToastTitle";var H$=eQ.forwardRef((a,b)=>{let{__scopeToast:c,...d}=a;return(0,bT.jsx)(Al.div,{...d,ref:b})});H$.displayName="ToastDescription";var H_="ToastAction",H0=eQ.forwardRef((a,b)=>{let{altText:c,...d}=a;return c.trim()?(0,bT.jsx)(H3,{altText:c,asChild:!0,children:(0,bT.jsx)(H2,{...d,ref:b})}):(console.error(`Invalid prop \`altText\` supplied to \`${H_}\`. Expected non-empty \`string\`.`),null)});H0.displayName=H_;var H1="ToastClose",H2=eQ.forwardRef((a,b)=>{let{__scopeToast:c,...d}=a,e=HW(H1,c);return(0,bT.jsx)(H3,{asChild:!0,children:(0,bT.jsx)(Al.button,{type:"button",...d,ref:b,onClick:z4(a.onClick,e.onClose)})})});H2.displayName=H1;var H3=eQ.forwardRef((a,b)=>{let{__scopeToast:c,altText:d,...e}=a;return(0,bT.jsx)(Al.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":d||void 0,...e,ref:b})});function H4(a,b,c,{discrete:d}){let e=c.originalEvent.currentTarget,f=new CustomEvent(a,{bubbles:!0,cancelable:!0,detail:c});b&&e.addEventListener(a,b,{once:!0}),d?Am(e,f):e.dispatchEvent(f)}var H5=(a,b,c=0)=>{let d=Math.abs(a.x),e=Math.abs(a.y),f=d>e;return"left"===b||"right"===b?f&&d>c:!f&&e>c};function H6(a){let b=document.activeElement;return a.some(a=>a===b||(a.focus(),document.activeElement!==b))}a.s(["Action",()=>H0,"Close",()=>H2,"Description",()=>H$,"Provider",()=>HL,"Root",()=>HU,"Title",()=>HZ,"Toast",()=>HU,"ToastAction",()=>H0,"ToastClose",()=>H2,"ToastDescription",()=>H$,"ToastProvider",()=>HL,"ToastTitle",()=>HZ,"ToastViewport",()=>HQ,"Viewport",()=>HQ,"createToastScope",()=>HI],26712);var H7=a.i(26712),H7=H7;let H8=(0,eQ.createContext)(null);function H9({children:a}){let b=eW("toasts",[]),c=(0,eQ.useContext)(H8),d=(0,eQ.useMemo)(()=>({toasts:b,addToast(a){let c=a.id??cA(void 0);return b.update(b=>[...b.filter(b=>b.id!==a.id),{...a,id:c}]),c},removeToast:a=>(b.update(b=>b.filter(b=>b.id!==a)),a),clearToasts(){b.set([])}}),[b]);return c?(0,bT.jsx)(bT.Fragment,{children:a}):(0,bT.jsx)(H7.Provider,{children:(0,bT.jsx)(H8.Provider,{value:d,children:a})})}function Ia(){let a=(0,eQ.useContext)(H8);if(!a)throw Error("useToasts must be used within a ToastsProvider");return a}function Ib(a){return new Promise(b=>{let{allowMultiple:c=!0,mimeTypes:d=[]}=a||{},e=document.createElement("input");function f(){e.removeEventListener("change",g),e.removeEventListener("cancel",h),e.remove()}async function g(a){let c=a.target.files;if(!c||0===c.length){b([]),f();return}let d=Array.from(c);e.value="",b(d),f()}function h(){b([]),f()}e.type="file",e.accept=d?.join(","),e.multiple=c,e.style.display="none",document.body.appendChild(e),e.addEventListener("cancel",h),e.addEventListener("change",g),e?.click()})}var Ic=a.i(72091);let Id="web image/vnd.tldraw+png",Ie={png:Id},If={[Id]:"image/png"};async function Ig(a,b,c,d){let e=b.map(a=>a instanceof File?a:new File([a],"tldrawFile",{type:a.type}));a.markHistoryStoppingPoint("paste"),await a.putExternalContent({type:"files",files:e,point:c,sources:d})}async function Ih(a,b,c,d){return a.markHistoryStoppingPoint("paste"),await a.putExternalContent({type:"url",point:c,url:b,sources:d})}let Ii=[Id,"image/png","image/jpeg","image/webp","image/svg+xml"];function Ij(a){let b=document.implementation.createHTMLDocument("");return b.documentElement.innerHTML=a.trim(),b.body.textContent||b.body.innerText||""}let Ik=["input","select","textarea"];function Il(a){let{activeElement:b}=document;return a.menus.hasAnyOpenMenus()||b&&(b.isContentEditable||Ik.indexOf(b.tagName.toLowerCase())>-1)}let Im=(a,b,c,d)=>{let e=(a=>{let b=a.split(/[\n\s]/);for(let a of b)try{let b=new URL(a);if("http:"!==b.protocol&&"https:"!==b.protocol)return}catch{return}return r$(b)})(b);if(e)for(let b of e)Ih(a,b,c);else if((a=>{try{let b=new URL(a);return"http:"===b.protocol||"https:"===b.protocol}catch{return!1}})(b))Ih(a,b,c);else/^<svg/.test(b)?(a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"svg-text",text:b,point:c,sources:d})):(a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"text",text:b,point:c,sources:d}))},In=async(a,b,c)=>{if(null!==a.getEditingShapeId())return;if(!b)throw Error("No clipboard data");let d=[];for(let a of Object.values(b.items))switch(a.kind){case"file":d.push({type:"file",source:new Promise(b=>b(a.getAsFile()))});break;case"string":"text/html"===a.type?d.push({type:"html",source:new Promise(b=>a.getAsString(b))}):"text/plain"===a.type?d.push({type:"text",source:new Promise(b=>a.getAsString(b))}):d.push({type:a.type,source:new Promise(b=>a.getAsString(b))})}Ip(a,d,c)},Io=async({editor:a,clipboardItems:b,point:c,fallbackFiles:d})=>{let e=[];for(let a of b){for(let b of Ii)if(a.types.includes(b)){let c=a.getType(b).then(a=>ct.rewriteMimeType(a,cV(If,b)??b));e.push({type:"blob",source:c});break}a.types.includes("text/html")&&e.push({type:"html",source:(async()=>{let b=await a.getType("text/html");return await ct.blobToText(b)})()}),a.types.includes("text/uri-list")&&e.push({type:"url",source:(async()=>{let b=await a.getType("text/uri-list");return await ct.blobToText(b)})()}),a.types.includes("text/plain")&&e.push({type:"text",source:(async()=>{let b=await a.getType("text/plain");return await ct.blobToText(b)})()})}return d?.length&&1===e.length&&"text"===e[0].type?(e.pop(),e.push(...d.map(a=>({type:"file",source:Promise.resolve(a)})))):d?.length&&0===e.length&&e.push(...d.map(a=>({type:"file",source:Promise.resolve(a)}))),await Ip(a,e,c)};async function Ip(a,b,c){let d=b.filter(a=>("file"===a.type||"blob"===a.type)&&null!==a.source);if(d.length){if(d.length>a.options.maxFilesAtOnce)throw Error("Too many files");let b=b5(await Promise.all(d.map(a=>a.source)));return await Ig(a,b,c)}let e=await Promise.all(b.filter(a=>"file"!==a.type).map(a=>new Promise(b=>{"file"===a.type?b({type:"error",data:null,reason:"unexpected file"}):a.source.then(c=>{let d=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(d)try{let a;try{a=JSON.parse(d)}catch{let c=Ic.default.decompressFromBase64(d);if(null===c)return void b({type:"error",data:null,reason:"found tldraw data comment but could not parse"});a=JSON.parse(c)}if("application/tldraw"!==a.type)return void b({type:"error",data:a,reason:`found tldraw data comment but JSON was of a different type: ${a.type}`});if(3===a.version)try{let c=JSON.parse(Ic.default.decompressFromBase64(a.data.otherCompressed)||"{}"),d={assets:a.data.assets||[],...c};b({type:"tldraw",data:d});return}catch(c){b({type:"error",data:a,reason:`failed to decompress version 2 clipboard data: ${c}`});return}if(2===a.version)b({type:"tldraw",data:a.data});else{if("string"==typeof a.data)return void b({type:"error",data:a,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});b({type:"tldraw",data:a.data});return}}catch{b({type:"error",data:d,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if("html"===a.type)return void b({type:"text",data:c,subtype:"html"});if("url"===a.type)return void b({type:"text",data:c,subtype:"url"});try{let a=JSON.parse(c);if("excalidraw/clipboard"===a.type)return void b({type:"excalidraw",data:a});return void b({type:"text",data:c,subtype:"json"})}catch{b({type:"text",data:c,subtype:"text"});return}}b({type:"error",data:c,reason:"unhandled case"})})})));for(let b of e)if("tldraw"===b.type){a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"tldraw",content:b.data,point:c});return}for(let b of e)if("excalidraw"===b.type){a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"excalidraw",content:b.data,point:c});return}for(let b of e){if("text"===b.type&&"html"===b.subtype){let d=new DOMParser().parseFromString(b.data,"text/html").querySelector("body");if(d&&1===Array.from(d.children).filter(a=>1===a.nodeType).length&&d.firstElementChild&&"A"===d.firstElementChild.tagName&&d.firstElementChild.hasAttribute("href")&&""!==d.firstElementChild.getAttribute("href"))return void Im(a,d.firstElementChild.getAttribute("href"),c,e);if(!e.some(a=>"text"===a.type&&"html"!==a.subtype)&&b.data.trim()&&Ij(b.data))return void Im(a,Ij(b.data),c,e);if(e.some(a=>"text"===a.type&&"html"!==a.subtype)){let d=Ij(b.data)??"";if(d){a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"text",text:d,html:b.data,point:c,sources:e});return}}}if("text"===b.type&&"text"===b.subtype&&b.data.startsWith("<iframe ")){let d=new DOMParser().parseFromString(b.data,"text/html").querySelector("body");if(d&&1===Array.from(d.children).filter(a=>1===a.nodeType).length&&d.firstElementChild&&"IFRAME"===d.firstElementChild.tagName&&d.firstElementChild.hasAttribute("src")&&""!==d.firstElementChild.getAttribute("src"))return void Im(a,d.firstElementChild.getAttribute("src"),c,e)}}for(let b of e)if("text"===b.type&&"url"===b.subtype)return void Ih(a,b.data,c,e);for(let b of e)if("text"===b.type&&"text"===b.subtype&&b.data.trim())return void Im(a,b.data,c,e)}let Iq=async a=>{let b=a.getContainer().ownerDocument?.defaultView?.navigator??globalThis.navigator,c=await a.resolveAssetsInContent(a.getContentFromCurrentPage(a.getSelectedShapeIds()));if(!c){b&&b.clipboard&&b.clipboard.writeText("");return}let{assets:d,...e}=c,f=JSON.stringify({type:"application/tldraw",kind:"content",version:3,data:{assets:d||[],otherCompressed:Ic.default.compressToBase64(JSON.stringify(e))}});if(void 0!==b){let d=c.shapes.map(b=>a.getShapeUtil(b).getText(b)).filter(dW);if(b.clipboard?.write){let a=new Blob([`<div data-tldraw>${f}</div>`],{type:"text/html"}),c=d.join(" ");""===c&&(c=" "),b.clipboard.write([new ClipboardItem({"text/html":a,"text/plain":new Blob([c],{type:"text/plain"})})])}else b.clipboard.writeText&&b.clipboard.writeText(`<div data-tldraw>${f}</div>`)}},Ir={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",svg:"text/plain"};async function Is(a){await navigator.clipboard?.writeText?.(await a())}async function It(a,b,c){var d;let e,f,g=c.name;if(!g&&(g=`shapes at ${Iu()}`,1===b.length)){let c=a.getShape(b[0]);g=a.isShapeOfType(c,"frame")?c.props.name||"frame":`${kl(c.id)} at ${Iu()}`}g+=`.${c.format}`;let{blob:h}=await a.toImage(b,c);d=new File([h],g,{type:h.type}),e=document.createElement("a"),e.href=f=URL.createObjectURL(d),e.download=d.name,e.click(),URL.revokeObjectURL(f)}function Iu(){let a=new Date,b=String(a.getFullYear()).slice(2),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0"),e=String(a.getHours()).padStart(2,"0"),f=String(a.getMinutes()).padStart(2,"0"),g=String(a.getSeconds()).padStart(2,"0");return`${b}-${c}-${d} ${e}.${f}.${g}`}let Iv=(0,eQ.createContext)([]);function Iw(){let a,b,c,d,e,f,g,h,i=kq(),{addToast:j,removeToast:k,clearToasts:l}=Ia(),{addDialog:m,clearDialogs:n,removeDialog:o}=HC(),p=zQ(),q=(a=kq(),b=(0,eQ.useRef)(null),c=(0,eQ.useRef)(null),(0,eQ.useCallback)(async function(){cg(a,"usePrint: editor is required");let d=document.createElement("div"),e=document.createElement("style"),f=(a,b)=>{a&&(a.innerHTML=""),b&&document.head.contains(b)&&document.head.removeChild(b),a&&document.body.contains(a)&&document.body.removeChild(a)};f(b.current,c.current),b.current=d,c.current=e;let g=`tl-print-surface-${cA(void 0)}`;d.className=g,e.innerHTML=`
			.${g} {
				display: none;
			}

			.${g} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${g} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${g}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${g}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${g}__item__header {
					display: none;
				}

				.${g}__item__footer {
					display: none;
					text-align: right;
				}

				.${g}__item__footer__hide {
					display: none;
				}

				
			}

		`;let h=()=>{document.head.appendChild(e),document.body.appendChild(d)},i=()=>{a.once("tick",()=>{f(d,e)})};function j(a,b,c){try{d.innerHTML+=`<div class="${g}__item">
        <div class="${g}__item__header">
          ${a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${g}__item__main">
          ${c}
        </div>
        <div class="${g}__item__footer ${g}__item__footer__${b?"":"hide"}">
          ${b??""}
        </div>
      </div>`}catch(a){console.error(a)}}function k(){window.print()}window.addEventListener("beforeprint",h),window.addEventListener("afterprint",i);let l=a.getSelectedShapeIds(),m=a.getCurrentPageId(),n=a.getPages(),o={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(a.getSelectedShapeIds().length>0){let b=await a.getSvgString(l,o);if(b){let a=n.find(a=>a.id===m);j(`tldraw \u2014 ${a?.name}`,null,b.svg),k()}}else{let b=a.getCurrentPage(),c=await a.getSvgString(a.getSortedChildIdsForParent(b.id),o);c&&(j(`tldraw \u2014 ${b.name}`,null,c.svg),k())}window.removeEventListener("beforeprint",h),window.removeEventListener("afterprint",i)},[a])),{cut:r,copy:s,paste:t}=(d=kq(),e=F0(),f=(0,eQ.useCallback)(async function(a){cg(d,"editor is required for copy"),0!==d.getSelectedShapeIds().length&&(await Iq(d),e("copy",{source:a}))},[d,e]),g=(0,eQ.useCallback)(async function(a){d&&0!==d.getSelectedShapeIds().length&&(await Iq(d),d.deleteShapes(d.getSelectedShapeIds()),e("cut",{source:a}))},[d,e]),{copy:f,cut:g,paste:h=(0,eQ.useCallback)(async function(a,b,c){d&&null===d.getEditingShapeId()&&(Array.isArray(a)&&a[0]instanceof ClipboardItem?(Io({editor:d,clipboardItems:a,point:c}),e("paste",{source:"menu"})):navigator.clipboard.read().then(a=>{h(a,b,c)}))},[d,e])}),u=function(){let a=kq(),{addToast:b}=Ia(),c=zQ();return(0,eQ.useCallback)((d,e="svg")=>{cg(a,"useCopyAs: editor is required"),(function(a,b,c){if(!navigator.clipboard)return Promise.reject(Error("Copy not supported"));if(navigator.clipboard.write){let{blobPromise:d,mimeType:e}=function(a,b,c={}){let d=b?.length?b:[...a.getCurrentPageShapeIds()],e=c.format??"png";return{blobPromise:a.toImage(d,c).then(a=>ct.rewriteMimeType(a.blob,Ir[e])),mimeType:Ir[e]}}(a,b,c),f={[e]:d},g=cV(Ie,c.format)??null;g&&"undefined"!=typeof ClipboardItem&&"supports"in ClipboardItem&&ClipboardItem.supports(g)&&(f[g]=d.then(a=>ct.rewriteMimeType(a,g)));let h=Object.entries(f);for(let[a,b]of h)b.catch(a=>console.error(a));return navigator.clipboard.write([new ClipboardItem(f)]).catch(a=>(console.error(a),Promise.all(h.map(async([a,b])=>[a,await b])).then(a=>{let b=c$(a);return navigator.clipboard.write([new ClipboardItem(b)])})))}switch(c.format){case"svg":return Is(async()=>{let d=await a.getSvgString(b,c);if(!d)throw Error("Failed to copy");return d.svg});case"png":throw Error("Copy not supported");default:cf(c.format)}})(a,d,{format:e}).catch(()=>{b({id:"copy-fail",severity:"warning",title:c("toast.error.copy-fail.title"),description:c("toast.error.copy-fail.desc")})})},[a,b,c])}(),v=function(){let a=kq(),{addToast:b}=Ia(),c=zQ();return(0,eQ.useCallback)((d,e={})=>{cg(a,"useExportAs: editor is required");let{format:f="png",name:g,scale:h=1}=e;It(a,d,{format:f,name:g,scale:h}).catch(a=>{console.error(a.message),b({id:"export-fail",title:c("toast.error.export-fail.title"),description:c("toast.error.export-fail.desc"),severity:"error"})})},[a,b,c])}(),w=B8(),y=Ce()<Cb.TABLET_SM,z=kK((0,eQ.useContext)(Iv),kL),A=(0,eQ.useCallback)(async()=>{if(!i)return;let a=await Ib({allowMultiple:!0,mimeTypes:z});a.length&&(i.markHistoryStoppingPoint("insert media"),i.putExternalContent({type:"files",files:a,point:i.getViewportPageBounds().center}))},[i,z]),B=(0,eQ.useCallback)(async a=>{if(!i)return;let b=await Ib({allowMultiple:!1,mimeTypes:z?.filter(b=>a?b.startsWith("image/"):b.startsWith("video/"))});if(!b.length)return;let c=i.getOnlySelectedShape();if(!c||a&&"image"!==c.type||!a&&"video"!==c.type)return;i.markHistoryStoppingPoint("replace media");let d=b[0];i.replaceExternalContent({type:"file-replace",file:d,shapeId:c.id,isImage:a})},[i,z]),C=(0,eQ.useCallback)(()=>B(!0),[B]),D=(0,eQ.useCallback)(()=>B(!1),[B]);return(0,eQ.useMemo)(()=>({addToast:j,removeToast:k,clearToasts:l,addDialog:m,removeDialog:o,clearDialogs:n,msg:p,isMobile:y,insertMedia:A,replaceImage:C,replaceVideo:D,printSelectionOrPages:q,cut:r,copy:s,paste:t,copyAs:u,exportAs:v,getEmbedDefinition:w}),[j,k,l,m,o,n,p,y,A,C,D,q,r,s,t,u,v,w])}function Ix(a){return(0,eQ.useMemo)(()=>a,a)}function Iy(a){let b=Ix(null==a?[]:Array.isArray(a)?a:[a]);return(0,eQ.useMemo)(()=>{let a={};for(let c of b)if(c.translations)for(let[b,d]of cY(c.translations)){let c=a[b];c||(c=a[b]={}),Object.assign(c,d)}return a},[b])}let Iz=eQ.createContext(null);function IA({overrides:a,children:b}){let c=kq(),d=F0(),e=zG(),f=zQ(),g=Iw(),h=eQ.useCallback((a,b,c)=>{e.announce({msg:f(b.label)}),d("select-tool",{source:a,id:c??b.id})},[e,f,d]),i=eQ.useMemo(()=>{if(!c)return{};let b=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(a){if(c.isIn("select")){let a=c.root.getCurrent();a.exit({},a.id),a.enter({},a.id)}c.setCurrentTool("select"),h(a,this)}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(a){c.setCurrentTool("hand"),h(a,this)}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(a){c.setCurrentTool("eraser"),h(a,this)}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(a){c.setCurrentTool("draw"),h(a,this)}},...[...iQ.values].map(a=>({id:a,label:`tool.${a}`,meta:{geo:a},kbd:"rectangle"===a?"r":"ellipse"===a?"o":void 0,icon:"geo-"+a,onSelect(b){c.run(()=>{c.setStyleForNextShapes(iQ,a),c.setCurrentTool("geo"),h(b,this,`geo-${a}`)})},onDragStart(b,e){IC(c,e,{createShape:b=>c.createShape({id:b,type:"geo",props:{w:200,h:200,geo:a}})}),d("drag-tool",{source:b,id:"geo"})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(a){c.setCurrentTool("arrow"),h(a,this)},onDragStart(a,b){IC(c,b,{createShape:a=>c.createShape({id:a,type:"arrow",props:{start:{x:0,y:200},end:{x:200,y:0}}})}),d("drag-tool",{source:a,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(a){c.setCurrentTool("line"),h(a,this)},onDragStart(a,b){IC(c,b,{createShape:a=>{let[b,d]=ds(null,null,2);c.createShape({id:a,type:"line",props:{points:{[b]:{id:b,index:b,x:0,y:200},[d]:{id:d,index:d,x:200,y:0}}}})}}),d("drag-tool",{source:a,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(a){c.setCurrentTool("frame"),h(a,this)},onDragStart(a,b){IC(c,b,{createShape:a=>c.createShape({id:a,type:"frame"})}),d("drag-tool",{source:a,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(a){c.setCurrentTool("text"),h(a,this)},onDragStart(a,b){IC(c,b,{createShape:a=>c.createShape({id:a,type:"text",props:{richText:g6("Text")}}),onDragEnd:a=>{c.setEditingShape(a),c.emit("select-all-text",{shapeId:a})}}),d("drag-tool",{source:a,id:"text"})}},{id:"asset",label:"tool.media",icon:"tool-media",kbd:"cmd+u,ctrl+u",onSelect(a){g.insertMedia(),h(a,this,"media")}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(a){c.setCurrentTool("note"),h(a,this)},onDragStart(a,b){IC(c,b,{createShape:a=>c.createShape({id:a,type:"note"}),onDragEnd:a=>{c.setEditingShape(a),c.emit("select-all-text",{shapeId:a})}}),d("drag-tool",{source:a,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(a){c.setCurrentTool("laser"),h(a,this)}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(a){g.addDialog({component:B9}),h(a,this)}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"shift+d",onSelect(a){c.setCurrentTool("highlight"),h(a,this)}}];b.forEach(a=>a.onSelect=a.onSelect.bind(a));let e=Object.fromEntries(b.map(a=>[a.id,a]));return a?a(c,e,g):e},[a,c,g,h,d]);return(0,bT.jsx)(Iz.Provider,{value:i,children:b})}function IB(){let a=eQ.useContext(Iz);if(!a)throw Error("useTools must be used within a ToolProvider");return a}function IC(a,b,c){let{x:d,y:e}=a.inputs.currentPagePoint,f=a.markHistoryStoppingPoint("drag shape tool");a.setCurrentTool("select.translating");let g=hd();c.createShape(g);let h=ch(a.getShape(g),"Shape not found"),{w:i,h:j}=a.getShapePageBounds(g);a.updateShape({id:g,type:h.type,x:d-i/2,y:e-j/2}),a.select(g),a.setCurrentTool("select.translating",{...b,target:"shape",shape:a.getShape(g),isCreating:!0,creatingMarkId:f,onCreate(){a.setCurrentTool("select.idle"),a.select(g),c.onDragEnd?.(g)}}),a.getCurrentTool().setCurrentToolIdMask(h.type)}function ID({toolId:a="",...b}){let c=IB()[a];return c?(0,bT.jsx)(Hw,{...c,...b}):null}function IE(){let a=Ci();return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(Hz,{label:"shortcuts-dialog.tools",id:"tools",children:[(0,bT.jsx)(Hy,{actionId:"toggle-tool-lock"}),(0,bT.jsx)(Hy,{actionId:"insert-media"}),(0,bT.jsx)(ID,{toolId:"select"}),(0,bT.jsx)(ID,{toolId:"draw"}),(0,bT.jsx)(ID,{toolId:"eraser"}),(0,bT.jsx)(ID,{toolId:"hand"}),(0,bT.jsx)(ID,{toolId:"rectangle"}),(0,bT.jsx)(ID,{toolId:"ellipse"}),(0,bT.jsx)(ID,{toolId:"arrow"}),(0,bT.jsx)(ID,{toolId:"line"}),(0,bT.jsx)(ID,{toolId:"text"}),(0,bT.jsx)(ID,{toolId:"frame"}),(0,bT.jsx)(ID,{toolId:"note"}),(0,bT.jsx)(ID,{toolId:"laser"}),(0,bT.jsx)(Hw,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),(0,bT.jsxs)(Hz,{label:"shortcuts-dialog.preferences",id:"preferences",children:[(0,bT.jsx)(Hy,{actionId:"toggle-dark-mode"}),(0,bT.jsx)(Hy,{actionId:"toggle-focus-mode"}),(0,bT.jsx)(Hy,{actionId:"toggle-grid"})]}),(0,bT.jsxs)(Hz,{label:"shortcuts-dialog.edit",id:"edit",children:[(0,bT.jsx)(Hy,{actionId:"undo"}),(0,bT.jsx)(Hy,{actionId:"redo"}),(0,bT.jsx)(Hy,{actionId:"cut"}),(0,bT.jsx)(Hy,{actionId:"copy"}),(0,bT.jsx)(Hy,{actionId:"paste"}),(0,bT.jsx)(Hy,{actionId:"select-all"}),(0,bT.jsx)(Hy,{actionId:"delete"}),(0,bT.jsx)(Hy,{actionId:"duplicate"})]}),(0,bT.jsxs)(Hz,{label:"shortcuts-dialog.view",id:"view",children:[(0,bT.jsx)(Hy,{actionId:"zoom-in"}),(0,bT.jsx)(Hy,{actionId:"zoom-out"}),(0,bT.jsx)(Hy,{actionId:"zoom-to-100"}),(0,bT.jsx)(Hy,{actionId:"zoom-to-fit"}),(0,bT.jsx)(Hy,{actionId:"zoom-to-selection"})]}),(0,bT.jsxs)(Hz,{label:"shortcuts-dialog.transform",id:"transform",children:[(0,bT.jsx)(Hy,{actionId:"bring-to-front"}),(0,bT.jsx)(Hy,{actionId:"bring-forward"}),(0,bT.jsx)(Hy,{actionId:"send-backward"}),(0,bT.jsx)(Hy,{actionId:"send-to-back"}),(0,bT.jsx)(Hy,{actionId:"group"}),(0,bT.jsx)(Hy,{actionId:"ungroup"}),(0,bT.jsx)(Hy,{actionId:"flip-horizontal"}),(0,bT.jsx)(Hy,{actionId:"flip-vertical"}),(0,bT.jsx)(Hy,{actionId:"align-top"}),(0,bT.jsx)(Hy,{actionId:"align-center-vertical"}),(0,bT.jsx)(Hy,{actionId:"align-bottom"}),(0,bT.jsx)(Hy,{actionId:"align-left"}),(0,bT.jsx)(Hy,{actionId:"align-center-horizontal"}),(0,bT.jsx)(Hy,{actionId:"align-right"})]}),(0,bT.jsxs)(Hz,{label:"shortcuts-dialog.text-formatting",id:"text",children:[(0,bT.jsx)(Hw,{id:"text-bold",label:"tool.rich-text-bold",kbd:"cmd+b",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"text-italic",label:"tool.rich-text-italic",kbd:"cmd+i",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"text-code",label:"tool.rich-text-code",kbd:"cmd+e",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"text-highlight",label:"tool.rich-text-highlight",kbd:"cmd+shift+h",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"text-strikethrough",label:"tool.rich-text-strikethrough",kbd:"cmd+shift+s",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"text-link",label:"tool.rich-text-link",kbd:"cmd+shift+k",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"text-header",label:"tool.rich-text-header",kbd:"cmd+alt+[[1-6]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"text-orderedList",label:"tool.rich-text-orderedList",kbd:"cmd+shift+7",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"text-bulletedlist",label:"tool.rich-text-bulletList",kbd:"cmd+shift+8",onSelect:()=>{}})]}),(0,bT.jsxs)(Hz,{label:"shortcuts-dialog.a11y",id:"a11y",children:[(0,bT.jsx)(Hw,{id:"a11y-select-next-shape",label:"a11y.select-shape",kbd:"[[Tab]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-select-next-shape-direction",label:"a11y.select-shape-direction",kbd:"cmd+[[↑→↓←]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-select-next-shape-container",label:"a11y.enter-leave-container",kbd:"cmd+shift+[[↑↓]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-pan-camera",label:"a11y.pan-camera",kbd:"[[Space]]+[[↑→↓←]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+[[Enter]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"open-context-menu",label:"a11y.open-context-menu",kbd:"cmd+shift+[[Enter]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-move-shape",label:"a11y.move-shape",kbd:"[[↑→↓←]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-move-shape-faster",label:"a11y.move-shape-faster",kbd:"shift+[[↑→↓←]]",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-rotate-shape-cw",label:"a11y.rotate-shape-cw",kbd:"shift+﹥",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-rotate-shape-cw-fine",label:"a11y.rotate-shape-cw-fine",kbd:"shift+alt+﹥",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-rotate-shape-ccw",label:"a11y.rotate-shape-ccw",kbd:"shift+﹤",onSelect:()=>{}}),(0,bT.jsx)(Hw,{id:"a11y-rotate-shape-ccw-fine",label:"a11y.rotate-shape-ccw-fine",kbd:"shift+alt+﹤",onSelect:()=>{}}),(0,bT.jsx)(Hy,{actionId:"enlarge-shapes"}),(0,bT.jsx)(Hy,{actionId:"shrink-shapes"}),(0,bT.jsx)(Hy,{actionId:"a11y-repeat-shape-announce"}),(0,bT.jsx)(Hw,{id:"a11y-open-keyboard-shortcuts",label:"a11y.open-keyboard-shortcuts",kbd:"cmd+alt+/",onSelect:()=>{}})]}),a&&(0,bT.jsx)(Hz,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:(0,bT.jsx)(Hy,{actionId:"open-cursor-chat"})})]})}let IF=(0,eQ.memo)(function({children:a}){let b=zQ(),c=Ce(),d=a??(0,bT.jsx)(IE,{});return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(BW,{className:"tlui-shortcuts-dialog__header",children:[(0,bT.jsx)(BX,{children:b("shortcuts-dialog.title")}),(0,bT.jsx)(BY,{})]}),(0,bT.jsx)(BZ,{className:(0,j1.default)("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":c<=Cb.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":c<=Cb.TABLET}),children:(0,bT.jsx)(Ch,{type:"keyboard-shortcuts",sourceId:"kbd",children:d})}),(0,bT.jsx)("div",{className:"tlui-dialog__scrim"})]})});async function IG(a,b,c){let d=b5(b.map(b=>{let c=a.getShape(b);if(c&&void 0!==a.getShapeUtil(c.type).toSvg)return c}));if(0===d.length)return;if(1===d.length){let b=d[0];if(!b||a.isShapeOfType(b,"image"))return}let e=[];if(void 0!==c){let b=d.map(b=>({shape:b,bounds:a.getShapeMaskedPageBounds(b).clone().expandBy(c)}));for(let a=0;a<b.length;a++){let c=b[a];if(0===a){e[0]={shapes:[c.shape],bounds:c.bounds};continue}let d=!1;for(let a of e)if(a.bounds.includes(c.bounds)){a.shapes.push(c.shape),a.bounds.expand(c.bounds),d=!0;break}d||e.push({shapes:[c.shape],bounds:c.bounds})}}else{let b=lh.Common(d.map(b=>a.getShapeMaskedPageBounds(b)));e.push({shapes:d,bounds:b})}let f=a.options.flattenImageBoundsPadding;for(let b of e){void 0!==c&&b.bounds.expandBy(-c);let d=await a.getSvgString(b.shapes,{padding:f,background:!1});if(!d?.svg)continue;let e=await a.getAssetForExternalContent({type:"file",file:new File([d.svg],"asset.svg",{type:"image/svg+xml"})});e&&(b.asset=e)}let g=[];return ep(()=>{for(let b of e){let c,d,e,{asset:h,bounds:i,shapes:j}=b;if(!h)continue;let k=a.findCommonAncestor(j)??a.getCurrentPageId();if(!k)continue;let l="a1";for(let a of j)if(a.parentId===k){a.index>l&&(l=a.index);break}if(hc(k)){let b=a.getShape(k);if(!b)continue;let g=a.getPointInShapeSpace(b,{x:i.x,y:i.y});e=a.getShapePageTransform(k).rotation(),g.sub(new jA(f,f).rot(-e)),c=g.x,d=g.y}else c=i.x-f,d=i.y-f,e=0;a.deleteShapes(j),a.createAssets([{...h,id:h.id}]);let m=hd();a.createShape({id:m,type:"image",index:l,parentId:k,x:c,y:d,rotation:-e,props:{assetId:h.id,w:i.w+2*f,h:i.h+2*f}}),g.push(m)}}),g}var IH="Popover",[II,IJ]=z8(IH,[DA]),IK=DA(),[IL,IM]=II(IH),IN=a=>{let{__scopePopover:b,children:c,open:d,defaultOpen:e,onOpenChange:f,modal:g=!1}=a,h=IK(b),i=eQ.useRef(null),[j,k]=eQ.useState(!1),[l,m]=Ae({prop:d,defaultProp:e??!1,onChange:f,caller:IH});return(0,bT.jsx)(DD,{...h,children:(0,bT.jsx)(IL,{scope:b,contentId:Ac(),triggerRef:i,open:l,onOpenChange:m,onOpenToggle:eQ.useCallback(()=>m(a=>!a),[m]),hasCustomAnchor:j,onCustomAnchorAdd:eQ.useCallback(()=>k(!0),[]),onCustomAnchorRemove:eQ.useCallback(()=>k(!1),[]),modal:g,children:c})})};IN.displayName=IH;var IO="PopoverAnchor",IP=eQ.forwardRef((a,b)=>{let{__scopePopover:c,...d}=a,e=IM(IO,c),f=IK(c),{onCustomAnchorAdd:g,onCustomAnchorRemove:h}=e;return eQ.useEffect(()=>(g(),()=>h()),[g,h]),(0,bT.jsx)(DF,{...f,...d,ref:b})});IP.displayName=IO;var IQ="PopoverTrigger",IR=eQ.forwardRef((a,b)=>{let{__scopePopover:c,...d}=a,e=IM(IQ,c),f=IK(c),g=z7(b,e.triggerRef),h=(0,bT.jsx)(Al.button,{type:"button","aria-haspopup":"dialog","aria-expanded":e.open,"aria-controls":e.contentId,"data-state":I3(e.open),...d,ref:g,onClick:z4(a.onClick,e.onOpenToggle)});return e.hasCustomAnchor?h:(0,bT.jsx)(DF,{asChild:!0,...f,children:h})});IR.displayName=IQ;var IS="PopoverPortal",[IT,IU]=II(IS,{forceMount:void 0}),IV=a=>{let{__scopePopover:b,forceMount:c,children:d,container:e}=a,f=IM(IS,b);return(0,bT.jsx)(IT,{scope:b,forceMount:c,children:(0,bT.jsx)(AE,{present:c||f.open,children:(0,bT.jsx)(AD,{asChild:!0,container:e,children:d})})})};IV.displayName=IS;var IW="PopoverContent",IX=eQ.forwardRef((a,b)=>{let c=IU(IW,a.__scopePopover),{forceMount:d=c.forceMount,...e}=a,f=IM(IW,a.__scopePopover);return(0,bT.jsx)(AE,{present:d||f.open,children:f.modal?(0,bT.jsx)(IZ,{...e,ref:b}):(0,bT.jsx)(I$,{...e,ref:b})})});IX.displayName=IW;var IY=Af("PopoverContent.RemoveScroll"),IZ=eQ.forwardRef((a,b)=>{let c=IM(IW,a.__scopePopover),d=eQ.useRef(null),e=z7(b,d),f=eQ.useRef(!1);return eQ.useEffect(()=>{let a=d.current;if(a)return Bk(a)},[]),(0,bT.jsx)(Bd,{as:IY,allowPinchZoom:!0,children:(0,bT.jsx)(I_,{...a,ref:e,trapFocus:c.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:z4(a.onCloseAutoFocus,a=>{a.preventDefault(),f.current||c.triggerRef.current?.focus()}),onPointerDownOutside:z4(a.onPointerDownOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey;f.current=2===b.button||c},{checkForDefaultPrevented:!1}),onFocusOutside:z4(a.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),I$=eQ.forwardRef((a,b)=>{let c=IM(IW,a.__scopePopover),d=eQ.useRef(!1),e=eQ.useRef(!1);return(0,bT.jsx)(I_,{...a,ref:b,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),b.defaultPrevented||(d.current||c.triggerRef.current?.focus(),b.preventDefault()),d.current=!1,e.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||(d.current=!0,"pointerdown"===b.detail.originalEvent.type&&(e.current=!0));let f=b.target;c.triggerRef.current?.contains(f)&&b.preventDefault(),"focusin"===b.detail.originalEvent.type&&e.current&&b.preventDefault()}})}),I_=eQ.forwardRef((a,b)=>{let{__scopePopover:c,trapFocus:d,onOpenAutoFocus:e,onCloseAutoFocus:f,disableOutsidePointerEvents:g,onEscapeKeyDown:h,onPointerDownOutside:i,onFocusOutside:j,onInteractOutside:k,...l}=a,m=IM(IW,c),n=IK(c);return AH(),(0,bT.jsx)(Ax,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:e,onUnmountAutoFocus:f,children:(0,bT.jsx)(Aq,{asChild:!0,disableOutsidePointerEvents:g,onInteractOutside:k,onEscapeKeyDown:h,onPointerDownOutside:i,onFocusOutside:j,onDismiss:()=>m.onOpenChange(!1),children:(0,bT.jsx)(DJ,{"data-state":I3(m.open),role:"dialog",id:m.contentId,...n,...l,ref:b,style:{...l.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),I0="PopoverClose",I1=eQ.forwardRef((a,b)=>{let{__scopePopover:c,...d}=a,e=IM(I0,c);return(0,bT.jsx)(Al.button,{type:"button",...d,ref:b,onClick:z4(a.onClick,()=>e.onOpenChange(!1))})});I1.displayName=I0;var I2=eQ.forwardRef((a,b)=>{let{__scopePopover:c,...d}=a,e=IK(c);return(0,bT.jsx)(DM,{...e,...d,ref:b})});function I3(a){return a?"open":"closed"}I2.displayName="PopoverArrow",a.s(["Anchor",()=>IP,"Arrow",()=>I2,"Close",()=>I1,"Content",()=>IX,"Popover",()=>IN,"PopoverAnchor",()=>IP,"PopoverArrow",()=>I2,"PopoverClose",()=>I1,"PopoverContent",()=>IX,"PopoverPortal",()=>IV,"PopoverTrigger",()=>IR,"Portal",()=>IV,"Root",()=>IN,"Trigger",()=>IR,"createPopoverScope",()=>IJ],39857);var I4=a.i(39857),I4=I4;function I5({id:a,children:b,onOpenChange:c,open:d,className:e}){let[f,g]=F1(a,c);return(0,bT.jsx)(I4.Root,{onOpenChange:g,open:d||f,children:(0,bT.jsx)("div",{className:(0,j1.default)("tlui-popover",e),children:b})})}function I6({children:a}){return(0,bT.jsx)(I4.Trigger,{asChild:!0,dir:"ltr",children:a})}function I7({side:a,children:b,align:c="center",sideOffset:d=8,alignOffset:e=0,disableEscapeKeyDown:f=!1,autoFocusFirstButton:g=!0}){let h=kv(),i=eQ.default.useRef(null),j=eQ.default.useCallback(()=>{if(!g)return;let a=[...i.current?.querySelectorAll("button:not([disabled])")??[]].filter(a=>a.offsetWidth||a.offsetHeight)[0];a&&a.focus()},[g]);return(0,bT.jsx)(I4.Portal,{container:h,children:(0,bT.jsx)(I4.Content,{className:"tlui-popover__content",side:a,sideOffset:d,align:c,alignOffset:e,dir:"ltr",ref:i,onOpenAutoFocus:j,onEscapeKeyDown:a=>f&&a.preventDefault(),children:b})})}function I8(a,b,c){let{arrowheadStart:d,arrowheadEnd:e}=b.props,f=JR(a,b,c),g=f.start.clone(),h=f.end.clone(),i=jA.Med(g,h);if(jA.Equals(g,h))return{bindings:c,type:"straight",start:{handle:g,point:g,arrowhead:b.props.arrowheadStart},end:{handle:h,point:h,arrowhead:b.props.arrowheadEnd},middle:i,isValid:!1,length:0};let j=jA.Sub(h,g).uni(),k=JL(a,b,"start"),l=JL(a,b,"end"),m=a.getShapePageTransform(b);I9(h,f.start,m,l),I9(g,f.end,m,k);let n=0,o=0,p=0,q=0,r=JU*b.props.scale,s=k&&l&&k.shape===l.shape,t=k&&l?JY(a,k.shape.id,l.shape.id):"safe";"safe"===t&&k&&l&&!s&&!k.isExact&&!l.isExact&&(l.didIntersect&&!k.didIntersect?k.isClosed&&g.setTo(h.clone().add(j.clone().mul(JU*b.props.scale))):!l.didIntersect&&l.isClosed&&h.setTo(g.clone().sub(j.clone().mul(JU*b.props.scale))));let u=jA.Sub(h,g),v=jA.Len(u)?u.uni():jA.From(u),w=!jA.Equals(v,j);s||("start-contains-end"!==t&&k&&"none"!==d&&!k.isExact&&(n=(JV+(p=JX[b.props.size]/2+("size"in k.shape.props?JX[k.shape.props.size]/2:0)))*b.props.scale,r+=p*b.props.scale),"end-contains-start"!==t&&l&&"none"!==e&&!l.isExact&&(o=(JV+(q=JX[b.props.size]/2+("size"in l.shape.props?JX[l.shape.props.size]/2:0)))*b.props.scale,r+=q*b.props.scale));let y=g.clone().add(v.clone().mul(n*(w?-1:1))),z=h.clone().sub(v.clone().mul(o*(w?-1:1)));jA.DistMin(y,z,r)&&(0!==n&&0!==o?(n*=-1.5,o*=-1.5):0!==n?n*=-1:0!==o&&(o*=-1)),g.add(v.clone().mul(n*(w?-1:1))),h.sub(v.clone().mul(o*(w?-1:1))),w?(k&&l&&h.setTo(jA.Add(g,v.clone().mul(-JU*b.props.scale))),i.setTo(jA.Med(f.start,f.end))):i.setTo(jA.Med(g,h));let A=jA.Dist(g,h);return{bindings:c,type:"straight",start:{handle:f.start,point:g,arrowhead:b.props.arrowheadStart},end:{handle:f.end,point:h,arrowhead:b.props.arrowheadEnd},middle:i,isValid:A>0,length:A}}function I9(a,b,c,d){let e;if(void 0===d||d.isExact)return;let f=li.applyToPoint(c,b),g=li.applyToPoint(c,a),h=li.applyToPoint(li.Inverse(d.transform),f),i=li.applyToPoint(li.Inverse(d.transform),g),j=Array.from(d.geometry.intersectLineSegment(h,i,{includeLabels:!1,includeInternal:!1}));if(j.length&&(e=j.sort((a,b)=>jA.Dist2(a,h)-jA.Dist2(b,h))[0]??(d.isClosed?void 0:i)),void 0===e&&(e=d.geometry.nearestPoint(i,{includeLabels:!1,includeInternal:!1}),!jA.DistMin(e,i,1)))return;let k=li.applyToPoint(d.transform,e),l=li.applyToPoint(li.Inverse(c),k);a.setTo(l),d.didIntersect=!0}function Ja(a,b,c){let d=j_(a,b,c)??jA.Med(a,b),e=jA.Dist(d,a),f=+jA.Clockwise(a,c,b),g=((a.y-b.y)**2+(a.x-b.x)**2)**.5,h=((b.y-c.y)**2+(b.x-c.x)**2)**.5,i=((c.y-a.y)**2+(c.x-a.x)**2)**.5,j=2*Math.acos((h*h+i*i-g*g)/(2*h*i)),k=+(jE>j),l=(jG-j)*(f?1:-1);return{center:d,radius:e,size:l,length:l*e,largeArcFlag:k,sweepFlag:f}}let Jb=["right","bottom","left","top"],Jc={top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},Jd={left:"x",right:"x",top:"y",bottom:"y"},Je={top:"bottom",right:"left",bottom:"top",left:"right"},Jf={x:{v:(a,b)=>new jA(a,b),loEdge:"left",hiEdge:"right",crossMid:"midY",gap:"gapX",midRange:"midXRange",self:"x",cross:"y",size:"width"},y:{v:(a,b)=>new jA(b,a),loEdge:"top",hiEdge:"bottom",crossMid:"midX",gap:"gapY",midRange:"midYRange",self:"y",cross:"x",size:"height"}};function Jg(a,b){return{min:Math.min(a,b),max:Math.max(a,b)}}function Jh(a,b){return a>=b.min&&a<=b.max}function Ji(a){if(!a)return;let b=a.cross.min;a.cross.min=-a.cross.max,a.cross.max=-b,a.crossTarget=-a.crossTarget}function Jj(a){a&&(a.value=-a.value,a.expanded=null===a.expanded?null:-a.expanded)}let Jk={x:1,y:1,transpose:!1},Jl={x:-1,y:1,transpose:!0},Jm={x:-1,y:-1,transpose:!1},Jn={x:1,y:-1,transpose:!0},Jo={x:1,y:-1,transpose:!1};function Jp(a,b,c){let d=a[b];a[b]=a[c],a[c]=d}function Jq(a,b){b.x=a.x*b.x,b.y=a.y*b.y,a.transpose&&Jp(b,"x","y")}function Jr(a,b){-1===a.x&&(b.x=-(b.x+b.width)),-1===a.y&&(b.y=-(b.y+b.height)),a.transpose&&(Jp(b,"x","y"),Jp(b,"width","height"))}function Js(a,b){-1===a.x&&(Jp(b,"left","right"),Ji(b.top),Ji(b.bottom),Jj(b.left),Jj(b.right)),-1===a.y&&(Jp(b,"top","bottom"),Ji(b.left),Ji(b.right),Jj(b.top),Jj(b.bottom)),a.transpose&&(Jp(b,"left","top"),Jp(b,"right","bottom"))}class Jt{options;A;B;common;gapX;gapY;midX;midY;bias;constructor(a){this.options=a.options,this.A=a.A,this.B=a.B,this.common=a.common,this.midX=a.midX,this.midY=a.midY,this.gapX=a.gapX,this.gapY=a.gapY,this.bias=new jA(1,1)}transform=Jk;inverse=Jk;apply(a){var b,c;let d;if(this.transform=(b=this.transform,d={...a},b.transpose&&(Jp(d,"x","y"),d.transpose=!d.transpose),-1===b.x&&(d.x=-d.x),-1===b.y&&(d.y=-d.y),d),this.inverse=(c=this.transform).transpose?{x:c.y,y:c.x,transpose:!0}:c,Jr(a,this.A.original),Jr(a,this.B.original),Jr(a,this.common.original),Jr(a,this.A.expanded),Jr(a,this.B.expanded),Jr(a,this.common.expanded),Js(a,this.A.edges),Js(a,this.B.edges),Jq(a,this.bias),-1===a.x&&(this.gapX=-this.gapX,this.midX=null===this.midX?null:-this.midX),-1===a.y&&(this.gapY=-this.gapY,this.midY=null===this.midY?null:-this.midY),a.transpose){let a=this.midX;this.midX=this.midY,this.midY=a,a=this.gapX,this.gapX=this.gapY,this.gapY=a}}reset(){this.apply(this.inverse)}vec(a,b){let c=new jA(a,b);return Jq(this.inverse,c),c}}class Ju{constructor(a,b){this.info=a,this.name=b}points=[];add(a,b){return this.points.push(this.info.vec(a,b)),this}_midpointHandle=null;midpointHandle(a){cg(null===this._midpointHandle,"midX/midY called multiple times");let b=jA.Lrp(this.points[this.points.length-2],this.points[this.points.length-1],.5);return this._midpointHandle={axis:this.info.transform.transpose?"x"===a?"y":"x":a,point:b,segmentStart:this.points[this.points.length-2].clone(),segmentEnd:this.points[this.points.length-1].clone()},this}build(){let a=[];for(let b=0;b<this.points.length;b++){let c=this.points[b],d=a[a.length-1],e=a[a.length-2];if(d&&e){let b=Math.abs(c.x-d.x),f=Math.abs(c.y-d.y),g=Math.abs(c.x-e.x),h=Math.abs(c.y-e.y);b<.01&&f<.01||(b<.01&&g<.01?d.y=c.y:f<.01&&h<.01?d.x=c.x:a.push(c))}else a.push(c)}return{name:this.name,points:a,distance:function(a){let b=0;for(let c=0;c<a.length-1;c++){let d=a[c],e=a[c+1];b+=Math.abs(e.x-d.x)+Math.abs(e.y-d.y)}return b}(a),aEdgePicking:"manual",bEdgePicking:"manual",skipPointsWhenDrawing:new Set,midpointHandle:this._midpointHandle}}}function Jv(a){let b=a.A.edges.right,c=a.B.edges.left;if(!b||!c)return null;if(b.crossTarget>c.crossTarget&&a.apply(Jo),a.gapX>0&&null!==a.midX)return new Ju(a,"to left 1").add(b.value,b.crossTarget).add(a.midX,b.crossTarget).add(a.midX,c.crossTarget).midpointHandle("x").add(c.value,c.crossTarget).build();if(null===b.expanded||null===c.expanded)return null;if(null!==a.midY)return new Ju(a,"to left 2").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.midY).add(c.expanded,a.midY).midpointHandle("y").add(c.expanded,c.crossTarget).add(c.value,c.crossTarget).build();let d=Math.abs(b.value-a.common.expanded.right)+Math.abs(b.crossTarget-a.common.expanded.bottom)+Math.abs(a.common.expanded.right-c.expanded)+Math.abs(a.common.expanded.bottom-c.crossTarget)+a.options.expandElbowLegLength+6,e=a.options.expandElbowLegLength+Math.abs(b.crossTarget-a.common.expanded.top)+Math.abs(b.expanded-a.common.expanded.left)+Math.abs(a.common.expanded.top-c.crossTarget)+Math.abs(a.common.expanded.left-c.value)+6+a.bias.y,f=a.gapX<0&&null!==a.midX?a.options.expandElbowLegLength+Math.abs(b.crossTarget-a.A.expanded.bottom)+a.common.expanded.width+Math.abs(a.A.expanded.bottom-a.B.expanded.top)+Math.abs(a.B.expanded.top-c.crossTarget)+a.options.expandElbowLegLength+8:1/0;return d<e&&d<f?new Ju(a,"to left 3").add(b.value,b.crossTarget).add(a.common.expanded.right,b.crossTarget).add(a.common.expanded.right,a.common.expanded.bottom).add(c.expanded,a.common.expanded.bottom).add(c.expanded,c.crossTarget).add(c.value,c.crossTarget).build():e<f?new Ju(a,"to left 4").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.common.expanded.top).add(a.common.expanded.left,a.common.expanded.top).add(a.common.expanded.left,c.crossTarget).add(c.value,c.crossTarget).build():null!==a.midX?new Ju(a,"to left 5").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.A.expanded.bottom).add(a.midX,a.A.expanded.bottom).add(a.midX,a.B.expanded.top).midpointHandle("y").add(c.expanded,a.B.expanded.top).add(c.expanded,c.crossTarget).add(c.value,c.crossTarget).build():null}function Jw(a){let b=a.A.edges.right,c=a.B.edges.top;if(!b||!c)return null;if(b.crossTarget<(c.expanded??c.value)&&c.crossTarget>(b.expanded??b.value)||a.A.isPoint&&a.B.expanded.containsPoint(a.A.original.center))return new Ju(a,"to top 1").add(b.value,b.crossTarget).add(c.crossTarget,b.crossTarget).add(c.crossTarget,c.value).build();if(a.gapX>0&&null!==a.midX&&null!==c.expanded)return new Ju(a,"to top 2").add(b.value,b.crossTarget).add(a.midX,b.crossTarget).add(a.midX,c.expanded).midpointHandle("x").add(c.crossTarget,c.expanded).add(c.crossTarget,c.value).build();if(a.gapY>0&&null!==b.expanded&&c.crossTarget<b.expanded&&null!==a.midY)return new Ju(a,"to top 3").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.midY).add(c.crossTarget,a.midY).midpointHandle("y").add(c.crossTarget,c.value).build();let d=Math.abs(b.value-a.common.expanded.right)+Math.abs(b.crossTarget-a.common.expanded.top)+Math.abs(c.crossTarget-a.common.expanded.right)+Math.abs(c.value-a.common.expanded.top),e=null!==b.expanded&&null!==a.midY&&null!==c.expanded?Math.abs(b.value-b.expanded)+Math.abs(a.B.expanded.left-b.expanded)+Math.abs(a.B.expanded.left-c.crossTarget)+Math.abs(b.crossTarget-a.B.expanded.top)+Math.abs(c.value-c.expanded):1/0,f=null!==b.expanded&&null!==a.midX&&null!==c.expanded?Math.abs(b.value-a.common.expanded.right)+Math.abs(b.crossTarget-a.A.expanded.bottom)+Math.abs(b.expanded-c.crossTarget)+Math.abs(a.A.expanded.bottom-c.expanded)+Math.abs(c.expanded-c.value):1/0;return d<e&&d<f?new Ju(a,"to top 4").add(b.value,b.crossTarget).add(a.common.expanded.right,b.crossTarget).add(a.common.expanded.right,a.common.expanded.top).add(c.crossTarget,a.common.expanded.top).add(c.crossTarget,c.value).build():null!==c.expanded&&null!==b.expanded&&null!==a.midY&&e<f?new Ju(a,"to top 5").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.midY).add(a.B.expanded.left,a.midY).midpointHandle("y").add(a.B.expanded.left,c.expanded).add(c.crossTarget,c.expanded).add(c.crossTarget,c.value).build():null!==c.expanded&&null!==b.expanded&&null!==a.midX?new Ju(a,"to top 6").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.A.expanded.bottom).add(a.midX,a.A.expanded.bottom).add(a.midX,c.expanded).midpointHandle("x").add(c.crossTarget,c.expanded).add(c.crossTarget,c.value).build():null}function Jx(a){return a.apply(Jo),Jw(a)}function Jy(a){let b=a.A.edges.right,c=a.B.edges.right;if(!b||!c)return null;if((a.gapX<=0||b.crossTarget>a.B.expanded.bottom||b.crossTarget<a.B.expanded.top)&&(c.value>a.A.original.left||c.crossTarget>a.A.expanded.bottom||c.crossTarget<a.A.expanded.top))return new Ju(a,"to right 1").add(b.value,b.crossTarget).add(a.common.expanded.right,b.crossTarget).add(a.common.expanded.right,c.crossTarget).add(c.value,c.crossTarget).build();if(null===a.midX)return null;if(null!==c.expanded&&a.gapX>=0){let d=Math.abs(c.crossTarget-a.B.expanded.bottom)+Math.abs(b.crossTarget-a.B.expanded.bottom)<Math.abs(c.crossTarget-a.B.expanded.top)+Math.abs(b.crossTarget-a.B.expanded.top)?"bottom":"top";return new Ju(a,`to right 2 via ${d}`).add(b.value,b.crossTarget).add(a.midX,b.crossTarget).add(a.midX,a.B.expanded[d]).midpointHandle("x").add(c.expanded,a.B.expanded[d]).add(c.expanded,c.crossTarget).add(c.value,c.crossTarget).build()}if(null!==b.expanded&&a.gapX<=0){let d=Math.abs(c.crossTarget-a.A.expanded.bottom)+Math.abs(b.crossTarget-a.A.expanded.bottom)<Math.abs(c.crossTarget-a.A.expanded.top)+Math.abs(b.crossTarget-a.A.expanded.top)?"bottom":"top";return new Ju(a,`to right 3 via ${d}`).add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.A.expanded[d]).add(a.midX,a.A.expanded[d]).add(a.midX,c.crossTarget).midpointHandle("x").add(c.value,c.crossTarget).build()}return null}let Jz={top:{top:[Jn,Jy],left:[Jn,Jw],bottom:[Jn,Jv],right:[Jn,Jx]},right:{top:[Jk,Jw],right:[Jk,Jy],bottom:[Jk,Jx],left:[Jk,Jv]},bottom:{top:[Jl,Jv],left:[Jl,Jx],bottom:[Jl,Jy],right:[Jl,Jw]},left:{top:[Jm,Jx],left:[Jm,Jy],bottom:[Jm,Jw],right:[Jm,Jv]}};function JA(a,b,c){let[d,e]=Jz[b][c];a.apply(d);let f=e(a);return a.reset(),f}function JB(a,b){let c=null,d=1/0,e=1/0,f=0;for(let[g,h,i,j]of b){f+=1;let b=JA(a,g,h);b&&(b.aEdgePicking=i,b.bEdgePicking=j,b.points.length<d?(d=b.points.length,e=b.distance,c=b):b.points.length===d&&b.distance+f<e&&(e=b.distance,c=b))}return c}function JC(a,b,c){var d,e,f,g,h;let i,j,k=a.getShapeUtil(b.type).options,l={elbowMidpoint:b.props.elbowMidPoint,expandElbowLegLength:k.expandElbowLegLength[b.props.size]*b.props.scale,minElbowLegLength:k.minElbowLegLength[b.props.size]*b.props.scale},m=JD(a,b,c.start,b.props.start),n=JD(a,b,c.end,b.props.end);m=JK(m,n,l),n=JK(n,m,l);let o=!!(!m.side&&n.side),{aTerminal:p,bTerminal:q}=o?{aTerminal:n,bTerminal:m}:{aTerminal:m,bTerminal:n},r={top:JF(p,q,"top",l),right:JF(p,q,"right",l),bottom:JF(p,q,"bottom",l),left:JF(p,q,"left",l)},s={top:JF(q,p,"top",l),right:JF(q,p,"right",l),bottom:JF(q,p,"bottom",l),left:JF(q,p,"left",l)},t=JG(r,p.side),u=JG(s,q.side),v=!1;t&&u||(v=!0,t||(q=JI(q)),u||(p=JI(p)),q.bounds.containsPoint(p.target,l.expandElbowLegLength)&&(q=JI(q)),p.bounds.containsPoint(q.target,l.expandElbowLegLength)&&(p=JI(p))),v&&(r={top:JF(p,q,"top",l),right:JF(p,q,"right",l),bottom:JF(p,q,"bottom",l),left:JF(p,q,"left",l)},s={top:JF(q,p,"top",l),right:JF(q,p,"right",l),bottom:JF(q,p,"bottom",l),left:JF(q,p,"left",l)});let w=p.isPoint?p.bounds:p.bounds.clone().expandBy(l.expandElbowLegLength),y=q.isPoint?q.bounds:q.bounds.clone().expandBy(l.expandElbowLegLength),z={original:lh.Common([p.bounds,q.bounds]),expanded:lh.Common([w,y])},A=q.bounds.minX-p.bounds.maxX;A<0&&((A=p.bounds.minX-q.bounds.maxX)<0&&(A=0),A=-A);let B=q.bounds.minY-p.bounds.maxY;B<0&&((B=p.bounds.minY-q.bounds.maxY)<0&&(B=0),B=-B);let C=3*p.minEndSegmentLength,D=3*q.minEndSegmentLength,E=(p.isPoint?C:l.minElbowLegLength)+(q.isPoint?D:l.minElbowLegLength),F=null;A>E?F={a:p.isPoint?p.bounds.maxX+C:w.maxX,b:q.isPoint?q.bounds.minX-D:y.minX}:A<-E&&(F={a:p.isPoint?p.bounds.minX-C:w.minX,b:q.isPoint?q.bounds.maxX+D:y.maxX});let G=null;B>E?G={a:p.isPoint?p.bounds.maxY+C:w.maxY,b:q.isPoint?q.bounds.minY-D:y.minY}:B<-E&&(G={a:p.isPoint?p.bounds.minY-C:w.minY,b:q.isPoint?q.bounds.maxY+D:y.maxY});let H=o?1-l.elbowMidpoint:l.elbowMidpoint,I=F?(d=F.a,d+(F.b-d)*H):null,J=G?(e=G.a,e+(G.b-e)*H):null,K={options:l,swapOrder:o,A:{isPoint:p.isPoint,target:p.target,isExact:p.isExact,arrowheadOffset:p.arrowheadOffset,minEndSegmentLength:p.minEndSegmentLength,original:p.bounds,expanded:w,edges:r,geometry:p.geometry},B:{isPoint:q.isPoint,target:q.target,isExact:q.isExact,arrowheadOffset:q.arrowheadOffset,minEndSegmentLength:q.minEndSegmentLength,original:q.bounds,expanded:y,edges:s,geometry:q.geometry},common:z,gapX:A,gapY:B,midX:I,midY:J},L=new Jt(K),M=JH(p,q,K.A.edges),N=JH(q,p,K.B.edges);return M&&N?j=(i=JA(f=L,g=M,h=N))?i:f.A.isPoint&&f.B.isPoint?JB(f,[[Je[g],Je[h],"manual","manual"],[g,Je[h],"manual","auto"],[Je[g],h,"auto","manual"]]):f.A.isPoint?JA(f,Je[g],h):f.B.isPoint?JA(f,g,Je[h]):null:M&&!N&&(j=function(a,b){let c=null,d=a.A.edges.right,e=a.A.edges.left,f=a.B.edges.top,g=a.B.edges.bottom;switch(b){case"right":a.gapX>0&&a.gapX>Math.abs(a.gapY)&&null!==a.midX?c=JA(a,"right","left"):d&&f&&(d.expanded??d.value)<=f.crossTarget&&d.crossTarget<=(f.expanded??f.value)?c=JA(a,"right","top"):d&&g&&(d.expanded??d.value)<=g.crossTarget&&d.crossTarget>=(g.expanded??g.value)&&(c=JA(a,"right","bottom"));break;case"left":a.gapX<0&&Math.abs(a.gapX)>Math.abs(a.gapY)&&null!==a.midX?c=JA(a,"left","right"):e&&f&&(e.expanded??e.value)>=f.crossTarget&&e.crossTarget<=(f.expanded??f.value)?c=JA(a,"left","top"):e&&g&&(e.expanded??e.value)>=g.crossTarget&&e.crossTarget>=(g.expanded??g.value)&&(c=JA(a,"left","bottom"));break;case"top":case"bottom":break;default:cf(b)}if(c)return c.aEdgePicking="manual",c.bEdgePicking="auto",c;switch(b){case"top":return JB(a,[["top","bottom","manual","auto"],["top","right","manual","auto"],["top","left","manual","auto"],["top","top","manual","auto"]]);case"bottom":return JB(a,[["bottom","top","manual","auto"],["bottom","right","manual","auto"],["bottom","left","manual","auto"],["bottom","bottom","manual","auto"]]);case"left":return JB(a,[["left","right","manual","auto"],["left","bottom","manual","auto"],["left","left","manual","auto"],["left","top","manual","auto"]]);case"right":return JB(a,[["right","left","manual","auto"],["right","bottom","manual","auto"],["right","right","manual","auto"],["right","top","manual","auto"]])}}(L,M)),j||(j=function(a,b){let c=null;if(Math.abs(a.gapX)+1>Math.abs(a.gapY)&&null!==a.midX)c=a.gapX>0?JA(a,"right","left"):JA(a,"left","right");else{let b=a.A.edges.right,d=a.A.edges.left,e=a.B.edges.top,f=a.B.edges.bottom;a.A.isPoint&&a.B.isPoint?c=a.gapY>0?JA(a,"bottom","top"):JA(a,"top","bottom"):b&&e&&(b.expanded??b.value)<=e.crossTarget&&b.crossTarget<=(e.expanded??e.value)?c=JA(a,"right","top"):b&&f&&(b.expanded??b.value)<=f.crossTarget&&b.crossTarget>=(f.expanded??f.value)?c=JA(a,"right","bottom"):d&&e&&(d.expanded??d.value)>=e.crossTarget&&d.crossTarget<=(e.expanded??e.value)?c=JA(a,"left","top"):d&&f&&(d.expanded??d.value)>=f.crossTarget&&d.crossTarget>=(f.expanded??f.value)?c=JA(a,"left","bottom"):a.gapY>0&&null!==a.midY?c=JA(a,"bottom","top"):a.gapY<0&&null!==a.midY&&(c=JA(a,"top","bottom"))}if(c)return c.aEdgePicking=b,c.bEdgePicking=b,c;let d=Jb.filter(b=>a.A.edges[b]),e=Jb.filter(b=>a.B.edges[b]);return JB(a,d.flatMap(a=>e.map(c=>[a,c,b,b])))}(L,M||N?"fallback":"auto")),j&&(JJ("first",K.A,K.B,j),JJ("last",K.B,K.A,j),function(a,b,c){if(a){if(a.points.length>=3){let c=a.points[0],d=a.points[1];if(jA.ManhattanDist(c,d)<b.minEndSegmentLength&&(a.points.splice(1,1),a.points.length>=3)){let b=jK(c.x,d.x)?"y":"x";a.points[1][b]=c[b]}}if(a.points.length>=3){let b=a.points[a.points.length-1],d=a.points[a.points.length-2];if(jA.ManhattanDist(b,d)<c.minEndSegmentLength&&(a.points.splice(a.points.length-2,1),a.points.length>=3)){let c=jK(b.x,d.x)?"y":"x";a.points[a.points.length-2][c]=b[c]}}}}(j,p,q),o&&j.points.reverse()),{...K,route:j,midXRange:F?o?{lo:F.b,hi:F.a}:{lo:F.a,hi:F.b}:null,midYRange:G?o?{lo:G.b,hi:G.a}:{lo:G.a,hi:G.b}:null}}function JD(a,b,c,d){let e=JX[b.props.size]*b.props.scale/2,f=e*b.props.scale*3;if(c){let d=a.getShape(c.toId),h=function(a,b,c,d){var e,f,g,h;let i="start"===d.terminal?"none"!==b.props.arrowheadStart:"none"!==b.props.arrowheadEnd,j=a.getShapeGeometry(c,i?void 0:{context:"@tldraw/arrow-without-arrowhead"});if(!j)return null;let k=a.getShapePageTransform(b.id),l=a.getShapePageTransform(c),m=k.clone().invert().multiply(l),n=j.transform(m),o={x:.5,y:.5},p=d.isPrecise?d.normalizedAnchor:o,q={x:(e=j.bounds.minX,e+(j.bounds.maxX-e)*p.x),y:(f=j.bounds.minY,f+(j.bounds.maxY-f)*p.y)},r={x:(g=j.bounds.minX,g+(j.bounds.maxX-g)*o.x),y:(h=j.bounds.minY,h+(j.bounds.maxY-h)*o.y)},s=li.applyToPoint(m,q),t=li.applyToPoint(m,r);return{bounds:n.bounds,geometry:n,target:s,center:t,shapeToArrowTransform:m}}(a,b,c.toId,c.props);if(h&&d){var g;let a=0,i="start"===c.props.terminal?"arrowheadStart":"arrowheadEnd";if("none"!==b.props[i]){let c="scale"in d.props?d.props.scale:1;a=e+("size"in d.props?(JX[d.props.size]??0)*c/2:0)+JV*b.props.scale}let j=null,k=h.target;return c.props.isPrecise&&(j=jK((g=jA.RotWith(c.props.normalizedAnchor,{x:.5,y:.5},h.shapeToArrowTransform.rotation())).x,.5)&&jK(g.y,.5)?null:Math.abs(g.x-.5)>Math.abs(g.y-.5)-1e-4?g.x<.5?"left":"right":g.y<.5?"top":"bottom"),{targetShapeId:c.toId,isPoint:!1,isExact:c.props.isExact,bounds:h.bounds,geometry:h.geometry,target:k,arrowheadOffset:a,minEndSegmentLength:f,side:j,snap:c.props.snap}}}return{targetShapeId:null,bounds:lh.FromCenter(d,{x:0,y:0}),geometry:null,isExact:!1,isPoint:!0,target:jA.From(d),arrowheadOffset:0,minEndSegmentLength:f,side:null,snap:"none"}}let JE={top:{expand:-1,main:"minY",opposite:"maxY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"max",crossAxis:"x"},bottom:{expand:1,main:"maxY",opposite:"minY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"min",crossAxis:"x"},left:{expand:-1,main:"minX",opposite:"maxX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"max",crossAxis:"y"},right:{expand:1,main:"maxX",opposite:"minX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"min",crossAxis:"y"}};function JF(a,b,c,d){var e,f,g,h,i;let j,k=JE[c],l=a.targetShapeId===b.targetShapeId&&null!==a.targetShapeId&&("edge"===a.snap||"edge-point"===a.snap)&&("edge"===b.snap||"edge-point"===b.snap),m=a.bounds[k.main],n=a.isPoint?null:m+k.expand*d.expandElbowLegLength,o=Jg(a.bounds[k.crossMin],a.bounds[k.crossMax]),p=o;if(!p)return null;cg(o);let q=Jg(b.bounds[k.main],b.bounds[k.opposite]);b.isPoint||(q[k.bRangeExpand]-=2*d.minElbowLegLength*k.expand);let r=(e=Jg(b.bounds[k.crossMin],b.bounds[k.crossMax]),f=d.expandElbowLegLength,(j={min:e.min-f,max:e.max+f}).min>j.max?null:j);cg(q&&r);let s=!1;if(Jh(m,q)&&!a.isPoint&&!b.isPoint&&!l){let a=(cg((g=p).min<=g.max&&r.min<=r.max),g.min<=r.min&&r.max<=g.max)?[{min:g.min,max:r.min},{min:r.max,max:g.max}]:r.max<=g.min||r.min>=g.max?[g]:r.min<=g.min&&g.max<=r.max?[]:Jh(g.min,r)?[{min:r.max,max:g.max}]:Jh(g.max,r)?[{min:g.min,max:r.min}]:[];switch(a.length){case 0:return null;case 1:s=a[0]!==p,p=a[0];break;case 2:s=!0,p=(h=a[0]).max-h.min>(i=a[1]).max-i.min?a[0]:a[1];break;default:cf(a)}}return Jh(a.target[k.crossAxis],p)?{value:m,expanded:n,cross:p,crossTarget:a.target[k.crossAxis],isPartial:s}:null}function JG(a,b){return null===b?!!(a.bottom||a.left||a.right||a.top):"x"===b?!!a.left||!!a.right:"y"===b?!!a.top||!!a.bottom:!!a[b]}function JH(a,b,c){switch(a.side){case null:return null;case"x":if(a.bounds.center.x>b.bounds.center.x&&c?.left)return"left";if(c?.right)return"right";return null;case"y":if(a.bounds.center.y>b.bounds.center.y&&c?.top)return"top";if(c?.bottom)return"bottom";return null;default:return a.side}}function JI(a){if(a.isPoint)return a;let b=null,c=0;return("edge"===a.snap||"edge-point"===a.snap)&&(c=a.arrowheadOffset,("x"===a.side||"left"===a.side||"right"===a.side)&&(b="x"),("y"===a.side||"top"===a.side||"bottom"===a.side)&&(b="y")),{targetShapeId:a.targetShapeId,side:b,bounds:new lh(a.target.x,a.target.y,0,0),geometry:a.geometry,target:a.target,arrowheadOffset:c,minEndSegmentLength:a.minEndSegmentLength,isExact:a.isExact,isPoint:!0,snap:a.snap}}function JJ(a,b,c,d){if(!b.geometry)return;let e="first"===a?d.points[0]:d.points[d.points.length-1],f="first"===a?d.points[1]:d.points[d.points.length-2],g=b.geometry.isClosed?f:b.target,h=jA.ManhattanDist(e,g),i=null,j=1/0;if(b.isExact)i=b.target;else if(b.geometry){let a=b.geometry.intersectLineSegment(f,b.target,{includeLabels:!1,includeInternal:!1});for(let c of(b.geometry.hitTestPoint(b.target,Math.max(1,b.arrowheadOffset),!0,ls)&&a.push(b.target),a)){let a=jA.ManhattanDist(g,c);a<j&&(j=a,i=c)}}if(i){let g=b.arrowheadOffset,j=jA.ManhattanDist(f,i),k=2*b.arrowheadOffset;j<k&&(g=j-(k-b.arrowheadOffset)),g<b.minEndSegmentLength&&(g=b.geometry.bounds.containsPoint(c.target)?Math.max(0,g):-b.arrowheadOffset);let l=i,m=!1;if(!b.isExact&&0!==g){let a=jA.Nudge(i,f,g);l=a,g<0&&!b.geometry.hitTestPoint(a,0,!0,ls)?l=i:(g<0&&(m=!0),l=a)}let n=jA.ManhattanDist(f,l);if(d.distance+=n-h,e.x=l.x,e.y=l.y,m){let b=jA.Lrp(f,e,.5);d.skipPointsWhenDrawing.add(b),d.points.splice("first"===a?1:d.points.length-1,0,b)}}}function JK(a,b,c){if(!a.geometry||a.geometry.isClosed)return a;let d=a.geometry.uninterpolateAlongEdge(a.target,ls),e=a.geometry.interpolateAlongEdge(d-.01/a.geometry.length),f=a.geometry.interpolateAlongEdge(d+.01/a.geometry.length).sub(e).per().uni(),g=Math.abs(f.x)>Math.abs(f.y)?Jf.x:Jf.y;if(a.geometry.bounds.containsPoint(b.target,c.expandElbowLegLength))return a.side=g.self,JI(a);let h=g.v(a.target[g.self]-2*a.bounds[g.size],a.target[g.cross]),i=g.v(a.target[g.self]+2*a.bounds[g.size],a.target[g.cross]),j=null,k=0,l=null,m=0,n=g.self;for(let b of a.geometry.intersectLineSegment(h,i,ls))!(1>Math.abs(b[g.self]-a.target[g.self]))&&(b[g.self]<a.target[g.self]?jA.ManhattanDist(b,a.target)>k&&(k=jA.ManhattanDist(b,a.target),j=b):jA.ManhattanDist(b,a.target)>m&&(m=jA.ManhattanDist(b,a.target),l=b));return j&&l?n=k>m?g.hiEdge:g.loEdge:j&&!l?n=g.hiEdge:!j&&l&&(n=g.loEdge),a.side=n,a}function JL(a,b,c){let d=a.getBindingsFromShape(b,"arrow").find(a=>a.props.terminal===c);if(!d)return;let e=a.getShape(d.toId);if(!e)return;let f=a.getShapePageTransform(e),g="start"===c?"none"!==b.props.arrowheadStart:"none"!==b.props.arrowheadEnd,h=a.getShapeGeometry(e,g?void 0:{context:"@tldraw/arrow-without-arrowhead"});return{shape:e,transform:f,isClosed:h.isClosed,isExact:d.props.isExact,didIntersect:!1,geometry:h}}function JM(a,b,c,d){let e=a.getShape(c.toId);if(!e)return new jA(0,0);{let{point:f,size:g}=a.getShapeGeometry(e).bounds,h=jA.Add(f,jA.MulV(c.props.isPrecise||d?c.props.normalizedAnchor:{x:.5,y:.5},g)),i=li.applyToPoint(a.getShapePageTransform(e),h);return li.applyToPoint(li.Inverse(b),i)}}let JN=f4("arrow bindings",(a,b)=>{let c=a.getBindingsFromShape(b.id,"arrow");return{start:c.find(a=>"start"===a.props.terminal),end:c.find(a=>"end"===a.props.terminal)}},{areRecordsEqual:(a,b)=>a.id===b.id,areResultsEqual:(a,b)=>a.start===b.start&&a.end===b.end});function JO(a,b){return JN.get(a,b.id)}let JP=f4("arrow info",(a,b)=>{let c=JO(a,b);if("elbow"===b.props.kind){let d=JC(a,b,c);if(!d?.route)return I8(a,b,c);let e=d.swapOrder?d.B:d.A,f=d.swapOrder?d.A:d.B;return{type:"elbow",bindings:c,start:{handle:e.target,point:d.route.points[0],arrowhead:b.props.arrowheadStart},end:{handle:f.target,point:d.route.points[d.route.points.length-1],arrowhead:b.props.arrowheadEnd},elbow:d,route:d.route,isValid:!0}}return"arc"===b.props.kind&&Math.abs(b.props.bend)<8*b.props.scale?I8(a,b,c):function(a,b,c){let{arrowheadEnd:d,arrowheadStart:e}=b.props,f=b.props.bend;if(Math.abs(f)>Math.abs(b.props.bend*(JW*b.props.scale)))return I8(a,b,c);let g=JR(a,b,c),h=jA.Med(g.start,g.end),i=jA.Sub(g.end,g.start),j=jA.Len(i)?i.uni():jA.From(i),k=jA.Add(h,j.per().mul(-f)),l=JL(a,b,"start"),m=JL(a,b,"end"),n=g.start.clone(),o=g.end.clone(),p=k.clone();if(jA.Equals(n,o))return{bindings:c,type:"straight",start:{handle:n,point:n,arrowhead:b.props.arrowheadStart},end:{handle:o,point:o,arrowhead:b.props.arrowheadEnd},middle:p,isValid:!1,length:0};let q=b.props.bend<0,r=q?jN:jO,s=Ja(n,o,p),t=jA.Angle(s.center,n),u=jA.Angle(s.center,o),v=r(t,u);if(0===s.length||0===s.size||!jZ(s.length)||!jZ(s.size))return I8(a,b,c);let w=n.clone(),y=o.clone(),z=p.clone(),A=a.getShapePageTransform(b),B=0,C=0,D=JU*b.props.scale;if(l&&!l.isExact){let c,d=li.applyToPoint(A,w),f=li.applyToPoint(A,s.center),g=li.applyToPoint(A,y),h=li.Inverse(l.transform),i=li.applyToPoint(h,d),j=li.applyToPoint(h,f),k=li.applyToPoint(h,g),{isClosed:m}=l,n=Array.from(l.geometry.intersectCircle(j,s.radius,{includeLabels:!1,includeInternal:!1}));if(n.length){let a=j.angle(i),b=r(a,j.angle(k));n=n.filter(c=>r(a,j.angle(c))<=b);let d=.25*b;n.sort(m?(b,c)=>Math.abs(r(a,j.angle(b))-d)<Math.abs(r(a,j.angle(c))-d)?-1:1:(b,c)=>r(a,j.angle(b))<r(a,j.angle(c))?-1:1),c=n[0]}if(!c)if(m){let a=l.geometry.nearestPoint(i,{includeInternal:!1,includeLabels:!1});jA.DistMin(a,i,1)&&(c=a)}else c=i;if(c&&(w.setTo(a.getPointInShapeSpace(b,li.applyToPoint(l.transform,c))),l.didIntersect=!0,"none"!==e)){let a=JX[b.props.size]/2+("size"in l.shape.props?JX[l.shape.props.size]/2:0);B=(JV+a)*b.props.scale,D+=a*b.props.scale}}if(m&&!m.isExact){let c,e=li.applyToPoint(A,w),f=li.applyToPoint(A,y),g=li.applyToPoint(A,s.center),h=li.Inverse(m.transform),i=li.applyToPoint(h,e),j=li.applyToPoint(h,g),k=li.applyToPoint(h,f),l=m.isClosed,n=Array.from(m.geometry.intersectCircle(j,s.radius,{includeLabels:!1,includeInternal:!1}));if(n.length){let a=j.angle(i),b=r(a,j.angle(k)),d=.75*b;(n=n.filter(c=>r(a,j.angle(c))<=b)).sort(l?(b,c)=>Math.abs(r(a,j.angle(b))-d)<Math.abs(r(a,j.angle(c))-d)?-1:1:(b,c)=>r(a,j.angle(b))<r(a,j.angle(c))?-1:1),c=n[0]}if(!c)if(l){let a=m.geometry.nearestPoint(k,{includeInternal:!1,includeLabels:!1});jA.DistMin(a,k,1)&&(c=a)}else c=k;if(c&&(y.setTo(a.getPointInShapeSpace(b,li.applyToPoint(m.transform,c))),m.didIntersect=!0,"none"!==d)){let a=JX[b.props.size]/2+("size"in m.shape.props?JX[m.shape.props.size]/2:0);C=(JV+a)*b.props.scale,D+=a*b.props.scale}}let E=jA.Angle(s.center,w),F=jA.Angle(s.center,y),G=r(E,F),H=G*s.radius,I=w.clone(),J=y.clone();if(0!==B&&I.setTo(s.center).add(jA.FromAngle(E+B/H*(q?1:-1)*G).mul(s.radius)),0!==C&&J.setTo(s.center).add(jA.FromAngle(F+C/H*(q?-1:1)*G).mul(s.radius)),jA.DistMin(I,J,D)){0!==B&&0!==C?(B*=-1.5,C*=-1.5):0!==B?B*=-2:0!==C&&(C*=-2);let a=.1-r(t,E)*s.radius,b=.1-r(F,u)*s.radius;B=Math.max(B,a),C=Math.max(C,b)}if(0!==B&&w.setTo(s.center).add(jA.FromAngle(E+B/H*(q?1:-1)*G).mul(s.radius)),0!==C&&y.setTo(s.center).add(jA.FromAngle(F+C/H*(q?-1:1)*G).mul(s.radius)),l&&m&&!l.isExact&&!m.isExact){H=(G=r(E=jA.Angle(s.center,w),F=jA.Angle(s.center,y)))*s.radius;let c=JY(a,l.shape.id,m.shape.id);"double-bound"===c&&H<30?(w.setTo(n),y.setTo(o),z.setTo(p)):"safe"===c&&(l&&!l.didIntersect&&w.setTo(n),(m&&!m.didIntersect||r(t,E)>r(t,F))&&y.setTo(s.center).add(jA.FromAngle(E+G*(Math.min(.9,JU*b.props.scale/H)*(q?1:-1))).mul(s.radius)))}(function(a,b,c,d,e,f,g){let h=jA.Angle(a,c),i=jN(h,jA.Angle(a,d));if(g||(i=jG-i),e.setTo(a).add(jA.FromAngle(h+.5*(g?1:-1)*i).mul(b)),i>f){e.rotWith(a,jE);let b=d.clone();d.setTo(c),c.setTo(b)}})(s.center,s.radius,w,y,z,v,q),w.equals(y)&&(w.setTo(z.clone().addXY(1,1)),y.setTo(z.clone().subXY(1,1))),n.setTo(w),o.setTo(y),p.setTo(z);let K=Ja(n,o,p);return{bindings:c,type:"arc",start:{point:n,handle:g.start,arrowhead:b.props.arrowheadStart},end:{point:o,handle:g.end,arrowhead:b.props.arrowheadEnd},middle:p,handleArc:s,bodyArc:K,isValid:0!==K.length&&isFinite(K.center.x)&&isFinite(K.center.y)}}(a,b,c)},{areRecordsEqual:(a,b)=>a.props===b.props,areResultsEqual:c5});function JQ(a,b){let c="string"==typeof b?b:b.id;return JP.get(a,c)}function JR(a,b,c){let d=a.getShapePageTransform(b),e=JY(a,c.start?.toId,c.end?.toId);return{start:c.start?JM(a,d,c.start,"double-bound"===e||"start-contains-end"===e):jA.From(b.props.start),end:c.end?JM(a,d,c.end,"double-bound"===e||"end-contains-start"===e):jA.From(b.props.end)}}function JS(a,b,c,d){let e="string"==typeof b?b:b.id,f="string"==typeof c?c:c.id,g=a.getBindingsFromShape(e,"arrow").filter(a=>a.props.terminal===d.terminal);g.length>1&&a.deleteBindings(g.slice(1));let h=g[0];h?a.updateBinding({...h,toId:f,props:d}):a.createBinding({type:"arrow",fromId:e,toId:f,props:d})}function JT(a,b,c){let d=a.getBindingsFromShape(b,"arrow").filter(a=>a.props.terminal===c);a.deleteBindings(d)}let JU=10,JV=10,JW=10,JX={s:2,m:3.5,l:5,xl:10};function JY(a,b,c){if(!b||!c)return"safe";if(b===c)return"double-bound";let d=a.getShapePageBounds(b),e=a.getShapePageBounds(c);if(d&&e){if(d.contains(e))return"start-contains-end";if(e.contains(d))return"end-contains-start"}return"safe"}let JZ=()=>{let a=kp();return e$("threeStackableItems",()=>a.getSelectedShapeIds().map(b=>a.getShape(b)).filter(b=>{if(!b)return!1;if(a.isShapeOfType(b,"arrow")){let c=JO(a,b);if(c.start||c.end)return!1}return!0}).length>2,[a])},J$=()=>{let a=kp();return e$("isInSelectState",()=>a.isIn("select"),[a])},J_=()=>{let a=kp();return e$("allow group",()=>{let b=a.getSelectedShapes();if(b.length<2)return!1;for(let c of b)if(a.isShapeOfType(c,"arrow")){let d=JO(a,c);if(d.start&&!b.some(a=>a.id===d.start.toId)||d.end&&!b.some(a=>a.id===d.end.toId))return!1}return!0},[a])},J0=()=>{let a=kp();return e$("allowUngroup",()=>a.getSelectedShapeIds().some(b=>a.getShape(b)?.type==="group"),[a])};function J1(a,b){let c=kp();return e$("selectedShapes",()=>{let d=c.getSelectedShapes().length;if(void 0===a)if(void 0===b)return d;else return d<=b;return void 0===b?d>=a:d>=a&&d<=b},[c,a,b])}function J2(a,b){let c=kp();return e$("selectedShapes",()=>{let d=c.getSelectedShapes().filter(a=>!c.isShapeOrAncestorLocked(a)).length;if(void 0===a)if(void 0===b)return d;else return d<=b;return void 0===b?d>=a:d>=a&&d<=b},[c])}function J3(){let a=kp();return e$("hasLinkShapeSelected",()=>{let b=a.getOnlySelectedShape();return!!(b&&"embed"!==b.type&&"url"in b.props&&!b.isLocked)},[a])}function J4(){let a=kp();return e$("useCanRedo",()=>a.getCanRedo(),[a])}function J5(){let a=kp();return e$("useCanUndo",()=>a.getCanUndo(),[a])}function J6(){return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(J7,{}),(0,bT.jsx)(J8,{}),(0,bT.jsx)(J9,{}),(0,bT.jsx)(Ka,{}),(0,bT.jsx)(Kb,{}),(0,bT.jsx)(Ke,{}),(0,bT.jsx)(Kf,{}),(0,bT.jsx)(Kg,{})]})}function J7(){let a=J2(2),b=J$(),c=a&&b;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Hy,{actionId:"align-left",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"align-center-horizontal",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"align-right",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"stretch-horizontal",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"align-top",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"align-center-vertical",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"align-bottom",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"stretch-vertical",disabled:!c})]})}function J8(){let a=J2(3),b=J$(),c=a&&b;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Hy,{actionId:"distribute-horizontal",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"distribute-vertical",disabled:!c})]})}function J9(){let a=JZ(),b=J$(),c=a&&b;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Hy,{actionId:"stack-horizontal",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"stack-vertical",disabled:!c})]})}function Ka(){let a=J2(1),b=J$(),c=a&&b;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Hy,{actionId:"send-to-back",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"send-backward",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"bring-forward",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"bring-to-front",disabled:!c})]})}function Kb(){return Ce()<Cb.TABLET_SM?(0,bT.jsx)(Kc,{}):(0,bT.jsx)(Kd,{})}function Kc(){let a=kp(),b=e$("zoom is 1",()=>1===a.getZoomLevel(),[a]);return(0,bT.jsx)(Hy,{actionId:"zoom-to-100",disabled:b})}function Kd(){let a=J2(1),b=J$();return(0,bT.jsx)(Hy,{actionId:"rotate-ccw",disabled:!(a&&b)})}function Ke(){let a=J2(1),b=J$();return(0,bT.jsx)(Hy,{actionId:"rotate-cw",disabled:!(a&&b)})}function Kf(){let a=J3(),b=J$();return(0,bT.jsx)(Hy,{actionId:"edit-link",disabled:!(a&&b)})}function Kg(){let a=J_(),b=J0();return a?(0,bT.jsx)(Kh,{}):b?(0,bT.jsx)(Ki,{}):(0,bT.jsx)(Kh,{})}function Kh(){let a=J2(2),b=J$();return(0,bT.jsx)(Hy,{actionId:"group",disabled:!(a&&b)})}function Ki(){return(0,bT.jsx)(Hy,{actionId:"ungroup"})}let Kj=(0,eQ.memo)(function({children:a}){let b=zQ(),c=Ce(),d=Ft(),{orientation:e}=GP(),f=(0,eQ.useRef)(null);qF(f);let g=kp(),h=e$("should display quick actions when in readonly",()=>g.isInAny("hand","zoom"),[g]),i=a??(0,bT.jsx)(J6,{});if(!d||h)return(0,bT.jsxs)(I5,{id:"actions-menu",children:[(0,bT.jsx)(I6,{children:(0,bT.jsx)(Ht,{type:"icon","data-testid":"actions-menu.button",title:b("actions-menu.title"),children:(0,bT.jsx)(BV,{icon:"horizontal"===e?"dots-vertical":"dots-horizontal",small:!0})})}),(0,bT.jsx)(I7,{side:"horizontal"===e?c>=Cb.TABLET?"bottom":"top":"right",sideOffset:6,children:(0,bT.jsx)(Hs,{ref:f,label:b("actions-menu.title"),className:"tlui-actions-menu","data-testid":"actions-menu.content",orientation:"grid",children:(0,bT.jsx)(Ch,{type:"icons",sourceId:"actions-menu",children:i})})})]})});var Fs=Fs;function Kk(){let a=kp(),b=Ci(),c=e$("isSelectToolActive",()=>"select"===a.getCurrentToolId(),[a]),d=e$("isSinglePageMode",()=>a.options.maxPages<=1,[a]);return c?(0,bT.jsxs)(bT.Fragment,{children:[b&&(0,bT.jsx)(QZ,{}),(0,bT.jsxs)(Hz,{id:"modify",children:[(0,bT.jsx)(QF,{}),(0,bT.jsx)(QG,{}),(0,bT.jsx)(QJ,{}),!d&&(0,bT.jsx)(QK,{})]}),(0,bT.jsx)(Qx,{}),(0,bT.jsx)(QC,{}),(0,bT.jsx)(Hz,{id:"select-all",children:(0,bT.jsx)(QD,{})})]}):null}let Kl=(0,eQ.memo)(function({children:a,disabled:b=!1}){let c=kp(),d=zQ(),{Canvas:e}=re(),f=(0,eQ.useCallback)(a=>{"Escape"===a.key&&(a.stopPropagation(),c.getContainer().focus())},[c]);(0,eQ.useEffect)(()=>()=>{document.body.removeEventListener("keydown",f,{capture:!0})},[f]);let g=(0,eQ.useCallback)(a=>{if(a){if(document.body.addEventListener("keydown",f,{capture:!0}),c.getInstanceState().isCoarsePointer){let a=c.getSelectedShapes(),{inputs:{currentPagePoint:b}}=c,d=c.getShapesAtPoint(b);if(!c.getSelectedShapes().length||!d.some(b=>a.includes(b))){let a=d.filter(a=>c.isShapeOrAncestorLocked(a));a.length&&c.select(...a.map(a=>a.id))}}}else{let a=c.getOnlySelectedShape();a&&c.isShapeOrAncestorLocked(a)&&c.setSelectedShapes([]),c.timers.requestAnimationFrame(()=>{document.body.removeEventListener("keydown",f,{capture:!0})})}},[c,f]),h=kv(),[i,j]=F1("context menu",g),k=a??(0,bT.jsx)(Kk,{});return(0,bT.jsxs)(Fs.Root,{dir:"ltr",onOpenChange:j,modal:!1,children:[(0,bT.jsx)(Fs.Trigger,{onContextMenu:void 0,dir:"ltr",disabled:b,children:e?(0,bT.jsx)(e,{}):null}),i&&(0,bT.jsx)(Fs.Portal,{container:h,children:(0,bT.jsx)(Fs.Content,{className:"tlui-menu tlui-scrollable","data-testid":"context-menu","aria-label":d("context-menu.title"),alignOffset:-4,collisionPadding:4,onContextMenu:kb,children:(0,bT.jsx)(Ch,{type:"context-menu",sourceId:"context-menu",children:k})})})]})}),Km=eV(function(){let a=kp(),{isChatting:b,chatMessage:c}=a.getInstanceState(),d=(0,eQ.useRef)(-1),[e,f]=(0,eQ.useState)("");return((0,eQ.useEffect)(()=>((!b&&c||b)&&(d.current=a.timers.setTimeout(()=>{a.updateInstanceState({chatMessage:"",isChatting:!1}),f(""),a.focus()},b?5e3:2e3)),()=>{clearTimeout(d.current)}),[a,c,b]),b)?(0,bT.jsx)(Kp,{value:e,setValue:f,chatMessage:c}):c.trim()?(0,bT.jsx)(Ko,{chatMessage:c}):null});function Kn(a){let b=kp();(0,eQ.useLayoutEffect)(()=>{if(!a.current)return;let{x:c,y:d}=b.inputs.currentScreenPoint;function e(c){let{minX:d,minY:e}=b.getViewportScreenBounds();a.current?.style.setProperty("transform",`translate(${c.clientX-d}px, ${c.clientY-e}px)`)}return a.current?.style.setProperty("transform",`translate(${c}px, ${d}px)`),window.addEventListener("pointermove",e),()=>{window.removeEventListener("pointermove",e)}},[a,b])}let Ko=({chatMessage:a})=>{let b=kp(),c=(0,eQ.useRef)(null);return Kn(c),(0,bT.jsx)("div",{ref:c,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:b.user.getColor()},children:a})},Kp=eV(function({chatMessage:a,value:b,setValue:c}){let d=kp(),e=zQ(),f=(0,eQ.useRef)(null),g=a||e("cursor-chat.type-to-chat");Kn(f),(0,eQ.useLayoutEffect)(()=>{let a=f.current;if(!a)return;let c=d.textMeasure.measureText(b||g,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});a.style.setProperty("width",c.w+"px")},[d,b,g]),(0,eQ.useLayoutEffect)(()=>{let a=d.timers.requestAnimationFrame(()=>{f.current?.focus()});return()=>{cancelAnimationFrame(a)}},[d]);let h=(0,eQ.useCallback)(()=>{d.updateInstanceState({isChatting:!1}),d.focus()},[d]),i=(0,eQ.useCallback)(a=>{let{value:b}=a.target;c(b.slice(0,64)),d.updateInstanceState({chatMessage:b})},[d,c]),j=(0,eQ.useCallback)(a=>{let b=f.current;if(!b)return;let{value:d}=b;switch(a.key){case"Enter":if(kb(a),a.stopPropagation(),!d)return void h();c("");break;case"Escape":kb(a),a.stopPropagation(),h()}},[h,c]),k=(0,eQ.useCallback)(a=>{a.stopPropagation()},[]);return(0,bT.jsx)("input",{ref:f,className:"tl-cursor-chat",style:{backgroundColor:d.user.getColor()},onBlur:h,onChange:i,onKeyDown:j,onPaste:k,value:b,placeholder:g,spellCheck:!1})});function Kq({checked:a}){let b=zQ();return(0,bT.jsx)(BT,{"data-checked":!!a,label:b(a?"ui.checked":"ui.unchecked"),icon:a?"check":"none",className:"tlui-button__icon",small:!0})}var Fs=Fs,FY=FY;function Kr({id:a,kbd:b,label:c,lang:d,readonlyOk:e,onSelect:f,toggle:g=!1,disabled:h=!1,checked:i=!1}){let{type:j,sourceId:k}=Cg(),l=Ft(),m=zQ();if(l&&!e)return null;let n=Qg(c,j),o=n?m(n):void 0;switch(j){case"menu":return(0,bT.jsxs)(FY.CheckboxItem,{dir:"ltr",lang:d,className:"tlui-button tlui-button__menu tlui-button__checkbox",title:o,onSelect:a=>{f?.(k),kb(a)},disabled:h,checked:i,children:[(0,bT.jsx)(BT,{small:!0,label:m(i?"ui.checked":"ui.unchecked"),icon:g?i?"toggle-on":"toggle-off":i?"check":"none"}),o&&(0,bT.jsx)("span",{className:"tlui-button__label",draggable:!1,children:o}),b&&(0,bT.jsx)(Gb,{children:b})]});case"context-menu":return(0,bT.jsxs)(Fs.CheckboxItem,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",lang:d,title:o,onSelect:a=>{f(k),kb(a)},disabled:h,checked:i,children:[(0,bT.jsx)(BT,{small:!0,label:m(i?"ui.checked":"ui.unchecked"),icon:g?i?"toggle-on":"toggle-off":i?"check":"none"}),o&&(0,bT.jsx)("span",{className:"tlui-button__label",draggable:!1,children:o}),b&&(0,bT.jsx)(Gb,{children:b})]},a);default:return null}}var Fs=Fs;function Ks({id:a,disabled:b=!1,label:c,size:d="small",children:e}){let{type:f,sourceId:g}=Cg(),h=kv(),i=zQ(),j=c?"string"==typeof c?c:c[f]??c.default:void 0,k=j?i(j):void 0;switch(f){case"menu":return(0,bT.jsxs)(F5,{id:`${g}-sub.${a}`,children:[(0,bT.jsx)(F6,{id:`${g}-sub.${a}-button`,disabled:b,label:k,title:k}),(0,bT.jsx)(F7,{id:`${g}-sub.${a}-content`,size:d,children:e})]});case"context-menu":if(b)return null;return(0,bT.jsxs)(Kt,{id:`${g}-sub.${a}`,children:[(0,bT.jsx)(Fs.ContextMenuSubTrigger,{dir:"ltr",disabled:b,asChild:!0,children:(0,bT.jsxs)(zS,{"data-testid":`${g}-sub.${a}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[(0,bT.jsx)(z3,{children:k}),(0,bT.jsx)(BV,{icon:"chevron-right",small:!0})]})}),(0,bT.jsx)(Fs.ContextMenuPortal,{container:h,children:(0,bT.jsx)(Fs.ContextMenuSubContent,{"data-testid":`${g}-sub.${a}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":d,children:e})})]});default:return e}}function Kt({id:a,children:b}){let[c,d]=F1(a);return(0,bT.jsx)(Fs.ContextMenuSub,{open:c,onOpenChange:d,children:b})}function Ku({customDebugFlags:a,customFeatureFlags:b}){let c=kp(),{addToast:d}=Ia(),{addDialog:e}=HC(),[f,g]=eQ.default.useState(!1);return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(Hz,{id:"items",children:[(0,bT.jsx)(Hw,{id:"hard-reset",onSelect:kA,label:"Hard reset"}),(0,bT.jsx)(Hw,{id:"add-toast",onSelect:()=>{d({id:cA(void 0),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),d({id:cA(void 0),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),d({id:cA(void 0),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),d({id:cA(void 0),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),(0,bT.jsx)(Hw,{id:"show-dialog",label:"Show dialog",onSelect:()=>{e({component:({onClose:a})=>(0,bT.jsx)(Kx,{displayDontShowAgain:!0,onCancel:()=>a(),onContinue:()=>a()}),onClose:()=>{}})}}),(0,bT.jsx)(Hw,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>(function(a,b){let c=a.options.adjacentShapeMargin,d=Array(100),e=Math.floor(Math.sqrt(100));for(let a=0;a<100;a++)Kz++,d[a]={id:hd("box"+Kz),type:"geo",x:a%e*(100+c),y:Math.floor(a/e)*(100+c)};a.run(()=>{a.createShapes(d).setSelectedShapes(d.map(a=>a.id))})})(c,100)}),(0,bT.jsx)(Hw,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{let a=c.getSelectedShapes(),b=0===a.length?c.getRenderingShapes():a;window.alert(`Shapes ${b.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(f)throw Error("oh no!");return null})(),(0,bT.jsx)(Hw,{id:"throw-error",onSelect:()=>g(!0),label:"Throw error"})]}),(0,bT.jsxs)(Hz,{id:"flags",children:[(0,bT.jsx)(Kv,{customDebugFlags:a}),(0,bT.jsx)(Kw,{customFeatureFlags:b})]})]})}function Kv(a){let b=Object.values(a.customDebugFlags??j7);return b.length?(0,bT.jsx)(Ks,{id:"debug flags",label:"Debug flags",children:(0,bT.jsx)(Hz,{id:"debug flags",children:b.map(a=>(0,bT.jsx)(Ky,{flag:a},a.name))})}):null}function Kw(a){let b=Object.values(a.customFeatureFlags??j5);return b.length?(0,bT.jsx)(Ks,{id:"feature flags",label:"Feature flags",children:(0,bT.jsx)(Hz,{id:"feature flags",children:b.map(a=>(0,bT.jsx)(Ky,{flag:a},a.name))})}):null}function Kx({title:a="title",body:b="hello hello hello",cancel:c="Cancel",confirm:d="Continue",displayDontShowAgain:e=!1,maxWidth:f="350",onCancel:g,onContinue:h}){let[i,j]=eQ.default.useState(!1);return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(BW,{children:[(0,bT.jsx)(BX,{children:a}),(0,bT.jsx)(BY,{})]}),(0,bT.jsx)(BZ,{style:{maxWidth:f},children:b}),(0,bT.jsxs)(B$,{className:"tlui-dialog__footer__actions",children:[e&&(0,bT.jsxs)(zS,{type:"normal",onClick:()=>j(!i),style:{marginRight:"auto"},children:[(0,bT.jsx)(Kq,{checked:i}),(0,bT.jsx)(z3,{children:"Don’t show again"})]}),(0,bT.jsx)(zS,{type:"normal",onClick:g,children:(0,bT.jsx)(z3,{children:c})}),(0,bT.jsx)(zS,{type:"primary",onClick:async()=>h(),children:(0,bT.jsx)(z3,{children:d})})]})]})}let Ky=eV(function({flag:a,onChange:b}){let c=a.get();return(0,bT.jsx)(Kr,{id:a.name,title:a.name,label:a.name.replace(/([a-z0-9])([A-Z])/g,a=>`${a[0]} ${a[1].toLowerCase()}`).replace(/^[a-z]/,a=>a.toUpperCase()),checked:c,onSelect:()=>{a.set(!c),b?.(!c)}})}),Kz=0;function KA({children:a}){let b=a??(0,bT.jsx)(Ku,{});return(0,bT.jsxs)(F2,{id:"debug",children:[(0,bT.jsx)(F3,{children:(0,bT.jsx)(zS,{type:"icon",title:"Debug menu",children:(0,bT.jsx)(BV,{icon:"dots-horizontal"})})}),(0,bT.jsx)(F4,{side:"top",align:"end",alignOffset:0,children:(0,bT.jsx)(Ch,{type:"menu",sourceId:"debug-panel",children:b})})]})}let KB=(0,eQ.memo)(function(){let{DebugMenu:a}=Qa(),b=(0,eQ.useRef)(null);return qF(b),(0,bT.jsxs)("footer",{ref:b,className:"tlui-debug-panel",children:[(0,bT.jsx)(KC,{}),(0,bT.jsx)(KD,{}),a&&(0,bT.jsx)(a,{})]})}),KC=eV(function(){!function(a=!0){let[b,c]=(0,eQ.useState)(0),d=kp();(0,eQ.useEffect)(()=>{if(!a)return;let b=()=>c(a=>a+1);return d.on("tick",b),()=>{d.off("tick",b)}},[d,a])}();let a=kp(),b=a.getPath(),c=a.getHoveredShape(),d=a.getOnlySelectedShape(),e="select.idle"!==b&&b.includes("select.")?d:c,f=e&&b.includes("select.")?` / ${e.type||""}${"geo"in e.props?" / "+e.props.geo:""} / [${jA.ToInt(a.getPointInShapeSpace(e,a.inputs.currentPagePoint))}]`:"",g=b.startsWith("select.")&&!b.includes(".idle")?` / [${jA.ToInt(a.inputs.originPagePoint)}] \u2192 [${jA.ToInt(a.inputs.currentPagePoint)}] = ${jA.Dist(a.inputs.originPagePoint,a.inputs.currentPagePoint).toFixed(0)}`:"";return(0,bT.jsx)("div",{className:"tlui-debug-panel__current-state",children:`${b}${f}${g}`})});function KD(){let a=kp(),b=e$("show_fps",()=>j7.showFps.get(),[j7]),c=(0,eQ.useRef)(null);return((0,eQ.useEffect)(()=>{if(!b)return;let d=0,e=-1,f=performance.now(),g=0,h=0,i=!1;return!function b(){if(h++,(g=performance.now()-f)>250){let a=Math.round(250/g*h*4);a>d&&(d=a);let b=.75*d;(a<b&&!i||a>=b&&i)&&(i=!i),c.current.innerHTML=`FPS ${a.toString()}`,c.current.className="tlui-debug-panel__fps"+(i?" tlui-debug-panel__fps__slow":""),g-=250,h=0,f=performance.now()}e=a.timers.requestAnimationFrame(b)}(),()=>{cancelAnimationFrame(e)}},[b,a]),b)?(0,bT.jsx)("div",{ref:c}):null}function KE(){let a=kp(),b=e$("follow",()=>a.getInstanceState().followingUserId,[a]);return b?(0,bT.jsx)(KF,{userId:b}):null}function KF({userId:a}){let b=r0(a);return b?(0,bT.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:b.color}}):null}let KG=(0,eQ.memo)(function(){let a=Ce(),b=zQ(),c=(0,eQ.useRef)(null);qF(c);let{MainMenu:d,QuickActions:e,ActionsMenu:f,PageMenu:g}=Qa(),h=kp(),i=e$("isSinglePageMode",()=>h.options.maxPages<=1,[h]),j="menu"===h.options.actionShortcutsLocation||"toolbar"!==h.options.actionShortcutsLocation&&a>=Cb.TABLET;return d||g||j?(0,bT.jsx)("nav",{ref:c,className:"tlui-menu-zone",children:(0,bT.jsxs)(GQ,{children:[d&&(0,bT.jsx)(d,{}),g&&!i&&(0,bT.jsx)(g,{}),j?(0,bT.jsxs)(Hs,{orientation:"horizontal",label:b("actions-menu.title"),children:[e&&(0,bT.jsx)(e,{}),f&&(0,bT.jsx)(f,{})]}):null]})}):null});var BS=BS;let KH=({id:a,component:b,preventBackgroundClose:c})=>{let{removeDialog:d}=HC(),e=(0,eQ.useRef)(!1),f=kv(),g=(0,eQ.useCallback)(b=>{b||d(a)},[a,d]);return(0,bT.jsx)(BS.Root,{onOpenChange:g,defaultOpen:!0,children:(0,bT.jsx)(BS.Portal,{container:f,children:(0,bT.jsx)(BS.Overlay,{dir:"ltr",className:"tlui-dialog__overlay",onClick:a=>{!e.current&&(c||a.target!==a.currentTarget||g(!1))},children:(0,bT.jsx)(BS.Content,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,onMouseDown:()=>e.current=!0,onMouseUp:()=>e.current=!1,onInteractOutside:a=>{e.current=!1,c&&a.preventDefault()},children:(0,bT.jsx)(b,{onClose:()=>{e.current=!1,g(!1)}})})})})})},KI=(0,eQ.memo)(function(){let{dialogs:a}=HC();return e$("dialogs",()=>a.get(),[a]).map(a=>(0,bT.jsx)(KH,{...a},a.id))});function KJ(){let a=kp(),b=Qf(),[c,d]=(0,eQ.useState)(!1),e=(0,eQ.useRef)(!1);return(eY("toggle showback to content",()=>{let b=e.current,c=a.getCurrentPageShapeIds(),f=!1;c.size&&(f=c.size===a.getCulledShapes().size),b!==f&&(d(f),e.current=f)},[a]),c)?(0,bT.jsx)(Hy,{actionId:"back-to-content",onSelect:()=>{b["back-to-content"].onSelect("helper-buttons"),d(!1)}}):null}function KK(){let a=kp();return e$("is pen mode",()=>a.getInstanceState().isPenMode,[a])?(0,bT.jsx)(Hy,{actionId:"exit-pen-mode"}):null}function KL(){let a=kp(),b=Qf();return e$("is following user",()=>!!a.getInstanceState().followingUserId,[a])?(0,bT.jsx)(Hw,{...b["stop-following"]}):null}function KM(){return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(KK,{}),(0,bT.jsx)(KJ,{}),(0,bT.jsx)(KL,{})]})}function KN({children:a}){let b=a??(0,bT.jsx)(KM,{});return(0,bT.jsx)("div",{className:"tlui-helper-buttons",children:(0,bT.jsx)(Ch,{type:"helper-buttons",sourceId:"helper-buttons",children:b})})}var FY=FY;let KO=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function KP(){let a=kp(),b=F0(),c=e$("colorScheme",()=>a.user.getUserPreferences().colorScheme??(a.user.getIsDarkMode()?"dark":"light"),[a]);return(0,bT.jsx)(Ks,{id:"help menu color-scheme",label:"menu.theme",children:(0,bT.jsx)(Hz,{id:"theme",children:KO.map(({colorScheme:d,label:e})=>(0,bT.jsx)(Kr,{id:`color-scheme-${d}`,label:e,checked:d===c,readonlyOk:!0,onSelect:()=>{a.user.updateUserPreferences({colorScheme:d}),b("color-scheme",{source:"menu",value:d})}},d))})})}function KQ(){let a=kq(),b=F0(),c=e$("locale",()=>a?.user.getLocale(),[a]);return a?(0,bT.jsx)(Ks,{id:"help menu language",label:"menu.language",children:(0,bT.jsx)(Hz,{id:"languages",className:"tlui-language-menu",children:jo.map(({locale:d,label:e})=>(0,bT.jsx)(Kr,{id:`language-${d}`,lang:d,title:d,label:e,checked:d===c,readonlyOk:!0,onSelect:()=>{a.user.updateUserPreferences({locale:d}),b("change-language",{source:"menu",locale:d})}},d))})}):null}function KR(){let{KeyboardShortcutsDialog:a}=Qa(),{addDialog:b}=HC(),c=(0,eQ.useCallback)(()=>{a&&b({component:a})},[b,a]);return a?(0,bT.jsx)(Hw,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:c}):null}let KS=["auto","trackpad","mouse"];function KT(){let a=kp(),b=F0(),c=e$("inputMode",()=>a.user.getUserPreferences().inputMode,[a]),d=e$("wheelBehavior",()=>a.getCameraOptions().wheelBehavior,[a]);return(0,bT.jsx)(Ks,{id:"help menu input-mode",label:"menu.input-mode",children:(0,bT.jsx)(Hz,{id:"peripheral-mode",children:KS.map(e=>(0,bT.jsx)(Kr,{id:`peripheral-mode-${e}`,label:"auto"===e?`action.toggle-auto-${d}`:"trackpad"===e?"action.toggle-trackpad":"action.toggle-mouse",checked:"auto"===e?null===c:c===e,readonlyOk:!0,onSelect:()=>{switch(b("input-mode",{source:"menu",value:e}),e){case"auto":a.user.updateUserPreferences({inputMode:null});break;case"trackpad":a.user.updateUserPreferences({inputMode:"trackpad"});break;case"mouse":a.user.updateUserPreferences({inputMode:"mouse"})}}},e))})})}function KU(){return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(Hz,{id:"basic",children:[(0,bT.jsx)(KW,{}),(0,bT.jsx)(K$,{}),(0,bT.jsx)(KV,{}),(0,bT.jsx)(K_,{})]}),(0,bT.jsx)(K0,{})]})}function KV(){return(0,bT.jsxs)(Ks,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[(0,bT.jsxs)(Hz,{id:"export-all-as-group",children:[(0,bT.jsx)(Hy,{actionId:"export-all-as-svg"}),(0,bT.jsx)(Hy,{actionId:"export-all-as-png"})]}),(0,bT.jsx)(Hz,{id:"export-all-as-bg",children:(0,bT.jsx)(Qs,{})})]})}function KW(){return(0,bT.jsxs)(Ks,{id:"edit",label:"menu.edit",children:[(0,bT.jsx)(KZ,{}),(0,bT.jsx)(Qx,{}),(0,bT.jsx)(QC,{}),(0,bT.jsx)(KX,{}),(0,bT.jsx)(KY,{}),(0,bT.jsx)(Hz,{id:"select-all",children:(0,bT.jsx)(QD,{})})]})}function KX(){return(0,bT.jsxs)(Hz,{id:"misc",children:[(0,bT.jsx)(Qn,{}),(0,bT.jsx)(Qo,{}),(0,bT.jsx)(Qj,{}),(0,bT.jsx)(Qi,{}),(0,bT.jsx)(Qp,{}),(0,bT.jsx)(Qq,{}),(0,bT.jsx)(QM,{}),(0,bT.jsx)(QL,{}),(0,bT.jsx)(Ql,{})]})}function KY(){return(0,bT.jsxs)(Hz,{id:"lock",children:[(0,bT.jsx)(Qr,{}),(0,bT.jsx)(Qt,{})]})}function KZ(){let a=J5(),b=J4();return(0,bT.jsxs)(Hz,{id:"undo-redo",children:[(0,bT.jsx)(Hy,{actionId:"undo",disabled:!a}),(0,bT.jsx)(Hy,{actionId:"redo",disabled:!b})]})}function K$(){return(0,bT.jsx)(Ks,{id:"view",label:"menu.view",children:(0,bT.jsxs)(Hz,{id:"view-actions",children:[(0,bT.jsx)(Hy,{actionId:"zoom-in"}),(0,bT.jsx)(Hy,{actionId:"zoom-out"}),(0,bT.jsx)(Qu,{}),(0,bT.jsx)(Qv,{}),(0,bT.jsx)(Qw,{})]})})}function K_(){return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Hy,{actionId:"insert-embed"}),(0,bT.jsx)(Hy,{actionId:"insert-media"})]})}function K0(){return(0,bT.jsxs)(Hz,{id:"preferences",children:[(0,bT.jsxs)(Ks,{id:"preferences",label:"menu.preferences",children:[(0,bT.jsxs)(Hz,{id:"preferences-actions",children:[(0,bT.jsx)(QN,{}),(0,bT.jsx)(QO,{}),(0,bT.jsx)(QP,{}),(0,bT.jsx)(QQ,{}),(0,bT.jsx)(QR,{}),(0,bT.jsx)(QS,{}),(0,bT.jsx)(QX,{}),(0,bT.jsx)(QY,{}),(0,bT.jsx)(QW,{})]}),(0,bT.jsxs)(Hz,{id:"user-interface-submenus",children:[(0,bT.jsx)(KT,{}),(0,bT.jsx)(KP,{}),(0,bT.jsx)(Q$,{})]})]}),(0,bT.jsx)(KQ,{}),(0,bT.jsx)(KR,{})]})}let K1=(0,eQ.memo)(function({children:a}){let b=kv(),[c,d]=F1("main menu"),e=zQ(),f=a??(0,bT.jsx)(KU,{});return(0,bT.jsxs)(FY.Root,{dir:"ltr",open:c,onOpenChange:d,modal:!1,children:[(0,bT.jsx)(FY.Trigger,{asChild:!0,dir:"ltr",children:(0,bT.jsx)(zS,{type:"icon","data-testid":"main-menu.button",title:e("menu.title"),children:(0,bT.jsx)(BV,{icon:"menu",small:!0})})}),(0,bT.jsx)(FY.Portal,{container:b,children:(0,bT.jsx)(FY.Content,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:(0,bT.jsx)(Ch,{type:"menu",sourceId:"main-menu",children:f})})})]})}),K2={};function K3(a){if(K2[a])return K2[a];let b=document.createElement("canvas").getContext("2d");b.fillStyle=a,b.fillRect(0,0,1,1);let[c,d,e,f]=b.getImageData(0,0,1,1).data,g=new Float32Array([c/255,d/255,e/255,f/255]);return K2[a]=g,g}function K4(a,{center:b,radius:c,numArcSegments:d=20,startAngle:e=0,endAngle:f=jG,offset:g=0}){let h=(f-e)/d,i=g;for(let d=e;d<f;d+=h)a[i++]=b.x,a[i++]=b.y,a[i++]=b.x+Math.cos(d)*c,a[i++]=b.y+Math.sin(d)*c,a[i++]=b.x+Math.cos(d+h)*c,a[i++]=b.y+Math.sin(d+h)*c;return a}function K5(a,b,c,d,e,f){a[b++]=c,a[b++]=d,a[b++]=c,a[b++]=d+f,a[b++]=c+e,a[b++]=d,a[b++]=c+e,a[b++]=d,a[b++]=c,a[b++]=d+f,a[b++]=c+e,a[b++]=d+f}function K6(a,b){let c=a.createBuffer();if(!c)throw Error("Failed to create buffer");return{buffer:c,vertices:new Float32Array(b)}}function K7(a,b,c){let d=a.vertices.length;for(;d<b+c.length;)d*=2;if(d!=a.vertices.length){let b=new Float32Array(d);b.set(a.vertices),a.vertices=b}a.vertices.set(c,b)}var K8=Object.create,K9=Object.defineProperty,La=Object.getOwnPropertyDescriptor,Lb=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),Lc=a=>{throw TypeError(a)},Ld=(a,b,c)=>b in a?K9(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,Le=(a,b)=>K9(a,"name",{value:b,configurable:!0}),Lf=["class","method","getter","setter","accessor","field","value","get","set"],Lg=a=>void 0!==a&&"function"!=typeof a?Lc("Function expected"):a,Lh=(a,b,c,d,e)=>({kind:Lf[a],name:b,metadata:d,addInitializer:a=>c._?Lc("Already initialized"):e.push(Lg(a||null))}),Li=(a,b)=>Ld(b,Lb("metadata"),a[3]),Lj=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=Lf[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&La(l<4?e:{get[c](){return Ln(this,f)},set[c](x){return Lo(this,f,x)}},c));l?n&&l<4&&Le(f,(l>2?"set ":l>1?"get ":"")+c):Le(e,c);for(var t=d.length-1;t>=0;t--)j=Lh(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>Lm(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?Ln:Lp)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>Lo(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?Lg(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?Lc("Object expected"):(Lg(g=h.get)&&(s.get=g),Lg(g=h.set)&&(s.set=g),Lg(g=h.init)&&q.unshift(g));return l||Li(a,e),s&&K9(e,c,s),n?4^l?f:s:e},Lk=(a,b,c)=>Ld(a,"symbol"!=typeof b?b+"":b,c),Ll=(a,b,c)=>b.has(a)||Lc("Cannot "+c),Lm=(a,b)=>Object(b)!==b?Lc('Cannot use the "in" operator on this value'):a.has(b),Ln=(a,b,c)=>(Ll(a,b,"read from private field"),c?c.call(a):b.get(a)),Lo=(a,b,c,d)=>(Ll(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),Lp=(a,b,c)=>(Ll(a,b,"access private method"),c);bM=[ck],bL=[eB],bK=[eB],bJ=[eB],bI=[eB],bH=[eB],bG=[eB],bF=[eB],bE=[eB],bD=[ck];class Lq{constructor(a,b,c){this.editor=a,this.elem=b,this.container=c,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(bN,5,this),Lk(this,"disposables",[]),Lk(this,"gl"),Lk(this,"shapeGeometryCache"),Lk(this,"colors"),Lk(this,"id",cA(void 0)),Lk(this,"canvasBoundingClientRect",eM("canvasBoundingClientRect",new lh)),Lk(this,"originPagePoint",new jA),Lk(this,"originPageCenter",new jA),Lk(this,"isInViewport",!1),this.gl=function(a){if(!a)throw Error("Canvas element not found");let b=a.getContext("webgl2",{premultipliedAlpha:!1});if(!b)throw Error("Failed to get webgl2 context");let c=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,d=b.createShader(b.VERTEX_SHADER);if(!d)throw Error("Failed to create vertex shader");if(b.shaderSource(d,c),b.compileShader(d),!b.getShaderParameter(d,b.COMPILE_STATUS))throw Error("Failed to compile vertex shader");let e=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,f=b.createShader(b.FRAGMENT_SHADER);if(!f)throw Error("Failed to create fragment shader");if(b.shaderSource(f,e),b.compileShader(f),!b.getShaderParameter(f,b.COMPILE_STATUS))throw Error("Failed to compile fragment shader");let g=b.createProgram();if(!g)throw Error("Failed to create program");if(b.attachShader(g,d),b.attachShader(g,f),b.linkProgram(g),!b.getProgramParameter(g,b.LINK_STATUS))throw Error("Failed to link program");b.useProgram(g);let h=b.getAttribLocation(g,"shapeVertexPosition");if(h<0)throw Error("Failed to get shapeVertexPosition attribute location");b.enableVertexAttribArray(h);let i=b.getUniformLocation(g,"canvasPageBounds"),j=b.getUniformLocation(g,"fillColor");if(!b.createBuffer()||!b.createBuffer())throw Error("Failed to create buffer");return{context:b,selectedShapes:K6(b,1024),unselectedShapes:K6(b,4096),viewport:K6(b,300),collaborators:K6(b,1024),prepareTriangles(a,c){b.bindBuffer(b.ARRAY_BUFFER,a.buffer),b.bufferData(b.ARRAY_BUFFER,a.vertices,b.STATIC_DRAW,0,c),b.enableVertexAttribArray(h),b.vertexAttribPointer(h,2,b.FLOAT,!1,0,0)},drawTrianglesTransparently(a){b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),b.drawArrays(b.TRIANGLES,0,a/2),b.disable(b.BLEND)},drawTriangles(a){b.drawArrays(b.TRIANGLES,0,a/2)},setFillColor(a){b.uniform4fv(j,a)},setCanvasPageBounds(a){b.uniform4fv(i,a)}}}(b),this.shapeGeometryCache=a.store.createComputedCache("webgl-geometry",b=>{let c=a.getShapeMaskedPageBounds(b.id);if(!c)return null;let d=new Float32Array(12);return K5(d,0,c.x,c.y,c.w,c.h),d}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),eg("minimap render",this.render))}close(){return this.disposables.forEach(a=>a())}_getColors(){let a=getComputedStyle(this.editor.getContainer());return{shapeFill:K3(a.getPropertyValue("--tl-color-text-3").trim()),selectFill:K3(a.getPropertyValue("--tl-color-selected").trim()),viewportFill:K3(a.getPropertyValue("--tl-color-muted-1").trim()),background:K3(a.getPropertyValue("--tl-color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){let a=this.editor.getViewportPageBounds(),b=this.editor.getCurrentPageBounds();return b?lh.Expand(b,a):a}getContentScreenBounds(){let a=this.getContentPageBounds(),b=this.editor.pageToScreen(a.point),c=this.editor.pageToScreen(new jA(a.maxX,a.maxY));return new lh(b.x,b.y,c.x-b.x,c.y-b.y)}_getCanvasBoundingRect(){let{x:a,y:b,width:c,height:d}=this.elem.getBoundingClientRect();return new lh(a,b,c,d)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){let a=new ResizeObserver(()=>{let a=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(a)});return a.observe(this.elem),a.observe(this.container),()=>a.disconnect()}getCanvasSize(){let a=this.canvasBoundingClientRect.get(),b=this.getDpr();return new jA(a.width*b,a.height*b)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){let a=this.getCanvasScreenBounds(),b=this.getContentPageBounds(),c=a.width/a.height,d=b.width,e=d/c;e<b.height&&(d=(e=b.height)*c);let f=new lh(0,0,d,e);return f.center=b.center,f}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){let{x:a,y:b,w:c,h:d}=this.getCanvasPageBounds();return new Float32Array([a,b,c,d])}getMinimapPagePoint(a,b){let c=this.getCanvasPageBounds(),d=this.getCanvasScreenBounds(),e=a-d.x,f=b-d.y;return e*=c.width/d.width,f*=c.height/d.height,new jA(e+=c.minX,f+=c.minY,1)}minimapScreenPointToPagePoint(a,b,c=!1,d=!1){let{editor:e}=this,f=e.getViewportPageBounds(),{x:g,y:h}=this.getMinimapPagePoint(a,b);if(d){let a=this.editor.getCurrentPageBounds()??new lh,b=a.minX-f.width/2,c=a.maxX+f.width/2,d=a.minY-f.height/2,e=a.maxY+f.height/2,i=Math.max(0,b+f.width-g),j=Math.max(0,-(c-f.width-g)),k=Math.max(0,d+f.height-h),l=Math.max(0,-(e-f.height-h));g+=(i-j)/2,h+=(k-l)/2,g=jI(g,b,c),h=jI(h,d,e)}if(c){let{originPagePoint:a}=this;Math.abs(g-a.x)>Math.abs(h-a.y)?h=a.y:g=a.x}return new jA(g,h)}render(){let a=this.gl.context,b=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=b.x,this.elem.height=b.y,a.viewport(0,0,b.x,b.y),a.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),a.clear(a.COLOR_BUFFER_BIT);let c=new Set(this.editor.getSelectedShapeIds()),d=this.colors,e=0,f=0,g=this.editor.getCurrentPageShapeIdsSorted();for(let a=0,b=g.length;a<b;a++){let b=g[a],d=this.shapeGeometryCache.get(b);if(!d)continue;let h=d.length,i=this.editor.getShape(b);if(i){let a=this.editor.getShapeUtil(i.type);if(a.hideInMinimap?.(i))continue}c.has(b)?(K7(this.gl.selectedShapes,e,d),e+=h):(K7(this.gl.unselectedShapes,f,d),f+=h)}this.drawShapes(this.gl.unselectedShapes,f,d.shapeFill),this.drawShapes(this.gl.selectedShapes,e,d.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(a,b,c){this.gl.prepareTriangles(a,b),this.gl.setFillColor(c),this.gl.drawTriangles(b)}drawViewport(){let a=this.editor.getViewportPageBounds(),b=function(a,b,c){c=Math.min(c,Math.min(b.w,b.h)/2);let d=lh.ExpandBy(b,-c);if(d.w<=0||d.h<=0)return K4(a,{center:b.center,radius:c,numArcSegments:40}),240;let e=0;return K5(a,0,d.minX,d.minY,d.w,d.h),K5(a,e+=12,d.minX,b.minY,d.w,c),K5(a,e+=12,d.maxX,d.minY,c,d.h),K5(a,e+=12,d.minX,d.maxY,d.w,c),K5(a,e+=12,b.minX,d.minY,c,d.h),K4(a,{numArcSegments:10,offset:e+=12,center:d.point,radius:c,startAngle:jE,endAngle:1.5*jE}),K4(a,{numArcSegments:10,offset:e+=60,center:jA.Add(d.point,new jA(d.w,0)),radius:c,startAngle:1.5*jE,endAngle:jG}),K4(a,{numArcSegments:10,offset:e+=60,center:jA.Add(d.point,d.size),radius:c,startAngle:0,endAngle:jF}),K4(a,{numArcSegments:10,offset:e+=60,center:jA.Add(d.point,new jA(0,d.h)),radius:c,startAngle:jF,endAngle:jE}),300}(this.gl.viewport.vertices,a,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,b),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(b)}drawCollaborators(){let a=this.editor.getCollaboratorsOnCurrentPage();if(!a.length)return;let b=120*a.length;this.gl.collaborators.vertices.length<b&&(this.gl.collaborators.vertices=new Float32Array(b));let c=this.gl.collaborators.vertices,d=0,e=this.getZoom();for(let{cursor:b}of a)b&&(K4(c,{center:jA.From(b),radius:3*e,offset:d,numArcSegments:20}),d+=120);for(let{color:c}of(this.gl.prepareTriangles(this.gl.collaborators,b),d=0,a))this.gl.setFillColor(K3(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,d/2,60),d+=120}}function Lr(){let a=kp(),b=kv(),c=zQ(),d=eQ.useRef(null),e=eQ.useRef(!1),f=eQ.useRef();eQ.useEffect(()=>{try{return f.current=new Lq(a,d.current,b),f.current.close}catch(b){a.annotateError(b,{origin:"minimap",willCrashApp:!1}),a.timers.setTimeout(()=>{throw b})}},[a,b]);let g=eQ.useCallback(b=>{if(!a.getCurrentPageShapeIds().size||!f.current)return;let c=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,!1,!1),d=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,!1,!0);f.current.originPagePoint.setTo(d),f.current.originPageCenter.setTo(a.getViewportPageBounds().center),a.centerOnPoint(c,{animation:{duration:a.options.animationMediumMs}})},[a]),h=eQ.useCallback(b=>{if(!f.current)return;let c=b.currentTarget;if(kc(c,b),!a.getCurrentPageShapeIds().size)return;e.current=!0,f.current.isInViewport=!1;let d=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,!1,!1),g=a.getViewportPageBounds(),h=f.current.getContentPageBounds();if(new lh(h.x-g.width/2,h.y-g.height/2,h.width+g.width,h.height+g.height).containsPoint(d)&&!g.containsPoint(d)){f.current.isInViewport=g.containsPoint(d);let b=jA.Sub(g.center,g.point),c=jA.Add(d,b);f.current.originPagePoint.setTo(c),f.current.originPageCenter.setTo(d),a.centerOnPoint(d,{animation:{duration:a.options.animationMediumMs}})}else{let a=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,!1,!0);f.current.isInViewport=g.containsPoint(a),f.current.originPagePoint.setTo(a),f.current.originPageCenter.setTo(g.center)}document.body.addEventListener("pointerup",function a(b){c&&kd(c,b),e.current=!1,document.body.removeEventListener("pointerup",a)})},[a]),i=eQ.useCallback(b=>{if(!f.current)return;let c=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,b.shiftKey,!0);if(e.current){if(f.current.isInViewport){let b=f.current.originPagePoint.clone().sub(f.current.originPageCenter);a.centerOnPoint(jA.Sub(c,b));return}a.centerOnPoint(c)}let d=f.current.getMinimapPagePoint(b.clientX,b.clientY),g=a.pageToScreen(d),h={type:"pointer",target:"canvas",name:"pointer_move",...kh(a,b),point:g,isPen:a.getInstanceState().isPenMode};a.dispatch(h)},[a]),j=eQ.useCallback(b=>{let c=rV(b);a.dispatch({type:"wheel",name:"wheel",delta:c,point:new jA(b.clientX,b.clientY),shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:kg(b)})},[a]),k=pR();return eQ.useEffect(()=>{a.timers.setTimeout(()=>{f.current?.updateColors(),f.current?.render()})},[k,a]),(0,bT.jsx)("div",{className:"tlui-minimap",children:(0,bT.jsx)("canvas",{role:"img","aria-label":c("navigation-zone.minimap"),"data-testid":"minimap.canvas",ref:d,className:"tlui-minimap__canvas",onDoubleClick:g,onPointerMove:i,onPointerDown:h,onWheelCapture:j})})}Lj(bN=[,,,K8((void 0)??null)],1,"close",bM,Lq),Lj(bN,1,"getDpr",bL,Lq),Lj(bN,1,"getContentPageBounds",bK,Lq),Lj(bN,1,"getContentScreenBounds",bJ,Lq),Lj(bN,1,"getCanvasSize",bI,Lq),Lj(bN,1,"getCanvasClientPosition",bH,Lq),Lj(bN,1,"getCanvasPageBounds",bG,Lq),Lj(bN,1,"getZoom",bF,Lq),Lj(bN,1,"getCanvasPageBoundsArray",bE,Lq),Lj(bN,1,"render",bD,Lq),Li(bN,Lq);let Ls=(0,eQ.memo)(function(){let a=Qf(),b=zQ(),c=Ce(),d=(0,eQ.useRef)(null);qF(d);let[e,f]=function(a,b){let[c,d]=eQ.default.useState(b);return eQ.default.useLayoutEffect(()=>{let b=dD(a);if(b)try{d(JSON.parse(b))}catch{console.error(`Could not restore value ${a} from local storage.`)}},[a]),[c,eQ.default.useCallback(b=>{d(c=>{let d="function"==typeof b?b(c):b;return dE(a,JSON.stringify(d)),d})},[a])]}("minimap",!0),g=(0,eQ.useCallback)(()=>{f(a=>!a)},[f]),{ZoomMenu:h,Minimap:i}=Qa();return c<Cb.MOBILE?null:(0,bT.jsxs)("div",{ref:d,className:"tlui-navigation-panel",children:[(0,bT.jsx)(Hs,{orientation:"horizontal",label:b("navigation-zone.title"),children:h&&c<Cb.TABLET?(0,bT.jsx)(h,{}):(0,bT.jsxs)(bT.Fragment,{children:[!e&&(0,bT.jsx)(Ht,{type:"icon","data-testid":"minimap.zoom-out",title:`${b(Qg(a["zoom-out"].label))} ${Fy(a["zoom-out"].kbd)}`,onClick:()=>a["zoom-out"].onSelect("navigation-zone"),children:(0,bT.jsx)(BV,{small:!0,icon:"minus"})}),h&&(0,bT.jsx)(h,{},"zoom-menu"),!e&&(0,bT.jsx)(Ht,{type:"icon","data-testid":"minimap.zoom-in",title:`${b(Qg(a["zoom-in"].label))} ${Fy(a["zoom-in"].kbd)}`,onClick:()=>a["zoom-in"].onSelect("navigation-zone"),children:(0,bT.jsx)(BV,{small:!0,icon:"plus"})}),i&&(0,bT.jsx)(Ht,{type:"icon","data-testid":"minimap.toggle-button",title:b("navigation-zone.toggle-minimap"),onClick:g,children:(0,bT.jsx)(BV,{small:!0,icon:e?"chevron-right":"chevron-left"})})]})}),i&&c>=Cb.TABLET&&!e&&(0,bT.jsx)(i,{})]})}),Lt=function({name:a,id:b,isCurrentPage:c,onCancel:d,onComplete:e}){let f=kp(),g=F0(),h=(0,eQ.useRef)(null),i=(0,eQ.useRef)(null),j=(0,eQ.useCallback)(()=>{i.current=f.markHistoryStoppingPoint("rename page")},[f]),k=(0,eQ.useCallback)(a=>{f.renamePage(b,a||"New Page"),g("rename-page",{source:"page-menu"})},[f,b,g]),l=(0,eQ.useCallback)(()=>{i.current&&f.bailToMark(i.current),d()},[f,d]);return(0,bT.jsx)(B_,{className:"tlui-page-menu__item__input",ref:a=>h.current=a,defaultValue:a,onValueChange:k,onComplete:e,onCancel:l,onFocus:j,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:c,autoSelect:!0})},Lu=(a,b,c,d,e)=>{let f,g=a.getPages(),h=c>d?g[d-1]:g[d],i=c>d?g[d]:g[d+1];(f=h&&!i?dw(h.index):!h&&i?dx(g[0].index):dv(h.index,i.index))!==g[c].index&&(a.markHistoryStoppingPoint("moving page"),a.updatePage({id:b,index:f}),e("move-page",{source:"page-menu"}))},Lv=eV(function({index:a,listSize:b,item:c,onRename:d}){let e=kp(),f=zQ(),g=e.getPages(),h=F0(),i=(0,eQ.useCallback)(()=>{e.markHistoryStoppingPoint("creating page");let a=hU.createId();e.duplicatePage(c.id,a),h("duplicate-page",{source:"page-menu"})},[e,c,h]),j=(0,eQ.useCallback)(()=>{Lu(e,c.id,a,a-1,h)},[e,c,a,h]),k=(0,eQ.useCallback)(()=>{Lu(e,c.id,a,a+1,h)},[e,c,a,h]),l=(0,eQ.useCallback)(()=>{e.markHistoryStoppingPoint("deleting page"),e.deletePage(c.id),h("delete-page",{source:"page-menu"})},[e,c,h]);return(0,bT.jsxs)(F2,{id:`page item submenu ${a}`,children:[(0,bT.jsx)(F3,{children:(0,bT.jsx)(zS,{type:"icon",title:f("page-menu.submenu.title"),children:(0,bT.jsx)(BV,{icon:"dots-vertical",small:!0})})}),(0,bT.jsx)(F4,{alignOffset:0,side:"right",sideOffset:-4,children:(0,bT.jsxs)(Ch,{type:"menu",sourceId:"page-menu",children:[(0,bT.jsxs)(Hz,{id:"modify",children:[d&&(0,bT.jsx)(Hw,{id:"rename",label:"page-menu.submenu.rename",onSelect:d}),(0,bT.jsx)(Hw,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:i,disabled:g.length>=e.options.maxPages}),a>0&&(0,bT.jsx)(Hw,{id:"move-up",onSelect:j,label:"page-menu.submenu.move-up"}),a<b-1&&(0,bT.jsx)(Hw,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:k})]}),b>1&&(0,bT.jsx)(Hz,{id:"delete",children:(0,bT.jsx)(Hw,{id:"delete",onSelect:l,label:"page-menu.submenu.delete"})})]})})]})}),Lw=(0,eQ.memo)(function(){let a=kp(),b=F0(),c=zQ(),d=Ce(),[e,f]=F1("page-menu",(0,eQ.useCallback)(()=>o(!1),[])),g=(0,eQ.useRef)(null),h=e$("pages",()=>a.getPages(),[a]),i=e$("currentPage",()=>a.getCurrentPage(),[a]),j=e$("currentPageId",()=>a.getCurrentPageId(),[a]),k=Ft(),l=e$("maxPageCountReached",()=>a.getPages().length>=a.options.maxPages,[a]),m=e$("isCoarsePointer",()=>a.getInstanceState().isCoarsePointer,[a]),[n,o]=(0,eQ.useState)(!1);(0,eQ.useEffect)(function(){function b(){n||document.activeElement===document.body&&a.menus.clearOpenMenus()}return document.addEventListener("keydown",b,{passive:!0}),()=>{document.removeEventListener("keydown",b)}},[a,n]);let p=(0,eQ.useCallback)(()=>{k||o(a=>!a)},[k]),q=(0,eQ.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[r,s]=(0,eQ.useState)(Object.fromEntries(h.map((a,b)=>[a.id,{y:36*b,offsetY:0,isSelected:!1}])));(0,eQ.useLayoutEffect)(()=>{s(Object.fromEntries(h.map((a,b)=>[a.id,{y:36*b,offsetY:0,isSelected:!1}])))},[36,h]),(0,eQ.useEffect)(()=>{e&&a.timers.requestAnimationFrame(()=>{let a=document.querySelector(`[data-pageid="${j}"]`);if(a){a.querySelector("button")?.focus();let b=g.current;if(!b)return;let c=a.offsetTop;c<b.scrollTop&&b.scrollTo({top:c});let d=c+36;d>b.scrollTop+b.offsetHeight&&b.scrollTo({top:d-b.offsetHeight})}})},[36,j,e,a]);let t=(0,eQ.useCallback)(a=>{let{clientY:b,currentTarget:c}=a,{dataset:{id:d,index:e}}=c;if(!d||!e)return;let f=q.current;kc(a.currentTarget,a),f.status="pointing",f.pointing={id:d,index:+e};let g=r[d].y;f.startY=b,f.startIndex=Math.max(0,Math.min(Math.round(g/36),h.length-1))},[36,h.length,r]),u=(0,eQ.useCallback)(a=>{let b=q.current;if("pointing"===b.status){let{clientY:c}=a;Math.abs(c-b.startY)>5&&(b.status="dragging")}if("dragging"===b.status){let{clientY:c}=a,d=c-b.startY,e=r[b.pointing.id],{startIndex:f,pointing:g}=b,i=Math.max(0,Math.min(Math.round((e.y+d)/36),h.length-1)),j={...r};if(j[g.id]={y:e.y,offsetY:d,isSelected:!0},i!==b.dragIndex){b.dragIndex=i;for(let a=0;a<h.length;a++){let c=h[a];if(c.id===b.pointing.id)continue;let{y:d}=j[c.id];i===f?d=36*a:i<f?d=i<=a&&a<f?(a+1)*36:36*a:i>f&&(d=i>=a&&a>f?(a-1)*36:36*a),d!==j[c.id].y&&(j[c.id]={y:d,offsetY:0,isSelected:!0})}}s(j)}},[36,h,r]),v=(0,eQ.useCallback)(c=>{let d=q.current;if("dragging"===d.status){let{id:c,index:e}=d.pointing;Lu(a,c,e,d.dragIndex,b)}kd(c.currentTarget,c),d.status="idle"},[a,b]),w=(0,eQ.useCallback)(a=>{let b=q.current;"Escape"===a.key&&("dragging"===b.status&&s(Object.fromEntries(h.map((a,b)=>[a.id,{y:36*b,offsetY:0,isSelected:!1}]))),b.status="idle")},[36,h]),y=(0,eQ.useCallback)(()=>{k||(a.run(()=>{a.markHistoryStoppingPoint("creating page");let b=hU.createId();a.createPage({name:c("page-menu.new-page-initial-name"),id:b}),a.setCurrentPage(b),o(!0),a.timers.requestAnimationFrame(()=>{let a=document.querySelector(`[data-pageid="${b}"]`);a&&a.querySelector("button")?.focus()})}),b("new-page",{source:"page-menu"}))},[a,c,k,b]),z=(0,eQ.useCallback)(c=>{a.setCurrentPage(c),b("change-page",{source:"page-menu"})},[a,b]),A=(0,eQ.useCallback)((c,d)=>{a.renamePage(c,d),b("rename-page",{source:"page-menu"})},[a,b]),B=d<Cb.TABLET_SM&&m;return(0,bT.jsxs)(I5,{id:"pages",onOpenChange:f,open:e,children:[(0,bT.jsx)(I6,{"data-testid":"main.page-menu",children:(0,bT.jsxs)(zS,{type:"menu",title:i.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[(0,bT.jsx)("div",{className:"tlui-page-menu__name",children:i.name}),(0,bT.jsx)(BV,{icon:"chevron-down",small:!0})]})}),(0,bT.jsx)(I7,{side:"bottom",align:"start",sideOffset:0,disableEscapeKeyDown:n,children:(0,bT.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,bT.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,bT.jsx)("div",{className:"tlui-page-menu__header__title",children:c("page-menu.title")}),!k&&(0,bT.jsxs)(GQ,{children:[(0,bT.jsx)(zS,{type:"icon","data-testid":"page-menu.edit",title:c(n?"page-menu.edit-done":"page-menu.edit-start"),onClick:p,children:(0,bT.jsx)(BV,{icon:n?"check":"edit"})}),(0,bT.jsx)(zS,{type:"icon","data-testid":"page-menu.create",title:c(l?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:l,onClick:y,children:(0,bT.jsx)(BV,{icon:"plus"})})]})]}),(0,bT.jsx)("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:36*h.length+4},ref:g,children:h.map((b,d)=>{let e=r[b.id]??{position:40*d,offsetY:0};return n?(0,bT.jsxs)("div",{"data-testid":"page-menu.item","data-pageid":b.id,className:"tlui-page_menu__item__sortable",style:{zIndex:b.id===i.id?888:d,transform:`translate(0px, ${e.y+e.offsetY}px)`},children:[(0,bT.jsx)(zS,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:t,onPointerUp:v,onPointerMove:u,onKeyDown:w,"data-id":b.id,"data-index":d,children:(0,bT.jsx)(BV,{icon:"drag-handle-dots"})}),B?(0,bT.jsxs)(zS,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{let a=window.prompt(c("action.rename"),b.name);a&&a!==b.name&&A(b.id,a)},onDoubleClick:p,children:[(0,bT.jsx)(Kq,{checked:b.id===i.id}),(0,bT.jsx)(z3,{children:b.name})]}):(0,bT.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:36},children:(0,bT.jsx)(Lt,{id:b.id,name:b.name,isCurrentPage:b.id===i.id,onComplete:()=>{o(!1)},onCancel:()=>{o(!1)}})}),!k&&(0,bT.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":n,children:(0,bT.jsx)(Lv,{index:d,item:b,listSize:h.length})})]},b.id+"_editing"):(0,bT.jsxs)("div",{"data-pageid":b.id,"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[(0,bT.jsxs)(zS,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>z(b.id),onDoubleClick:p,title:c("page-menu.go-to-page"),onKeyDown:c=>{"Enter"===c.key&&b.id===i.id&&(p(),a.markEventAsHandled(c))},children:[(0,bT.jsx)(Kq,{checked:b.id===i.id}),(0,bT.jsx)(z3,{children:b.name})]}),!k&&(0,bT.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,bT.jsx)(Lv,{index:d,item:b,listSize:h.length,onRename:()=>{if(B){let a=window.prompt(c("action.rename"),b.name);a&&a!==b.name&&A(b.id,a)}else o(!0),j!==b.id&&z(b.id)}})})]},b.id)})})]})})]})});function Lx(){let a=kp(),b=Ft(),c=e$("should display quick actions",()=>a.isInAny("select","hand","zoom"),[a]);if(!b||c)return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Lz,{}),(0,bT.jsx)(Ly,{})]})}function Ly(){let a=J2(1),b=J$(),c=a&&b;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Hy,{actionId:"delete",disabled:!c}),(0,bT.jsx)(Hy,{actionId:"duplicate",disabled:!c})]})}function Lz(){let a=J5(),b=J4();return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Hy,{actionId:"undo",disabled:!a}),(0,bT.jsx)(Hy,{actionId:"redo",disabled:!b})]})}let LA=(0,eQ.memo)(function({children:a}){let b=a??(0,bT.jsx)(Lx,{});return(0,bT.jsx)(Ch,{type:"small-icons",sourceId:"quick-actions",children:b})});var I4=I4;function LB({userId:a}){let b=r0(a);return b?(0,bT.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:b.color},children:b.userName?.[0]??""},a):null}let LC=eV(function({userId:a}){let b=kp(),c=zQ(),d=F0(),e=r0(a),f=(0,eQ.useCallback)(()=>{b.getInstanceState().followingUserId===a?(b.stopFollowingUser(),d("stop-following",{source:"people-menu"})):(b.startFollowingUser(a),d("start-following",{source:"people-menu"}))},[b,a,d]),g=e?.followingUserId===b.user.getId(),h=b.getInstanceState().followingUserId===a;return e?(0,bT.jsxs)(GQ,{className:"tlui-people-menu__item","data-follow":h||g,children:[(0,bT.jsxs)(zS,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>b.zoomToUser(a),onDoubleClick:f,children:[(0,bT.jsx)(BT,{label:c("people-menu.avatar-color"),icon:"color",color:e.color}),(0,bT.jsx)("div",{className:"tlui-people-menu__name",children:e.userName?.trim()||c("people-menu.anonymous-user")})]}),(0,bT.jsx)(zS,{type:"icon",className:"tlui-people-menu__item__follow",title:c(g?"people-menu.leading":h?"people-menu.following":"people-menu.follow"),onClick:f,disabled:g,children:(0,bT.jsx)(BV,{icon:g?"leading":h?"following":"follow"})})]}):null});function LD({count:a}){return(0,bT.jsx)("div",{className:"tlui-people-menu__avatar tlui-people-menu__more",children:Math.abs(a)})}var I4=I4;let LE=eV(function(){let a=kp(),b=kv(),c=zQ(),d=F0(),e=(0,eQ.useRef)(!1),[f,g]=(0,eQ.useState)(!1),h=(0,eQ.useCallback)(a=>{g(a)},[]),i=a.user.getColor(),j=(0,eQ.useCallback)(b=>{a.user.updateUserPreferences({color:b}),d("set-color",{source:"people-menu"})},[a,d]),{handleButtonClick:k,handleButtonPointerDown:l,handleButtonPointerEnter:m,handleButtonPointerUp:n}=eQ.default.useMemo(()=>{let a=()=>{e.current=!1,window.removeEventListener("pointerup",a)};return{handleButtonClick:a=>{let{id:b}=a.currentTarget.dataset;b&&i!==b&&j(b)},handleButtonPointerDown:b=>{let{id:c}=b.currentTarget.dataset;c&&(j(c),e.current=!0,window.addEventListener("pointerup",a))},handleButtonPointerEnter:a=>{if(!e.current)return;let{id:b}=a.currentTarget.dataset;b&&j(b)},handleButtonPointerUp:a=>{let{id:b}=a.currentTarget.dataset;b&&j(b)}}},[i,j]);return(0,bT.jsxs)(I4.Root,{onOpenChange:h,open:f,children:[(0,bT.jsx)(I4.Trigger,{dir:"ltr",asChild:!0,children:(0,bT.jsx)(zS,{type:"icon",className:"tlui-people-menu__user__color",style:{color:a.user.getColor()},title:c("people-menu.change-color"),children:(0,bT.jsx)(BV,{icon:"color"})})}),(0,bT.jsx)(I4.Portal,{container:b,children:(0,bT.jsx)(I4.Content,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:(0,bT.jsx)(GS,{children:kR.map(a=>(0,bT.jsx)(zS,{type:"icon","data-id":a,"data-testid":a,"aria-label":a,isActive:i===a,title:a,style:{color:a},onPointerEnter:m,onPointerDown:l,onPointerUp:n,onClick:k,children:(0,bT.jsx)(BV,{icon:"color"})},a))})})})]})});function LF(){let a=kp(),b=F0(),c=e$("userName",()=>a.user.getName(),[]),d=zQ(),e=(0,eQ.useRef)(c),f=(0,eQ.useRef)(c),[g,h]=(0,eQ.useState)(!1),i=(0,eQ.useCallback)(()=>{h(a=>!a)},[]),j=(0,eQ.useCallback)(b=>{f.current=b,a.user.updateUserPreferences({name:b})},[a]),k=(0,eQ.useCallback)(()=>{e.current!==f.current&&(b("change-user-name",{source:"people-menu"}),e.current=f.current)},[b]),l=(0,eQ.useCallback)(()=>{h(!1),a.user.updateUserPreferences({name:e.current}),a.menus.clearOpenMenus()},[a]);return(0,bT.jsxs)("div",{className:"tlui-people-menu__user",children:[(0,bT.jsx)(LE,{}),g?(0,bT.jsx)(B_,{className:"tlui-people-menu__user__input",defaultValue:c,onValueChange:j,onComplete:i,onCancel:l,onBlur:k,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{g||h(!0)},children:c||d("people-menu.anonymous-user")}),c?null:(0,bT.jsx)("div",{className:"tlui-people-menu__user__label",children:d("people-menu.user")})]}),(0,bT.jsx)(zS,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:d("people-menu.change-name"),onClick:i,children:(0,bT.jsx)(BV,{icon:g?"check":"edit"})})]})}function LG({children:a}){let b=zQ(),c=kv(),d=kp(),e=r_(),f=e$("user",()=>d.user.getColor(),[d]),g=e$("user",()=>d.user.getName(),[d]),[h,i]=F1("people menu"),j=Ce()<=Cb.MOBILE_XS?1:5;return e.length?(0,bT.jsxs)(I4.Root,{onOpenChange:i,open:h,children:[(0,bT.jsx)(I4.Trigger,{dir:"ltr",asChild:!0,children:(0,bT.jsx)("button",{className:"tlui-people-menu__avatars-button",title:b("people-menu.title"),children:(0,bT.jsxs)("div",{className:"tlui-people-menu__avatars",children:[e.slice(-j).map(a=>(0,bT.jsx)(LB,{userId:a},a)),e.length>0&&(0,bT.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:f},children:g?.[0]??""}),e.length>j&&(0,bT.jsx)(LD,{count:e.length-j})]})})}),(0,bT.jsx)(I4.Portal,{container:c,children:(0,bT.jsx)(I4.Content,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,children:(0,bT.jsxs)("div",{className:"tlui-people-menu__wrapper",children:[(0,bT.jsx)("div",{className:"tlui-people-menu__section",children:(0,bT.jsx)(LF,{})}),e.length>0&&(0,bT.jsx)("div",{className:"tlui-people-menu__section",children:e.map(a=>(0,bT.jsx)(LC,{userId:a},a+"_presence"))}),a]})})})]}):null}function LH(){return(0,bT.jsx)("div",{className:"tlui-share-zone",draggable:!1,children:(0,bT.jsx)(LG,{})})}let LI=Object.freeze([hm,hq,hr,hu]);function LJ(a=LI){let b=kp();return e$("getRelevantStyles",()=>{let c=new m8(b.getSharedStyles()),d=!!b.root.getCurrent()?.shapeType,e=b.isIn("select")&&b.getSelectedShapeIds().length>0;if(0===c.size&&b.isIn("select")&&0===b.getSelectedShapeIds().length)for(let d of a)c.applyValue(d,b.getStyleForNextShape(d));return d||e||c.size>0?c:null},[b])}let LK=[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],LL=[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],LM=[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],LN=[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],LO=[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],LP=[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],LQ=[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],LR=[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],LS=[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],LT=[{value:"arc",icon:"arrow-arc"},{value:"elbow",icon:"arrow-elbow"}],LU=[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],LV=[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],LW=[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}];function LX(a,[b,c]){return Math.min(c,Math.max(b,a))}var LY=["PageUp","PageDown"],LZ=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],L$={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},L_="Slider",[L0,L1,L2]=Cj(L_),[L3,L4]=z8(L_,[L2]),[L5,L6]=L3(L_),L7=eQ.forwardRef((a,b)=>{let{name:c,min:d=0,max:e=100,step:f=1,orientation:g="horizontal",disabled:h=!1,minStepsBetweenThumbs:i=0,defaultValue:j=[d],value:k,onValueChange:l=()=>{},onValueCommit:m=()=>{},inverted:n=!1,form:o,...p}=a,q=eQ.useRef(new Set),r=eQ.useRef(0),s="horizontal"===g,[t=[],u]=Ae({prop:k,defaultProp:j,onChange:a=>{let b=[...q.current];b[r.current]?.focus(),l(a)}}),v=eQ.useRef(t);function w(a,b,{commit:c}={commit:!1}){let g,h=(String(f).split(".")[1]||"").length,j=LX(Math.round((Math.round((a-d)/f)*f+d)*(g=Math.pow(10,h)))/g,[d,e]);u((a=[])=>{let d=function(a=[],b,c){let d=[...a];return d[c]=b,d.sort((a,b)=>a-b)}(a,j,b);if(!function(a,b){if(b>0)return Math.min(...a.slice(0,-1).map((b,c)=>a[c+1]-b))>=b;return!0}(d,i*f))return a;{r.current=d.indexOf(j);let b=String(d)!==String(a);return b&&c&&m(d),b?d:a}})}return(0,bT.jsx)(L5,{scope:a.__scopeSlider,name:c,disabled:h,min:d,max:e,valueIndexToChangeRef:r,thumbs:q.current,values:t,orientation:g,form:o,children:(0,bT.jsx)(L0.Provider,{scope:a.__scopeSlider,children:(0,bT.jsx)(L0.Slot,{scope:a.__scopeSlider,children:(0,bT.jsx)(s?Ma:Mb,{"aria-disabled":h,"data-disabled":h?"":void 0,...p,ref:b,onPointerDown:z4(p.onPointerDown,()=>{h||(v.current=t)}),min:d,max:e,inverted:n,onSlideStart:h?void 0:function(a){let b=function(a,b){if(1===a.length)return 0;let c=a.map(a=>Math.abs(a-b)),d=Math.min(...c);return c.indexOf(d)}(t,a);w(a,b)},onSlideMove:h?void 0:function(a){w(a,r.current)},onSlideEnd:h?void 0:function(){let a=v.current[r.current];t[r.current]!==a&&m(t)},onHomeKeyDown:()=>!h&&w(d,0,{commit:!0}),onEndKeyDown:()=>!h&&w(e,t.length-1,{commit:!0}),onStepKeyDown:({event:a,direction:b})=>{if(!h){let c=LY.includes(a.key)||a.shiftKey&&LZ.includes(a.key),d=r.current;w(t[d]+f*(c?10:1)*b,d,{commit:!0})}}})})})})});L7.displayName=L_;var[L8,L9]=L3(L_,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Ma=eQ.forwardRef((a,b)=>{let{min:c,max:d,dir:e,inverted:f,onSlideStart:g,onSlideMove:h,onSlideEnd:i,onStepKeyDown:j,...k}=a,[l,m]=eQ.useState(null),n=z7(b,a=>m(a)),o=eQ.useRef(void 0),p=Co(e),q="ltr"===p,r=q&&!f||!q&&f;function s(a){let b=o.current||l.getBoundingClientRect(),e=Mm([0,b.width],r?[c,d]:[d,c]);return o.current=b,e(a-b.left)}return(0,bT.jsx)(L8,{scope:a.__scopeSlider,startEdge:r?"left":"right",endEdge:r?"right":"left",direction:r?1:-1,size:"width",children:(0,bT.jsx)(Mc,{dir:p,"data-orientation":"horizontal",...k,ref:n,style:{...k.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:a=>{let b=s(a.clientX);g?.(b)},onSlideMove:a=>{let b=s(a.clientX);h?.(b)},onSlideEnd:()=>{o.current=void 0,i?.()},onStepKeyDown:a=>{let b=L$[r?"from-left":"from-right"].includes(a.key);j?.({event:a,direction:b?-1:1})}})})}),Mb=eQ.forwardRef((a,b)=>{let{min:c,max:d,inverted:e,onSlideStart:f,onSlideMove:g,onSlideEnd:h,onStepKeyDown:i,...j}=a,k=eQ.useRef(null),l=z7(b,k),m=eQ.useRef(void 0),n=!e;function o(a){let b=m.current||k.current.getBoundingClientRect(),e=Mm([0,b.height],n?[d,c]:[c,d]);return m.current=b,e(a-b.top)}return(0,bT.jsx)(L8,{scope:a.__scopeSlider,startEdge:n?"bottom":"top",endEdge:n?"top":"bottom",size:"height",direction:n?1:-1,children:(0,bT.jsx)(Mc,{"data-orientation":"vertical",...j,ref:l,style:{...j.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:a=>{let b=o(a.clientY);f?.(b)},onSlideMove:a=>{let b=o(a.clientY);g?.(b)},onSlideEnd:()=>{m.current=void 0,h?.()},onStepKeyDown:a=>{let b=L$[n?"from-bottom":"from-top"].includes(a.key);i?.({event:a,direction:b?-1:1})}})})}),Mc=eQ.forwardRef((a,b)=>{let{__scopeSlider:c,onSlideStart:d,onSlideMove:e,onSlideEnd:f,onHomeKeyDown:g,onEndKeyDown:h,onStepKeyDown:i,...j}=a,k=L6(L_,c);return(0,bT.jsx)(Al.span,{...j,ref:b,onKeyDown:z4(a.onKeyDown,a=>{"Home"===a.key?(g(a),a.preventDefault()):"End"===a.key?(h(a),a.preventDefault()):LY.concat(LZ).includes(a.key)&&(i(a),a.preventDefault())}),onPointerDown:z4(a.onPointerDown,a=>{let b=a.target;b.setPointerCapture(a.pointerId),a.preventDefault(),k.thumbs.has(b)?b.focus():d(a)}),onPointerMove:z4(a.onPointerMove,a=>{a.target.hasPointerCapture(a.pointerId)&&e(a)}),onPointerUp:z4(a.onPointerUp,a=>{let b=a.target;b.hasPointerCapture(a.pointerId)&&(b.releasePointerCapture(a.pointerId),f(a))})})}),Md="SliderTrack",Me=eQ.forwardRef((a,b)=>{let{__scopeSlider:c,...d}=a,e=L6(Md,c);return(0,bT.jsx)(Al.span,{"data-disabled":e.disabled?"":void 0,"data-orientation":e.orientation,...d,ref:b})});Me.displayName=Md;var Mf="SliderRange",Mg=eQ.forwardRef((a,b)=>{let{__scopeSlider:c,...d}=a,e=L6(Mf,c),f=L9(Mf,c),g=z7(b,eQ.useRef(null)),h=e.values.length,i=e.values.map(a=>Ml(a,e.min,e.max)),j=h>1?Math.min(...i):0,k=100-Math.max(...i);return(0,bT.jsx)(Al.span,{"data-orientation":e.orientation,"data-disabled":e.disabled?"":void 0,...d,ref:g,style:{...a.style,[f.startEdge]:j+"%",[f.endEdge]:k+"%"}})});Mg.displayName=Mf;var Mh="SliderThumb",Mi=eQ.forwardRef((a,b)=>{let c=L1(a.__scopeSlider),[d,e]=eQ.useState(null),f=z7(b,a=>e(a)),g=eQ.useMemo(()=>d?c().findIndex(a=>a.ref.current===d):-1,[c,d]);return(0,bT.jsx)(Mj,{...a,ref:f,index:g})}),Mj=eQ.forwardRef((a,b)=>{var c,d,e,f,g;let h,i,{__scopeSlider:j,index:k,name:l,...m}=a,n=L6(Mh,j),o=L9(Mh,j),[p,q]=eQ.useState(null),r=z7(b,a=>q(a)),s=!p||n.form||!!p.closest("form"),t=Dx(p),u=n.values[k],v=void 0===u?0:Ml(u,n.min,n.max),w=(c=k,(d=n.values.length)>2?`Value ${c+1} of ${d}`:2===d?["Minimum","Maximum"][c]:void 0),y=t?.[o.size],z=y?(e=y,f=v,g=o.direction,i=Mm([0,50],[0,h=e/2]),(h-i(f)*g)*g):0;return eQ.useEffect(()=>{if(p)return n.thumbs.add(p),()=>{n.thumbs.delete(p)}},[p,n.thumbs]),(0,bT.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[o.startEdge]:`calc(${v}% + ${z}px)`},children:[(0,bT.jsx)(L0.ItemSlot,{scope:a.__scopeSlider,children:(0,bT.jsx)(Al.span,{role:"slider","aria-label":a["aria-label"]||w,"aria-valuemin":n.min,"aria-valuenow":u,"aria-valuemax":n.max,"aria-orientation":n.orientation,"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,tabIndex:n.disabled?void 0:0,...m,ref:r,style:void 0===u?{display:"none"}:a.style,onFocus:z4(a.onFocus,()=>{n.valueIndexToChangeRef.current=k})})}),s&&(0,bT.jsx)(Mk,{name:l??(n.name?n.name+(n.values.length>1?"[]":""):void 0),form:n.form,value:u},k)]})});Mi.displayName=Mh;var Mk=eQ.forwardRef(({__scopeSlider:a,value:b,...c},d)=>{let e,f=eQ.useRef(null),g=z7(f,d),h=(e=eQ.useRef({value:b,previous:b}),eQ.useMemo(()=>(e.current.value!==b&&(e.current.previous=e.current.value,e.current.value=b),e.current.previous),[b]));return eQ.useEffect(()=>{let a=f.current;if(!a)return;let c=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;if(h!==b&&c){let d=new Event("input",{bubbles:!0});c.call(a,b),a.dispatchEvent(d)}},[h,b]),(0,bT.jsx)(Al.input,{style:{display:"none"},...c,ref:g,defaultValue:b})});function Ml(a,b,c){return LX(100/(c-b)*(a-b),[0,100])}function Mm(a,b){return c=>{if(a[0]===a[1]||b[0]===b[1])return b[0];let d=(b[1]-b[0])/(a[1]-a[0]);return b[0]+d*(c-a[0])}}Mk.displayName="RadioBubbleInput",a.s(["Range",()=>Mg,"Root",()=>L7,"Slider",()=>L7,"SliderRange",()=>Mg,"SliderThumb",()=>Mi,"SliderTrack",()=>Me,"Thumb",()=>Mi,"Track",()=>Me,"createSliderScope",()=>L4],92583);var Mn=a.i(92583),Mn=Mn;let Mo=eQ.default.forwardRef(function({onHistoryMark:a,title:b,min:c,steps:d,value:e,label:f,onValueChange:g,"data-testid":h,ariaValueModifier:i=1},j){let k=zQ(),[l,m]=(0,eQ.useState)(""),[n,o]=(0,eQ.useState)(-1);(0,eQ.useEffect)(()=>{o(0)},[]);let p=(0,eQ.useCallback)(a=>{g(a[0])},[g]),q=(0,eQ.useCallback)(()=>{Hm.hideAllTooltips(),a?.("click slider")},[a]);(0,eQ.useEffect)(()=>{let a=m4.setTimeout("set title and label",()=>{m(b+" — "+k(f))},0);return()=>clearTimeout(a)},[f,k,b]);let r=(0,eQ.useCallback)(a=>{"Tab"===a.key&&a.stopPropagation()},[]);return(0,bT.jsx)("div",{className:"tlui-slider__container",children:(0,bT.jsx)(Hq,{content:l,children:(0,bT.jsxs)(Mn.Root,{"data-testid":h,className:"tlui-slider",dir:"ltr",min:c??0,max:d,step:1,value:null!==e?[e]:void 0,onPointerDown:q,onValueChange:p,onKeyDownCapture:r,onKeyUpCapture:r,children:[(0,bT.jsx)(Mn.Track,{className:"tlui-slider__track",dir:"ltr",children:null!==e&&(0,bT.jsx)(Mn.Range,{className:"tlui-slider__range",dir:"ltr"})}),null!==e&&(0,bT.jsx)(Mn.Thumb,{"aria-valuemin":(c??0)*i,"aria-valuenow":e*i,"aria-valuemax":d*i,"aria-label":l,className:"tlui-slider__thumb",dir:"ltr",ref:j,tabIndex:n})]})})})});function Mp(){return hl({isDarkMode:pR()})}let Mq=(0,eQ.createContext)(null);function Mr({children:a,styles:b}){let c=kp(),d=F0(),e=(0,eQ.useCallback)(a=>c.markHistoryStoppingPoint(a),[c]),f=e$("enhancedA11yMode",()=>c.user.getEnhancedA11yMode(),[c]),g=(0,eQ.useCallback)(function(a,b){c.run(()=>{c.isIn("select")&&c.setStyleForSelectedShapes(a,b),c.setStyleForNextShapes(a,b),c.updateInstanceState({isChangingStyle:!0})}),d("set-style",{source:"style-panel",id:a.id,value:b})},[c,d]);return(0,bT.jsx)(Mq.Provider,{value:{styles:b,enhancedA11yMode:f,onHistoryMark:e,onValueChange:g},children:a})}function Ms(){let a=(0,eQ.useContext)(Mq);if(!a)throw Error("useStylePanelContext must be used within a StylePanelContextProvider");return a}function Mt({children:a}){return(0,bT.jsx)("h3",{className:"tlui-style-panel__subheading",children:a})}let Mu=(0,eQ.memo)(function(a){let{enhancedA11yMode:b}=Ms();return(0,bT.jsxs)(bT.Fragment,{children:[b&&(0,bT.jsx)(Mt,{children:a.title}),(0,bT.jsx)(Hs,{label:a.title,children:(0,bT.jsx)(Mv,{...a})})]})}),Mv=(0,eQ.memo)(function(a){let b=Ms(),{uiType:c,items:d,title:e,style:f,value:g,onValueChange:h=b.onValueChange,onHistoryMark:i=b.onHistoryMark}=a,j=Mp(),k=kp(),l=zQ(),m=Ce(),n=(0,eQ.useRef)(!1),o=(0,eQ.useRef)(null),{handleButtonClick:p,handleButtonPointerDown:q,handleButtonPointerEnter:r,handleButtonPointerUp:s}=(0,eQ.useMemo)(()=>{let a=()=>{n.current=!1,window.removeEventListener("pointerup",a);let b=o.current;b&&(["TEXTAREA","INPUT"].includes(b.nodeName)||b.isContentEditable)?b.focus():m>=Cb.TABLET_SM&&k.getContainer().focus(),o.current=null};return{handleButtonClick:a=>{let{id:b}=a.currentTarget.dataset;("shared"!==g.type||g.value!==b)&&(i?.("point picker item"),h(f,b))},handleButtonPointerDown:b=>{let{id:c}=b.currentTarget.dataset;i?.("point picker item"),h(f,c),n.current=!0,o.current=document.activeElement,window.addEventListener("pointerup",a)},handleButtonPointerEnter:a=>{if(!n.current)return;let{id:b}=a.currentTarget.dataset;h(f,b)},handleButtonPointerUp:a=>{let{id:b}=a.currentTarget.dataset;("shared"!==g.type||g.value!==b)&&h(f,b)}}},[k,m,g,i,h,f]),t=d.length>4?GS:GQ;return(0,bT.jsx)(Hu,{"data-testid":`style.${c}`,type:"single",value:"shared"===g.type?g.value:null,asChild:!0,children:(0,bT.jsx)(t,{children:d.map(a=>{let b="shared"===g.type&&g.value===a.value,d=e+" — "+l(`${c}-style.${a.value}`);return(0,bT.jsx)(Hv,{type:"icon","data-id":a.value,"data-testid":`style.${c}.${a.value}`,"aria-label":d+(b?` (${l("style-panel.selected")})`:""),tooltip:(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("div",{children:d}),b?(0,bT.jsxs)("div",{children:["(",l("style-panel.selected"),")"]}):null]}),value:a.value,"data-state":"shared"===g.type&&g.value===a.value?"on":"off","data-isactive":b,title:d,style:f===hm?{color:hp(j,a.value,"solid")}:void 0,onPointerEnter:r,onPointerDown:q,onPointerUp:s,onClick:p,children:(0,bT.jsx)(BV,{icon:a.icon})},a.value)})})})}),Mw=eQ.memo(function(a){let b=zQ();return(0,bT.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,bT.jsx)("div",{title:b(a.label),className:"tlui-style-panel__double-select-picker-label",children:b(a.label)}),(0,bT.jsx)(Hs,{orientation:"horizontal",label:b(a.label),children:(0,bT.jsx)(Mx,{...a})})]})}),Mx=eQ.memo(function(a){let b=Ms(),{uiTypeA:c,uiTypeB:d,labelA:e,labelB:f,itemsA:g,itemsB:h,styleA:i,styleB:j,valueA:k,valueB:l,onValueChange:m=b.onValueChange}=a,n=kp(),o=zQ(),[p,q]=eQ.useState(!1),[r,s]=eQ.useState(!1),t=eQ.useMemo(()=>g.find(a=>"shared"===k.type&&k.value===a.value)?.icon??"mixed",[g,k]),u=eQ.useMemo(()=>h.find(a=>"shared"===l.type&&l.value===a.value)?.icon??"mixed",[h,l]);if(void 0===k&&void 0===l)return null;let v=`style panel ${c} A`,w=`style panel ${d} B`;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(I5,{id:v,open:p,onOpenChange:q,children:[(0,bT.jsx)(I6,{children:(0,bT.jsx)(Ht,{type:"icon","data-testid":`style.${c}`,title:o(e)+" — "+(null===k||"mixed"===k.type?o("style-panel.mixed"):o(`${c}-style.${k.value}`)),children:(0,bT.jsx)(BV,{icon:t,small:!0,invertIcon:!0})})}),(0,bT.jsx)(I7,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:(0,bT.jsx)(Hs,{orientation:"grid",label:o(e),children:(0,bT.jsx)(Ch,{type:"icons",sourceId:"style-panel",children:g.map(a=>(0,bT.jsx)(Ht,{"data-testid":`style.${c}.${a.value}`,type:"icon",onClick:()=>{m(i,a.value),m3.deleteOpenMenu(v,n.contextId),q(!1)},title:`${o(e)} \u2014 ${o(`${c}-style.${a.value}`)}`,children:(0,bT.jsx)(BV,{icon:a.icon,invertIcon:!0})},a.value))})})})]}),(0,bT.jsxs)(I5,{id:w,open:r,onOpenChange:s,children:[(0,bT.jsx)(I6,{children:(0,bT.jsx)(Ht,{type:"icon","data-testid":`style.${d}`,title:o(f)+" — "+(null===l||"mixed"===l.type?o("style-panel.mixed"):o(`${d}-style.${l.value}`)),children:(0,bT.jsx)(BV,{icon:u,small:!0})})}),(0,bT.jsx)(I7,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:(0,bT.jsx)(Hs,{orientation:"grid",label:o(f),children:(0,bT.jsx)(Ch,{type:"icons",sourceId:"style-panel",children:h.map(a=>(0,bT.jsx)(Ht,{type:"icon",title:`${o(f)} \u2014 ${o(`${d}-style.${a.value}`)}`,"data-testid":`style.${d}.${a.value}`,onClick:()=>{m(j,a.value),m3.deleteOpenMenu(w,n.contextId),s(!1)},children:(0,bT.jsx)(BV,{icon:a.icon})},a.value))})})})]})]})}),My=eQ.memo(function(a){let b=zQ()(a.label?a.label:`style-panel.${a.stylePanelType}`);return(0,bT.jsx)(Hs,{label:b,children:(0,bT.jsx)(Mz,{...a})})}),Mz=eQ.memo(function(a){let b=Ms(),{id:c,label:d,uiType:e,stylePanelType:f,style:g,items:h,type:i,value:j,onValueChange:k=b.onValueChange}=a,l=zQ(),m=kp(),[n,o]=eQ.useState(!1),p=eQ.useMemo(()=>h.find(a=>"shared"===j.type&&a.value===j.value)?.icon,[h,j]),q=l(`style-panel.${f}`),r="mixed"===j.type?l("style-panel.mixed"):q+" — "+l(`${e}-style.${j.value}`),s=d?l(d):"",t=`style panel ${c}`;return(0,bT.jsxs)(I5,{id:t,open:n,onOpenChange:o,className:"tlui-style-panel__dropdown-picker",children:[(0,bT.jsx)(I6,{children:(0,bT.jsxs)(Ht,{type:i,"data-testid":`style.${e}`,"data-direction":"left",title:r,children:[s&&(0,bT.jsx)(z3,{children:s}),(0,bT.jsx)(BV,{icon:p??"mixed"})]})}),(0,bT.jsx)(I7,{side:"left",align:"center",children:(0,bT.jsx)(Hs,{orientation:h.length>4?"grid":"horizontal",label:s,children:(0,bT.jsx)(Ch,{type:"icons",sourceId:"style-panel",children:h.map(a=>(0,bT.jsx)(Ht,{type:"icon","data-testid":`style.${e}.${a.value}`,title:q+" — "+l(`${e}-style.${a.value}`),isActive:p===a.icon,onClick:()=>{b.onHistoryMark("select style dropdown item"),k(g,a.value),m3.deleteOpenMenu(t,m.contextId),o(!1)},children:(0,bT.jsx)(BV,{icon:a.icon})},a.value))})})})]})});function MA(){return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(MB,{children:[(0,bT.jsx)(MC,{}),(0,bT.jsx)(ME,{})]}),(0,bT.jsxs)(MB,{children:[(0,bT.jsx)(MF,{}),(0,bT.jsx)(MG,{}),(0,bT.jsx)(MH,{})]}),(0,bT.jsxs)(MB,{children:[(0,bT.jsx)(MI,{}),(0,bT.jsx)(MJ,{}),(0,bT.jsx)(MK,{})]}),(0,bT.jsxs)(MB,{children:[(0,bT.jsx)(ML,{}),(0,bT.jsx)(MM,{}),(0,bT.jsx)(MN,{}),(0,bT.jsx)(MO,{})]})]})}function MB({children:a}){return(0,bT.jsx)("div",{className:"tlui-style-panel__section",children:a})}function MC(){let{styles:a}=Ms(),b=zQ(),c=a.get(hm);return void 0===c?null:(0,bT.jsx)(Mu,{title:b("style-panel.color"),uiType:"color",style:hm,items:LK,value:c})}let MD=[.1,.25,.5,.75,1];function ME(){let a=kp(),{onHistoryMark:b,enhancedA11yMode:c}=Ms(),d=e$("opacity",()=>a.getSharedOpacity(),[a]),e=F0(),f=zQ(),g=eQ.default.useCallback(b=>{let c=MD[b];a.run(()=>{a.isIn("select")&&a.setOpacityForSelectedShapes(c),a.setOpacityForNextShapes(c),a.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:"opacity",value:b})},[a,e]);if(void 0===d)return null;let h="mixed"===d.type?-1:MD.indexOf(b7(MD,a=>Math.abs(a-d.value)));return(0,bT.jsxs)(bT.Fragment,{children:[c&&(0,bT.jsx)(Mt,{children:f("style-panel.opacity")}),(0,bT.jsx)(Mo,{"data-testid":"style.opacity",value:h>=0?h:MD.length-1,label:"mixed"===d.type?"style-panel.mixed":`opacity-style.${d.value}`,onValueChange:g,steps:MD.length-1,title:f("style-panel.opacity"),onHistoryMark:b,ariaValueModifier:25})]})}function MF(){let{styles:a}=Ms(),b=zQ(),c=a.get(hr);return void 0===c?null:(0,bT.jsx)(Mu,{title:b("style-panel.fill"),uiType:"fill",style:hr,items:LL,value:c})}function MG(){let{styles:a}=Ms(),b=zQ(),c=a.get(hq);return void 0===c?null:(0,bT.jsx)(Mu,{title:b("style-panel.dash"),uiType:"dash",style:hq,items:LM,value:c})}function MH(){let a=kp(),{styles:b,onValueChange:c}=Ms(),d=zQ(),e=b.get(hu);return void 0===e?null:(0,bT.jsx)(Mu,{title:d("style-panel.size"),uiType:"size",style:hu,items:LN,value:e,onValueChange:(b,d)=>{c(b,d);let e=a.getSelectedShapeIds();e.length>0&&sH(a,e)}})}function MI(){let{styles:a}=Ms(),b=zQ(),c=a.get(hs);return void 0===c?null:(0,bT.jsx)(Mu,{title:b("style-panel.font"),uiType:"font",style:hs,items:LO,value:c})}function MJ(){let{styles:a,enhancedA11yMode:b}=Ms(),c=zQ(),d=a.get(i8);if(void 0===d)return null;let e=c("style-panel.align");return(0,bT.jsxs)(bT.Fragment,{children:[b&&(0,bT.jsx)(Mt,{children:e}),(0,bT.jsxs)(Hs,{orientation:"horizontal",label:e,children:[(0,bT.jsx)(Mv,{title:e,uiType:"align",style:i8,items:LP,value:d}),(0,bT.jsx)(Ht,{type:"icon",title:c("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,bT.jsx)(BV,{icon:"vertical-align-middle"})})]})]})}function MK(){let{styles:a,enhancedA11yMode:b}=Ms(),c=zQ(),d=a.get(iO),e=a.get(iP);if(void 0===d)return null;let f=c("style-panel.label-align");return(0,bT.jsxs)(bT.Fragment,{children:[b&&(0,bT.jsx)(Mt,{children:f}),(0,bT.jsxs)(Hs,{orientation:"horizontal",label:f,children:[(0,bT.jsx)(Mv,{title:f,uiType:"align",style:iO,items:LQ,value:d}),void 0===e?(0,bT.jsx)(Ht,{type:"icon",title:c("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,bT.jsx)(BV,{icon:"vertical-align-middle"})}):(0,bT.jsx)(Mz,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:iP,items:LR,value:e})]})]})}function ML(){let{styles:a}=Ms(),b=a.get(iQ);return void 0===b?null:(0,bT.jsx)(My,{label:"style-panel.geo",type:"menu",id:"geo",uiType:"geo",stylePanelType:"geo",style:iQ,items:LS,value:b})}function MM(){let{styles:a}=Ms(),b=a.get(hv);return void 0===b?null:(0,bT.jsx)(My,{id:"arrow-kind",type:"menu",label:"style-panel.arrow-kind",uiType:"arrow-kind",stylePanelType:"arrow-kind",style:hv,items:LT,value:b})}function MN(){let{styles:a}=Ms(),b=a.get(hy),c=a.get(hx);return void 0===b||void 0===c?null:(0,bT.jsx)(Mw,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:hx,itemsA:LU,valueA:c,uiTypeB:"arrowheadEnd",styleB:hy,itemsB:LV,valueB:b,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function MO(){let{styles:a}=Ms(),b=a.get(i0);return void 0===b?null:(0,bT.jsx)(My,{type:"menu",id:"spline",uiType:"spline",stylePanelType:"spline",label:"style-panel.spline",style:i0,items:LW,value:b})}let MP=(0,eQ.memo)(function({isMobile:a,styles:b,children:c}){let d=kp(),e=e$("enhancedA11yMode",()=>d.user.getEnhancedA11yMode(),[d]),f=(0,eQ.useRef)(null);qF(f);let g=(0,eQ.useCallback)(()=>{a||d.updateInstanceState({isChangingStyle:!1})},[d,a]),h=LJ();return void 0===b&&(b=h),(0,eQ.useEffect)(()=>{function a(a){"Escape"===a.key&&f.current?.contains(document.activeElement)&&(a.stopPropagation(),d.getContainer().focus())}let b=f.current;return b?.addEventListener("keydown",a,{capture:!0}),()=>{b?.removeEventListener("keydown",a,{capture:!0})}},[d]),b&&(0,bT.jsx)("div",{ref:f,"data-testid":"style.panel",className:(0,j1.default)("tlui-style-panel",{"tlui-style-panel__wrapper":!a}),"data-ismobile":a,"data-enhanced-a11y-mode":e,onPointerLeave:g,children:(0,bT.jsx)(Mr,{styles:b,children:c??(0,bT.jsx)(MA,{})})})});var H7=H7;let MQ={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function MR({toast:a}){let{removeToast:b}=Ia(),c=zQ(),d=a.actions&&a.actions.length>0,e=a.icon||a.severity&&MQ[a.severity],f=a.iconLabel||(a.severity?c(`toast.${a.severity}`):"");return(0,bT.jsxs)(H7.Root,{onOpenChange:c=>{c||b(a.id)},className:"tlui-toast__container",duration:a.keepOpen?1/0:4e3,"data-severity":a.severity,children:[e&&(0,bT.jsx)("div",{className:"tlui-toast__icon",children:(0,bT.jsx)(BT,{label:f,icon:e})}),(0,bT.jsxs)("div",{className:"tlui-toast__main","data-title":!!a.title,"data-description":!!a.description,"data-actions":!!a.actions,children:[(0,bT.jsxs)("div",{className:"tlui-toast__content",children:[a.title&&(0,bT.jsx)(H7.Title,{className:"tlui-toast__title",children:a.title}),a.description&&(0,bT.jsx)(H7.Description,{className:"tlui-toast__description",children:a.description})]}),a.actions&&(0,bT.jsxs)("div",{className:"tlui-toast__actions",children:[a.actions.map((a,b)=>(0,bT.jsx)(H7.Action,{altText:a.label,asChild:!0,onClick:a.onClick,children:(0,bT.jsx)(zS,{type:a.type,children:(0,bT.jsx)(z3,{children:a.label})})},b)),(0,bT.jsx)(H7.Close,{asChild:!0,children:(0,bT.jsx)(zS,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:(0,bT.jsx)(z3,{children:a.closeLabel??c("toast.close")})})})]})]}),!d&&(0,bT.jsx)(H7.Close,{asChild:!0,children:(0,bT.jsx)(zS,{type:"normal",className:"tlui-toast__close",children:(0,bT.jsx)(z3,{children:a.closeLabel??c("toast.close")})})})]})}let MS=(0,eQ.memo)(function(){let{toasts:a}=Ia(),b=e$("toasts",()=>a.get(),[]);return(0,bT.jsxs)(bT.Fragment,{children:[b.map(a=>(0,bT.jsx)(MR,{toast:a},a.id)),(0,bT.jsx)(H7.ToastViewport,{className:"tlui-toast__viewport"})]})}),MT=({children:a,className:b,isMousingDown:c,getSelectionBounds:d,changeOnlyWhenYChanges:e=!1,label:f})=>{let g=kp(),h=(0,eQ.useRef)(null);qF(h);if(!h)throw Error("usePassThroughWheelEvents must be passed a ref");let i=kv(),j=kq();(0,eQ.useEffect)(()=>{function a(a){if(!j?.getInstanceState().isFocused||a.isSpecialRedispatchedEvent)return;kb(a);let b=i.querySelector(".tl-canvas");if(!b)return;let c=new PointerEvent(a.type,a);c.isSpecialRedispatchedEvent=!0,b.dispatchEvent(c)}let b=h.current;if(b)return b.addEventListener("mouseover",a,{passive:!1}),()=>{b.removeEventListener("mouseover",a)}},[i,j,h]);let{isVisible:k,isInteractive:l,hide:m,show:n,position:o,move:p}=function(a){let b=kp(),c=(0,eQ.useRef)({name:"hidden"}),[d,e]=(0,eQ.useState)(!1),[f,g]=(0,eQ.useState)(!1),[h,i]=(0,eQ.useState)({x:-1e3,y:-1e3}),j=(0,eQ.useRef)(new jA(-1e3,-1e3)),k=(0,eQ.useRef)(new jA(-1e3,-1e3)),l=(0,eQ.useRef)(-1),m=(0,eQ.useRef)(-1),n=(0,eQ.useCallback)((d,e,f=!1)=>{if(k.current.x=d,k.current.y=e,"hidden"===c.current.name||"showing"===c.current.name)return;clearTimeout(m.current);let g=()=>{var b,d;if("shown"===c.current.name&&(b=k.current,d=j.current,a?jA.Sub(d,b).y**2>=256:jA.Len2(jA.Sub(d,b))>=256)){let{x:a,y:b}=k.current;j.current=new jA(a,b),f?(0,lI.flushSync)(()=>i({x:a,y:b})):i({x:a,y:b})}};f?g():m.current=b.timers.setTimeout(g,150)},[b,a]),o=(0,eQ.useCallback)((a=!1)=>{switch(c.current.name){case"showing":clearTimeout(l.current),c.current={name:"hidden"};break;case"shown":c.current={name:"hiding"},e(!1),a?(c.current={name:"hidden"},g(!1)):l.current=b.timers.setTimeout(()=>{c.current={name:"hidden"},g(!1)},16)}},[b]);return{isVisible:f,isInteractive:d,show:(0,eQ.useCallback)(()=>{switch(c.current.name){case"hidden":c.current={name:"showing"},l.current=b.timers.setTimeout(()=>{let{x:a,y:b}=k.current;j.current=new jA(a,b),i({x:a,y:b}),c.current={name:"shown"},g(!0),e(!0)},16);break;case"hiding":clearTimeout(l.current),c.current={name:"shown"},e(!0),n(k.current.x,k.current.y)}},[b,n]),hide:o,move:n,position:h}}(e),q=(0,eQ.useRef)(!1),[r,s]=(0,eQ.useState)(!1),t=eW("content size update counter",0);(0,eQ.useEffect)(()=>{cg(h.current);let a=new ResizeObserver(()=>{t.update(a=>a+1)});return a.observe(h.current),()=>a.disconnect()},[t]),(0,eQ.useEffect)(()=>{let a=t.get();return eg("toolbar position",function(){let b=h.current;if(!b)return;let c=t.get();g.getCamera(),t.get();let e=function(a,b,c){let d=c()?.clone();if(!d)return;let e=a.getViewportScreenBounds();if(d.x-=e.x,d.y-=e.y,d.midY<16||d.midY>e.h-16||d.midX<16||d.midX>e.w-16)return;let f=MU(b.getBoundingClientRect());if(!f.width||!f.height)return;let{scrollLeft:g,scrollTop:h}=a.getContainer(),i=d.midX-f.w/2,j=d.y-f.h-8;return i=jI(i,16,e.w-f.w-16),j=jI(j,16,e.h-f.h-16),i+=g,j+=h,{x:i=Math.round(i),y:j=Math.round(j)}}(g,b,d);if(e){if("moving"===g.getCameraState())h.current.style.setProperty("transform",`translate(${e.x}px, ${e.y}px)`);else{let b=a!==c;p(e.x,e.y,b)}q.current||(q.current=!0,s(!0))}else q.current&&(q.current=!1,s(!1));a=c})},[g,d,t,p]);let u=e$("camera state",()=>g.getCameraState(),[g]);return(0,eQ.useEffect)(()=>{c||!r?m():n()},[r,u,c,n,m]),(0,eQ.useLayoutEffect)(()=>{let a=h.current;a&&(a.dataset.visible=`${k}`)},[k,o]),(0,eQ.useLayoutEffect)(()=>{let a=h.current;a&&a.style.setProperty("transform",`translate(${o.x}px, ${o.y}px)`)},[o]),(0,eQ.useLayoutEffect)(()=>{let a=h.current;a&&(a.dataset.interactive=`${l}`)},[l]),(0,bT.jsx)("div",{ref:h,"data-interactive":!1,"data-visible":!1,"data-testid":"contextual-toolbar",className:(0,j1.default)("tlui-contextual-toolbar",b),onPointerDown:g.markEventAsHandled,children:(0,bT.jsx)(Hs,{orientation:"horizontal",className:"tlui-menu",label:f,tooltipSide:"top",children:a})})};function MU(a){return new lh(a.x,a.y,a.width,a.height)}function MV({shapeId:a,onClose:b,source:c}){let d=kp(),[e,f]=(0,eQ.useState)(()=>{let b=d.getShape(a);if(!b)return"";if(!("altText"in b.props))throw Error("Shape does not have altText property");return b.props.altText||""}),g=zQ(),h=(0,eQ.useRef)(null),i=F0(),j=d.getIsReadonly(),k=()=>{i("set-alt-text",{source:c});let f=d.getShape(a);f&&(d.updateShapes([{id:f.id,type:f.type,props:{altText:e}}]),b())},l=(0,eQ.useCallback)(()=>b(),[b]);return(0,eQ.useEffect)(()=>{function a(a){"Escape"===a.key&&(a.stopPropagation(),l())}return h.current?.select(),document.addEventListener("keydown",a,{capture:!0}),()=>{document.removeEventListener("keydown",a,{capture:!0})}},[l]),(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(B_,{ref:h,className:"tlui-media__toolbar-alt-text-input","data-testid":"media-toolbar.alt-text-input",value:e,placeholder:g("tool.media-alt-text-desc"),"aria-label":g("tool.media-alt-text-desc"),onValueChange:a=>f(a),onComplete:k,onCancel:l,disabled:j}),!j&&(0,bT.jsx)(zS,{title:g("tool.media-alt-text-confirm"),"data-testid":"tool.media-alt-text-confirm",type:"icon",onPointerDown:kb,onClick:()=>k(),children:(0,bT.jsx)(BV,{small:!0,icon:"check"})})]})}var zx=b_;function MW(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}let MX=["original","square","circle","landscape","portrait","wide"],MY={original:0,square:1,circle:1,landscape:4/3,portrait:3/4,wide:16/9};function MZ(a,b){return b?{w:a.w/(b.bottomRight.x-b.topLeft.x),h:a.h/(b.bottomRight.y-b.topLeft.y)}:{w:a.w,h:a.h}}function M$(a){return{width:a.bottomRight.x-a.topLeft.x,height:a.bottomRight.y-a.topLeft.y}}function M_(a){let{width:b,height:c}=M$(a);return{x:a.topLeft.x+b/2,y:a.topLeft.y+c/2}}function M0(a,b,c,d,e){let f=Math.max(0,Math.min(1-c,a-c/2)),g=Math.max(0,Math.min(1-d,b-d/2));return{topLeft:{x:f,y:g},bottomRight:{x:f+c,y:g+d},isCircle:e}}let M1=eV(function({imageShapeId:a,isManipulating:b,onEditAltTextStart:c,onManipulatingStart:d,onManipulatingEnd:e}){let f=kp(),g=F0(),h=zQ(),i=(0,eQ.useRef)(null),j=f.getIsReadonly(),k=e$("crop",()=>f.getShape(a).props.crop,[f,a]),l=k?Math.min(1-(k.bottomRight.x-k.topLeft.x),1-(k.bottomRight.y-k.topLeft.y)):0,[m,n]=(0,eQ.useState)(k?Math.max(l,1-.3333333333333333):3),o=Qf();(0,eQ.useEffect)(()=>{n(k?Math.max(l,1-.3333333333333333):3)},[k,l,m]);let p=(0,eQ.useCallback)(a=>f.markHistoryStoppingPoint(a),[f]),q=(0,eQ.useCallback)((a,b)=>Math.pow(a/b,1.5)*b,[]),r=k&&m?cT(q(l,m),[0,m],[0,100],!0):0,s=(0,eQ.useCallback)(b=>{f.setCurrentTool("select.crop.idle");let c=Math.pow(b/100,.6666666666666666)*Math.min(1-.3333333333333333,m??1-.3333333333333333),d=f.getShape(a);if(!d)return;let e=function(a,b,c){let d,e,f=b.props.crop||MW(),{width:g,height:h}=M$(f),i=g/h,j=1+a*((c?1/(1-c):3)-1);i>1?e=(d=Math.min(1,1/j))/i:d=(e=Math.min(1,1/j))*i;let k=function(a,b,c,d=!0,e=!1){let f,g,{w:h,h:i}=MZ(a.props,a.props.crop??MW()),j=a.props.crop||MW(),k=a.x+a.props.w/2,l=a.y+a.props.h/2;if(d){let{x:a,y:b}=M_(j);f=a,g=b}else f=.5,g=.5;let m=M0(f,g,b,c,e),n=b*h,o=c*i;return{crop:m,w:n,h:o,x:k-n/2,y:l-o/2}}(b,d,e,!0,f.isCircle),l=Math.min(3,g/d);k.w*=l,k.h*=l;let m=b.x+b.props.w/2,n=b.y+b.props.h/2;return k.x=m-k.w/2,k.y=n-k.h/2,k}(c>=1?1:c/(2*(1-c)),d,m);f.updateShape({id:d.id,type:d.type,x:e.x,y:e.y,props:{w:e.w,h:e.h,crop:e.crop}}),g("set-style",{source:"image-toolbar",id:"zoom",value:b})},[f,g,a,m]),t=(0,eQ.useCallback)(()=>o["image-replace"].onSelect("image-toolbar"),[o]),u=(0,eQ.useCallback)(()=>o["download-original"].onSelect("image-toolbar"),[o]),v=e$("altText",()=>f.getShape(a).props.altText,[f,a]),w=e$("shapeAspectRatio",()=>{let b=f.getShape(a);return b.props.w/b.props.h},[f,a]),y=!k||(0,zx.default)(k,MW());return((0,eQ.useEffect)(()=>{b&&f.timers.setTimeout(()=>i.current?.focus(),0)},[f,b]),(0,eQ.useEffect)(()=>{function a(a){b&&("Escape"===a.key?(f.cancel(),e()):"Enter"===a.key&&(f.complete(),e()))}let c=i.current;return c&&c.addEventListener("keydown",a),()=>{c&&c.removeEventListener("keydown",a)}},[f,b,e]),b)?(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Mo,{ref:i,value:r,label:"tool.image-zoom",onValueChange:s,onHistoryMark:p,min:0,steps:100,"data-testid":"tool.image-zoom",title:h("tool.image-zoom")}),(0,bT.jsxs)(F2,{id:"image-toolbar-aspect-ratio",children:[(0,bT.jsx)(F3,{children:(0,bT.jsx)(Ht,{title:h("tool.aspect-ratio"),type:"icon","data-testid":"tool.image-aspect-ratio",children:(0,bT.jsx)(BV,{icon:"corners"})})}),(0,bT.jsx)(F4,{side:"top",align:"center",children:MX.map(b=>{let c=!1;return y?"original"===b&&(c=!0):c="circle"===b?!!k.isCircle:"square"===b?!k?.isCircle&&jK(w,MY[b],.1):"original"!==b&&!y&&jK(w,MY[b],.01),(0,bT.jsx)(Ga,{onSelect:()=>{let c;(c=f.getShape(a))&&f.run(()=>{f.setCurrentTool("select.crop.idle");let d=function(a,b){let c,d;if("original"===a){let{w:a,h:c}=MZ(b.props,b.props.crop??MW()),d=b.x+b.props.w/2,e=b.y+b.props.h/2;return{crop:MW(),w:a,h:c,x:d-a/2,y:e-c/2}}let e=MY[a],{w:f,h:g}=MZ(b.props,b.props.crop||MW()),h=f/g,i=b.props.crop||MW(),{width:j,height:k}=M$(i),l=M_(i),m=Math.min(1/j,1/k);if(0!==h&&Number.isFinite(h)&&0!==e){let a,b,i=j*f,l=k*g,m=Math.max(i,l);i>=l?b=(a=m)/e:a=(b=m)*e,c=a/f,d=b/g,c>1&&(c=1,d=h/e),d>1&&(d=1,c=e/h),c=Math.max(0,Math.min(1,c)),d=Math.max(0,Math.min(1,d))}else c=1,d=1;let n=Math.min(1/c,1/d);c*=n/m,d*=n/m,c=Math.max(0,Math.min(1,c)),d=Math.max(0,Math.min(1,d));let o=M0(l.x,l.y,c,d,"circle"===a),p=o.bottomRight.x-o.topLeft.x,q=o.bottomRight.y-o.topLeft.y,r=1;j>0?r=b.props.w/(j*f):k>0&&(r=b.props.h/(k*g));let s=p*f*r,t=q*g*r;return{crop:o,w:s,h:t,x:b.x+b.props.w/2-s/2,y:b.y+b.props.h/2-t/2}}(b,c);f.markHistoryStoppingPoint("aspect ratio"),f.updateShape({id:a,type:"image",x:d.x,y:d.y,props:{crop:d.crop,w:d.w,h:d.h}}),sH(f,[a])})},checked:c,title:h(`tool.aspect-ratio.${b}`),children:(0,bT.jsx)(z3,{children:h(`tool.aspect-ratio.${b}`)})},b)})})]}),(0,bT.jsx)(Ht,{type:"icon",onClick:e,"data-testid":"tool.image-crop-confirm",style:{borderLeft:"1px solid var(--tl-color-divider)",marginLeft:"2px"},title:h("tool.image-crop-confirm"),children:(0,bT.jsx)(BV,{small:!0,icon:"check"})})]}):(0,bT.jsxs)(bT.Fragment,{children:[!j&&(0,bT.jsx)(Ht,{type:"icon","data-testid":"tool.image-replace",onClick:t,title:h("tool.replace-media"),children:(0,bT.jsx)(BV,{small:!0,icon:"tool-media"})}),!j&&(0,bT.jsx)(Ht,{type:"icon",title:h("tool.image-crop"),onClick:d,"data-testid":"tool.image-crop",children:(0,bT.jsx)(BV,{small:!0,icon:"crop"})}),(0,bT.jsx)(Ht,{type:"icon",title:h("action.download-original"),onClick:u,"data-testid":"tool.image-download",children:(0,bT.jsx)(BV,{small:!0,icon:"download"})}),(v||!j)&&(0,bT.jsx)(Ht,{type:"icon",title:h("tool.media-alt-text"),"data-testid":"tool.image-alt-text",onClick:()=>{g("alt-text-start",{source:"image-toolbar"}),c()},children:(0,bT.jsx)(BV,{small:!0,icon:"alt"})})]})});function M2({children:a}){let b=kp(),c=e$("imageShape",()=>{let a=b.getOnlySelectedShape();return a&&"image"===a.type?a.id:null},[b]),d=e$("showToolbar",()=>b.isInAny("select.idle","select.pointing_shape","select.crop"),[b]),e=e$("locked",()=>!!c&&b.getShape(c)?.isLocked,[b,c]);return c&&d&&!e?(0,bT.jsx)(M3,{imageShapeId:c,children:a},c):null}function M3({children:a,imageShapeId:b}){let c=kp(),d=zQ(),e=e$("editor path",()=>c.isInAny("select.crop.cropping","select.crop.pointing_crop_handle","select.crop.translating_crop"),[c]),f=e$("camera",()=>c.getCamera(),[c]),g=e$("editor path",()=>c.isIn("select.crop."),[c]),h=(0,eQ.useRef)(),i=(0,eQ.useCallback)(()=>{c.setCroppingShape(null),c.setCurrentTool("select.idle")},[c]),[j,k]=(0,eQ.useState)(!1),l=(0,eQ.useCallback)(()=>k(!0),[]),m=(0,eQ.useCallback)(()=>c.setCurrentTool("select.crop.idle"),[c]),n=(0,eQ.useCallback)(()=>k(!1),[]);(0,eQ.useEffect)(()=>{h.current=void 0},[f]);let o=(0,eQ.useCallback)(()=>{if(g&&h.current)return h.current;let a=c.getSelectionScreenBounds();if(!a)return;let b=new lh(a.x,a.y,a.width,0);return h.current=b,b},[c,g]);return e?(h.current=void 0,null):(0,bT.jsx)(MT,{className:"tlui-image__toolbar",getSelectionBounds:o,label:d("tool.image-toolbar-title"),children:a||(j?(0,bT.jsx)(MV,{shapeId:b,onClose:n,source:"image-toolbar"}):(0,bT.jsx)(M1,{imageShapeId:b,isManipulating:g,onEditAltTextStart:l,onManipulatingStart:m,onManipulatingEnd:i}))})}var M4=Object.defineProperty,M5=(a,b)=>{for(var c in b)M4(a,c,{get:b[c],enumerable:!0})};function M6(a){let{state:b,transaction:c}=a,{selection:d}=c,{doc:e}=c,{storedMarks:f}=c;return{...b,apply:b.apply.bind(b),applyTransaction:b.applyTransaction.bind(b),plugins:b.plugins,schema:b.schema,reconfigure:b.reconfigure.bind(b),toJSON:b.toJSON.bind(b),get storedMarks(){return f},get selection(){return d},get doc(){return e},get tr(){return d=c.selection,e=c.doc,f=c.storedMarks,c}}}var M7=class{constructor(a){this.editor=a.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=a.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:a,editor:b,state:c}=this,{view:d}=b,{tr:e}=c,f=this.buildProps(e);return Object.fromEntries(Object.entries(a).map(([a,b])=>[a,(...a)=>{let c=b(...a)(f);return e.getMeta("preventDispatch")||this.hasCustomState||d.dispatch(e),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g=[],h=!!a,i=a||e.tr,j=()=>(h||!b||i.getMeta("preventDispatch")||this.hasCustomState||f.dispatch(i),g.every(a=>!0===a)),k={...Object.fromEntries(Object.entries(c).map(([a,c])=>[a,(...a)=>{let d=this.buildProps(i,b),e=c(...a)(d);return g.push(e),k}])),run:j};return k}createCan(a){let{rawCommands:b,state:c}=this,d=a||c.tr,e=this.buildProps(d,!1);return{...Object.fromEntries(Object.entries(b).map(([a,b])=>[a,(...a)=>b(...a)({...e,dispatch:void 0})])),chain:()=>this.createChain(d,!1)}}buildProps(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g={tr:a,editor:d,view:f,state:M6({state:e,transaction:a}),dispatch:b?()=>void 0:void 0,chain:()=>this.createChain(a,b),can:()=>this.createCan(a),get commands(){return Object.fromEntries(Object.entries(c).map(([a,b])=>[a,(...a)=>b(...a)(g)]))}};return g}};function M8(a){throw Error("[tiptap error]: there is no window object available, so this function cannot be used")}function M9(a,b,c){if(a instanceof s0||a instanceof sJ)return a;c={slice:!0,parseOptions:{},...c};let d="object"==typeof a&&null!==a,e="string"==typeof a;if(d)try{if(Array.isArray(a)&&a.length>0)return sJ.fromArray(a.map(a=>b.nodeFromJSON(a)));let d=b.nodeFromJSON(a);return c.errorOnInvalidContent&&d.check(),d}catch(d){if(c.errorOnInvalidContent)throw Error("[tiptap error]: Invalid JSON content",{cause:d});return console.warn("[tiptap warn]: Invalid content.","Passed value:",a,"Error:",d),M9("",b,c)}if(e){if(c.errorOnInvalidContent){let d=!1,e="",f=new tf({topNode:b.spec.topNode,marks:b.spec.marks,nodes:b.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:a=>(d=!0,e="string"==typeof a?a:a.outerHTML,null)}]}})});if(c.slice?th.fromSchema(f).parseSlice(M8(a),c.parseOptions):th.fromSchema(f).parse(M8(a),c.parseOptions),c.errorOnInvalidContent&&d)throw Error("[tiptap error]: Invalid HTML content",{cause:Error(`Invalid element found: ${e}`)})}let d=th.fromSchema(b);return c.slice?d.parseSlice(M8(a),c.parseOptions).content:d.parse(M8(a),c.parseOptions)}return M9("",b,c)}function Na(a){return b=>(function(a,b){for(let c=a.depth;c>0;c-=1){let d=a.node(c);if(b(d))return{pos:c>0?a.before(c):0,start:a.start(c),depth:c,node:d}}})(b.$from,a)}function Nb(a,b,c){return void 0===a.config[b]&&a.parent?Nb(a.parent,b,c):"function"==typeof a.config[b]?a.config[b].bind({...c,parent:a.parent?Nb(a.parent,b,c):null}):a.config[b]}function Nc(a){return a.map(a=>{let b={name:a.name,options:a.options,storage:a.storage},c=Nb(a,"addExtensions",b);return c?[a,...Nc(c())]:a}).flat(10)}function Nd(a,b){let c=tq.fromSchema(b).serializeFragment(a),d=document.implementation.createHTMLDocument().createElement("div");return d.appendChild(c),d.innerHTML}function Ne(a,b,...c){return"function"==typeof a?b?a.bind(b)(...c):a(...c):a}function Nf(a){let b=a.filter(a=>"extension"===a.type);return{baseExtensions:b,nodeExtensions:a.filter(a=>"node"===a.type),markExtensions:a.filter(a=>"mark"===a.type)}}function Ng(a){let b=[],{nodeExtensions:c,markExtensions:d}=Nf(a),e=[...c,...d],f={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return a.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage,extensions:e},d=Nb(a,"addGlobalAttributes",c);d&&d().forEach(a=>{a.types.forEach(c=>{Object.entries(a.attributes).forEach(([a,d])=>{b.push({type:c,name:a,attribute:{...f,...d}})})})})}),e.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage},d=Nb(a,"addAttributes",c);d&&Object.entries(d()).forEach(([c,d])=>{let e={...f,...d};"function"==typeof(null==e?void 0:e.default)&&(e.default=e.default()),(null==e?void 0:e.isRequired)&&(null==e?void 0:e.default)===void 0&&delete e.default,b.push({type:a.name,name:c,attribute:e})})}),b}function Nh(a,b){return b.filter(b=>b.type===a.type.name).filter(a=>a.attribute.rendered).map(b=>b.attribute.renderHTML?b.attribute.renderHTML(a.attrs)||{}:{[b.name]:a.attrs[b.name]}).reduce((a,b)=>(function(...a){return a.filter(a=>!!a).reduce((a,b)=>{let c={...a};return Object.entries(b).forEach(([a,b])=>{if(!c[a]){c[a]=b;return}if("class"===a){let d=b?String(b).split(" "):[],e=c[a]?c[a].split(" "):[],f=d.filter(a=>!e.includes(a));c[a]=[...e,...f].join(" ")}else if("style"===a){let d=b?b.split(";").map(a=>a.trim()).filter(Boolean):[],e=c[a]?c[a].split(";").map(a=>a.trim()).filter(Boolean):[],f=new Map;e.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),d.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),c[a]=Array.from(f.entries()).map(([a,b])=>`${a}: ${b}`).join("; ")}else c[a]=b}),c},{})})(a,b),{})}function Ni(a,b){return"style"in a?a:{...a,getAttrs:c=>{let d=a.getAttrs?a.getAttrs(c):a.attrs;if(!1===d)return!1;let e=b.reduce((a,b)=>{var d;let e=b.attribute.parseHTML?b.attribute.parseHTML(c):"string"!=typeof(d=c.getAttribute(b.name))?d:d.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(d):"true"===d||"false"!==d&&d;return null==e?a:{...a,[b.name]:e}},{});return{...d,...e}}}}function Nj(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>!("attrs"===a&&function(a={}){return 0===Object.keys(a).length&&a.constructor===Object}(b))&&null!=b))}function Nk(a,b){var c;let d=Ng(a),{nodeExtensions:e,markExtensions:f}=Nf(a),g=null==(c=e.find(a=>Nb(a,"topNode")))?void 0:c.name;return new tf({topNode:g,nodes:Object.fromEntries(e.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=Nj({...a.reduce((a,b)=>{let d=Nb(b,"extendNodeSchema",f);return{...a,...d?d(c):{}}},{}),content:Ne(Nb(c,"content",f)),marks:Ne(Nb(c,"marks",f)),group:Ne(Nb(c,"group",f)),inline:Ne(Nb(c,"inline",f)),atom:Ne(Nb(c,"atom",f)),selectable:Ne(Nb(c,"selectable",f)),draggable:Ne(Nb(c,"draggable",f)),code:Ne(Nb(c,"code",f)),whitespace:Ne(Nb(c,"whitespace",f)),linebreakReplacement:Ne(Nb(c,"linebreakReplacement",f)),defining:Ne(Nb(c,"defining",f)),isolating:Ne(Nb(c,"isolating",f)),attrs:Object.fromEntries(e.map(a=>{var b,c;return[a.name,{default:null==(b=null==a?void 0:a.attribute)?void 0:b.default,validate:null==(c=null==a?void 0:a.attribute)?void 0:c.validate}]}))}),h=Ne(Nb(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>Ni(a,e)));let i=Nb(c,"renderHTML",f);i&&(g.toDOM=a=>i({node:a,HTMLAttributes:Nh(a,e)}));let j=Nb(c,"renderText",f);return j&&(g.toText=j),[c.name,g]})),marks:Object.fromEntries(f.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=Nj({...a.reduce((a,b)=>{let d=Nb(b,"extendMarkSchema",f);return{...a,...d?d(c):{}}},{}),inclusive:Ne(Nb(c,"inclusive",f)),excludes:Ne(Nb(c,"excludes",f)),group:Ne(Nb(c,"group",f)),spanning:Ne(Nb(c,"spanning",f)),code:Ne(Nb(c,"code",f)),attrs:Object.fromEntries(e.map(a=>{var b,c;return[a.name,{default:null==(b=null==a?void 0:a.attribute)?void 0:b.default,validate:null==(c=null==a?void 0:a.attribute)?void 0:c.validate}]}))}),h=Ne(Nb(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>Ni(a,e)));let i=Nb(c,"renderHTML",f);return i&&(g.toDOM=a=>i({mark:a,HTMLAttributes:Nh(a,e)})),[c.name,g]}))})}function Nl(a){return a.sort((a,b)=>{let c=Nb(a,"priority")||100,d=Nb(b,"priority")||100;return c>d?-1:+(c<d)})}function Nm(a){var b;let c=Nl(Nc(a)),d=Array.from(new Set((b=c.map(a=>a.name)).filter((a,c)=>b.indexOf(a)!==c)));return d.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${d.map(a=>`'${a}'`).join(", ")}]. This can lead to issues.`),c}function Nn(a,b,c){let{from:d,to:e}=b,{blockSeparator:f="\n\n",textSerializers:g={}}=c||{},h="";return a.nodesBetween(d,e,(a,c,i,j)=>{var k;a.isBlock&&c>d&&(h+=f);let l=null==g?void 0:g[a.type.name];if(l)return i&&(h+=l({node:a,pos:c,parent:i,index:j,range:b})),!1;a.isText&&(h+=null==(k=null==a?void 0:a.text)?void 0:k.slice(Math.max(d,c)-c,e-c))}),h}function No(a){return Object.fromEntries(Object.entries(a.nodes).filter(([,a])=>a.spec.toText).map(([a,b])=>[a,b.spec.toText]))}function Np(a,b){if("string"==typeof a){if(!b.marks[a])throw Error(`There is no mark type named '${a}'. Maybe you forgot to add the extension?`);return b.marks[a]}return a}function Nq(a,b){if("string"==typeof a){if(!b.nodes[a])throw Error(`There is no node type named '${a}'. Maybe you forgot to add the extension?`);return b.nodes[a]}return a}function Nr(a,b){return b.nodes[a]?"node":b.marks[a]?"mark":null}function Ns(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function Nt(a,b,c={strict:!0}){let d=Object.keys(b);return!d.length||d.every(d=>c.strict?b[d]===a[d]:Ns(b[d])?b[d].test(a[d]):b[d]===a[d])}function Nu(a,b,c={}){return a.find(a=>a.type===b&&Nt(Object.fromEntries(Object.keys(c).map(b=>[b,a.attrs[b]])),c))}function Nv(a,b,c={}){return!!Nu(a,b,c)}function Nw(a,b,c){var d;if(!a||!b)return;let e=a.parent.childAfter(a.parentOffset);if(e.node&&e.node.marks.some(a=>a.type===b)||(e=a.parent.childBefore(a.parentOffset)),!e.node||!e.node.marks.some(a=>a.type===b)||(c=c||(null==(d=e.node.marks[0])?void 0:d.attrs),!Nu([...e.node.marks],b,c)))return;let f=e.index,g=a.start()+e.offset,h=f+1,i=g+e.node.nodeSize;for(;f>0&&Nv([...a.parent.child(f-1).marks],b,c);)f-=1,g-=a.parent.child(f).nodeSize;for(;h<a.parent.childCount&&Nv([...a.parent.child(h).marks],b,c);)i+=a.parent.child(h).nodeSize,h+=1;return{from:g,to:i}}function Nx(a,b){return b.nodes[a]||b.marks[a]||null}function Ny(a,b,c){return Object.fromEntries(Object.entries(c).filter(([c])=>{let d=a.find(a=>a.type===b&&a.name===c);return!!d&&d.attribute.keepOnSplit}))}function Nz(a,b,c={}){let{from:d,to:e,empty:f}=a.selection,g=b?Nq(b,a.schema):null,h=[];a.doc.nodesBetween(d,e,(a,b)=>{if(a.isText)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);h.push({node:a,from:c,to:f})});let i=e-d,j=h.filter(a=>!g||g.name===a.node.type.name).filter(a=>Nt(a.node.attrs,c,{strict:!1}));return f?!!j.length:j.reduce((a,b)=>a+b.to-b.from,0)>=i}function NA(a,b){return Array.isArray(b)?b.some(b=>("string"==typeof b?b:b.name)===a.name):b}function NB(a,b){let{nodeExtensions:c}=Nf(b),d=c.find(b=>b.name===a);if(!d)return!1;let e={name:d.name,options:d.options,storage:d.storage},f=Ne(Nb(d,"group",e));return"string"==typeof f&&f.split(" ").includes("list")}function NC(a){return a instanceof t9}function ND(a=0,b=0,c=0){return Math.min(Math.max(a,b),c)}function NE(a){var b;let{editor:c,from:d,to:e,text:f,rules:g,plugin:h}=a,{view:i}=c;if(i.composing)return!1;let j=i.state.doc.resolve(d);if(j.parent.type.spec.code||(null==(b=j.nodeBefore||j.nodeAfter)?void 0:b.marks.find(a=>a.type.spec.code)))return!1;let k=!1,l=((a,b=500)=>{let c="",d=a.parentOffset;return a.parent.nodesBetween(Math.max(0,d-b),d,(a,b,e,f)=>{var g,h;let i=(null==(h=(g=a.type.spec).toText)?void 0:h.call(g,{node:a,pos:b,parent:e,index:f}))||a.textContent||"%leaf%";c+=a.isAtom&&!a.isText?i:i.slice(0,Math.max(0,d-b))}),c})(j)+f;return g.forEach(a=>{if(k)return;let b=((a,b)=>{if(Ns(b))return b.exec(a);let c=b(a);if(!c)return null;let d=[c.text];return d.index=c.index,d.input=a,d.data=c.data,c.replaceWith&&(c.text.includes(c.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),d.push(c.replaceWith)),d})(l,a.find);if(!b)return;let g=i.state.tr,j=M6({state:i.state,transaction:g}),m={from:d-(b[0].length-f.length),to:e},{commands:n,chain:o,can:p}=new M7({editor:c,state:j});null!==a.handler({state:j,range:m,match:b,commands:n,chain:o,can:p})&&g.steps.length&&(a.undoable&&g.setMeta(h,{transform:g,from:d,to:e,text:f}),i.dispatch(g),k=!0)}),k}function NF(a){return"Object"===Object.prototype.toString.call(a).slice(8,-1)&&a.constructor===Object&&Object.getPrototypeOf(a)===Object.prototype}var NG=class{constructor(a={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...a},this.name=this.config.name}get options(){return{...Ne(Nb(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Ne(Nb(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(a={}){let b=this.extend({...this.config,addOptions:()=>(function a(b,c){let d={...b};return NF(b)&&NF(c)&&Object.keys(c).forEach(e=>{NF(c[e])&&NF(b[e])?d[e]=a(b[e],c[e]):d[e]=c[e]}),d})(this.options,a)});return b.name=this.name,b.parent=this.parent,b}extend(a={}){let b=new this.constructor({...this.config,...a});return b.parent=this,this.child=b,b.name="name"in a?a.name:b.parent.name,b}},NH=class a extends NG{constructor(){super(...arguments),this.type="mark"}static create(b={}){return new a("function"==typeof b?b():b)}static handleExit({editor:a,mark:b}){let{tr:c}=a.state,d=a.state.selection.$from;if(d.pos===d.end()){let e=d.marks();if(!e.find(a=>(null==a?void 0:a.type.name)===b.name))return!1;let f=e.find(a=>(null==a?void 0:a.type.name)===b.name);return f&&c.removeStoredMark(f),c.insertText(" ",d.pos),a.view.dispatch(c),!0}return!1}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},NI=null,NJ=class{constructor(a,b){this.splittableMarks=[],this.editor=b,this.extensions=Nm(a),this.schema=Nk(this.extensions,b),this.setupExtensions()}get commands(){return this.extensions.reduce((a,b)=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:this.editor,type:Nx(b.name,this.schema)},d=Nb(b,"addCommands",c);return d?{...a,...d()}:a},{})}get plugins(){let{editor:a}=this;return Nl([...this.extensions].reverse()).flatMap(b=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:Nx(b.name,this.schema)},d=[],e=Nb(b,"addKeyboardShortcuts",c),f={};if("mark"===b.type&&Nb(b,"exitable",c)&&(f.ArrowRight=()=>NH.handleExit({editor:a,mark:b})),e){let b=Object.fromEntries(Object.entries(e()).map(([b,c])=>[b,()=>c({editor:a})]));f={...f,...b}}let g=w4(f);d.push(g);let h=Nb(b,"addInputRules",c);if(NA(b,a.options.enableInputRules)&&h){let b=h();if(b&&b.length){let c=function(a){let{editor:b,rules:c}=a,d=new un({state:{init:()=>null,apply(a,e,f){let g=a.getMeta(d);if(g)return g;let h=a.getMeta("applyInputRules");return h&&setTimeout(()=>{let{text:a}=h;"string"==typeof a||(a=Nd(sJ.from(a),f.schema));let{from:e}=h,g=e+a.length;NE({editor:b,from:e,to:g,text:a,rules:c,plugin:d})}),a.selectionSet||a.docChanged?null:e}},props:{handleTextInput:(a,e,f,g)=>NE({editor:b,from:e,to:f,text:g,rules:c,plugin:d}),handleDOMEvents:{compositionend:a=>(setTimeout(()=>{let{$cursor:e}=a.state.selection;e&&NE({editor:b,from:e.pos,to:e.pos,text:"",rules:c,plugin:d})}),!1)},handleKeyDown(a,e){if("Enter"!==e.key)return!1;let{$cursor:f}=a.state.selection;return!!f&&NE({editor:b,from:f.pos,to:f.pos,text:"\n",rules:c,plugin:d})}},isInputRules:!0});return d}({editor:a,rules:b}),e=Array.isArray(c)?c:[c];d.push(...e)}}let i=Nb(b,"addPasteRules",c);if(NA(b,a.options.enablePasteRules)&&i){let b=i();if(b&&b.length){let c=function(a){let b,{editor:c,rules:d}=a,e=null,f=!1,g=!1,h="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{b="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{b=null}let i=({state:a,from:d,to:e,rule:f,pasteEvt:g})=>{let i=a.tr;if(function(a){let{editor:b,state:c,from:d,to:e,rule:f,pasteEvent:g,dropEvent:h}=a,{commands:i,chain:j,can:k}=new M7({editor:b,state:c}),l=[];return c.doc.nodesBetween(d,e,(a,b)=>{var m,n,o,p,q;if((null==(n=null==(m=a.type)?void 0:m.spec)?void 0:n.code)||!(a.isText||a.isTextblock||a.isInline))return;let r=null!=(q=null!=(p=null==(o=a.content)?void 0:o.size)?p:a.nodeSize)?q:0,s=Math.max(d,b),t=Math.min(e,b+r);s>=t||((a,b,c)=>{if(Ns(b))return[...a.matchAll(b)];let d=b(a,c);return d?d.map(b=>{let c=[b.text];return c.index=b.index,c.input=a,c.data=b.data,b.replaceWith&&(b.text.includes(b.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),c.push(b.replaceWith)),c}):[]})(a.isText?a.text||"":a.textBetween(s-b,t-b,void 0,"￼"),f.find,g).forEach(a=>{if(void 0===a.index)return;let b=s+a.index+1,d=b+a[0].length,e={from:c.tr.mapping.map(b),to:c.tr.mapping.map(d)},m=f.handler({state:c,range:e,match:a,commands:i,chain:j,can:k,pasteEvent:g,dropEvent:h});l.push(m)})}),l.every(a=>null!==a)}({editor:c,state:M6({state:a,transaction:i}),from:Math.max(d-1,0),to:e.b-1,rule:f,pasteEvent:g,dropEvent:b})&&i.steps.length){try{b="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{b=null}return h="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,i}};return d.map(a=>new un({view(a){let b=b=>{var d;(e=(null==(d=a.dom.parentElement)?void 0:d.contains(b.target))?a.dom.parentElement:null)&&(NI=c)},d=()=>{NI&&(NI=null)};return window.addEventListener("dragstart",b),window.addEventListener("dragend",d),{destroy(){window.removeEventListener("dragstart",b),window.removeEventListener("dragend",d)}}},props:{handleDOMEvents:{drop:(a,c)=>{if(g=e===a.dom.parentElement,b=c,!g){let a=NI;(null==a?void 0:a.isEditable)&&setTimeout(()=>{let b=a.state.selection;b&&a.commands.deleteRange({from:b.from,to:b.to})},10)}return!1},paste:(a,b)=>{var c;let d=null==(c=b.clipboardData)?void 0:c.getData("text/html");return h=b,f=!!(null==d?void 0:d.includes("data-pm-slice")),!1}}},appendTransaction:(b,c,d)=>{let e=b[0],j="paste"===e.getMeta("uiEvent")&&!f,k="drop"===e.getMeta("uiEvent")&&!g,l=e.getMeta("applyPasteRules"),m=!!l;if(!j&&!k&&!m)return;if(m){var n,o;let b,{text:c}=l;"string"==typeof c||(c=Nd(sJ.from(c),d.schema));let{from:e}=l,f=e+c.length;return i({rule:a,state:d,from:e,to:{b:f},pasteEvt:(n=c,null==(o=(b=new ClipboardEvent("paste",{clipboardData:new DataTransfer})).clipboardData)||o.setData("text/html",n),b)})}let p=c.doc.content.findDiffStart(d.doc.content),q=c.doc.content.findDiffEnd(d.doc.content);if("number"==typeof p&&q&&p!==q.b)return i({rule:a,state:d,from:p,to:q,pasteEvt:h})}}))}({editor:a,rules:b});d.push(...c)}}let j=Nb(b,"addProseMirrorPlugins",c);if(j){let a=j();d.push(...a)}return d})}get attributes(){return Ng(this.extensions)}get nodeViews(){let{editor:a}=this,{nodeExtensions:b}=Nf(this.extensions);return Object.fromEntries(b.filter(a=>!!Nb(a,"addNodeView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:Nq(b.name,this.schema)},e=Nb(b,"addNodeView",d);return e?[b.name,(d,f,g,h,i)=>{let j=Nh(d,c);return e()({node:d,view:f,getPos:g,decorations:h,innerDecorations:i,editor:a,extension:b,HTMLAttributes:j})}]:[]}))}get markViews(){let{editor:a}=this,{markExtensions:b}=Nf(this.extensions);return Object.fromEntries(b.filter(a=>!!Nb(a,"addMarkView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:Np(b.name,this.schema)},e=Nb(b,"addMarkView",d);return e?[b.name,(d,f,g)=>{let h=Nh(d,c);return e()({mark:d,view:f,inline:g,editor:a,extension:b,HTMLAttributes:h,updateAttributes:b=>{!function(a,b,c={}){let{state:d}=b,{doc:e,tr:f}=d;e.descendants((b,d)=>{let e=f.mapping.map(d),g=f.mapping.map(d)+b.nodeSize,h=null;if(b.marks.forEach(b=>{if(b!==a)return!1;h=b}),!h)return;let i=!1;if(Object.keys(c).forEach(a=>{c[a]!==h.attrs[a]&&(i=!0)}),i){let b=a.type.create({...a.attrs,...c});f.removeMark(e,g,a.type),f.addMark(e,g,b)}}),f.docChanged&&b.view.dispatch(f)}(d,a,b)}})}]:[]}))}setupExtensions(){let a=this.extensions;this.editor.extensionStorage=Object.fromEntries(a.map(a=>[a.name,a.storage])),a.forEach(a=>{var b;let c={name:a.name,options:a.options,storage:this.editor.extensionStorage[a.name],editor:this.editor,type:Nx(a.name,this.schema)};"mark"===a.type&&(null==(b=Ne(Nb(a,"keepOnSplit",c)))||b)&&this.splittableMarks.push(a.name);let d=Nb(a,"onBeforeCreate",c),e=Nb(a,"onCreate",c),f=Nb(a,"onUpdate",c),g=Nb(a,"onSelectionUpdate",c),h=Nb(a,"onTransaction",c),i=Nb(a,"onFocus",c),j=Nb(a,"onBlur",c),k=Nb(a,"onDestroy",c);d&&this.editor.on("beforeCreate",d),e&&this.editor.on("create",e),f&&this.editor.on("update",f),g&&this.editor.on("selectionUpdate",g),h&&this.editor.on("transaction",h),i&&this.editor.on("focus",i),j&&this.editor.on("blur",j),k&&this.editor.on("destroy",k)})}};NJ.resolve=Nm,NJ.sort=Nl,NJ.flatten=Nc,M5({},{ClipboardTextSerializer:()=>NL,Commands:()=>ON,Delete:()=>OO,Drop:()=>OP,Editable:()=>OQ,FocusEvents:()=>OS,Keymap:()=>OT,Paste:()=>OU,Tabindex:()=>OV,focusEventsPluginKey:()=>OR});var NK=class a extends NG{constructor(){super(...arguments),this.type="extension"}static create(b={}){return new a("function"==typeof b?b():b)}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},NL=NK.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new un({key:new uq("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:a}=this,{state:b,schema:c}=a,{doc:d,selection:e}=b,{ranges:f}=e,g=Math.min(...f.map(a=>a.$from.pos)),h=Math.max(...f.map(a=>a.$to.pos)),i=No(c);return Nn(d,{from:g,to:h},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:i})}}})]}}),NM={};M5(NM,{blur:()=>NN,clearContent:()=>NO,clearNodes:()=>NP,command:()=>NQ,createParagraphNear:()=>NR,cut:()=>NS,deleteCurrentNode:()=>NT,deleteNode:()=>NU,deleteRange:()=>NV,deleteSelection:()=>NW,enter:()=>NX,exitCode:()=>NY,extendMarkRange:()=>NZ,first:()=>N$,focus:()=>N0,forEach:()=>N1,insertContent:()=>N2,insertContentAt:()=>N3,joinBackward:()=>N6,joinDown:()=>N5,joinForward:()=>N7,joinItemBackward:()=>N8,joinItemForward:()=>N9,joinTextblockBackward:()=>Oa,joinTextblockForward:()=>Ob,joinUp:()=>N4,keyboardShortcut:()=>Od,lift:()=>Oe,liftEmptyBlock:()=>Of,liftListItem:()=>Og,newlineInCode:()=>Oh,resetAttributes:()=>Oj,scrollIntoView:()=>Ok,selectAll:()=>Ol,selectNodeBackward:()=>Om,selectNodeForward:()=>On,selectParentNode:()=>Oo,selectTextblockEnd:()=>Op,selectTextblockStart:()=>Oq,setContent:()=>Or,setMark:()=>Os,setMeta:()=>Ot,setNode:()=>Ou,setNodeSelection:()=>Ov,setTextSelection:()=>Ow,sinkListItem:()=>Ox,splitBlock:()=>Oz,splitListItem:()=>OA,toggleList:()=>OD,toggleMark:()=>OE,toggleNode:()=>OF,toggleWrap:()=>OG,undoInputRule:()=>OH,unsetAllMarks:()=>OI,unsetMark:()=>OJ,updateAttributes:()=>OK,wrapIn:()=>OL,wrapInList:()=>OM});var NN=()=>({editor:a,view:b})=>(requestAnimationFrame(()=>{var c;a.isDestroyed||(b.dom.blur(),null==(c=null==window?void 0:window.getSelection())||c.removeAllRanges())}),!0),NO=(a=!0)=>({commands:b})=>b.setContent("",{emitUpdate:a}),NP=()=>({state:a,tr:b,dispatch:c})=>{let{selection:d}=b,{ranges:e}=d;return!c||(e.forEach(({$from:c,$to:d})=>{a.doc.nodesBetween(c.pos,d.pos,(a,c)=>{if(a.type.isText)return;let{doc:d,mapping:e}=b,f=d.resolve(e.map(c)),g=d.resolve(e.map(c+a.nodeSize)),h=f.blockRange(g);if(!h)return;let i=tK(h);if(a.type.isTextblock){let{defaultType:a}=f.parent.contentMatchAt(f.index());b.setNodeMarkup(h.start,a)}(i||0===i)&&b.lift(h,i)})}),!0)},NQ=a=>b=>a(b),NR=()=>({state:a,dispatch:b})=>xp(a,b),NS=(a,b)=>({editor:c,tr:d})=>{let{state:e}=c,f=e.doc.slice(a.from,a.to);d.deleteRange(a.from,a.to);let g=d.mapping.map(b);return d.insert(g,f.content),d.setSelection(new t9(d.doc.resolve(Math.max(g-1,0)))),!0},NT=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,d=c.$anchor.node();if(d.content.size>0)return!1;let e=a.selection.$anchor;for(let c=e.depth;c>0;c-=1)if(e.node(c).type===d.type){if(b){let b=e.before(c),d=e.after(c);a.delete(b,d).scrollIntoView()}return!0}return!1},NU=a=>({tr:b,state:c,dispatch:d})=>{let e=Nq(a,c.schema),f=b.selection.$anchor;for(let a=f.depth;a>0;a-=1)if(f.node(a).type===e){if(d){let c=f.before(a),d=f.after(a);b.delete(c,d).scrollIntoView()}return!0}return!1},NV=a=>({tr:b,dispatch:c})=>{let{from:d,to:e}=a;return c&&b.delete(d,e),!0},NW=()=>({state:a,dispatch:b})=>w6(a,b),NX=()=>({commands:a})=>a.keyboardShortcut("Enter"),NY=()=>({state:a,dispatch:b})=>xo(a,b),NZ=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=Np(a,d.schema),{doc:g,selection:h}=c,{$from:i,from:j,to:k}=h;if(e){let a=Nw(i,f,b);if(a&&a.from<=j&&a.to>=k){let b=t9.create(g,a.from,a.to);c.setSelection(b)}}return!0},N$=a=>b=>{let c="function"==typeof a?a(b):a;for(let a=0;a<c.length;a+=1)if(c[a](b))return!0;return!1};function N_(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var N0=(a=null,b={})=>({editor:c,view:d,tr:e,dispatch:f})=>{b={scrollIntoView:!0,...b};let g=()=>{(N_()||"Android"===navigator.platform||/android/i.test(navigator.userAgent))&&d.dom.focus(),requestAnimationFrame(()=>{!c.isDestroyed&&(d.focus(),(null==b?void 0:b.scrollIntoView)&&c.commands.scrollIntoView())})};if(d.hasFocus()&&null===a||!1===a)return!0;if(f&&null===a&&!NC(c.state.selection))return g(),!0;let h=function(a,b=null){if(!b)return null;let c=t5.atStart(a),d=t5.atEnd(a);if("start"===b||!0===b)return c;if("end"===b)return d;let e=c.from,f=d.to;return"all"===b?t9.create(a,ND(0,e,f),ND(a.content.size,e,f)):t9.create(a,ND(b,e,f),ND(b,e,f))}(e.doc,a)||c.state.selection,i=c.state.selection.eq(h);return f&&(i||e.setSelection(h),i&&e.storedMarks&&e.setStoredMarks(e.storedMarks),g()),!0},N1=(a,b)=>c=>a.every((a,d)=>b(a,{...c,index:d})),N2=(a,b)=>({tr:c,commands:d})=>d.insertContentAt({from:c.selection.from,to:c.selection.to},a,b),N3=(a,b,c)=>({tr:d,dispatch:e,editor:f})=>{var g;if(e){let e,h;c={parseOptions:f.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...c};let i=a=>{f.emit("contentError",{editor:f,error:a,disableCollaboration:()=>{"collaboration"in f.storage&&"object"==typeof f.storage.collaboration&&f.storage.collaboration&&(f.storage.collaboration.isDisabled=!0)}})},j={preserveWhitespace:"full",...c.parseOptions};if(!c.errorOnInvalidContent&&!f.options.enableContentCheck&&f.options.emitContentError)try{M9(b,f.schema,{parseOptions:j,errorOnInvalidContent:!0})}catch(a){i(a)}try{e=M9(b,f.schema,{parseOptions:j,errorOnInvalidContent:null!=(g=c.errorOnInvalidContent)?g:f.options.enableContentCheck})}catch(a){return i(a),!1}let{from:k,to:l}="number"==typeof a?{from:a,to:a}:{from:a.from,to:a.to},m=!0,n=!0;if((!("type"in e)?e:[e]).forEach(a=>{a.check(),m=!!m&&a.isText&&0===a.marks.length,n=!!n&&a.isBlock}),k===l&&n){let{parent:a}=d.doc.resolve(k);!a.isTextblock||a.type.spec.code||a.childCount||(k-=1,l+=1)}if(m){if(Array.isArray(b))h=b.map(a=>a.text||"").join("");else if(b instanceof sJ){let a="";b.forEach(b=>{b.text&&(a+=b.text)}),h=a}else h="object"==typeof b&&b&&b.text?b.text:b;d.insertText(h,k,l)}else{h=e;let a=d.doc.resolve(k),b=a.node(),c=0===a.parentOffset,f=b.isText||b.isTextblock,g=b.content.size>0;c&&f&&g&&(k=Math.max(0,k-1)),d.replaceWith(k,l,h)}c.updateSelection&&function(a,b,c){let d=a.steps.length-1;if(d<b)return;let e=a.steps[d];if(!(e instanceof tG||e instanceof tH))return;let f=a.mapping.maps[d],g=0;f.forEach((a,b,c,d)=>{0===g&&(g=d)}),a.setSelection(t5.near(a.doc.resolve(g),-1))}(d,d.steps.length-1,0),c.applyInputRules&&d.setMeta("applyInputRules",{from:k,text:h}),c.applyPasteRules&&d.setMeta("applyPasteRules",{from:k,text:h})}return!0},N4=()=>({state:a,dispatch:b})=>xj(a,b),N5=()=>({state:a,dispatch:b})=>xk(a,b),N6=()=>({state:a,dispatch:b})=>w8(a,b),N7=()=>({state:a,dispatch:b})=>xg(a,b),N8=()=>({state:a,dispatch:b,tr:c})=>{try{let d=tS(a.doc,a.selection.$from.pos,-1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},N9=()=>({state:a,dispatch:b,tr:c})=>{try{let d=tS(a.doc,a.selection.$from.pos,1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},Oa=()=>({state:a,dispatch:b})=>w9(a,b),Ob=()=>({state:a,dispatch:b})=>xa(a,b);function Oc(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var Od=a=>({editor:b,view:c,tr:d,dispatch:e})=>{let f=(function(a){let b,c,d,e,f=a.split(/-(?!$)/),g=f[f.length-1];"Space"===g&&(g=" ");for(let a=0;a<f.length-1;a+=1){let g=f[a];if(/^(cmd|meta|m)$/i.test(g))e=!0;else if(/^a(lt)?$/i.test(g))b=!0;else if(/^(c|ctrl|control)$/i.test(g))c=!0;else if(/^s(hift)?$/i.test(g))d=!0;else if(/^mod$/i.test(g))N_()||Oc()?e=!0:c=!0;else throw Error(`Unrecognized modifier name: ${g}`)}return b&&(g=`Alt-${g}`),c&&(g=`Ctrl-${g}`),e&&(g=`Meta-${g}`),d&&(g=`Shift-${g}`),g})(a).split(/-(?!$)/),g=f.find(a=>!["Alt","Ctrl","Meta","Shift"].includes(a)),h=new KeyboardEvent("keydown",{key:"Space"===g?" ":g,altKey:f.includes("Alt"),ctrlKey:f.includes("Ctrl"),metaKey:f.includes("Meta"),shiftKey:f.includes("Shift"),bubbles:!0,cancelable:!0}),i=b.captureTransaction(()=>{c.someProp("handleKeyDown",a=>a(c,h))});return null==i||i.steps.forEach(a=>{let b=a.map(d.mapping);b&&e&&d.maybeStep(b)}),!0},Oe=(a,b={})=>({state:c,dispatch:d})=>{let e=Nq(a,c.schema);return!!Nz(c,e,b)&&xl(c,d)},Of=()=>({state:a,dispatch:b})=>xq(a,b),Og=a=>({state:b,dispatch:c})=>xE(Nq(a,b.schema))(b,c),Oh=()=>({state:a,dispatch:b})=>xm(a,b);function Oi(a,b){let c="string"==typeof b?[b]:b;return Object.keys(a).reduce((b,d)=>(c.includes(d)||(b[d]=a[d]),b),{})}var Oj=(a,b)=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=Nr("string"==typeof a?a:a.name,d.schema);return!!h&&("node"===h&&(f=Nq(a,d.schema)),"mark"===h&&(g=Np(a,d.schema)),e&&c.selection.ranges.forEach(a=>{d.doc.nodesBetween(a.$from.pos,a.$to.pos,(a,d)=>{f&&f===a.type&&c.setNodeMarkup(d,void 0,Oi(a.attrs,b)),g&&a.marks.length&&a.marks.forEach(e=>{g===e.type&&c.addMark(d,d+a.nodeSize,g.create(Oi(e.attrs,b)))})})}),!0)},Ok=()=>({tr:a,dispatch:b})=>(b&&a.scrollIntoView(),!0),Ol=()=>({tr:a,dispatch:b})=>{if(b){let b=new ud(a.doc);a.setSelection(b)}return!0},Om=()=>({state:a,dispatch:b})=>xd(a,b),On=()=>({state:a,dispatch:b})=>xh(a,b),Oo=()=>({state:a,dispatch:b})=>xr(a,b),Op=()=>({state:a,dispatch:b})=>xv(a,b),Oq=()=>({state:a,dispatch:b})=>xu(a,b),Or=(a,{errorOnInvalidContent:b,emitUpdate:c=!0,parseOptions:d={}}={})=>({editor:e,tr:f,dispatch:g,commands:h})=>{let{doc:i}=f;if("full"!==d.preserveWhitespace){let h=function(a,b,c={},d={}){return M9(a,b,{slice:!1,parseOptions:c,errorOnInvalidContent:d.errorOnInvalidContent})}(a,e.schema,d,{errorOnInvalidContent:null!=b?b:e.options.enableContentCheck});return g&&f.replaceWith(0,i.content.size,h).setMeta("preventUpdate",!c),!0}return g&&f.setMeta("preventUpdate",!c),h.insertContentAt({from:0,to:i.content.size},a,{parseOptions:d,errorOnInvalidContent:null!=b?b:e.options.enableContentCheck})},Os=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let{selection:f}=c,{empty:g,ranges:h}=f,i=Np(a,d.schema);if(e)if(g){let a=function(a,b){let c=Np(b,a.schema),{from:d,to:e,empty:f}=a.selection,g=[];f?(a.storedMarks&&g.push(...a.storedMarks),g.push(...a.selection.$head.marks())):a.doc.nodesBetween(d,e,a=>{g.push(...a.marks)});let h=g.find(a=>a.type.name===c.name);return h?{...h.attrs}:{}}(d,i);c.addStoredMark(i.create({...a,...b}))}else h.forEach(a=>{let e=a.$from.pos,f=a.$to.pos;d.doc.nodesBetween(e,f,(a,d)=>{let g=Math.max(d,e),h=Math.min(d+a.nodeSize,f);a.marks.find(a=>a.type===i)?a.marks.forEach(a=>{i===a.type&&c.addMark(g,h,i.create({...a.attrs,...b}))}):c.addMark(g,h,i.create(b))})});return function(a,b,c){var d;let{selection:e}=b,f=null;if(NC(e)&&(f=e.$cursor),f){let b=null!=(d=a.storedMarks)?d:f.marks();return f.parent.type.allowsMarkType(c)&&(!!c.isInSet(b)||!b.some(a=>a.type.excludes(c)))}let{ranges:g}=e;return g.some(({$from:b,$to:d})=>{let e=0===b.depth&&a.doc.inlineContent&&a.doc.type.allowsMarkType(c);return a.doc.nodesBetween(b.pos,d.pos,(a,b,d)=>{if(e)return!1;if(a.isInline){let b=!d||d.type.allowsMarkType(c),f=!!c.isInSet(a.marks)||!a.marks.some(a=>a.type.excludes(c));e=b&&f}return!e}),e})}(d,c,i)},Ot=(a,b)=>({tr:c})=>(c.setMeta(a,b),!0),Ou=(a,b={})=>({state:c,dispatch:d,chain:e})=>{let f,g=Nq(a,c.schema);return(c.selection.$anchor.sameParent(c.selection.$head)&&(f=c.selection.$anchor.parent.attrs),g.isTextblock)?e().command(({commands:a})=>!!xx(g,{...f,...b})(c)||a.clearNodes()).command(({state:a})=>xx(g,{...f,...b})(a,d)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Ov=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,d=ND(a,0,c.content.size),e=ub.create(c,d);b.setSelection(e)}return!0},Ow=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,{from:d,to:e}="number"==typeof a?{from:a,to:a}:a,f=t9.atStart(c).from,g=t9.atEnd(c).to,h=ND(d,f,g),i=ND(e,f,g),j=t9.create(c,h,i);b.setSelection(j)}return!0},Ox=a=>({state:b,dispatch:c})=>xF(Nq(a,b.schema))(b,c);function Oy(a,b){let c=a.storedMarks||a.selection.$to.parentOffset&&a.selection.$from.marks();if(c){let d=c.filter(a=>null==b?void 0:b.includes(a.type.name));a.tr.ensureMarks(d)}}var Oz=({keepMarks:a=!0}={})=>({tr:b,state:c,dispatch:d,editor:e})=>{let{selection:f,doc:g}=b,{$from:h,$to:i}=f,j=Ny(e.extensionManager.attributes,h.node().type.name,h.node().attrs);if(f instanceof ub&&f.node.isBlock)return!!h.parentOffset&&!!tP(g,h.pos)&&(d&&(a&&Oy(c,e.extensionManager.splittableMarks),b.split(h.pos).scrollIntoView()),!0);if(!h.parent.isBlock)return!1;let k=i.parentOffset===i.parent.content.size,l=0===h.depth?void 0:function(a){for(let b=0;b<a.edgeCount;b+=1){let{type:c}=a.edge(b);if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}(h.node(-1).contentMatchAt(h.indexAfter(-1))),m=k&&l?[{type:l,attrs:j}]:void 0,n=tP(b.doc,b.mapping.map(h.pos),1,m);if(!m&&!n&&tP(b.doc,b.mapping.map(h.pos),1,l?[{type:l}]:void 0)&&(n=!0,m=l?[{type:l,attrs:j}]:void 0),d){if(n&&(f instanceof t9&&b.deleteSelection(),b.split(b.mapping.map(h.pos),1,m),l&&!k&&!h.parentOffset&&h.parent.type!==l)){let a=b.mapping.map(h.before()),c=b.doc.resolve(a);h.node(-1).canReplaceWith(c.index(),c.index()+1,l)&&b.setNodeMarkup(b.mapping.map(h.before()),l)}a&&Oy(c,e.extensionManager.splittableMarks),b.scrollIntoView()}return n},OA=(a,b={})=>({tr:c,state:d,dispatch:e,editor:f})=>{var g;let h=Nq(a,d.schema),{$from:i,$to:j}=d.selection,k=d.selection.node;if(k&&k.isBlock||i.depth<2||!i.sameParent(j))return!1;let l=i.node(-1);if(l.type!==h)return!1;let m=f.extensionManager.attributes;if(0===i.parent.content.size&&i.node(-1).childCount===i.indexAfter(-1)){if(2===i.depth||i.node(-3).type!==h||i.index(-2)!==i.node(-2).childCount-1)return!1;if(e){let a=sJ.empty,d=i.index(-1)?1:i.index(-2)?2:3;for(let b=i.depth-d;b>=i.depth-3;b-=1)a=sJ.from(i.node(b).copy(a));let e=i.indexAfter(-1)<i.node(-2).childCount?1:i.indexAfter(-2)<i.node(-3).childCount?2:3,f={...Ny(m,i.node().type.name,i.node().attrs),...b},j=(null==(g=h.contentMatch.defaultType)?void 0:g.createAndFill(f))||void 0;a=a.append(sJ.from(h.createAndFill(null,j)||void 0));let k=i.before(i.depth-(d-1));c.replace(k,i.after(-e),new sP(a,4-d,0));let l=-1;c.doc.nodesBetween(k,c.doc.content.size,(a,b)=>{if(l>-1)return!1;a.isTextblock&&0===a.content.size&&(l=b+1)}),l>-1&&c.setSelection(t9.near(c.doc.resolve(l))),c.scrollIntoView()}return!0}let n=j.pos===i.end()?l.contentMatchAt(0).defaultType:null,o={...Ny(m,l.type.name,l.attrs),...b},p={...Ny(m,i.node().type.name,i.node().attrs),...b};c.delete(i.pos,j.pos);let q=n?[{type:h,attrs:o},{type:n,attrs:p}]:[{type:h,attrs:o}];if(!tP(c.doc,i.pos,2))return!1;if(e){let{selection:a,storedMarks:b}=d,{splittableMarks:g}=f.extensionManager,h=b||a.$to.parentOffset&&a.$from.marks();if(c.split(i.pos,2,q).scrollIntoView(),!h||!e)return!0;let j=h.filter(a=>g.includes(a.type.name));c.ensureMarks(j)}return!0},OB=(a,b)=>{let c=Na(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(Math.max(0,c.pos-1)).before(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&tQ(a.doc,c.pos))||(a.join(c.pos),!0)},OC=(a,b)=>{let c=Na(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(c.start).after(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&tQ(a.doc,d))||(a.join(d),!0)},OD=(a,b,c,d={})=>({editor:e,tr:f,state:g,dispatch:h,chain:i,commands:j,can:k})=>{let{extensions:l,splittableMarks:m}=e.extensionManager,n=Nq(a,g.schema),o=Nq(b,g.schema),{selection:p,storedMarks:q}=g,{$from:r,$to:s}=p,t=r.blockRange(s),u=q||p.$to.parentOffset&&p.$from.marks();if(!t)return!1;let v=Na(a=>NB(a.type.name,l))(p);if(t.depth>=1&&v&&t.depth-v.depth<=1){if(v.node.type===n)return j.liftListItem(o);if(NB(v.node.type.name,l)&&n.validContent(v.node.content)&&h)return i().command(()=>(f.setNodeMarkup(v.pos,n),!0)).command(()=>OB(f,n)).command(()=>OC(f,n)).run()}return c&&u&&h?i().command(()=>{let a=k().wrapInList(n,d),b=u.filter(a=>m.includes(a.type.name));return f.ensureMarks(b),!!a||j.clearNodes()}).wrapInList(n,d).command(()=>OB(f,n)).command(()=>OC(f,n)).run():i().command(()=>!!k().wrapInList(n,d)||j.clearNodes()).wrapInList(n,d).command(()=>OB(f,n)).command(()=>OC(f,n)).run()},OE=(a,b={},c={})=>({state:d,commands:e})=>{let{extendEmptyMarkRange:f=!1}=c,g=Np(a,d.schema);return!function(a,b,c={}){let{empty:d,ranges:e}=a.selection,f=b?Np(b,a.schema):null;if(d)return!!(a.storedMarks||a.selection.$from.marks()).filter(a=>!f||f.name===a.type.name).find(a=>Nt(a.attrs,c,{strict:!1}));let g=0,h=[];if(e.forEach(({$from:b,$to:c})=>{let d=b.pos,e=c.pos;a.doc.nodesBetween(d,e,(a,b)=>{if(!a.isText&&!a.marks.length)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);g+=f-c,h.push(...a.marks.map(a=>({mark:a,from:c,to:f})))})}),0===g)return!1;let i=h.filter(a=>!f||f.name===a.mark.type.name).filter(a=>Nt(a.mark.attrs,c,{strict:!1})).reduce((a,b)=>a+b.to-b.from,0),j=h.filter(a=>!f||a.mark.type!==f&&a.mark.type.excludes(f)).reduce((a,b)=>a+b.to-b.from,0);return(i>0?i+j:i)>=g}(d,g,b)?e.setMark(g,b):e.unsetMark(g,{extendEmptyMarkRange:f})},OF=(a,b,c={})=>({state:d,commands:e})=>{let f,g=Nq(a,d.schema),h=Nq(b,d.schema),i=Nz(d,g,c);return(d.selection.$anchor.sameParent(d.selection.$head)&&(f=d.selection.$anchor.parent.attrs),i)?e.setNode(h,f):e.setNode(g,{...f,...c})},OG=(a,b={})=>({state:c,commands:d})=>{let e=Nq(a,c.schema);return Nz(c,e,b)?d.lift(e):d.wrapIn(e,b)},OH=()=>({state:a,dispatch:b})=>{let c=a.plugins;for(let d=0;d<c.length;d+=1){let e,f=c[d];if(f.spec.isInputRules&&(e=f.getState(a))){if(b){let b=a.tr,c=e.transform;for(let a=c.steps.length-1;a>=0;a-=1)b.step(c.steps[a].invert(c.docs[a]));if(e.text){let c=b.doc.resolve(e.from).marks();b.replaceWith(e.from,e.to,a.schema.text(e.text,c))}else b.delete(e.from,e.to)}return!0}}return!1},OI=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,{empty:d,ranges:e}=c;return!!d||(b&&e.forEach(b=>{a.removeMark(b.$from.pos,b.$to.pos)}),!0)},OJ=(a,b={})=>({tr:c,state:d,dispatch:e})=>{var f;let{extendEmptyMarkRange:g=!1}=b,{selection:h}=c,i=Np(a,d.schema),{$from:j,empty:k,ranges:l}=h;if(!e)return!0;if(k&&g){let{from:a,to:b}=h,d=null==(f=j.marks().find(a=>a.type===i))?void 0:f.attrs,e=Nw(j,i,d);e&&(a=e.from,b=e.to),c.removeMark(a,b,i)}else l.forEach(a=>{c.removeMark(a.$from.pos,a.$to.pos,i)});return c.removeStoredMark(i),!0},OK=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=Nr("string"==typeof a?a:a.name,d.schema);return!!h&&("node"===h&&(f=Nq(a,d.schema)),"mark"===h&&(g=Np(a,d.schema)),e&&c.selection.ranges.forEach(a=>{let e,h,i,j,k=a.$from.pos,l=a.$to.pos;c.selection.empty?d.doc.nodesBetween(k,l,(a,b)=>{f&&f===a.type&&(i=Math.max(b,k),j=Math.min(b+a.nodeSize,l),e=b,h=a)}):d.doc.nodesBetween(k,l,(a,d)=>{d<k&&f&&f===a.type&&(i=Math.max(d,k),j=Math.min(d+a.nodeSize,l),e=d,h=a),d>=k&&d<=l&&(f&&f===a.type&&c.setNodeMarkup(d,void 0,{...a.attrs,...b}),g&&a.marks.length&&a.marks.forEach(e=>{if(g===e.type){let f=Math.max(d,k),h=Math.min(d+a.nodeSize,l);c.addMark(f,h,g.create({...e.attrs,...b}))}}))}),h&&(void 0!==e&&c.setNodeMarkup(e,void 0,{...h.attrs,...b}),g&&h.marks.length&&h.marks.forEach(a=>{g===a.type&&c.addMark(i,j,g.create({...a.attrs,...b}))}))}),!0)},OL=(a,b={})=>({state:c,dispatch:d})=>xw(Nq(a,c.schema),b)(c,d),OM=(a,b={})=>({state:c,dispatch:d})=>xD(Nq(a,c.schema),b)(c,d),ON=NK.create({name:"commands",addCommands:()=>({...NM})}),OO=NK.create({name:"delete",onUpdate({transaction:a,appendedTransactions:b}){var c,d,e;let f=()=>{var c,d,e,f,g,h;let i;if(null!=(f=null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.filterTransaction)?void 0:e.call(d,a))?f:a.getMeta("y-sync$"))return;let j=(g=a.before,h=[a,...b],i=new t3(g),h.forEach(a=>{a.steps.forEach(a=>{i.step(a)})}),i);(function(a){let b,{mapping:c,steps:d}=a,e=[];return c.maps.forEach((a,b)=>{let f=[];if(a.ranges.length)a.forEach((a,b)=>{f.push({from:a,to:b})});else{let{from:a,to:c}=d[b];if(void 0===a||void 0===c)return;f.push({from:a,to:c})}f.forEach(({from:a,to:d})=>{let f=c.slice(b).map(a,-1),g=c.slice(b).map(d),h=c.invert().map(f,-1),i=c.invert().map(g);e.push({oldRange:{from:h,to:i},newRange:{from:f,to:g}})})}),1===(b=function(a,b=JSON.stringify){let c={};return a.filter(a=>{let d=b(a);return!Object.prototype.hasOwnProperty.call(c,d)&&(c[d]=!0)})}(e)).length?b:b.filter((a,c)=>!b.filter((a,b)=>b!==c).some(b=>a.oldRange.from>=b.oldRange.from&&a.oldRange.to<=b.oldRange.to&&a.newRange.from>=b.newRange.from&&a.newRange.to<=b.newRange.to))})(j).forEach(b=>{j.mapping.mapResult(b.oldRange.from).deletedAfter&&j.mapping.mapResult(b.oldRange.to).deletedBefore&&j.before.nodesBetween(b.oldRange.from,b.oldRange.to,(c,d)=>{let e=d+c.nodeSize-2,f=b.oldRange.from<=d&&e<=b.oldRange.to;this.editor.emit("delete",{type:"node",node:c,from:d,to:e,newFrom:j.mapping.map(d),newTo:j.mapping.map(e),deletedRange:b.oldRange,newRange:b.newRange,partial:!f,editor:this.editor,transaction:a,combinedTransform:j})})});let k=j.mapping;j.steps.forEach((b,c)=>{var d,e;if(b instanceof tD){let f=k.slice(c).map(b.from,-1),g=k.slice(c).map(b.to),h=k.invert().map(f,-1),i=k.invert().map(g),l=null==(d=j.doc.nodeAt(f-1))?void 0:d.marks.some(a=>a.eq(b.mark)),m=null==(e=j.doc.nodeAt(g))?void 0:e.marks.some(a=>a.eq(b.mark));this.editor.emit("delete",{type:"mark",mark:b.mark,from:b.from,to:b.to,deletedRange:{from:h,to:i},newRange:{from:f,to:g},partial:!!(m||l),editor:this.editor,transaction:a,combinedTransform:j})}})};null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.async)||e?setTimeout(f,0):f()}}),OP=NK.create({name:"drop",addProseMirrorPlugins(){return[new un({key:new uq("tiptapDrop"),props:{handleDrop:(a,b,c,d)=>{this.editor.emit("drop",{editor:this.editor,event:b,slice:c,moved:d})}}})]}}),OQ=NK.create({name:"editable",addProseMirrorPlugins(){return[new un({key:new uq("editable"),props:{editable:()=>this.editor.options.editable}})]}}),OR=new uq("focusEvents"),OS=NK.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:a}=this;return[new un({key:OR,props:{handleDOMEvents:{focus:(b,c)=>{a.isFocused=!0;let d=a.state.tr.setMeta("focus",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1},blur:(b,c)=>{a.isFocused=!1;let d=a.state.tr.setMeta("blur",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1}}}})]}}),OT=NK.create({name:"keymap",addKeyboardShortcuts(){let a=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:b})=>{let{selection:c,doc:d}=b,{empty:e,$anchor:f}=c,{pos:g,parent:h}=f,i=f.parent.isTextblock&&g>0?b.doc.resolve(g-1):f,j=i.parent.type.spec.isolating,k=f.pos-f.parentOffset,l=j&&1===i.parent.childCount?k===f.pos:t5.atStart(d).from===g;return!!e&&!!h.type.isTextblock&&!h.textContent.length&&!!l&&(!l||"paragraph"!==f.parent.type.name)&&a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),b=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),c={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:a,"Mod-Backspace":a,"Shift-Backspace":a,Delete:b,"Mod-Delete":b,"Mod-a":()=>this.editor.commands.selectAll()},d={...c},e={...c,"Ctrl-h":a,"Alt-Backspace":a,"Ctrl-d":b,"Ctrl-Alt-Backspace":b,"Alt-Delete":b,"Alt-d":b,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return N_()||Oc()?e:d},addProseMirrorPlugins(){return[new un({key:new uq("clearDocument"),appendTransaction:(a,b,c)=>{if(a.some(a=>a.getMeta("composition")))return;let d=a.some(a=>a.docChanged)&&!b.doc.eq(c.doc),e=a.some(a=>a.getMeta("preventClearDocument"));if(!d||e)return;let{empty:f,from:g,to:h}=b.selection,i=t5.atStart(b.doc).from,j=t5.atEnd(b.doc).to;if(f||g!==i||h!==j||!function a(b,{checkChildren:c=!0,ignoreWhitespace:d=!1}={}){var e;if(d){if("hardBreak"===b.type.name)return!0;if(b.isText)return/^\s*$/m.test(null!=(e=b.text)?e:"")}if(b.isText)return!b.text;if(b.isAtom||b.isLeaf)return!1;if(0===b.content.childCount)return!0;if(c){let e=!0;return b.content.forEach(b=>{!1!==e&&(a(b,{ignoreWhitespace:d,checkChildren:c})||(e=!1))}),e}return!1}(c.doc))return;let k=c.tr,l=M6({state:c,transaction:k}),{commands:m}=new M7({editor:this.editor,state:l});if(m.clearNodes(),k.steps.length)return k}})]}}),OU=NK.create({name:"paste",addProseMirrorPlugins(){return[new un({key:new uq("tiptapPaste"),props:{handlePaste:(a,b,c)=>{this.editor.emit("paste",{editor:this.editor,event:b,slice:c})}}})]}}),OV=NK.create({name:"tabindex",addProseMirrorPlugins(){return[new un({key:new uq("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});function OW({textEditor:a,onEditLinkStart:b}){let c=F0(),d=zQ(),[e,f]=(0,eQ.useState)(0);return(0,eQ.useEffect)(function(){function b(){f(a=>a+1)}a.on("update",b),a.on("selectionUpdate",b)},[a]),(0,eQ.useEffect)(()=>{function a(a){b&&kg(a)&&a.shiftKey&&"k"===a.key&&(a.preventDefault(),b())}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[b]),(0,eQ.useMemo)(()=>{function d(b,d){a.view&&(c("rich-text",{operation:b,source:"rich-text-menu"}),a.chain().focus()[d]().run())}return[{name:"bold",onSelect(){d("bold","toggleBold")}},{name:"italic",onSelect(){d("bold","toggleItalic")}},{name:"code",onSelect(){d("bold","toggleCode")}},b?{name:"link",onSelect(){b()}}:void 0,{name:"bulletList",onSelect(){d("bulletList","toggleBulletList")}},{name:"highlight",onSelect(){d("bulletList","toggleHighlight")}}].filter(Boolean)},[a,c,b]).map(({name:b,attrs:c,onSelect:e})=>{let f=!!a.view&&a.isActive(b,c);return(0,bT.jsx)(Ht,{title:d(`tool.rich-text-${b}`),"data-testid":`rich-text.${b}`,type:"icon",isActive:f,onPointerDown:kb,onClick:e,role:"option","aria-pressed":f,children:(0,bT.jsx)(BV,{small:!0,icon:b})},b)})}function OX({textEditor:a,value:b,onClose:c}){let d=kp(),[e,f]=(0,eQ.useState)(b),g=zQ(),h=(0,eQ.useRef)(null),i=F0(),j="rich-text-menu",k=e.startsWith("http")?e:`https://${e}`;return(0,eQ.useEffect)(()=>{h.current?.focus()},[e]),(0,eQ.useEffect)(()=>{f(b)},[b]),(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(B_,{ref:h,"data-testid":"rich-text.link-input",className:"tlui-rich-text__toolbar-link-input",value:e,onValueChange:a=>f(a),onComplete:b=>{i("rich-text",{operation:"link-edit",source:j}),b.startsWith("http://")||b.startsWith("https://")||(b=`https://${b}`),a.chain().setLink({href:b}).run(),d.getInstanceState().isCoarsePointer?a.commands.blur():a.commands.focus(),c()},onCancel:()=>c(),placeholder:"example.com","aria-label":"example.com"}),(0,bT.jsx)(zS,{className:"tlui-rich-text__toolbar-link-visit",title:g("tool.rich-text-link-visit"),type:"icon",onPointerDown:kb,onClick:()=>{i("rich-text",{operation:"link-visit",source:j}),zw(k,"_blank"),c()},disabled:!e,children:(0,bT.jsx)(BV,{small:!0,icon:"external-link"})}),(0,bT.jsx)(zS,{className:"tlui-rich-text__toolbar-link-remove",title:g("tool.rich-text-link-remove"),"data-testid":"rich-text.link-remove",type:"icon",onPointerDown:kb,onClick:()=>{i("rich-text",{operation:"link-remove",source:j}),a.chain().unsetLink().focus().run(),c()},children:(0,bT.jsx)(BV,{small:!0,icon:"trash"})})]})}let OY=eV(function({children:a}){let b=kp(),c=e$("textEditor",()=>b.getRichTextEditor(),[b]);return b.getInstanceState().isCoarsePointer||!c?null:(0,bT.jsx)(OZ,{textEditor:c,children:a})});function OZ({textEditor:a,children:b}){let{isEditingLink:c,onEditLinkStart:d,onEditLinkClose:e}=function(a){let[b,c]=(0,eQ.useState)(!1);(0,eQ.useEffect)(()=>{if(!a)return void c(!1);let b=()=>{c(a.isActive("link"))};return a.view.dom.addEventListener("click",b),()=>{a.isInitialized&&a.view.dom.removeEventListener("click",b)}},[a,b]),(0,eQ.useEffect)(()=>{if(a&&a.isActive("link"))try{let{from:b,to:c}=Nw(a.state.doc.resolve(a.state.selection.from),a.schema.marks.link);a.state.selection.empty&&a.commands.setTextSelection({from:b,to:c})}catch{}},[a,b]);let d=(0,eQ.useCallback)(()=>{c(!0)},[]),e=(0,eQ.useCallback)(()=>{c(!1)},[]);return{isEditingLink:b,onEditLinkStart:d,onEditLinkClose:(0,eQ.useCallback)(()=>{if(c(!1),!a)return;let b=a.state.selection.from;a.commands.setTextSelection({from:b,to:b})},[a]),onEditLinkCancel:e}}(a),[f,g]=(0,eQ.useState)(null),h=(0,eQ.useRef)(),i=function(a){let[b,c]=(0,eQ.useState)(!1);return(0,eQ.useEffect)(()=>{if(!a)return;let b=cm(({isPointing:a})=>{c(a)},16),d=()=>b({isPointing:!0}),e=()=>b({isPointing:!1}),f=["touchstart","pointerdown","mousedown"],g=["touchend","pointerup","mouseup"];return f.forEach(b=>{a.view.dom.addEventListener(b,d)}),g.forEach(a=>{document.body.addEventListener(a,e)}),()=>{f.forEach(b=>{a.isInitialized&&a.view.dom.removeEventListener(b,d)}),g.forEach(a=>{document.body.removeEventListener(a,e)})}},[a]),b}(a),j=zQ(),k=(0,eQ.useCallback)(()=>{if(c)return h.current;let a=window.getSelection();if(!f||!a||0===a.rangeCount||a.isCollapsed)return;let b=[];for(let c=0;c<a.rangeCount;c++){let d=a.getRangeAt(c);b.push(MU(d.getBoundingClientRect()))}let d=lh.Common(b);return h.current=d,d},[f,c]);return(0,eQ.useEffect)(()=>{let b=({editor:a})=>g(a.state.selection);return a.on("selectionUpdate",b),b({editor:a}),()=>{a.off("selectionUpdate",b)}},[a]),(0,bT.jsx)(MT,{className:"tlui-rich-text__toolbar",getSelectionBounds:k,isMousingDown:i,changeOnlyWhenYChanges:!0,label:j("tool.rich-text-toolbar-title"),children:b||(c?(0,bT.jsx)(OX,{textEditor:a,value:a.isActive("link")?a.getAttributes("link").href:"",onClose:e}):(0,bT.jsx)(OW,{textEditor:a,onEditLinkStart:d}))})}function O$(){let a=kp(),b=zQ(),{orientation:c}=GP(),d=LJ(),e=d?.get(hm),f=hl({isDarkMode:a.user.getIsDarkMode()}),g=e?.type==="shared"?hp(f,e.value,"solid"):hp(f,"black","solid"),h=e$("disable style panel",()=>a.isInAny("hand","zoom","eraser","laser"),[a]),i=(0,eQ.useCallback)(b=>{b||a.updateInstanceState({isChangingStyle:!1})},[a]),{StylePanel:j}=Qa();return j?(0,bT.jsxs)(I5,{id:"mobile style menu",onOpenChange:i,children:[(0,bT.jsx)(I6,{children:(0,bT.jsx)(zS,{type:"tool","data-testid":"mobile-styles.button",style:{color:h?"var(--tl-color-muted-1)":g},title:b("style-panel.title"),disabled:h,children:(0,bT.jsx)(BV,{icon:h?"blob":e?.type==="mixed"?"mixed":"blob"})})}),(0,bT.jsx)(I7,{side:"horizontal"===c?"top":"right",align:"end",children:j&&(0,bT.jsx)(j,{isMobile:!0})})]}):null}function O_(){return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(O1,{}),(0,bT.jsx)(O2,{}),(0,bT.jsx)(O3,{}),(0,bT.jsx)(O4,{}),(0,bT.jsx)(O5,{}),(0,bT.jsx)(O6,{}),(0,bT.jsx)(O7,{}),(0,bT.jsx)(O8,{}),(0,bT.jsx)(O9,{}),(0,bT.jsx)(Pa,{}),(0,bT.jsx)(Pc,{}),(0,bT.jsx)(Pb,{}),(0,bT.jsx)(Pf,{}),(0,bT.jsx)(Pi,{}),(0,bT.jsx)(Pd,{}),(0,bT.jsx)(Ph,{}),(0,bT.jsx)(Pg,{}),(0,bT.jsx)(Pe,{}),(0,bT.jsx)(Pj,{}),(0,bT.jsx)(Pk,{}),(0,bT.jsx)(Pl,{}),(0,bT.jsx)(Pm,{}),(0,bT.jsx)(Pn,{}),(0,bT.jsx)(Po,{}),(0,bT.jsx)(Pp,{}),(0,bT.jsx)(Pq,{}),(0,bT.jsx)(Ps,{}),(0,bT.jsx)(Pr,{})]})}function O0({tool:a}){var b;let c,d,e=(b=IB()[a],c=kp(),d=b?.meta?.geo,e$("is tool selected",()=>{if(!b)return!1;let a=c.getCurrentToolId();return"geo"===a?d===c.getSharedStyles().getAsKnownValue(iQ):a===b.id},[c,b?.id,d]));return(0,bT.jsx)(ID,{toolId:a,isSelected:e})}function O1(){return(0,bT.jsx)(O0,{tool:"select"})}function O2(){return(0,bT.jsx)(O0,{tool:"hand"})}function O3(){return(0,bT.jsx)(O0,{tool:"draw"})}function O4(){return(0,bT.jsx)(O0,{tool:"eraser"})}function O5(){return(0,bT.jsx)(O0,{tool:"arrow"})}function O6(){return(0,bT.jsx)(O0,{tool:"text"})}function O7(){return(0,bT.jsx)(O0,{tool:"note"})}function O8(){return(0,bT.jsx)(ID,{toolId:"asset"})}function O9(){return(0,bT.jsx)(O0,{tool:"rectangle"})}function Pa(){return(0,bT.jsx)(O0,{tool:"ellipse"})}function Pb(){return(0,bT.jsx)(O0,{tool:"diamond"})}function Pc(){return(0,bT.jsx)(O0,{tool:"triangle"})}function Pd(){return(0,bT.jsx)(O0,{tool:"rhombus"})}function Pe(){return(0,bT.jsx)(O0,{tool:"heart"})}function Pf(){return(0,bT.jsx)(O0,{tool:"hexagon"})}function Pg(){return(0,bT.jsx)(O0,{tool:"cloud"})}function Ph(){return(0,bT.jsx)(O0,{tool:"star"})}function Pi(){return(0,bT.jsx)(O0,{tool:"oval"})}function Pj(){return(0,bT.jsx)(O0,{tool:"x-box"})}function Pk(){return(0,bT.jsx)(O0,{tool:"check-box"})}function Pl(){return(0,bT.jsx)(O0,{tool:"arrow-left"})}function Pm(){return(0,bT.jsx)(O0,{tool:"arrow-up"})}function Pn(){return(0,bT.jsx)(O0,{tool:"arrow-down"})}function Po(){return(0,bT.jsx)(O0,{tool:"arrow-right"})}function Pp(){return(0,bT.jsx)(O0,{tool:"line"})}function Pq(){return(0,bT.jsx)(O0,{tool:"highlight"})}function Pr(){return(0,bT.jsx)(O0,{tool:"frame"})}function Ps(){return(0,bT.jsx)(O0,{tool:"laser"})}let Pt="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function Pu(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on".concat(b),c)}function Pv(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on".concat(b),c)}function Pw(a,b){let c=b.slice(0,b.length-1);for(let b=0;b<c.length;b++)c[b]=a[c[b].toLowerCase()];return c}function Px(a){"string"!=typeof a&&(a="");let b=(a=a.replace(/\s/g,"")).split(","),c=b.lastIndexOf("");for(;c>=0;)b[c-1]+=",",b.splice(c,1),c=b.lastIndexOf("");return b}let Py={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Pt?173:189,"=":Pt?61:187,";":Pt?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Pz={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},PA={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},PB={16:!1,18:!1,17:!1,91:!1},PC={};for(let a=1;a<20;a++)Py["f".concat(a)]=111+a;let PD=[],PE=null,PF="all",PG=new Map,PH=a=>Py[a.toLowerCase()]||Pz[a.toLowerCase()]||a.toUpperCase().charCodeAt(0);function PI(a){PF=a||"all"}function PJ(){return PF||"all"}function PK(a){if(void 0===a)Object.keys(PC).forEach(a=>{Array.isArray(PC[a])&&PC[a].forEach(a=>PL(a)),delete PC[a]}),PP(null);else if(Array.isArray(a))a.forEach(a=>{a.key&&PL(a)});else if("object"==typeof a)a.key&&PL(a);else if("string"==typeof a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];let[e,f]=c;"function"==typeof e&&(f=e,e=""),PL({key:a,scope:e,method:f,splitKey:"+"})}}let PL=a=>{let{key:b,scope:c,method:d,splitKey:e="+"}=a;Px(b).forEach(a=>{let b=a.split(e),f=b.length,g=b[f-1],h="*"===g?"*":PH(g);if(!PC[h])return;c||(c=PJ());let i=f>1?Pw(Pz,b):[],j=[];PC[h]=PC[h].filter(a=>{let b=(!d||a.method===d)&&a.scope===c&&function(a,b){let c=a.length>=b.length?a:b,d=a.length>=b.length?b:a,e=!0;for(let a=0;a<c.length;a++)-1===d.indexOf(c[a])&&(e=!1);return e}(a.mods,i);return b&&j.push(a.element),!b}),j.forEach(a=>PP(a))})};function PM(a,b,c,d){let e;if(b.element===d&&(b.scope===c||"all"===b.scope)){for(let a in e=b.mods.length>0,PB)Object.prototype.hasOwnProperty.call(PB,a)&&(!PB[a]&&b.mods.indexOf(+a)>-1||PB[a]&&-1===b.mods.indexOf(+a))&&(e=!1);(0!==b.mods.length||PB[16]||PB[18]||PB[17]||PB[91])&&!e&&"*"!==b.shortcut||(b.keys=[],b.keys=b.keys.concat(PD),!1===b.method(a,b)&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0)))}}function PN(a,b){let c=PC["*"],d=a.keyCode||a.which||a.charCode;if(a.key&&"capslock"===a.key.toLowerCase()||!PO.filter.call(this,a))return;if((93===d||224===d)&&(d=91),-1===PD.indexOf(d)&&229!==d&&PD.push(d),["metaKey","ctrlKey","altKey","shiftKey"].forEach(b=>{let c=PA[b];a[b]&&-1===PD.indexOf(c)?PD.push(c):!a[b]&&PD.indexOf(c)>-1?PD.splice(PD.indexOf(c),1):"metaKey"===b&&a[b]&&(PD=PD.filter(a=>a in PA||a===d))}),d in PB){for(let b in PB[d]=!0,Pz)if(Object.prototype.hasOwnProperty.call(Pz,b)){let c=PA[Pz[b]];PO[b]=a[c]}if(!c)return}for(let b in PB)Object.prototype.hasOwnProperty.call(PB,b)&&(PB[b]=a[PA[b]]);a.getModifierState&&!(a.altKey&&!a.ctrlKey)&&a.getModifierState("AltGraph")&&(-1===PD.indexOf(17)&&PD.push(17),-1===PD.indexOf(18)&&PD.push(18),PB[17]=!0,PB[18]=!0);let e=PJ();if(c)for(let d=0;d<c.length;d++)c[d].scope===e&&("keydown"===a.type&&c[d].keydown||"keyup"===a.type&&c[d].keyup)&&PM(a,c[d],e,b);if(!(d in PC))return;let f=PC[d],g=f.length;for(let c=0;c<g;c++)if(("keydown"===a.type&&f[c].keydown||"keyup"===a.type&&f[c].keyup)&&f[c].key){let d=f[c],{splitKey:g}=d,h=d.key.split(g),i=[];for(let a=0;a<h.length;a++)i.push(PH(h[a]));i.sort().join("")===PD.sort().join("")&&PM(a,d,e,b)}}function PO(a,b,c){PD=[];let d=Px(a),e=[],f="all",g=document,h=0,i=!1,j=!0,k="+",l=!1,m=!1;for(void 0===c&&"function"==typeof b&&(c=b),"[object Object]"===Object.prototype.toString.call(b)&&(b.scope&&(f=b.scope),b.element&&(g=b.element),b.keyup&&(i=b.keyup),void 0!==b.keydown&&(j=b.keydown),void 0!==b.capture&&(l=b.capture),"string"==typeof b.splitKey&&(k=b.splitKey),!0===b.single&&(m=!0)),"string"==typeof b&&(f=b),m&&PK(a,f);h<d.length;h++)a=d[h].split(k),e=[],a.length>1&&(e=Pw(Pz,a)),(a="*"===(a=a[a.length-1])?"*":PH(a))in PC||(PC[a]=[]),PC[a].push({keyup:i,keydown:j,scope:f,mods:e,shortcut:d[h],method:c,key:d[h],splitKey:k,element:g});if(void 0!==g&&window){if(!PG.has(g)){let a=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;return PN(a,g)},b=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;PN(a,g);let b=a.keyCode||a.which||a.charCode;a.key&&"capslock"===a.key.toLowerCase()&&(b=PH(a.key));let c=PD.indexOf(b);if(c>=0&&PD.splice(c,1),a.key&&"meta"===a.key.toLowerCase()&&PD.splice(0,PD.length),(93===b||224===b)&&(b=91),b in PB)for(let a in PB[b]=!1,Pz)Pz[a]===b&&(PO[a]=!1)};PG.set(g,{keydownListener:a,keyupListenr:b,capture:l}),Pu(g,"keydown",a,l),Pu(g,"keyup",b,l)}if(!PE){let a=()=>{PD=[]};PE={listener:a,capture:l},Pu(window,"focus",a,l)}}}function PP(a){let b=Object.values(PC).flat();if(0>b.findIndex(b=>{let{element:c}=b;return c===a})){let{keydownListener:b,keyupListenr:c,capture:d}=PG.get(a)||{};b&&c&&(Pv(a,"keyup",c,d),Pv(a,"keydown",b,d),PG.delete(a))}if((b.length<=0||PG.size<=0)&&(Object.keys(PG).forEach(a=>{let{keydownListener:b,keyupListenr:c,capture:d}=PG.get(a)||{};b&&c&&(Pv(a,"keyup",c,d),Pv(a,"keydown",b,d),PG.delete(a))}),PG.clear(),Object.keys(PC).forEach(a=>delete PC[a]),PE)){let{listener:a,capture:b}=PE;Pv(window,"focus",a,b),PE=null}}let PQ={getPressedKeyString:function(){return PD.map(a=>Object.keys(Py).find(b=>Py[b]===a)||Object.keys(Pz).find(b=>Pz[b]===a)||String.fromCharCode(a))},setScope:PI,getScope:PJ,deleteScope:function(a,b){let c,d;for(let b in a||(a=PJ()),PC)if(Object.prototype.hasOwnProperty.call(PC,b))for(d=0,c=PC[b];d<c.length;)c[d].scope===a?c.splice(d,1).forEach(a=>{let{element:b}=a;return PP(b)}):d++;PJ()===a&&PI(b||"all")},getPressedKeyCodes:function(){return PD.slice(0)},getAllKeyCodes:function(){let a=[];return Object.keys(PC).forEach(b=>{PC[b].forEach(b=>{let{key:c,scope:d,mods:e,shortcut:f}=b;a.push({scope:d,shortcut:f,mods:e,keys:c.split("+").map(a=>PH(a))})})}),a},isPressed:function(a){return"string"==typeof a&&(a=PH(a)),-1!==PD.indexOf(a)},filter:function(a){let b=a.target||a.srcElement,{tagName:c}=b,d=!0,e="INPUT"===c&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(b.type);return(b.isContentEditable||(e||"TEXTAREA"===c||"SELECT"===c)&&!b.readOnly)&&(d=!1),d},trigger:function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(PC).forEach(c=>{PC[c].filter(c=>c.scope===b&&c.shortcut===a).forEach(a=>{a&&a.method&&a.method()})})},unbind:PK,keyMap:Py,modifier:Pz,modifierMap:PA};for(let a in PQ)Object.prototype.hasOwnProperty.call(PQ,a)&&(PO[a]=PQ[a]);let PR=["copy","cut","paste","asset"];function PS(a){return a.menus.hasAnyOpenMenus()||null!==a.getEditingShapeId()||a.getCrashingError()||!a.user.getAreKeyboardShortcutsEnabled()}function PT(a){return(function(a){"string"!=typeof a&&(a="");let b=(a=a.replace(/\s/g,"")).split(","),c=b.lastIndexOf("");for(;c>=0;)b[c-1]+=",",b.splice(c,1),c=b.lastIndexOf("");return b})(a).map(a=>{let b=a.includes("!"),c=a.includes("?"),d=a.includes("$"),e=a.replace(/[!?$]/g,"");return b&&c&&d?`cmd+shift+alt+${e},ctrl+shift+alt+${e}`:b&&d?`cmd+shift+${e},ctrl+shift+${e}`:c&&d?`cmd+alt+${e},ctrl+alt+${e}`:c&&b?`shift+alt+${e}`:b?`shift+${e}`:c?`alt+${e}`:d?`cmd+${e},ctrl+${e}`:e}).join(",")}let PU=(0,eQ.createContext)(!1),PV={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9};function PW({children:a,orientation:b,sizingParentClassName:c,minItems:d,minSizePx:e,maxItems:f,maxSizePx:g}){let h=kp(),i=kj(),j=Ce(),k=zQ(),l=(0,eQ.useRef)([]),[m,n]=(0,eQ.useState)(!1),o=(0,eQ.useRef)(null),[p,q]=(0,eQ.useState)(null),[r,s]=(0,eQ.useState)(null),[t,u]=(0,eQ.useState)(!1),v=mA(()=>{if(!o.current)return;let a="horizontal"===b?"offsetWidth":"offsetHeight",h=j(o.current.children),i=p?j(p.children):null;function j(a){let b=[];for(let c of a)c.classList.contains("tlui-main-toolbar__group")?b.push({type:"group",items:j(c.children),element:c}):c.hasAttribute("data-radix-popper-content-wrapper")||b.push({type:"item",element:c});return b}let k=Math.floor(cT(PX(o.current,c)[a],[e,g],[d,f],!0)),m=0,n=null,q=!1,t=[],{didShowAnyInOverflow:v}=function a(b,c){c&&cg(b.length===c.length);let d=!1,e=!1;for(let f=0;f<b.length;f++){let g=b[f],h=c?.[f];if("item"===g.type){let a,b=g.element.getAttribute("data-value")===r;a=r?m<k||b:m<=k;let c=m>=k;d||=a,e||=c,PY(g.element,"data-toolbar-visible",a?"true":"false"),h&&(cg("item"===h.type),PY(h.element,"data-toolbar-visible",c?"true":"false")),c&&"true"===g.element.getAttribute("aria-pressed")&&(n=g.element.getAttribute("data-value")),a&&"BUTTON"===g.element.tagName&&t.push(g.element),!c&&b&&(q=!0),m++}else{let b,c;h?(cg("group"===h.type),c=h,b=a(g.items,c.items)):b=a(g.items,null),d||=b.didShowAnyInMain,e||=b.didShowAnyInOverflow,PY(g.element,"data-toolbar-visible",b.didShowAnyInMain?"true":"false"),c&&PY(c.element,"data-toolbar-visible",b.didShowAnyInOverflow?"true":"false")}}return{didShowAnyInMain:d,didShowAnyInOverflow:e}}(h,i);u(v),n?s(n):q&&s(null),l.current=t});(0,eQ.useLayoutEffect)(()=>{v()}),(0,eQ.useLayoutEffect)(()=>{if(!o.current)return;let a=new MutationObserver(v);a.observe(o.current,{childList:!0,subtree:!0,attributes:!0,characterData:!0});let b=PX(o.current,c),d=new ResizeObserver(v);return d.observe(b),()=>{a.disconnect(),d.disconnect()}},[v,c]),(0,eQ.useEffect)(()=>{if(h.options.enableToolbarKeyboardShortcuts)return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)};function a(a){if(PS(h)||kf(!0)||a.ctrlKey||a.metaKey||a.altKey||a.shiftKey)return;let b=PV[a.key];"number"==typeof b&&(kb(a),l.current[b]?.click())}},[h]);let w="toolbar overflow";return(0,bT.jsx)(bT.Fragment,{children:(0,bT.jsxs)(Hs,{orientation:b,className:(0,j1.default)("tlui-main-toolbar__tools",{"tlui-main-toolbar__tools__mobile":j<Cb.TABLET_SM}),label:k("tool-panel.title"),children:[(0,bT.jsx)("horizontal"===b?GQ:GR,{id:`${i}_main`,ref:o,children:(0,bT.jsx)(Ch,{type:"toolbar",sourceId:"toolbar",children:a})}),t&&(0,bT.jsx)(PU.Provider,{value:!0,children:(0,bT.jsxs)(I5,{id:w,open:m,onOpenChange:n,children:[(0,bT.jsx)(I6,{children:(0,bT.jsx)(Ht,{title:k("tool-panel.more"),type:"tool",className:"tlui-main-toolbar__overflow","data-testid":"tools.more-button",children:(0,bT.jsx)(BV,{icon:"horizontal"===b?"chevron-up":"chevron-right"})})}),(0,bT.jsx)(I7,{side:"horizontal"===b?"top":"right",align:"horizontal"===b?"center":"end",children:(0,bT.jsx)(Hs,{orientation:"grid",className:"tlui-main-toolbar__overflow-content",ref:q,"data-testid":"tools.more-content",label:k("tool-panel.more"),id:`${i}_more`,onClick:()=>{m3.deleteOpenMenu(w,h.contextId),n(!1)},children:(0,bT.jsx)(Ch,{type:"toolbar-overflow",sourceId:"toolbar",children:a})})})]})})]})})}function PX(a,b){let c=a;for(;c;){if(c.classList.contains(b))return c;c=c.parentElement}throw Error("Could not find parent with class name "+b)}function PY(a,b,c){a.getAttribute(b)!==c&&a.setAttribute(b,c)}function PZ({activeToolId:a}){let b=kp(),c=Ce(),d=zQ(),e=Qf(),f=e$("is tool locked",()=>b.getInstanceState().isToolLocked,[b]),g=e$("current tool",()=>b.getCurrentTool(),[b]);if(!a||!g.isLockable)return null;let h=e["toggle-tool-lock"],i=h?.kbd?`${d("action.toggle-tool-lock")} ${Fy(h.kbd)}`:d("action.toggle-tool-lock");return(0,bT.jsx)(Hq,{content:i,children:(0,bT.jsx)(zS,{type:"normal","data-testid":"tool-lock",className:(0,j1.default)("tlui-main-toolbar__lock-button",{"tlui-main-toolbar__lock-button__mobile":c<Cb.TABLET_SM}),onClick:()=>b.updateInstanceState({isToolLocked:!f}),children:(0,bT.jsx)(BV,{icon:f?"lock":"unlock",small:!0})})})}let P$=(0,eQ.memo)(function({children:a,orientation:b="horizontal",minItems:c=4,minSizePx:d=310,maxItems:e=8,maxSizePx:f=470}){let g=kp(),h=zQ(),i=Ce(),j=Ft(),k=e$("current tool id",()=>g.getCurrentToolId(),[g]),l=(0,eQ.useRef)(null);qF(l);let{ActionsMenu:m,QuickActions:n}=Qa(),o="menu"!==g.options.actionShortcutsLocation&&("toolbar"===g.options.actionShortcutsLocation||i<Cb.TABLET);return(0,bT.jsx)(GO,{orientation:b,tooltipSide:"horizontal"===b?"top":"right",children:(0,bT.jsx)("div",{ref:l,className:(0,j1.default)("tlui-main-toolbar",`tlui-main-toolbar--${b}`),children:(0,bT.jsxs)("div",{className:"tlui-main-toolbar__inner",children:[(0,bT.jsxs)("div",{className:"tlui-main-toolbar__left",children:[!j&&(0,bT.jsxs)("div",{className:"tlui-main-toolbar__extras",children:[o&&(0,bT.jsxs)(Hs,{orientation:b,className:"tlui-main-toolbar__extras__controls",label:h("actions-menu.title"),children:[n&&(0,bT.jsx)(n,{}),m&&(0,bT.jsx)(m,{})]}),(0,bT.jsx)(PZ,{activeToolId:k})]}),(0,bT.jsx)(PW,{orientation:b,sizingParentClassName:"tlui-main-toolbar",minItems:c,maxItems:e,minSizePx:d,maxSizePx:f,children:a??(0,bT.jsx)(O_,{})})]}),i<Cb.TABLET_SM&&!j&&(0,bT.jsx)("div",{className:"tlui-main-toolbar__tools tlui-main-toolbar__mobile-style-panel",children:(0,bT.jsx)(O$,{})})]})})})}),P_=eV(function({videoShapeId:a,onEditAltTextStart:b}){let c=kp(),d=F0(),e=zQ(),f=c.getIsReadonly(),g=Qf(),h=(0,eQ.useCallback)(()=>g["video-replace"].onSelect("video-toolbar"),[g]),i=(0,eQ.useCallback)(()=>g["download-original"].onSelect("video-toolbar"),[g]),j=e$("altText",()=>c.getShape(a).props.altText,[c,a]);return(0,bT.jsxs)(bT.Fragment,{children:[!f&&(0,bT.jsx)(zS,{type:"icon",title:e("tool.replace-media"),onClick:h,"data-testid":"tool.video-replace",children:(0,bT.jsx)(BV,{small:!0,icon:"tool-media"})}),(0,bT.jsx)(zS,{type:"icon",title:e("action.download-original"),onClick:i,"data-testid":"tool.video-download",children:(0,bT.jsx)(BV,{small:!0,icon:"download"})}),(j||!f)&&(0,bT.jsx)(Ht,{type:"icon",isActive:!!j,title:e("tool.media-alt-text"),"data-testid":"tool.video-alt-text",onClick:()=>{d("alt-text-start",{source:"video-toolbar"}),b()},children:(0,bT.jsx)(BV,{small:!0,icon:"alt"})})]})}),P0=eV(function({children:a}){let b=kp(),c=e$("videoShape",()=>{let a=b.getOnlySelectedShape();return a&&"video"===a.type?a.id:null},[b]),d=b.isInAny("select.idle","select.pointing_shape"),e=e$("locked",()=>!!c&&b.getShape(c)?.isLocked,[b,c]);return c&&d&&!e?(0,bT.jsx)(P1,{videoShapeId:c,children:a},c):null});function P1({children:a,videoShapeId:b}){let c=kp(),d=zQ(),[e,f]=(0,eQ.useState)(!1),g=(0,eQ.useCallback)(()=>f(!0),[]),h=(0,eQ.useCallback)(()=>f(!1),[]),i=(0,eQ.useCallback)(()=>{let a=c.getSelectionScreenBounds();if(a)return new lh(a.x,a.y,a.width,0)},[c]);return(0,bT.jsx)(MT,{className:"tlui-video__toolbar",getSelectionBounds:i,label:d("tool.video-toolbar-title"),children:a||(e?(0,bT.jsx)(MV,{shapeId:b,onClose:h,source:"video-toolbar"}):(0,bT.jsx)(P_,{videoShapeId:b,onEditAltTextStart:g}))})}function P2(){let a=zQ();return(0,bT.jsxs)("div",{className:(0,j1.default)("tlui-offline-indicator"),children:[a("status.offline"),(0,bT.jsx)(BT,{label:a("status.offline"),icon:"status-offline",small:!0})]})}function P3({maxWidth:a=420,ignoreRightWidth:b=0,stylePanelWidth:c=148,marginBetweenZones:d=12,squeezeAmount:e=52,children:f}){let g=(0,eQ.useRef)(null),h=Ce(),i=(0,eQ.useCallback)(()=>{let f=g.current;if(!f)return;let i=f.parentElement.parentElement,j=i.querySelector(".tlui-layout__top__left"),k=i.querySelector(".tlui-layout__top__right"),l=i.offsetWidth,m=j.offsetWidth,n=k.offsetWidth,o=(l-(f.offsetWidth-b))/2;l%2!=0&&(o-=.5);let p=m+d,q=f.offsetLeft,r=Math.min(l-n-m-2*d,a),s=Math.max(o,p)-q;k.offsetWidth>c&&h<=6?f.style.setProperty("max-width",r-e+"px"):f.style.setProperty("max-width",r+"px"),f.style.setProperty("transform",`translate(${s}px, 0px)`)},[h,b,d,a,e,c]);return(0,eQ.useLayoutEffect)(()=>{let a=g.current;if(!a)return;let b=a.parentElement.parentElement,c=b.querySelector(".tlui-layout__top__left"),d=b.querySelector(".tlui-layout__top__right"),e=new ResizeObserver(i);return e.observe(c),e.observe(d),e.observe(b),e.observe(a),i(),()=>{e.disconnect()}},[i]),(0,eQ.useLayoutEffect)(()=>{i()}),(0,bT.jsx)("div",{ref:g,className:"tlui-top-panel__container",children:f})}function P4(){let a,b="offline"===e$("sync status",()=>a?.store.props.collaboration?.status?a.store.props.collaboration.status.get():null,[a=kq()]);return(0,bT.jsx)(P3,{children:b&&(0,bT.jsx)(P2,{})})}var FY=FY;function P5(){return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(Hy,{actionId:"zoom-in",noClose:!0}),(0,bT.jsx)(Hy,{actionId:"zoom-out",noClose:!0}),(0,bT.jsx)(Qu,{}),(0,bT.jsx)(Qv,{}),(0,bT.jsx)(Qw,{})]})}let P6=(0,eQ.memo)(function({children:a}){let b=kv(),[c,d]=F1("zoom menu"),e=a??(0,bT.jsx)(P5,{});return(0,bT.jsxs)(FY.Root,{dir:"ltr",open:c,onOpenChange:d,modal:!1,children:[(0,bT.jsx)(P7,{}),(0,bT.jsx)(FY.Portal,{container:b,children:(0,bT.jsx)(FY.Content,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:(0,bT.jsx)(Ch,{type:"menu",sourceId:"zoom-menu",children:e})})})]})}),P7=()=>{let a=kp(),b=Ce(),c=e$("zoom",()=>a.getZoomLevel(),[a]),d=zQ(),e=(0,eQ.useCallback)(()=>{a.resetZoom(a.getViewportScreenCenter(),{animation:{duration:a.options.animationMediumMs}})},[a]),f=`${Math.floor(100*c)}%`;return(0,bT.jsx)(Ht,{asChild:!0,type:"icon","aria-label":`${d("navigation-zone.zoom")} \u2014 ${f}`,title:`${d("navigation-zone.zoom")} \u2014 ${f}`,"data-testid":"minimap.zoom-menu-button",className:"tlui-zoom-menu__button",onDoubleClick:e,children:(0,bT.jsx)(FY.Trigger,{dir:"ltr",children:b<Cb.MOBILE?null:(0,bT.jsx)("span",{style:{flexGrow:0,textAlign:"center"},children:f})})})},P8=(0,eQ.createContext)(null);function P9({overrides:a={},children:b}){let c=kK(a,kM),d=Ci();return(0,bT.jsx)(P8.Provider,{value:(0,eQ.useMemo)(()=>({ContextMenu:Kl,ActionsMenu:Kj,HelpMenu:null,ZoomMenu:P6,MainMenu:K1,Minimap:Lr,StylePanel:MP,PageMenu:Lw,NavigationPanel:Ls,Toolbar:P$,RichTextToolbar:OY,ImageToolbar:M2,VideoToolbar:P0,KeyboardShortcutsDialog:IF,QuickActions:LA,HelperButtons:KN,DebugPanel:KB,DebugMenu:KA,MenuPanel:KG,SharePanel:d?LH:null,CursorChatBubble:d?Km:null,TopPanel:d?P4:null,Dialogs:KI,Toasts:MS,A11y:zU,FollowingIndicator:KE,...c}),[c,d]),children:b})}function Qa(){let a=(0,eQ.useContext)(P8);if(!a)throw Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return a}let Qb=eQ.createContext(null);function Qc(a,b){return(b.isShapeOfType(a,"image")||b.isShapeOfType(a,"video"))&&!!a.props.assetId}function Qd(a,b){if(0===a.getSelectedShapes().length)return a.getDocumentSettings().name||b}function Qe({overrides:a,children:b}){let c=kq(),d=Ci(),e=Iw(),f=Qa(),g=F0(),h=zG(),i=zQ(),j=e.msg("document.default-name"),k=eQ.useMemo(()=>{if(!c)return{};function b(){return c.isIn("select")||(c.complete(),c.setCurrentTool("select")),!1}function k(){return c.isIn("select")&&c.getSelectedShapeIds().length>0}function l(a){if(!k())return;b(),c.markHistoryStoppingPoint("resize shapes");let d=c.getSelectedShapeIds();0!==d.length&&c.run(()=>{d.map(a=>c.getShape(a)).filter(Boolean).forEach(b=>{c.resizeShape(b.id,new jA(a,a),{scaleOrigin:c.getSelectionPageBounds()?.center})})})}let m=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(a){k()&&(b(),g("edit-link",{source:a}),c.markHistoryStoppingPoint("edit-link"),e.addDialog({component:B1}))}},{id:"insert-embed",label:"action.insert-embed",kbd:"cmd+i,ctrl+i",onSelect(a){g("insert-embed",{source:a}),e.addDialog({component:B9})}},{id:"open-kbd-shortcuts",label:"action.open-kbd-shortcuts",kbd:"cmd+alt+/,ctrl+alt+/",onSelect(a){g("open-kbd-shortcuts",{source:a}),e.addDialog({component:f.KeyboardShortcutsDialog??IF})}},{id:"insert-media",label:"action.insert-media",kbd:"cmd+u,ctrl+u",onSelect(a){g("insert-media",{source:a}),e.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"cmd+z,ctrl+z",onSelect(a){g("undo",{source:a}),c.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"cmd+shift+z,ctrl+shift+z",onSelect(a){g("redo",{source:a}),c.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("export-as",{format:"svg",source:a}),e.exportAs(b,{format:"svg",name:Qd(c,j)}))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("export-as",{format:"png",source:a}),e.exportAs(b,{format:"png",name:Qd(c,j)}))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("export-all-as",{format:"svg",source:a}),e.exportAs(Array.from(c.getCurrentPageShapeIds()),{format:"svg",name:Qd(c,j)}))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(a){let b=Array.from(c.getCurrentPageShapeIds().values());0!==b.length&&(g("export-all-as",{format:"png",source:a}),e.exportAs(b,{format:"png",name:Qd(c,j)}))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"cmd+shift+c,ctrl+shift+c",readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("copy-as",{format:"svg",source:a}),e.copyAs(b,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("copy-as",{format:"png",source:a}),e.copyAs(b,"png"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(a){k()&&(b(),g("toggle-auto-size",{source:a}),c.markHistoryStoppingPoint("toggling auto size"),c.run(()=>{let a=c.getSelectedShapes().filter(a=>c.isShapeOfType(a,"text")&&!1===a.props.autoSize);c.updateShapes(a.map(a=>({id:a.id,type:a.type,props:{...a.props,w:8,autoSize:!0}}))),sH(c,a.map(a=>a.id))}))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(a){g("open-embed-link",{source:a});let b=c.getSelectedShapeIds(),d="No embed shapes selected";if(1!==b.length)return void console.error(d);let e=c.getShape(b[0]);e&&c.isShapeOfType(e,"embed")?zw(e.props.url,"_blank"):console.error(d)}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(a){if(c.root.getCurrent()?.id!=="zoom"&&(g("zoom-tool",{source:a}),!(c.inputs.shiftKey||c.inputs.ctrlKey))){let a=c.root.getCurrent();a&&a.getCurrent()?.id==="idle"&&c.setCurrentTool("zoom",{onInteractionEnd:a.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",async onSelect(a){if(!k())return;b(),g("convert-to-bookmark",{source:a});let d=c.getSelectedShapes(),e=c.markHistoryStoppingPoint("convert shapes to bookmark"),f=[];for(let a of d){if(!a||!c.isShapeOfType(a,"embed")||!a.props.url)continue;let b=c.getShapePageBounds(a)?.center;b&&(c.deleteShapes([a.id]),f.push(z_(c,{url:a.props.url,center:b}).then(a=>{if(!a.ok)throw Error(a.error);return a})))}await Promise.all(f).catch(a=>{c.bailToMark(e),console.error(a)})}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(a){k()&&(b(),g("convert-to-embed",{source:a}),c.run(()=>{let a=b5(c.getSelectedShapeIds().map(a=>c.getShape(a))),b=[],d=[];for(let f of a){if(!c.isShapeOfType(f,"bookmark"))continue;let{url:a}=f.props,g=e.getEmbedDefinition(a);if(!g||!g.definition)continue;let{width:h,height:i}=g.definition,j=new jA(f.x,f.y);j.rot(-f.rotation),j.add(new jA(f.props.w/2-h/2,f.props.h/2-i/2)),j.rot(f.rotation);let k={id:hd(),type:"embed",x:j.x,y:j.y,rotation:f.rotation,props:{url:a,w:h,h:i}};b.push(k),d.push(f.id)}c.markHistoryStoppingPoint("convert shapes to embed"),c.deleteShapes(d),c.createShapes(b)}))}},{id:"duplicate",kbd:"cmd+d,ctrl+d",label:"action.duplicate",icon:"duplicate",onSelect(a){let d,e;if(!k())return;b(),g("duplicate-shapes",{source:a});let f=c.getInstanceState();if(f.duplicateProps)d=f.duplicateProps.shapeIds,e=f.duplicateProps.offset;else{d=c.getSelectedShapeIds();let a=lh.Common(b5(d.map(a=>c.getShapePageBounds(a))));e=c.getCameraOptions().isLocked?{x:c.options.adjacentShapeMargin,y:c.options.adjacentShapeMargin}:{x:a.width+c.options.adjacentShapeMargin,y:0}}c.markHistoryStoppingPoint("duplicate shapes"),c.duplicateShapes(d,e),f.duplicateProps&&c.updateInstanceState({duplicateProps:{...f.duplicateProps,shapeIds:c.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"cmd+shift+g,ctrl+shift+g",icon:"ungroup",onSelect(a){k()&&(b(),g("ungroup-shapes",{source:a}),c.markHistoryStoppingPoint("ungroup"),c.ungroupShapes(c.getSelectedShapeIds()))}},{id:"group",label:"action.group",kbd:"cmd+g,ctrl+g",icon:"group",onSelect(a){if(!k())return;b(),g("group-shapes",{source:a});let d=c.getOnlySelectedShape();d&&c.isShapeOfType(d,"group")?(c.markHistoryStoppingPoint("ungroup"),c.ungroupShapes(c.getSelectedShapeIds())):(c.markHistoryStoppingPoint("group"),c.groupShapes(c.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"cmd+shift+f,ctrl+shift+f",onSelect(a){if(!k())return;g("remove-frame",{source:a});let b=c.getSelectedShapes();b.length>0&&b.every(a=>c.isShapeOfType(a,"frame"))&&(c.markHistoryStoppingPoint("remove-frame"),function(a,b){let c=b5(b.map(b=>a.getShape(b)).filter(b=>b&&a.isShapeOfType(b,"frame")));if(!c.length)return;let d=[];a.run(()=>{c.map(b=>{let e=a.getSortedChildIdsForParent(b.id);e.length&&(sH(a,e,{filter:a=>!c.find(b=>b.id===a.id)}),d.push(...e))}),a.setSelectedShapes(d),a.deleteShapes(b)})}(c,b.map(a=>a.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(a){if(!k())return;g("fit-frame-to-content",{source:a});let b=c.getOnlySelectedShape();b&&c.isShapeOfType(b,"frame")&&(c.markHistoryStoppingPoint("fit-frame-to-content"),z1(c,b.id))}},{id:"align-left",label:"action.align-left",kbd:"alt+A",icon:"align-left",onSelect(a){k()&&(b(),g("align-shapes",{operation:"left",source:a}),c.markHistoryStoppingPoint("align left"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"left"),sH(c,a)}))}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"alt+H",icon:"align-center-horizontal",onSelect(a){k()&&(b(),g("align-shapes",{operation:"center-horizontal",source:a}),c.markHistoryStoppingPoint("align center horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"center-horizontal"),sH(c,a)}))}},{id:"align-right",label:"action.align-right",kbd:"alt+D",icon:"align-right",onSelect(a){k()&&(b(),g("align-shapes",{operation:"right",source:a}),c.markHistoryStoppingPoint("align right"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"right"),sH(c,a)}))}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"alt+V",icon:"align-center-vertical",onSelect(a){k()&&(b(),g("align-shapes",{operation:"center-vertical",source:a}),c.markHistoryStoppingPoint("align center vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"center-vertical"),sH(c,a)}))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"alt+W",onSelect(a){k()&&(b(),g("align-shapes",{operation:"top",source:a}),c.markHistoryStoppingPoint("align top"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"top"),sH(c,a)}))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"alt+S",onSelect(a){k()&&(b(),g("align-shapes",{operation:"bottom",source:a}),c.markHistoryStoppingPoint("align bottom"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"bottom"),sH(c,a)}))}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"alt+shift+h",onSelect(a){k()&&(b(),g("distribute-shapes",{operation:"horizontal",source:a}),c.markHistoryStoppingPoint("distribute horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.distributeShapes(a,"horizontal"),sH(c,a)}))}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"alt+shift+V",onSelect(a){k()&&(b(),g("distribute-shapes",{operation:"vertical",source:a}),c.markHistoryStoppingPoint("distribute vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.distributeShapes(a,"vertical"),sH(c,a)}))}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(a){k()&&(b(),g("stretch-shapes",{operation:"horizontal",source:a}),c.markHistoryStoppingPoint("stretch horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.stretchShapes(a,"horizontal"),sH(c,a)}))}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(a){k()&&(b(),g("stretch-shapes",{operation:"vertical",source:a}),c.markHistoryStoppingPoint("stretch vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.stretchShapes(a,"vertical"),sH(c,a)}))}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"shift+h",onSelect(a){k()&&(b(),g("flip-shapes",{operation:"horizontal",source:a}),c.markHistoryStoppingPoint("flip horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.flipShapes(a,"horizontal"),sH(c,a)}))}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"shift+v",onSelect(a){k()&&(b(),g("flip-shapes",{operation:"vertical",source:a}),c.markHistoryStoppingPoint("flip vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.flipShapes(a,"vertical"),sH(c,a)}))}},{id:"pack",label:"action.pack",icon:"pack",onSelect(a){k()&&(b(),g("pack-shapes",{source:a}),c.markHistoryStoppingPoint("pack"),c.run(()=>{let a=c.getSelectedShapeIds();c.packShapes(a,c.options.adjacentShapeMargin),sH(c,a)}))}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(a){k()&&(b(),g("stack-shapes",{operation:"vertical",source:a}),c.markHistoryStoppingPoint("stack-vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.stackShapes(a,"vertical",c.options.adjacentShapeMargin),sH(c,a)}))}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(a){k()&&(b(),g("stack-shapes",{operation:"horizontal",source:a}),c.markHistoryStoppingPoint("stack-horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.stackShapes(a,"horizontal",c.options.adjacentShapeMargin),sH(c,a)}))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(a){k()&&(b(),g("reorder-shapes",{operation:"toFront",source:a}),c.markHistoryStoppingPoint("bring to front"),c.bringToFront(c.getSelectedShapeIds()))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"alt+]",onSelect(a){k()&&(b(),g("reorder-shapes",{operation:"forward",source:a}),c.markHistoryStoppingPoint("bring forward"),c.bringForward(c.getSelectedShapeIds()))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"alt+[",onSelect(a){k()&&(b(),g("reorder-shapes",{operation:"backward",source:a}),c.markHistoryStoppingPoint("send backward"),c.sendBackward(c.getSelectedShapeIds()))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(a){k()&&(b(),g("reorder-shapes",{operation:"toBack",source:a}),c.markHistoryStoppingPoint("send to back"),c.sendToBack(c.getSelectedShapeIds()))}},{id:"cut",label:"action.cut",kbd:"cmd+x,ctrl+x",onSelect(a){k()&&(b(),c.markHistoryStoppingPoint("cut"),e.cut(a))}},{id:"copy",label:"action.copy",kbd:"cmd+c,ctrl+c",readonlyOk:!0,onSelect(a){k()&&(b(),e.copy(a))}},{id:"paste",label:"action.paste",kbd:"cmd+v,ctrl+v",onSelect(a){navigator.clipboard?.read().then(b=>{e.paste(b,a,"context-menu"===a?c.inputs.currentPagePoint:void 0)}).catch(()=>{e.addToast({title:e.msg("action.paste-error-title"),description:e.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"cmd+a,ctrl+a",readonlyOk:!0,onSelect(a){c.run(()=>{b(),g("select-all-shapes",{source:a}),c.markHistoryStoppingPoint("select all kbd"),c.selectAll()})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(a){k()&&(b(),g("select-none-shapes",{source:a}),c.markHistoryStoppingPoint("select none"),c.selectNone())}},{id:"delete",label:"action.delete",kbd:"⌫,del",icon:"trash",onSelect(a){k()&&(b(),g("delete-shapes",{source:a}),c.markHistoryStoppingPoint("delete"),c.deleteShapes(c.getSelectedShapeIds()))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",kbd:"shift+.,shift+alt+.",onSelect(a){if(!k())return;b();let d=c.inputs.altKey;g("rotate-cw",{source:a,fine:d}),c.markHistoryStoppingPoint("rotate-cw"),c.run(()=>{let a=jF/(d?96:6),b=c.getSelectionRotation()%a,e=jK(b,0)||jK(b,a),f=c.getSelectedShapeIds();c.rotateShapesBy(f,a-(e?0:b)),sH(c,f)})}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",kbd:"shift+,,shift+alt+,",onSelect(a){if(!k())return;b();let d=c.inputs.altKey;g("rotate-ccw",{source:a,fine:d}),c.markHistoryStoppingPoint("rotate-ccw"),c.run(()=>{let a=jF/(d?96:6),b=c.getSelectionRotation()%a,e=jK(b,0),f=c.getSelectedShapeIds();c.rotateShapesBy(f,e?-a:-b),sH(c,f)})}},{id:"zoom-in",label:"action.zoom-in",kbd:"cmd+=,ctrl+=,=",readonlyOk:!0,onSelect(a){g("zoom-in",{source:a,towardsCursor:!1}),c.zoomIn(void 0,{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-in-on-cursor",label:"action.zoom-in",kbd:"shift+cmd+=,shift+ctrl+=,shift+=",readonlyOk:!0,onSelect(a){g("zoom-in",{source:a,towardsCursor:!0}),c.zoomIn(c.inputs.currentScreenPoint,{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"cmd+-,ctrl+-,-",readonlyOk:!0,onSelect(a){g("zoom-out",{source:a,towardsCursor:!1}),c.zoomOut(void 0,{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-out-on-cursor",label:"action.zoom-out",kbd:"shift+cmd+-,shift+ctrl+-,shift+-",readonlyOk:!0,onSelect(a){g("zoom-out",{source:a,towardsCursor:!0}),c.zoomOut(c.inputs.currentScreenPoint,{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"shift+0",readonlyOk:!0,onSelect(a){g("reset-zoom",{source:a}),c.resetZoom(void 0,{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"shift+1",readonlyOk:!0,onSelect(a){g("zoom-to-fit",{source:a}),c.zoomToFit({animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"shift+2",readonlyOk:!0,onSelect(a){k()&&(b(),g("zoom-to-selection",{source:a}),c.zoomToSelection({animation:{duration:c.options.animationMediumMs}}))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(a){g("toggle-snap-mode",{source:a}),c.user.updateUserPreferences({isSnapMode:!c.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"cmd+/,ctrl+/",readonlyOk:!0,onSelect(a){let b=c.user.getIsDarkMode()?"light":"dark";g("color-scheme",{source:a,value:b}),c.user.updateUserPreferences({colorScheme:b})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(a){g("toggle-wrap-mode",{source:a}),c.user.updateUserPreferences({isWrapMode:!c.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(a){g("toggle-dynamic-size-mode",{source:a}),c.user.updateUserPreferences({isDynamicSizeMode:!c.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(a){g("toggle-paste-at-cursor",{source:a}),c.user.updateUserPreferences({isPasteAtCursorMode:!c.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(a){g("toggle-reduce-motion",{source:a}),c.user.updateUserPreferences({animationSpeed:+(0===c.user.getAnimationSpeed())})},checkbox:!0},{id:"toggle-keyboard-shortcuts",label:{default:"action.toggle-keyboard-shortcuts",menu:"action.toggle-keyboard-shortcuts.menu"},readonlyOk:!0,onSelect(a){g("toggle-keyboard-shortcuts",{source:a}),c.user.updateUserPreferences({areKeyboardShortcutsEnabled:!c.user.getAreKeyboardShortcutsEnabled()})},checkbox:!0},{id:"enhanced-a11y-mode",label:{default:"action.enhanced-a11y-mode",menu:"action.enhanced-a11y-mode.menu"},readonlyOk:!0,onSelect(a){g("enhanced-a11y-mode",{source:a}),c.user.updateUserPreferences({enhancedA11yMode:!c.user.getEnhancedA11yMode()})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(a){g("toggle-edge-scrolling",{source:a}),c.user.updateUserPreferences({edgeScrollSpeed:+(0===c.user.getEdgeScrollSpeed())})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(a){g("toggle-transparent",{source:a}),c.updateInstanceState({exportBackground:!c.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(a){g("toggle-tool-lock",{source:a}),c.updateInstanceState({isToolLocked:!c.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(a){g("unlock-all",{source:a});let b=[];for(let a of c.getCurrentPageShapes())a.isLocked&&b.push({id:a.id,type:a.type,isLocked:!1});b.length>0&&c.updateShapes(b)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"cmd+.,ctrl+.",checkbox:!0,onSelect(a){c.timers.requestAnimationFrame(()=>{c.run(()=>{g("toggle-focus-mode",{source:a}),e.clearDialogs(),e.clearToasts(),c.updateInstanceState({isFocusMode:!c.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"cmd+',ctrl+'",onSelect(a){g("toggle-grid-mode",{source:a}),c.updateInstanceState({isGridMode:!c.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(a){g("toggle-debug-mode",{source:a}),c.updateInstanceState({isDebugMode:!c.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"cmd+p,ctrl+p",readonlyOk:!0,onSelect(a){g("print",{source:a}),e.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(a){g("exit-pen-mode",{source:a}),c.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(a){g("stop-following",{source:a}),c.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(a){g("zoom-to-content",{source:a});let b=c.getSelectionPageBounds()??c.getCurrentPageBounds();b&&c.zoomToBounds(b,{targetZoom:Math.min(1,c.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"shift+l",onSelect(a){c.markHistoryStoppingPoint("locking"),g("toggle-lock",{source:a}),c.toggleLock(c.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(a){let b=hU.createId(),d=c.getSelectedShapeIds();c.run(()=>{c.markHistoryStoppingPoint("move_shapes_to_page"),c.createPage({name:e.msg("page-menu.new-page-initial-name"),id:b}),c.moveShapesToPage(d,b)}),g("move-to-new-page",{source:a})}},{id:"select-white-color",label:"color-style.white",kbd:"alt+t",onSelect(a){c.run(()=>{c.markHistoryStoppingPoint("change-color"),c.isIn("select")&&c.setStyleForSelectedShapes(hm,"white"),c.setStyleForNextShapes(hm,"white")}),g("set-style",{source:a,id:hm.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"alt+f",onSelect(a){c.run(()=>{c.markHistoryStoppingPoint("change-fill"),c.isIn("select")&&c.setStyleForSelectedShapes(hr,"fill"),c.setStyleForNextShapes(hr,"fill")}),g("set-style",{source:a,id:hr.id,value:"fill"})}},{id:"select-fill-lined-fill",label:"fill-style.lined-fill",kbd:"alt+shift+f",onSelect(a){c.run(()=>{c.markHistoryStoppingPoint("change-fill"),c.isIn("select")&&c.setStyleForSelectedShapes(hr,"lined-fill"),c.setStyleForNextShapes(hr,"lined-fill")}),g("set-style",{source:a,id:hr.id,value:"lined-fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"shift+f",onSelect:async a=>{let b=c.getSelectedShapeIds();if(0===b.length)return;c.markHistoryStoppingPoint("flattening to image"),g("flatten-to-image",{source:a});let d=await IG(c,b,c.options.flattenImageBoundsExpand);d?.length&&c.setSelectedShapes(d)}},{id:"select-geo-tool",kbd:"g",onSelect:async a=>{g("select-tool",{source:a,id:"geo-previous"}),c.setCurrentTool("geo")}},{id:"change-page-prev",kbd:"alt+left,alt+up",readonlyOk:!0,onSelect:async a=>{let b=c.getPages(),d=b.findIndex(a=>a.id===c.getCurrentPageId());d<1||(g("change-page",{source:a,direction:"prev"}),c.setCurrentPage(b[d-1].id))}},{id:"change-page-next",kbd:"alt+right,alt+down",readonlyOk:!0,onSelect:async a=>{let b=c.getPages(),d=b.findIndex(a=>a.id===c.getCurrentPageId());if(-1===d||d>=b.length-1){if(c.getCurrentPageShapes().length<=0||c.getIsReadonly())return;g("new-page",{source:a}),c.run(()=>{c.markHistoryStoppingPoint("creating page");let a=hU.createId();c.createPage({name:e.msg("page-menu.new-page-initial-name"),id:a}),c.setCurrentPage(a)});return}c.setCurrentPage(b[d+1].id),g("change-page",{source:a,direction:"next"})}},{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+Enter,ctrl+Enter",isRequiredA11yAction:!0,onSelect:async a=>{if(!k())return;let b=c.getOnlySelectedShape();if(b&&(c.isShapeOfType(b,"image")||c.isShapeOfType(b,"video"))){let a=c.getContainer().querySelector(".tlui-contextual-toolbar button:first-child");a?.focus();return}let d=c.getContainer().querySelector(".tlui-style-panel button");d?.focus(),g("adjust-shape-styles",{source:a})}},{id:"a11y-open-context-menu",kbd:"cmd+shift+Enter,ctrl+shift+Enter",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async a=>{if(!k())return;let b=c.getSelectionPageBounds();if(!b)return;let d=b.x+b.width/2,e=b.y+b.height/2,f=c.pageToScreen(new jA(d,e));c.getContainer().querySelector(".tl-canvas")?.dispatchEvent(new PointerEvent("contextmenu",{clientX:f.x,clientY:f.y,bubbles:!0})),g("open-context-menu",{source:a})}},{id:"enlarge-shapes",label:"a11y.enlarge-shape",kbd:"cmd+alt+shift+=,ctrl+alt+shift+=",onSelect:async a=>{l(1.1),g("enlarge-shapes",{source:a})}},{id:"shrink-shapes",label:"a11y.shrink-shape",kbd:"cmd+alt+shift+-,ctrl+alt+shift+-",onSelect:async a=>{l(1/1.1),g("shrink-shapes",{source:a})}},{id:"a11y-repeat-shape-announce",kbd:"alt+r",label:"a11y.repeat-shape",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async a=>{let b=c.getSelectedShapeIds();if(!b.length)return;let d=zV({editor:c,selectedShapeIds:b,msg:i});d&&(h.announce({msg:""}),c.timers.requestAnimationFrame(()=>{h.announce({msg:d})}),g("a11y-repeat-shape-announce",{source:a}))}},{id:"image-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async a=>{g("image-replace",{source:a}),e.replaceImage()}},{id:"video-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async a=>{g("video-replace",{source:a}),e.replaceVideo()}},{id:"download-original",label:"action.download-original",readonlyOk:!0,onSelect:async a=>{let b=c.getSelectedShapes();if(0===b.length)return;let d=b.filter(a=>Qc(a,c));if(0!==d.length){for(let a of d){let b=c.getAsset(a.props.assetId);if(!b||!b.props.src)continue;let d=await c.resolveAssetUrl(b.id,{shouldResolveToOriginal:!0});if(!d)return;let e=document.createElement("a");e.href=d,"video"!==b.type&&"image"!==b.type||b.props.src.startsWith("asset:")?e.download="download":e.download=b.props.name,document.body.appendChild(e),e.click(),document.body.removeChild(e)}g("download-original",{source:a})}}}];d&&m.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(a){g("open-cursor-chat",{source:a}),c.getInstanceState().isCoarsePointer||c.timers.requestAnimationFrame(()=>{c.updateInstanceState({isChatting:!0})})}});let n=Object.fromEntries(m.map(a=>[a.id,a]));return a?a(c,n,e):n},[e,c,g,a,j,d,i,h,f]);return(0,bT.jsx)(Qb.Provider,{value:k,children:b})}function Qf(){let a=eQ.useContext(Qb);if(!a)throw Error("useTools must be used within a ToolProvider");return a}function Qg(a,b){return a?"string"==typeof a?a:b?a[b]??a.default:void 0:void 0}function Qh({actionId:a="",...b}){let c=Qf()[a];return c?(0,bT.jsx)(Kr,{...c,...b}):null}function Qi(){let a;return e$("showAutoSizeToggle",()=>{let b=a.getSelectedShapes();return 1===b.length&&a.isShapeOfType(b[0],"text")&&!1===b[0].props.autoSize},[a=kp()])?(0,bT.jsx)(Hy,{actionId:"toggle-auto-size"}):null}function Qj(){return J3()?(0,bT.jsx)(Hy,{actionId:"edit-link"}):null}function Qk(){return J2(1)?(0,bT.jsx)(Hy,{actionId:"duplicate"}):null}function Ql(){let a=kp();return e$("should display flatten option",()=>{if(0===a.getSelectedShapeIds().length)return!1;let b=a.getOnlySelectedShape();return!(b&&a.isShapeOfType(b,"image"))},[a])?(0,bT.jsx)(Hy,{actionId:"flatten-to-image"}):null}function Qm(){let a=kp();return e$("should display download original option",()=>{let b=a.getSelectedShapes();return 0!==b.length&&b.some(b=>Qc(b,a))},[a])?(0,bT.jsx)(Hy,{actionId:"download-original"}):null}function Qn(){return J_()?(0,bT.jsx)(Hy,{actionId:"group"}):null}function Qo(){return J0()?(0,bT.jsx)(Hy,{actionId:"ungroup"}):null}function Qp(){let a=kp();return e$("allow unframe",()=>{let b=a.getSelectedShapes();return 0!==b.length&&b.every(b=>a.isShapeOfType(b,"frame"))},[a])?(0,bT.jsx)(Hy,{actionId:"remove-frame"}):null}function Qq(){let a=kp();return e$("allow fit frame to content",()=>{let b=a.getOnlySelectedShape();return!!b&&a.isShapeOfType(b,"frame")&&a.getSortedChildIdsForParent(b).length>0},[a])?(0,bT.jsx)(Hy,{actionId:"fit-frame-to-content"}):null}function Qr(){let a=kp();return e$("selected shapes",()=>a.getSelectedShapes().length>0,[a])?(0,bT.jsx)(Hy,{actionId:"toggle-lock"}):null}function Qs(){let a=kp(),b=e$("isTransparentBg",()=>!a.getInstanceState().exportBackground,[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-transparent",checked:b,toggle:!0})}function Qt(){let a=kp(),b=e$("any shapes",()=>a.getCurrentPageShapeIds().size>0,[a]);return(0,bT.jsx)(Hy,{actionId:"unlock-all",disabled:!b})}function Qu(){let a=kp(),b=e$("zoomed to 100",()=>1===a.getZoomLevel(),[a]);return(0,bT.jsx)(Hy,{actionId:"zoom-to-100",noClose:!0,disabled:b})}function Qv(){let a=kp(),b=e$("has shapes",()=>a.getCurrentPageShapeIds().size>0,[a]);return(0,bT.jsx)(Hy,{actionId:"zoom-to-fit",disabled:!b,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function Qw(){let a=kp(),b=e$("has shapes",()=>a.getSelectedShapeIds().length>0,[a]);return(0,bT.jsx)(Hy,{actionId:"zoom-to-selection",disabled:!b,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function Qx(){return(0,bT.jsxs)(Hz,{id:"clipboard",children:[(0,bT.jsx)(Qz,{}),(0,bT.jsx)(QA,{}),(0,bT.jsx)(QB,{}),(0,bT.jsx)(Qk,{}),(0,bT.jsx)(QE,{})]})}function Qy(){let a=kp(),b=e$("atLeastOneShapeOnPage",()=>a.getCurrentPageShapeIds().size>0,[a]);return(0,bT.jsxs)(Ks,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!b,children:[(0,bT.jsxs)(Hz,{id:"copy-as-group",children:[(0,bT.jsx)(Hy,{actionId:"copy-as-svg"}),!!window.navigator.clipboard?.write&&(0,bT.jsx)(Hy,{actionId:"copy-as-png"})]}),(0,bT.jsx)(Hz,{id:"copy-as-bg",children:(0,bT.jsx)(Qs,{})})]})}function Qz(){let a=J2(1);return(0,bT.jsx)(Hy,{actionId:"cut",disabled:!a})}function QA(){let a=J1(1);return(0,bT.jsx)(Hy,{actionId:"copy",disabled:!a})}function QB(){return(0,bT.jsx)(Hy,{actionId:"paste",disabled:!0})}function QC(){let a=kp();return e$("atLeastOneShapeOnPage",()=>a.getCurrentPageShapeIds().size>0,[a])?(0,bT.jsxs)(Hz,{id:"conversions",children:[(0,bT.jsx)(Qy,{}),(0,bT.jsxs)(Ks,{id:"export-as",label:"context-menu.export-as",size:"small",children:[(0,bT.jsxs)(Hz,{id:"export-as-group",children:[(0,bT.jsx)(Hy,{actionId:"export-as-svg"}),(0,bT.jsx)(Hy,{actionId:"export-as-png"})]}),(0,bT.jsx)(Hz,{id:"export-as-bg",children:(0,bT.jsx)(Qs,{})})]}),(0,bT.jsx)(Qm,{})]}):null}function QD(){let a=kp(),b=e$("atLeastOneShapeOnPage",()=>a.getCurrentPageShapeIds().size>0,[a]);return(0,bT.jsx)(Hy,{actionId:"select-all",disabled:!b})}function QE(){let a=J2(1);return(0,bT.jsx)(Hy,{actionId:"delete",disabled:!a})}function QF(){let a=Ft();return!J1(1)||a?null:(0,bT.jsxs)(Ks,{id:"edit",label:"context-menu.edit",size:"small",children:[(0,bT.jsx)(Qn,{}),(0,bT.jsx)(Qo,{}),(0,bT.jsx)(Ql,{}),(0,bT.jsx)(Qj,{}),(0,bT.jsx)(Qq,{}),(0,bT.jsx)(Qp,{}),(0,bT.jsx)(QM,{}),(0,bT.jsx)(QL,{}),(0,bT.jsx)(Qi,{}),(0,bT.jsx)(Qr,{})]})}function QG(){let a,b=J2(2),c=e$("onlyFlippableShape",()=>{let b=a.getOnlySelectedShape();return b&&(a.isShapeOfType(b,"group")||a.isShapeOfType(b,"image")||a.isShapeOfType(b,"arrow")||a.isShapeOfType(b,"line")||a.isShapeOfType(b,"draw"))},[a=kp()]);return Ft()||!(b||c)?null:(0,bT.jsxs)(Ks,{id:"arrange",label:"context-menu.arrange",size:"small",children:[b&&(0,bT.jsxs)(Hz,{id:"align",children:[(0,bT.jsx)(Hy,{actionId:"align-left"}),(0,bT.jsx)(Hy,{actionId:"align-center-horizontal"}),(0,bT.jsx)(Hy,{actionId:"align-right"}),(0,bT.jsx)(Hy,{actionId:"align-top"}),(0,bT.jsx)(Hy,{actionId:"align-center-vertical"}),(0,bT.jsx)(Hy,{actionId:"align-bottom"})]}),(0,bT.jsx)(QH,{}),b&&(0,bT.jsxs)(Hz,{id:"stretch",children:[(0,bT.jsx)(Hy,{actionId:"stretch-horizontal"}),(0,bT.jsx)(Hy,{actionId:"stretch-vertical"})]}),(b||c)&&(0,bT.jsxs)(Hz,{id:"flip",children:[(0,bT.jsx)(Hy,{actionId:"flip-horizontal"}),(0,bT.jsx)(Hy,{actionId:"flip-vertical"})]}),(0,bT.jsx)(QI,{})]})}function QH(){return J2(3)?(0,bT.jsxs)(Hz,{id:"distribute",children:[(0,bT.jsx)(Hy,{actionId:"distribute-horizontal"}),(0,bT.jsx)(Hy,{actionId:"distribute-vertical"})]}):null}function QI(){let a=J2(2),b=JZ();return a?(0,bT.jsxs)(Hz,{id:"order",children:[(0,bT.jsx)(Hy,{actionId:"pack"}),b&&(0,bT.jsx)(Hy,{actionId:"stack-horizontal"}),b&&(0,bT.jsx)(Hy,{actionId:"stack-vertical"})]}):null}function QJ(){let a=Ft(),b=J2(1);return a||!b?null:(0,bT.jsx)(Ks,{id:"reorder",label:"context-menu.reorder",size:"small",children:(0,bT.jsxs)(Hz,{id:"reorder",children:[(0,bT.jsx)(Hy,{actionId:"bring-to-front"}),(0,bT.jsx)(Hy,{actionId:"bring-forward"}),(0,bT.jsx)(Hy,{actionId:"send-backward"}),(0,bT.jsx)(Hy,{actionId:"send-to-back"})]})})}function QK(){let a=kp(),b=e$("pages",()=>a.getPages(),[a]),c=e$("current page id",()=>a.getCurrentPageId(),[a]),{addToast:d}=Ia(),e=F0(),f=Ft();return!J2(1)||f?null:(0,bT.jsxs)(Ks,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[(0,bT.jsx)(Hz,{id:"pages",children:b.map(b=>(0,bT.jsx)(Hw,{id:b.id,disabled:c===b.id,label:b.name.length>30?`${b.name.slice(0,30)}\u2026`:b.name,onSelect:()=>{a.markHistoryStoppingPoint("move_shapes_to_page"),a.moveShapesToPage(a.getSelectedShapeIds(),b.id);let f=a.getPage(b.id);f&&d({title:"Changed page",description:`Moved to ${f.name}.`,actions:[{label:"Go back",type:"primary",onClick:()=>{a.markHistoryStoppingPoint("change-page"),a.setCurrentPage(c)}}]}),e("move-to-page",{source:"context-menu"})}},b.id))}),(0,bT.jsx)(Hz,{id:"new-page",children:(0,bT.jsx)(Hy,{actionId:"move-to-new-page"})})]})}function QL(){let a=kp();return e$("oneEmbedSelected",()=>{let b=a.getOnlySelectedShape();return!!b&&!!(a.isShapeOfType(b,"embed")&&b.props.url&&!a.isShapeOrAncestorLocked(b))},[a])?(0,bT.jsx)(Hy,{actionId:"convert-to-bookmark"}):null}function QM(){let a=kp(),b=B8();return e$("oneEmbeddableBookmarkSelected",()=>{let c=a.getOnlySelectedShape();return!!c&&!!(a.isShapeOfType(c,"bookmark")&&c.props.url&&b(c.props.url)&&!a.isShapeOrAncestorLocked(c))},[a])?(0,bT.jsx)(Hy,{actionId:"convert-to-embed"}):null}function QN(){let a=kp(),b=e$("isSnapMode",()=>a.user.getIsSnapMode(),[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-snap-mode",checked:b})}function QO(){let a=kp(),b=e$("isToolLock",()=>a.getInstanceState().isToolLocked,[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-tool-lock",checked:b})}function QP(){let a=kp(),b=e$("isGridMode",()=>a.getInstanceState().isGridMode,[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-grid",checked:b})}function QQ(){let a=kp(),b=e$("isWrapMode",()=>a.user.getIsWrapMode(),[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-wrap-mode",checked:b})}function QR(){let a=kp(),b=e$("isFocusMode",()=>a.getInstanceState().isFocusMode,[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-focus-mode",checked:b})}function QS(){let a=kp(),b=e$("edgeScrollSpeed",()=>a.user.getEdgeScrollSpeed(),[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-edge-scrolling",checked:1===b})}function QT(){let a=kp(),b=e$("animationSpeed",()=>a.user.getAnimationSpeed(),[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-reduce-motion",checked:0===b})}function QU(){let a=kp(),b=e$("keyboardShortcuts",()=>a.user.getAreKeyboardShortcutsEnabled(),[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-keyboard-shortcuts",checked:b})}function QV(){let a=kp(),b=e$("enhancedA11yMode",()=>a.user.getEnhancedA11yMode(),[a]);return(0,bT.jsx)(Qh,{actionId:"enhanced-a11y-mode",checked:b})}function QW(){let a=kp(),b=e$("isDebugMode",()=>a.getInstanceState().isDebugMode,[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-debug-mode",checked:b})}function QX(){let a=kp(),b=e$("dynamic resize",()=>a.user.getIsDynamicResizeMode(),[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-dynamic-size-mode",checked:b})}function QY(){let a=kp(),b=e$("paste at cursor",()=>a.user.getIsPasteAtCursorMode(),[a]);return(0,bT.jsx)(Qh,{actionId:"toggle-paste-at-cursor",checked:b})}function QZ(){let a=kp();return e$("show cursor chat",()=>"select"===a.getCurrentToolId()&&!a.getInstanceState().isCoarsePointer,[a])?(0,bT.jsx)(Hy,{actionId:"open-cursor-chat"}):null}function Q$(){return(0,bT.jsx)(Ks,{id:"help menu accessibility",label:"menu.accessibility",children:(0,bT.jsxs)(Hz,{id:"accessibility",children:[(0,bT.jsx)(QT,{}),(0,bT.jsx)(QU,{}),(0,bT.jsx)(QV,{})]})})}function Q_(a,b){let c,d,e,f=a.getShape(b);if(!f)return;let{start:g,end:h}=JO(a,f),i=g?a.getShape(g.toId):void 0,j=h?a.getShape(h.toId):void 0,k=a.getAncestorPageId(f);if(!k)return;if(i&&j)c=a.findCommonAncestor([i,j])??k;else{if(!i&&!j)return;let a=(i||j)?.parentId;c=a&&a===f.parentId?f.parentId:k}c&&c!==f.parentId&&a.reparentShapes([b],c);let l=a.getShape(b);if(!l)throw Error("no reparented arrow");let m=a.getShapeNearestSibling(l,i),n=a.getShapeNearestSibling(l,j);if(m&&n)d=m.index>n.index?m:n;else if(m&&!n)d=m;else{if(!n||m)return;d=n}let o=a.getSortedChildIdsForParent(d.parentId).map(b=>a.getShape(b)).filter(a=>a.index>d.index);if(o.length){let a=o.find(a=>"arrow"!==a.type);if(l.index>d.index&&(!a||l.index<a.index))return;e=dv(d.index,o[0].index)}else e=dw(d.index);e!==l.index&&a.updateShapes([{id:b,type:"arrow",index:e}])}function Q0(a,b){let c=JO(a,b);for(let d of["start","end"]){let e=c[d];if(!e)continue;let f=a.getShape(e.toId),g=a.getAncestorPageId(b)===a.getAncestorPageId(f);f&&g||Q1({editor:a,arrow:b,terminal:d,unbind:!0})}Q_(a,b.id)}function Q1({editor:a,arrow:b,terminal:c,unbind:d=!1,useHandle:e=!1}){let f=JQ(a,b);if(!f)throw Error("expected arrow info");let g=e?f.start.handle:f.start.point,h=e?f.end.handle:f.end.point,i="start"===c?g:h,j={id:b.id,type:"arrow",props:{[c]:{x:i.x,y:i.y},bend:b.props.bend}};if("arc"===f.type){let a="start"===c?g:f.start.handle,d="end"===c?h:f.end.handle,e=jA.Med(a,d),i=jA.Sub(a,d).per().uni().mul(2*f.handleArc.radius*Math.sign(b.props.bend)),k=lk(f.handleArc.center,jA.Add(e,i),f.handleArc.center,f.handleArc.radius);cg(k?.length===1);let l=jA.Dist(e,k[0])*Math.sign(b.props.bend);jK(l,j.props.bend)||(j.props.bend=l)}a.updateShape(j),d&&JT(a,b,c)}function Q2({size:a,width:b,height:c,hideAlternateHandles:d}){let e=jX(a/3),f=e/2,g=zQ();return(0,bT.jsxs)("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[(0,bT.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${jX(0-f)},${jX(a)} 
						${jX(0-f)},${jX(0-f)} 
						${jX(a)},${jX(0-f)}`,strokeWidth:e,"data-testid":"selection.crop.top_left",role:"button","aria-label":g("handle.crop.top-left")}),(0,bT.jsx)("line",{className:(0,j1.default)("tl-corner-crop-edge-handle",{"tl-hidden":d}),x1:jX(b/2-a),y1:jX(0-f),x2:jX(b/2+a),y2:jX(0-f),strokeWidth:e,"data-testid":"selection.crop.top",role:"button","aria-label":g("handle.crop.top")}),(0,bT.jsx)("polyline",{className:(0,j1.default)("tl-corner-crop-handle",{"tl-hidden":d}),points:`
						${jX(b-a)},${jX(0-f)} 
						${jX(b+f)},${jX(0-f)} 
						${jX(b+f)},${jX(a)}`,strokeWidth:e,"data-testid":"selection.crop.top_right",role:"button","aria-label":g("handle.crop.top-right")}),(0,bT.jsx)("line",{className:(0,j1.default)("tl-corner-crop-edge-handle",{"tl-hidden":d}),x1:jX(b+f),y1:jX(c/2-a),x2:jX(b+f),y2:jX(c/2+a),strokeWidth:e,"data-testid":"selection.crop.right",role:"button","aria-label":g("handle.crop.right")}),(0,bT.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${jX(b+f)},${jX(c-a)} 
						${jX(b+f)},${jX(c+f)}
						${jX(b-a)},${jX(c+f)}`,strokeWidth:e,"data-testid":"selection.crop.bottom_right",role:"button","aria-label":g("handle.crop.bottom-right")}),(0,bT.jsx)("line",{className:(0,j1.default)("tl-corner-crop-edge-handle",{"tl-hidden":d}),x1:jX(b/2-a),y1:jX(c+f),x2:jX(b/2+a),y2:jX(c+f),strokeWidth:e,"data-testid":"selection.crop.bottom",role:"button","aria-label":g("handle.crop.bottom")}),(0,bT.jsx)("polyline",{className:(0,j1.default)("tl-corner-crop-handle",{"tl-hidden":d}),points:`
						${jX(0+a)},${jX(c+f)} 
						${jX(0-f)},${jX(c+f)}
						${jX(0-f)},${jX(c-a)}`,strokeWidth:e,"data-testid":"selection.crop.bottom_left",role:"button","aria-label":g("handle.crop.bottom-left")}),(0,bT.jsx)("line",{className:(0,j1.default)("tl-corner-crop-edge-handle",{"tl-hidden":d}),x1:jX(0-f),y1:jX(c/2-a),x2:jX(0-f),y2:jX(c/2+a),strokeWidth:e,"data-testid":"selection.crop.left",role:"button","aria-label":g("handle.crop.left")})]})}function Q3({children:a}){let b=kp();return e$("shouldDisplayHandles",()=>{if(b.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(b.isInAny("select.editing_shape")){let a=b.getOnlySelectedShape();return a&&b.isShapeOfType(a,"note")}return!1},[b])?(0,bT.jsx)("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:a}):null}let Q4=new cl;function Q5(a){return Q4.get(a,()=>eM("arrowTarget",null))}function Q6(a){Q5(a).set(null)}function Q7({editor:a,pointInPageSpace:b,arrow:c,isPrecise:d,currentBinding:e,oppositeBinding:f}){var g,h,i,j;let k=a.getShapeUtil("arrow");if(k.options.shouldIgnoreTargets(a))return Q5(a).set(null),null;let l=c?c.props.kind:a.getStyleForNextShape(hv),m=a.getShapeAtPoint(b,{hitInside:!0,hitFrameInside:!0,margin:"elbow"===l?8:[8,0],filter:b=>!b.isLocked&&a.canBindShapes({fromShape:c??Q8,toShape:b,binding:"arrow"})});if(!m)return Q5(a).set(null),null;let n=a.getShapeGeometry(m),o=lh.ZeroFix(n.bounds),p=n.center,q=a.getShapePageTransform(m),r=a.getPointInShapeSpace(m,b),s=Math.max(n.bounds.width,n.bounds.height),t=c0(Jc,(a,b)=>{let c=Jf[Jd[a]],d=jA.Mul(b,s).add(p),e=!1,f=c.v(o[a],o[c.crossMid]),g=0;for(let a of n.intersectLineSegment(p,d,ls)){let b=jA.Dist2(a,p);b>g&&(g=b,f=a,e=n.isClosed)}return{point:q.applyToPoint(f),isEnabled:e,far:q.applyToPoint(d)}}),u=a.getZoomLevel(),v=k.options.minElbowHandleDistance/u,w=q.applyToPoint(p);for(let a of cW(t)){let b=t[a];jA.DistMin(b.point,w,v)&&(b.isEnabled=!1)}let y=d;y||e&&(!e||m.id===e.toId)||(y=.5>a.inputs.pointerVelocity.len()),!d&&(n.isClosed||(y=!0),f&&m.id===f.toId&&f.props.isPrecise&&(y=!0));let z=k.options.shouldBeExact(a,y);z&&(y=!0);let A=!z&&y&&n.isClosed,B=!z&&(y&&"elbow"===l||!n.isClosed),C=!z&&y&&"elbow"===l&&n.isClosed,D=y&&(n.isClosed||z),E=!z&&y&&"elbow"===l&&n.isClosed,F="none",G=b;if(D||(F="center",G=w),B){let c=D?Q9(a,o,k.options.elbowArrowEdgeSnapDistance):1/0,d=n.nearestPoint(r,{includeLabels:!1,includeInternal:!1}),e=q.applyToPoint(d);jA.Dist(e,b)<c&&(F="edge",G=e)}if(E){let c=Q9(a,o,k.options.elbowArrowAxisSnapDistance),d=jA.DistanceToLineSegment(t.left.far,t.right.far,b),e=jA.DistanceToLineSegment(t.top.far,t.bottom.far,b),f=d<e&&d<c?"x":e<c?"y":null;if(f){let a=Jf[f],c=jA.Dist2(t[a.loEdge].far,b)<jA.Dist2(t[a.hiEdge].far,b)?a.loEdge:a.hiEdge;t[c].isEnabled&&(F="edge-point",G=t[c].point)}}if(C){let c=Q9(a,o,k.options.elbowArrowPointSnapDistance),d=null,e=1/0;for(let[a,f]of cY(t)){if(!f.isEnabled)continue;let g=jA.Dist(f.point,b);g<c&&g<e&&(e=g,d=a)}d&&(F="edge-point",G=t[d].point)}if(A){let b=Q9(a,o,"elbow"===l?k.options.elbowArrowCenterSnapDistance:k.options.arcArrowCenterSnapDistance);jA.Dist(r,o.center)<b&&(F="center",G=w)}let H=a.getPointInShapeSpace(m,G),I={target:m,arrowKind:l,handlesInPageSpace:t,centerInPageSpace:w,anchorInPageSpace:G,isExact:z,isPrecise:y,snap:F,normalizedAnchor:{x:(g=o.minX,h=o.maxX,(H.x-g)/(h-g)),y:(i=o.minY,j=o.maxY,(H.y-i)/(j-i))}};return Q5(a).set(I),I}let Q8={type:"arrow"};function Q9(a,b,c){return jI(.15*Math.min(b.width,b.height),4,c)/a.getZoomLevel()}function Ra(){let a=kp();return e$("should show arrow hints",()=>{if(a.isInAny("arrow.idle","arrow.pointing"))return!0;if(a.isIn("select.pointing_handle")){let b=a.getStateDescendant("select.pointing_handle");if("arrow"===b.info.shape.type&&("start"===b.info.handle.id||"end"===b.info.handle.id))return!0}if(a.isIn("select.dragging_handle")){let b=a.getStateDescendant("select.dragging_handle");if("arrow"===b.info.shape.type&&("start"===b.info.handle.id||"end"===b.info.handle.id))return!0}return!1},[a])?(0,bT.jsx)(Rb,{}):null}function Rb(){let a=kp(),{ShapeIndicator:b}=re(),c=e$("arrow target info",()=>Q5(a).get(),[a]);if(!c)return null;let{handlesInPageSpace:d,snap:e,anchorInPageSpace:f,arrowKind:g,isExact:h,isPrecise:i}=c;return(0,bT.jsxs)(bT.Fragment,{children:[b&&(0,bT.jsx)(b,{shapeId:c.target.id}),!h&&"elbow"===g&&(0,bT.jsxs)("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[(0,bT.jsx)("circle",{cx:f.x,cy:f.y,className:`tl-arrow-hint-snap tl-arrow-hint-snap__${i?e??"none":"none"}`}),Object.entries(d).map(([a,b])=>b.isEnabled?(0,bT.jsx)("circle",{cx:b.point.x,cy:b.point.y,className:"tl-arrow-hint-handle"},a):null)]})]})}let{PI:Rc}=Math,Rd=Rc+1e-4;function Re(a,b={}){let c,{size:d=16,smoothing:e=.5}=b;if(0===a.length||d<=0)return{left:[],right:[]};let f=a[0],g=a[a.length-1],h=g.runningLength,i=Math.pow(d*e,2),j=[],k=[],l=a[0].vector,m=a[0].point,n=m,o=m,p=n,q=!1;for(let b=0;b<a.length;b++){c=a[b];let{point:d,vector:e}=a[b],r=c.vector.dpr(l),s=(b<a.length-1?a[b+1]:a[b]).vector,t=b<a.length-1?s.dpr(c.vector):1,u=null!==t&&t<.2;if(r<0&&!q||u){if(t>-.62&&h-c.runningLength>c.radius){let a=l.clone().mul(c.radius);0>l.clone().cpr(s)?(o=jA.Add(d,a),p=jA.Sub(d,a)):(o=jA.Sub(d,a),p=jA.Add(d,a)),j.push(o),k.push(p)}else{let a=l.clone().mul(c.radius).per(),b=jA.Sub(c.input,a);for(let a=1/13,d=0;d<1;d+=a)o=jA.RotWith(b,c.input,Rd*d),j.push(o),p=jA.RotWith(b,c.input,Rd+-(Rd*d)),k.push(p)}m=o,n=p,u&&(q=!0);continue}if(q=!1,c===f||c===g){let a=jA.Per(e).mul(c.radius);j.push(jA.Sub(d,a)),k.push(jA.Add(d,a));continue}let v=jA.Lrp(s,e,t).per().mul(c.radius);o=jA.Sub(d,v),(b<=1||jA.Dist2(m,o)>i)&&(j.push(o),m=o),p=jA.Add(d,v),(b<=1||jA.Dist2(n,p)>i)&&(k.push(p),n=p),l=e}return{left:j,right:k}}function Rf(a,b={}){let{size:c=16,start:d={},end:e={},last:f=!1}=b,{cap:g=!0}=d,{cap:h=!0}=e;if(0===a.length||c<=0)return[];let i=a[0],j=a[a.length-1],k=j.runningLength,l=!1===d.taper?0:!0===d.taper?Math.max(c,k):d.taper,m=!1===e.taper?0:!0===e.taper?Math.max(c,k):e.taper,{left:n,right:o}=Re(a,b),p=i.point,q=a.length>1?a[a.length-1].point:jA.AddXY(i.point,1,1);if(1===a.length&&(!(l||m)||f)){let a=jA.Add(p,jA.Sub(p,q).uni().per().mul(-i.radius)),b=[];for(let c=1/13,d=c;d<=1;d+=c)b.push(jA.RotWith(a,p,2*Rd*d));return b}let r=[];if(l||m&&1===a.length);else if(g)for(let a=1/8,b=a;b<=1;b+=a){let a=jA.RotWith(o[0],p,Rd*b);r.push(a)}else{let a=jA.Sub(n[0],o[0]),b=jA.Mul(a,.5),c=jA.Mul(a,.51);r.push(jA.Sub(p,b),jA.Sub(p,c),jA.Add(p,c),jA.Add(p,b))}let s=[],t=j.vector.clone().per().neg();if(m||l&&1===a.length)s.push(q);else if(h){let a=jA.Add(q,jA.Mul(t,j.radius));for(let b=1/29,c=b;c<1;c+=b)s.push(jA.RotWith(a,q,3*Rd*c))}else s.push(jA.Add(q,jA.Mul(t,j.radius)),jA.Add(q,jA.Mul(t,.99*j.radius)),jA.Sub(q,jA.Mul(t,.99*j.radius)),jA.Sub(q,jA.Mul(t,j.radius)));return n.concat(s,o.reverse(),r)}function Rg(a,b={}){let c,d,{streamline:e=.5,size:f=16,simulatePressure:g=!1}=b;if(0===a.length)return[];let h=.15+(1-e)*.85,i=a.map(jA.From),j=0;if(!g){let a=i[0];for(;a&&!(a.z>=.025);)i.shift(),a=i[0]}if(!g){let a=i[i.length-1];for(;a&&!(a.z>=.01);)i.pop(),a=i[i.length-1]}if(0===i.length)return[{point:jA.From(a[0]),input:jA.From(a[0]),pressure:g?.5:.15,vector:new jA(1,1),distance:0,runningLength:0,radius:1}];let k=i[1];for(;k&&!(jA.Dist2(k,i[0])>(f/3)**2);)i[0].z=Math.max(i[0].z,k.z),i.splice(1,1),k=i[1];let l=i.pop();for(k=i[i.length-1];k&&!(jA.Dist2(k,l)>(f/3)**2);)i.pop(),k=i[i.length-1],j++;i.push(l);let m=b.last||!b.simulatePressure||i.length>1&&jA.Dist2(i[i.length-1],i[i.length-2])<f**2||j>0;if(2===i.length&&b.simulatePressure){let a=i[1];i=i.slice(0,-1);for(let b=1;b<5;b++){let c=jA.Lrp(i[0],a,b/4);c.z=(i[0].z+(a.z-i[0].z))*b/4,i.push(c)}}let n=[{point:i[0],input:i[0],pressure:g?.5:i[0].z,vector:new jA(1,1),distance:0,runningLength:0,radius:1}],o=0,p=n[0];m&&e>0&&i.push(i[i.length-1].clone());for(let a=1,e=i.length;a<e;a++)c=!h||b.last&&a===e-1?i[a].clone():i[a].clone().lrp(p.point,1-h),!p.point.equals(c)&&(o+=d=jA.Dist(c,p.point),a<4&&o<f||(p={input:i[a],point:c,pressure:g?.5:i[a].z,vector:jA.Sub(p.point,c).uni(),distance:d,runningLength:o,radius:1},n.push(p)));if(n[1]?.vector&&(n[0].vector=n[1].vector.clone()),o<1){let a=Math.max(.5,...n.map(a=>a.pressure));n.forEach(b=>b.pressure=a)}return n}let{min:Rh}=Math;function Ri(a,b){let c,d,{size:e=16,thinning:f=.5,simulatePressure:g=!0,easing:h=a=>a,start:i={},end:j={}}=b,{easing:k=jv}=i,{easing:l=jw}=j,m=a[a.length-1].runningLength,n=a[0].pressure;if(!g&&m<e){let b=a.reduce((a,b)=>Math.max(a,b.pressure),.5);return a.forEach(a=>{a.pressure=b,a.radius=e*h(.5-f*(.5-a.pressure))}),a}{let b;for(let c=0,f=a.length;c<f&&!((d=a[c]).runningLength>5*e);c++){let a=Rh(1,d.distance/e);if(g){let c=Rh(1,1-a);b=Rh(1,n+.275*a*(c-n))}else b=Rh(1,n+(d.pressure-n)*.5);n+=(b-n)*.5}for(let b=0;b<a.length;b++){if(d=a[b],f){let{pressure:a}=d,b=Rh(1,d.distance/e);if(g){let c=Rh(1,1-b);a=Rh(1,n+.275*b*(c-n))}else a=Rh(1,n+.275*b*(a-n));d.radius=e*h(.5-f*(.5-a)),n=a}else d.radius=e/2;void 0===c&&(c=d.radius)}}let o=!1===i.taper?0:!0===i.taper?Math.max(e,m):i.taper,p=!1===j.taper?0:!0===j.taper?Math.max(e,m):j.taper;if(o||p)for(let b=0;b<a.length;b++){let{runningLength:c}=d=a[b],e=c<o?k(c/o):1,f=m-c<p?l((m-c)/p):1;d.radius=Math.max(.01,d.radius*Math.min(e,f))}return a}function Rj({scribble:a,zoom:b,color:c,opacity:d,className:e}){let f;if(!a.points.length)return null;let g=function(a,b={}){return Rf(Ri(Rg(a,b),b),b)}(a.points,{size:a.size/b,start:{taper:a.taper,easing:jt},last:"stopping"===a.state,simulatePressure:!1,streamline:.32});if(g.length<4){let c=a.size/b/2,{x:d,y:e}=a.points[a.points.length-1];f=`M ${d-c},${e} a ${c},${c} 0 1,0 ${2*c},0 a ${c},${c} 0 1,0 ${-(2*c)},0`}else f=qZ(g);return(0,bT.jsx)("svg",{className:e?(0,j1.default)("tl-overlays__item",e):e,children:(0,bT.jsx)("path",{className:"tl-scribble",d:f,fill:c??`var(--tl-color-${a.color})`,opacity:d??a.opacity})})}let Rk=eV(function({bounds:a,rotation:b}){let c=kp(),d=zQ(),e=(0,eQ.useRef)(null),f=Ft(),g=sB("top"),h=sB("right"),i=sB("bottom"),j=sB("left"),k=sB("top_left"),l=sB("top_right"),m=sB("bottom_right"),n=sB("bottom_left"),o="default"===c.getInstanceState().cursor.type,p=c.getInstanceState().isCoarsePointer,q=c.getOnlySelectedShape(),r=q&&c.isShapeOrAncestorLocked(q),s=q?c.getShapeUtil(q).expandSelectionOutlinePx(q):0,t=s instanceof lh?a.clone().expand(s).zeroFix():a.clone().expandBy(s).zeroFix();if(js(e,a?.x,a?.y,1,c.getSelectionRotation(),{x:t.x-a.x,y:t.y-a.y}),q&&c.isShapeHidden(q))return null;let u=c.getZoomLevel(),v=c.getInstanceState().isChangingStyle,w=t.width,y=t.height,z=8/u,A=w<2*z,B=y<2*z,C=w<4*z,D=y<4*z,E=w<5*z,F=y<5*z,G=p?1.75:1,H=6/u*G,I=.75*G*(C?H/2:H),J=.75*G*(D?H/2:H),K=(!q||!c.getShapeUtil(q).hideSelectionBoundsFg(q))&&!v,L=K&&c.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||K&&c.isIn("select.resizing")&&q&&c.isShapeOfType(q,"text");q;let M=c.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!v&&!f,N=c.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!v&&!f,O=!p&&!(A||B)&&(N||M)&&(!q||!c.getShapeUtil(q).hideRotateHandle(q))&&!r,P=p&&(!C||!D)&&(N||M)&&(!q||!c.getShapeUtil(q).hideRotateHandle(q))&&!r,Q=N&&(!q||c.getShapeUtil(q).canResize(q)&&!c.getShapeUtil(q).hideResizeHandles(q))&&!M&&!r,R=A||B,S=A&&B,T=E||F,U=Q||M,V=!O,W=!N||!P,X=!N||!U,Y=!N||!U||R,Z=!N||!U||R,$=!N||!U||S&&!M,_=!0,aa=!0;if(M)_=T,aa=T;else if(Q){_=R||S||p;let a=p&&q&&"text"===q.type;aa=_&&!a}let ab=Math.min(24/u,y-3*J),ac=N&&p&&q&&c.isShapeOfType(q,"text")&&ab*u>=4;return(0,bT.jsx)("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground","aria-hidden":"true",children:(0,bT.jsxs)("g",{ref:e,children:[L&&(0,bT.jsx)("rect",{className:"tl-selection__fg__outline",width:jX(w),height:jX(y)}),(0,bT.jsx)(Rm,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:H,corner:"top_left_rotate",cursor:o?pY("nwse-rotate",b):void 0,isHidden:V}),(0,bT.jsx)(Rm,{"data-testid":"selection.rotate.top-right",cx:w+3*H,cy:0,targetSize:H,corner:"top_right_rotate",cursor:o?pY("nesw-rotate",b):void 0,isHidden:V}),(0,bT.jsx)(Rm,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:y+3*H,targetSize:H,corner:"bottom_left_rotate",cursor:o?pY("swne-rotate",b):void 0,isHidden:V}),(0,bT.jsx)(Rm,{"data-testid":"selection.rotate.bottom-right",cx:w+3*H,cy:y+3*H,targetSize:H,corner:"bottom_right_rotate",cursor:o?pY("senw-rotate",b):void 0,isHidden:V}),(0,bT.jsx)(Ro,{"data-testid":"selection.rotate.mobile",cx:C?-(1.5*H):w/2,cy:C?y/2:-(1.5*H),size:z,isHidden:W}),(0,bT.jsx)(Rl,{hide:_,dataTestId:"selection.resize.top",ariaLabel:d("handle.resize-top"),x:0,y:jX(0-(D?2*J:J)),width:jX(w),height:jX(Math.max(1,2*J)),cursor:o?pY("ns-resize",b):void 0,events:g}),(0,bT.jsx)(Rl,{hide:aa,dataTestId:"selection.resize.right",ariaLabel:d("handle.resize-right"),x:jX(w-(C?0:I)),y:0,height:jX(y),width:jX(Math.max(1,2*I)),cursor:o?pY("ew-resize",b):void 0,events:h}),(0,bT.jsx)(Rl,{hide:_,dataTestId:"selection.resize.bottom",ariaLabel:d("handle.resize-bottom"),x:0,y:jX(y-(D?0:J)),width:jX(w),height:jX(Math.max(1,2*J)),cursor:o?pY("ns-resize",b):void 0,events:i}),(0,bT.jsx)(Rl,{hide:aa,dataTestId:"selection.resize.left",ariaLabel:d("handle.resize-left"),x:jX(0-(C?2*I:I)),y:0,height:jX(y),width:jX(Math.max(1,2*I)),cursor:o?pY("ew-resize",b):void 0,events:j}),(0,bT.jsx)(Rl,{hide:X,dataTestId:"selection.target.top-left",ariaLabel:d("handle.resize-top-left"),x:jX(0-(C?2*I:1.5*I)),y:jX(0-(D?2*J:1.5*J)),width:jX(3*I),height:jX(3*J),cursor:o?pY("nwse-resize",b):void 0,events:k}),(0,bT.jsx)(Rl,{hide:Y,dataTestId:"selection.target.top-right",ariaLabel:d("handle.resize-top-right"),x:jX(w-(C?0:1.5*I)),y:jX(0-(D?2*J:1.5*J)),width:jX(3*I),height:jX(3*J),cursor:o?pY("nesw-resize",b):void 0,events:l}),(0,bT.jsx)(Rl,{hide:$,dataTestId:"selection.target.bottom-right",ariaLabel:d("handle.resize-bottom-right"),x:jX(w-(C?I:1.5*I)),y:jX(y-(D?J:1.5*J)),width:jX(3*I),height:jX(3*J),cursor:o?pY("nwse-resize",b):void 0,events:m}),(0,bT.jsx)(Rl,{hide:Z,dataTestId:"selection.target.bottom-left",ariaLabel:d("handle.resize-bottom-left"),x:jX(0-(C?3*I:1.5*I)),y:jX(y-(D?0:1.5*J)),width:jX(3*I),height:jX(3*J),cursor:o?pY("nesw-resize",b):void 0,events:n}),Q&&(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("rect",{"data-testid":"selection.resize.top-left",className:(0,j1.default)("tl-corner-handle",{"tl-hidden":X}),x:jX(0-z/2),y:jX(0-z/2),width:jX(z),height:jX(z)}),(0,bT.jsx)("rect",{"data-testid":"selection.resize.top-right",className:(0,j1.default)("tl-corner-handle",{"tl-hidden":Y}),x:jX(w-z/2),y:jX(0-z/2),width:jX(z),height:jX(z)}),(0,bT.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:(0,j1.default)("tl-corner-handle",{"tl-hidden":$}),x:jX(w-z/2),y:jX(y-z/2),width:jX(z),height:jX(z)}),(0,bT.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:(0,j1.default)("tl-corner-handle",{"tl-hidden":Z}),x:jX(0-z/2),y:jX(y-z/2),width:jX(z),height:jX(z)})]}),ac&&(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle",x:jX(0-z/4),y:jX(y/2-ab/2),rx:z/4,width:jX(z/2),height:jX(ab)}),(0,bT.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle",rx:z/4,x:jX(w-z/4),y:jX(y/2-ab/2),width:jX(z/2),height:jX(ab)})]}),M&&(0,bT.jsx)(Q2,{size:z,width:w,height:y,hideAlternateHandles:T})]})})}),Rl=function({hide:a,dataTestId:b,ariaLabel:c,x:d,y:e,width:f,height:g,cursor:h,events:i}){return(0,bT.jsx)("rect",{className:(0,j1.default)("tl-resize-handle","tl-transparent",{"tl-hidden":a}),"data-testid":b,role:"button","aria-label":c,pointerEvents:"all",x:d,y:e,width:f,height:g,cursor:h,...i})},Rm=function({cx:a,cy:b,targetSize:c,corner:d,cursor:e,isHidden:f,"data-testid":g}){let h=sB(d),i=zQ()(`handle.rotate.${d}`);return(0,bT.jsx)("rect",{className:(0,j1.default)("tl-transparent","tl-rotate-corner",{"tl-hidden":f}),"data-testid":g,role:"button","aria-label":i,pointerEvents:"all",x:jX(a-3*c),y:jX(b-3*c),width:jX(Math.max(1,3*c)),height:jX(Math.max(1,3*c)),cursor:e,...h})},Rn=Math.sqrt(Math.PI),Ro=function({cx:a,cy:b,size:c,isHidden:d,"data-testid":e}){let f=sB("mobile_rotate"),g=kp(),h=e$("zoom level",()=>g.getZoomLevel(),[g]),i=Math.max(1/h*14,20/Math.max(1,h)),j=zQ();return(0,bT.jsxs)("g",{role:"button","aria-label":j("handle.rotate.mobile_rotate"),children:[(0,bT.jsx)("circle",{"data-testid":e,pointerEvents:"all",className:(0,j1.default)("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":d}),cx:a,cy:b,r:i,...f}),(0,bT.jsx)("circle",{className:(0,j1.default)("tl-mobile-rotate__fg",{"tl-hidden":d}),cx:a,cy:b,r:c/Rn})]})};function Rp(){let a=kp(),b=e$("is in a valid select state",()=>a.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[a]);return(0,bT.jsx)(q5,{hideAll:!b})}let Rq=[class extends ss{static type="arrow";static props=hE;static migrations=hG;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5},snap:"none"}}onAfterCreate({binding:a}){let b=this.editor.getShape(a.fromId);b&&Q0(this.editor,b)}onAfterChange({bindingAfter:a}){let b=this.editor.getShape(a.fromId);b&&Q0(this.editor,b)}onAfterChangeFromShape({shapeAfter:a}){Q0(this.editor,a)}onAfterChangeToShape({binding:a,shapeBefore:b,shapeAfter:c,reason:d}){("ancestry"===d||b.parentId!==c.parentId||b.index!==c.index)&&Q_(this.editor,a.fromId)}onBeforeIsolateFromShape({binding:a}){let b=this.editor.getShape(a.fromId);b&&Q1({editor:this.editor,arrow:b,terminal:a.props.terminal})}}],Rr={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Rs={s:2,m:3.5,l:5,xl:10},Rt={s:18,m:24,l:36,xl:44},Ru={s:18,m:22,l:26,xl:32},Rv={s:18,m:20,l:24,xl:28},Rw={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};async function Rx(a,b,c){let{elements:d,files:e}=b,f={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:a.store.schema.serialize()},g=new Map,h=new Map,i=a.getCurrentPageId(),j=new Map,k=[],l=new Set;d.forEach(a=>{if(j.set(a.id,hd()),null!==a.boundElements)for(let b of a.boundElements)"text"===b.type&&l.add(b.id)});let m="a0";for(let a of d){if(l.has(a.id))continue;let b=j.get(a.id),c={id:b,typeName:"shape",parentId:i,index:m,x:a.x,y:a.y,rotation:0,isLocked:a.locked,opacity:Ry(a.opacity),meta:{}};switch(0!==a.angle&&h.set(b,a.angle),a.groupIds&&a.groupIds.length>0?g.has(a.groupIds[0])?g.get(a.groupIds[0])?.push(b):g.set(a.groupIds[0],[b]):k.push(b),a.type){case"rectangle":case"ellipse":case"diamond":{let b="",e="middle";if(null!==a.boundElements){for(let c of a.boundElements)if("text"===c.type){let a=d.find(a=>a.id===c.id);a&&(b=a.text,e=RH[a.textAlign])}}let g="transparent"===a.backgroundColor?a.strokeColor:a.backgroundColor;f.shapes.push({...c,type:"geo",props:{geo:a.type,url:a.link??"",w:a.width,h:a.height,size:Rz[a.strokeWidth]??"draw",color:RE[g]??"black",richText:g6(b),align:e,dash:RK(a),fill:RL(a)}});break}case"freedraw":f.shapes.push({...c,type:"draw",props:{dash:RK(a),size:Rz[a.strokeWidth],color:RE[a.strokeColor]??"black",segments:[{type:"free",points:a.points.map(([a,b,c=.5])=>({x:a,y:b,z:c}))}]}});break;case"line":{if(a.points.slice().length<2)break;let b=dy(a.points.length);f.shapes.push({...c,type:"line",props:{dash:RK(a),size:Rz[a.strokeWidth],color:RE[a.strokeColor]??"black",spline:a.roundness?"cubic":"line",points:{...Object.fromEntries(a.points.map(([a,c],d)=>{let e=b[d];return[e,{id:e,index:e,x:a,y:c}]}))}}});break}case"arrow":{let e="";if(null!==a.boundElements){for(let b of a.boundElements)if("text"===b.type){let a=d.find(a=>a.id===b.id);a&&(e=a.text)}}let g=a.points[0],h=a.points[a.points.length-1],i=j.get(a.startBinding?.elementId),k=j.get(a.endBinding?.elementId);f.shapes.push({...c,type:"arrow",props:{richText:g6(e),kind:a.elbowed?"elbow":"arc",bend:function(a,b,c){let d=0;if(a.points.length>2){let e=new jA(b[0],b[1]),f=new jA(c[0],c[1]),g=new jA(a.points[1][0],a.points[1][1]),h=jA.Sub(f,e),i=jA.Per(h),j=jA.Med(f,e),k=jA.Sub(j,i),l=jA.Add(j,i),m=jA.NearestPointOnLineSegment(k,l,g,!1);d=jA.Dist(m,j),jA.Clockwise(m,f,j)&&(d*=-1)}return d}(a,g,h),dash:RK(a),size:Rz[a.strokeWidth]??"m",color:RE[a.strokeColor]??"black",start:{x:g[0],y:g[1]},end:{x:h[0],y:h[1]},arrowheadEnd:RJ[a.endArrowhead]??"none",arrowheadStart:RJ[a.startArrowhead]??"none"}}),i&&f.bindings.push({id:g2(),typeName:"binding",type:"arrow",fromId:b,toId:i,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),k&&f.bindings.push({id:g2(),typeName:"binding",type:"arrow",fromId:b,toId:k,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{let{size:b,scale:d}=function(a){let b=RA[a];return b?{size:b,scale:1}:a<16?{size:"s",scale:a/16}:a>36?{size:"xl",scale:a/36}:{size:"m",scale:1}}(a.fontSize);f.shapes.push({...c,type:"text",props:{size:b,scale:d,font:RB[a.fontFamily]??"draw",color:RE[a.strokeColor]??"black",richText:g6(a.text),textAlign:RI[a.textAlign]}});break}case"image":{let b=e[a.fileId];if(!b)break;let d=iz.createId();f.assets.push({id:d,typeName:"asset",type:"image",props:{w:a.width,h:a.height,fileSize:b.size,name:a.id??"Untitled",isAnimated:!1,mimeType:b.mimeType,src:b.dataURL},meta:{}}),f.shapes.push({...c,type:"image",props:{w:a.width,h:a.height,assetId:d}})}}m=dw(m)}let n=c??(a.inputs.shiftKey?a.inputs.currentPagePoint:void 0);for(let b of(a.putContentOntoCurrentPage(f,{point:n,select:!1,preserveIds:!0}),g.values()))if(b.length>1){a.groupShapes(b);let c=a.getShape(b[0]);c?.parentId&&hc(c.parentId)&&k.push(c.parentId)}for(let[b,c]of h)a.select(b),a.rotateShapesBy([b],c);let o=b5(k.map(b=>a.getShape(b))),p=lh.Common(o.map(b=>a.getShapePageBounds(b))),q=a.getViewportPageBounds().center;a.updateShapes(o.map(a=>{let b={x:(a.x??0)-(p.x+p.w/2),y:(a.y??0)-(p.y+p.h/2)};return{id:a.id,type:a.type,x:q.x+b.x,y:q.y+b.y}})),a.setSelectedShapes(k)}let Ry=a=>{let b=a/100;return b<.2?.1:b<.4?.25:b<.6?.5:b<.8?.75:1},Rz={1:"s",2:"m",3:"l",4:"xl"},RA={16:"s",20:"m",28:"l",36:"xl"},RB={1:"draw",2:"sans",3:"mono"},RC={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function RD(a,b,c){return Object.fromEntries([0,1,2,3,4].map(b=>RC[a][b]).map((a,d)=>[a,d<3?b:c]))}let RE={...RD("gray","grey","black"),...RD("red","light-red","red"),...RD("pink","light-red","red"),...RD("grape","light-violet","violet"),...RD("blue","light-blue","blue"),...RD("cyan","light-blue","blue"),...RD("teal","light-green","green"),...RD("green","light-green","green"),...RD("yellow","yellow","orange"),...RD("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},RF={solid:"draw",dashed:"dashed",dotted:"dotted"},RG={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},RH={left:"start",center:"middle",right:"end"},RI={left:"start",center:"middle",right:"end"},RJ={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"},RK=a=>{let b=RF[a.strokeStyle]??"draw";return"draw"===b&&0===a.roughness&&(b="solid"),b},RL=a=>"transparent"===a.backgroundColor?"none":RG[a.fillStyle]??"solid";var RM=Object.defineProperty,RN=(a,b)=>{for(var c in b)RM(a,c,{get:b[c],enumerable:!0})};function RO(a){let{state:b,transaction:c}=a,{selection:d}=c,{doc:e}=c,{storedMarks:f}=c;return{...b,apply:b.apply.bind(b),applyTransaction:b.applyTransaction.bind(b),plugins:b.plugins,schema:b.schema,reconfigure:b.reconfigure.bind(b),toJSON:b.toJSON.bind(b),get storedMarks(){return f},get selection(){return d},get doc(){return e},get tr(){return d=c.selection,e=c.doc,f=c.storedMarks,c}}}var RP=class{constructor(a){this.editor=a.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=a.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:a,editor:b,state:c}=this,{view:d}=b,{tr:e}=c,f=this.buildProps(e);return Object.fromEntries(Object.entries(a).map(([a,b])=>[a,(...a)=>{let c=b(...a)(f);return e.getMeta("preventDispatch")||this.hasCustomState||d.dispatch(e),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g=[],h=!!a,i=a||e.tr,j=()=>(h||!b||i.getMeta("preventDispatch")||this.hasCustomState||f.dispatch(i),g.every(a=>!0===a)),k={...Object.fromEntries(Object.entries(c).map(([a,c])=>[a,(...a)=>{let d=this.buildProps(i,b),e=c(...a)(d);return g.push(e),k}])),run:j};return k}createCan(a){let{rawCommands:b,state:c}=this,d=a||c.tr,e=this.buildProps(d,!1);return{...Object.fromEntries(Object.entries(b).map(([a,b])=>[a,(...a)=>b(...a)({...e,dispatch:void 0})])),chain:()=>this.createChain(d,!1)}}buildProps(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g={tr:a,editor:d,view:f,state:RO({state:e,transaction:a}),dispatch:b?()=>void 0:void 0,chain:()=>this.createChain(a,b),can:()=>this.createCan(a),get commands(){return Object.fromEntries(Object.entries(c).map(([a,b])=>[a,(...a)=>b(...a)(g)]))}};return g}},RQ={};RN(RQ,{blur:()=>RR,clearContent:()=>RS,clearNodes:()=>RT,command:()=>RU,createParagraphNear:()=>RV,cut:()=>RW,deleteCurrentNode:()=>RX,deleteNode:()=>RZ,deleteRange:()=>R$,deleteSelection:()=>R_,enter:()=>R0,exitCode:()=>R1,extendMarkRange:()=>R8,first:()=>R9,focus:()=>Se,forEach:()=>Sf,insertContent:()=>Sg,insertContentAt:()=>Sj,joinBackward:()=>Sm,joinDown:()=>Sl,joinForward:()=>Sn,joinItemBackward:()=>So,joinItemForward:()=>Sp,joinTextblockBackward:()=>Sq,joinTextblockForward:()=>Sr,joinUp:()=>Sk,keyboardShortcut:()=>St,lift:()=>Sv,liftEmptyBlock:()=>Sw,liftListItem:()=>Sx,newlineInCode:()=>Sy,resetAttributes:()=>SB,scrollIntoView:()=>SC,selectAll:()=>SD,selectNodeBackward:()=>SE,selectNodeForward:()=>SF,selectParentNode:()=>SG,selectTextblockEnd:()=>SH,selectTextblockStart:()=>SI,setContent:()=>SK,setMark:()=>Tc,setMeta:()=>Td,setNode:()=>Te,setNodeSelection:()=>Tf,setTextDirection:()=>Tg,setTextSelection:()=>Th,sinkListItem:()=>Ti,splitBlock:()=>Tk,splitListItem:()=>Tl,toggleList:()=>To,toggleMark:()=>Tp,toggleNode:()=>Tq,toggleWrap:()=>Tr,undoInputRule:()=>Ts,unsetAllMarks:()=>Tt,unsetMark:()=>Tu,unsetTextDirection:()=>Tv,updateAttributes:()=>Tw,wrapIn:()=>Tx,wrapInList:()=>Ty});var RR=()=>({editor:a,view:b})=>(requestAnimationFrame(()=>{var c;a.isDestroyed||(b.dom.blur(),null==(c=null==window?void 0:window.getSelection())||c.removeAllRanges())}),!0),RS=(a=!0)=>({commands:b})=>b.setContent("",{emitUpdate:a}),RT=()=>({state:a,tr:b,dispatch:c})=>{let{selection:d}=b,{ranges:e}=d;return!c||(e.forEach(({$from:c,$to:d})=>{a.doc.nodesBetween(c.pos,d.pos,(a,c)=>{if(a.type.isText)return;let{doc:d,mapping:e}=b,f=d.resolve(e.map(c)),g=d.resolve(e.map(c+a.nodeSize)),h=f.blockRange(g);if(!h)return;let i=tK(h);if(a.type.isTextblock){let{defaultType:a}=f.parent.contentMatchAt(f.index());b.setNodeMarkup(h.start,a)}(i||0===i)&&b.lift(h,i)})}),!0)},RU=a=>b=>a(b),RV=()=>({state:a,dispatch:b})=>xp(a,b),RW=(a,b)=>({editor:c,tr:d})=>{let{state:e}=c,f=e.doc.slice(a.from,a.to);d.deleteRange(a.from,a.to);let g=d.mapping.map(b);return d.insert(g,f.content),d.setSelection(new t9(d.doc.resolve(Math.max(g-1,0)))),!0},RX=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,d=c.$anchor.node();if(d.content.size>0)return!1;let e=a.selection.$anchor;for(let c=e.depth;c>0;c-=1)if(e.node(c).type===d.type){if(b){let b=e.before(c),d=e.after(c);a.delete(b,d).scrollIntoView()}return!0}return!1};function RY(a,b){if("string"==typeof a){if(!b.nodes[a])throw Error(`There is no node type named '${a}'. Maybe you forgot to add the extension?`);return b.nodes[a]}return a}var RZ=a=>({tr:b,state:c,dispatch:d})=>{let e=RY(a,c.schema),f=b.selection.$anchor;for(let a=f.depth;a>0;a-=1)if(f.node(a).type===e){if(d){let c=f.before(a),d=f.after(a);b.delete(c,d).scrollIntoView()}return!0}return!1},R$=a=>({tr:b,dispatch:c})=>{let{from:d,to:e}=a;return c&&b.delete(d,e),!0},R_=()=>({state:a,dispatch:b})=>w6(a,b),R0=()=>({commands:a})=>a.keyboardShortcut("Enter"),R1=()=>({state:a,dispatch:b})=>xo(a,b);function R2(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function R3(a,b,c={strict:!0}){let d=Object.keys(b);return!d.length||d.every(d=>c.strict?b[d]===a[d]:R2(b[d])?b[d].test(a[d]):b[d]===a[d])}function R4(a,b,c={}){return a.find(a=>a.type===b&&R3(Object.fromEntries(Object.keys(c).map(b=>[b,a.attrs[b]])),c))}function R5(a,b,c={}){return!!R4(a,b,c)}function R6(a,b,c){var d;if(!a||!b)return;let e=a.parent.childAfter(a.parentOffset);if(e.node&&e.node.marks.some(a=>a.type===b)||(e=a.parent.childBefore(a.parentOffset)),!e.node||!e.node.marks.some(a=>a.type===b)||(c=c||(null==(d=e.node.marks[0])?void 0:d.attrs),!R4([...e.node.marks],b,c)))return;let f=e.index,g=a.start()+e.offset,h=f+1,i=g+e.node.nodeSize;for(;f>0&&R5([...a.parent.child(f-1).marks],b,c);)f-=1,g-=a.parent.child(f).nodeSize;for(;h<a.parent.childCount&&R5([...a.parent.child(h).marks],b,c);)i+=a.parent.child(h).nodeSize,h+=1;return{from:g,to:i}}function R7(a,b){if("string"==typeof a){if(!b.marks[a])throw Error(`There is no mark type named '${a}'. Maybe you forgot to add the extension?`);return b.marks[a]}return a}var R8=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=R7(a,d.schema),{doc:g,selection:h}=c,{$from:i,from:j,to:k}=h;if(e){let a=R6(i,f,b);if(a&&a.from<=j&&a.to>=k){let b=t9.create(g,a.from,a.to);c.setSelection(b)}}return!0},R9=a=>b=>{let c="function"==typeof a?a(b):a;for(let a=0;a<c.length;a+=1)if(c[a](b))return!0;return!1};function Sa(a){return a instanceof t9}function Sb(a=0,b=0,c=0){return Math.min(Math.max(a,b),c)}function Sc(a,b=null){if(!b)return null;let c=t5.atStart(a),d=t5.atEnd(a);if("start"===b||!0===b)return c;if("end"===b)return d;let e=c.from,f=d.to;return"all"===b?t9.create(a,Sb(0,e,f),Sb(a.content.size,e,f)):t9.create(a,Sb(b,e,f),Sb(b,e,f))}function Sd(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Se=(a=null,b={})=>({editor:c,view:d,tr:e,dispatch:f})=>{b={scrollIntoView:!0,...b};let g=()=>{(Sd()||"Android"===navigator.platform||/android/i.test(navigator.userAgent))&&d.dom.focus(),requestAnimationFrame(()=>{!c.isDestroyed&&(d.focus(),(null==b?void 0:b.scrollIntoView)&&c.commands.scrollIntoView())})};if(d.hasFocus()&&null===a||!1===a)return!0;if(f&&null===a&&!Sa(c.state.selection))return g(),!0;let h=Sc(e.doc,a)||c.state.selection,i=c.state.selection.eq(h);return f&&(i||e.setSelection(h),i&&e.storedMarks&&e.setStoredMarks(e.storedMarks),g()),!0},Sf=(a,b)=>c=>a.every((a,d)=>b(a,{...c,index:d})),Sg=(a,b)=>({tr:c,commands:d})=>d.insertContentAt({from:c.selection.from,to:c.selection.to},a,b);function Sh(a){throw Error("[tiptap error]: there is no window object available, so this function cannot be used")}function Si(a,b,c){if(a instanceof s0||a instanceof sJ)return a;c={slice:!0,parseOptions:{},...c};let d="object"==typeof a&&null!==a,e="string"==typeof a;if(d)try{if(Array.isArray(a)&&a.length>0)return sJ.fromArray(a.map(a=>b.nodeFromJSON(a)));let d=b.nodeFromJSON(a);return c.errorOnInvalidContent&&d.check(),d}catch(d){if(c.errorOnInvalidContent)throw Error("[tiptap error]: Invalid JSON content",{cause:d});return console.warn("[tiptap warn]: Invalid content.","Passed value:",a,"Error:",d),Si("",b,c)}if(e){if(c.errorOnInvalidContent){let d=!1,e="",f=new tf({topNode:b.spec.topNode,marks:b.spec.marks,nodes:b.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:a=>(d=!0,e="string"==typeof a?a:a.outerHTML,null)}]}})});if(c.slice?th.fromSchema(f).parseSlice(Sh(a),c.parseOptions):th.fromSchema(f).parse(Sh(a),c.parseOptions),c.errorOnInvalidContent&&d)throw Error("[tiptap error]: Invalid HTML content",{cause:Error(`Invalid element found: ${e}`)})}let d=th.fromSchema(b);return c.slice?d.parseSlice(Sh(a),c.parseOptions).content:d.parse(Sh(a),c.parseOptions)}return Si("",b,c)}var Sj=(a,b,c)=>({tr:d,dispatch:e,editor:f})=>{var g;if(e){let e,h;c={parseOptions:f.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...c};let i=a=>{f.emit("contentError",{editor:f,error:a,disableCollaboration:()=>{"collaboration"in f.storage&&"object"==typeof f.storage.collaboration&&f.storage.collaboration&&(f.storage.collaboration.isDisabled=!0)}})},j={preserveWhitespace:"full",...c.parseOptions};if(!c.errorOnInvalidContent&&!f.options.enableContentCheck&&f.options.emitContentError)try{Si(b,f.schema,{parseOptions:j,errorOnInvalidContent:!0})}catch(a){i(a)}try{e=Si(b,f.schema,{parseOptions:j,errorOnInvalidContent:null!=(g=c.errorOnInvalidContent)?g:f.options.enableContentCheck})}catch(a){return i(a),!1}let{from:k,to:l}="number"==typeof a?{from:a,to:a}:{from:a.from,to:a.to},m=!0,n=!0;if((!("type"in e)?e:[e]).forEach(a=>{a.check(),m=!!m&&a.isText&&0===a.marks.length,n=!!n&&a.isBlock}),k===l&&n){let{parent:a}=d.doc.resolve(k);!a.isTextblock||a.type.spec.code||a.childCount||(k-=1,l+=1)}if(m){if(Array.isArray(b))h=b.map(a=>a.text||"").join("");else if(b instanceof sJ){let a="";b.forEach(b=>{b.text&&(a+=b.text)}),h=a}else h="object"==typeof b&&b&&b.text?b.text:b;d.insertText(h,k,l)}else{h=e;let a=d.doc.resolve(k),b=a.node(),c=0===a.parentOffset,f=b.isText||b.isTextblock,g=b.content.size>0;c&&f&&g&&(k=Math.max(0,k-1)),d.replaceWith(k,l,h)}c.updateSelection&&function(a,b,c){let d=a.steps.length-1;if(d<b)return;let e=a.steps[d];if(!(e instanceof tG||e instanceof tH))return;let f=a.mapping.maps[d],g=0;f.forEach((a,b,c,d)=>{0===g&&(g=d)}),a.setSelection(t5.near(a.doc.resolve(g),-1))}(d,d.steps.length-1,0),c.applyInputRules&&d.setMeta("applyInputRules",{from:k,text:h}),c.applyPasteRules&&d.setMeta("applyPasteRules",{from:k,text:h})}return!0},Sk=()=>({state:a,dispatch:b})=>xj(a,b),Sl=()=>({state:a,dispatch:b})=>xk(a,b),Sm=()=>({state:a,dispatch:b})=>w8(a,b),Sn=()=>({state:a,dispatch:b})=>xg(a,b),So=()=>({state:a,dispatch:b,tr:c})=>{try{let d=tS(a.doc,a.selection.$from.pos,-1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},Sp=()=>({state:a,dispatch:b,tr:c})=>{try{let d=tS(a.doc,a.selection.$from.pos,1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},Sq=()=>({state:a,dispatch:b})=>w9(a,b),Sr=()=>({state:a,dispatch:b})=>xa(a,b);function Ss(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var St=a=>({editor:b,view:c,tr:d,dispatch:e})=>{let f=(function(a){let b,c,d,e,f=a.split(/-(?!$)/),g=f[f.length-1];"Space"===g&&(g=" ");for(let a=0;a<f.length-1;a+=1){let g=f[a];if(/^(cmd|meta|m)$/i.test(g))e=!0;else if(/^a(lt)?$/i.test(g))b=!0;else if(/^(c|ctrl|control)$/i.test(g))c=!0;else if(/^s(hift)?$/i.test(g))d=!0;else if(/^mod$/i.test(g))Sd()||Ss()?e=!0:c=!0;else throw Error(`Unrecognized modifier name: ${g}`)}return b&&(g=`Alt-${g}`),c&&(g=`Ctrl-${g}`),e&&(g=`Meta-${g}`),d&&(g=`Shift-${g}`),g})(a).split(/-(?!$)/),g=f.find(a=>!["Alt","Ctrl","Meta","Shift"].includes(a)),h=new KeyboardEvent("keydown",{key:"Space"===g?" ":g,altKey:f.includes("Alt"),ctrlKey:f.includes("Ctrl"),metaKey:f.includes("Meta"),shiftKey:f.includes("Shift"),bubbles:!0,cancelable:!0}),i=b.captureTransaction(()=>{c.someProp("handleKeyDown",a=>a(c,h))});return null==i||i.steps.forEach(a=>{let b=a.map(d.mapping);b&&e&&d.maybeStep(b)}),!0};function Su(a,b,c={}){let{from:d,to:e,empty:f}=a.selection,g=b?RY(b,a.schema):null,h=[];a.doc.nodesBetween(d,e,(a,b)=>{if(a.isText)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);h.push({node:a,from:c,to:f})});let i=e-d,j=h.filter(a=>!g||g.name===a.node.type.name).filter(a=>R3(a.node.attrs,c,{strict:!1}));return f?!!j.length:j.reduce((a,b)=>a+b.to-b.from,0)>=i}var Sv=(a,b={})=>({state:c,dispatch:d})=>{let e=RY(a,c.schema);return!!Su(c,e,b)&&xl(c,d)},Sw=()=>({state:a,dispatch:b})=>xq(a,b),Sx=a=>({state:b,dispatch:c})=>xE(RY(a,b.schema))(b,c),Sy=()=>({state:a,dispatch:b})=>xm(a,b);function Sz(a,b){return b.nodes[a]?"node":b.marks[a]?"mark":null}function SA(a,b){let c="string"==typeof b?[b]:b;return Object.keys(a).reduce((b,d)=>(c.includes(d)||(b[d]=a[d]),b),{})}var SB=(a,b)=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=Sz("string"==typeof a?a:a.name,d.schema);if(!h)return!1;"node"===h&&(f=RY(a,d.schema)),"mark"===h&&(g=R7(a,d.schema));let i=!1;return c.selection.ranges.forEach(a=>{d.doc.nodesBetween(a.$from.pos,a.$to.pos,(a,d)=>{f&&f===a.type&&(i=!0,e&&c.setNodeMarkup(d,void 0,SA(a.attrs,b))),g&&a.marks.length&&a.marks.forEach(f=>{g===f.type&&(i=!0,e&&c.addMark(d,d+a.nodeSize,g.create(SA(f.attrs,b))))})})}),i},SC=()=>({tr:a,dispatch:b})=>(b&&a.scrollIntoView(),!0),SD=()=>({tr:a,dispatch:b})=>{if(b){let b=new ud(a.doc);a.setSelection(b)}return!0},SE=()=>({state:a,dispatch:b})=>xd(a,b),SF=()=>({state:a,dispatch:b})=>xh(a,b),SG=()=>({state:a,dispatch:b})=>xr(a,b),SH=()=>({state:a,dispatch:b})=>xv(a,b),SI=()=>({state:a,dispatch:b})=>xu(a,b);function SJ(a,b,c={},d={}){return Si(a,b,{slice:!1,parseOptions:c,errorOnInvalidContent:d.errorOnInvalidContent})}var SK=(a,{errorOnInvalidContent:b,emitUpdate:c=!0,parseOptions:d={}}={})=>({editor:e,tr:f,dispatch:g,commands:h})=>{let{doc:i}=f;if("full"!==d.preserveWhitespace){let h=SJ(a,e.schema,d,{errorOnInvalidContent:null!=b?b:e.options.enableContentCheck});return g&&f.replaceWith(0,i.content.size,h).setMeta("preventUpdate",!c),!0}return g&&f.setMeta("preventUpdate",!c),h.insertContentAt({from:0,to:i.content.size},a,{parseOptions:d,errorOnInvalidContent:null!=b?b:e.options.enableContentCheck})};function SL(a,b){let c=R7(b,a.schema),{from:d,to:e,empty:f}=a.selection,g=[];f?(a.storedMarks&&g.push(...a.storedMarks),g.push(...a.selection.$head.marks())):a.doc.nodesBetween(d,e,a=>{g.push(...a.marks)});let h=g.find(a=>a.type.name===c.name);return h?{...h.attrs}:{}}function SM(a,b){let c=new t3(a);return b.forEach(a=>{a.steps.forEach(a=>{c.step(a)})}),c}function SN(a){return b=>(function(a,b){for(let c=a.depth;c>0;c-=1){let d=a.node(c);if(b(d))return{pos:c>0?a.before(c):0,start:a.start(c),depth:c,node:d}}})(b.$from,a)}function SO(a,b,c){return void 0===a.config[b]&&a.parent?SO(a.parent,b,c):"function"==typeof a.config[b]?a.config[b].bind({...c,parent:a.parent?SO(a.parent,b,c):null}):a.config[b]}function SP(a){return a.map(a=>{let b={name:a.name,options:a.options,storage:a.storage},c=SO(a,"addExtensions",b);return c?[a,...SP(c())]:a}).flat(10)}function SQ(a,b){let c=tq.fromSchema(b).serializeFragment(a),d=document.implementation.createHTMLDocument().createElement("div");return d.appendChild(c),d.innerHTML}function SR(a){return"function"==typeof a}function SS(a,b,...c){return SR(a)?b?a.bind(b)(...c):a(...c):a}function ST(a){let b=a.filter(a=>"extension"===a.type);return{baseExtensions:b,nodeExtensions:a.filter(a=>"node"===a.type),markExtensions:a.filter(a=>"mark"===a.type)}}function SU(a){let b=[],{nodeExtensions:c,markExtensions:d}=ST(a),e=[...c,...d],f={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return a.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage,extensions:e},d=SO(a,"addGlobalAttributes",c);d&&d().forEach(a=>{a.types.forEach(c=>{Object.entries(a.attributes).forEach(([a,d])=>{b.push({type:c,name:a,attribute:{...f,...d}})})})})}),e.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage},d=SO(a,"addAttributes",c);d&&Object.entries(d()).forEach(([c,d])=>{let e={...f,...d};"function"==typeof(null==e?void 0:e.default)&&(e.default=e.default()),(null==e?void 0:e.isRequired)&&(null==e?void 0:e.default)===void 0&&delete e.default,b.push({type:a.name,name:c,attribute:e})})}),b}function SV(...a){return a.filter(a=>!!a).reduce((a,b)=>{let c={...a};return Object.entries(b).forEach(([a,b])=>{if(!c[a]){c[a]=b;return}if("class"===a){let d=b?String(b).split(" "):[],e=c[a]?c[a].split(" "):[],f=d.filter(a=>!e.includes(a));c[a]=[...e,...f].join(" ")}else if("style"===a){let d=b?b.split(";").map(a=>a.trim()).filter(Boolean):[],e=c[a]?c[a].split(";").map(a=>a.trim()).filter(Boolean):[],f=new Map;e.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),d.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),c[a]=Array.from(f.entries()).map(([a,b])=>`${a}: ${b}`).join("; ")}else c[a]=b}),c},{})}function SW(a,b){return b.filter(b=>b.type===a.type.name).filter(a=>a.attribute.rendered).map(b=>b.attribute.renderHTML?b.attribute.renderHTML(a.attrs)||{}:{[b.name]:a.attrs[b.name]}).reduce((a,b)=>SV(a,b),{})}function SX(a,b){return"style"in a?a:{...a,getAttrs:c=>{let d=a.getAttrs?a.getAttrs(c):a.attrs;if(!1===d)return!1;let e=b.reduce((a,b)=>{var d;let e=b.attribute.parseHTML?b.attribute.parseHTML(c):"string"!=typeof(d=c.getAttribute(b.name))?d:d.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(d):"true"===d||"false"!==d&&d;return null==e?a:{...a,[b.name]:e}},{});return{...d,...e}}}}function SY(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>!("attrs"===a&&function(a={}){return 0===Object.keys(a).length&&a.constructor===Object}(b))&&null!=b))}function SZ(a){var b,c;let d={};return!(null==(b=null==a?void 0:a.attribute)?void 0:b.isRequired)&&"default"in((null==a?void 0:a.attribute)||{})&&(d.default=a.attribute.default),(null==(c=null==a?void 0:a.attribute)?void 0:c.validate)!==void 0&&(d.validate=a.attribute.validate),[a.name,d]}function S$(a){return a.sort((a,b)=>{let c=SO(a,"priority")||100,d=SO(b,"priority")||100;return c>d?-1:+(c<d)})}function S_(a){var b;let c=S$(SP(a)),d=Array.from(new Set((b=c.map(a=>a.name)).filter((a,c)=>b.indexOf(a)!==c)));return d.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${d.map(a=>`'${a}'`).join(", ")}]. This can lead to issues.`),c}function S0(a,b,c){let{from:d,to:e}=b,{blockSeparator:f="\n\n",textSerializers:g={}}=c||{},h="";return a.nodesBetween(d,e,(a,c,i,j)=>{var k;a.isBlock&&c>d&&(h+=f);let l=null==g?void 0:g[a.type.name];if(l)return i&&(h+=l({node:a,pos:c,parent:i,index:j,range:b})),!1;a.isText&&(h+=null==(k=null==a?void 0:a.text)?void 0:k.slice(Math.max(d,c)-c,e-c))}),h}function S1(a){return Object.fromEntries(Object.entries(a.nodes).filter(([,a])=>a.spec.toText).map(([a,b])=>[a,b.spec.toText]))}function S2(a,b){let c=Sz("string"==typeof b?b:b.name,a.schema);return"node"===c?function(a,b){let c=RY(b,a.schema),{from:d,to:e}=a.selection,f=[];a.doc.nodesBetween(d,e,a=>{f.push(a)});let g=f.reverse().find(a=>a.type.name===c.name);return g?{...g.attrs}:{}}(a,b):"mark"===c?SL(a,b):{}}function S3(a){let b,{mapping:c,steps:d}=a,e=[];return c.maps.forEach((a,b)=>{let f=[];if(a.ranges.length)a.forEach((a,b)=>{f.push({from:a,to:b})});else{let{from:a,to:c}=d[b];if(void 0===a||void 0===c)return;f.push({from:a,to:c})}f.forEach(({from:a,to:d})=>{let f=c.slice(b).map(a,-1),g=c.slice(b).map(d),h=c.invert().map(f,-1),i=c.invert().map(g);e.push({oldRange:{from:h,to:i},newRange:{from:f,to:g}})})}),1===(b=function(a,b=JSON.stringify){let c={};return a.filter(a=>{let d=b(a);return!Object.prototype.hasOwnProperty.call(c,d)&&(c[d]=!0)})}(e)).length?b:b.filter((a,c)=>!b.filter((a,b)=>b!==c).some(b=>a.oldRange.from>=b.oldRange.from&&a.oldRange.to<=b.oldRange.to&&a.newRange.from>=b.newRange.from&&a.newRange.to<=b.newRange.to))}function S4(a,b,c){let d=[];return a===b?c.resolve(a).marks().forEach(b=>{let e=R6(c.resolve(a),b.type);e&&d.push({mark:b,...e})}):c.nodesBetween(a,b,(a,b)=>{a&&(null==a?void 0:a.nodeSize)!==void 0&&d.push(...a.marks.map(c=>({from:b,to:b+a.nodeSize,mark:c})))}),d}function S5(a,b){return b.nodes[a]||b.marks[a]||null}function S6(a,b,c){return Object.fromEntries(Object.entries(c).filter(([c])=>{let d=a.find(a=>a.type===b&&a.name===c);return!!d&&d.attribute.keepOnSplit}))}function S7(a,b,c={}){let{empty:d,ranges:e}=a.selection,f=b?R7(b,a.schema):null;if(d)return!!(a.storedMarks||a.selection.$from.marks()).filter(a=>!f||f.name===a.type.name).find(a=>R3(a.attrs,c,{strict:!1}));let g=0,h=[];if(e.forEach(({$from:b,$to:c})=>{let d=b.pos,e=c.pos;a.doc.nodesBetween(d,e,(a,b)=>{if(!a.isText&&!a.marks.length)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);g+=f-c,h.push(...a.marks.map(a=>({mark:a,from:c,to:f})))})}),0===g)return!1;let i=h.filter(a=>!f||f.name===a.mark.type.name).filter(a=>R3(a.mark.attrs,c,{strict:!1})).reduce((a,b)=>a+b.to-b.from,0),j=h.filter(a=>!f||a.mark.type!==f&&a.mark.type.excludes(f)).reduce((a,b)=>a+b.to-b.from,0);return(i>0?i+j:i)>=g}function S8(a,b){return Array.isArray(b)?b.some(b=>("string"==typeof b?b:b.name)===a.name):b}function S9(a,b){let{nodeExtensions:c}=ST(b),d=c.find(b=>b.name===a);if(!d)return!1;let e={name:d.name,options:d.options,storage:d.storage},f=SS(SO(d,"group",e));return"string"==typeof f&&f.split(" ").includes("list")}function Ta(a,{checkChildren:b=!0,ignoreWhitespace:c=!1}={}){var d;if(c){if("hardBreak"===a.type.name)return!0;if(a.isText)return/^\s*$/m.test(null!=(d=a.text)?d:"")}if(a.isText)return!a.text;if(a.isAtom||a.isLeaf)return!1;if(0===a.content.childCount)return!0;if(b){let d=!0;return a.content.forEach(a=>{!1!==d&&(Ta(a,{ignoreWhitespace:c,checkChildren:b})||(d=!1))}),d}return!1}function Tb(a){return a instanceof ub}var Tc=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let{selection:f}=c,{empty:g,ranges:h}=f,i=R7(a,d.schema);if(e)if(g){let a=SL(d,i);c.addStoredMark(i.create({...a,...b}))}else h.forEach(a=>{let e=a.$from.pos,f=a.$to.pos;d.doc.nodesBetween(e,f,(a,d)=>{let g=Math.max(d,e),h=Math.min(d+a.nodeSize,f);a.marks.find(a=>a.type===i)?a.marks.forEach(a=>{i===a.type&&c.addMark(g,h,i.create({...a.attrs,...b}))}):c.addMark(g,h,i.create(b))})});return function(a,b,c){var d;let{selection:e}=b,f=null;if(Sa(e)&&(f=e.$cursor),f){let b=null!=(d=a.storedMarks)?d:f.marks();return f.parent.type.allowsMarkType(c)&&(!!c.isInSet(b)||!b.some(a=>a.type.excludes(c)))}let{ranges:g}=e;return g.some(({$from:b,$to:d})=>{let e=0===b.depth&&a.doc.inlineContent&&a.doc.type.allowsMarkType(c);return a.doc.nodesBetween(b.pos,d.pos,(a,b,d)=>{if(e)return!1;if(a.isInline){let b=!d||d.type.allowsMarkType(c),f=!!c.isInSet(a.marks)||!a.marks.some(a=>a.type.excludes(c));e=b&&f}return!e}),e})}(d,c,i)},Td=(a,b)=>({tr:c})=>(c.setMeta(a,b),!0),Te=(a,b={})=>({state:c,dispatch:d,chain:e})=>{let f,g=RY(a,c.schema);return(c.selection.$anchor.sameParent(c.selection.$head)&&(f=c.selection.$anchor.parent.attrs),g.isTextblock)?e().command(({commands:a})=>!!xx(g,{...f,...b})(c)||a.clearNodes()).command(({state:a})=>xx(g,{...f,...b})(a,d)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Tf=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,d=Sb(a,0,c.content.size),e=ub.create(c,d);b.setSelection(e)}return!0},Tg=(a,b)=>({tr:c,state:d,dispatch:e})=>{let f,g,{selection:h}=d;return"number"==typeof b?(f=b,g=b):b&&"from"in b&&"to"in b?(f=b.from,g=b.to):(f=h.from,g=h.to),e&&c.doc.nodesBetween(f,g,(b,d)=>{b.isText||c.setNodeMarkup(d,void 0,{...b.attrs,dir:a})}),!0},Th=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,{from:d,to:e}="number"==typeof a?{from:a,to:a}:a,f=t9.atStart(c).from,g=t9.atEnd(c).to,h=Sb(d,f,g),i=Sb(e,f,g),j=t9.create(c,h,i);b.setSelection(j)}return!0},Ti=a=>({state:b,dispatch:c})=>xF(RY(a,b.schema))(b,c);function Tj(a,b){let c=a.storedMarks||a.selection.$to.parentOffset&&a.selection.$from.marks();if(c){let d=c.filter(a=>null==b?void 0:b.includes(a.type.name));a.tr.ensureMarks(d)}}var Tk=({keepMarks:a=!0}={})=>({tr:b,state:c,dispatch:d,editor:e})=>{let{selection:f,doc:g}=b,{$from:h,$to:i}=f,j=S6(e.extensionManager.attributes,h.node().type.name,h.node().attrs);if(f instanceof ub&&f.node.isBlock)return!!h.parentOffset&&!!tP(g,h.pos)&&(d&&(a&&Tj(c,e.extensionManager.splittableMarks),b.split(h.pos).scrollIntoView()),!0);if(!h.parent.isBlock)return!1;let k=i.parentOffset===i.parent.content.size,l=0===h.depth?void 0:function(a){for(let b=0;b<a.edgeCount;b+=1){let{type:c}=a.edge(b);if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}(h.node(-1).contentMatchAt(h.indexAfter(-1))),m=k&&l?[{type:l,attrs:j}]:void 0,n=tP(b.doc,b.mapping.map(h.pos),1,m);if(!m&&!n&&tP(b.doc,b.mapping.map(h.pos),1,l?[{type:l}]:void 0)&&(n=!0,m=l?[{type:l,attrs:j}]:void 0),d){if(n&&(f instanceof t9&&b.deleteSelection(),b.split(b.mapping.map(h.pos),1,m),l&&!k&&!h.parentOffset&&h.parent.type!==l)){let a=b.mapping.map(h.before()),c=b.doc.resolve(a);h.node(-1).canReplaceWith(c.index(),c.index()+1,l)&&b.setNodeMarkup(b.mapping.map(h.before()),l)}a&&Tj(c,e.extensionManager.splittableMarks),b.scrollIntoView()}return n},Tl=(a,b={})=>({tr:c,state:d,dispatch:e,editor:f})=>{var g;let h=RY(a,d.schema),{$from:i,$to:j}=d.selection,k=d.selection.node;if(k&&k.isBlock||i.depth<2||!i.sameParent(j))return!1;let l=i.node(-1);if(l.type!==h)return!1;let m=f.extensionManager.attributes;if(0===i.parent.content.size&&i.node(-1).childCount===i.indexAfter(-1)){if(2===i.depth||i.node(-3).type!==h||i.index(-2)!==i.node(-2).childCount-1)return!1;if(e){let a=sJ.empty,d=i.index(-1)?1:i.index(-2)?2:3;for(let b=i.depth-d;b>=i.depth-3;b-=1)a=sJ.from(i.node(b).copy(a));let e=i.indexAfter(-1)<i.node(-2).childCount?1:i.indexAfter(-2)<i.node(-3).childCount?2:3,f={...S6(m,i.node().type.name,i.node().attrs),...b},j=(null==(g=h.contentMatch.defaultType)?void 0:g.createAndFill(f))||void 0;a=a.append(sJ.from(h.createAndFill(null,j)||void 0));let k=i.before(i.depth-(d-1));c.replace(k,i.after(-e),new sP(a,4-d,0));let l=-1;c.doc.nodesBetween(k,c.doc.content.size,(a,b)=>{if(l>-1)return!1;a.isTextblock&&0===a.content.size&&(l=b+1)}),l>-1&&c.setSelection(t9.near(c.doc.resolve(l))),c.scrollIntoView()}return!0}let n=j.pos===i.end()?l.contentMatchAt(0).defaultType:null,o={...S6(m,l.type.name,l.attrs),...b},p={...S6(m,i.node().type.name,i.node().attrs),...b};c.delete(i.pos,j.pos);let q=n?[{type:h,attrs:o},{type:n,attrs:p}]:[{type:h,attrs:o}];if(!tP(c.doc,i.pos,2))return!1;if(e){let{selection:a,storedMarks:b}=d,{splittableMarks:g}=f.extensionManager,h=b||a.$to.parentOffset&&a.$from.marks();if(c.split(i.pos,2,q).scrollIntoView(),!h||!e)return!0;let j=h.filter(a=>g.includes(a.type.name));c.ensureMarks(j)}return!0},Tm=(a,b)=>{let c=SN(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(Math.max(0,c.pos-1)).before(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&tQ(a.doc,c.pos))||(a.join(c.pos),!0)},Tn=(a,b)=>{let c=SN(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(c.start).after(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&tQ(a.doc,d))||(a.join(d),!0)},To=(a,b,c,d={})=>({editor:e,tr:f,state:g,dispatch:h,chain:i,commands:j,can:k})=>{let{extensions:l,splittableMarks:m}=e.extensionManager,n=RY(a,g.schema),o=RY(b,g.schema),{selection:p,storedMarks:q}=g,{$from:r,$to:s}=p,t=r.blockRange(s),u=q||p.$to.parentOffset&&p.$from.marks();if(!t)return!1;let v=SN(a=>S9(a.type.name,l))(p);if(t.depth>=1&&v&&t.depth-v.depth<=1){if(v.node.type===n)return j.liftListItem(o);if(S9(v.node.type.name,l)&&n.validContent(v.node.content)&&h)return i().command(()=>(f.setNodeMarkup(v.pos,n),!0)).command(()=>Tm(f,n)).command(()=>Tn(f,n)).run()}return c&&u&&h?i().command(()=>{let a=k().wrapInList(n,d),b=u.filter(a=>m.includes(a.type.name));return f.ensureMarks(b),!!a||j.clearNodes()}).wrapInList(n,d).command(()=>Tm(f,n)).command(()=>Tn(f,n)).run():i().command(()=>!!k().wrapInList(n,d)||j.clearNodes()).wrapInList(n,d).command(()=>Tm(f,n)).command(()=>Tn(f,n)).run()},Tp=(a,b={},c={})=>({state:d,commands:e})=>{let{extendEmptyMarkRange:f=!1}=c,g=R7(a,d.schema);return S7(d,g,b)?e.unsetMark(g,{extendEmptyMarkRange:f}):e.setMark(g,b)},Tq=(a,b,c={})=>({state:d,commands:e})=>{let f,g=RY(a,d.schema),h=RY(b,d.schema),i=Su(d,g,c);return(d.selection.$anchor.sameParent(d.selection.$head)&&(f=d.selection.$anchor.parent.attrs),i)?e.setNode(h,f):e.setNode(g,{...f,...c})},Tr=(a,b={})=>({state:c,commands:d})=>{let e=RY(a,c.schema);return Su(c,e,b)?d.lift(e):d.wrapIn(e,b)},Ts=()=>({state:a,dispatch:b})=>{let c=a.plugins;for(let d=0;d<c.length;d+=1){let e,f=c[d];if(f.spec.isInputRules&&(e=f.getState(a))){if(b){let b=a.tr,c=e.transform;for(let a=c.steps.length-1;a>=0;a-=1)b.step(c.steps[a].invert(c.docs[a]));if(e.text){let c=b.doc.resolve(e.from).marks();b.replaceWith(e.from,e.to,a.schema.text(e.text,c))}else b.delete(e.from,e.to)}return!0}}return!1},Tt=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,{empty:d,ranges:e}=c;return!!d||(b&&e.forEach(b=>{a.removeMark(b.$from.pos,b.$to.pos)}),!0)},Tu=(a,b={})=>({tr:c,state:d,dispatch:e})=>{var f;let{extendEmptyMarkRange:g=!1}=b,{selection:h}=c,i=R7(a,d.schema),{$from:j,empty:k,ranges:l}=h;if(!e)return!0;if(k&&g){let{from:a,to:b}=h,d=null==(f=j.marks().find(a=>a.type===i))?void 0:f.attrs,e=R6(j,i,d);e&&(a=e.from,b=e.to),c.removeMark(a,b,i)}else l.forEach(a=>{c.removeMark(a.$from.pos,a.$to.pos,i)});return c.removeStoredMark(i),!0},Tv=a=>({tr:b,state:c,dispatch:d})=>{let e,f,{selection:g}=c;return"number"==typeof a?(e=a,f=a):a&&"from"in a&&"to"in a?(e=a.from,f=a.to):(e=g.from,f=g.to),d&&b.doc.nodesBetween(e,f,(a,c)=>{if(a.isText)return;let d={...a.attrs};delete d.dir,b.setNodeMarkup(c,void 0,d)}),!0},Tw=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=Sz("string"==typeof a?a:a.name,d.schema);if(!h)return!1;"node"===h&&(f=RY(a,d.schema)),"mark"===h&&(g=R7(a,d.schema));let i=!1;return c.selection.ranges.forEach(a=>{let h,j,k,l,m=a.$from.pos,n=a.$to.pos;c.selection.empty?d.doc.nodesBetween(m,n,(a,b)=>{f&&f===a.type&&(i=!0,k=Math.max(b,m),l=Math.min(b+a.nodeSize,n),h=b,j=a)}):d.doc.nodesBetween(m,n,(a,d)=>{d<m&&f&&f===a.type&&(i=!0,k=Math.max(d,m),l=Math.min(d+a.nodeSize,n),h=d,j=a),d>=m&&d<=n&&(f&&f===a.type&&(i=!0,e&&c.setNodeMarkup(d,void 0,{...a.attrs,...b})),g&&a.marks.length&&a.marks.forEach(f=>{if(g===f.type&&(i=!0,e)){let e=Math.max(d,m),h=Math.min(d+a.nodeSize,n);c.addMark(e,h,g.create({...f.attrs,...b}))}}))}),j&&(void 0!==h&&e&&c.setNodeMarkup(h,void 0,{...j.attrs,...b}),g&&j.marks.length&&j.marks.forEach(a=>{g===a.type&&e&&c.addMark(k,l,g.create({...a.attrs,...b}))}))}),i},Tx=(a,b={})=>({state:c,dispatch:d})=>xw(RY(a,c.schema),b)(c,d),Ty=(a,b={})=>({state:c,dispatch:d})=>xD(RY(a,c.schema),b)(c,d),Tz=class{constructor(){this.callbacks={}}on(a,b){return this.callbacks[a]||(this.callbacks[a]=[]),this.callbacks[a].push(b),this}emit(a,...b){let c=this.callbacks[a];return c&&c.forEach(a=>a.apply(this,b)),this}off(a,b){let c=this.callbacks[a];return c&&(b?this.callbacks[a]=c.filter(a=>a!==b):delete this.callbacks[a]),this}once(a,b){let c=(...d)=>{this.off(a,c),b.apply(this,d)};return this.on(a,c)}removeAllListeners(){this.callbacks={}}},TA=class{constructor(a){var b;this.find=a.find,this.handler=a.handler,this.undoable=null==(b=a.undoable)||b}};function TB(a){var b;let{editor:c,from:d,to:e,text:f,rules:g,plugin:h}=a,{view:i}=c;if(i.composing)return!1;let j=i.state.doc.resolve(d);if(j.parent.type.spec.code||(null==(b=j.nodeBefore||j.nodeAfter)?void 0:b.marks.find(a=>a.type.spec.code)))return!1;let k=!1,l=((a,b=500)=>{let c="",d=a.parentOffset;return a.parent.nodesBetween(Math.max(0,d-b),d,(a,b,e,f)=>{var g,h;let i=(null==(h=(g=a.type.spec).toText)?void 0:h.call(g,{node:a,pos:b,parent:e,index:f}))||a.textContent||"%leaf%";c+=a.isAtom&&!a.isText?i:i.slice(0,Math.max(0,d-b))}),c})(j)+f;return g.forEach(a=>{if(k)return;let b=((a,b)=>{if(R2(b))return b.exec(a);let c=b(a);if(!c)return null;let d=[c.text];return d.index=c.index,d.input=a,d.data=c.data,c.replaceWith&&(c.text.includes(c.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),d.push(c.replaceWith)),d})(l,a.find);if(!b)return;let g=i.state.tr,j=RO({state:i.state,transaction:g}),m={from:d-(b[0].length-f.length),to:e},{commands:n,chain:o,can:p}=new RP({editor:c,state:j});null!==a.handler({state:j,range:m,match:b,commands:n,chain:o,can:p})&&g.steps.length&&(a.undoable&&g.setMeta(h,{transform:g,from:d,to:e,text:f}),i.dispatch(g),k=!0)}),k}function TC(a){return"Object"===Object.prototype.toString.call(a).slice(8,-1)&&a.constructor===Object&&Object.getPrototypeOf(a)===Object.prototype}var TD=class{constructor(a={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...a},this.name=this.config.name}get options(){return{...SS(SO(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...SS(SO(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(a={}){let b=this.extend({...this.config,addOptions:()=>(function a(b,c){let d={...b};return TC(b)&&TC(c)&&Object.keys(c).forEach(e=>{TC(c[e])&&TC(b[e])?d[e]=a(b[e],c[e]):d[e]=c[e]}),d})(this.options,a)});return b.name=this.name,b.parent=this.parent,b}extend(a={}){let b=new this.constructor({...this.config,...a});return b.parent=this,this.child=b,b.name="name"in a?a.name:b.parent.name,b}},TE=class a extends TD{constructor(){super(...arguments),this.type="mark"}static create(b={}){return new a("function"==typeof b?b():b)}static handleExit({editor:a,mark:b}){let{tr:c}=a.state,d=a.state.selection.$from;if(d.pos===d.end()){let e=d.marks();if(!e.find(a=>(null==a?void 0:a.type.name)===b.name))return!1;let f=e.find(a=>(null==a?void 0:a.type.name)===b.name);return f&&c.removeStoredMark(f),c.insertText(" ",d.pos),a.view.dispatch(c),!0}return!1}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},TF=class{constructor(a){this.find=a.find,this.handler=a.handler}},TG=null,TH=class{constructor(a,b){this.splittableMarks=[],this.editor=b,this.baseExtensions=a,this.extensions=S_(a),this.schema=function(a,b){var c;let d=SU(a),{nodeExtensions:e,markExtensions:f}=ST(a),g=null==(c=e.find(a=>SO(a,"topNode")))?void 0:c.name;return new tf({topNode:g,nodes:Object.fromEntries(e.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=SY({...a.reduce((a,b)=>{let d=SO(b,"extendNodeSchema",f);return{...a,...d?d(c):{}}},{}),content:SS(SO(c,"content",f)),marks:SS(SO(c,"marks",f)),group:SS(SO(c,"group",f)),inline:SS(SO(c,"inline",f)),atom:SS(SO(c,"atom",f)),selectable:SS(SO(c,"selectable",f)),draggable:SS(SO(c,"draggable",f)),code:SS(SO(c,"code",f)),whitespace:SS(SO(c,"whitespace",f)),linebreakReplacement:SS(SO(c,"linebreakReplacement",f)),defining:SS(SO(c,"defining",f)),isolating:SS(SO(c,"isolating",f)),attrs:Object.fromEntries(e.map(SZ))}),h=SS(SO(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>SX(a,e)));let i=SO(c,"renderHTML",f);i&&(g.toDOM=a=>i({node:a,HTMLAttributes:SW(a,e)}));let j=SO(c,"renderText",f);return j&&(g.toText=j),[c.name,g]})),marks:Object.fromEntries(f.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=SY({...a.reduce((a,b)=>{let d=SO(b,"extendMarkSchema",f);return{...a,...d?d(c):{}}},{}),inclusive:SS(SO(c,"inclusive",f)),excludes:SS(SO(c,"excludes",f)),group:SS(SO(c,"group",f)),spanning:SS(SO(c,"spanning",f)),code:SS(SO(c,"code",f)),attrs:Object.fromEntries(e.map(SZ))}),h=SS(SO(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>SX(a,e)));let i=SO(c,"renderHTML",f);return i&&(g.toDOM=a=>i({mark:a,HTMLAttributes:SW(a,e)})),[c.name,g]}))})}(this.extensions,b),this.setupExtensions()}get commands(){return this.extensions.reduce((a,b)=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:this.editor,type:S5(b.name,this.schema)},d=SO(b,"addCommands",c);return d?{...a,...d()}:a},{})}get plugins(){let{editor:a}=this;return S$([...this.extensions].reverse()).flatMap(b=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:S5(b.name,this.schema)},d=[],e=SO(b,"addKeyboardShortcuts",c),f={};if("mark"===b.type&&SO(b,"exitable",c)&&(f.ArrowRight=()=>TE.handleExit({editor:a,mark:b})),e){let b=Object.fromEntries(Object.entries(e()).map(([b,c])=>[b,()=>c({editor:a})]));f={...f,...b}}let g=w4(f);d.push(g);let h=SO(b,"addInputRules",c);if(S8(b,a.options.enableInputRules)&&h){let b=h();if(b&&b.length){let c=function(a){let{editor:b,rules:c}=a,d=new un({state:{init:()=>null,apply(a,e,f){let g=a.getMeta(d);if(g)return g;let h=a.getMeta("applyInputRules");return h&&setTimeout(()=>{let{text:a}=h;"string"==typeof a||(a=SQ(sJ.from(a),f.schema));let{from:e}=h,g=e+a.length;TB({editor:b,from:e,to:g,text:a,rules:c,plugin:d})}),a.selectionSet||a.docChanged?null:e}},props:{handleTextInput:(a,e,f,g)=>TB({editor:b,from:e,to:f,text:g,rules:c,plugin:d}),handleDOMEvents:{compositionend:a=>(setTimeout(()=>{let{$cursor:e}=a.state.selection;e&&TB({editor:b,from:e.pos,to:e.pos,text:"",rules:c,plugin:d})}),!1)},handleKeyDown(a,e){if("Enter"!==e.key)return!1;let{$cursor:f}=a.state.selection;return!!f&&TB({editor:b,from:f.pos,to:f.pos,text:"\n",rules:c,plugin:d})}},isInputRules:!0});return d}({editor:a,rules:b}),e=Array.isArray(c)?c:[c];d.push(...e)}}let i=SO(b,"addPasteRules",c);if(S8(b,a.options.enablePasteRules)&&i){let b=i();if(b&&b.length){let c=function(a){let b,{editor:c,rules:d}=a,e=null,f=!1,g=!1,h="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{b="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{b=null}let i=({state:a,from:d,to:e,rule:f,pasteEvt:g})=>{let i=a.tr;if(function(a){let{editor:b,state:c,from:d,to:e,rule:f,pasteEvent:g,dropEvent:h}=a,{commands:i,chain:j,can:k}=new RP({editor:b,state:c}),l=[];return c.doc.nodesBetween(d,e,(a,b)=>{var m,n,o,p,q;if((null==(n=null==(m=a.type)?void 0:m.spec)?void 0:n.code)||!(a.isText||a.isTextblock||a.isInline))return;let r=null!=(q=null!=(p=null==(o=a.content)?void 0:o.size)?p:a.nodeSize)?q:0,s=Math.max(d,b),t=Math.min(e,b+r);s>=t||((a,b,c)=>{if(R2(b))return[...a.matchAll(b)];let d=b(a,c);return d?d.map(b=>{let c=[b.text];return c.index=b.index,c.input=a,c.data=b.data,b.replaceWith&&(b.text.includes(b.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),c.push(b.replaceWith)),c}):[]})(a.isText?a.text||"":a.textBetween(s-b,t-b,void 0,"￼"),f.find,g).forEach(a=>{if(void 0===a.index)return;let b=s+a.index+1,d=b+a[0].length,e={from:c.tr.mapping.map(b),to:c.tr.mapping.map(d)},m=f.handler({state:c,range:e,match:a,commands:i,chain:j,can:k,pasteEvent:g,dropEvent:h});l.push(m)})}),l.every(a=>null!==a)}({editor:c,state:RO({state:a,transaction:i}),from:Math.max(d-1,0),to:e.b-1,rule:f,pasteEvent:g,dropEvent:b})&&i.steps.length){try{b="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{b=null}return h="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,i}};return d.map(a=>new un({view(a){let b=b=>{var d;(e=(null==(d=a.dom.parentElement)?void 0:d.contains(b.target))?a.dom.parentElement:null)&&(TG=c)},d=()=>{TG&&(TG=null)};return window.addEventListener("dragstart",b),window.addEventListener("dragend",d),{destroy(){window.removeEventListener("dragstart",b),window.removeEventListener("dragend",d)}}},props:{handleDOMEvents:{drop:(a,c)=>{if(g=e===a.dom.parentElement,b=c,!g){let a=TG;(null==a?void 0:a.isEditable)&&setTimeout(()=>{let b=a.state.selection;b&&a.commands.deleteRange({from:b.from,to:b.to})},10)}return!1},paste:(a,b)=>{var c;let d=null==(c=b.clipboardData)?void 0:c.getData("text/html");return h=b,f=!!(null==d?void 0:d.includes("data-pm-slice")),!1}}},appendTransaction:(b,c,d)=>{let e=b[0],j="paste"===e.getMeta("uiEvent")&&!f,k="drop"===e.getMeta("uiEvent")&&!g,l=e.getMeta("applyPasteRules"),m=!!l;if(!j&&!k&&!m)return;if(m){var n,o;let b,{text:c}=l;"string"==typeof c||(c=SQ(sJ.from(c),d.schema));let{from:e}=l,f=e+c.length;return i({rule:a,state:d,from:e,to:{b:f},pasteEvt:(n=c,null==(o=(b=new ClipboardEvent("paste",{clipboardData:new DataTransfer})).clipboardData)||o.setData("text/html",n),b)})}let p=c.doc.content.findDiffStart(d.doc.content),q=c.doc.content.findDiffEnd(d.doc.content);if("number"==typeof p&&q&&p!==q.b)return i({rule:a,state:d,from:p,to:q,pasteEvt:h})}}))}({editor:a,rules:b});d.push(...c)}}let j=SO(b,"addProseMirrorPlugins",c);if(j){let a=j();d.push(...a)}return d})}get attributes(){return SU(this.extensions)}get nodeViews(){let{editor:a}=this,{nodeExtensions:b}=ST(this.extensions);return Object.fromEntries(b.filter(a=>!!SO(a,"addNodeView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:RY(b.name,this.schema)},e=SO(b,"addNodeView",d);if(!e)return[];let f=e();return f?[b.name,(d,e,g,h,i)=>{let j=SW(d,c);return f({node:d,view:e,getPos:g,decorations:h,innerDecorations:i,editor:a,extension:b,HTMLAttributes:j})}]:[]}))}get markViews(){let{editor:a}=this,{markExtensions:b}=ST(this.extensions);return Object.fromEntries(b.filter(a=>!!SO(a,"addMarkView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:R7(b.name,this.schema)},e=SO(b,"addMarkView",d);return e?[b.name,(d,f,g)=>{let h=SW(d,c);return e()({mark:d,view:f,inline:g,editor:a,extension:b,HTMLAttributes:h,updateAttributes:b=>{!function(a,b,c={}){let{state:d}=b,{doc:e,tr:f}=d;e.descendants((b,d)=>{let e=f.mapping.map(d),g=f.mapping.map(d)+b.nodeSize,h=null;if(b.marks.forEach(b=>{if(b!==a)return!1;h=b}),!h)return;let i=!1;if(Object.keys(c).forEach(a=>{c[a]!==h.attrs[a]&&(i=!0)}),i){let b=a.type.create({...a.attrs,...c});f.removeMark(e,g,a.type),f.addMark(e,g,b)}}),f.docChanged&&b.view.dispatch(f)}(d,a,b)}})}]:[]}))}setupExtensions(){let a=this.extensions;this.editor.extensionStorage=Object.fromEntries(a.map(a=>[a.name,a.storage])),a.forEach(a=>{var b;let c={name:a.name,options:a.options,storage:this.editor.extensionStorage[a.name],editor:this.editor,type:S5(a.name,this.schema)};"mark"===a.type&&(null==(b=SS(SO(a,"keepOnSplit",c)))||b)&&this.splittableMarks.push(a.name);let d=SO(a,"onBeforeCreate",c),e=SO(a,"onCreate",c),f=SO(a,"onUpdate",c),g=SO(a,"onSelectionUpdate",c),h=SO(a,"onTransaction",c),i=SO(a,"onFocus",c),j=SO(a,"onBlur",c),k=SO(a,"onDestroy",c);d&&this.editor.on("beforeCreate",d),e&&this.editor.on("create",e),f&&this.editor.on("update",f),g&&this.editor.on("selectionUpdate",g),h&&this.editor.on("transaction",h),i&&this.editor.on("focus",i),j&&this.editor.on("blur",j),k&&this.editor.on("destroy",k)})}};TH.resolve=S_,TH.sort=S$,TH.flatten=SP,RN({},{ClipboardTextSerializer:()=>TJ,Commands:()=>TK,Delete:()=>TL,Drop:()=>TM,Editable:()=>TN,FocusEvents:()=>TP,Keymap:()=>TQ,Paste:()=>TR,Tabindex:()=>TS,TextDirection:()=>TT,focusEventsPluginKey:()=>TO});var TI=class a extends TD{constructor(){super(...arguments),this.type="extension"}static create(b={}){return new a("function"==typeof b?b():b)}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},TJ=TI.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new un({key:new uq("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:a}=this,{state:b,schema:c}=a,{doc:d,selection:e}=b,{ranges:f}=e,g=Math.min(...f.map(a=>a.$from.pos)),h=Math.max(...f.map(a=>a.$to.pos)),i=S1(c);return S0(d,{from:g,to:h},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:i})}}})]}}),TK=TI.create({name:"commands",addCommands:()=>({...RQ})}),TL=TI.create({name:"delete",onUpdate({transaction:a,appendedTransactions:b}){var c,d,e;let f=()=>{var c,d,e,f;if(null!=(f=null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.filterTransaction)?void 0:e.call(d,a))?f:a.getMeta("y-sync$"))return;let g=SM(a.before,[a,...b]);S3(g).forEach(b=>{g.mapping.mapResult(b.oldRange.from).deletedAfter&&g.mapping.mapResult(b.oldRange.to).deletedBefore&&g.before.nodesBetween(b.oldRange.from,b.oldRange.to,(c,d)=>{let e=d+c.nodeSize-2,f=b.oldRange.from<=d&&e<=b.oldRange.to;this.editor.emit("delete",{type:"node",node:c,from:d,to:e,newFrom:g.mapping.map(d),newTo:g.mapping.map(e),deletedRange:b.oldRange,newRange:b.newRange,partial:!f,editor:this.editor,transaction:a,combinedTransform:g})})});let h=g.mapping;g.steps.forEach((b,c)=>{var d,e;if(b instanceof tD){let f=h.slice(c).map(b.from,-1),i=h.slice(c).map(b.to),j=h.invert().map(f,-1),k=h.invert().map(i),l=null==(d=g.doc.nodeAt(f-1))?void 0:d.marks.some(a=>a.eq(b.mark)),m=null==(e=g.doc.nodeAt(i))?void 0:e.marks.some(a=>a.eq(b.mark));this.editor.emit("delete",{type:"mark",mark:b.mark,from:b.from,to:b.to,deletedRange:{from:j,to:k},newRange:{from:f,to:i},partial:!!(m||l),editor:this.editor,transaction:a,combinedTransform:g})}})};null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.async)||e?setTimeout(f,0):f()}}),TM=TI.create({name:"drop",addProseMirrorPlugins(){return[new un({key:new uq("tiptapDrop"),props:{handleDrop:(a,b,c,d)=>{this.editor.emit("drop",{editor:this.editor,event:b,slice:c,moved:d})}}})]}}),TN=TI.create({name:"editable",addProseMirrorPlugins(){return[new un({key:new uq("editable"),props:{editable:()=>this.editor.options.editable}})]}}),TO=new uq("focusEvents"),TP=TI.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:a}=this;return[new un({key:TO,props:{handleDOMEvents:{focus:(b,c)=>{a.isFocused=!0;let d=a.state.tr.setMeta("focus",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1},blur:(b,c)=>{a.isFocused=!1;let d=a.state.tr.setMeta("blur",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1}}}})]}}),TQ=TI.create({name:"keymap",addKeyboardShortcuts(){let a=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:b})=>{let{selection:c,doc:d}=b,{empty:e,$anchor:f}=c,{pos:g,parent:h}=f,i=f.parent.isTextblock&&g>0?b.doc.resolve(g-1):f,j=i.parent.type.spec.isolating,k=f.pos-f.parentOffset,l=j&&1===i.parent.childCount?k===f.pos:t5.atStart(d).from===g;return!!e&&!!h.type.isTextblock&&!h.textContent.length&&!!l&&(!l||"paragraph"!==f.parent.type.name)&&a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),b=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),c={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:a,"Mod-Backspace":a,"Shift-Backspace":a,Delete:b,"Mod-Delete":b,"Mod-a":()=>this.editor.commands.selectAll()},d={...c},e={...c,"Ctrl-h":a,"Alt-Backspace":a,"Ctrl-d":b,"Ctrl-Alt-Backspace":b,"Alt-Delete":b,"Alt-d":b,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Sd()||Ss()?e:d},addProseMirrorPlugins(){return[new un({key:new uq("clearDocument"),appendTransaction:(a,b,c)=>{if(a.some(a=>a.getMeta("composition")))return;let d=a.some(a=>a.docChanged)&&!b.doc.eq(c.doc),e=a.some(a=>a.getMeta("preventClearDocument"));if(!d||e)return;let{empty:f,from:g,to:h}=b.selection,i=t5.atStart(b.doc).from,j=t5.atEnd(b.doc).to;if(f||g!==i||h!==j||!Ta(c.doc))return;let k=c.tr,l=RO({state:c,transaction:k}),{commands:m}=new RP({editor:this.editor,state:l});if(m.clearNodes(),k.steps.length)return k}})]}}),TR=TI.create({name:"paste",addProseMirrorPlugins(){return[new un({key:new uq("tiptapPaste"),props:{handlePaste:(a,b,c)=>{this.editor.emit("paste",{editor:this.editor,event:b,slice:c})}}})]}}),TS=TI.create({name:"tabindex",addProseMirrorPlugins(){return[new un({key:new uq("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),TT=TI.create({name:"textDirection",addOptions:()=>({direction:void 0}),addGlobalAttributes(){if(!this.options.direction)return[];let{nodeExtensions:a}=ST(this.extensions);return[{types:a.filter(a=>"text"!==a.name).map(a=>a.name),attributes:{dir:{default:this.options.direction,parseHTML:a=>{let b=a.getAttribute("dir");return b&&("ltr"===b||"rtl"===b||"auto"===b)?b:this.options.direction},renderHTML:a=>a.dir?{dir:a.dir}:{}}}}]},addProseMirrorPlugins(){return[new un({key:new uq("textDirection"),props:{attributes:()=>{let a=this.options.direction;return a?{dir:a}:{}}}})]}}),TU=class a{constructor(a,b,c=!1,d=null){this.currentNode=null,this.actualDepth=null,this.isBlock=c,this.resolvedPos=a,this.editor=b,this.currentNode=d}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var a;return null!=(a=this.actualDepth)?a:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(a){let b=this.from,c=this.to;if(this.isBlock){if(0===this.content.size)return void console.error(`You can\u2019t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);b=this.from+1,c=this.to-1}this.editor.commands.insertContentAt({from:b,to:c},a)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+ +!this.node.isText}get parent(){if(0===this.depth)return null;let b=this.resolvedPos.start(this.resolvedPos.depth-1);return new a(this.resolvedPos.doc.resolve(b),this.editor)}get before(){let b=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return b.depth!==this.depth&&(b=this.resolvedPos.doc.resolve(this.from-3)),new a(b,this.editor)}get after(){let b=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return b.depth!==this.depth&&(b=this.resolvedPos.doc.resolve(this.to+3)),new a(b,this.editor)}get children(){let b=[];return this.node.content.forEach((c,d)=>{let e=c.isBlock&&!c.isTextblock,f=c.isAtom&&!c.isText,g=this.pos+d+ +!f;if(g<0||g>this.resolvedPos.doc.nodeSize-2)return;let h=this.resolvedPos.doc.resolve(g);if(!e&&h.depth<=this.depth)return;let i=new a(h,this.editor,e,e?c:null);e&&(i.actualDepth=this.depth+1),b.push(new a(h,this.editor,e,e?c:null))}),b}get firstChild(){return this.children[0]||null}get lastChild(){let a=this.children;return a[a.length-1]||null}closest(a,b={}){let c=null,d=this.parent;for(;d&&!c;){if(d.node.type.name===a)if(Object.keys(b).length>0){let a=d.node.attrs,c=Object.keys(b);for(let d=0;d<c.length;d+=1){let e=c[d];if(a[e]!==b[e])break}}else c=d;d=d.parent}return c}querySelector(a,b={}){return this.querySelectorAll(a,b,!0)[0]||null}querySelectorAll(a,b={},c=!1){let d=[];if(!this.children||0===this.children.length)return d;let e=Object.keys(b);return this.children.forEach(f=>{c&&d.length>0||(f.node.type.name===a&&e.every(a=>b[a]===f.node.attrs[a])&&d.push(f),c&&d.length>0||(d=d.concat(f.querySelectorAll(a,b,c))))}),d}setAttribute(a){let{tr:b}=this.editor.state;b.setNodeMarkup(this.from,void 0,{...this.node.attrs,...a}),this.editor.view.dispatch(b)}},TV=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`,TW=class extends Tz{constructor(a={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:"undefined"!=typeof document?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:a})=>{throw a},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(a),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:a,slice:b,moved:c})=>this.options.onDrop(a,b,c)),this.on("paste",({event:a,slice:b})=>this.options.onPaste(a,b)),this.on("delete",this.options.onDelete);const b=this.createDoc(),c=Sc(b,this.options.autofocus);this.editorState=um.create({doc:b,schema:this.schema,selection:c||void 0}),this.options.element&&this.mount(this.options.element)}mount(a){if("undefined"==typeof document)throw Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(a),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(!1!==this.options.autofocus&&null!==this.options.autofocus&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){let a=this.editorView.dom;(null==a?void 0:a.editor)&&delete a.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{"function"==typeof this.css.remove?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(a){console.warn("Failed to remove CSS element:",a)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&"undefined"!=typeof document&&(this.css=function(a,b,c){let d=document.querySelector("style[data-tiptap-style]");if(null!==d)return d;let e=document.createElement("style");return b&&e.setAttribute("nonce",b),e.setAttribute("data-tiptap-style",""),e.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(e),e}(TV,this.options.injectNonce))}setOptions(a={}){this.options={...this.options,...a},this.editorView&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(a,b=!0){this.setOptions({editable:a}),b&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:a=>{this.editorState=a},dispatch:a=>{this.dispatchTransaction(a)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(a,b)=>{if(this.editorView)return this.editorView[b];if("state"===b)return this.editorState;if(b in a)return Reflect.get(a,b);throw Error(`[tiptap error]: The editor view is not available. Cannot access view['${b}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(a,b){let c=SR(b)?b(a,[...this.state.plugins]):[...this.state.plugins,a],d=this.state.reconfigure({plugins:c});return this.view.updateState(d),d}unregisterPlugin(a){if(this.isDestroyed)return;let b=this.state.plugins,c=b;if([].concat(a).forEach(a=>{let b="string"==typeof a?`${a}$`:a.key;c=c.filter(a=>!a.key.startsWith(b))}),b.length===c.length)return;let d=this.state.reconfigure({plugins:c});return this.view.updateState(d),d}createExtensionManager(){var a,b;let c=[...this.options.enableCoreExtensions?[TN,TJ.configure({blockSeparator:null==(b=null==(a=this.options.coreExtensionOptions)?void 0:a.clipboardTextSerializer)?void 0:b.blockSeparator}),TK,TP,TQ,TS,TM,TR,TL,TT.configure({direction:this.options.textDirection})].filter(a=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[a.name]):[],...this.options.extensions].filter(a=>["extension","node","mark"].includes(null==a?void 0:a.type));this.extensionManager=new TH(c,this)}createCommandManager(){this.commandManager=new RP({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let a;try{a=SJ(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(b){if(!(b instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(b.message))throw b;this.emit("contentError",{editor:this,error:b,disableCollaboration:()=>{"collaboration"in this.storage&&"object"==typeof this.storage.collaboration&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>"collaboration"!==a.name),this.createExtensionManager()}}),a=SJ(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return a}createView(a){var b;this.editorView=new wR(a,{...this.options.editorProps,attributes:{role:"textbox",...null==(b=this.options.editorProps)?void 0:b.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});let c=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(c),this.prependClass(),this.injectCSS(),this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(a){this.isCapturingTransaction=!0,a(),this.isCapturingTransaction=!1;let b=this.capturedTransaction;return this.capturedTransaction=null,b}dispatchTransaction(a){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=a;return}a.steps.forEach(a=>{var b;return null==(b=this.capturedTransaction)?void 0:b.step(a)});return}let{state:b,transactions:c}=this.state.applyTransaction(a),d=!this.state.selection.eq(b.selection),e=c.includes(a),f=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:a,nextState:b}),!e)return;this.view.updateState(b),this.emit("transaction",{editor:this,transaction:a,appendedTransactions:c.slice(1)}),d&&this.emit("selectionUpdate",{editor:this,transaction:a});let g=c.findLast(a=>a.getMeta("focus")||a.getMeta("blur")),h=null==g?void 0:g.getMeta("focus"),i=null==g?void 0:g.getMeta("blur");h&&this.emit("focus",{editor:this,event:h.event,transaction:g}),i&&this.emit("blur",{editor:this,event:i.event,transaction:g}),a.getMeta("preventUpdate")||!c.some(a=>a.docChanged)||f.doc.eq(b.doc)||this.emit("update",{editor:this,transaction:a,appendedTransactions:c.slice(1)})}getAttributes(a){return S2(this.state,a)}isActive(a,b){let c="string"==typeof a?a:null,d="string"==typeof a?b:a;return function(a,b,c={}){if(!b)return Su(a,null,c)||S7(a,null,c);let d=Sz(b,a.schema);return"node"===d?Su(a,b,c):"mark"===d&&S7(a,b,c)}(this.state,c,d)}getJSON(){return this.state.doc.toJSON()}getHTML(){return SQ(this.state.doc.content,this.schema)}getText(a){var b,c;let d,{blockSeparator:e="\n\n",textSerializers:f={}}=a||{};return b=this.state.doc,c={blockSeparator:e,textSerializers:{...S1(this.schema),...f}},d={from:0,to:b.content.size},S0(b,d,c)}get isEmpty(){return Ta(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var a,b;return null==(b=null==(a=this.editorView)?void 0:a.isDestroyed)||b}$node(a,b){var c;return(null==(c=this.$doc)?void 0:c.querySelector(a,b))||null}$nodes(a,b){var c;return(null==(c=this.$doc)?void 0:c.querySelectorAll(a,b))||null}$pos(a){return new TU(this.state.doc.resolve(a),this)}get $doc(){return this.$pos(0)}};function TX(a){return new TA({find:a.find,handler:({state:b,range:c,match:d})=>{let e=SS(a.getAttributes,void 0,d);if(!1===e||null===e)return null;let{tr:f}=b,g=d[d.length-1],h=d[0];if(g){let d=h.search(/\S/),i=c.from+h.indexOf(g),j=i+g.length;if(S4(c.from,c.to,b.doc).filter(b=>b.mark.type.excluded.find(c=>c===a.type&&c!==b.mark.type)).filter(a=>a.to>i).length)return null;j<c.to&&f.delete(j,c.to),i>c.from&&f.delete(c.from+d,i);let k=c.from+d+g.length;f.addMark(c.from+d,k,a.type.create(e||{})),f.removeStoredMark(a.type)}},undoable:a.undoable})}function TY(a){return new TA({find:a.find,handler:({state:b,range:c,match:d})=>{let e=b.doc.resolve(c.from),f=SS(a.getAttributes,void 0,d)||{};if(!e.node(-1).canReplaceWith(e.index(-1),e.indexAfter(-1),a.type))return null;b.tr.delete(c.from,c.to).setBlockType(c.from,c.from,a.type,f)},undoable:a.undoable})}function TZ(a){return new TA({find:a.find,handler:({state:b,range:c,match:d,chain:e})=>{let f=SS(a.getAttributes,void 0,d)||{},g=b.tr.delete(c.from,c.to),h=g.doc.resolve(c.from).blockRange(),i=h&&tL(h,a.type,f);if(!i)return null;if(g.wrap(h,i),a.keepMarks&&a.editor){let{selection:c,storedMarks:d}=b,{splittableMarks:e}=a.editor.extensionManager,f=d||c.$to.parentOffset&&c.$from.marks();if(f){let a=f.filter(a=>e.includes(a.type.name));g.ensureMarks(a)}}if(a.keepAttributes){let b="bulletList"===a.type.name||"orderedList"===a.type.name?"listItem":"taskList";e().updateAttributes(b,f).run()}let j=g.doc.resolve(c.from-1).nodeBefore;j&&j.type===a.type&&tQ(g.doc,c.from-1)&&(!a.joinPredicate||a.joinPredicate(d,j))&&g.join(c.from-1)},undoable:a.undoable})}function T$(a){if(!(null==a?void 0:a.trim()))return{};let b={},c=[],d=a.replace(/["']([^"']*)["']/g,a=>(c.push(a),`__QUOTED_${c.length-1}__`)),e=d.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);e&&(b.class=e.map(a=>a.trim().slice(1)).join(" "));let f=d.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);f&&(b.id=f[1]),Array.from(d.matchAll(/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g)).forEach(([,a,d])=>{var e;let f=c[parseInt((null==(e=d.match(/__QUOTED_(\d+)__/))?void 0:e[1])||"0",10)];f&&(b[a]=f.slice(1,-1))});let g=d.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return g&&g.split(/\s+/).filter(Boolean).forEach(a=>{a.match(/^[a-zA-Z][\w-]*$/)&&(b[a]=!0)}),b}function T_(a){if(!a||0===Object.keys(a).length)return"";let b=[];return a.class&&String(a.class).split(/\s+/).filter(Boolean).forEach(a=>b.push(`.${a}`)),a.id&&b.push(`#${a.id}`),Object.entries(a).forEach(([a,c])=>{"class"!==a&&"id"!==a&&(!0===c?b.push(a):!1!==c&&null!=c&&b.push(`${a}="${String(c)}"`))}),b.join(" ")}function T0(a){let{nodeName:b,name:c,parseAttributes:d=T$,serializeAttributes:e=T_,defaultAttributes:f={},requiredAttributes:g=[],allowedAttributes:h}=a,i=c||b;return{parseMarkdown:(a,c)=>{let d={...f,...a.attributes};return c.createNode(b,d,[])},markdownTokenizer:{name:b,level:"block",start(a){var b;let c=RegExp(`^:::${i}(?:\\s|$)`,"m"),d=null==(b=a.match(c))?void 0:b.index;return void 0!==d?d:-1},tokenize(a,c,e){let f=RegExp(`^:::${i}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),h=a.match(f);if(!h)return;let j=d(h[1]||"");if(!g.find(a=>!(a in j)))return{type:b,raw:h[0],attributes:j}}},renderMarkdown:a=>{let b=e((a=>{if(!h)return a;let b={};return h.forEach(c=>{c in a&&(b[c]=a[c])}),b})(a.attrs||{})),c=b?` {${b}}`:"";return`:::${i}${c} :::`}}}function T1(a){let{nodeName:b,name:c,getContent:d,parseAttributes:e=T$,serializeAttributes:f=T_,defaultAttributes:g={},content:h="block",allowedAttributes:i}=a,j=c||b;return{parseMarkdown:(a,c)=>{let e;if(d){let b=d(a);e="string"==typeof b?[{type:"text",text:b}]:b}else e="block"===h?c.parseChildren(a.tokens||[]):c.parseInline(a.tokens||[]);let f={...g,...a.attributes};return c.createNode(b,f,e)},markdownTokenizer:{name:b,level:"block",start(a){var b;let c=RegExp(`^:::${j}`,"m"),d=null==(b=a.match(c))?void 0:b.index;return void 0!==d?d:-1},tokenize(a,c,d){var f;let g=RegExp(`^:::${j}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),i=a.match(g);if(!i)return;let[k,l=""]=i,m=e(l),n=1,o=k.length,p="",q=/^:::([\w-]*)(\s.*)?/gm,r=a.slice(o);for(q.lastIndex=0;;){let c=q.exec(r);if(null===c)break;let e=c.index,g=c[1];if(null==(f=c[2])||!f.endsWith(":::")){if(g)n+=1;else if(0==(n-=1)){let f=r.slice(0,e);p=f.trim();let g=a.slice(0,o+e+c[0].length),i=[];if(p)if("block"===h)for((i=d.blockTokens(f)).forEach(a=>{a.text&&(!a.tokens||0===a.tokens.length)&&(a.tokens=d.inlineTokens(a.text))});i.length>0;){let a=i[i.length-1];if("paragraph"!==a.type||a.text&&""!==a.text.trim())break;i.pop()}else i=d.inlineTokens(p);return{type:b,raw:g,attributes:m,content:p,tokens:i}}}}}},renderMarkdown:(a,b)=>{let c=f((a=>{if(!i)return a;let b={};return i.forEach(c=>{c in a&&(b[c]=a[c])}),b})(a.attrs||{})),d=c?` {${c}}`:"",e=b.renderChildren(a.content||[],"\n\n");return`:::${j}${d}

${e}

:::`}}}function T2(a){if(!a.trim())return{};let b={},c=/(\w+)=(?:"([^"]*)"|'([^']*)')/g,d=c.exec(a);for(;null!==d;){let[,e,f,g]=d;b[e]=f||g,d=c.exec(a)}return b}function T3(a){return Object.entries(a).filter(([,a])=>null!=a).map(([a,b])=>`${a}="${b}"`).join(" ")}function T4(a){let{nodeName:b,name:c,getContent:d,parseAttributes:e=T2,serializeAttributes:f=T3,defaultAttributes:g={},selfClosing:h=!1,allowedAttributes:i}=a,j=c||b,k=j.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(a,c)=>{let e={...g,...a.attributes};if(h)return c.createNode(b,e);let f=d?d(a):a.content||"";return f?c.createNode(b,e,[c.createTextNode(f)]):c.createNode(b,e,[])},markdownTokenizer:{name:b,level:"inline",start(a){let b=h?RegExp(`\\[${k}\\s*[^\\]]*\\]`):RegExp(`\\[${k}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${k}\\]`),c=a.match(b),d=null==c?void 0:c.index;return void 0!==d?d:-1},tokenize(a,c,d){let f=h?RegExp(`^\\[${k}\\s*([^\\]]*)\\]`):RegExp(`^\\[${k}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${k}\\]`),g=a.match(f);if(!g)return;let i="",j="";if(h){let[,a]=g;j=a}else{let[,a,b]=g;j=a,i=b||""}let l=e(j.trim());return{type:b,raw:g[0],content:i.trim(),attributes:l}}},renderMarkdown:a=>{let b="";d?b=d(a):a.content&&a.content.length>0&&(b=a.content.filter(a=>"text"===a.type).map(a=>a.text).join(""));let c=f((a=>{if(!i)return a;let b={};return i.forEach(c=>{c in a&&(b[c]=a[c])}),b})(a.attrs||{})),e=c?` ${c}`:"";return h?`[${j}${e}]`:`[${j}${e}]${b}[/${j}]`}}}function T5(a,b,c){var d,e,f,g;let h=a.split("\n"),i=[],j="",k=0,l=b.baseIndentSize||2;for(;k<h.length;){let a,m=h[k],n=m.match(b.itemPattern);if(!n)if(i.length>0)break;else{if(""!==m.trim())return;k+=1,j=`${j}${m}
`;continue}let o=b.extractItemData(n),{indentLevel:p,mainContent:q}=o;j=`${j}${m}
`;let r=[q];for(k+=1;k<h.length;){let a=h[k];if(""===a.trim()){let b=h.slice(k+1).findIndex(a=>""!==a.trim());if(-1===b)break;if(((null==(e=null==(d=h[k+1+b].match(/^(\s*)/))?void 0:d[1])?void 0:e.length)||0)>p){r.push(a),j=`${j}${a}
`,k+=1;continue}break}if(((null==(g=null==(f=a.match(/^(\s*)/))?void 0:f[1])?void 0:g.length)||0)>p)r.push(a),j=`${j}${a}
`,k+=1;else break}let s=r.slice(1);if(s.length>0){let d=s.map(a=>a.slice(p+l)).join("\n");d.trim()&&(a=b.customNestedParser?b.customNestedParser(d):c.blockTokens(d))}let t=b.createToken(o,a);i.push(t)}if(0!==i.length)return{items:i,raw:j}}function T6(a,b,c,d){if(!a||!Array.isArray(a.content))return"";let e="function"==typeof c?c(d):c,[f,...g]=a.content,h=b.renderChildren([f]),i=[`${e}${h}`];return g&&g.length>0&&g.forEach(a=>{let c=b.renderChildren([a]);if(c){let a=c.split("\n").map(a=>a?b.indent(a):"").join("\n");i.push(a)}}),i.join("\n")}RN({},{createAtomBlockMarkdownSpec:()=>T0,createBlockMarkdownSpec:()=>T1,createInlineMarkdownSpec:()=>T4,parseAttributes:()=>T$,parseIndentedBlocks:()=>T5,renderNestedMarkdownContent:()=>T6,serializeAttributes:()=>T_});var T7=class a extends TD{constructor(){super(...arguments),this.type="node"}static create(b={}){return new a("function"==typeof b?b():b)}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}};function T8(a){return new TF({find:a.find,handler:({state:b,range:c,match:d,pasteEvent:e})=>{let f=SS(a.getAttributes,void 0,d,e);if(!1===f||null===f)return null;let{tr:g}=b,h=d[d.length-1],i=d[0],j=c.to;if(h){let d=i.search(/\S/),e=c.from+i.indexOf(h),k=e+h.length;if(S4(c.from,c.to,b.doc).filter(b=>b.mark.type.excluded.find(c=>c===a.type&&c!==b.mark.type)).filter(a=>a.to>e).length)return null;k<c.to&&g.delete(k,c.to),e>c.from&&g.delete(c.from+d,e),j=c.from+d+h.length,g.addMark(c.from+d,j,a.type.create(f||{})),g.removeStoredMark(a.type)}}})}var T9=/(^|[^`])`([^`]+)`(?!`)$/,Ua=/(^|[^`])`([^`]+)`(?!`)/g,Ub=TE.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:a}){return["code",SV(this.options.HTMLAttributes,a),0]},addCommands(){return{setCode:()=>({commands:a})=>a.setMark(this.name),toggleCode:()=>({commands:a})=>a.toggleMark(this.name),unsetCode:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[TX({find:T9,type:this.type})]},addPasteRules(){return[T8({find:Ua,type:this.type})]}}),Uc=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,Ud=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,Ue=TE.create({name:"highlight",addOptions:()=>({multicolor:!1,HTMLAttributes:{}}),addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:a=>a.getAttribute("data-color")||a.style.backgroundColor,renderHTML:a=>a.color?{"data-color":a.color,style:`background-color: ${a.color}; color: inherit`}:{}}}:{}},parseHTML:()=>[{tag:"mark"}],renderHTML({HTMLAttributes:a}){return["mark",SV(this.options.HTMLAttributes,a),0]},addCommands(){return{setHighlight:a=>({commands:b})=>b.setMark(this.name,a),toggleHighlight:a=>({commands:b})=>b.toggleMark(this.name,a),unsetHighlight:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[TX({find:Uc,type:this.type})]},addPasteRules(){return[T8({find:Ud,type:this.type})]}}),Uf=(a,b)=>{if("slot"===a)return 0;if(a instanceof Function)return a(b);let{children:c,...d}=null!=b?b:{};if("svg"===a)throw Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[a,d,c]},Ug=/^\s*>\s$/,Uh=T7.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:a}){return Uf("blockquote",{...SV(this.options.HTMLAttributes,a),children:Uf("slot",{})})},parseMarkdown:(a,b)=>b.createNode("blockquote",void 0,b.parseChildren(a.tokens||[])),renderMarkdown:(a,b)=>{if(!a.content)return"";let c=[];return a.content.forEach(a=>{let d=b.renderChildren([a]).split("\n").map(a=>""===a.trim()?">":`> ${a}`);c.push(d.join("\n"))}),c.join(`
>
`)},addCommands(){return{setBlockquote:()=>({commands:a})=>a.wrapIn(this.name),toggleBlockquote:()=>({commands:a})=>a.toggleWrap(this.name),unsetBlockquote:()=>({commands:a})=>a.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[TZ({find:Ug,type:this.type})]}}),Ui=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Uj=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Uk=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Ul=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Um=TE.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:a=>"normal"!==a.style.fontWeight&&null},{style:"font-weight=400",clearMark:a=>a.type.name===this.name},{style:"font-weight",getAttrs:a=>/^(bold(er)?|[5-9]\d{2,})$/.test(a)&&null}]},renderHTML({HTMLAttributes:a}){return Uf("strong",{...SV(this.options.HTMLAttributes,a),children:Uf("slot",{})})},markdownTokenName:"strong",parseMarkdown:(a,b)=>b.applyMark("bold",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`**${b.renderChildren(a)}**`,addCommands(){return{setBold:()=>({commands:a})=>a.setMark(this.name),toggleBold:()=>({commands:a})=>a.toggleMark(this.name),unsetBold:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[TX({find:Ui,type:this.type}),TX({find:Uk,type:this.type})]},addPasteRules(){return[T8({find:Uj,type:this.type}),T8({find:Ul,type:this.type})]}}),Un=/^```([a-z]+)?[\s\n]$/,Uo=/^~~~([a-z]+)?[\s\n]$/,Up=T7.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:a=>{var b;let{languageClassPrefix:c}=this.options;if(!c)return null;let d=[...(null==(b=a.firstElementChild)?void 0:b.classList)||[]].filter(a=>a.startsWith(c)).map(a=>a.replace(c,""))[0];return d||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:a,HTMLAttributes:b}){return["pre",SV(this.options.HTMLAttributes,b),["code",{class:a.attrs.language?this.options.languageClassPrefix+a.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(a,b)=>{var c;return(null==(c=a.raw)?void 0:c.startsWith("```"))===!1&&"indented"!==a.codeBlockStyle?[]:b.createNode("codeBlock",{language:a.lang||null},a.text?[b.createTextNode(a.text)]:[])},renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.language)||"";return a.content?[`\`\`\`${d}`,b.renderChildren(a.content),"```"].join("\n"):`\`\`\`${d}

\`\`\``},addCommands(){return{setCodeBlock:a=>({commands:b})=>b.setNode(this.name,a),toggleCodeBlock:a=>({commands:b})=>b.toggleNode(this.name,"paragraph",a)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty:a,$anchor:b}=this.editor.state.selection,c=1===b.pos;return!!a&&b.parent.type.name===this.name&&(!!c||!b.parent.textContent.length)&&this.editor.commands.clearNodes()},Tab:({editor:a})=>{var b;if(!this.options.enableTabIndentation)return!1;let c=null!=(b=this.options.tabSize)?b:4,{state:d}=a,{selection:e}=d,{$from:f,empty:g}=e;if(f.parent.type!==this.type)return!1;let h=" ".repeat(c);return g?a.commands.insertContent(h):a.commands.command(({tr:a})=>{let{from:b,to:c}=e,f=d.doc.textBetween(b,c,"\n","\n").split("\n").map(a=>h+a).join("\n");return a.replaceWith(b,c,d.schema.text(f)),!0})},"Shift-Tab":({editor:a})=>{var b;if(!this.options.enableTabIndentation)return!1;let c=null!=(b=this.options.tabSize)?b:4,{state:d}=a,{selection:e}=d,{$from:f,empty:g}=e;return f.parent.type===this.type&&(g?a.commands.command(({tr:a})=>{var b;let{pos:e}=f,g=f.start(),h=f.end(),i=d.doc.textBetween(g,h,"\n","\n").split("\n"),j=0,k=0,l=e-g;for(let a=0;a<i.length;a+=1){if(k+i[a].length>=l){j=a;break}k+=i[a].length+1}let m=Math.min(((null==(b=i[j].match(/^ */))?void 0:b[0])||"").length,c);if(0===m)return!0;let n=g;for(let a=0;a<j;a+=1)n+=i[a].length+1;return a.delete(n,n+m),e-n<=m&&a.setSelection(t9.create(a.doc,n)),!0}):a.commands.command(({tr:a})=>{let{from:b,to:f}=e,g=d.doc.textBetween(b,f,"\n","\n").split("\n").map(a=>{var b;let d=Math.min(((null==(b=a.match(/^ */))?void 0:b[0])||"").length,c);return a.slice(d)}).join("\n");return a.replaceWith(b,f,d.schema.text(g)),!0}))},Enter:({editor:a})=>{if(!this.options.exitOnTripleEnter)return!1;let{state:b}=a,{selection:c}=b,{$from:d,empty:e}=c;if(!e||d.parent.type!==this.type)return!1;let f=d.parentOffset===d.parent.nodeSize-2,g=d.parent.textContent.endsWith("\n\n");return!!f&&!!g&&a.chain().command(({tr:a})=>(a.delete(d.pos-2,d.pos),!0)).exitCode().run()},ArrowDown:({editor:a})=>{if(!this.options.exitOnArrowDown)return!1;let{state:b}=a,{selection:c,doc:d}=b,{$from:e,empty:f}=c;if(!f||e.parent.type!==this.type||e.parentOffset!==e.parent.nodeSize-2)return!1;let g=e.after();return void 0!==g&&(d.nodeAt(g)?a.commands.command(({tr:a})=>(a.setSelection(t5.near(d.resolve(g))),!0)):a.commands.exitCode())}}},addInputRules(){return[TY({find:Un,type:this.type,getAttributes:a=>({language:a[1]})}),TY({find:Uo,type:this.type,getAttributes:a=>({language:a[1]})})]},addProseMirrorPlugins(){return[new un({key:new uq("codeBlockVSCodeHandler"),props:{handlePaste:(a,b)=>{if(!b.clipboardData||this.editor.isActive(this.type.name))return!1;let c=b.clipboardData.getData("text/plain"),d=b.clipboardData.getData("vscode-editor-data"),e=d?JSON.parse(d):void 0,f=null==e?void 0:e.mode;if(!c||!f)return!1;let{tr:g,schema:h}=a.state,i=h.text(c.replace(/\r\n?/g,"\n"));return g.replaceSelectionWith(this.type.create({language:f},i)),g.selection.$from.parent.type!==this.type&&g.setSelection(t9.near(g.doc.resolve(Math.max(0,g.selection.from-2)))),g.setMeta("paste",!0),a.dispatch(g),!0}}})]}}),Uq=T7.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n\n"):""}),Ur=T7.create({name:"hardBreak",markdownTokenName:"br",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:a}){return["br",SV(this.options.HTMLAttributes,a)]},renderText:()=>"\n",renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:a,chain:b,state:c,editor:d})=>a.first([()=>a.exitCode(),()=>a.command(()=>{let{selection:a,storedMarks:e}=c;if(a.$from.parent.type.spec.isolating)return!1;let{keepMarks:f}=this.options,{splittableMarks:g}=d.extensionManager,h=e||a.$to.parentOffset&&a.$from.marks();return b().insertContent({type:this.name}).command(({tr:a,dispatch:b})=>{if(b&&h&&f){let b=h.filter(a=>g.includes(a.type.name));a.ensureMarks(b)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Us=T7.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map(a=>({tag:`h${a}`,attrs:{level:a}}))},renderHTML({node:a,HTMLAttributes:b}){let c=this.options.levels.includes(a.attrs.level)?a.attrs.level:this.options.levels[0];return[`h${c}`,SV(this.options.HTMLAttributes,b),0]},parseMarkdown:(a,b)=>b.createNode("heading",{level:a.depth||1},b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.level)?parseInt(a.attrs.level,10):1,e="#".repeat(d);return a.content?`${e} ${b.renderChildren(a.content)}`:""},addCommands(){return{setHeading:a=>({commands:b})=>!!this.options.levels.includes(a.level)&&b.setNode(this.name,a),toggleHeading:a=>({commands:b})=>!!this.options.levels.includes(a.level)&&b.toggleNode(this.name,"paragraph",a)}},addKeyboardShortcuts(){return this.options.levels.reduce((a,b)=>({...a,...{[`Mod-Alt-${b}`]:()=>this.editor.commands.toggleHeading({level:b})}}),{})},addInputRules(){return this.options.levels.map(a=>TY({find:RegExp(`^(#{${Math.min(...this.options.levels)},${a}})\\s$`),type:this.type,getAttributes:{level:a}}))}}),Ut=T7.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{},nextNodeType:"paragraph"}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:a}){return["hr",SV(this.options.HTMLAttributes,a)]},markdownTokenName:"hr",parseMarkdown:(a,b)=>b.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:a,state:b})=>{if(!function(a,b){let{selection:c}=a,{$from:d}=c;if(c instanceof ub){let a=d.index();return d.parent.canReplaceWith(a,a+1,b)}let e=d.depth;for(;e>=0;){let a=d.index(e);if(d.node(e).contentMatchAt(a).matchType(b))return!0;e-=1}return!1}(b,b.schema.nodes[this.name]))return!1;let{selection:c}=b,{$to:d}=c,e=a();return Tb(c)?e.insertContentAt(d.pos,{type:this.name}):e.insertContent({type:this.name}),e.command(({state:a,tr:b,dispatch:c})=>{if(c){let{$to:c}=b.selection,d=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?b.setSelection(t9.create(b.doc,c.pos+1)):c.nodeAfter.isBlock?b.setSelection(ub.create(b.doc,c.pos)):b.setSelection(t9.create(b.doc,c.pos));else{let e=a.schema.nodes[this.options.nextNodeType]||c.parent.type.contentMatch.defaultType,f=null==e?void 0:e.create();f&&(b.insert(d,f),b.setSelection(t9.create(b.doc,d+1)))}b.scrollIntoView()}return!0}).run()}}},addInputRules(){var a;return[new TA({find:(a={find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type}).find,handler:({state:b,range:c,match:d})=>{let e=SS(a.getAttributes,void 0,d)||{},{tr:f}=b,g=c.from,h=c.to,i=a.type.create(e);if(d[1]){let a=g+d[0].lastIndexOf(d[1]);a>h?a=h:h=a+d[1].length;let b=d[0][d[0].length-1];f.insertText(b,g+d[0].length-1),f.replaceWith(a,h,i)}else if(d[0]){let b=a.type.isInline?g:g-1;f.insert(b,a.type.create(e)).delete(f.mapping.map(g),f.mapping.map(h))}f.scrollIntoView()},undoable:a.undoable})]}}),Uu=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Uv=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Uw=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Ux=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Uy=TE.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:a=>"normal"!==a.style.fontStyle&&null},{style:"font-style=normal",clearMark:a=>a.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:a}){return["em",SV(this.options.HTMLAttributes,a),0]},addCommands(){return{setItalic:()=>({commands:a})=>a.setMark(this.name),toggleItalic:()=>({commands:a})=>a.toggleMark(this.name),unsetItalic:()=>({commands:a})=>a.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(a,b)=>b.applyMark("italic",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`*${b.renderChildren(a)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[TX({find:Uu,type:this.type}),TX({find:Uw,type:this.type})]},addPasteRules(){return[T8({find:Uv,type:this.type}),T8({find:Ux,type:this.type})]}});let Uz="numeric",UA="ascii",UB="alpha",UC="asciinumeric",UD="alphanumeric",UE="domain",UF="emoji",UG="whitespace";function UH(a,b,c){for(let d in b[Uz]&&(b[UC]=!0,b[UD]=!0),b[UA]&&(b[UC]=!0,b[UB]=!0),b[UC]&&(b[UD]=!0),b[UB]&&(b[UD]=!0),b[UD]&&(b[UE]=!0),b[UF]&&(b[UE]=!0),b){let b=(d in c||(c[d]=[]),c[d]);0>b.indexOf(a)&&b.push(a)}}function UI(a=null){this.j={},this.jr=[],this.jd=null,this.t=a}UI.groups={},UI.prototype={accepts(){return!!this.t},go(a){let b=this.j[a];if(b)return b;for(let b=0;b<this.jr.length;b++){let c=this.jr[b][0],d=this.jr[b][1];if(d&&c.test(a))return d}return this.jd},has(a,b=!1){return b?a in this.j:!!this.go(a)},ta(a,b,c,d){for(let e=0;e<a.length;e++)this.tt(a[e],b,c,d)},tr(a,b,c,d){let e;return d=d||UI.groups,b&&b.j?e=b:(e=new UI(b),c&&d&&UH(b,c,d)),this.jr.push([a,e]),e},ts(a,b,c,d){let e=this,f=a.length;if(!f)return e;for(let b=0;b<f-1;b++)e=e.tt(a[b]);return e.tt(a[f-1],b,c,d)},tt(a,b,c,d){if(d=d||UI.groups,b&&b.j)return this.j[a]=b,b;let e,f=this.go(a);return f?(Object.assign((e=new UI).j,f.j),e.jr.push.apply(e.jr,f.jr),e.jd=f.jd,e.t=f.t):e=new UI,b&&(d&&(e.t&&"string"==typeof e.t?UH(b,Object.assign(function(a,b){let c={};for(let d in b)b[d].indexOf(a)>=0&&(c[d]=!0);return c}(e.t,d),c),d):c&&UH(b,c,d)),e.t=b),this.j[a]=e,e}};let UJ=(a,b,c,d,e)=>a.ta(b,c,d,e),UK=(a,b,c,d,e)=>a.tr(b,c,d,e),UL=(a,b,c,d,e)=>a.ts(b,c,d,e),UM=(a,b,c,d,e)=>a.tt(b,c,d,e),UN="WORD",UO="UWORD",UP="ASCIINUMERICAL",UQ="ALPHANUMERICAL",UR="LOCALHOST",US="UTLD",UT="SCHEME",UU="SLASH_SCHEME",UV="OPENBRACE",UW="CLOSEBRACE",UX="OPENBRACKET",UY="CLOSEBRACKET",UZ="OPENPAREN",U$="CLOSEPAREN",U_="OPENANGLEBRACKET",U0="CLOSEANGLEBRACKET",U1="FULLWIDTHLEFTPAREN",U2="FULLWIDTHRIGHTPAREN",U3="LEFTCORNERBRACKET",U4="RIGHTCORNERBRACKET",U5="LEFTWHITECORNERBRACKET",U6="RIGHTWHITECORNERBRACKET",U7="FULLWIDTHLESSTHAN",U8="FULLWIDTHGREATERTHAN",U9="AMPERSAND",Va="APOSTROPHE",Vb="ASTERISK",Vc="BACKSLASH",Vd="BACKTICK",Ve="CARET",Vf="COLON",Vg="COMMA",Vh="DOLLAR",Vi="EQUALS",Vj="EXCLAMATION",Vk="HYPHEN",Vl="PERCENT",Vm="PIPE",Vn="PLUS",Vo="POUND",Vp="QUERY",Vq="QUOTE",Vr="FULLWIDTHMIDDLEDOT",Vs="SEMI",Vt="SLASH",Vu="TILDE",Vv="UNDERSCORE",Vw="EMOJI";var Vx=Object.freeze({__proto__:null,ALPHANUMERICAL:UQ,AMPERSAND:U9,APOSTROPHE:Va,ASCIINUMERICAL:UP,ASTERISK:Vb,AT:"AT",BACKSLASH:Vc,BACKTICK:Vd,CARET:Ve,CLOSEANGLEBRACKET:U0,CLOSEBRACE:UW,CLOSEBRACKET:UY,CLOSEPAREN:U$,COLON:Vf,COMMA:Vg,DOLLAR:Vh,DOT:"DOT",EMOJI:Vw,EQUALS:Vi,EXCLAMATION:Vj,FULLWIDTHGREATERTHAN:U8,FULLWIDTHLEFTPAREN:U1,FULLWIDTHLESSTHAN:U7,FULLWIDTHMIDDLEDOT:Vr,FULLWIDTHRIGHTPAREN:U2,HYPHEN:Vk,LEFTCORNERBRACKET:U3,LEFTWHITECORNERBRACKET:U5,LOCALHOST:UR,NL:"NL",NUM:"NUM",OPENANGLEBRACKET:U_,OPENBRACE:UV,OPENBRACKET:UX,OPENPAREN:UZ,PERCENT:Vl,PIPE:Vm,PLUS:Vn,POUND:Vo,QUERY:Vp,QUOTE:Vq,RIGHTCORNERBRACKET:U4,RIGHTWHITECORNERBRACKET:U6,SCHEME:UT,SEMI:Vs,SLASH:Vt,SLASH_SCHEME:UU,SYM:"SYM",TILDE:Vu,TLD:"TLD",UNDERSCORE:Vv,UTLD:US,UWORD:UO,WORD:UN,WS:"WS"});let Vy=/[a-z]/,Vz=/\p{L}/u,VA=/\p{Emoji}/u,VB=/\d/,VC=/\s/,VD=null,VE=null;function VF(a,b){let c=function(a){let b=[],c=a.length,d=0;for(;d<c;){let e,f=a.charCodeAt(d),g=f<55296||f>56319||d+1===c||(e=a.charCodeAt(d+1))<56320||e>57343?a[d]:a.slice(d,d+2);b.push(g),d+=g.length}return b}(b.replace(/[A-Z]/g,a=>a.toLowerCase())),d=c.length,e=[],f=0,g=0;for(;g<d;){let h=a,i=null,j=0,k=null,l=-1,m=-1;for(;g<d&&(i=h.go(c[g]));)(h=i).accepts()?(l=0,m=0,k=h):l>=0&&(l+=c[g].length,m++),j+=c[g].length,f+=c[g].length,g++;f-=l,g-=m,j-=l,e.push({t:k.t,v:b.slice(f-j,f),s:f-j,e:f})}return e}function VG(a,b,c,d,e){let f,g=b.length;for(let c=0;c<g-1;c++){let g=b[c];a.j[g]?f=a.j[g]:((f=new UI(d)).jr=e.slice(),a.j[g]=f),a=f}return(f=new UI(c)).jr=e.slice(),a.j[b[g-1]]=f,f}function VH(a){let b=[],c=[],d=0;for(;d<a.length;){let e=0;for(;"0123456789".indexOf(a[d+e])>=0;)e++;if(e>0){b.push(c.join(""));for(let b=parseInt(a.substring(d,d+e),10);b>0;b--)c.pop();d+=e}else c.push(a[d]),d++}return b}let VI={defaultProtocol:"http",events:null,format:VK,formatHref:VK,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function VJ(a,b=null){let c=Object.assign({},VI);a&&(c=Object.assign(c,a instanceof VJ?a.o:a));let d=c.ignoreTags,e=[];for(let a=0;a<d.length;a++)e.push(d[a].toUpperCase());this.o=c,b&&(this.defaultRender=b),this.ignoreTags=e}function VK(a){return a}function VL(a,b){this.t="token",this.v=a,this.tk=b}function VM(a,b){class c extends VL{constructor(b,c){super(b,c),this.t=a}}for(let a in b)c.prototype[a]=b[a];return c.t=a,c}VJ.prototype={o:VI,ignoreTags:[],defaultRender:a=>a,check(a){return this.get("validate",a.toString(),a)},get(a,b,c){let d=null!=b,e=this.o[a];return e&&("object"==typeof e?"function"==typeof(e=c.t in e?e[c.t]:VI[a])&&d&&(e=e(b,c)):"function"==typeof e&&d&&(e=e(b,c.t,c))),e},getObj(a,b,c){let d=this.o[a];return"function"==typeof d&&null!=b&&(d=d(b,c.t,c)),d},render(a){let b=a.render(this);return(this.get("render",null,a)||this.defaultRender)(b,a.t,a)}},VL.prototype={isLink:!1,toString(){return this.v},toHref(a){return this.toString()},toFormattedString(a){let b=this.toString(),c=a.get("truncate",b,this),d=a.get("format",b,this);return c&&d.length>c?d.substring(0,c)+"…":d},toFormattedHref(a){return a.get("formatHref",this.toHref(a.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(a=VI.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(a),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(a){return{type:this.t,value:this.toFormattedString(a),isLink:this.isLink,href:this.toFormattedHref(a),start:this.startIndex(),end:this.endIndex()}},validate(a){return a.get("validate",this.toString(),this)},render(a){let b=this.toHref(a.get("defaultProtocol")),c=a.get("formatHref",b,this),d=a.get("tagName",b,this),e=this.toFormattedString(a),f={},g=a.get("className",b,this),h=a.get("target",b,this),i=a.get("rel",b,this),j=a.getObj("attributes",b,this),k=a.getObj("events",b,this);return f.href=c,g&&(f.class=g),h&&(f.target=h),i&&(f.rel=i),j&&Object.assign(f,j),{tagName:d,attributes:f,content:e,eventListeners:k}}};let VN=VM("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),VO=VM("text"),VP=VM("nl"),VQ=VM("url",{isLink:!0,toHref(a=VI.defaultProtocol){return this.hasProtocol()?this.v:`${a}://${this.v}`},hasProtocol(){let a=this.tk;return a.length>=2&&a[0].t!==UR&&a[1].t===Vf}}),VR=a=>new UI(a);function VS(a,b,c){let d=c[0].s,e=c[c.length-1].e;return new a(b.slice(d,e),c)}let VT="undefined"!=typeof console&&console&&console.warn||(()=>{}),VU={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function VV(a,b=!1){if(VU.initialized&&VT(`linkifyjs: already initialized - will not register custom scheme "${a}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(a))throw Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);VU.customSchemes.push([a,b])}function VW(a){return VU.initialized||function(){VU.scanner=function(a=[]){let b={};UI.groups=b;let c=new UI;null==VD&&(VD=VH("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==VE&&(VE=VH("ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2")),UM(c,"'",Va),UM(c,"{",UV),UM(c,"}",UW),UM(c,"[",UX),UM(c,"]",UY),UM(c,"(",UZ),UM(c,")",U$),UM(c,"<",U_),UM(c,">",U0),UM(c,"（",U1),UM(c,"）",U2),UM(c,"「",U3),UM(c,"」",U4),UM(c,"『",U5),UM(c,"』",U6),UM(c,"＜",U7),UM(c,"＞",U8),UM(c,"&",U9),UM(c,"*",Vb),UM(c,"@","AT"),UM(c,"`",Vd),UM(c,"^",Ve),UM(c,":",Vf),UM(c,",",Vg),UM(c,"$",Vh),UM(c,".","DOT"),UM(c,"=",Vi),UM(c,"!",Vj),UM(c,"-",Vk),UM(c,"%",Vl),UM(c,"|",Vm),UM(c,"+",Vn),UM(c,"#",Vo),UM(c,"?",Vp),UM(c,'"',Vq),UM(c,"/",Vt),UM(c,";",Vs),UM(c,"~",Vu),UM(c,"_",Vv),UM(c,"\\",Vc),UM(c,"・",Vr);let d=UK(c,VB,"NUM",{[Uz]:!0});UK(d,VB,d);let e=UK(d,Vy,UP,{[UC]:!0}),f=UK(d,Vz,UQ,{[UD]:!0}),g=UK(c,Vy,UN,{[UA]:!0});UK(g,VB,e),UK(g,Vy,g),UK(e,VB,e),UK(e,Vy,e);let h=UK(c,Vz,UO,{[UB]:!0});UK(h,Vy),UK(h,VB,f),UK(h,Vz,h),UK(f,VB,f),UK(f,Vy),UK(f,Vz,f);let i=UM(c,"\n","NL",{[UG]:!0}),j=UM(c,"\r","WS",{[UG]:!0}),k=UK(c,VC,"WS",{[UG]:!0});UM(c,"￼",k),UM(j,"\n",i),UM(j,"￼",k),UK(j,VC,k),UM(k,"\r"),UM(k,"\n"),UK(k,VC,k),UM(k,"￼",k);let l=UK(c,VA,Vw,{[UF]:!0});UM(l,"#"),UK(l,VA,l),UM(l,"️",l);let m=UM(l,"‍");UM(m,"#"),UK(m,VA,l);let n=[[Vy,g],[VB,e]],o=[[Vy,null],[Vz,h],[VB,f]];for(let a=0;a<VD.length;a++)VG(c,VD[a],"TLD",UN,n);for(let a=0;a<VE.length;a++)VG(c,VE[a],US,UO,o);UH("TLD",{tld:!0,ascii:!0},b),UH(US,{utld:!0,alpha:!0},b),VG(c,"file",UT,UN,n),VG(c,"mailto",UT,UN,n),VG(c,"http",UU,UN,n),VG(c,"https",UU,UN,n),VG(c,"ftp",UU,UN,n),VG(c,"ftps",UU,UN,n),UH(UT,{scheme:!0,ascii:!0},b),UH(UU,{slashscheme:!0,ascii:!0},b),a=a.sort((a,b)=>a[0]>b[0]?1:-1);for(let b=0;b<a.length;b++){let d=a[b][0],e=a[b][1]?{scheme:!0}:{slashscheme:!0};d.indexOf("-")>=0?e[UE]=!0:Vy.test(d)?VB.test(d)?e[UC]=!0:e[UA]=!0:e[Uz]=!0,UL(c,d,d,e)}return UL(c,"localhost",UR,{ascii:!0}),c.jd=new UI("SYM"),{start:c,tokens:Object.assign({groups:b},Vx)}}(VU.customSchemes);for(let a=0;a<VU.tokenQueue.length;a++)VU.tokenQueue[a][1]({scanner:VU.scanner});VU.parser=function({groups:a}){let b=a.domain.concat([U9,Vb,"AT",Vc,Vd,Ve,Vh,Vi,Vk,"NUM",Vl,Vm,Vn,Vo,Vt,"SYM",Vu,Vv]),c=[Va,Vf,Vg,"DOT",Vj,Vl,Vp,Vq,Vs,U_,U0,UV,UW,UY,UX,UZ,U$,U1,U2,U3,U4,U5,U6,U7,U8],d=[U9,Va,Vb,Vc,Vd,Ve,Vh,Vi,Vk,UV,UW,Vl,Vm,Vn,Vo,Vp,Vt,"SYM",Vu,Vv],e=VR(),f=UM(e,Vu);UJ(f,d,f),UJ(f,a.domain,f);let g=VR(),h=VR(),i=VR();UJ(e,a.domain,g),UJ(e,a.scheme,h),UJ(e,a.slashscheme,i),UJ(g,d,f),UJ(g,a.domain,g);let j=UM(g,"AT");UM(f,"AT",j),UM(h,"AT",j),UM(i,"AT",j);let k=UM(f,"DOT");UJ(k,d,f),UJ(k,a.domain,f);let l=VR();UJ(j,a.domain,l),UJ(l,a.domain,l);let m=UM(l,"DOT");UJ(m,a.domain,l);let n=VR(VN);UJ(m,a.tld,n),UJ(m,a.utld,n),UM(j,UR,n);let o=UM(l,Vk);UM(o,Vk,o),UJ(o,a.domain,l),UJ(n,a.domain,l),UM(n,"DOT",m),UM(n,Vk,o),UJ(UM(n,Vf),a.numeric,VN);let p=UM(g,Vk),q=UM(g,"DOT");UM(p,Vk,p),UJ(p,a.domain,g),UJ(q,d,f),UJ(q,a.domain,g);let r=VR(VQ);UJ(q,a.tld,r),UJ(q,a.utld,r),UJ(r,a.domain,g),UJ(r,d,f),UM(r,"DOT",q),UM(r,Vk,p),UM(r,"AT",j);let s=UM(r,Vf),t=VR(VQ);UJ(s,a.numeric,t);let u=VR(VQ),v=VR();UJ(u,b,u),UJ(u,c,v),UJ(v,b,u),UJ(v,c,v),UM(r,Vt,u),UM(t,Vt,u);let w=UM(h,Vf),y=UM(i,Vf),z=UM(y,Vt),A=UM(z,Vt);UJ(h,a.domain,g),UM(h,"DOT",q),UM(h,Vk,p),UJ(i,a.domain,g),UM(i,"DOT",q),UM(i,Vk,p),UJ(w,a.domain,u),UM(w,Vt,u),UM(w,Vp,u),UJ(A,a.domain,u),UJ(A,b,u),UM(A,Vt,u);let B=[[UV,UW],[UX,UY],[UZ,U$],[U_,U0],[U1,U2],[U3,U4],[U5,U6],[U7,U8]];for(let a=0;a<B.length;a++){let[d,e]=B[a],f=UM(u,d);UM(v,d,f),UM(f,e,u);let g=VR(VQ);UJ(f,b,g);let h=VR();UJ(f,c),UJ(g,b,g),UJ(g,c,h),UJ(h,b,g),UJ(h,c,h),UM(g,e,u),UM(h,e,u)}return UM(e,UR,r),UM(e,"NL",VP),{start:e,tokens:Vx}}(VU.scanner.tokens);for(let a=0;a<VU.pluginQueue.length;a++)VU.pluginQueue[a][1]({scanner:VU.scanner,parser:VU.parser});VU.initialized=!0}(),function(a,b,c){let d=c.length,e=0,f=[],g=[];for(;e<d;){let h=a,i=null,j=null,k=0,l=null,m=-1;for(;e<d&&!(i=h.go(c[e].t));)g.push(c[e++]);for(;e<d&&(j=i||h.go(c[e].t));)i=null,(h=j).accepts()?(m=0,l=h):m>=0&&m++,e++,k++;if(m<0)(e-=k)<d&&(g.push(c[e]),e++);else{g.length>0&&(f.push(VS(VO,b,g)),g=[]),e-=m,k-=m;let a=l.t,d=c.slice(e-k,e);f.push(VS(a,b,d))}}return g.length>0&&f.push(VS(VO,b,g)),f}(VU.parser.start,a,VF(VU.scanner.start,a))}function VX(a,b=null,c=null){if(b&&"object"==typeof b){if(c)throw Error(`linkifyjs: Invalid link type ${b}; must be a string`);c=b,b=null}let d=new VJ(c),e=VW(a),f=[];for(let a=0;a<e.length;a++){let c=e[a];c.isLink&&(!b||c.t===b)&&d.check(c)&&f.push(c.toFormattedObject(d))}return f}VW.scan=VF;var VY="[\0-   ᠎ -\u2029 　]",VZ=new RegExp(VY),V$=RegExp(`${VY}$`),V_=RegExp(VY,"g");function V0(a,b){let c=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return b&&b.forEach(a=>{let b="string"==typeof a?a:a.scheme;b&&c.push(b)}),!a||a.replace(V_,"").match(RegExp(`^(?:(?:${c.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var V1=TE.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(a=>{"string"==typeof a?VV(a):VV(a.scheme,a.optionalSlashes)})},onDestroy(){UI.groups={},VU.scanner=null,VU.parser=null,VU.tokenQueue=[],VU.pluginQueue=[],VU.customSchemes=[],VU.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(a,b)=>!!V0(a,b.protocols),validate:a=>!!a,shouldAutoLink:a=>!!a}),addAttributes(){return{href:{default:null,parseHTML:a=>a.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:a=>{let b=a.getAttribute("href");return!!b&&!!this.options.isAllowedUri(b,{defaultValidate:a=>!!V0(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&null}}]},renderHTML({HTMLAttributes:a}){return this.options.isAllowedUri(a.href,{defaultValidate:a=>!!V0(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",SV(this.options.HTMLAttributes,a),0]:["a",SV(this.options.HTMLAttributes,{...a,href:""}),0]},markdownTokenName:"link",parseMarkdown:(a,b)=>b.applyMark("link",b.parseInline(a.tokens||[]),{href:a.href,title:a.title||null}),renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.href)||"",e=b.renderChildren(a);return`[${e}](${d})`},addCommands(){return{setLink:a=>({chain:b})=>{let{href:c}=a;return!!this.options.isAllowedUri(c,{defaultValidate:a=>!!V0(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&b().setMark(this.name,a).setMeta("preventAutolink",!0).run()},toggleLink:a=>({chain:b})=>{let{href:c}=a||{};return(!c||!!this.options.isAllowedUri(c,{defaultValidate:a=>!!V0(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&b().toggleMark(this.name,a,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:a})=>a().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[T8({find:a=>{let b=[];if(a){let{protocols:c,defaultProtocol:d}=this.options,e=VX(a).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:a=>!!V0(a,c),protocols:c,defaultProtocol:d}));e.length&&e.forEach(a=>{this.options.shouldAutoLink(a.value)&&b.push({text:a.value,data:{href:a.href},index:a.start})})}return b},type:this.type,getAttributes:a=>{var b;return{href:null==(b=a.data)?void 0:b.href}}})]},addProseMirrorPlugins(){var a,b,c;let d=[],{protocols:e,defaultProtocol:f}=this.options;return this.options.autolink&&d.push((a={type:this.type,defaultProtocol:this.options.defaultProtocol,validate:a=>this.options.isAllowedUri(a,{defaultValidate:a=>!!V0(a,e),protocols:e,defaultProtocol:f}),shouldAutoLink:this.options.shouldAutoLink},new un({key:new uq("autolink"),appendTransaction:(b,c,d)=>{let e=b.some(a=>a.docChanged)&&!c.doc.eq(d.doc),f=b.some(a=>a.getMeta("preventAutolink"));if(!e||f)return;let{tr:g}=d;if(S3(SM(c.doc,[...b])).forEach(({newRange:b})=>{var c,e;let f,h,i,j=(c=d.doc,e=a=>a.isTextblock,i=[],c.nodesBetween(b.from,b.to,(a,b)=>{e(a)&&i.push({node:a,pos:b})}),i);if(j.length>1)f=j[0],h=d.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ");else if(j.length){let a=d.doc.textBetween(b.from,b.to," "," ");if(!V$.test(a))return;f=j[0],h=d.doc.textBetween(f.pos,b.to,void 0," ")}if(f&&h){let b=h.split(VZ).filter(Boolean);if(b.length<=0)return!1;let c=b[b.length-1],e=f.pos+h.lastIndexOf(c);if(!c)return!1;let i=VW(c).map(b=>b.toObject(a.defaultProtocol));if(!(1===i.length?i[0].isLink:3===i.length&&!!i[1].isLink&&["()","[]"].includes(i[0].value+i[2].value)))return!1;i.filter(a=>a.isLink).map(a=>({...a,from:e+a.start+1,to:e+a.end+1})).filter(a=>!d.schema.marks.code||!d.doc.rangeHasMark(a.from,a.to,d.schema.marks.code)).filter(b=>a.validate(b.value)).filter(b=>a.shouldAutoLink(b.value)).forEach(b=>{S4(b.from,b.to,d.doc).some(b=>b.mark.type===a.type)||g.addMark(b.from,b.to,a.type.create({href:b.href}))})}}),g.steps.length)return g}}))),!0===this.options.openOnClick&&d.push((b={type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection},new un({key:new uq("handleClickLink"),props:{handleClick:(a,c,d)=>{var e,f;if(0!==d.button||!a.editable)return!1;let g=null;if(d.target instanceof HTMLAnchorElement)g=d.target;else{let a=d.target,b=[];for(;"DIV"!==a.nodeName;)b.push(a),a=a.parentNode;g=b.find(a=>"A"===a.nodeName)}if(!g)return!1;let h=S2(a.state,b.type.name),i=null!=(e=null==g?void 0:g.href)?e:h.href,j=null!=(f=null==g?void 0:g.target)?f:h.target;return b.enableClickSelection&&b.editor.commands.extendMarkRange(b.type.name),!!g&&!!i&&(window.open(i,j),!0)}}}))),this.options.linkOnPaste&&d.push((c={editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink},new un({key:new uq("handlePasteLink"),props:{handlePaste:(a,b,d)=>{let{shouldAutoLink:e}=c,{state:f}=a,{selection:g}=f,{empty:h}=g;if(h)return!1;let i="";d.content.forEach(a=>{i+=a.textContent});let j=VX(i,{defaultProtocol:c.defaultProtocol}).find(a=>a.isLink&&a.value===i);return!!i&&!!j&&(void 0===e||!!e(j.href))&&c.editor.commands.setMark(c.type,{href:j.href})}}}))),d}}),V2=Object.defineProperty,V3="textStyle",V4=/^\s*([-+*])\s$/,V5=T7.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:a}){return["ul",SV(this.options.HTMLAttributes,a),0]},markdownTokenName:"list",parseMarkdown:(a,b)=>"list"!==a.type||a.ordered?[]:{type:"bulletList",content:a.items?b.parseChildren(a.items):[]},renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:a,chain:b})=>this.options.keepAttributes?b().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(V3)).run():a.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let a=TZ({find:V4,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(a=TZ({find:V4,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(V3),editor:this.editor})),[a]}}),V6=T7.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:a}){return["li",SV(this.options.HTMLAttributes,a),0]},markdownTokenName:"list_item",parseMarkdown:(a,b)=>{if("list_item"!==a.type)return[];let c=[];if(a.tokens&&a.tokens.length>0)if(a.tokens.some(a=>"paragraph"===a.type))c=b.parseChildren(a.tokens);else{let d=a.tokens[0];if(d&&"text"===d.type&&d.tokens&&d.tokens.length>0){if(c=[{type:"paragraph",content:b.parseInline(d.tokens)}],a.tokens.length>1){let d=a.tokens.slice(1),e=b.parseChildren(d);c.push(...e)}}else c=b.parseChildren(a.tokens)}return 0===c.length&&(c=[{type:"paragraph",content:[]}]),{type:"listItem",content:c}},renderMarkdown:(a,b,c)=>T6(a,b,a=>"bulletList"===a.parentType?"- ":"orderedList"===a.parentType?`${a.index+1}. `:"- ",c),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),V7={},V8={findListItemPos:()=>Wa,getNextListDepth:()=>Wb,handleBackspace:()=>Wf,handleDelete:()=>Wi,hasListBefore:()=>Wc,hasListItemAfter:()=>Wj,hasListItemBefore:()=>Wd,listItemHasSubList:()=>We,nextListIsDeeper:()=>Wg,nextListIsHigher:()=>Wh};for(var V9 in V8)V2(V7,V9,{get:V8[V9],enumerable:!0});var Wa=(a,b)=>{let{$from:c}=b.selection,d=RY(a,b.schema),e=c.depth,f=c.pos,g=null;for(;e>0&&null===g;)c.node(e).type===d?g=e:(e-=1,f-=1);return null===g?null:{$pos:b.doc.resolve(f),depth:g}},Wb=(a,b)=>{let c=Wa(a,b);if(!c)return!1;let[,d]=((a,b,c,d=20)=>{let e=a.doc.resolve(c),f=d,g=null;for(;f>0&&null===g;){let a=e.node(f);(null==a?void 0:a.type.name)===b?g=a:f-=1}return[g,f]})(b,a,c.$pos.pos+4);return d},Wc=(a,b,c)=>{let{$anchor:d}=a.selection,e=Math.max(0,d.pos-2),f=a.doc.resolve(e).node();return!!f&&!!c.includes(f.type.name)},Wd=(a,b)=>{var c;let{$anchor:d}=b.selection,e=b.doc.resolve(d.pos-2);return 0!==e.index()&&(null==(c=e.nodeBefore)?void 0:c.type.name)===a},We=(a,b,c)=>{if(!c)return!1;let d=RY(a,b.schema),e=!1;return c.descendants(a=>{a.type===d&&(e=!0)}),e},Wf=(a,b,c)=>{if(a.commands.undoInputRule())return!0;if(a.state.selection.from!==a.state.selection.to)return!1;if(!Su(a.state,b)&&Wc(a.state,b,c)){let{$anchor:c}=a.state.selection,d=a.state.doc.resolve(c.before()-1),e=[];d.node().descendants((a,c)=>{a.type.name===b&&e.push({node:a,pos:c})});let f=e.at(-1);if(!f)return!1;let g=a.state.doc.resolve(d.start()+f.pos+1);return a.chain().cut({from:c.start()-1,to:c.end()+1},g.end()).joinForward().run()}if(!Su(a.state,b)||!(a=>{let{$from:b,$to:c}=a.selection;return!(b.parentOffset>0)&&b.pos===c.pos})(a.state))return!1;let d=Wa(b,a.state);if(!d)return!1;let e=a.state.doc.resolve(d.$pos.pos-2).node(d.depth),f=We(b,a.state,e);return Wd(b,a.state)&&!f?a.commands.joinItemBackward():a.chain().liftListItem(b).run()},Wg=(a,b)=>{let c=Wb(a,b),d=Wa(a,b);return!!d&&!!c&&c>d.depth},Wh=(a,b)=>{let c=Wb(a,b),d=Wa(a,b);return!!d&&!!c&&c<d.depth},Wi=(a,b)=>{if(!Su(a.state,b)||!((a,b)=>{let{$from:c,$to:d,$anchor:e}=a.selection;if(b){let c=SN(a=>a.type.name===b)(a.selection);if(!c)return!1;let d=a.doc.resolve(c.pos+1);return e.pos+1===d.end()}return!(d.parentOffset<d.parent.nodeSize-2)&&c.pos===d.pos})(a.state,b))return!1;let{selection:c}=a.state,{$from:d,$to:e}=c;return!(!c.empty&&d.sameParent(e))&&(Wg(b,a.state)?a.chain().focus(a.state.selection.from+4).lift(b).joinBackward().run():Wh(b,a.state)?a.chain().joinForward().joinBackward().run():a.commands.joinItemForward())},Wj=(a,b)=>{var c;let{$anchor:d}=b.selection,e=b.doc.resolve(d.pos-d.parentOffset-2);return e.index()!==e.parent.childCount-1&&(null==(c=e.nodeAfter)?void 0:c.type.name)===a},Wk=TI.create({name:"listKeymap",addOptions:()=>({listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}),addKeyboardShortcuts(){return{Delete:({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c})=>{void 0!==a.state.schema.nodes[c]&&Wi(a,c)&&(b=!0)}),b},"Mod-Delete":({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c})=>{void 0!==a.state.schema.nodes[c]&&Wi(a,c)&&(b=!0)}),b},Backspace:({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c,wrapperNames:d})=>{void 0!==a.state.schema.nodes[c]&&Wf(a,c,d)&&(b=!0)}),b},"Mod-Backspace":({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c,wrapperNames:d})=>{void 0!==a.state.schema.nodes[c]&&Wf(a,c,d)&&(b=!0)}),b}}}}),Wl=/^(\s*)(\d+)\.\s+(.*)$/,Wm=/^\s/,Wn="textStyle",Wo=/^(\d+)\.\s$/,Wp=T7.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:a=>a.hasAttribute("start")?parseInt(a.getAttribute("start")||"",10):1},type:{default:null,parseHTML:a=>a.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:a}){let{start:b,...c}=a;return 1===b?["ol",SV(this.options.HTMLAttributes,c),0]:["ol",SV(this.options.HTMLAttributes,a),0]},markdownTokenName:"list",parseMarkdown:(a,b)=>{var c;if("list"!==a.type||!a.ordered)return[];let d=a.start||1,e=a.items?(c=a.items,c.map(a=>{if("list_item"!==a.type)return b.parseChildren([a])[0];let c=[];return a.tokens&&a.tokens.length>0&&a.tokens.forEach(a=>{if("paragraph"===a.type||"list"===a.type||"blockquote"===a.type||"code"===a.type)c.push(...b.parseChildren([a]));else if("text"===a.type&&a.tokens){let d=b.parseChildren([a]);c.push({type:"paragraph",content:d})}else{let d=b.parseChildren([a]);d.length>0&&c.push(...d)}}),{type:"listItem",content:c}})):[];return 1!==d?{type:"orderedList",attrs:{start:d},content:e}:{type:"orderedList",content:e}},renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownTokenizer:{name:"orderedList",level:"block",start:a=>{let b=a.match(/^(\s*)(\d+)\.\s+/),c=null==b?void 0:b.index;return void 0!==c?c:-1},tokenize:(a,b,c)=>{var d;let e=a.split("\n"),[f,g]=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c],f=e.match(Wl);if(!f)break;let[,g,h,i]=f,j=g.length,k=i,l=c+1,m=[e];for(;l<a.length;){let b=a[l];if(b.match(Wl))break;if(""===b.trim())m.push(b),k+="\n",l+=1;else if(b.match(Wm))m.push(b),k+=`
${b.slice(j+2)}`,l+=1;else break}b.push({indent:j,number:parseInt(h,10),content:k.trim(),raw:m.join("\n")}),d=l,c=l}return[b,d]}(e);if(0===f.length)return;let h=function a(b,c,d){var e;let f=[],g=0;for(;g<b.length;){let h=b[g];if(h.indent===c){let i=h.content.split("\n"),j=(null==(e=i[0])?void 0:e.trim())||"",k=[];j&&k.push({type:"paragraph",raw:j,tokens:d.inlineTokens(j)});let l=i.slice(1).join("\n").trim();if(l){let a=d.blockTokens(l);k.push(...a)}let m=g+1,n=[];for(;m<b.length&&b[m].indent>c;)n.push(b[m]),m+=1;if(n.length>0){let b=Math.min(...n.map(a=>a.indent)),c=a(n,b,d);k.push({type:"list",ordered:!0,start:n[0].number,items:c,raw:n.map(a=>a.raw).join("\n")})}f.push({type:"list_item",raw:h.raw,tokens:k}),g=m}else g+=1}return f}(f,0,c);if(0!==h.length)return{type:"list",ordered:!0,start:(null==(d=f[0])?void 0:d.number)||1,items:h,raw:e.slice(0,g).join("\n")}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:a,chain:b})=>this.options.keepAttributes?b().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(Wn)).run():a.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let a=TZ({find:Wo,type:this.type,getAttributes:a=>({start:+a[1]}),joinPredicate:(a,b)=>b.childCount+b.attrs.start===+a[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(a=TZ({find:Wo,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:a=>({start:+a[1],...this.editor.getAttributes(Wn)}),joinPredicate:(a,b)=>b.childCount+b.attrs.start===+a[1],editor:this.editor})),[a]}}),Wq=/^\s*(\[([( |x])?\])\s$/,Wr=T7.create({name:"taskItem",addOptions:()=>({nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}),content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes:()=>({checked:{default:!1,keepOnSplit:!1,parseHTML:a=>{let b=a.getAttribute("data-checked");return""===b||"true"===b},renderHTML:a=>({"data-checked":a.checked})}}),parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:a,HTMLAttributes:b}){return["li",SV(this.options.HTMLAttributes,b,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:a.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(a,b)=>{let c=[];if(a.tokens&&a.tokens.length>0?c.push(b.createNode("paragraph",{},b.parseInline(a.tokens))):a.text?c.push(b.createNode("paragraph",{},[b.createNode("text",{text:a.text})])):c.push(b.createNode("paragraph",{},[])),a.nestedTokens&&a.nestedTokens.length>0){let d=b.parseChildren(a.nestedTokens);c.push(...d)}return b.createNode("taskItem",{checked:a.checked||!1},c)},renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.checked)?"x":" ";return T6(a,b,`- [${d}] `)},addKeyboardShortcuts(){let a={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...a,Tab:()=>this.editor.commands.sinkListItem(this.name)}:a},addNodeView(){return({node:a,HTMLAttributes:b,getPos:c,editor:d})=>{let e=document.createElement("li"),f=document.createElement("label"),g=document.createElement("span"),h=document.createElement("input"),i=document.createElement("div"),j=a=>{var b,c;h.ariaLabel=(null==(c=null==(b=this.options.a11y)?void 0:b.checkboxLabel)?void 0:c.call(b,a,h.checked))||`Task item checkbox for ${a.textContent||"empty task item"}`};return j(a),f.contentEditable="false",h.type="checkbox",h.addEventListener("mousedown",a=>a.preventDefault()),h.addEventListener("change",b=>{if(!d.isEditable&&!this.options.onReadOnlyChecked){h.checked=!h.checked;return}let{checked:e}=b.target;d.isEditable&&"function"==typeof c&&d.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:a})=>{let b=c();if("number"!=typeof b)return!1;let d=a.doc.nodeAt(b);return a.setNodeMarkup(b,void 0,{...null==d?void 0:d.attrs,checked:e}),!0}).run(),d.isEditable||!this.options.onReadOnlyChecked||this.options.onReadOnlyChecked(a,e)||(h.checked=!h.checked)}),Object.entries(this.options.HTMLAttributes).forEach(([a,b])=>{e.setAttribute(a,b)}),e.dataset.checked=a.attrs.checked,h.checked=a.attrs.checked,f.append(h,g),e.append(f,i),Object.entries(b).forEach(([a,b])=>{e.setAttribute(a,b)}),{dom:e,contentDOM:i,update:a=>a.type===this.type&&(e.dataset.checked=a.attrs.checked,h.checked=a.attrs.checked,j(a),!0)}}},addInputRules(){return[TZ({find:Wq,type:this.type,getAttributes:a=>({checked:"x"===a[a.length-1]})})]}}),Ws=T7.create({name:"taskList",addOptions:()=>({itemTypeName:"taskItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:a}){return["ul",SV(this.options.HTMLAttributes,a,{"data-type":this.name}),0]},parseMarkdown:(a,b)=>b.createNode("taskList",{},b.parseChildren(a.items||[])),renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownTokenizer:{name:"taskList",level:"block",start(a){var b;let c=null==(b=a.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))?void 0:b.index;return void 0!==c?c:-1},tokenize(a,b,c){let d=a=>{let b=T5(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:"x"===a[3].toLowerCase()}),createToken:(a,b)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:c.inlineTokens(a.mainContent),nestedTokens:b}),customNestedParser:d},c);return b?[{type:"taskList",raw:b.raw,items:b.items}]:c.blockTokens(a)},e=T5(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:"x"===a[3].toLowerCase()}),createToken:(a,b)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:c.inlineTokens(a.mainContent),nestedTokens:b}),customNestedParser:d},c);if(e)return{type:"taskList",raw:e.raw,items:e.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:a})=>a.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});TI.create({name:"listKit",addExtensions(){let a=[];return!1!==this.options.bulletList&&a.push(V5.configure(this.options.bulletList)),!1!==this.options.listItem&&a.push(V6.configure(this.options.listItem)),!1!==this.options.listKeymap&&a.push(Wk.configure(this.options.listKeymap)),!1!==this.options.orderedList&&a.push(Wp.configure(this.options.orderedList)),!1!==this.options.taskItem&&a.push(Wr.configure(this.options.taskItem)),!1!==this.options.taskList&&a.push(Ws.configure(this.options.taskList)),a}});var Wt=T7.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:a}){return["p",SV(this.options.HTMLAttributes,a),0]},parseMarkdown:(a,b)=>{let c=a.tokens||[];return 1===c.length&&"image"===c[0].type?b.parseChildren([c[0]]):b.createNode("paragraph",void 0,b.parseInline(c))},renderMarkdown:(a,b)=>a&&Array.isArray(a.content)?b.renderChildren(a.content):"",addCommands(){return{setParagraph:()=>({commands:a})=>a.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Wu=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Wv=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Ww=TE.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:a=>!!a.includes("line-through")&&{}}],renderHTML({HTMLAttributes:a}){return["s",SV(this.options.HTMLAttributes,a),0]},markdownTokenName:"del",parseMarkdown:(a,b)=>b.applyMark("strike",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`~~${b.renderChildren(a)}~~`,addCommands(){return{setStrike:()=>({commands:a})=>a.setMark(this.name),toggleStrike:()=>({commands:a})=>a.toggleMark(this.name),unsetStrike:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[TX({find:Wu,type:this.type})]},addPasteRules(){return[T8({find:Wv,type:this.type})]}}),Wx=T7.create({name:"text",group:"inline",parseMarkdown:a=>({type:"text",text:a.text||""}),renderMarkdown:a=>a.text||""}),Wy=TE.create({name:"underline",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:a=>!!a.includes("underline")&&{}}],renderHTML({HTMLAttributes:a}){return["u",SV(this.options.HTMLAttributes,a),0]},parseMarkdown(a,b){return b.applyMark(this.name||"underline",b.parseInline(a.tokens||[]))},renderMarkdown:(a,b)=>`++${b.renderChildren(a)}++`,markdownTokenizer:{name:"underline",level:"inline",start:a=>a.indexOf("++"),tokenize(a,b,c){let d=/^(\+\+)([\s\S]+?)(\+\+)/.exec(a);if(!d)return;let e=d[2].trim();return{type:"underline",raw:d[0],text:e,tokens:c.inlineTokens(e)}}},addCommands(){return{setUnderline:()=>({commands:a})=>a.setMark(this.name),toggleUnderline:()=>({commands:a})=>a.toggleMark(this.name),unsetUnderline:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});class Wz{constructor(a,b){var c;this.editorView=a,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!=(c=b.width)?c:1,this.color=!1===b.color?void 0:b.color||"black",this.class=b.class,this.handlers=["dragover","dragend","drop","dragleave"].map(b=>{let c=a=>{this[b](a)};return a.dom.addEventListener(b,c),{name:b,handler:c}})}destroy(){this.handlers.forEach(({name:a,handler:b})=>this.editorView.dom.removeEventListener(a,b))}update(a,b){null!=this.cursorPos&&b.doc!=a.state.doc&&(this.cursorPos>a.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(a){a!=this.cursorPos&&(this.cursorPos=a,null==a?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let a,b,c=this.editorView.state.doc.resolve(this.cursorPos),d=!c.parent.inlineContent,e,f=this.editorView.dom,g=f.getBoundingClientRect(),h=g.width/f.offsetWidth,i=g.height/f.offsetHeight;if(d){let a=c.nodeBefore,b=c.nodeAfter;if(a||b){let c=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(c){let d=c.getBoundingClientRect(),f=a?d.bottom:d.top;a&&b&&(f=(f+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*i;e={left:d.left,right:d.right,top:f-g,bottom:f+g}}}}if(!e){let a=this.editorView.coordsAtPos(this.cursorPos),b=this.width/2*h;e={left:a.left-b,right:a.left+b,top:a.top,bottom:a.bottom}}let j=this.editorView.dom.offsetParent;if(!this.element&&(this.element=j.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",d),this.element.classList.toggle("prosemirror-dropcursor-inline",!d),j&&(j!=document.body||"static"!=getComputedStyle(j).position)){let c=j.getBoundingClientRect(),d=c.width/j.offsetWidth,e=c.height/j.offsetHeight;a=c.left-j.scrollLeft*d,b=c.top-j.scrollTop*e}else a=-pageXOffset,b=-pageYOffset;this.element.style.left=(e.left-a)/h+"px",this.element.style.top=(e.top-b)/i+"px",this.element.style.width=(e.right-e.left)/h+"px",this.element.style.height=(e.bottom-e.top)/i+"px"}scheduleRemoval(a){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),a)}dragover(a){if(!this.editorView.editable)return;let b=this.editorView.posAtCoords({left:a.clientX,top:a.clientY}),c=b&&b.inside>=0&&this.editorView.state.doc.nodeAt(b.inside),d=c&&c.type.spec.disableDropCursor,e="function"==typeof d?d(this.editorView,b,a):d;if(b&&!e){let a=b.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let b=tT(this.editorView.state.doc,a,this.editorView.dragging.slice);null!=b&&(a=b)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(a){this.editorView.dom.contains(a.relatedTarget)||this.setCursor(null)}}class WA extends t5{constructor(a){super(a,a)}map(a,b){let c=a.resolve(b.map(this.head));return WA.valid(c)?new WA(c):t5.near(c)}content(){return sP.empty}eq(a){return a instanceof WA&&a.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for GapCursor.fromJSON");return new WA(a.resolve(b.pos))}getBookmark(){return new WB(this.anchor)}static valid(a){let b=a.parent;if(b.isTextblock||!function(a){for(let b=a.depth;b>=0;b--){let c=a.index(b),d=a.node(b);if(0==c){if(d.type.spec.isolating)return!0;continue}for(let a=d.child(c-1);;a=a.lastChild){if(0==a.childCount&&!a.inlineContent||WC(a.type))return!0;if(a.inlineContent)return!1}}return!0}(a)||!function(a){for(let b=a.depth;b>=0;b--){let c=a.indexAfter(b),d=a.node(b);if(c==d.childCount){if(d.type.spec.isolating)return!0;continue}for(let a=d.child(c);;a=a.firstChild){if(0==a.childCount&&!a.inlineContent||WC(a.type))return!0;if(a.inlineContent)return!1}}return!0}(a))return!1;let c=b.type.spec.allowGapCursor;if(null!=c)return c;let d=b.contentMatchAt(a.index()).defaultType;return d&&d.isTextblock}static findGapCursorFrom(a,b,c=!1){h:for(;;){if(!c&&WA.valid(a))return a;let d=a.pos,e=null;for(let c=a.depth;;c--){let f=a.node(c);if(b>0?a.indexAfter(c)<f.childCount:a.index(c)>0){e=f.child(b>0?a.indexAfter(c):a.index(c)-1);break}if(0==c)return null;d+=b;let g=a.doc.resolve(d);if(WA.valid(g))return g}for(;;){let f=b>0?e.firstChild:e.lastChild;if(!f){if(e.isAtom&&!e.isText&&!ub.isSelectable(e)){a=a.doc.resolve(d+e.nodeSize*b),c=!1;continue h}break}e=f,d+=b;let g=a.doc.resolve(d);if(WA.valid(g))return g}return null}}}WA.prototype.visible=!1,WA.findFrom=WA.findGapCursorFrom,t5.jsonID("gapcursor",WA);class WB{constructor(a){this.pos=a}map(a){return new WB(a.map(this.pos))}resolve(a){let b=a.resolve(this.pos);return WA.valid(b)?new WA(b):t5.near(b)}}function WC(a){return a.isAtom||a.spec.isolating||a.spec.createGapCursor}let WD=w5({ArrowLeft:WE("horiz",-1),ArrowRight:WE("horiz",1),ArrowUp:WE("vert",-1),ArrowDown:WE("vert",1)});function WE(a,b){let c="vert"==a?b>0?"down":"up":b>0?"right":"left";return function(a,d,e){let f=a.selection,g=b>0?f.$to:f.$from,h=f.empty;if(f instanceof t9){if(!e.endOfTextblock(c)||0==g.depth)return!1;h=!1,g=a.doc.resolve(b>0?g.after():g.before())}let i=WA.findGapCursorFrom(g,b,h);return!!i&&(d&&d(a.tr.setSelection(new WA(i))),!0)}}function WF(a,b,c){if(!a||!a.editable)return!1;let d=a.state.doc.resolve(b);if(!WA.valid(d))return!1;let e=a.posAtCoords({left:c.clientX,top:c.clientY});return!(e&&e.inside>-1&&ub.isSelectable(a.state.doc.nodeAt(e.inside)))&&(a.dispatch(a.state.tr.setSelection(new WA(d))),!0)}function WG(a,b){if("insertCompositionText"!=b.inputType||!(a.state.selection instanceof WA))return!1;let{$from:c}=a.state.selection,d=c.parent.contentMatchAt(c.index()).findWrapping(a.state.schema.nodes.text);if(!d)return!1;let e=sJ.empty;for(let a=d.length-1;a>=0;a--)e=sJ.from(d[a].createAndFill(null,e));let f=a.state.tr.replace(c.pos,c.pos,new sP(e,0,0));return f.setSelection(t9.near(f.doc.resolve(c.pos+1))),a.dispatch(f),!1}function WH(a){if(!(a.selection instanceof WA))return null;let b=document.createElement("div");return b.className="ProseMirror-gapcursor",wu.create(a.doc,[wr.widget(a.selection.head,b,{key:"gapcursor"})])}var WI=function(){};WI.prototype.append=function(a){return a.length?(a=WI.from(a),!this.length&&a||a.length<200&&this.leafAppend(a)||this.length<200&&a.leafPrepend(this)||this.appendInner(a)):this},WI.prototype.prepend=function(a){return a.length?WI.from(a).append(this):this},WI.prototype.appendInner=function(a){return new WK(this,a)},WI.prototype.slice=function(a,b){return(void 0===a&&(a=0),void 0===b&&(b=this.length),a>=b)?WI.empty:this.sliceInner(Math.max(0,a),Math.min(this.length,b))},WI.prototype.get=function(a){if(!(a<0)&&!(a>=this.length))return this.getInner(a)},WI.prototype.forEach=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=this.length),b<=c?this.forEachInner(a,b,c,0):this.forEachInvertedInner(a,b,c,0)},WI.prototype.map=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=this.length);var d=[];return this.forEach(function(b,c){return d.push(a(b,c))},b,c),d},WI.from=function(a){return a instanceof WI?a:a&&a.length?new WJ(a):WI.empty};var WJ=function(a){function b(b){a.call(this),this.values=b}b.__proto__=a,b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b;var c={length:{configurable:!0},depth:{configurable:!0}};return b.prototype.flatten=function(){return this.values},b.prototype.sliceInner=function(a,c){return 0==a&&c==this.length?this:new b(this.values.slice(a,c))},b.prototype.getInner=function(a){return this.values[a]},b.prototype.forEachInner=function(a,b,c,d){for(var e=b;e<c;e++)if(!1===a(this.values[e],d+e))return!1},b.prototype.forEachInvertedInner=function(a,b,c,d){for(var e=b-1;e>=c;e--)if(!1===a(this.values[e],d+e))return!1},b.prototype.leafAppend=function(a){if(this.length+a.length<=200)return new b(this.values.concat(a.flatten()))},b.prototype.leafPrepend=function(a){if(this.length+a.length<=200)return new b(a.flatten().concat(this.values))},c.length.get=function(){return this.values.length},c.depth.get=function(){return 0},Object.defineProperties(b.prototype,c),b}(WI);WI.empty=new WJ([]);var WK=function(a){function b(b,c){a.call(this),this.left=b,this.right=c,this.length=b.length+c.length,this.depth=Math.max(b.depth,c.depth)+1}return b.__proto__=a,b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},b.prototype.getInner=function(a){return a<this.left.length?this.left.get(a):this.right.get(a-this.left.length)},b.prototype.forEachInner=function(a,b,c,d){var e=this.left.length;if(b<e&&!1===this.left.forEachInner(a,b,Math.min(c,e),d)||c>e&&!1===this.right.forEachInner(a,Math.max(b-e,0),Math.min(this.length,c)-e,d+e))return!1},b.prototype.forEachInvertedInner=function(a,b,c,d){var e=this.left.length;if(b>e&&!1===this.right.forEachInvertedInner(a,b-e,Math.max(c,e)-e,d+e)||c<e&&!1===this.left.forEachInvertedInner(a,Math.min(b,e),c,d))return!1},b.prototype.sliceInner=function(a,b){if(0==a&&b==this.length)return this;var c=this.left.length;return b<=c?this.left.slice(a,b):a>=c?this.right.slice(a-c,b-c):this.left.slice(a,c).append(this.right.slice(0,b-c))},b.prototype.leafAppend=function(a){var c=this.right.leafAppend(a);if(c)return new b(this.left,c)},b.prototype.leafPrepend=function(a){var c=this.left.leafPrepend(a);if(c)return new b(c,this.right)},b.prototype.appendInner=function(a){return this.left.depth>=Math.max(this.right.depth,a.depth)+1?new b(this.left,new b(this.right,a)):new b(this,a)},b}(WI);class WL{constructor(a,b){this.items=a,this.eventCount=b}popEvent(a,b){let c,d,e,f;if(0==this.eventCount)return null;let g=this.items.length;for(;;g--)if(this.items.get(g-1).selection){--g;break}b&&(d=(c=this.remapping(g,this.items.length)).maps.length);let h=a.tr,i=[],j=[];return this.items.forEach((a,b)=>{if(!a.step){c||(d=(c=this.remapping(g,b+1)).maps.length),d--,j.push(a);return}if(c){j.push(new WM(a.map));let b=a.step.map(c.slice(d)),e;b&&h.maybeStep(b).doc&&(e=h.mapping.maps[h.mapping.maps.length-1],i.push(new WM(e,void 0,void 0,i.length+j.length))),d--,e&&c.appendMap(e,d)}else h.maybeStep(a.step);if(a.selection)return e=c?a.selection.map(c.slice(d)):a.selection,f=new WL(this.items.slice(0,g).append(j.reverse().concat(i)),this.eventCount-1),!1},this.items.length,0),{remaining:f,transform:h,selection:e}}addTransform(a,b,c,d){var e,f;let g,h=[],i=this.eventCount,j=this.items,k=!d&&j.length?j.get(j.length-1):null;for(let c=0;c<a.steps.length;c++){let e=a.steps[c].invert(a.docs[c]),f=new WM(a.mapping.maps[c],e,b),g;(g=k&&k.merge(f))&&(f=g,c?h.pop():j=j.slice(0,j.length-1)),h.push(f),b&&(i++,b=void 0),d||(k=f)}let l=i-c.depth;return l>WO&&(e=j,f=l,e.forEach((a,b)=>{if(a.selection&&0==f--)return g=b,!1}),j=e.slice(g),i-=l),new WL(j.append(h),i)}remapping(a,b){let c=new tx;return this.items.forEach((b,d)=>{let e=null!=b.mirrorOffset&&d-b.mirrorOffset>=a?c.maps.length-b.mirrorOffset:void 0;c.appendMap(b.map,e)},a,b),c}addMaps(a){return 0==this.eventCount?this:new WL(this.items.append(a.map(a=>new WM(a))),this.eventCount)}rebased(a,b){if(!this.eventCount)return this;let c=[],d=Math.max(0,this.items.length-b),e=a.mapping,f=a.steps.length,g=this.eventCount;this.items.forEach(a=>{a.selection&&g--},d);let h=b;this.items.forEach(b=>{let d=e.getMirror(--h);if(null==d)return;f=Math.min(f,d);let i=e.maps[d];if(b.step){let f=a.steps[d].invert(a.docs[d]),j=b.selection&&b.selection.map(e.slice(h+1,d));j&&g++,c.push(new WM(i,f,j))}else c.push(new WM(i))},d);let i=[];for(let a=b;a<f;a++)i.push(new WM(e.maps[a]));let j=new WL(this.items.slice(0,d).append(i).append(c),g);return j.emptyItemCount()>500&&(j=j.compress(this.items.length-c.length)),j}emptyItemCount(){let a=0;return this.items.forEach(b=>{!b.step&&a++}),a}compress(a=this.items.length){let b=this.remapping(0,a),c=b.maps.length,d=[],e=0;return this.items.forEach((f,g)=>{if(g>=a)d.push(f),f.selection&&e++;else if(f.step){let a=f.step.map(b.slice(c)),g=a&&a.getMap();if(c--,g&&b.appendMap(g,c),a){let h=f.selection&&f.selection.map(b.slice(c));h&&e++;let i=new WM(g.invert(),a,h),j,k=d.length-1;(j=d.length&&d[k].merge(i))?d[k]=j:d.push(i)}}else f.map&&c--},this.items.length,0),new WL(WI.from(d.reverse()),e)}}WL.empty=new WL(WI.empty,0);class WM{constructor(a,b,c,d){this.map=a,this.step=b,this.selection=c,this.mirrorOffset=d}merge(a){if(this.step&&a.step&&!a.selection){let b=a.step.merge(this.step);if(b)return new WM(b.getMap().invert(),b,this.selection)}}}class WN{constructor(a,b,c,d,e){this.done=a,this.undone=b,this.prevRanges=c,this.prevTime=d,this.prevComposition=e}}let WO=20;function WP(a){let b=[];for(let c=a.length-1;c>=0&&0==b.length;c--)a[c].forEach((a,c,d,e)=>b.push(d,e));return b}function WQ(a,b){if(!a)return null;let c=[];for(let d=0;d<a.length;d+=2){let e=b.map(a[d],1),f=b.map(a[d+1],-1);e<=f&&c.push(e,f)}return c}let WR=!1,WS=null;function WT(a){let b=a.plugins;if(WS!=b){WR=!1,WS=b;for(let a=0;a<b.length;a++)if(b[a].spec.historyPreserveItems){WR=!0;break}}return WR}let WU=new uq("history"),WV=new uq("closeHistory");function WW(a,b){return(c,d)=>{let e=WU.getState(c);if(!e||0==(a?e.undone:e.done).eventCount)return!1;if(d){let f=function(a,b,c){let d=WT(b),e=WU.get(b).spec.config,f=(c?a.undone:a.done).popEvent(b,d);if(!f)return null;let g=f.selection.resolve(f.transform.doc),h=(c?a.done:a.undone).addTransform(f.transform,b.selection.getBookmark(),e,d),i=new WN(c?h:f.remaining,c?f.remaining:h,null,0,-1);return f.transform.setSelection(g).setMeta(WU,{redo:c,historyState:i})}(e,c,a);f&&d(b?f.scrollIntoView():f)}return!0}}let WX=WW(!1,!0),WY=WW(!0,!0);WW(!1,!1),WW(!0,!1),TI.create({name:"characterCount",addOptions:()=>({limit:null,mode:"textSize",textCounter:a=>a.length,wordCounter:a=>a.split(" ").filter(a=>""!==a).length}),addStorage:()=>({characters:()=>0,words:()=>0}),onBeforeCreate(){this.storage.characters=a=>{let b=(null==a?void 0:a.node)||this.editor.state.doc;if("textSize"===((null==a?void 0:a.mode)||this.options.mode)){let a=b.textBetween(0,b.content.size,void 0," ");return this.options.textCounter(a)}return b.nodeSize},this.storage.words=a=>{let b=(null==a?void 0:a.node)||this.editor.state.doc,c=b.textBetween(0,b.content.size," "," ");return this.options.wordCounter(c)}},addProseMirrorPlugins(){let a=!1;return[new un({key:new uq("characterCount"),appendTransaction:(b,c,d)=>{if(a)return;let e=this.options.limit;if(null==e||0===e){a=!0;return}let f=this.storage.characters({node:d.doc});if(f>e){console.warn(`[CharacterCount] Initial content exceeded limit of ${e} characters. Content was automatically trimmed.`);let b=d.tr.deleteRange(0,f-e);return a=!0,b}a=!0},filterTransaction:(a,b)=>{let c=this.options.limit;if(!a.docChanged||0===c||null==c)return!0;let d=this.storage.characters({node:b.doc}),e=this.storage.characters({node:a.doc});if(e<=c||d>c&&e>c&&e<=d)return!0;if(d>c&&e>c&&e>d||!a.getMeta("paste"))return!1;let f=a.selection.$head.pos;return a.deleteRange(f-(e-c),f),!(this.storage.characters({node:a.doc})>c)}})]}});var WZ=TI.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[function(a={}){return new un({view:b=>new Wz(b,a)})}(this.options)]}});TI.create({name:"focus",addOptions:()=>({className:"has-focus",mode:"all"}),addProseMirrorPlugins(){return[new un({key:new uq("focus"),props:{decorations:({doc:a,selection:b})=>{let{isEditable:c,isFocused:d}=this.editor,{anchor:e}=b,f=[];if(!c||!d)return wu.create(a,[]);let g=0;"deepest"===this.options.mode&&a.descendants((a,b)=>{if(!a.isText){if(!(e>=b&&e<=b+a.nodeSize-1))return!1;g+=1}});let h=0;return a.descendants((a,b)=>!a.isText&&!!(e>=b&&e<=b+a.nodeSize-1)&&((h+=1,"deepest"===this.options.mode&&g-h>0||"shallowest"===this.options.mode&&h>1)?"deepest"===this.options.mode:void f.push(wr.node(b,b+a.nodeSize,{class:this.options.className})))),wu.create(a,f)}}})]}});var W$=TI.create({name:"gapCursor",addProseMirrorPlugins:()=>[new un({props:{decorations:WH,createSelectionBetween:(a,b,c)=>b.pos==c.pos&&WA.valid(c)?new WA(c):null,handleClick:WF,handleKeyDown:WD,handleDOMEvents:{beforeinput:WG}}})],extendNodeSchema(a){var b;let c={name:a.name,options:a.options,storage:a.storage};return{allowGapCursor:null!=(b=SS(SO(a,"allowGapCursor",c)))?b:null}}});function W_({types:a,node:b}){return b&&Array.isArray(a)&&a.includes(b.type)||(null==b?void 0:b.type)===a}TI.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new un({key:new uq("placeholder"),props:{decorations:({doc:a,selection:b})=>{let c=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:d}=b,e=[];if(!c)return null;let f=this.editor.isEmpty;return a.descendants((a,b)=>{let c=d>=b&&d<=b+a.nodeSize,g=!a.isLeaf&&Ta(a);if((c||!this.options.showOnlyCurrent)&&g){let d=[this.options.emptyNodeClass];f&&d.push(this.options.emptyEditorClass);let g=wr.node(b,b+a.nodeSize,{class:d.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:a,pos:b,hasAnchor:c}):this.options.placeholder});e.push(g)}return this.options.includeChildren}),wu.create(a,e)}}})]}}),TI.create({name:"selection",addOptions:()=>({className:"selection"}),addProseMirrorPlugins(){let{editor:a,options:b}=this;return[new un({key:new uq("selection"),props:{decorations:c=>c.selection.empty||a.isFocused||!a.isEditable||Tb(c.selection)||a.view.dragging?null:wu.create(c.doc,[wr.inline(c.selection.from,c.selection.to,{class:b.className})])}})]}});var W0=TI.create({name:"trailingNode",addOptions:()=>({node:void 0,notAfter:[]}),addProseMirrorPlugins(){var a;let b=new uq(this.name),c=(null==(a=this.editor.schema.topNodeType.contentMatch.defaultType)?void 0:a.name)||this.options.node||"paragraph",d=Object.entries(this.editor.schema.nodes).map(([,a])=>a).filter(a=>(this.options.notAfter||[]).concat(c).includes(a.name));return[new un({key:b,appendTransaction:(a,d,e)=>{let{doc:f,tr:g,schema:h}=e,i=b.getState(e),j=f.content.size,k=h.nodes[c];if(i)return g.insert(j,k.create())},state:{init:(a,b)=>!W_({node:b.tr.doc.lastChild,types:d}),apply:(a,b)=>!a.docChanged||a.getMeta("__uniqueIDTransaction")?b:!W_({node:a.doc.lastChild,types:d})}})]}}),W1=TI.create({name:"undoRedo",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:a,dispatch:b})=>WX(a,b),redo:()=>({state:a,dispatch:b})=>WY(a,b)}),addProseMirrorPlugins(){return[function(a={}){return new un({key:WU,state:{init:()=>new WN(WL.empty,WL.empty,null,0,-1),apply:(b,c,d)=>(function(a,b,c,d){let e=c.getMeta(WU),f;if(e)return e.historyState;c.getMeta(WV)&&(a=new WN(a.done,a.undone,null,0,-1));let g=c.getMeta("appendedTransaction");if(0==c.steps.length)return a;if(g&&g.getMeta(WU))if(g.getMeta(WU).redo)return new WN(a.done.addTransform(c,void 0,d,WT(b)),a.undone,WP(c.mapping.maps),a.prevTime,a.prevComposition);else return new WN(a.done,a.undone.addTransform(c,void 0,d,WT(b)),null,a.prevTime,a.prevComposition);if(!1===c.getMeta("addToHistory")||g&&!1===g.getMeta("addToHistory"))if(f=c.getMeta("rebased"))return new WN(a.done.rebased(c,f),a.undone.rebased(c,f),WQ(a.prevRanges,c.mapping),a.prevTime,a.prevComposition);else return new WN(a.done.addMaps(c.mapping.maps),a.undone.addMaps(c.mapping.maps),WQ(a.prevRanges,c.mapping),a.prevTime,a.prevComposition);{let e=c.getMeta("composition"),f=0==a.prevTime||!g&&a.prevComposition!=e&&(a.prevTime<(c.time||0)-d.newGroupDelay||!function(a,b){if(!b)return!1;if(!a.docChanged)return!0;let c=!1;return a.mapping.maps[0].forEach((a,d)=>{for(let e=0;e<b.length;e+=2)a<=b[e+1]&&d>=b[e]&&(c=!0)}),c}(c,a.prevRanges)),h=g?WQ(a.prevRanges,c.mapping):WP(c.mapping.maps);return new WN(a.done.addTransform(c,f?b.selection.getBookmark():void 0,d,WT(b)),WL.empty,h,c.time,null==e?a.prevComposition:e)}})(c,d,b,a)},config:a={depth:a.depth||100,newGroupDelay:a.newGroupDelay||500},props:{handleDOMEvents:{beforeinput(a,b){let c=b.inputType,d="historyUndo"==c?WX:"historyRedo"==c?WY:null;return!!d&&!!a.editable&&(b.preventDefault(),d(a.state,a.dispatch))}}}})}(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),W2=TI.create({name:"starterKit",addExtensions(){var a,b,c,d;let e=[];return!1!==this.options.bold&&e.push(Um.configure(this.options.bold)),!1!==this.options.blockquote&&e.push(Uh.configure(this.options.blockquote)),!1!==this.options.bulletList&&e.push(V5.configure(this.options.bulletList)),!1!==this.options.code&&e.push(Ub.configure(this.options.code)),!1!==this.options.codeBlock&&e.push(Up.configure(this.options.codeBlock)),!1!==this.options.document&&e.push(Uq.configure(this.options.document)),!1!==this.options.dropcursor&&e.push(WZ.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&e.push(W$.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&e.push(Ur.configure(this.options.hardBreak)),!1!==this.options.heading&&e.push(Us.configure(this.options.heading)),!1!==this.options.undoRedo&&e.push(W1.configure(this.options.undoRedo)),!1!==this.options.horizontalRule&&e.push(Ut.configure(this.options.horizontalRule)),!1!==this.options.italic&&e.push(Uy.configure(this.options.italic)),!1!==this.options.listItem&&e.push(V6.configure(this.options.listItem)),!1!==this.options.listKeymap&&e.push(Wk.configure(null==(a=this.options)?void 0:a.listKeymap)),!1!==this.options.link&&e.push(V1.configure(null==(b=this.options)?void 0:b.link)),!1!==this.options.orderedList&&e.push(Wp.configure(this.options.orderedList)),!1!==this.options.paragraph&&e.push(Wt.configure(this.options.paragraph)),!1!==this.options.strike&&e.push(Ww.configure(this.options.strike)),!1!==this.options.text&&e.push(Wx.configure(this.options.text)),!1!==this.options.underline&&e.push(Wy.configure(null==(c=this.options)?void 0:c.underline)),!1!==this.options.trailingNode&&e.push(W0.configure(null==(d=this.options)?void 0:d.trailingNode)),e}});let W3={tldraw_draw:{normal:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw",format:"woff2"},weight:"normal"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_bold",format:"woff2"},weight:"bold"}},italic:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_sans:{normal:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_serif:{normal:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_mono:{normal:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}}},W4=cX(W3).flatMap(a=>cX(a).flatMap(a=>Object.values(a))),W5=NK.create({name:"textDirection",addGlobalAttributes:()=>[{types:["heading","paragraph"],attributes:{dir:{default:"auto",parseHTML:a=>{let b=a.getAttribute("dir");return b&&["ltr","rtl","auto"].includes(b)?b:"auto"},renderHTML:a=>({dir:a.dir})}}}]}),W6=NK.create({name:"keyboardShiftEnterHandler",addKeyboardShortcuts:()=>({"Shift-Enter":({editor:a})=>a.commands.enter()})});Ub.config.excludes=void 0,Ue.config.priority=1100;let W7=[W2.configure({blockquote:!1,codeBlock:!1,horizontalRule:!1,link:{openOnClick:!1,autolink:!0}}),Ue,W6,W5],W8=new cl;function W9(a,b){return W8.get(b,()=>{let c;return(c=Nk(Nm(a.getTextOptions().tipTapConfig?.extensions??W7),void 0),Nd(s0.fromJSON(c,b).content,c)).replaceAll('<p dir="auto"></p>',"<p><br /></p>")??""})}function Xa(a,b){let c=W9(a,b);return`<div class="tl-rich-text">${c}</div>`}let Xb=new cl;function Xc(a){return 1===a.content.length&&!a.content[0].content}function Xd(a,b){return Xc(b)?"":Xb.get(b,()=>(function(a,b,c){var d,e;let f,{blockSeparator:g="\n\n",textSerializers:h={}}=c||{},i=Nk(Nm(b),void 0);return d=s0.fromJSON(i,a),e={blockSeparator:g,textSerializers:{...No(i),...h}},f={from:0,to:d.content.size},Nn(d,f,e)})(b,a.getTextOptions().tipTapConfig?.extensions??W7,{blockSeparator:"\n"}))}function Xe(a,b,c){for(let c of a.marks)"bold"===c.type.name&&"bold"!==b.weight&&(b={...b,weight:"bold"}),"italic"===c.type.name&&"italic"!==b.style&&(b={...b,style:"italic"}),"code"===c.type.name&&"tldraw_mono"!==b.family&&(b={...b,family:"tldraw_mono"});let d=cV(W3,b.family);if(!d)return b;let e=cV(d,b.style);if(!e)return b;let f=cV(e,b.weight);return f&&c(f),b}let Xf=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/,Xg={"&amp;":"&","&quot;":'"',"&apos;":"'","&#27;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8230;":"…"},Xh=RegExp(Object.keys(Xg).join("|"),"g");function Xi(a){return a.replace(Xh,a=>Xg[a])}async function Xj(a,{file:b,assetId:c},d){Xu(b,d)||cg(!1,"File checks failed");let e=await Xv(b,d,c),f=await a.uploadAsset(e,b);return e.props.src=f.src,f.meta&&(e.meta={...e.meta,...f.meta}),iz.create(e)}async function Xk(a,{file:b,shapeId:c,isImage:d},e){Xu(b,e)||cg(!1,"File checks failed");let f=a.getShape(c);f||cg(!1,"Shape not found");let g=cw(await b.arrayBuffer()),h=iz.createId(g);a.createTemporaryAssetPreview(h,b);let i=await Xs(b,h,d,!d);if(a.createAssets([i]),"image"===f.type){let b=f.props.crop,c=i.props.w,d=i.props.h,e=f.x,g=f.y,j=b;if(b){let a=function(a,b,c){let d=MW(),e=a.props.crop||d,f=a.props.w,g=a.props.h,h=d,i=f,j=g;if((0,zx.default)(a.props.crop,d))i=f,j=f*c/b;else{let d,f,{w:g,h:i}=MZ(a.props,a.props.crop||MW()),{width:j,height:k}=M$(e),l=j/k,m=M_(e),n=b/c/(g/i)/l;if(f=(d=j)*n,n>1.5)if(1/f<1/d){let a=f/.3333333333333333;f/=a,d/=a}else{let a=d/.3333333333333333;d/=a,f/=a}d=Math.max(0,Math.min(1,d)),f=Math.max(0,Math.min(1,f)),h=M0(m.x,m.y,d,f,e.isCircle)}let k=a.x+f/2,l=a.y+g/2,m=k-i/2,n=l-j/2;return{crop:h,w:i,h:j,x:m,y:n}}(f,i.props.w,i.props.h);j=a.crop,c=a.w,d=a.h,e=a.x,g=a.y}a.updateShapes([{id:f.id,type:f.type,props:{assetId:h,crop:j,w:c,h:d},x:e,y:g}])}else"video"===f.type&&a.updateShapes([{id:f.id,type:f.type,props:{assetId:h,w:i.props.w,h:i.props.h}}]);let j=await a.getAssetForExternalContent({type:"file",file:b,assetId:h});return a.updateAssets([{...j,id:h}]),j}async function Xl(a,{url:b},{toasts:c,msg:d}){let e;try{let a=await cr(b,{method:"GET",mode:"no-cors"}),c=await a.text(),d=new DOMParser().parseFromString(c,"text/html");(e={image:d.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:d.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??d.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:d.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??b,description:d.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""}).image.startsWith("http")||(e.image=new URL(e.image,b).href),e.favicon.startsWith("http")||(e.favicon=new URL(e.favicon,b).href)}catch(a){console.error(a),c.addToast({title:d("assets.url.failed"),severity:"error"}),e={image:"",favicon:"",title:"",description:""}}return{id:iz.createId(cu(b)),typeName:"asset",type:"bookmark",props:{src:b,description:e.description,image:e.image,favicon:e.favicon,title:e.title},meta:{}}}async function Xm(a,{point:b,text:c}){let d=b??(a.inputs.shiftKey?a.inputs.currentPagePoint:a.getViewportPageBounds().center),e=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!e)throw Error("No <svg/> element present");let f=parseFloat(e.getAttribute("width")||"0"),g=parseFloat(e.getAttribute("height")||"0");if(!(f&&g)){document.body.appendChild(e);let a=e.getBoundingClientRect();document.body.removeChild(e),f=a.width,g=a.height}let h=await a.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!h)throw Error("Could not create an asset");Xt(a,[h],d)}async function Xn(a,{point:b,files:c},d){let{acceptedImageMimeTypes:e=cL,toasts:f,msg:g}=d;if(c.length>a.options.maxFilesAtOnce)return void f.addToast({title:g("assets.files.amount-too-many"),severity:"error"});let h=b??(a.inputs.shiftKey?a.inputs.currentPagePoint:a.getViewportPageBounds().center),i=new jA(h.x,h.y),j=[],k=[];for(let b of c){if(!Xu(b,d))continue;let c=await Xv(b,d);e.includes(b.type)&&a.createTemporaryAssetPreview(c.id,b),j.push(c),k.push({asset:c,file:b})}Promise.allSettled(k.map(async b=>{try{let c=await a.getAssetForExternalContent({type:"file",file:b.file});if(!c)throw Error("Could not create an asset");a.updateAssets([{...c,id:b.asset.id}])}catch(c){f.addToast({title:g("assets.files.upload-failed"),severity:"error"}),console.error(c),a.deleteAssets([b.asset.id]);return}})),Xt(a,j,i)}async function Xo(a,{point:b,text:c,html:d}){let e,f,g,h,i,j,k=b??(a.inputs.shiftKey?a.inputs.currentPagePoint:a.getViewportPageBounds().center),l=a.getShapeUtil("text").getDefaultProps(),m=(function(a){let b=a.split("\n");for(;b[0]&&0===b[0].trim().length;)b.shift();let c=1/0;for(let a of b)if(a.trim().length>0){let b=a.length-a.trimStart().length;c=Math.min(c,b)}return b.map(a=>a.slice(c)).join("\n")})(c.replace(/\t/g,"  ")).replace(/[ \t]+$/gm,"").replace(/\n+$/,""),n=d?(h=a.getTextOptions().tipTapConfig?.extensions??W7,i=Nk(Nm(h),void 0),j=M8(d),th.fromSchema(i).parse(j).toJSON()):g6(m),o="middle",p=d??m.replace(/\n/g,"<br>"),q=d?n.content.length>1:m.split("\n").length>1,r=Xf.test(m);q&&(o=q?r?"end":"start":"middle");let s=a.textMeasure.measureHtml(p,{...Rr,fontFamily:Rw[l.font],fontSize:Rt[l.size],maxWidth:null}),t=Math.min(q?.9*a.getViewportPageBounds().width:920,Math.max(200,.9*a.getViewportPageBounds().width));if(s.w>t){let b=a.textMeasure.measureHtml(p,{...Rr,fontFamily:Rw[l.font],fontSize:Rt[l.size],maxWidth:t});e=b.w,f=b.h,g=!1,o=r?"end":"start"}else e=Math.max(s.w,10),f=Math.max(s.h,10),g=!0;k.y-f/2<a.getViewportPageBounds().minY+40&&(k.y=a.getViewportPageBounds().minY+40+f/2);let u=sy(new jA(k.x-e/2,k.y-f/2),a),v=hd();a.createShapes([{id:v,type:"text",x:u.x,y:u.y,props:{richText:n,textAlign:o,autoSize:g,w:e}}])}async function Xp(a,{point:b,url:c},{toasts:d,msg:e}){let f=a.getShapeUtil("embed"),g=f?.getEmbedDefinition(c);if(g&&!1!==g.definition.embedOnPaste)return a.putExternalContent({type:"embed",url:g.url,point:b,embed:g.definition});let h=b??(a.inputs.shiftKey?a.inputs.currentPagePoint:a.getViewportPageBounds().center);if(!(await z_(a,{url:c,center:h})).ok)return void d.addToast({title:e("assets.url.failed"),severity:"error"})}async function Xq(a,{point:b,content:c}){a.run(()=>{let d=a.getSelectionPageBounds();for(let b of(a.markHistoryStoppingPoint("paste"),c.shapes))c.rootShapeIds.includes(b.id)&&(b.isLocked=!1);a.putContentOntoCurrentPage(c,{point:b,select:!0});let e=a.getSelectionPageBounds();d&&e&&d?.collides(e)&&(a.updateInstanceState({isChangingStyle:!0}),a.timers.setTimeout(()=>{a.updateInstanceState({isChangingStyle:!1})},150))})}async function Xr(a,{point:b,content:c}){a.run(()=>{Rx(a,c,b)})}async function Xs(a,b,c,d,e){let f=a.type;"video/quicktime"===a.type&&(f="video/mp4");let g=c?await cP.getImageSize(a):await cP.getVideoSize(a),h=await cP.isAnimated(a)||d,i={id:b,type:c?"image":"video",typeName:"asset",props:{name:a.name,src:"",w:g.w,h:g.h,fileSize:a.size,mimeType:f,isAnimated:h},meta:{}};if(e&&isFinite(e)){var j;let b,c,d={w:i.props.w,h:i.props.h},f=(j={w:e,h:e},b=d.w/j.w,c=d.h/j.h,b<=1&&c<=1?d:b>c?{w:d.w/b,h:d.h/b}:{w:d.w/c,h:d.h/c});d!==f&&cP.isStaticImageType(a.type)&&(i.props.w=f.w,i.props.h=f.h)}return i}async function Xt(a,b,c){if(!b.length)return[];let d=jA.From(c),e=[];for(let a=0;a<b.length;a++){let c=b[a];switch(c.type){case"image":e.push({id:hd(),type:"image",x:d.x,y:d.y,opacity:1,props:{assetId:c.id,w:c.props.w,h:c.props.h}}),d.x+=c.props.w;break;case"video":e.push({id:hd(),type:"video",x:d.x,y:d.y,opacity:1,props:{assetId:c.id,w:c.props.w,h:c.props.h}}),d.x+=c.props.w}}return a.run(()=>{let d=b.filter(b=>!a.getAsset(b.id));a.store.atomic(()=>{a.canCreateShapes(e)&&(d.length&&a.createAssets(d),a.createShapes(e).select(...e.map(a=>a.id)),function(a,b){let c=a.getViewportPageBounds(),d=a.getSelectionPageBounds();if(d){let c=d.center.sub(b);a.updateShapes(a.getSelectedShapes().map(b=>{let d=a.getShapeParentTransform(b).decompose().rotation,e=jA.Rot(c,-d);return{id:b.id,type:b.type,x:b.x-e.x,y:b.y-e.y}}))}if((d=a.getSelectionPageBounds())&&a.getInstanceState().isGridMode){let b=a.getDocumentSettings().gridSize,c=new jA(d.minX,d.minY),e=c.clone().snapToGrid(b),f=jA.Sub(c,e);a.updateShapes(a.getSelectedShapes().map(a=>{let b={x:a.x-f.x,y:a.y-f.y};return{id:a.id,type:a.type,x:b.x,y:b.y}}))}(d=a.getSelectionPageBounds())&&!c.contains(d)&&a.zoomToSelection({animation:{duration:a.options.animationMediumMs}})}(a,c))})}),e.map(a=>a.id)}function Xu(a,b){let{acceptedImageMimeTypes:c=cL,acceptedVideoMimeTypes:d=cM,maxAssetSize:e=0xa00000,toasts:f,msg:g}=b,h=c.includes(a.type),i=d.includes(a.type);return h||i?a.size>e?(f.addToast({title:g("assets.files.size-too-big"),description:g("assets.files.maximum-size").replace("{size}",(a=>{if(0===a)return"0 bytes";let b=Math.floor(Math.log(a)/Math.log(1024)),c=a/Math.pow(1024,b),d=c%1==0?c.toString():c.toFixed(1);return`${d} ${["bytes","KB","MB","GB","TB","PB"][b]}`})(e)),severity:"error"}),!1):!!a.type||(f.addToast({title:g("assets.files.upload-failed"),severity:"error"}),console.error("No mime type"),!1):(f.addToast({title:g("assets.files.type-not-allowed"),severity:"error"}),!1)}async function Xv(a,b,c){let{acceptedImageMimeTypes:d=cL,acceptedVideoMimeTypes:e=cM,maxImageDimension:f=5e3}=b,g=d.includes(a.type),h=e.includes(a.type),i=cw(await a.arrayBuffer());return c??=iz.createId(i),await Xs(a,c,g,h,f)}class Xw extends ps{static id="idle";isPrecise=!1;isPreciseTimerId=null;preciseTargetId=null;onPointerMove(){this.update()}onPointerDown(a){this.parent.transition("pointing",{...a,isPrecise:this.isPrecise})}onEnter(){this.editor.setCursor({type:"cross",rotation:0}),this.update()}onCancel(){this.editor.setCurrentTool("select")}onExit(){Q6(this.editor),null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId)}onKeyDown(){this.update()}onKeyUp(a){if(this.update(),"Enter"===a.key){if(this.editor.getIsReadonly())return null;let b=this.editor.getOnlySelectedShape();b&&this.editor.getShapeUtil(b).canEdit(b)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(b.id),this.editor.root.getCurrent()?.transition("editing_shape",{...a,target:"shape",shape:b}))}}update(){let a=this.editor.getShapeUtil("arrow"),b=Q7({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0});b&&b.target.id!==this.preciseTargetId?(null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId),this.preciseTargetId=b.target.id,this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.isPrecise=!0,this.update()},a.options.hoverPreciseTimeout)):!b&&this.preciseTargetId&&(this.isPrecise=!1,this.preciseTargetId=null,null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId))}}class Xx extends ps{static id="pointing";shape;isPrecise=!1;isPreciseTimerId=null;markId="";onEnter(a){(this.markId="",this.isPrecise=!!a.isPrecise,Q7({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0})||(this.createArrowShape(),this.shape))?this.startPreciseTimeout():this.cancel()}onExit(){this.shape=void 0,Q6(this.editor),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)return void this.cancel();this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.parent.transition("idle")}createArrowShape(){let{originPagePoint:a}=this.editor.inputs,b=hd();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${b}`);let c=sy(a,this.editor);this.editor.createShape({id:b,type:"arrow",x:c.x,y:c.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});let d=this.editor.getShape(b);if(!d)return;let e=this.editor.getShapeHandles(d);if(!e)throw Error("expected handles for arrow");let f=this.editor.getShapeUtil("arrow"),g=this.shape,h=e.find(a=>"start"===a.id),i=f.onHandleDrag?.(d,{handle:{...h,x:0,y:0},isPrecise:!0,isCreatingShape:!0,initial:g});i&&this.editor.updateShapes([i]),this.shape=this.editor.getShape(b),this.editor.select(b)}updateArrowShapeEndHandle(){let a=this.shape;if(!a)throw Error("expected shape");let b=this.editor.getShapeHandles(a);if(!b)throw Error("expected handles for arrow");{let c=this.editor.getShapeUtil("arrow"),d=this.shape,e=b.find(a=>"start"===a.id),f=c.onHandleDrag?.(a,{handle:{...e,x:0,y:0},isPrecise:this.isPrecise,isCreatingShape:!0,initial:d});f&&this.editor.updateShapes([f])}{let c=this.editor.getShapeUtil("arrow"),d=this.shape,e=this.editor.getPointInShapeSpace(a,this.editor.inputs.currentPagePoint),f=b.find(a=>"end"===a.id),g=c.onHandleDrag?.(this.editor.getShape(a),{handle:{...f,x:e.x,y:e.y},isPrecise:this.isPrecise,isCreatingShape:!0,initial:d});g&&this.editor.updateShapes([g])}this.shape=this.editor.getShape(a.id)}startPreciseTimeout(){let a=this.editor.getShapeUtil("arrow");this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.isPrecise=!0)},a.options.pointingPreciseTimeout)}clearPreciseTimeout(){null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId)}}class Xy extends ps{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;markId=null;onEnter(a){this.markId=null,this.info=a,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){let{inputs:a}=this.editor;if(this.isPen&&!a.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?jA.Dist(a.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=a.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(a){if("Shift"===a.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(a){if("Shift"===a.key)switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return"highlight"!==this.shapeType}getIsClosed(a,b,c){if(!this.canClose())return!1;let d=Rs[b],e=a[0].points[0],f=a[a.length-1],g=f.points[f.points.length-1];return e!==g&&this.currentLineLength>4*d*c&&jA.DistMin(e,g,2*d*c)}startShape(){let{inputs:{originPagePoint:a,isPen:b}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");let{z:c=.5}=this.info.point;this.isPen=b,this.isPenOrStylus=b||c>0&&c<.5||c>.5&&c<1;let d=this.isPenOrStylus?1.25*c:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=a.clone(),this.initialShape){let b=this.editor.getShape(this.initialShape.id);if(b&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;let c=b6(b.props.segments);if(!c)throw Error("Expected a previous segment!");let e=b6(c.points);if(!e)throw Error("Expected a previous point!");let{x:f,y:g}=this.editor.getPointInShapeSpace(b,a).toFixed(),h={type:this.segmentMode,points:[{x:e.x,y:e.y,z:+d.toFixed(2)},{x:f,y:g,z:+d.toFixed(2)}]},i=li.applyToPoint(this.editor.getShapePageTransform(b.id),e);this.pagePointWhereCurrentSegmentChanged=i,this.pagePointWhereNextSegmentChanged=null;let j=[...b.props.segments,h];this.currentLineLength<4*Rs[b.props.size]&&(this.currentLineLength=this.getLineLength(j));let k={id:b.id,type:this.shapeType,props:{segments:j}};this.canClose()&&(k.props.isClosed=this.getIsClosed(j,b.props.size,b.props.scale)),this.editor.updateShapes([k]);return}}this.pagePointWhereCurrentSegmentChanged=a.clone();let e=hd();(this.editor.createShape({id:e,type:this.shapeType,x:a.x,y:a.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+d.toFixed(2)}]}]}}),this.editor.getShape(e))?(this.currentLineLength=0,this.initialShape=this.editor.getShape(e)):this.cancel()}updateDrawingShape(){let{initialShape:a}=this,{inputs:b}=this.editor;if(!a)return;let{id:c,props:{size:d,scale:e}}=a,f=this.editor.getShape(c);if(!f)return;let{segments:g}=f.props,{x:h,y:i,z:j}=this.editor.getPointInShapeSpace(f,b.currentPagePoint).toFixed(),k={x:h,y:i,z:this.isPenOrStylus?+(1.25*b.currentPagePoint.z).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{let{pagePointWhereNextSegmentChanged:a}=this;if(null===a)throw Error("We should have a point where the segment changed");if(jA.Dist2(a,b.currentPagePoint)>this.editor.options.dragDistanceSquared){let a;this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";let b=b6(g);if(!b)throw Error("Expected a previous segment!");let h=b6(b.points);if(!h)throw Error("Expected a previous last point!");let i=this.editor.getPointInShapeSpace(f,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===b.type){this.currentLineLength+=jA.Dist(h,i),a={type:"straight",points:[{...h},i]};let b=this.editor.getShapePageTransform(f);this.pagePointWhereCurrentSegmentChanged=li.applyToPoint(b,h)}else a={type:"straight",points:[i,k]};let j={id:c,type:this.shapeType,props:{segments:[...g,a]}};this.canClose()&&(j.props.isClosed=this.getIsClosed(g,d,e)),this.editor.updateShapes([j])}break}case"starting_free":{let{pagePointWhereNextSegmentChanged:a}=this;if(null===a)throw Error("We should have a point where the segment changed");if(jA.Dist2(a,b.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";let a=g.slice(),b=b6(a[a.length-1].points);if(!b)throw Error("No previous point!");let h=[...a,{type:"free",points:[...jA.PointsBetween(b,k,6).map(a=>({x:jY(a.x),y:jY(a.y),z:jY(a.z)}))]}];this.currentLineLength<4*Rs[f.props.size]&&(this.currentLineLength=this.getLineLength(h));let i={id:c,type:this.shapeType,props:{segments:h}};this.canClose()&&(i.props.isClosed=this.getIsClosed(h,d,e)),this.editor.updateShapes([i])}break}case"straight":{let a,b,h=g.slice(),i=h[h.length-1],{pagePointWhereCurrentSegmentChanged:j}=this,{ctrlKey:k,currentPagePoint:l}=this.editor.inputs;if(!j)throw Error("We should have a point where the segment changed");let m=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(m=!k,this.didJustShiftClickToExtendPreviousShapeLine=!1):m=!k;let n=this.editor.getPointInShapeSpace(f,l).toFixed().toJson(),o=!1;if((this.editor.user.getIsSnapMode()?!k:k)&&h.length>2){let a,c=8/this.editor.getZoomLevel();for(let d=0,e=g.length-2;d<e;d++){let e=g[d];if(!e)break;if("free"===e.type)continue;let f=e.points[0],h=b6(e.points);if(!(f&&h))continue;let i=jA.NearestPointOnLineSegment(f,h,n);if(jA.DistMin(i,n,c)){a=i.toFixed().toJson(),c=jA.Dist(i,n),b=e;break}}a&&(o=!0,n=a)}if(o&&b){let a=this.editor.getShapePageTransform(f),c=b.points[0],d=b6(b.points);if(!d)throw Error("Expected a last point!");let e=li.applyToPoint(a,c),g=li.applyToPoint(a,d),h=li.applyToPoint(a,n);this.editor.snaps.setIndicators([{id:cA(void 0),type:"points",points:[e,h,g]}])}else{if(this.editor.snaps.clearIndicators(),m){let b=jA.Angle(j,l),c=jQ(b,24);a=jA.RotWith(l,j,c-b)}else a=l;n=this.editor.getPointInShapeSpace(f,a).toFixed().toJson()}this.currentLineLength+=jA.Dist(i.points[0],n),h[h.length-1]={...i,type:"straight",points:[i.points[0],n]};let p={id:c,type:this.shapeType,props:{segments:h}};this.canClose()&&(p.props.isClosed=this.getIsClosed(g,d,e)),this.editor.updateShapes([p]);break}case"free":{let a=g.slice(),h=a[a.length-1],i=[...h.points];if(i.length&&this.mergeNextPoint){let{z:a}=i[i.length-1];i[i.length-1]={x:k.x,y:k.y,z:a?Math.max(a,k.z):k.z}}else this.currentLineLength+=jA.Dist(i[i.length-1],k),i.push(k);a[a.length-1]={...h,points:i},this.currentLineLength<4*Rs[f.props.size]&&(this.currentLineLength=this.getLineLength(a));let l={id:c,type:this.shapeType,props:{segments:a}};if(this.canClose()&&(l.props.isClosed=this.getIsClosed(a,d,e)),this.editor.updateShapes([l]),i.length>this.util.options.maxPointsPerShape){this.editor.updateShapes([{id:c,type:this.shapeType,props:{isComplete:!0}}]);let a=hd(),d=this.editor.getShape(c).props;if(!this.editor.canCreateShapes([a]))return this.cancel();this.editor.createShape({id:a,type:this.shapeType,x:jY(b.currentPagePoint.x),y:jY(b.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:d.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(1.25*j).toFixed():.5}]}]}});let e=this.editor.getShape(a);if(!e)return this.cancel();this.initialShape=d$(e),this.mergeNextPoint=!1,this.lastRecordedPoint=b.currentPagePoint.clone(),this.currentLineLength=0}}}}getLineLength(a){let b=0;for(let c of a)for(let a=0;a<c.points.length-1;a++){let d=c.points[a],e=c.points[a+1];b+=jA.Dist2(e,d)}return Math.sqrt(b)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){let{initialShape:a}=this;a&&(this.editor.updateShapes([{id:a.id,type:a.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}class Xz extends ps{static id="idle";onPointerDown(a){this.parent.transition("drawing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}class XA extends ps{static id="idle";onPointerDown(a){this.parent.transition("pointing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(a){if("Enter"===a.key){if(this.editor.getIsReadonly())return null;let b=this.editor.getOnlySelectedShape();b&&this.editor.getShapeUtil(b).canEdit(b)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(b.id),this.editor.root.getCurrent()?.transition("editing_shape",{...a,target:"shape",shape:b}))}}onCancel(){this.editor.setCurrentTool("select")}}class XB extends ps{static id="pointing";onPointerUp(){this.complete()}onPointerMove(a){if(this.editor.inputs.isDragging){let{originPagePoint:b}=this.editor.inputs,c=hd(),d=this.editor.markHistoryStoppingPoint(`creating_geo:${c}`),e=sy(b,this.editor);if(this.editor.createShapes([{id:c,type:"geo",x:e.x,y:e.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(iQ),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(c),!this.editor.getShape(c))return void this.cancel();this.editor.setCurrentTool("select.resizing",{...a,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:d,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){let{originPagePoint:a}=this.editor.inputs,b=hd();this.editor.markHistoryStoppingPoint(`creating_geo:${b}`);let c=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,d=this.editor.getStyleForNextShape(iQ);this.editor.createShapes([{id:b,type:"geo",x:a.x,y:a.y,props:{geo:this.editor.getStyleForNextShape(iQ),scale:c,..."star"===d?{w:200,h:190}:"cloud"===d?{w:300,h:180}:{w:200,h:200}}}]);let e=this.editor.getShape(b);if(!e)return void this.cancel();let{w:f,h:g}=e.props,h=new jA(f/2,g/2).mul(c),i=this.editor.getShapeParentTransform(e);i&&h.rot(-i.rotation());let j=sy(new jA(e.x-h.x,e.y-h.y),this.editor);this.editor.select(b),this.editor.updateShape({id:e.id,type:"geo",x:j.x,y:j.y,props:{geo:this.editor.getStyleForNextShape(iQ),w:f*c,h:g*c}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}}class XC extends ps{static id="idle";shapeId="";onEnter(a){this.shapeId=a.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}}class XD extends ps{static id="pointing";shape={};markId;onEnter(a){let{inputs:b}=this.editor,{currentPagePoint:c}=b;this.markId=void 0;let d=a.shapeId&&this.editor.getShape(a.shapeId);if(d&&b.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${d.id}`),this.shape=d;let a=this.editor.getShapeHandles(this.shape);if(!a)return;let b=a.filter(a=>"vertex"===a.type).sort(dz),e=b[b.length-1],f=b[b.length-2],g=li.applyToPoint(this.editor.getShapeParentTransform(this.shape),new jA(this.shape.x,this.shape.y)),h=sy(jA.Sub(c,g).addXY(.1,.1),this.editor),i=d$(this.shape.props.points);if(jA.DistMin(e,f,2)||jA.DistMin(h,e,2))i[e.id]={id:e.id,index:e.index,x:h.x,y:h.y};else{let a=dw(e.index);i[a]={id:a,index:a,x:h.x,y:h.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:i}}])}else{let a=hd();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${a}`);let b=sy(c,this.editor);if(this.editor.createShapes([{id:a,type:"line",x:b.x,y:b.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),!this.editor.getShape(a))return void this.cancel();this.editor.select(a),this.shape=this.editor.getShape(a)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){let a=this.editor.getShapeHandles(this.shape);if(!a)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");let b=b6(a);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...b,x:b.x-.1,y:b.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}}class XE extends ps{static id="idle";onPointerDown(a){this.parent.transition("pointing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}let XF=new jA(100,100);function XG(a,b,c,d,e,f){return Object.fromEntries((function(a,b){if(1===b)return[[["a1"],new jA(100,-100-a.options.adjacentShapeMargin)],[["a2"],new jA(300+a.options.adjacentShapeMargin,100)],[["a3"],new jA(100,300+a.options.adjacentShapeMargin)],[["a4"],new jA(-100-a.options.adjacentShapeMargin,100)]];let c=200*b,d=a.options.adjacentShapeMargin*b;return[[["a1"],new jA(.5*c,-.5*c-d)],[["a2"],new jA(1.5*c+d,.5*c)],[["a3"],new jA(.5*c,1.5*c+d)],[["a4"],new jA(-.5*c-d,.5*c)]]})(a,f).map(([a,f],g)=>{let h=f.clone();return 0===g&&e?h.y-=e:2===g&&d&&(h.y+=d),[a,h.rot(c).add(b)]}))}function XH(a,b,c,d){let e,f=new Set(a.getSelectedShapeIds()),g=(200+a.options.adjacentShapeMargin+d)**2,h=new Map,i=[];for(let e of a.getCurrentPageShapes()){if(!a.isShapeOfType(e,"note")||c!==e.props.scale||f.has(e.id))continue;let g=a.getShapePageTransform(e.id);b===g.rotation()&&(h.set(e,a.getShapePageBounds(e).center),i.push(...Object.values(XG(a,g.point(),b,e.props.growY,d,c))))}let j=i.length;for(let[b,c]of h)for(let d=0;d<j;d++)(e=i[d])&&!(jA.Dist2(c,e)>g)&&a.isPointInShape(b,e)&&(i[d]=void 0);return b5(i)}function XI(a,b,c,d,e=!1){let f,g=a.getCurrentPageShapesSorted(),h=(200+a.options.adjacentShapeMargin**2)**b.props.scale;for(let d=g.length-1;d>=0;d--){let e=g[d];if("note"===e.type&&e.id!==b.id){let b=a.getShapePageBounds(e);if(b&&jA.Dist2(b.center,c)<h&&a.isPointInShape(e,c)){f=e;break}}}if(a.complete(),!f||e){a.markHistoryStoppingPoint("creating note shape");let e=hd();a.createShape({id:e,type:"note",x:c.x,y:c.y,rotation:d,opacity:b.opacity,props:{...b.props,richText:g6(""),growY:0,fontSizeAdjustment:0,url:""}});let g=a.getShape(e);if(!g)return;let h=a.getPointInParentSpace(g,jA.Sub(c,jA.Rot(XF.clone().mul(g.props.scale),d)));a.updateShape({id:e,type:"note",x:h.x,y:h.y}),f=a.getShape(e)}return a.zoomToSelectionIfOffscreen(16,{animation:{duration:a.options.animationMediumMs},inset:0}),f}class XJ extends ps{static id="pointing";dragged=!1;info={};markId="";shape={};onEnter(){let{editor:a}=this,b=hd();this.markId=a.markHistoryStoppingPoint(`creating_note:${b}`);let c=this.editor.inputs.originPagePoint.clone(),d=function(a,b,c){let d,e=10/a.getZoomLevel();for(let f of XH(a,0,c,0)){let a=jA.Sub(b,f),c=a.len();c<e&&(e=c,d=a)}return d}(this.editor,c,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);d&&c.sub(d);let e=function(a,b,c){a.createShape({id:b,type:"note",x:c.x,y:c.y,props:{scale:a.user.getIsDynamicResizeMode()?1/a.getZoomLevel():1}});let d=a.getShape(b);if(!d)return;a.select(b);let e=a.getShapeGeometry(d).bounds,f=sy(new jA(d.x-e.width/2,d.y-e.height/2),a);return a.updateShapes([{id:b,type:"note",x:f.x,y:f.y}]),a.getShape(b)}(this.editor,b,c);e?this.shape=e:this.cancel()}onPointerMove(a){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...a,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}var zy=b1;let XK=(0,zy.default)(function(a){let b,c=a.getShapeAtPoint(a.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:a.options.hitTestMargin/a.getZoomLevel(),renderingOnly:!0});if(!c)return a.setHoveredShape(null);let d=a.getOutermostSelectableShape(c);return b=d===c||d.id===a.getFocusedGroupId()||a.getSelectedShapeIds().includes(d.id)?c:d,a.setHoveredShape(b.id)},32);class XL extends ps{static id="idle";onPointerMove(a){switch(a.target){case"shape":case"canvas":XK(this.editor)}}onPointerDown(a){this.parent.transition("pointing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){XK.cancel()}onKeyDown(a){if("Enter"===a.key){if(this.editor.getIsReadonly())return null;let b=this.editor.getOnlySelectedShape();b&&this.editor.getShapeUtil(b).canEdit(b)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(b.id),this.editor.root.getCurrent()?.transition("editing_shape",{...a,target:"shape",shape:b}))}}onCancel(){this.editor.setCurrentTool("select")}}class XM extends ps{static id="pointing";shape;markId="";enterTime=0;onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(a){if(Date.now()-this.enterTime<150)return;let{editor:b}=this,{isPointing:c}=b.inputs;if(!c)return;let{originPagePoint:d,currentPagePoint:e}=b.inputs,f=Math.abs(d.x-e.x);if(f>6*Math.sqrt(b.getInstanceState().isCoarsePointer?b.options.coarseDragDistanceSquared:b.options.dragDistanceSquared)/b.getZoomLevel()){let c=hd();this.markId=b.markHistoryStoppingPoint(`creating_text:${c}`);let e=this.createTextShape(c,d,!1,f);if(!e)return void this.cancel();this.shape=b.getShape(e),b.select(c);let g=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1;b.setCurrentTool("select.resizing",{...a,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:f*g,y:1},onInteractionEnd:"text",onCreate:()=>{b.setEditingShape(e.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");let a=hd(),{originPagePoint:b}=this.editor.inputs;this.createTextShape(a,b,!0,20)&&(this.editor.select(a),this.editor.setEditingShape(a))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(a,b,c,d){this.editor.createShape({id:a,type:"text",x:b.x,y:b.y,props:{richText:g6(""),autoSize:c,w:d,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});let e=this.editor.getShape(a);if(!e)return void this.cancel();let f=this.editor.getShapePageBounds(e),g=new jA;if(c)switch(e.props.textAlign){case"start":g.x=0;break;case"middle":g.x=-f.width/2;break;case"end":g.x=-f.width}else g.x=0;if(g.y=-f.height/2,hc(e.parentId)){let a=this.editor.getShapeParentTransform(e);g.rot(-a.rotation())}let h=e.x+g.x,i=e.y+g.y;if(this.editor.getInstanceState().isGridMode){let a=new jA(h,i),b=sy(a,this.editor),c=jA.Sub(a,b);this.editor.updateShape({...e,x:h-c.x,y:i-c.y})}else this.editor.updateShape({...e,x:h,y:i});return e}}let XN=[class extends ps{static id="text";static initial="idle";static children(){return[XL,XM]}shapeType="text"},class extends ps{static id="draw";static initial="idle";static isLockable=!1;static useCoalescedEvents=!0;static children(){return[Xz,Xy]}shapeType="draw";onExit(){this.children.drawing.initialShape=void 0}},class extends ps{static id="geo";static initial="idle";static children(){return[XA,XB]}shapeType="geo"},class extends ps{static id="note";static initial="idle";static children(){return[XE,XJ]}shapeType="note"},class extends ps{static id="line";static initial="idle";static children(){return[XC,XD]}shapeType="line"},class extends sz{static id="frame";static initial="idle";shapeType="frame";onCreate(a){if(!a)return;let b=this.editor.getShapePageBounds(a),c=[],d=this.editor.getShapeAncestors(a).map(a=>a.id);this.editor.getSortedChildIdsForParent(a.parentId).map(e=>{var f,g,h;let i=this.editor.getShape(e);if(!i||i.id===a.id||i.isLocked)return;let j=this.editor.getShapePageBounds(i);j&&b.contains(j)&&(f=i,g=d,h=a,!g.includes(f.id)&&f.parentId===h.parentId)&&c.push(i.id)}),this.editor.reparentShapes(c,a.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}},class extends ps{static id="arrow";static initial="idle";static children(){return[Xw,Xx]}shapeType="arrow"},class extends ps{static id="highlight";static initial="idle";static useCoalescedEvents=!0;static children(){return[Xz,Xy]}static isLockable=!1;shapeType="highlight";onExit(){this.children.drawing.initialShape=void 0}}],XO=eQ.default.forwardRef(function({shapeId:a,isEditing:b,richText:c,handleFocus:d,handleChange:e,handleBlur:f,handleKeyDown:g,handleDoubleClick:h,hasCustomTabBehavior:i,handlePaste:j},k){let l=kp(),m=kj("tip-tap-editor"),n=l.getTextOptions().tipTapConfig,o=(0,eQ.useRef)(c),p=(0,eQ.useRef)(null),q=(0,eQ.useRef)(null);(0,eQ.useLayoutEffect)(()=>{p.current?o.current!==c&&p.current.commands.setContent(c):o.current=c},[c]);let r=(0,eQ.useRef)({selectAll:!1,caretPosition:null});(0,eQ.useLayoutEffect)(()=>{function a(a){a.shapeId===l.getEditingShapeId()&&(r.current.selectAll=!0)}function b(a){a.shapeId===l.getEditingShapeId()&&(r.current.caretPosition=a.point)}return l.on("select-all-text",a),l.on("place-caret",b),()=>{l.off("select-all-text",a),l.off("place-caret",b)}},[l,b]);let s=mA(e),t=mA(g),u=mA(d),v=mA(f),w=mA(h),y=mA(j);return((0,eQ.useLayoutEffect)(()=>{if(!b||!n||!q.current)return;let{editorProps:c,...d}=n,e=new TW({element:q.current,autofocus:!0,editable:b,onUpdate:a=>{let b=a.editor.state.doc.toJSON();o.current=b,s({richText:b})},onFocus:u,onBlur:v,onCreate:b=>{if(l.getEditingShapeId()!==a)return;let c=b.editor;l.setRichTextEditor(c);let{selectAll:d,caretPosition:e}=r.current;if(d)c.chain().focus().selectAll().run();else if(e){let a=c.view.posAtCoords({left:e.x,top:e.y})?.pos;a?c.chain().focus().setTextSelection(a).run():c.chain().focus().selectAll().run()}},editorProps:{handleKeyDown:(a,b)=>{i||"Tab"!==b.key||function(a,b,c){c.preventDefault();let d=a.getRichTextEditor();if(d?.isActive("bulletList")||d?.isActive("orderedList"))return;let{state:e,dispatch:f}=b,{$from:g,$to:h}=e.selection,i=c.shiftKey,j=e.tr,k=h.end();for(;k>=g.start();){let a=e.doc.resolve(k).blockRange();if(!a)break;let b=a.start,c=a.end,d=e.doc.textBetween(b,c,"\n"),f=!1;e.doc.nodesBetween(b,c,a=>{if("bulletList"===a.type.name||"orderedList"===a.type.name)return f=!0,!1}),!f&&(i?d.startsWith("	")&&(j=j.delete(b+1,b+2)):j=j.insertText("	",b+1)),k=b-1}let l=e.selection.map(j.doc,j.mapping);j.setSelection(l),j.docChanged&&f(j)}(l,a,b),t(b)},handlePaste:(a,b)=>{if(y(b),b.defaultPrevented)return!0},handleDoubleClick:(a,b,c)=>w(c),...c},coreExtensionOptions:{clipboardTextSerializer:{blockSeparator:"\n"}},...d,content:o.current}),f=l.timers.setTimeout(()=>{r.current.caretPosition||r.current.selectAll?e.commands.focus():e.commands.focus("end"),r.current.selectAll=!1,r.current.caretPosition=null},100);return p.current=e,()=>{p.current=null,clearTimeout(f),e.destroy()}},[b,n,u,v,w,s,y,t,l,a,i]),b&&n)?(0,bT.jsx)("div",{id:m,ref:k,tabIndex:-1,"data-testid":"rich-text-area",className:"tl-rich-text tl-text tl-text-input",onContextMenu:b?a=>a.stopPropagation():void 0,onPointerDownCapture:a=>a.stopPropagation(),onTouchEnd:a=>a.stopPropagation(),onDragStart:kb,children:(0,bT.jsx)("div",{className:"tl-rich-text",ref:q})}):null});function XP(a,b){return e$("isReadyForEditing",()=>{let c=a.getEditingShapeId();return null!==c&&(c===b||a.getHoveredShapeId()===b)},[a,b])}let XQ=eQ.default.memo(function({shapeId:a,type:b,richText:c,labelColor:d,font:e,fontSize:f,lineHeight:g,align:h,verticalAlign:i,wrap:j,isSelected:k,padding:l=0,onKeyDown:m,classNamePrefix:n,style:o,textWidth:p,textHeight:q,hasCustomTabBehavior:r}){var s;let t,u,v,w,y,z,A,B,C,D,E=kp(),F=eQ.default.useRef(!1),{rInput:G,isEmpty:H,isEditing:I,isReadyForEditing:J,...K}=(s=a,u=e$("isEditing",()=>t.getEditingShapeId()===s,[t=kp()]),v=XP(t,s),w=(0,eQ.useCallback)(a=>{t.dispatch({...kh(t,a),type:"pointer",name:"pointer_down",target:"shape",shape:t.getShape(s)}),a.stopPropagation()},[t,s]),y=(0,eQ.useCallback)(a=>{if(t.getEditingShapeId()===s&&a.clipboardData){let b=a.clipboardData.getData("text/html");b&&b.includes("<div data-tldraw")&&kb(a)}},[t,s]),A=(z={handleFocus:cd,handleBlur:cd,handleInputPointerDown:w,handleDoubleClick:t.markEventAsHandled,handlePaste:y,isEditing:u,isReadyForEditing:v}).isEditing,B=kp(),C=(0,eQ.useRef)(null),D=c&&Xc(c),(0,eQ.useEffect)(()=>{if(!A)return;let a=C.current?.querySelector("[contenteditable]");a&&document.activeElement!==C.current&&a.focus()},[B,A]),{rInput:C,handleKeyDown:(0,eQ.useCallback)(b=>{B.getEditingShapeId()===a&&"Enter"===b.key&&kg(b)&&B.complete()},[B,a]),handleChange:(0,eQ.useCallback)(({richText:c})=>{B.getEditingShapeId()===a&&B.updateShape({id:a,type:b,props:{richText:c}})},[B,a,b]),isEmpty:D,...z}),L=(0,eQ.useMemo)(()=>{if(c)return W9(E,c)},[E,c]),M=e$("isSelectToolActive",()=>"select"===E.getCurrentToolId(),[E]);eZ("isDragging",()=>{E.getInstanceState(),F.current=E.inputs.isDragging},[E]);let N="start-legacy"===h||"middle-legacy"===h||"end-legacy"===h;if(!I&&H)return null;let O=n||"tl-text";return(0,bT.jsx)("div",{className:`${O}-label tl-text-wrapper tl-rich-text-wrapper`,"aria-hidden":!I,"data-font":e,"data-align":h,"data-hastext":!H,"data-isediting":I,"data-textwrap":!!j,"data-isselected":k,style:{justifyContent:"middle"===h||N?"center":h,alignItems:"middle"===i?"center":i,padding:l,...o},children:(0,bT.jsxs)("div",{className:`${O}-label__inner tl-text-content__wrapper`,style:{fontSize:f,lineHeight:g.toString(),minHeight:Math.floor(f*g)+"px",minWidth:Math.ceil(p||0),color:d,width:p?Math.ceil(p):void 0,height:q?Math.ceil(q):void 0},children:[(0,bT.jsx)("div",{className:`${O} tl-text tl-text-content`,dir:"auto",children:c&&(0,bT.jsx)("div",{className:"tl-rich-text","data-is-select-tool-active":M,dangerouslySetInnerHTML:{__html:L||""},onPointerDown:a=>{if(a.target instanceof HTMLElement&&("A"===a.target.tagName||a.target.closest("a"))){if(kb(a),!M)return;let b=a.target.closest("a")?.getAttribute("href")??"",c=a=>{"pointer_up"===a.name&&b&&(F.current||zw(b,"_blank",!1),E.off("event",c))};E.on("event",c)}},"data-is-ready-for-editing":J})}),(J||k)&&(0,bT.jsx)(XO,{ref:G,richText:c,isEditing:I,shapeId:a,...K,hasCustomTabBehavior:r,handleKeyDown:m??K.handleKeyDown})]})})});function XR({bounds:a,richText:b,fontSize:c,font:d,align:e,verticalAlign:f,wrap:g,labelColor:h,padding:i,showTextOutline:j=!0}){let k=W9(kp(),b),l={display:"flex",fontFamily:ht[d],height:"100%",justifyContent:"middle"===e?"center":"start"===e?"flex-start":"flex-end",alignItems:"middle"===f?"center":"start"===f?"flex-start":"flex-end",padding:`${i}px`},m={fontSize:`${c}px`,wrap:g?"wrap":"nowrap",color:h,lineHeight:Rr.lineHeight,textAlign:"middle"===e?"center":"start"===e?"start":"end",width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",textShadow:j?"var(--tl-text-outline)":"none"};return(0,bT.jsx)("foreignObject",{x:a.minX,y:a.minY,width:a.w,height:a.h,className:"tl-export-embed-styles tl-rich-text tl-rich-text-svg",children:(0,bT.jsx)("div",{style:l,children:(0,bT.jsx)("div",{dangerouslySetInnerHTML:{__html:k},style:m})})})}function XS(a){return{key:`${hs.id}:${a}`,getElement:async()=>"pattern"!==a?null:(0,bT.jsx)(XT,{})}}function XT(){let a=XZ(),b=kj(),c=Mp(),d=8/12;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)("mask",{id:b,children:[(0,bT.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),(0,bT.jsxs)("g",{strokeLinecap:"round",stroke:"black",children:[(0,bT.jsx)("line",{x1:+d,y1:3*d,x2:3*d,y2:+d}),(0,bT.jsx)("line",{x1:5*d,y1:7*d,x2:7*d,y2:5*d}),(0,bT.jsx)("line",{x1:9*d,y1:11*d,x2:11*d,y2:9*d})]})]}),(0,bT.jsx)("pattern",{id:a(1,c.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,bT.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:c.solid,mask:`url(#${b})`})})]})}function XU(){return{key:`${hs.id}:pattern`,component:X_}}let XV=(a,b,c)=>new Promise((d,e)=>{let f=8*b*a,g=document.createElement("canvas");g.width=f,g.height=f;let h=g.getContext("2d");if(!h)return;h.fillStyle=c?hk.darkMode.solid:hk.lightMode.solid,h.fillRect(0,0,f,f),h.globalCompositeOperation="destination-out",h.lineCap="round",h.lineWidth=1.25*b*a;let i=8/12;h.beginPath(),h.moveTo(i*b*a,3*i*b*a),h.lineTo(3*i*b*a,i*b*a),h.moveTo(5*i*b*a,7*i*b*a),h.lineTo(7*i*b*a,5*i*b*a),h.moveTo(9*i*b*a,11*i*b*a),h.lineTo(11*i*b*a,9*i*b*a),h.stroke(),g.toBlob(a=>{!a||j7.throwToBlob.get()?e():d(a)})}),XW=(a,b)=>{let c=document.createElement("canvas");c.width=a[0],c.height=a[1];let d=c.getContext("2d");return d?(b(d),c.toDataURL()):""},XX=null;function XY(a){return Math.ceil(Math.log2(Math.max(1,a)))}function XZ(){let a=kk("hash_pattern");return(0,eQ.useCallback)((b,c)=>{let d=XY(b);return ki(a,`${c}_${d}`)},[a])}function X$(a){let b=[],c=XY(a);for(let a=0;a<=c;a++)b.push(Math.pow(2,a));return b}function X_(){let a=kp(),b=(0,eQ.useRef)(null),{defs:c,isReady:d}=function(){let a=kp(),b=e$("devicePixelRatio",()=>a.getInstanceState().devicePixelRatio,[a]),c=e$("maxZoom",()=>Math.ceil(b6(a.getCameraOptions().zoomSteps)),[a]),[d,e]=(0,eQ.useState)(!1),[f,g]=(0,eQ.useState)(()=>{let a;return XX||(XX={white:XW([1,1],a=>{a.fillStyle="#f8f9fa",a.fillRect(0,0,1,1)}),black:XW([1,1],a=>{a.fillStyle="#212529",a.fillRect(0,0,1,1)})}),a=XX,X$(c).flatMap(b=>[{zoom:b,url:a.white,theme:"light"},{zoom:b,url:a.black,theme:"dark"}])}),h=XZ();return(0,eQ.useEffect)(()=>{let a=Promise.all(X$(c).flatMap(a=>[XV(b,a,!1).then(b=>({zoom:a,theme:"light",url:URL.createObjectURL(b)})),XV(b,a,!0).then(b=>({zoom:a,theme:"dark",url:URL.createObjectURL(b)}))])),d=!1;return a.then(a=>{d||(g(a),e(!0))}),()=>{d=!0,e(!1),a.then(a=>{for(let{url:b}of a)URL.revokeObjectURL(b)})}},[b,c]),{defs:(0,bT.jsx)(bT.Fragment,{children:f.map(a=>{let b=h(a.zoom,a.theme);return(0,bT.jsx)("pattern",{id:b,width:8,height:8,patternUnits:"userSpaceOnUse",children:(0,bT.jsx)("image",{href:a.url,width:8,height:8})},b)})}),isReady:d}}();return(0,eQ.useEffect)(()=>{d&&0},[a,d]),(0,bT.jsx)("g",{ref:b,"data-testid":d?"ready-pattern-fill-defs":void 0,children:c})}let X0=eQ.default.memo(function({theme:a,d:b,color:c,fill:d,scale:e}){switch(d){case"none":return null;case"solid":return(0,bT.jsx)("path",{fill:hp(a,c,"semi"),d:b});case"semi":return(0,bT.jsx)("path",{fill:a.solid,d:b});case"fill":return(0,bT.jsx)("path",{fill:hp(a,c,"fill"),d:b});case"pattern":return(0,bT.jsx)(X1,{theme:a,color:c,fill:d,d:b,scale:e});case"lined-fill":return(0,bT.jsx)("path",{fill:hp(a,c,"linedFill"),d:b})}});function X1({d:a,color:b,theme:c}){let d=kp(),e=mD(),f=e$("zoomLevel",()=>d.getZoomLevel(),[d]),g=XZ(),h=.18>=d.getZoomLevel();return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("path",{fill:hp(c,b,"pattern"),d:a}),(0,bT.jsx)("path",{fill:e?`url(#${g(1,c.id)})`:h?hp(c,b,"semi"):`url(#${g(f,c.id)})`,d:a})]})}function X2(a,b,c){switch(b.type){case"straight":return new zz().moveTo(b.start.point.x,b.start.point.y,{offset:0,roundness:0}).lineTo(b.end.point.x,b.end.point.y,{offset:0,roundness:0}).toSvg(c);case"arc":return new zz().moveTo(b.start.point.x,b.start.point.y,{offset:0,roundness:0}).circularArcTo(b.bodyArc.radius,!!b.bodyArc.largeArcFlag,!!b.bodyArc.sweepFlag,b.end.point.x,b.end.point.y,{offset:0,roundness:0}).toSvg(c);case"elbow":{let a=new zz;a.moveTo(b.start.point.x,b.start.point.y,{offset:0});for(let c=1;c<b.route.points.length;c++){let d=b.route.points[c];b.route.skipPointsWhenDrawing.has(d)||a.lineTo(d.x,d.y,{offset:c===b.route.points.length-1?0:void 0})}return a.toSvg(c)}default:cf(b,"type")}}function X3(a,b){let c=JQ(a,b);switch(c.type){case"straight":return new lx({start:jA.From(c.start.point),end:jA.From(c.end.point)});case"arc":return new sD({center:jA.Cast(c.handleArc.center),start:jA.Cast(c.start.point),end:jA.Cast(c.end.point),sweepFlag:c.bodyArc.sweepFlag,largeArcFlag:c.bodyArc.largeArcFlag});case"elbow":return new ly({points:c.route.points});default:cf(c,"type")}}a.i(80011),a.s(["AtomMap",()=>fF,"IncrementalSetConstructor",()=>fH,"MigrationFailureReason",()=>fO,"RecordType",()=>fU,"Store",()=>f2,"StoreQueries",()=>f_,"StoreSchema",()=>f5,"StoreSideEffects",()=>f0,"assertIdType",()=>fW,"createComputedCache",()=>f4,"createEmptyRecordsDiff",()=>fP,"createMigrationIds",()=>fJ,"createMigrationSequence",()=>fI,"createRecordMigrationSequence",()=>fK,"createRecordType",()=>fV,"devFreeze",()=>fG,"isRecordsDiffEmpty",()=>fR,"parseMigrationId",()=>fL,"reverseRecordsDiff",()=>fQ,"squashRecordDiffs",()=>fS,"squashRecordDiffsMutable",()=>fT],62402);let X4=f4("arrow label size",(a,b)=>{a.fonts.trackFontsForShape(b);let c=0,d=0,e=X3(a,b),f=Xa(a,Xc(b.props.richText)?g6("i"):b.props.richText),g=e.bounds,h=X9(b),{w:i,h:j}=a.textMeasure.measureHtml(f,{...Rr,fontFamily:Rw[b.props.font],fontSize:h,maxWidth:null});c=i,d=j;let k=!1,l=JQ(a,b),m=X6(b),n="elbow"===l.type?Math.max(l.elbow.A.arrowheadOffset+m,32)+Math.max(l.elbow.B.arrowheadOffset+m,32):64;if(g.width>g.height?(c=Math.max(Math.min(i,n),Math.min(g.width-n,i)),k=!0):c>16*h&&(c=16*h,k=!0),k){let{w:e,h:g}=a.textMeasure.measureHtml(f,{...Rr,fontFamily:Rw[b.props.font],fontSize:h,maxWidth:c});c=e,d=g}return new jA(c,d).addScalar(8.5*b.props.scale)},{areRecordsEqual:(a,b)=>{if(a.props===b.props)return!0;let c=c4(a.props,b.props);return 1===c.length&&"labelPosition"===c[0]}});function X5(a,b){return X4.get(a,b.id)??new jA(0,0)}function X6(a){let b=Rs[a.props.size];return(20+(b-Rs.s)*2+20*(b===Rs.xl))*a.props.scale}function X7(a,b){if(a.getEditingShapeId()!==b.id&&Xc(b.props.richText)){let c=X3(a,b).interpolateAlongEdge(.5);return{box:lh.FromCenter(c,new jA(0,0)),debugGeom:[]}}let c=[],d=JQ(a,b),e={hasStartBinding:!!d.bindings.start,hasEndBinding:!!d.bindings.end,hasStartArrowhead:"none"!==d.start.arrowhead,hasEndArrowhead:"none"!==d.end.arrowhead},f=function(a,b,c){let d,e,f=X3(a,b),g=[],h=[new lw({children:[f],debugColor:"lime"})],i=X5(a,b),j=X6(b),k=j/f.length;if("elbow"===c.type)g.push(c.start.point,c.end.point),d=lh.FromCenter(c.start.point,i).expandBy(j),e=lh.FromCenter(c.end.point,i).expandBy(j);else{let a=f.interpolateAlongEdge(k),b=f.interpolateAlongEdge(1-k);g.push(a,b),d=lh.FromCenter(a,i),e=lh.FromCenter(b,i)}let l=f.intersectPolygon(d.corners),m=f.intersectPolygon(e.corners),n=X8(c.start.point,l),o=X8(c.end.point,m),p=n?f.uninterpolateAlongEdge(n):.5,q=o?f.uninterpolateAlongEdge(o):.5;for(let a of(p>q&&(p=.5,q=.5),[...l,...m,...g]))h.push(new sE({x:a.x-3,y:a.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));return h.push(new lz({points:d.corners,debugColor:"lime",isFilled:!1,ignore:!0}),new lz({points:e.corners,debugColor:"lime",isFilled:!1,ignore:!0})),{start:p,end:q,dbg:h}}(a,b,d);f.dbg&&c.push(...f.dbg);let g=function(a,b,c){let{hasEndArrowhead:d,hasEndBinding:e,hasStartBinding:f,hasStartArrowhead:g}=c;return jI(a.props.labelPosition,g||f?b.start:0,d||e?b.end:1)}(b,f,e),h=X3(a,b).interpolateAlongEdge(g),i=X5(a,b);return{box:lh.FromCenter(h,i),debugGeom:c}}function X8(a,b){let c=null,d=-1/0;for(let e of b){let b=jA.Dist2(a,e);b>d&&(c=e,d=b)}return c}function X9(a){return Rv[a.props.size]*a.props.scale}function Ya(a,b){let c=JQ(a,b);switch(c.type){case"straight":case"arc":return .5;case"elbow":{let d=c.route.midpointHandle,e=X3(a,b);if(d&&e)return e.uninterpolateAlongEdge(d.point);return .5}default:cf(c,"type")}}function Yb(a,b){if(!a.isShapeOfType(b,"arrow"))return!1;let c=a.getPointInShapeSpace(b,a.inputs.currentPagePoint),d=a.getShapeGeometry(b).children[1];return d&&jW(c,d.vertices)}function Yc(a,b,c){let d="end"===b?a.end.arrowhead:a.start.arrowhead;if("none"===d)return;let e=function(a,b,c){let d,e="end"===b?a.end.point:a.start.point;switch(a.type){case"straight":{let f="end"===b?a.start.point:a.end.point,g=jI(jA.Dist(f,e)/5,c,3*c);d=jA.Nudge(e,f,g);break}case"arc":{var f,g;let h,i,j,k,l,m=jI(Math.abs(a.bodyArc.length)/5,c,3*c),n=(f=a.handleArc.center,g=a.handleArc.radius,k=((j=Math.sqrt((h=f.x-e.x)*h+(i=f.y-e.y)*i))*j-g*g+m*m)/(2*j),l=Math.sqrt(m*m-k*k),h/=j,i/=j,[new jA(e.x+h*k-i*l,e.y+i*k+h*l),new jA(e.x+h*k+i*l,e.y+i*k-h*l)]);d="end"===b?a.handleArc.sweepFlag?n[0]:n[1]:a.handleArc.sweepFlag?n[1]:n[0];break}case"elbow":{let f="end"===b?a.route.points[a.route.points.length-2]:a.route.points[1],g=jI(jA.ManhattanDist(f,e)/2,c,3*c);d=f?jA.Nudge(e,f,g):e;break}default:cf(a,"type")}return jA.IsNaN(d)&&(d=e),{point:e,int:d}}(a,b,c);switch(d){case"bar":return function({int:a,point:b}){let c=jA.Sub(a,b).div(2),d=jA.Add(b,jA.Rot(c,jF)),e=jA.Sub(b,jA.Rot(c,jF));return`M ${d.x} ${d.y} L ${e.x} ${e.y}`}(e);case"square":return function({int:a,point:b}){let c=jA.Lrp(b,a,.85),d=jA.Sub(c,b).div(2),e=jA.Add(b,jA.Rot(d,jF)),f=jA.Sub(b,jA.Rot(d,jF)),g=jA.Add(c,jA.Rot(d,jF)),h=jA.Sub(c,jA.Rot(d,jF));return`M ${e.x} ${e.y} L ${g.x} ${g.y} L ${h.x} ${h.y} L ${f.x} ${f.y} Z`}(e);case"diamond":return function({point:a,int:b}){let c=jA.Lrp(a,b,.75),d=jA.RotWith(c,a,jE/4),e=jA.RotWith(c,a,-jE/4),f=jA.Lrp(d,e,.5);return f.add(jA.Sub(f,a)),`M ${f.x} ${f.y} L ${e.x} ${e.y} ${a.x} ${a.y} L ${d.x} ${d.y} Z`}(e);case"dot":return function({point:a,int:b}){let c=jA.Lrp(a,b,.45),d=jA.Dist(c,a);return`M ${c.x-d},${c.y}
  a ${d},${d} 0 1,0 ${2*d},0
  a ${d},${d} 0 1,0 -${2*d},0 `}(e);case"inverted":return function({point:a,int:b}){let c=jA.Sub(b,a).div(2),d=jA.Add(a,jA.Rot(c,jF)),e=jA.Sub(a,jA.Rot(c,jF));return`M ${d.x} ${d.y} L ${b.x} ${b.y} L ${e.x} ${e.y} Z`}(e);case"arrow":return function({point:a,int:b}){let c=jA.RotWith(b,a,jE/6),d=jA.RotWith(b,a,-jE/6);return`M ${c.x} ${c.y} L ${a.x} ${a.y} L ${d.x} ${d.y}`}(e);case"triangle":return function({point:a,int:b}){let c=jA.RotWith(b,a,jE/6),d=jA.RotWith(b,a,-jE/6);return`M ${c.x} ${c.y} L ${d.x} ${d.y} L ${a.x} ${a.y} Z`}(e)}return""}function Yd({arrow:a}){let b=kp(),c=e$("elbow arrow grid",()=>{try{return JC(b,b.getShape(a.id),JO(b,a))}catch(a){console.error(a);return}},[b,a.id]);if(!c)return null;let d=lh.Common([c.A.original,c.B.original]).expandBy(50),e=c.route?.name??"",f=c.route?.midpointHandle;return(0,bT.jsxs)(bT.Fragment,{children:[null!==c.midX&&(0,bT.jsx)(Ye,{a:{x:c.midX,y:d.minY},b:{x:c.midX,y:d.maxY},stroke:"red"}),null!==c.midY&&(0,bT.jsx)(Ye,{a:{x:d.minX,y:c.midY},b:{x:d.maxX,y:c.midY},stroke:"blue"}),f?.axis==="x"&&c.midXRange&&(0,bT.jsx)(Ye,{a:{x:c.midXRange.lo,y:f.point.y},b:{x:c.midXRange.hi,y:f.point.y},stroke:"red",strokeDasharray:"0 2"}),f?.axis==="y"&&c.midYRange&&(0,bT.jsx)(Ye,{a:{x:f.point.x,y:c.midYRange.lo},b:{x:f.point.x,y:c.midYRange.hi},stroke:"blue",strokeDasharray:"0 2"}),(0,bT.jsx)(Yh,{box:c.A.original,stroke:"orange"}),(0,bT.jsx)(Yh,{box:c.A.expanded,stroke:"orange",strokeWidth:.5}),(0,bT.jsx)(Yh,{box:c.A.original.clone().expandBy(c.options.minElbowLegLength),stroke:"orange",strokeWidth:.5}),(0,bT.jsx)(Yh,{box:c.B.original,stroke:"lightskyblue"}),(0,bT.jsx)(Yh,{box:c.B.expanded,stroke:"lightskyblue",strokeWidth:.5}),(0,bT.jsx)(Yh,{box:c.B.original.clone().expandBy(c.options.minElbowLegLength),stroke:"lightskyblue",strokeWidth:.5}),(0,bT.jsx)(Yg,{edge:c.A.edges.top,axis:"x",stroke:"orange"}),(0,bT.jsx)(Yg,{edge:c.B.edges.top,axis:"x",stroke:"lightskyblue"}),(0,bT.jsx)(Yg,{edge:c.A.edges.right,axis:"y",stroke:"orange"}),(0,bT.jsx)(Yg,{edge:c.B.edges.right,axis:"y",stroke:"lightskyblue"}),(0,bT.jsx)(Yg,{edge:c.A.edges.bottom,axis:"x",stroke:"orange"}),(0,bT.jsx)(Yg,{edge:c.B.edges.bottom,axis:"x",stroke:"lightskyblue"}),(0,bT.jsx)(Yg,{edge:c.A.edges.left,axis:"y",stroke:"orange"}),(0,bT.jsx)(Yg,{edge:c.B.edges.left,axis:"y",stroke:"lightskyblue"}),c.route&&(0,bT.jsx)(Yf,{route:c.route.points,strokeWidth:10}),(0,bT.jsx)("text",{x:d.minX+5,y:d.minY-3,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:e}),(0,bT.jsxs)("text",{x:c.A.expanded.x,y:c.A.expanded.y,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:["A",c.route&&`, ${c.route.aEdgePicking}`,c.A.isPoint&&", point"]}),(0,bT.jsxs)("text",{x:c.B.expanded.x,y:c.B.expanded.y,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:["B",c.route&&`, ${c.route.bEdgePicking}`,c.B.isPoint&&", point"]})]})}function Ye({a,b,...c}){return(0,bT.jsx)("line",{fill:"none",strokeWidth:1,strokeDasharray:"4,4",stroke:"green",x1:a.x,y1:a.y,x2:b.x,y2:b.y,...c})}function Yf({route:a,...b}){return(0,bT.jsx)("polyline",{fill:"none",stroke:"darkorchid",strokeWidth:3,opacity:.5,points:a.map(a=>`${a.x},${a.y}`).join(" "),...b})}function Yg({edge:a,axis:b,...c}){if(!a||null===a.expanded)return null;let d=a=>"x"===b?{x:a.y,y:a.x}:a;return(0,bT.jsxs)("g",{children:[(0,bT.jsx)(Ye,{a:d({x:a.expanded,y:a.cross.min}),b:d({x:a.expanded,y:a.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...c}),(0,bT.jsx)(Ye,{a:d({x:a.expanded-4,y:a.cross.min}),b:d({x:a.expanded+4,y:a.cross.min}),strokeDasharray:"0",strokeWidth:1.5,...c}),(0,bT.jsx)(Ye,{a:d({x:a.expanded-4,y:a.cross.max}),b:d({x:a.expanded+4,y:a.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...c})]})}function Yh({box:a,...b}){return(0,bT.jsx)("rect",{x:a.minX,y:a.minY,width:a.width,height:a.height,strokeDasharray:"4,4",strokeWidth:1,fill:"none",...b})}let Yi=new cl;function Yj(a,b){let c=jA.FromAngle(b).per();return jA.Dpr(a,c)}var Yk=((A=Yk||{}).Start="start",A.Middle="middle",A.End="end",A);class Yl extends lC{static type="arrow";static props=hz;static migrations=hC;options={expandElbowLegLength:{s:28,m:36,l:44,xl:66},minElbowLegLength:{s:3*Rs.s,m:3*Rs.m,l:3*Rs.l,xl:3*Rs.xl},minElbowHandleDistance:16,arcArrowCenterSnapDistance:16,elbowArrowCenterSnapDistance:24,elbowArrowEdgeSnapDistance:20,elbowArrowPointSnapDistance:24,elbowArrowAxisSnapDistance:16,labelCenterSnapDistance:10,elbowMidpointSnapDistance:10,elbowMinSegmentLengthToShowMidpointHandle:20,hoverPreciseTimeout:600,pointingPreciseTimeout:320,shouldBeExact:a=>a.inputs.altKey,shouldIgnoreTargets:a=>a.inputs.ctrlKey};canEdit(){return!0}canBind({toShapeType:a}){return"arrow"!==a}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}hideInMinimap(){return!0}canBeLaidOut(a,b){if("flip"===b.type){let{start:c,end:d}=JO(this.editor,a),{shapes:e=[]}=b;if(c&&!e.find(a=>a.id===c.toId)||d&&!e.find(a=>a.id===d.toId))return!1}return!0}getFontFaces(a){return Xc(a.props.richText)?ea:zv(this.editor,a.props.richText,{family:`tldraw_${a.props.font}`,weight:"normal",style:"normal"})}getDefaultProps(){return{kind:"arc",elbowMidPoint:.5,dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",richText:g6(""),labelPosition:.5,font:"draw",scale:1}}getGeometry(a){let b,c=this.editor.getEditingShapeId()===a.id,d=JQ(this.editor,a),e=[],f="straight"===d.type?new lx({start:jA.From(d.start.point),end:jA.From(d.end.point)}):"arc"===d.type?new sD({center:jA.Cast(d.handleArc.center),start:jA.Cast(d.start.point),end:jA.Cast(d.end.point),sweepFlag:d.bodyArc.sweepFlag,largeArcFlag:d.bodyArc.largeArcFlag}):new ly({points:d.route.points});if(c||!Xc(a.props.richText)){let c=X7(this.editor,a);j7.debugGeometry.get()&&e.push(...c.debugGeom),b=new lA({x:c.box.x,y:c.box.y,width:c.box.w,height:c.box.h,isFilled:!0,isLabel:!0})}return new lw({children:[...b?[f,b]:[f],...e]})}getHandles(a){let b=JQ(this.editor,a),c=[{id:"start",type:"vertex",index:"a1",x:b.start.handle.x,y:b.start.handle.y},{id:"end",type:"vertex",index:"a3",x:b.end.handle.x,y:b.end.handle.y}];if("arc"===a.props.kind&&("straight"===b.type||"arc"===b.type)&&c.push({id:"middle",type:"virtual",index:"a2",x:b.middle.x,y:b.middle.y}),"elbow"===a.props.kind&&"elbow"===b.type&&b.route.midpointHandle){let d=this.editor.getShapePageTransform(a.id),e=d.applyToPoint(b.route.midpointHandle.segmentStart),f=d.applyToPoint(b.route.midpointHandle.segmentEnd);jA.Dist(e,f)*this.editor.getZoomLevel()>this.options.elbowMinSegmentLengthToShowMidpointHandle&&c.push({id:"middle",type:"vertex",index:"a2",x:b.route.midpointHandle.point.x,y:b.route.midpointHandle.point.y})}return c}getText(a){return Xd(this.editor,a.props.richText)}onHandleDrag(a,b){let c=b.handle.id;switch(c){case"middle":switch(a.props.kind){case"arc":return this.onArcMidpointHandleDrag(a,b);case"elbow":return this.onElbowMidpointHandleDrag(a,b);default:cf(a.props.kind)}case"start":case"end":return this.onTerminalHandleDrag(a,b,c);default:cf(c)}}onArcMidpointHandleDrag(a,{handle:b}){let c=JO(this.editor,a),{start:d,end:e}=JR(this.editor,a,c),f=jA.Sub(e,d),g=jA.Per(f),h=jA.Med(e,d),i=jA.Sub(h,g),j=jA.Add(h,g),k=jA.NearestPointOnLineSegment(i,j,b,!1),l=jA.Dist(k,h);return jA.Clockwise(k,e,h)&&(l*=-1),{id:a.id,type:a.type,props:{bend:l}}}onElbowMidpointHandleDrag(a,{handle:b}){var c,d;let e=JQ(this.editor,a);if(e?.type!=="elbow")return;let f=this.editor.getShapePageTransform(a.id),g=f.applyToPoint(b),h=e.route.midpointHandle?.axis;if(!h)return;let i=Jf[h],j=e.elbow[i.midRange];if(!j)return;let k=jA.Angle(f.applyToPoint(i.v(0,0)),f.applyToPoint(i.v(0,1)));k<0&&(k+=Math.PI);let l=Yj(g,k),m=Yj(f.applyToPoint(i.v(j.lo,0)),k),n=Yj(f.applyToPoint(i.v(j.hi,0)),k),o=this.options.elbowMidpointSnapDistance/this.editor.getZoomLevel(),p=Yj(f.applyToPoint(i.v((c=j.lo)+(j.hi-c)*.5,0)),k),q=p,r=Math.abs(p-l);for(let[a,b]of(d=this.editor,Yi.get(d,a=>{let b=eB("current selected arrow shape",()=>{let b=a.getOnlySelectedShape();return b&&a.isShapeOfType(b,"arrow")?b.id:null}),c=a.store.query.ids("shape",()=>{let a=b.get();return a?{type:{eq:"arrow"},id:{neq:a}}:{type:{eq:"arrow"}}});return eB("elbow arrow snap lines",()=>{let b=new Map,d=a.getCurrentPageShapeIds(),e=a.getViewportPageBounds();for(let f of c.get()){if(!d.has(f))continue;let c=a.getShape(f);if(c?.type!=="arrow")continue;let g=a.getShapePageBounds(f);if(!g||!e.includes(g))continue;let h=JO(a,c),i=a.getShapePageTransform(f);if(!i)continue;let j=a.getShapeGeometry(f),k=i.applyToPoints(j.vertices);for(let a=1;a<k.length;a++){let c=k[a-1],d=k[a],e=jA.Angle(c,d);e<0&&(e+=Math.PI);let f=b.get(e);f||(f=new Set,b.set(e,f));let g=Yj(c,e);f.add({perpDistance:g,startBoundShapeId:h.start?.toId,endBoundShapeId:h.end?.toId})}}return b})}).get())){let{isParallel:c,isFlippedParallel:d}=function(a,b,c=1e-4){let d=Math.abs(a-b),e=Math.abs(d-Math.PI)<c,f=Math.abs(d-jG)<c;return{isParallel:d<c||f,isFlippedParallel:e}}(k,a);if(c||d)for(let a of b){let b=a.startBoundShapeId&&(a.startBoundShapeId===e.bindings.start?.toId||a.startBoundShapeId===e.bindings.end?.toId),c=a.endBoundShapeId&&(a.endBoundShapeId===e.bindings.start?.toId||a.endBoundShapeId===e.bindings.end?.toId);if(!b&&!c)continue;let f=d?-a.perpDistance:a.perpDistance,g=Math.abs(f-l);g<r&&(q=f,r=g)}}r>o&&(q=l);let s=jI((q-m)/(n-m),0,1);return{id:a.id,type:a.type,props:{elbowMidPoint:s}}}onTerminalHandleDrag(a,{handle:b,isPrecise:c},d){let e=JO(this.editor,a),f={id:a.id,type:"arrow",props:{}},g=e[d],h=e["start"===d?"end":"start"],i=Q7({editor:this.editor,pointInPageSpace:this.editor.getShapePageTransform(a.id).applyToPoint(b),arrow:a,isPrecise:c,currentBinding:g,oppositeBinding:h});if(!i){JT(this.editor,a,d);let c=sy(new jA(b.x,b.y),this.editor);return f.props[d]={x:c.x,y:c.y},f}let j={terminal:d,normalizedAnchor:i.normalizedAnchor,isPrecise:i.isPrecise,isExact:i.isExact,snap:i.snap};JS(this.editor,a,i.target.id,j);let k=JO(this.editor,a);return k.start&&k.end&&k.start.toId===k.end.toId&&jA.Equals(k.start.props.normalizedAnchor,k.end.props.normalizedAnchor)&&JS(this.editor,a,k.end.toId,{...k.end.props,normalizedAnchor:{x:k.end.props.normalizedAnchor.x+.05,y:k.end.props.normalizedAnchor.y}}),f}onTranslateStart(a){let b=JO(this.editor,a);if("elbow"===a.props.kind&&this.editor.getOnlySelectedShapeId()===a.id){let c=JQ(this.editor,a);if(!c)return;let d={id:a.id,type:"arrow",props:{}};return b.start&&(d.props.start={x:c.start.point.x,y:c.start.point.y},JT(this.editor,a,"start")),b.end&&(d.props.end={x:c.end.point.x,y:c.end.point.y},JT(this.editor,a,"end")),d}let c=JR(this.editor,a,b),d=this.editor.getShapePageTransform(a.id),e=this.editor.getSelectedShapeIds();if(!(b.start&&(e.includes(b.start.toId)||this.editor.isAncestorSelected(b.start.toId))||b.end&&(e.includes(b.end.toId)||this.editor.isAncestorSelected(b.end.toId))))for(let e of(Yo.set(a,{pagePosition:d.applyToPoint(a),terminalBindings:c0(c,(a,c)=>{let e=b[a];return e?{binding:e,shapePosition:c,pagePosition:d.applyToPoint(c)}:null})}),b.start&&(Q1({editor:this.editor,arrow:a,terminal:"start",useHandle:!0}),a=this.editor.getShape(a.id)),b.end&&Q1({editor:this.editor,arrow:a,terminal:"end",useHandle:!0}),["start","end"])){let a=b[e];a&&this.editor.updateBinding({...a,props:{...a.props,isPrecise:!0}})}}onTranslate(a,b){let c=Yo.get(a);if(!c)return;let d=this.editor.getShapePageTransform(b.id),e=jA.Sub(d.applyToPoint(b),c.pagePosition);for(let a of Object.values(c.terminalBindings)){if(!a)continue;let c=jA.Add(a.pagePosition,jA.Mul(e,.5)),d=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:a=>!a.isLocked&&this.editor.canBindShapes({fromShape:b,toShape:a,binding:"arrow"})});if(d?.id===a.binding.toId){let e=lh.ZeroFix(this.editor.getShapeGeometry(d).bounds),f=this.editor.getPointInShapeSpace(d,c),g={x:(f.x-e.minX)/e.width,y:(f.y-e.minY)/e.height};JS(this.editor,b,d.id,{...a.binding.props,normalizedAnchor:g,isPrecise:!0})}else JT(this.editor,b,a.binding.props.terminal)}}_resizeInitialBindings=new cl;onResize(a,b){let{scaleX:c,scaleY:d}=b,e=this._resizeInitialBindings.get(a,()=>JO(this.editor,a)),f=JR(this.editor,a,e),{start:g,end:h}=d$(a.props),{bend:i}=a.props;e.start||(g.x=f.start.x*c,g.y=f.start.y*d),e.end||(h.x=f.end.x*c,h.y=f.end.y*d);let j=Math.abs(c),k=Math.abs(d),l=e?.start?jA.From(e.start.props.normalizedAnchor):null,m=e?.end?jA.From(e.end.props.normalizedAnchor):null;return c<0&&d>=0?(0!==i&&(i*=-1*Math.max(j,k)),l&&(l.x=1-l.x),m&&(m.x=1-m.x)):c>=0&&d<0?(0!==i&&(i*=-1*Math.max(j,k)),l&&(l.y=1-l.y),m&&(m.y=1-m.y)):c>=0&&d>=0?0!==i&&(i*=Math.max(j,k)):c<0&&d<0&&(0!==i&&(i*=Math.max(j,k)),l&&(l.x=1-l.x,l.y=1-l.y),m&&(m.x=1-m.x,m.y=1-m.y)),e.start&&l&&JS(this.editor,a,e.start.toId,{...e.start.props,normalizedAnchor:l.toJson()}),e.end&&m&&JS(this.editor,a,e.end.toId,{...e.end.props,normalizedAnchor:m.toJson()}),{props:{start:g,end:h,bend:i}}}onDoubleClickHandle(a,b){switch(b.id){case"start":return{id:a.id,type:a.type,props:{...a.props,arrowheadStart:"none"===a.props.arrowheadStart?"arrow":"none"}};case"end":return{id:a.id,type:a.type,props:{...a.props,arrowheadEnd:"none"===a.props.arrowheadEnd?"arrow":"none"}}}}component(a){let b=Mp(),c=this.editor.getOnlySelectedShape(),d=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),e=JQ(this.editor,a);if(!e?.isValid)return null;let f=X7(this.editor,a),g=a.id===this.editor.getOnlySelectedShapeId(),h=this.editor.getEditingShapeId()===a.id||!Xc(a.props.richText);return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)(lg,{style:{minWidth:50,minHeight:50},children:[(0,bT.jsx)(Ym,{shape:a,shouldDisplayHandles:d&&c?.id===a.id}),"elbow"===a.props.kind&&j7.debugElbowArrows.get()&&(0,bT.jsx)(Yd,{arrow:a})]}),h&&(0,bT.jsx)(XQ,{shapeId:a.id,type:"arrow",font:a.props.font,fontSize:X9(a),lineHeight:Rr.lineHeight,align:"middle",verticalAlign:"middle",labelColor:hp(b,a.props.labelColor,"solid"),richText:a.props.richText,textWidth:f.box.w-8.5*a.props.scale,isSelected:g,padding:0,style:{transform:`translate(${f.box.center.x}px, ${f.box.center.y}px)`}})]})}indicator(a){let b=sA(a.id),c=kk(a.id+"_clip"),d=JQ(this.editor,a);if(!d)return null;let{start:e,end:f}=JR(this.editor,a,d?.bindings),g=this.editor.getShapeGeometry(a),h=g.bounds,i=Xc(a.props.richText),j=b||!i?g.children[1]:null;if(jA.Equals(e,f))return null;let k=Rs[a.props.size]*a.props.scale,l=d.start.arrowhead&&Yc(d,"start",k),m=d.end.arrowhead&&Yc(d,"end",k),n=l&&"arrow"!==d.start.arrowhead||m&&"arrow"!==d.end.arrowhead||!!j,o=j?j.getBounds():new lh(0,0,0,0);if(b&&j)return(0,bT.jsx)("rect",{x:jX(o.x),y:jX(o.y),width:o.w,height:o.h,rx:3.5*a.props.scale,ry:3.5*a.props.scale});let p="none"!==d.start.arrowhead&&"arrow"!==d.start.arrowhead,q="none"!==d.end.arrowhead&&"arrow"!==d.end.arrowhead;return(0,bT.jsxs)("g",{children:[n&&(0,bT.jsx)("defs",{children:(0,bT.jsx)(Yn,{radius:3.5*a.props.scale,hasText:!i,bounds:h,labelBounds:o,as:p&&l?l:"",ae:q&&m?m:""})}),(0,bT.jsxs)("g",{style:{clipPath:n?`url(#${c})`:void 0,WebkitClipPath:n?`url(#${c})`:void 0},children:[n&&(0,bT.jsx)("rect",{x:h.minX-100,y:h.minY-100,width:h.width+200,height:h.height+200,opacity:0}),X2(a,d,"draw"===a.props.dash?{style:"draw",randomSeed:a.id,strokeWidth:1,passes:1,offset:0,roundness:2*k,props:{strokeWidth:void 0}}:{style:"solid",strokeWidth:1,props:{strokeWidth:void 0}})]}),l&&(0,bT.jsx)("path",{d:l}),m&&(0,bT.jsx)("path",{d:m}),j&&(0,bT.jsx)("rect",{x:jX(o.x),y:jX(o.y),width:o.w,height:o.h,rx:3.5,ry:3.5})]})}onEditStart(a){if(Xc(a.props.richText)){let b=Ya(this.editor,a);this.editor.updateShape({id:a.id,type:a.type,props:{labelPosition:b}})}}toSvg(a,b){b.addExportDef(XS(a.props.fill));let c=hl(b),d=1/a.props.scale;return(0,bT.jsxs)("g",{transform:`scale(${d})`,children:[(0,bT.jsx)(Ym,{shape:a,shouldDisplayHandles:!1}),(0,bT.jsx)(XR,{fontSize:X9(a),font:a.props.font,align:"middle",verticalAlign:"middle",labelColor:hp(c,a.props.labelColor,"solid"),richText:a.props.richText,bounds:X7(this.editor,a).box.clone().expandBy(-4.25*a.props.scale),padding:0,showTextOutline:!0})]})}getCanvasSvgDefs(){return[XU(),{key:"arrow:dot",component:Yp},{key:"arrow:cross",component:Yq}]}getInterpolatedProps(a,b,c){var d,e,f,g,h,i,j;return{...c>.5?b.props:a.props,scale:(d=a.props.scale,d+(b.props.scale-d)*c),start:{x:(e=a.props.start.x,e+(b.props.start.x-e)*c),y:(f=a.props.start.y,f+(b.props.start.y-f)*c)},end:{x:(g=a.props.end.x,g+(b.props.end.x-g)*c),y:(h=a.props.end.y,h+(b.props.end.y-h)*c)},bend:(i=a.props.bend,i+(b.props.bend-i)*c),labelPosition:(j=a.props.labelPosition,j+(b.props.labelPosition-j)*c)}}}let Ym=eV(function({shape:a,shouldDisplayHandles:b}){let c=kp(),d=Mp(),e=JQ(c,a),f=e$("force solid",()=>.2>c.getZoomLevel(),[c]),g=kk(a.id+"_clip"),h=kk("arrowhead-dot"),i=kk("arrowhead-cross"),j=sA(a.id),k=c.getShapeGeometry(a);if(!k)return null;let l=lh.ZeroFix(k.bounds),m=JO(c,a),n=Xc(a.props.richText);if(!e?.isValid)return null;let o=Rs[a.props.size]*a.props.scale,p=e.start.arrowhead&&Yc(e,"start",o),q=e.end.arrowhead&&Yc(e,"end",o),r=null;b&&(m.start||m.end)&&(r=function(a,b){switch(a.type){case"straight":return new zz().moveTo(a.start.handle.x,a.start.handle.y).lineTo(a.end.handle.x,a.end.handle.y).toSvg(b);case"arc":return new zz().moveTo(a.start.handle.x,a.start.handle.y).circularArcTo(a.handleArc.radius,!!a.handleArc.largeArcFlag,!!a.handleArc.sweepFlag,a.end.handle.x,a.end.handle.y).toSvg(b);case"elbow":{var c,d;let e,f,g,h,i,j,k,l=(c=a.elbow,d=a.route,e=c.swapOrder?c.B.target:c.A.target,f=c.swapOrder?c.A.target:c.B.target,g=jA.ManhattanDist(d.points[0],d.points[1]),h=jA.ManhattanDist(d.points[d.points.length-2],d.points[d.points.length-1]),i=jA.ManhattanDist(e,d.points[1]),j=jA.ManhattanDist(d.points[d.points.length-2],f),k=[e,...d.points,f],{name:d.name,distance:d.distance+(g-i)+(h-j),points:k.filter(a=>!d.skipPointsWhenDrawing.has(a)),aEdgePicking:d.aEdgePicking,bEdgePicking:d.bEdgePicking,skipPointsWhenDrawing:d.skipPointsWhenDrawing,midpointHandle:d.midpointHandle});return zz.lineThroughPoints(l.points).toSvg(b)}default:cf(a,"type")}}(e,{style:"dashed",start:"skip",end:"skip",lengthRatio:2.5,strokeWidth:2/c.getZoomLevel(),props:{className:"tl-arrow-hint",markerStart:m.start?m.start.props.isExact?"":m.start.props.isPrecise?`url(#${i})`:`url(#${h})`:"",markerEnd:m.end?m.end.props.isExact?"":m.end.props.isPrecise?`url(#${i})`:`url(#${h})`:"",opacity:.16}}));let s=X7(c,a),t="none"!==e.start.arrowhead&&"arrow"!==e.start.arrowhead,u="none"!==e.end.arrowhead&&"arrow"!==e.end.arrowhead;return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("defs",{children:(0,bT.jsx)("clipPath",{id:g,children:(0,bT.jsx)(Yn,{radius:3.5*a.props.scale,hasText:j||!n,bounds:l,labelBounds:s.box,as:t&&p?p:"",ae:u&&q?q:""})})}),(0,bT.jsxs)("g",{fill:"none",stroke:hp(d,a.props.color,"solid"),strokeWidth:o,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[r,(0,bT.jsxs)("g",{style:{clipPath:`url(#${g})`,WebkitClipPath:`url(#${g})`},children:[(0,bT.jsx)("rect",{x:jX(l.minX-100),y:jX(l.minY-100),width:jX(l.width+200),height:jX(l.height+200),opacity:0}),X2(a,e,{style:a.props.dash,strokeWidth:o,forceSolid:f,randomSeed:a.id})]}),p&&t&&"none"!==a.props.fill&&(0,bT.jsx)(X0,{theme:d,d:p,color:a.props.color,fill:a.props.fill,scale:a.props.scale}),q&&u&&"none"!==a.props.fill&&(0,bT.jsx)(X0,{theme:d,d:q,color:a.props.color,fill:a.props.fill,scale:a.props.scale}),p&&(0,bT.jsx)("path",{d:p}),q&&(0,bT.jsx)("path",{d:q})]})]})});function Yn({radius:a,hasText:b,bounds:c,labelBounds:d,as:e,ae:f}){let g=(0,eQ.useMemo)(()=>{let e=new zz;return e.moveTo(c.left-100,c.top-100).lineTo(c.right+100,c.top-100).lineTo(c.right+100,c.bottom+100).lineTo(c.left-100,c.bottom+100).close(),b&&e.moveTo(d.left,d.top+a).lineTo(d.left,d.bottom-a).circularArcTo(a,!1,!1,d.left+a,d.bottom).lineTo(d.right-a,d.bottom).circularArcTo(a,!1,!1,d.right,d.bottom-a).lineTo(d.right,d.top+a).circularArcTo(a,!1,!1,d.right-a,d.top).lineTo(d.left+a,d.top).circularArcTo(a,!1,!1,d.left,d.top+a).close(),e.toD()},[a,b,c.bottom,c.left,c.right,c.top,d.bottom,d.left,d.right,d.top]);return(0,bT.jsx)("path",{d:`${g}${e}${f}`})}let Yo=new WeakMap;function Yp(){let a=kk("arrowhead-dot");return(0,bT.jsx)("marker",{id:a,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,bT.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Yq(){let a=kk("arrowhead-cross");return(0,bT.jsxs)("marker",{id:a,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,bT.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,bT.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}var z2=gO;let Yr="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Ys({url:a}){let b=kp(),c=e$("zoomLevel",()=>.32>b.getZoomLevel(),[b]),d=(0,eQ.useCallback)(a=>{b.inputs.shiftKey||b.markEventAsHandled(a)},[b]);return(0,bT.jsx)("a",{className:(0,j1.default)("tl-hyperlink-button",{"tl-hyperlink-button__hidden":c}),href:a,target:"_blank",rel:"noopener noreferrer",onPointerDown:d,onPointerUp:d,title:a,draggable:!1,children:(0,bT.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Yr}") center 100% / 100% no-repeat`,WebkitMask:`url("${Yr}") center 100% / 100% no-repeat`}})})}let Yt="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",Yu=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function Yv(a){return Yu.map(b=>{let{offsetX:c,offsetY:d,blur:e,spread:f,color:g}=b,{x:h,y:i}=new jA(c,d).rot(-a);return`${h}px ${i}px ${e}px ${f}px ${g}`}).join(", ")}function Yw({w:a,h:b}){return(0,bT.jsx)("rect",{width:jX(a),height:jX(b),rx:"6",ry:"6"})}function Yx({assetId:a,rotation:b,url:c,h:d,showImageContainer:e=!0}){let f=kp(),g=a?f.getAsset(a):null,h=!!mD()&&!1,i=(a=>{try{return new URL(a).hostname.replace(/^www\./,"")}catch{return a}})(c),[j,k]=(0,eQ.useState)(!0),l=(0,eQ.useCallback)(a=>{f.inputs.shiftKey||f.markEventAsHandled(a)},[f]);return(0,bT.jsx)(sr,{children:(0,bT.jsxs)("div",{className:(0,j1.default)("tl-bookmark__container",h&&"tl-bookmark__container--safariExport"),style:{boxShadow:h?void 0:Yv(b),maxHeight:d},children:[e&&(!g||g.props.image)&&(0,bT.jsxs)("div",{className:"tl-bookmark__image_container",children:[g?(0,bT.jsx)("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:g?.props.image,alt:g?.props.title||""}):(0,bT.jsx)("div",{className:"tl-bookmark__placeholder"}),g?.props.image&&(0,bT.jsx)(Ys,{url:c})]}),(0,bT.jsxs)("div",{className:"tl-bookmark__copy_container",children:[g?.props.title?(0,bT.jsx)("a",{className:"tl-bookmark__link",href:c||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:l,onPointerUp:l,children:(0,bT.jsx)("h2",{className:"tl-bookmark__heading",children:Xi(g.props.title)})}):null,g?.props.description&&g?.props.image?(0,bT.jsx)("p",{className:"tl-bookmark__description",children:g.props.description}):null,(0,bT.jsxs)("a",{className:"tl-bookmark__link",href:c||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:l,onPointerUp:l,children:[j&&g?.props.favicon?(0,bT.jsx)("img",{className:"tl-bookmark__favicon",src:g?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:()=>k(!1),alt:`favicon of ${i}`}):(0,bT.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Yt}") center 100% / 100% no-repeat`,WebkitMask:`url("${Yt}") center 100% / 100% no-repeat`}}),(0,bT.jsx)("span",{children:i})]})]})]})})}function Yy(a,b=!1){let c=a.length;if(c<2)return"";let d=a[0].point,e=a[1].point;if(2===c)return`M${jC(d)}L${jC(e)}`;let f="";for(let b=2,g=c-1;b<g;b++)f+=jD(d=a[b].point,e=a[b+1].point);return b?`M${jD(a[0].point,a[1].point)}Q${jC(a[1].point)}${jD(a[1].point,a[2].point)}T${f}${jD(a[c-1].point,a[0].point)}${jD(a[0].point,a[1].point)}Z`:`M${jC(a[0].point)}Q${jC(a[1].point)}${jD(a[1].point,a[2].point)}${a.length>3?"T":""}${f}L${jC(a[c-1].point)}`}function Yz(a){let b,c,d=a[0];for(;a.length>2;)if(b=a[1],jA.Dist2(d.point,b.point)<((d.radius+b.radius)/2*.5)**2)a.splice(1,1);else break;let e=a[a.length-1];for(;a.length>2;)if(c=a[a.length-2],jA.Dist2(e.point,c.point)<((e.radius+c.radius)/2*.5)**2)a.splice(a.length-2,1);else break;return a.length>1&&(a[0]={...a[0],vector:jA.Sub(a[0].point,a[1].point).uni()},a[a.length-1]={...a[a.length-1],vector:jA.Sub(a[a.length-2].point,a[a.length-1].point).uni()}),a}let YA=(a,b,c)=>{let d=[],e=[];a.forEach(a=>d.push(...a.points)),b.forEach(a=>e.push(...a.points));let f=Math.max(d.length,e.length),g=[],h=[];for(let a=0;a<f;a++)g.push(d[a]||d[d.length-1]),h.push(e[a]||e[e.length-1]);return[{type:"free",points:g.map((a,b)=>{var d,e,f;let g=.5;return void 0!==h[b].z&&void 0!==a.z&&(d=a.z,g=d+(h[b].z-d)*c),{x:(e=a.x,e+(h[b].x-e)*c),y:(f=a.y,f+(h[b].y-f)*c),z:g}})}]},YB=a=>.65*a+.35*jH(a*jE/2),YC=a=>({size:a,thinning:0,streamline:cT(a,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:jt});function YD({strokeWidth:a,showAsComplete:b}){return{size:1+a,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:jz,last:b}}function YE(a,b,c,d){let e=a.isComplete||c;if(d)if(!a.isPen)return{...YC(b),last:e};else return{size:b,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:jt,last:e};if("draw"===a.dash)if(a.isPen)return{size:1+1.2*b,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:YB,last:e};else return{...{size:b,thinning:.5,streamline:cT(b,[9,16],[.64,.74],!0),smoothing:.62,easing:jz,simulatePressure:!0},last:e};return{...YC(b),last:e}}function YF(a){let b=[];for(let c of a)if("free"===c.type||c.points.length<2)b.push(...c.points.map(jA.Cast));else{let a=Math.max(4,Math.floor(jA.Dist(c.points[0],c.points[1])/16));b.push(...jA.PointsBetween(c.points[0],c.points[1],a))}return b}function YG(a,b){let c=(b+1)*.5;return`M ${a.x} ${a.y} m -${c}, 0 a ${c},${c} 0 1,0 ${2*c},0 a ${c},${c} 0 1,0 -${2*c},0`}function YH(a){return 1===a.props.segments.length&&a.props.segments[0].points.length<2}function YI({shape:a,zoomOverride:b}){var c;let d=Mp(),e=kp(),f=YF(a.props.segments),g=a.props.isComplete||b6(a.props.segments)?.type==="straight",h=(Rs[a.props.size]+1)*a.props.scale,i=e$("force solid",()=>{let a=b??e.getZoomLevel();return a<.5&&a<1.5/h},[e,h,b]),j=e$("dot adjustment",()=>(b??e.getZoomLevel())<.2?0:.1,[e,b]);i||a.props.isPen||"draw"!==a.props.dash||1!==f.length||(h+=cS(a.id)()*(h/6));let k=YE(a.props,h,g,i);if(!i&&"draw"===a.props.dash)return(0,bT.jsxs)(bT.Fragment,{children:[a.props.isClosed&&a.props.fill&&f.length>1?(0,bT.jsx)(X0,{d:Yy(Rg(f,k),a.props.isClosed),theme:d,color:a.props.color,fill:a.props.isClosed?a.props.fill:"none",scale:a.props.scale}):null,(0,bT.jsx)("path",{d:function(a,b={}){let{start:c={},end:d={}}=b,{cap:e=!0}=c,{cap:f=!0}=d;cg(!c.taper&&!d.taper,"cap taper not supported here"),cg(!c.easing&&!d.easing,"cap easing not supported here"),cg(e&&f,"cap must be true");let g=Rg(a,b);Ri(g,b);let h=function(a){let b,c,d,e,f;if(a.length<=2)return[a];let g=[],h=[a[0]],i=jA.Sub(a[1].point,a[0].point).uni();for(let j=1,k=a.length;j<k-1;j++){if(d=a[j-1],e=a[j],f=a[j+1],b=jA.Sub(f.point,e.point).uni(),c=jA.Dpr(i,b),i=b,c<-.8){let a={...e,point:e.input};h.push(a),g.push(Yz(h)),h=[a];continue}if(h.push(e),!(c>.7)&&(jA.Dist2(d.point,e.point)+jA.Dist2(e.point,f.point))/((d.radius+e.radius+f.radius)/3)**2<1.5){h.push(e),g.push(Yz(h)),h=[e];continue}}return h.push(a[a.length-1]),g.push(Yz(h)),g}(g),i="";for(let a of h)i+=function(a,b={}){if(0===a.length)return"";if(1===a.length){var c,d;return c=a[0].point.x,"M "+c+" "+a[0].point.y+" m -"+(d=a[0].radius)+", 0 a "+d+","+d+" 0 1,1 "+2*d+",0 a "+d+","+d+" 0 1,1 -"+2*d+",0"}let{left:e,right:f}=Re(a,b);f.reverse();let g=`M${jC(e[0])}T`;for(let a=1;a<e.length;a++)g+=jD(e[a-1],e[a]);{let b=a[a.length-1],c=b.radius,d=b.vector.clone().per().neg(),e=jA.Add(b.point,jA.Mul(d,c)),f=jA.Add(b.point,jA.Mul(d,-c));g+=`${jC(e)}A${jX(c)},${jX(c)} 0 0 1 ${jC(f)}T`}for(let a=1;a<f.length;a++)g+=jD(f[a-1],f[a]);{let b=a[0],c=b.radius,d=b.vector.clone().per(),e=jA.Add(b.point,jA.Mul(d,c)),f=jA.Add(b.point,jA.Mul(d,-c));g+=`${jC(e)}A${jX(c)},${jX(c)} 0 0 1 ${jC(f)}Z`}return g}(a,b);return i}(f,k),strokeLinecap:"round",fill:hp(d,a.props.color,"solid")})]});let l=Rg(f,k),m=l.length<2,n=m?YG(f[0],0):Yy(l,a.props.isClosed);return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(X0,{d:n,theme:d,color:a.props.color,fill:m||a.props.isClosed?a.props.fill:"none",scale:a.props.scale}),(0,bT.jsx)("path",{d:n,strokeLinecap:"round",fill:m?hp(d,a.props.color,"solid"):"none",stroke:hp(d,a.props.color,"solid"),strokeWidth:h,strokeDasharray:m?"none":(c=h,({draw:"none",solid:"none",dotted:`${j} ${2*c}`,dashed:`${2*c} ${2*c}`})[a.props.dash]),strokeDashoffset:"0"})]})}let YJ=(a,b)=>!!a.find(a=>{let c=new RegExp(a.split("*").map(a=>(function(a){if("string"!=typeof a)throw TypeError("Expected a string");return a.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(a)).join(".+"));return b.match(c)});class YK extends su{static type="embed";static props=iJ;static migrations=iL;static embedDefinitions=B4;static setEmbedDefinitions(a){YK.embedDefinitions=a}getEmbedDefinitions(){return YK.embedDefinitions}getEmbedDefinition(a){var b=YK.embedDefinitions;try{return function(a,b){let c=dV(b);if(!c)return;let d=c.host.replace("www.","");for(let c of a)if(YJ(c.hostnames,d)){let a=c.toEmbedUrl(b);if(a)return{definition:c,embedUrl:a,url:b}}}(b,a)??function(a,b){let c=dV(b);if(!c)return;let d=c.host.replace("www.","");for(let c of a)if(YJ(c.hostnames,d)){let a=c.fromEmbedUrl(b);if(a)return{definition:c,url:a,embedUrl:b}}}(b,a)}catch{return}}getText(a){return a.props.url}getAriaDescriptor(a){let b=this.getEmbedDefinition(a.props.url);return b?.definition.title}hideSelectionBoundsFg(a){return!this.canResize(a)}canEdit(){return!0}canResize(a){return!!this.getEmbedDefinition(a.props.url)?.definition?.doesResize}canEditInReadonly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}getGeometry(a){let b=this.getEmbedDefinition(a.props.url);return b?.definition?super.getGeometry(a):new lA({width:300,height:46,isFilled:!0})}isAspectRatioLocked(a){let b=this.getEmbedDefinition(a.props.url);return b?.definition.isAspectRatioLocked??!1}onResize(a,b){let c=this.isAspectRatioLocked(a),d=this.getEmbedDefinition(a.props.url),e=d?.definition.minWidth??200,f=d?.definition.minHeight??200;if(c){let b=a.props.w/a.props.h;b>1?e*=b:f/=b}return st(a,b,{minWidth:e,minHeight:f})}component(a){let b=mD(),{w:c,h:d,url:e}=a.props,f=sA(a.id),g=this.getEmbedDefinition(e),h=e$("is hovering",()=>{let{editingShapeId:a,hoveredShapeId:b}=this.editor.getCurrentPageState();if(a&&b!==a){let b=this.editor.getShape(a);if(b&&this.editor.isShapeOfType(b,"embed"))return!0}return!1},[]),i=this.editor.getShapePageTransform(a).rotation();if(b)return(0,bT.jsx)(sr,{className:"tl-embed-container",id:a.id,children:(0,bT.jsx)("div",{className:"tl-embed",style:{border:0,boxShadow:Yv(i),borderRadius:g?.definition.overrideOutlineRadius??8,background:g?.definition.backgroundColor??"var(--tl-color-background)",width:c,height:d}})});let j=f||h;if(g?.definition.type==="github_gist"){let b=g.url.split("/").pop();if(!b)throw Error("No gist id!");return(0,bT.jsx)(sr,{className:"tl-embed-container",id:a.id,children:(0,bT.jsx)(YL,{id:b,width:jX(c),height:jX(d),isInteractive:j,pageRotation:i})})}let k=Object.entries({...B5,...g?.definition.overridePermissions??{}}).filter(([a,b])=>b).map(([a])=>a).join(" ");return(0,bT.jsx)(sr,{className:"tl-embed-container",id:a.id,children:g?.definition?(0,bT.jsx)("iframe",{className:"tl-embed",sandbox:k,src:g.embedUrl,width:jX(c),height:jX(d),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",tabIndex:f?0:-1,style:{border:0,pointerEvents:j?"auto":"none",zIndex:j?"":"-1",boxShadow:Yv(i),borderRadius:g?.definition.overrideOutlineRadius??8,background:g?.definition.backgroundColor}}):(0,bT.jsx)(Yx,{url:e,h:d,rotation:i,assetId:null,showImageContainer:!1})})}indicator(a){let b=this.getEmbedDefinition(a.props.url);return b?.definition?(0,bT.jsx)("rect",{width:jX(a.props.w),height:jX(a.props.h),rx:b?.definition.overrideOutlineRadius??8,ry:b?.definition.overrideOutlineRadius??8}):(0,bT.jsx)(Yw,{w:300,h:46})}getInterpolatedProps(a,b,c){var d,e;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c)}}}function YL({id:a,isInteractive:b,width:c,height:d,style:e,pageRotation:f}){if(!a.match(/^[0-9a-f]+$/))throw Error("No gist id!");return(0,bT.jsx)("iframe",{className:"tl-embed",draggable:!1,width:jX(c),height:jX(d),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",tabIndex:b?0:-1,style:{...e,pointerEvents:b?"all":"none",zIndex:b?"":"-1",boxShadow:Yv(f)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=https://gist.github.com/${a}.js></script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function YM(a,b){return Math.floor((2/Math.PI*(jM(a.getShapePageTransform(b.id).rotation())+Math.PI/4)+4)%4)}let YN=new WeakMap;function YO(a,b,c){let d=YN.get(b.props);if(!d){let e=YT(b.props.name,"Frame")+String.fromCharCode(8203),f=a.textMeasure.measureTextSpans(e,c),g=f[0],h=b6(f);d=h.box.w+h.box.x-g.box.x,YN.set(b.props,d)}return new lh(0,-c.height,d,c.height)}function YP(a,b){return{fontSize:12,fontFamily:b?"Arial":"Inter, sans-serif",textAlign:"start",width:a,height:24,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",offsetY:-34,offsetX:0}}function YQ(a,b,c){let d,e=c?"":"px",f=c?"":"deg";switch(b){case 0:d="";break;case 3:d=`translate(${jX(a.props.w)}${e}, 0${e}) rotate(90${f})`;break;case 2:d=`translate(${jX(a.props.w)}${e}, ${jX(a.props.h)}${e}) rotate(180${f})`;break;case 1:d=`translate(0${e}, ${jX(a.props.h)}${e}) rotate(270${f})`;break;default:throw Error("labelSide out of bounds")}return d}let YR=(0,eQ.forwardRef)(({id:a,name:b,isEditing:c},d)=>{let e=kp(),f=Ce(),g=e$("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),h=f<Cb.TABLET_SM&&g,i=(0,eQ.useRef)(!1),j=zQ(),k=(0,eQ.useCallback)(a=>{c&&e.markEventAsHandled(a)},[e,c]),l=(0,eQ.useCallback)(a=>{"Enter"!==a.key||a.nativeEvent.isComposing||(e.markEventAsHandled(a),a.currentTarget.blur(),e.setEditingShape(null))},[e]),m=(0,eQ.useCallback)(b=>{let c=e.getShape(a);c&&c.props.name!==b&&e.updateShapes([{id:a,type:"frame",props:{name:b}}])},[a,e]),n=(0,eQ.useCallback)(a=>{m(a.currentTarget.value)},[m]),o=(0,eQ.useCallback)(a=>{m(a.currentTarget.value)},[m]);return(0,eQ.useEffect)(()=>{if(!c){i.current=!1;return}if(c&&h&&!i.current){i.current=!0;let b=e.getShape(a),c=b?.props.name??"",d=window.prompt(j("action.rename"),c);i.current=!1,null!==d&&m(d),e.setEditingShape(null)}},[c,h,a,j,m,e]),(0,bT.jsxs)("div",{className:`tl-frame-label ${c&&!h?"tl-frame-label__editing":""}`,children:[(0,bT.jsx)("input",{className:"tl-frame-name-input",ref:d,disabled:!c||h,readOnly:!c||h,style:{display:c?void 0:"none"},value:b,autoFocus:!h,onKeyDown:l,onBlur:n,onChange:o,onPointerDown:k,draggable:!1}),YT(b,"Frame")+String.fromCharCode(8203)]})}),YS=(0,eQ.memo)(function({id:a,name:b,width:c,height:d,fill:e,stroke:f,color:g,offsetX:h,showColors:i}){let j=kp(),{side:k,translation:l}=e$("shape rotation",()=>{let b=j.getShape(a);if(!b)return{side:0,translation:"translate(0, 0)"};let c=YM(j,b);return{side:c,translation:YQ(b,c,!1)}},[j,h,a]),m=(0,eQ.useRef)(null),n=sA(a);return(0,eQ.useEffect)(()=>{let a=m.current;a&&n&&(a.focus(),a.select())},[m,n]),(0,bT.jsx)("div",{className:"tl-frame-heading",style:{overflow:n?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${0===k||2===k?Math.ceil(c):Math.ceil(d)}px + ${i?"0px":"var(--tl-frame-offset-width)"})`,bottom:"100%",transform:`${l} scale(var(--tl-scale)) translateX(${h}px)`},children:(0,bT.jsx)("div",{className:"tl-frame-heading-hit-area",style:{color:g,backgroundColor:e,boxShadow:`inset 0px 0px 0px 1px ${f}`},children:(0,bT.jsx)(YR,{ref:m,id:a,name:b,isEditing:n})})})});function YT(a,b){return a.match(/^\s*$/)?b:a}var zx=b_;let YU=new cl;function YV(a){return YU.get(a,YW)}function YW(a){let b=Math.max(1,a.props.w),c=Math.max(1,a.props.h+a.props.growY),d=b/2,e=c/2,f=JX[a.props.size]*a.props.scale,g="none"!==a.props.fill;switch(a.props.geo){case"arrow-down":{let a=.16*b,d=.38*Math.min(b,c);return new zz().moveTo(a,0,{geometry:{isFilled:g}}).lineTo(b-a,0).lineTo(b-a,c-d).lineTo(b,c-d).lineTo(b/2,c).lineTo(0,c-d).lineTo(a,c-d).close()}case"arrow-left":{let a=.38*Math.min(b,c),d=.16*c;return new zz().moveTo(a,0,{geometry:{isFilled:g}}).lineTo(a,d).lineTo(b,d).lineTo(b,c-d).lineTo(a,c-d).lineTo(a,c).lineTo(0,c/2).close()}case"arrow-right":{let a=.38*Math.min(b,c),d=.16*c;return new zz().moveTo(0,d,{geometry:{isFilled:g}}).lineTo(b-a,d).lineTo(b-a,0).lineTo(b,c/2).lineTo(b-a,c).lineTo(b-a,c-d).lineTo(0,c-d).close()}case"arrow-up":{let a=.16*b,d=.38*Math.min(b,c);return new zz().moveTo(b/2,0,{geometry:{isFilled:g}}).lineTo(b,d).lineTo(b-a,d).lineTo(b-a,c).lineTo(a,c).lineTo(a,d).lineTo(0,d).close()}case"check-box":{let a=.82*Math.min(b,c),d=(b-a)/2,e=(c-a)/2;return new zz().moveTo(0,0,{geometry:{isFilled:g}}).lineTo(b,0).lineTo(b,c).lineTo(0,c).close().moveTo(jI(d+.25*a,0,b),jI(e+.52*a,0,c),{geometry:{isInternal:!0,isFilled:!1},offset:0}).lineTo(jI(d+.45*a,0,b),jI(e+.82*a,0,c)).lineTo(jI(d+.82*a,0,b),jI(e+.22*a,0,c),{offset:0})}case"diamond":return new zz().moveTo(d,0,{geometry:{isFilled:g}}).lineTo(b,e).lineTo(d,c).lineTo(0,e).close();case"ellipse":return new zz().moveTo(0,e,{geometry:{isFilled:g}}).arcTo(d,e,!1,!0,0,b,e).arcTo(d,e,!1,!0,0,0,e).close();case"heart":{let a=b/4,e=c/4;return new zz().moveTo(d,c,{geometry:{isFilled:g}}).cubicBezierTo(0,1.2*e,1.5*a,3*e,0,2.5*e).cubicBezierTo(d,.9*e,0,-(.32*e),1.85*a,-(.32*e)).cubicBezierTo(b,1.2*e,2.15*a,-(.32*e),b,-(.32*e)).cubicBezierTo(d,c,b,2.5*e,2.5*a,3*e).close()}case"hexagon":return zz.lineThroughPoints(jT(b,c,6),{geometry:{isFilled:g}}).close();case"octagon":return zz.lineThroughPoints(jT(b,c,8),{geometry:{isFilled:g}}).close();case"oval":var h,i,j,k=b,l=c,m=g;if(l>k){let a=k/2;return new zz().moveTo(0,a,{geometry:{isFilled:m}}).arcTo(a,a,!1,!0,0,k,a).lineTo(k,l-a).arcTo(a,a,!1,!0,0,0,l-a).close()}let n=l/2;return new zz().moveTo(n,l,{geometry:{isFilled:m}}).arcTo(n,n,!1,!0,0,n,0).lineTo(k-n,0).arcTo(n,n,!1,!0,0,k-n,l).close();case"pentagon":return zz.lineThroughPoints(jT(b,c,5),{geometry:{isFilled:g}}).close();case"rectangle":return new zz().moveTo(0,0,{geometry:{isFilled:g}}).lineTo(b,0).lineTo(b,c).lineTo(0,c).close();case"rhombus":{let a=Math.min(.38*b,.38*c);return new zz().moveTo(a,0,{geometry:{isFilled:g}}).lineTo(b,0).lineTo(b-a,c).lineTo(0,c).close()}case"rhombus-2":{let a=Math.min(.38*b,.38*c);return new zz().moveTo(0,0,{geometry:{isFilled:g}}).lineTo(b-a,0).lineTo(b,c).lineTo(a,c).close()}case"star":let o,p,q,r,s,t,u,v,w,y,z,A,B,C;return h=b,i=c,j=g,o=jG/5/2,q=Math.cos(-jF+(p=2*Math.floor(5/4))*o)*h/2,r=Math.cos(-jF+(10-p)*o)*h/2,s=Math.sin(-jF+0*o)*i/2,t=Math.sin(-jF+2*Math.floor(2.5)*o)*i/2,u=h-Math.abs(q-r),v=i-Math.abs(t-s),w=(h-(h/2+r-(h/2-q)))/2,y=(i-(i/2+s-(i/2-t)))/2,z=(h+u)/2,A=(i+v)/2,B=z/2,C=A/2,zz.lineThroughPoints(Array.from(Array(10),(a,b)=>{let c=-jF+b*o;return new jA(w+(b%2?B:z)*Math.cos(c),y+(b%2?C:A)*Math.sin(c))}),{geometry:{isFilled:j}}).close();case"trapezoid":{let a=Math.min(.38*b,.38*c);return new zz().moveTo(a,0,{geometry:{isFilled:g}}).lineTo(b-a,0).lineTo(b,c).lineTo(0,c).close()}case"triangle":return new zz().moveTo(d,0,{geometry:{isFilled:g}}).lineTo(b,c).lineTo(0,c).close();case"x-box":return function(a,b,c,d,e){let f=a/2,g=b/2,h=new zz().moveTo(0,0,{geometry:{isFilled:e}}).lineTo(a,0).lineTo(a,b).lineTo(0,b).close();if("dashed"===d||"dotted"===d)return h.moveTo(0,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(f,g).moveTo(a,b,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(f,g).moveTo(0,b,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(f,g).moveTo(a,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(f,g);let i=.62*("draw"===d);return h.moveTo(jI(c*i,0,a),jI(c*i,0,b),{geometry:{isInternal:!0,isFilled:!1}}).lineTo(jI(a-c*i,0,a),jI(b-c*i,0,b)).moveTo(jI(a-c*i,0,a),jI(c*i,0,b)).lineTo(jI(c*i,0,a),jI(b-c*i,0,b)),h}(b,c,f,a.props.dash,g);case"cloud":return function(a,b,c,d,e,f){let g=new zz,h=cS(c),i=YX(a,b),j=Math.max(Math.ceil(i/YY[d]),6,Math.ceil(i/Math.min(a,b))),k=i/j*.2,l=Math.max(a-2*k,1),m=Math.max(b-2*k,1),n=YX(l,m)/j,o=(a-l)/2,p=(b-m)/2,q=(function(a,b,c){let d=Math.min(a,b)/2,e=Math.max(a,b)-2*d,f=(2*d*Math.PI+2*e)/c,g=a>b?[{type:"straight",start:new jA(d,0),delta:new jA(1,0)},{type:"arc",center:new jA(a-d,d),startAngle:-jE/2},{type:"straight",start:new jA(a-d,b),delta:new jA(-1,0)},{type:"arc",center:new jA(d,d),startAngle:jE/2}]:[{type:"straight",start:new jA(a,d),delta:new jA(0,1)},{type:"arc",center:new jA(d,b-d),startAngle:0},{type:"straight",start:new jA(0,b-d),delta:new jA(0,-1)},{type:"arc",center:new jA(d,d),startAngle:jE}],h=0,i=[];for(let a=0;a<c;a++){let a=g[0];"straight"===a.type?i.push(jA.Add(a.start,jA.Mul(a.delta,h))):i.push(jS(a.center,d,a.startAngle+h/d)),h+=f;let b="straight"===a.type?e:jE*d;for(;h>b;)h-=b,g.push(g.shift()),b="straight"===g[0].type?e:jE*d}return i})(l,m,j).map(a=>a.addXY(o,p)),r=a<20?0:.3*k,s=b<20?0:.3*k,t=q.slice(0);for(let a=0;a<Math.floor(j/2);a++)t[a]=jA.AddXY(t[a],h()*r*e,h()*s*e),t[j-a-1]=jA.AddXY(t[j-a-1],h()*r*e,h()*s*e);for(let c=0;c<t.length;c++){let d=c===t.length-1?0:c+1,e=t[c],h=t[d],i=q[c],j=q[d],k=jA.Dist(i,j),l=(Math.max(o,p)+(n-k))*(jA.Dist(e,h)/k),m=jA.Lrp(i,j,.5).add(jA.Sub(j,i).uni().per().mul(l));m.x<0?m.x=0:m.x>a&&(m.x=a),m.y<0?m.y=0:m.y>b&&(m.y=b);let r=j_(e,h,m),s=jA.Dist(r||jA.Average([e,h]),e);0===c&&g.moveTo(e.x,e.y,{geometry:{isFilled:f}}),g.circularArcTo(s,!1,!0,h.x,h.y)}return g.close()}(b,c,a.id,a.props.size,a.props.scale,g);default:cf(a.props.geo)}}function YX(a,b){return a>b?(b/2*jE+(a-b))*2:(a/2*jE+(b-a))*2}let YY={s:50,m:70,l:100,xl:130};function YZ({shape:a,shouldScale:b,forceSolid:c}){let d=b?a.props.scale:1,e=Mp(),{props:f}=a,{color:g,fill:h,dash:i,size:j}=f,k=Rs[j]*d,l=YV(a),m="draw"!==i||c?l.toD({onlyFilled:!0}):l.toDrawD({strokeWidth:k,randomSeed:a.id,passes:1,offset:0,onlyFilled:!0});return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(X0,{theme:e,d:m,color:g,fill:h,scale:d}),l.toSvg({style:i,strokeWidth:k,forceSolid:c,randomSeed:a.id,props:{fill:"none",stroke:hp(e,g,"solid")}})]})}let Y$={s:12,m:14,l:16,xl:20},Y_={s:2,m:3.5,l:5,xl:10};function Y0(a,b){let{richText:c,font:d,size:e,w:f}=b.props;if(!c||Xc(c))return{w:0,h:0};let g=Y$[e],h=Xa(a,c),i=a.textMeasure.measureHtml(h,{...Rr,fontFamily:Rw[d],fontSize:Ru[e],minWidth:g,maxWidth:Math.max(0,Math.ceil(g+Y_[e]),Math.ceil(f/b.props.scale-32))});return{w:i.w+32,h:i.h+32}}function Y1(a,b,c){let d=YF(a.props.segments),e=a.props.isComplete||b6(a.props.segments)?.type==="straight",f=b;return c||a.props.isPen||1!==d.length||(f+=cS(a.id)()*(b/6)),{strokePoints:Rg(d,YD({strokeWidth:f,showAsComplete:e})),sw:f}}function Y2(a){return 1.12*Rt[a.props.size]*a.props.scale}function Y3(a){return 1===a.props.segments.length&&a.props.segments[0].points.length<2}function Y4({strokeWidth:a,forceSolid:b,shape:c,opacity:d}){var e;let f=Mp(),g=YF(c.props.segments),h=a;b||c.props.isPen||1!==g.length||(h+=cS(c.id)()*(h/6));let i=Rg(g,YD({strokeWidth:h,showAsComplete:c.props.isComplete||b6(c.props.segments)?.type==="straight"})),j=i.length>1?Yy(i,!1):(e=c.props.segments[0].points[0],`M ${e.x} ${e.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`),k=function(){let[a,b]=(0,eQ.useState)(!1);return(0,eQ.useEffect)(()=>{let a=CSS.supports("color","color(display-p3 1 1 1)"),c=matchMedia("(color-gamut: p3)");b(a&&c.matches);let d=()=>b(a&&c.matches);return c.addEventListener("change",d),()=>c.removeEventListener("change",d)},[]),e$(j7.forceSrgb)||!a?"srgb":"p3"}(),l=hp(f,c.props.color,"p3"===k?"highlightP3":"highlightSrgb");return(0,bT.jsx)("path",{d:j,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:l,strokeWidth:h,opacity:d})}function Y5(a,b){return e$("forceSolid",()=>Y2(b)/a.getZoomLevel()<1.5,[a])}function Y6(){return(0,bT.jsxs)("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bT.jsx)("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),(0,bT.jsx)("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),(0,bT.jsx)("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function Y7({shapeId:a,assetId:b,width:c}){let d=kp(),e=mD(),f=function(){let a=(0,eQ.useContext)(mB),[b]=(0,eQ.useState)(ci);return(0,eQ.useEffect)(()=>(a?.waitUntil(b),()=>{b.resolve()}),[b,a]),mA(()=>{b.resolve()})}(),[g,h]=(0,eQ.useState)(()=>({asset:b?d.getAsset(b)??null:null,url:null})),i=(0,eQ.useRef)(!1),j=(0,eQ.useRef)(null);return(0,eQ.useEffect)(()=>{let g;if(!b)return;let k=!1,l=eg("update state",()=>{if(!e&&a&&d.getCulledShapes().has(a))return;let l=d.getAsset(b);if(!l)return void h(a=>({...a,asset:null,url:null}));if(!l.props.src){let a=d.getTemporaryAssetPreview(l.id);if(a){j.current!==a&&(j.current=a,h(b=>({...b,isPlaceholder:!0,url:a})),f());return}}let m=e?e.scale*(c/l.props.w):d.getZoomLevel()*(c/l.props.w);function n(a,b){k||j.current!==b&&(i.current=!0,j.current=b,h({asset:a,url:b}),f())}if(i.current){let a=0,c=()=>{++a>31.25&&(Y8(d,b,m,e,a=>n(l,a)),g?.())};g?.(),d.on("tick",c),g=()=>d.off("tick",c)}else Y8(d,b,m,e,a=>n(l,a))});return()=>{l(),g?.(),k=!0}},[d,b,e,f,a,c]),g}function Y8(a,b,c,d,e){a.resolveAssetUrl(b,{screenScale:c,shouldResolveToOriginal:!!d&&null===d.pixelRatio,dpr:d?.pixelRatio??void 0}).then(a=>{e(a)})}async function Y9(a){let b=await cr(a),c=await b.blob();return ct.blobToDataUrl(c)}let Za=new cl,Zb=(0,eQ.memo)(function({shape:a}){let b=kp(),{w:c}=MZ(a.props,a.props.crop),{asset:d,url:e}=Y7({shapeId:a.id,assetId:a.props.assetId,width:c}),f=zD(),[g,h]=(0,eQ.useState)(""),[i,j]=(0,eQ.useState)(null),k=d&&Zc(b,d.id);(0,eQ.useEffect)(()=>{if(e&&k){let{promise:a,cancel:b}=Zg(e);return a.then(a=>{h(a),j(e)}),()=>{b()}}},[b,k,f,e]);let l=e$("show crop preview",()=>a.id===b.getOnlySelectedShapeId()&&b.getCroppingShapeId()===a.id&&b.isIn("select.crop"),[b,a.id]),m=f&&(d?.props.mimeType?.includes("video")||k),n=Zd(a),o=e===i?null:e,p=m?g:i;if(!e&&!d?.props.src)return(0,bT.jsxs)(sr,{id:a.id,style:{overflow:"hidden",width:a.props.w,height:a.props.h,color:"var(--tl-color-text-3)",backgroundColor:"var(--tl-color-low)",border:"1px solid var(--tl-color-low-border)"},children:[(0,bT.jsx)("div",{className:(0,j1.default)("tl-image-container",d&&"tl-image-container-loading"),style:n,children:d?null:(0,bT.jsx)(Y6,{})}),"url"in a.props&&a.props.url&&(0,bT.jsx)(Ys,{url:a.props.url})]});let q=k?"anonymous":void 0;return(0,bT.jsxs)(bT.Fragment,{children:[l&&p&&(0,bT.jsx)("div",{style:n,children:(0,bT.jsx)("img",{className:"tl-image",style:{...Ze(a),opacity:.1},crossOrigin:q,src:p,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""})}),(0,bT.jsxs)(sr,{id:a.id,style:{overflow:"hidden",width:a.props.w,height:a.props.h,borderRadius:a.props.crop?.isCircle?"50%":void 0},children:[(0,bT.jsxs)("div",{className:(0,j1.default)("tl-image-container"),style:n,children:[p&&(0,bT.jsx)("img",{className:"tl-image",style:Ze(a),crossOrigin:q,src:p,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""},p),o&&(0,bT.jsx)("img",{className:"tl-image",style:Ze(a),crossOrigin:q,src:o,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:a.props.altText,onLoad:()=>j(o)},o)]}),a.props.url&&(0,bT.jsx)(Ys,{url:a.props.url})]})]})});function Zc(a,b){let c=b?a.getAsset(b):void 0;return!!c&&("mimeType"in c.props&&cP.isAnimatedImageType(c?.props.mimeType)||"isAnimated"in c.props&&c.props.isAnimated)}function Zd(a){let b=a.props.crop,c=b?.topLeft;if(!c)return{width:a.props.w,height:a.props.h};let{w:d,h:e}=MZ(a.props,b),f=-c.x*d,g=-c.y*e;return{transform:`translate(${f}px, ${g}px)`,width:d,height:e}}function Ze(a,b){let c,d,{flipX:e,flipY:f,crop:g}=a.props;if(!e&&!f)return;if(g){let{w:b,h:e}=MZ(a.props,g),f=g.bottomRight.x-g.topLeft.x,h=g.bottomRight.y-g.topLeft.y;c=cT(g.topLeft.x,[0,1-f],[0,b-a.props.w]),d=cT(g.topLeft.y,[0,1-h],[0,e-a.props.h])}let h=`scale(${e?-1:1}, ${f?-1:1})`,i=b?`translate(${(e?b.width:0)-(c||0)}px,
		             ${(f?b.height:0)-(d||0)}px)`:"";return{transform:`${i} ${h}`,transformOrigin:b?"0 0":"center center"}}function Zf({shape:a,src:b}){let c=kj(),d=Zd(a),e=a.props.crop;if(!d.transform||!e)return(0,bT.jsx)("image",{href:b,width:a.props.w,height:a.props.h,"aria-label":a.props.altText,style:Ze(a,{width:a.props.w,height:a.props.h})});{let{transform:f,width:g,height:h}=d,i=(e.bottomRight.x-e.topLeft.x)*g,j=(e.bottomRight.y-e.topLeft.y)*h,k=[new jA(0,0),new jA(i,0),new jA(i,j),new jA(0,j)],l=Ze(a,{width:g,height:h});return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("defs",{children:(0,bT.jsx)("clipPath",{id:c,children:e.isCircle?(0,bT.jsx)("ellipse",{cx:i/2,cy:j/2,rx:i/2,ry:j/2}):(0,bT.jsx)("polygon",{points:k.map(a=>`${a.x},${a.y}`).join(" ")})})}),(0,bT.jsx)("g",{clipPath:`url(#${c})`,children:(0,bT.jsx)("image",{href:b,width:g,height:h,"aria-label":a.props.altText,style:l?{...l}:{transform:f}})})]})}}function Zg(a){let b=!1;return{promise:new Promise(c=>{let d=cs();d.onload=()=>{if(b)return;let a=document.createElement("canvas");a.width=d.width,a.height=d.height;let e=a.getContext("2d");e&&(e.drawImage(d,0,0),c(a.toDataURL()))},d.crossOrigin="anonymous",d.src=a}),cancel:()=>b=!0}}let Zh=new cl;function Zi(a){return Object.values(a.props.points).sort(dz)}let Zj=new cl;function Zk(a){return Zj.get(a,()=>{let b=Zi(a).map(jA.From);switch(a.props.spline){case"cubic":return zz.cubicSplineThroughPoints(b,{endOffsets:0});case"line":return zz.lineThroughPoints(b,{endOffsets:0})}})}function Zl({shape:a,shouldScale:b=!1,forceSolid:c=!1}){let d=Mp(),e=Zk(a),{dash:f,color:g,size:h}=a.props,i=1/a.props.scale,j=JX[h]*a.props.scale;return e.toSvg({style:f,strokeWidth:j,forceSolid:c,randomSeed:a.id,props:{transform:`scale(${b?i:1})`,stroke:hp(d,g,"solid"),fill:"none"}})}var zx=b_;function Zm(a,b,c=!1){a.select(b),a.setEditingShape(b),a.setCurrentTool("select.editing_shape",{target:"shape",shape:b}),c&&a.emit("select-all-text",{shapeId:b.id})}function Zn(a,b){let{labelHeight:c,fontSizeAdjustment:d}=Zp(a,b),e=Math.max(0,c-200);if(e!==b.props.growY||d!==b.props.fontSizeAdjustment)return{...b,props:{...b.props,growY:e,fontSizeAdjustment:d}}}let Zo=new cl;function Zp(a,b){return Zo.get(b,()=>(function(a,b){let{richText:c}=b.props;if(Xc(c))return{labelHeight:Ru[b.props.size]*Rr.lineHeight+32,labelWidth:100,fontSizeAdjustment:0};let d=Ru[b.props.size],e=0,f=0,g=200,h=200;do{e=Math.min(d,d-f);let i=Xa(a,c),j=a.textMeasure.measureHtml(i,{...Rr,fontFamily:Rw[b.props.font],fontSize:e,maxWidth:167,disableOverflowWrapBreaking:!0,measureScrollWidth:!0});if(g=j.h+32,h=j.w+32,e<=14){let d=Xa(a,c),f=a.textMeasure.measureHtml(d,{...Rr,fontFamily:Rw[b.props.font],fontSize:e,maxWidth:167});g=f.h+32,h=f.w+32;break}if(j.scrollWidth.toFixed(0)===j.w.toFixed(0))break}while(f++<50)return{labelHeight:g,labelWidth:h,fontSizeAdjustment:e}})(a,b))}function Zq(a){return(200+a.props.growY)*a.props.scale}var zx=b_;let Zr=f4("text size",(a,b)=>(a.fonts.trackFontsForShape(b),Zs(a,b.props)),{areRecordsEqual:(a,b)=>a.props===b.props});function Zs(a,b){let{font:c,richText:d,size:e,w:f}=b,g=Rt[e],h=b.autoSize?null:Math.max(16,Math.floor(f)),i=Xa(a,d),j=a.textMeasure.measureHtml(i,{...Rr,fontFamily:Rw[c],fontSize:g,maxWidth:h});return{width:h??Math.max(16,j.w+1),height:Math.max(g,j.h)}}let Zt=new cl,Zu=(0,eQ.memo)(function({shape:a}){let b=kp(),c=b.getShapeGeometry(a).bounds.w*b.getZoomLevel()>=110,d=sA(a.id),e=zD(),{Spinner:f}=re(),{asset:g,url:h}=Y7({shapeId:a.id,assetId:a.props.assetId,width:a.props.w}),i=(0,eQ.useRef)(null),[j,k]=(0,eQ.useState)(!1),l=(0,eQ.useCallback)(a=>{a.currentTarget&&k(!0)},[]),[m,n]=(0,eQ.useState)(!1);return(0,eQ.useEffect)(()=>{let a=()=>n(document.fullscreenElement===i.current);return document.addEventListener("fullscreenchange",a),()=>document.removeEventListener("fullscreenchange",a)}),(0,eQ.useEffect)(()=>{let a=i.current;a&&d&&document.activeElement!==a&&a.focus()},[d,j]),(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(sr,{id:a.id,style:{color:"var(--tl-color-text-3)",backgroundColor:g?"transparent":"var(--tl-color-low)",border:g?"none":"1px solid var(--tl-color-low-border)"},children:(0,bT.jsx)("div",{className:"tl-counter-scaled",children:(0,bT.jsx)("div",{className:"tl-video-container",children:g?f&&!g.props.src?(0,bT.jsx)(f,{}):h?(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("video",{ref:i,style:d?{pointerEvents:"all"}:j?void 0:{display:"none"},className:(0,j1.default)("tl-video",`tl-video-shape-${a.id.split(":")[1]}`,{"tl-video-is-fullscreen":m}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:a.props.autoplay&&!e,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:d&&c,onLoadedData:l,hidden:!j,"aria-label":a.props.altText,children:(0,bT.jsx)("source",{src:h})},h),!j&&f&&(0,bT.jsx)(f,{})]}):null:(0,bT.jsx)(Y6,{})})})}),"url"in a.props&&a.props.url&&(0,bT.jsx)(Ys,{url:a.props.url})]})}),Zv=[class extends lC{static type="text";static props=i9;static migrations=jb;options={extraArrowHorizontalPadding:10};getDefaultProps(){return{color:"black",size:"m",w:8,font:"draw",textAlign:"start",autoSize:!0,scale:1,richText:g6("")}}getMinDimensions(a){return Zr.get(this.editor,a.id)}getGeometry(a,b){let{scale:c}=a.props,{width:d,height:e}=this.getMinDimensions(a),f=b?.context??"none";return new lA({x:("@tldraw/arrow-without-arrowhead"===f?-this.options.extraArrowHorizontalPadding:0)*c,width:(d+("@tldraw/arrow-without-arrowhead"===f?2*this.options.extraArrowHorizontalPadding:0))*c,height:e*c,isFilled:!0,isLabel:!0})}getFontFaces(a){return zv(this.editor,a.props.richText,{family:`tldraw_${a.props.font}`,weight:"normal",style:"normal"})}getText(a){return Xd(this.editor,a.props.richText)}canEdit(){return!0}isAspectRatioLocked(){return!0}component(a){var b;let c,{id:d,props:{font:e,size:f,richText:g,color:h,scale:i,textAlign:j}}=a,{width:k,height:l}=this.getMinDimensions(a),m=a.id===this.editor.getOnlySelectedShapeId(),n=Mp(),o=(b=d,c=kp(),(0,eQ.useCallback)(a=>{c.getEditingShapeId()===b&&"Enter"===a.key&&(a.ctrlKey||a.metaKey)&&c.complete()},[c,b]));return(0,bT.jsx)(XQ,{shapeId:d,classNamePrefix:"tl-text-shape",type:"text",font:e,fontSize:Rt[f],lineHeight:Rr.lineHeight,align:j,verticalAlign:"middle",richText:g,labelColor:hp(n,h,"solid"),isSelected:m,textWidth:k,textHeight:l,style:{transform:`scale(${i})`,transformOrigin:"top left"},wrap:!0,onKeyDown:o})}indicator(a){let b=this.editor.getShapeGeometry(a).bounds,c=kp();return a.props.autoSize&&c.getEditingShapeId()===a.id?null:(0,bT.jsx)("rect",{width:jX(b.width),height:jX(b.height)})}toSvg(a,b){let c=this.editor.getShapeGeometry(a).bounds,d=c.width/(a.props.scale??1),e=c.height/(a.props.scale??1),f=hl(b),g=new lh(0,0,d,e);return(0,bT.jsx)(XR,{fontSize:Rt[a.props.size],font:a.props.font,align:a.props.textAlign,verticalAlign:"middle",richText:a.props.richText,labelColor:hp(f,a.props.color,"solid"),bounds:g,padding:0})}onResize(a,b){let{newPoint:c,initialBounds:d,initialShape:e,scaleX:f,handle:g}=b;if("scale_shape"===b.mode||"right"!==g&&"left"!==g)return{id:a.id,type:a.type,...sv(a,b)};{let b=Math.max(1,Math.abs(d.width*f)),{x:g,y:h}=f<0?jA.Sub(c,jA.FromAngle(a.rotation).mul(b)):c;return{id:a.id,type:a.type,x:g,y:h,props:{w:b/e.props.scale,autoSize:!1}}}}onEditEnd(a){0===Xd(this.editor,a.props.richText).trimEnd().length&&this.editor.deleteShapes([a.id])}onBeforeUpdate(a,b){let c;if(!b.props.autoSize)return;let d=a.props.size!==b.props.size||a.props.textAlign!==b.props.textAlign||a.props.font!==b.props.font||1!==a.props.scale&&1===b.props.scale,e=!(0,zx.default)(a.props.richText,b.props.richText);if(!d&&!e)return;let f=this.getMinDimensions(a),g=Zs(this.editor,b.props),h=f.width*a.props.scale,i=f.height*a.props.scale,j=g.width*b.props.scale,k=g.height*b.props.scale;switch(b.props.textAlign){case"middle":c=new jA((j-h)/2,e?0:(k-i)/2);break;case"end":c=new jA(j-h,e?0:(k-i)/2);break;default:if(e)break;c=new jA(0,(k-i)/2)}if(!c)return{...b,props:{...b.props,w:j}};{c.rot(b.rotation);let{x:a,y:d}=b;return{...b,x:a-c.x,y:d-c.y,props:{...b.props,w:j}}}}},class extends su{static type="bookmark";static props=iA;static migrations=iC;canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(a){return a.props.url}getAriaDescriptor(a){let b=a.props.assetId?this.editor.getAsset(a.props.assetId):null;if(b?.props.title)return Xi(b.props.title)+(b.props.description?", "+b.props.description:"")}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(a){let{assetId:b,url:c,h:d}=a.props,e=this.editor.getShapePageTransform(a).rotation();return(0,bT.jsx)(Yx,{assetId:b,url:c,h:d,rotation:e})}indicator(a){return(0,bT.jsx)(Yw,{w:a.props.w,h:a.props.h})}onBeforeCreate(a){return zZ(this.editor,a)}onBeforeUpdate(a,b){if(a.props.url!==b.props.url)if(!z2.linkUrl.isValid(b.props.url))return{...b,props:{...b.props,url:a.props.url}};else!function(a,b){let{url:c}=b.props,d=iz.createId(cu(c));a.getAsset(d)?b.props.assetId!==d&&a.updateShapes([{id:b.id,type:b.type,props:{assetId:d}}]):(a.updateShapes([{id:b.id,type:b.type,props:{assetId:null}}]),z$(a,b))}(this.editor,b);if(a.props.assetId!==b.props.assetId)return zZ(this.editor,b)}getInterpolatedProps(a,b,c){var d,e;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c)}}},class extends lC{static type="draw";static props=iE;static migrations=iG;options={maxPointsPerShape:600};hideResizeHandles(a){return YH(a)}hideRotateHandle(a){return YH(a)}hideSelectionBoundsFg(a){return YH(a)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(a){let b=YF(a.props.segments),c=(Rs[a.props.size]+1)*a.props.scale;if(1===a.props.segments.length){let a=lh.FromPoints(b);if(a.width<2*c&&a.height<2*c)return new sE({x:-c,y:-c,radius:c,isFilled:!0})}let d=Rg(b,YE(a.props,c,a.props.isPen,!0)).map(a=>a.point);return a.props.isClosed&&d.length>2?new lz({points:d,isFilled:"none"!==a.props.fill}):1===d.length?new sE({x:-c,y:-c,radius:c,isFilled:!0}):new ly({points:d})}component(a){return(0,bT.jsx)(lg,{children:(0,bT.jsx)(YI,{shape:a})})}indicator(a){let b=YF(a.props.segments),c=(Rs[a.props.size]+1)*a.props.scale;e$("force solid",()=>{let a=this.editor.getZoomLevel();return a<.5&&a<1.5/c},[this.editor,c])||a.props.isPen||"draw"!==a.props.dash||1!==b.length||(c+=cS(a.id)()*(c/6));let d=a.props.isComplete||b6(a.props.segments)?.type==="straight",e=Rg(b,YE(a.props,c,d,!0)),f=e.length>1?Yy(e,a.props.isClosed):YG(b[0],c);return(0,bT.jsx)("path",{d:f})}toSvg(a,b){b.addExportDef(XS(a.props.fill));let c=1/a.props.scale;return(0,bT.jsx)("g",{transform:`scale(${c})`,children:(0,bT.jsx)(YI,{shape:a,zoomOverride:1})})}getCanvasSvgDefs(){return[XU()]}onResize(a,b){let{scaleX:c,scaleY:d}=b,e=[];for(let b of a.props.segments)e.push({...b,points:b.points.map(({x:a,y:b,z:e})=>({x:jY(c*a),y:jY(d*b),z:e}))});return{props:{segments:e}}}expandSelectionOutlinePx(a){let b="draw"===a.props.dash?1.6:1;return Rs[a.props.size]*b/2*a.props.scale}getInterpolatedProps(a,b,c){var d;return{...c>.5?b.props:a.props,segments:YA(a.props.segments,b.props.segments,c),scale:(d=a.props.scale,d+(b.props.scale-d)*c)}}},class extends su{static type="geo";static props=iR;static migrations=iT;canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",dash:"draw",growY:0,url:"",scale:1,color:"black",labelColor:"black",fill:"none",size:"m",font:"draw",align:"middle",verticalAlign:"middle",richText:g6("")}}getGeometry(a){let b=Math.max(1,a.props.w),c=Math.max(1,a.props.h+a.props.growY),d=YV(a),e=Y0(this.editor,a),f=b/a.props.scale,g=c/a.props.scale,h=Math.min(100,f/2),i=Math.min(Ru[a.props.size]*Rr.lineHeight+32,g/2),j=Math.min(f,Math.max(e.w,Math.min(h,Math.max(1,f-8)))),k=Math.min(g,Math.max(e.h,Math.min(i,Math.max(1,g-8))));return new lw({children:[d.toGeometry(),new lA({x:"start"===a.props.align?0:"end"===a.props.align?(f-j)*a.props.scale:(f-j)/2*a.props.scale,y:"start"===a.props.verticalAlign?0:"end"===a.props.verticalAlign?(g-k)*a.props.scale:(g-k)/2*a.props.scale,width:j*a.props.scale,height:k*a.props.scale,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0,isEmptyLabel:Xc(a.props.richText)})]})}getHandleSnapGeometry(a){let b=this.getGeometry(a),c=b.children[0];switch(a.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:c,points:[...c.vertices,b.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:c,points:[b.bounds.center]};default:cf(a.props.geo)}}getText(a){return Xd(this.editor,a.props.richText)}getFontFaces(a){return Xc(a.props.richText)?ea:zv(this.editor,a.props.richText,{family:`tldraw_${a.props.font}`,weight:"normal",style:"normal"})}component(a){let{id:b,type:c,props:d}=a,{fill:e,font:f,align:g,verticalAlign:h,size:i,richText:j}=d,k=Mp(),{editor:l}=this,m=e$("isGeoOnlySelected",()=>a.id===l.getOnlySelectedShapeId(),[l]),n=XP(l,a.id),o=Xc(a.props.richText),p=e$("force solid",()=>.2>l.getZoomLevel(),[l]);return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(lg,{children:(0,bT.jsx)(YZ,{shape:a,shouldScale:!0,forceSolid:p})}),(n||!o)&&(0,bT.jsx)(sr,{style:{overflow:"hidden",width:a.props.w,height:a.props.h+d.growY},children:(0,bT.jsx)(XQ,{shapeId:b,type:c,font:f,fontSize:Ru[i]*a.props.scale,lineHeight:Rr.lineHeight,padding:16*a.props.scale,fill:e,align:g,verticalAlign:h,richText:j,isSelected:m,labelColor:hp(k,d.labelColor,"solid"),wrap:!0})}),a.props.url&&(0,bT.jsx)(Ys,{url:a.props.url})]})}indicator(a){let b=e$("isZoomedOut",()=>.25>this.editor.getZoomLevel(),[this.editor]),{size:c,dash:d,scale:e}=a.props,f=Rs[c];return YV(a).toSvg({style:"draw"===d?"draw":"solid",strokeWidth:1,passes:1,randomSeed:a.id,offset:0,roundness:2*f*e,props:{strokeWidth:void 0},forceSolid:b})}toSvg(a,b){let c,d=a.props.scale,e={...a,props:{...a.props,w:a.props.w/d,h:(a.props.h+a.props.growY)/d,growY:0}},f=e.props;if(b.addExportDef(XS(f.fill)),!Xc(f.richText)){let e=hl(b),g=new lh(0,0,f.w,(a.props.h+a.props.growY)/d);c=(0,bT.jsx)(XR,{fontSize:Ru[f.size],font:f.font,align:f.align,verticalAlign:f.verticalAlign,richText:f.richText,labelColor:hp(e,f.labelColor,"solid"),bounds:g,padding:16})}return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(YZ,{shouldScale:!1,shape:e,forceSolid:!1}),c]})}getCanvasSvgDefs(){return[XU()]}onResize(a,{handle:b,newPoint:c,scaleX:d,scaleY:e,initialShape:f}){let g=f.props.w/f.props.scale,h=f.props.h/f.props.scale,i=f.props.growY/f.props.scale,j=g*d,k=(h+i)*e,l=0,m=0;if(!Xc(a.props.richText)){let b=Math.max(Math.abs(j),51),c=Math.max(Math.abs(k),51);b<51&&51===c&&(b=51),51===b&&c<51&&(c=51);let d=Y0(this.editor,{...a,props:{...a.props,w:b*a.props.scale,h:c*a.props.scale}}),e=Math.max(Math.abs(j),d.w)*Math.sign(j),f=Math.max(Math.abs(k),d.h)*Math.sign(k);l=Math.abs(e)-Math.abs(j),m=Math.abs(f)-Math.abs(k),j=e,k=f}let n=j*a.props.scale,o=k*a.props.scale,p=new jA(0,0);d<0&&(p.x+=n),("left"===b||"top_left"===b||"bottom_left"===b)&&(p.x+=d<0?l:-l),e<0&&(p.y+=o),("top"===b||"top_left"===b||"top_right"===b)&&(p.y+=e<0?m:-m);let{x:q,y:r}=p.rot(a.rotation).add(c);return{x:q,y:r,props:{w:Math.max(Math.abs(n),1),h:Math.max(Math.abs(o),1),growY:0}}}onBeforeCreate(a){if(Xc(a.props.richText))if(a.props.growY)return{...a,props:{...a.props,growY:0}};else return;let b=a.props.h/a.props.scale,c=Y0(this.editor,a).h,d=null;if(c>b?d=c-b:a.props.growY&&(d=0),null!==d)return{...a,props:{...a.props,growY:d*a.props.scale}}}onBeforeUpdate(a,b){if((0,zx.default)(a.props.richText,b.props.richText)&&a.props.font===b.props.font&&a.props.size===b.props.size)return;let c=Xc(a.props.richText),d=Xc(b.props.richText);if(!c&&d)return{...b,props:{...b.props,growY:0}};let e=a.props.w/a.props.scale,f=a.props.h/a.props.scale,g=a.props.growY/a.props.scale,h=Y0(this.editor,b);if(c&&!d&&Xd(this.editor,b.props.richText)){let a=Math.max(e,h.w),c=Math.max(f,h.h);return e<51&&f<51&&(c=Math.max(a=Math.max(a=Math.max(a,51),c=Math.max(c,51)),c)),{...b,props:{...b.props,w:a*b.props.scale,h:c*b.props.scale,growY:0}}}let i=null;if(h.h>f?i=h.h-f:g&&(i=0),null!==i){let a=b.props.w/b.props.scale;return{...b,props:{...b.props,growY:i*b.props.scale,w:Math.max(a,h.w)*b.props.scale}}}if(h.w>e)return{...b,props:{...b.props,w:h.w*b.props.scale}}}onDoubleClick(a){if(this.editor.inputs.altKey)switch(a.props.geo){case"rectangle":return{...a,props:{geo:"check-box"}};case"check-box":return{...a,props:{geo:"rectangle"}}}}getInterpolatedProps(a,b,c){var d,e,f;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c),scale:(f=a.props.scale,f+(b.props.scale-f)*c)}}},class extends lC{static type="note";static props=i5;static migrations=i7;options={resizeMode:"none"};canEdit(){return!0}hideResizeHandles(){let{resizeMode:a}=this.options;switch(a){case"none":return!0;case"scale":return!1;default:throw cf(a)}}isAspectRatioLocked(){return"scale"===this.options.resizeMode}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",richText:g6(""),size:"m",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(a){let{labelHeight:b,labelWidth:c}=Zp(this.editor,a),{scale:d}=a.props,e=b*d,f=c*d,g=200*d,h=Zq(a);return new lw({children:[new lA({width:g,height:h,isFilled:!0}),new lA({x:"start"===a.props.align?0:"end"===a.props.align?g-f:(g-f)/2,y:"start"===a.props.verticalAlign?0:"end"===a.props.verticalAlign?h-e:(h-e)/2,width:f,height:e,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0})]})}getHandles(a){let{scale:b}=a.props;if(this.editor.getInstanceState().isCoarsePointer)return[];let c=this.editor.getZoomLevel();if(c*b<.25)return[];let d=Zq(a),e=200*b,f=0/c*b;return c*b<.5?[{id:"bottom",index:"a3",type:"clone",x:e/2,y:d+f}]:[{id:"top",index:"a1",type:"clone",x:e/2,y:-f},{id:"right",index:"a2",type:"clone",x:e+f,y:d/2},{id:"bottom",index:"a3",type:"clone",x:e/2,y:d+f},{id:"left",index:"a4",type:"clone",x:-f,y:d/2}]}onResize(a,b){let{resizeMode:c}=this.options;switch(c){case"none":return;case"scale":return sv(a,b);default:throw cf(c)}}getText(a){return Xd(this.editor,a.props.richText)}getFontFaces(a){return Xc(a.props.richText)?ea:zv(this.editor,a.props.richText,{family:`tldraw_${a.props.font}`,weight:"normal",style:"normal"})}component(a){var b,c,d,e;let f,g,h,i,j,k,l,m,n,{id:o,type:p,props:{labelColor:q,scale:r,color:s,font:t,size:u,align:v,richText:w,verticalAlign:y,fontSizeAdjustment:z}}=a,A=(b=o,f=kp(),g=(0,eQ.useContext)(zO),(0,eQ.useCallback)(a=>{let c=f.getShape(b);if(!c)return;let d="Tab"===a.key,e=(a.metaKey||a.ctrlKey)&&"Enter"===a.key;if(d||e){var h;a.preventDefault();let i=f.getShapePageTransform(b),j=i.rotation(),k=!!(g?.dir==="rtl"||(h=Xd(f,c.props.richText),Xf.test(h))),l=(200+f.options.adjacentShapeMargin+(e&&!a.shiftKey?c.props.growY:0))*c.props.scale,m=new jA(d?a.shiftKey!=k?-1:1:0,e?a.shiftKey?-1:1:0).mul(l).add(XF.clone().mul(c.props.scale)).rot(j).add(i.point()),n=XI(f,c,m,j);n&&Zm(f,n,!0)}},[b,f,g?.dir])),B=Mp(),C=200*r,D=Zq(a),E=e$("shape rotation",()=>this.editor.getShapePageTransform(o)?.rotation()??0,[this.editor]),F=e$("zoom",()=>this.editor.getZoomLevel()<.35/r,[r,this.editor]),G=e$("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),H=a.id===this.editor.getOnlySelectedShapeId(),I=XP(this.editor,a.id),J=Xc(w);return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("div",{id:o,className:"tl-note__container",style:{width:C,height:D,backgroundColor:hp(B,s,"noteFill"),borderBottom:F?G?`${2*r}px solid rgb(20, 20, 20)`:`${2*r}px solid rgb(144, 144, 144)`:"none",boxShadow:F?"none":(c=a.id,d=E,e=r,i=Math.abs((h=cS(c))())+.5,j=Math.cos(d),k=5*e,l=4*e,m=6*e,n=7*e,`0px ${k-i}px ${k}px -${k}px rgba(15, 23, 31, .6),
	0px ${(l+i*n)*Math.max(0,j)}px ${m+i*n}px -${l+i*m}px rgba(15, 23, 31, ${(.3+.1*i).toFixed(2)}), 
	0px ${48*e}px ${10*e}px -${10*e}px inset rgba(15, 23, 44, ${((.022+.005*h())*((1+j)/2)).toFixed(2)})`)},children:(H||I||!J)&&(0,bT.jsx)(XQ,{shapeId:o,type:p,font:t,fontSize:(z||Ru[u])*r,lineHeight:Rr.lineHeight,align:v,verticalAlign:y,richText:w,isSelected:H,labelColor:"black"===q?hp(B,s,"noteText"):hp(B,q,"fill"),wrap:!0,padding:16*r,hasCustomTabBehavior:!0,onKeyDown:A})}),"url"in a.props&&a.props.url&&(0,bT.jsx)(Ys,{url:a.props.url})]})}indicator(a){let{scale:b}=a.props;return(0,bT.jsx)("rect",{rx:b,width:jX(200*b),height:jX(Zq(a))})}toSvg(a,b){let c=hl({isDarkMode:b.isDarkMode}),d=new lh(0,0,200,200+a.props.growY),e=(0,bT.jsx)(XR,{fontSize:a.props.fontSizeAdjustment||Ru[a.props.size],font:a.props.font,align:a.props.align,verticalAlign:a.props.verticalAlign,richText:a.props.richText,labelColor:hp(c,a.props.color,"noteText"),bounds:d,padding:16,showTextOutline:!1});return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("rect",{x:5,y:5,rx:1,width:190,height:d.h,fill:"rgba(0,0,0,.1)"}),(0,bT.jsx)("rect",{rx:1,width:200,height:d.h,fill:hp(c,a.props.color,"noteFill")}),e]})}onBeforeCreate(a){return Zn(this.editor,a)}onBeforeUpdate(a,b){if(!(0,zx.default)(a.props.richText,b.props.richText)||a.props.font!==b.props.font||a.props.size!==b.props.size)return Zn(this.editor,b)}getInterpolatedProps(a,b,c){var d;return{...c>.5?b.props:a.props,scale:(d=a.props.scale,d+(b.props.scale-d)*c)}}},class extends lC{static type="line";static props=i2;static migrations=i4;hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}hideInMinimap(){return!0}getDefaultProps(){let[a,b]=dy(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[a]:{id:a,index:a,x:0,y:0},[b]:{id:b,index:b,x:.1,y:.1}},scale:1}}getGeometry(a){let b=Zk(a).toGeometry();return cg(b instanceof zB),b}getHandles(a){return Zh.get(a.props,()=>{let b=this.getGeometry(a),c=Zi(a),d=c.map(a=>({...a,id:a.index,type:"vertex",canSnap:!0}));for(let a=0;a<c.length-1;a++){let e=dv(c[a].index,c[a+1].index),f=b.getSegments()[a].interpolateAlongEdge(.5);d.push({id:e,type:"create",index:e,x:f.x,y:f.y,canSnap:!0})}return d.sort(dz)})}onResize(a,b){let{scaleX:c,scaleY:d}=b;return{props:{points:c0(a.props.points,(a,{id:b,index:e,x:f,y:g})=>({id:b,index:e,x:f*c,y:g*d}))}}}onBeforeCreate(a){let{props:{points:b}}=a,c=Object.keys(b);if(c.length<2)return;let d=b[c[0]];if(c.every(a=>{let c=b[a];return c.x===d.x&&c.y===d.y})){let d=c[c.length-1];return b[d]={...b[d],x:b[d].x+.1,y:b[d].y+.1},a}}onHandleDrag(a,{handle:b}){let c=sy(new jA(b.x,b.y),this.editor);return{...a,props:{...a.props,points:{...a.props.points,[b.id]:{id:b.id,index:b.index,x:c.x,y:c.y}}}}}onHandleDragStart(a,{handle:b}){if("create"===b.type)return{...a,props:{...a.props,points:{...a.props.points,[b.index]:{id:b.index,index:b.index,x:b.x,y:b.y}}}}}component(a){return(0,bT.jsx)(lg,{style:{minWidth:50,minHeight:50},children:(0,bT.jsx)(Zl,{shape:a})})}indicator(a){let b=JX[a.props.size]*a.props.scale,c=Zk(a),{dash:d}=a.props;return c.toSvg({style:"draw"===d?"draw":"solid",strokeWidth:1,passes:1,randomSeed:a.id,offset:0,roundness:2*b,props:{strokeWidth:void 0}})}toSvg(a){return(0,bT.jsx)(Zl,{shouldScale:!0,shape:a})}getHandleSnapGeometry(a){let b=Zi(a);return{points:b,getSelfSnapPoints:c=>{let d=this.getHandles(a).filter(a=>"vertex"===a.type).findIndex(a=>a.id===c.id);return b.filter((a,b)=>Math.abs(b-d)>1).map(jA.From)},getSelfSnapOutline:b=>{let c=this.getHandles(a).filter(a=>"vertex"===a.type).findIndex(a=>a.id===b.id),d=this.getGeometry(a).getSegments().filter((a,b)=>b!==c-1&&b!==c);return d.length?new lw({children:d}):null}}}getInterpolatedProps(a,b,c){var d;let e=Zi(a),f=Zi(b),g=[],h=[],i="a0";if(e.length>f.length)for(let a=0;a<e.length;a++)g[a]={...e[a]},void 0===f[a]?h[a]={...f[f.length-1],id:i}:h[a]={...f[a],id:i},i=dw(i);else if(f.length>e.length)for(let a=0;a<f.length;a++)h[a]={...f[a]},void 0===e[a]?g[a]={...e[e.length-1],id:i}:g[a]={...e[a],id:i},i=dw(i);else for(let a=0;a<f.length;a++)g[a]=e[a],h[a]=f[a];return{...c>.5?b.props:a.props,points:Object.fromEntries(g.map((a,b)=>{var d,e;let f=h[b];return[a.id,{...a,x:(d=a.x,d+(f.x-d)*c),y:(e=a.y,e+(f.y-e)*c)}]})),scale:(d=a.props.scale,d+(b.props.scale-d)*c)}}},class extends su{static type="frame";static props=iM;static migrations=iN;options={showColors:!1};static configure(a){let b=super.configure.call(this,a);return a.showColors&&(b.props={...b.props,color:hm}),b}canEdit(){return!0}canResize(){return!0}canResizeChildren(){return!1}isExportBoundsContainer(){return!0}getDefaultProps(){return{w:320,h:180,name:"",color:"black"}}getAriaDescriptor(a){return a.props.name}getGeometry(a){let b,c,{editor:d}=this,e=d.getZoomLevel(),f=YM(d,a),g=f%2==1,h=g?a.props.h:a.props.w,i=YO(d,a,YP(h,!1)),j=this.options.showColors,k=12/e,l=i.w/e,m=i.h/e,n=jI(l+k,32/e,h+(j?1:k)),o=(j?-1:-7)/e,p=4/e,q=g?m:n,r=g?n:m;switch(f){case 0:b=o,c=-(m+p);break;case 1:b=-(m+p),c=a.props.h-(o+n);break;case 2:b=a.props.w-(o+n),c=a.props.h+p;break;case 3:b=a.props.w+p,c=o}return new lw({children:[new lA({width:a.props.w,height:a.props.h,isFilled:!1}),new lA({x:b,y:c,width:q,height:r,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0})]})}getText(a){return a.props.name}component(a){let b=Mp(),c=e$("is creating this shape",()=>{let b=this.editor.getStateDescendant("select.resizing");if(!b||!b.getIsActive())return!1;let c=b?.info;return!!c&&c.isCreating&&this.editor.getOnlySelectedShapeId()===a.id},[a.id]),d=this.options.showColors,e=d?a.props.color:"black",f=hp(b,e,"frameFill"),g=hp(b,e,"frameStroke"),h=d?hp(b,e,"frameHeadingStroke"):b.background,i=d?hp(b,e,"frameHeadingFill"):b.background,j=hp(b,e,"frameText");return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)(lg,{children:(0,bT.jsx)("rect",{className:(0,j1.default)("tl-frame__body",{"tl-frame__creating":c}),fill:f,stroke:g,style:{width:`calc(${a.props.w}px + 1px / var(--tl-zoom))`,height:`calc(${a.props.h}px + 1px / var(--tl-zoom))`,transform:"translate(calc(-0.5px / var(--tl-zoom)), calc(-0.5px / var(--tl-zoom)))"}})}),c?null:(0,bT.jsx)(YS,{id:a.id,name:a.props.name,fill:i,stroke:h,color:j,width:a.props.w,height:a.props.h,offsetX:d?-1:-7,showColors:this.options.showColors})]})}toSvg(a,b){let c=hl({isDarkMode:b.isDarkMode}),d=YM(this.editor,a),e=d%2==1?a.props.h:a.props.w,f=YQ(a,d,!0),g=YP(e-12,!0),h=YT(a.props.name,"Frame")+String.fromCharCode(8203),i=YO(this.editor,a,g),j=this.editor.textMeasure.measureTextSpans(h,g),k=function(a,b,c){let{padding:d=0}=c;if(0===b.length)return null;let e=lh.From(b[0].box);for(let{box:a}of b)e.union(a);let f=d+(c.offsetX??0),g=(c.offsetY??0)+c.fontSize/2+("start"===c.verticalTextAlign?d:"end"===c.verticalTextAlign?c.height-d-e.height:(Math.ceil(c.height)-e.height)/2),h=null,i=[];for(let{text:a,box:c}of b)null!==h&&c.y>h&&i.push((0,bT.jsx)("tspan",{alignmentBaseline:"mathematical",x:f,y:c.y+g,children:"\n"},i.length)),i.push((0,bT.jsx)("tspan",{alignmentBaseline:"mathematical",x:c.x+f,y:c.y+g,unicodeBidi:"plaintext",children:a.replace(/\s/g," ")},i.length)),h=c.y;return(0,bT.jsx)("text",{fontSize:c.fontSize,fontFamily:c.fontFamily,fontStyle:c.fontStyle,fontWeight:c.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:c.stroke,strokeWidth:c.strokeWidth,fill:c.fill,children:i})}(this.editor,j,g),l=this.options.showColors,m=l?a.props.color:"black",n=hp(c,m,"frameFill"),o=hp(c,m,"frameStroke"),p=l?hp(c,m,"frameHeadingStroke"):c.background,q=l?hp(c,m,"frameHeadingFill"):c.background,r=hp(c,m,"frameText");return(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)("rect",{width:a.props.w,height:a.props.h,fill:n,stroke:o,strokeWidth:1,x:0,rx:0,ry:0}),(0,bT.jsxs)("g",{fill:r,transform:f,children:[(0,bT.jsx)("rect",{x:i.x-6*!l,y:i.y-6,width:Math.min(e,i.width+12),height:i.height,fill:q,stroke:p,rx:4,ry:4}),(0,bT.jsx)("g",{transform:`translate(${8*!!l}, 4)`,children:k})]})]})}indicator(a){return(0,bT.jsx)("rect",{width:jX(a.props.w),height:jX(a.props.h),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}getClipPath(a){return this.editor.getShapeGeometry(a.id).vertices}canReceiveNewChildrenOfType(a){return!a.isLocked}onResize(a,b){return st(a,b)}getInterpolatedProps(a,b,c){var d,e;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c)}}onDoubleClickEdge(a,b){if("selection"!==b.target)return;let{handle:c}=b;if(!c)return;let d="left"===c||"right"===c,e="top"===c||"bottom"===c,f=this.editor.getSortedChildIdsForParent(a.id),g=b5(f.map(a=>this.editor.getShape(a)));if(!g.length)return;let{dx:h,dy:i,w:j,h:k}=z0(g,this.editor,{padding:10});return this.editor.run(()=>{let a=f.map(a=>{let b=this.editor.getShape(a);return{id:b.id,type:b.type,x:d?b.x+h:b.x,y:e?b.y+i:b.y}});this.editor.updateShapes(a)}),{id:a.id,type:a.type,props:{w:d?j:a.props.w,h:e?k:a.props.h}}}onDoubleClickCorner(a){return z1(this.editor,a.id,{padding:10}),{id:a.id,type:a.type}}onDragShapesIn(a,b,{initialParentIds:c,initialIndices:d}){let{editor:e}=this;if(b.every(b=>b.parentId===a.id))return;let f=!1,g=b.filter(b=>a.id===c.get(b.id));if(g.length>0){let b=b5(e.getSortedChildIdsForParent(a).map(a=>e.getShape(a)));g.every(a=>!b.find(b=>b.index===a.index))&&(f=!0)}if(!b.some(b=>e.hasAncestor(a,b.id))&&(e.reparentShapes(b,a.id),f))for(let a of g)e.updateShape({id:a.id,type:a.type,index:d.get(a.id)})}onDragShapesOut(a,b,c){let{editor:d}=this;c.nextDraggingOverShapeId||d.reparentShapes(b.filter(b=>b.parentId===a.id&&this.canReceiveNewChildrenOfType(b)),d.getCurrentPageId())}},Yl,class extends lC{static type="highlight";static props=iW;static migrations=iX;options={maxPointsPerShape:600,underlayOpacity:.82,overlayOpacity:.35};hideResizeHandles(a){return Y3(a)}hideRotateHandle(a){return Y3(a)}hideSelectionBoundsFg(a){return Y3(a)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(a){let b=Y2(a);if(Y3(a))return new sE({x:-b/2,y:-b/2,radius:b/2,isFilled:!0});let{strokePoints:c,sw:d}=Y1(a,b,!0),e=YD({strokeWidth:d,showAsComplete:!0});return Ri(c,e),new lz({points:Rf(c,e),isFilled:!0})}component(a){let b=Y5(this.editor,a),c=Y2(a);return(0,bT.jsx)(lg,{children:(0,bT.jsx)(Y4,{shape:a,forceSolid:b,strokeWidth:c,opacity:this.options.overlayOpacity})})}backgroundComponent(a){let b=Y5(this.editor,a),c=Y2(a);return(0,bT.jsx)(lg,{children:(0,bT.jsx)(Y4,{shape:a,forceSolid:b,strokeWidth:c,opacity:this.options.underlayOpacity})})}indicator(a){var b;let c,d,e=Y5(this.editor,a),f=Y2(a),{strokePoints:g,sw:h}=Y1(a,f,e),i=YF(a.props.segments);return d=g.length<2?(b=i[0],c=h/2,`M ${b.x} ${b.y} m -${c}, 0 a ${c},${c} 0 1,0 ${2*c},0 a ${c},${c} 0 1,0 -${2*c},0`):Yy(g,!1),(0,bT.jsx)("path",{d:d})}toSvg(a){let b=Y2(a),c=1/a.props.scale;return(0,bT.jsx)("g",{transform:`scale(${c})`,children:(0,bT.jsx)(Y4,{forceSolid:b<1.5,strokeWidth:b,shape:a,opacity:this.options.overlayOpacity})})}toBackgroundSvg(a){let b=Y2(a),c=1/a.props.scale;return(0,bT.jsx)("g",{transform:`scale(${c})`,children:(0,bT.jsx)(Y4,{forceSolid:b<1.5,strokeWidth:b,shape:a,opacity:this.options.underlayOpacity})})}onResize(a,b){let{scaleX:c,scaleY:d}=b,e=[];for(let b of a.props.segments)e.push({...b,points:b.points.map(({x:a,y:b,z:e})=>({x:c*a,y:d*b,z:e}))});return{props:{segments:e}}}getInterpolatedProps(a,b,c){var d;return{...c>.5?b.props:a.props,...b.props,segments:YA(a.props.segments,b.props.segments,c),scale:(d=a.props.scale,d+(b.props.scale-d)*c)}}},YK,class extends su{static type="image";static props=iZ;static migrations=i_;isAspectRatioLocked(){return!0}canCrop(){return!0}isExportBoundsContainer(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1,altText:""}}getGeometry(a){return a.props.crop?.isCircle?new sG({width:a.props.w,height:a.props.h,isFilled:!0}):new lA({width:a.props.w,height:a.props.h,isFilled:!0})}getAriaDescriptor(a){return a.props.altText}onResize(a,b){let c=st(a,b),{flipX:d,flipY:e}=b.initialShape.props,{scaleX:f,scaleY:g,mode:h}=b;if(c={...c,props:{...c.props,flipX:f<0!==d,flipY:g<0!==e}},!a.props.crop)return c;let i="scale_shape"===h&&-1===f||"resize_bounds"===h&&d!==c.props.flipX,j="scale_shape"===h&&-1===g||"resize_bounds"===h&&e!==c.props.flipY,{topLeft:k,bottomRight:l}=a.props.crop;return c.props.crop={topLeft:{x:i?1-l.x:k.x,y:j?1-l.y:k.y},bottomRight:{x:i?1-k.x:l.x,y:j?1-k.y:l.y},isCircle:a.props.crop.isCircle},c}component(a){return(0,bT.jsx)(Zb,{shape:a})}indicator(a){return this.editor.getCroppingShapeId()===a.id?null:a.props.crop?.isCircle?(0,bT.jsx)("ellipse",{cx:jX(a.props.w/2),cy:jX(a.props.h/2),rx:jX(a.props.w/2),ry:jX(a.props.h/2)}):(0,bT.jsx)("rect",{width:jX(a.props.w),height:jX(a.props.h)})}async toSvg(a,b){let c=a.props;if(!c.assetId)return null;let d=this.editor.getAsset(c.assetId);if(!d)return null;let{w:e}=MZ(a.props,c.crop),f=await Za.get(d,async()=>{let a=await b.resolveAssetUrl(d.id,e);if(!a)return null;if((a.startsWith("blob:")||a.startsWith("http")||a.startsWith("/")||a.startsWith("./"))&&(a=await Y9(a)||""),Zc(this.editor,d.id)){let{promise:b}=Zg(a);a=await b}return a});return f?(0,bT.jsx)(Zf,{shape:a,src:f}):null}onDoubleClickEdge(a){let b=a.props;if(!b||this.editor.getCroppingShapeId()!==a.id)return;let c=d$(b.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},{w:d,h:e}=MZ(a.props,c),f=new jA(c.topLeft.x*d,c.topLeft.y*e).rot(a.rotation),g={id:a.id,type:a.type,x:a.x-f.x,y:a.y-f.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:d,h:e}};this.editor.updateShapes([g])}getInterpolatedProps(a,b,c){var d,e;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c),crop:function(a,b){var d,e,f,g;if(null===a.props.crop&&null===b.props.crop)return null;let h=a.props.crop?.topLeft||{x:0,y:0},i=a.props.crop?.bottomRight||{x:1,y:1},j=b.props.crop?.topLeft||{x:0,y:0},k=b.props.crop?.bottomRight||{x:1,y:1};return{topLeft:{x:(d=h.x,d+(j.x-d)*c),y:(e=h.y,e+(j.y-e)*c)},bottomRight:{x:(f=i.x,f+(k.x-f)*c),y:(g=i.y,g+(k.y-g)*c)}}}(a,b)}}},class extends su{static type="video";static props=jc;static migrations=je;options={autoplay:!0};canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,autoplay:this.options.autoplay,url:"",altText:"",time:0,playing:!0}}getAriaDescriptor(a){return a.props.altText}component(a){return(0,bT.jsx)(Zu,{shape:a})}indicator(a){return(0,bT.jsx)("rect",{width:jX(a.props.w),height:jX(a.props.h)})}async toSvg(a,b){let c=a.props;if(!c.assetId)return null;let d=this.editor.getAsset(c.assetId);if(!d)return null;let e=await Zt.get(d,async()=>{let a=await b.resolveAssetUrl(d.id,c.w);if(!a)return null;let e=await cP.loadVideo(a);return await cP.getVideoFrameAsDataUrl(e,0)});return e?(0,bT.jsx)("image",{href:e,width:c.w,height:c.h,"aria-label":a.props.altText}):null}}];class Zw extends ps{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;_isHoldingAccelKey=!1;_firstErasingShapeId=null;_erasingShapeIds=[];onEnter(a){this._isHoldingAccelKey=kg(this.editor.inputs),this._firstErasingShapeId=this.editor.getErasingShapeIds()[0],this._erasingShapeIds=this.editor.getErasingShapeIds(),this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=a;let{originPagePoint:b}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(a=>{if(this.editor.isShapeOrAncestorLocked(a))return!0;if(this.editor.isShapeOfType(a,"group")||this.editor.isShapeOfType(a,"frame")){let c=this.editor.getPointInShapeSpace(a,b);return this.editor.getShapeGeometry(a).bounds.containsPoint(c)}return!1}).map(a=>a.id));let c=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=c.id,this.update()}pushPointToScribble(){let{x:a,y:b}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,a,b)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onKeyUp(){this._isHoldingAccelKey=kg(this.editor.inputs),this.update()}onKeyDown(){this._isHoldingAccelKey=kg(this.editor.inputs),this.update()}update(){let{editor:a,excludedShapeIds:b}=this,c=a.getErasingShapeIds(),d=a.getZoomLevel(),e=a.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:f,previousPagePoint:g}}=a;this.pushPointToScribble();let h=new Set(c),i=this.editor.options.hitTestMargin/d;for(let b of e){if(a.isShapeOfType(b,"group"))continue;let c=a.getShapeMask(b.id);if(c&&!jW(f,c))continue;let d=a.getShapeGeometry(b),e=a.getShapePageTransform(b);if(!d||!e)continue;let j=e.clone().invert(),k=j.applyToPoint(g),l=j.applyToPoint(f),{bounds:m}=d;m.minX-i>Math.max(k.x,l.x)||m.minY-i>Math.max(k.y,l.y)||m.maxX+i<Math.min(k.x,l.x)||m.maxY+i<Math.min(k.y,l.y)||(d.hitTestLineSegment(k,l,i)&&h.add(a.getOutermostSelectableShape(b).id),this._erasingShapeIds=[...h])}if(this._isHoldingAccelKey&&this._firstErasingShapeId){let b=this._firstErasingShapeId;b&&this.editor.getShape(b)&&a.setErasingShapes([b]);return}this.editor.setErasingShapes(this._erasingShapeIds.filter(a=>!b.has(a)))}complete(){let{editor:a}=this;a.deleteShapes(a.getCurrentPageState().erasingShapeIds),this.parent.transition("idle"),this._erasingShapeIds=[],this._firstErasingShapeId=null}cancel(){let{editor:a}=this;a.bailToMark(this.markId),this.parent.transition("idle",this.info)}}class Zx extends ps{static id="idle";onPointerDown(a){this.parent.transition("pointing",a)}onCancel(){this.editor.setCurrentTool("select")}}class Zy extends ps{static id="pointing";_isHoldingAccelKey=!1;onEnter(){this._isHoldingAccelKey=kg(this.editor.inputs);let a=this.editor.getZoomLevel(),b=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:c}}=this.editor,d=new Set,e=d.size;for(let f=b.length,g=f-1;g>=0;g--){let f=b[g];if(!(this.editor.isShapeOrAncestorLocked(f)||this.editor.isShapeOfType(f,"group"))&&this.editor.isPointInShape(f,c,{hitInside:!1,margin:this.editor.options.hitTestMargin/a})){let a=this.editor.getOutermostSelectableShape(f);if(this.editor.isShapeOfType(a,"frame")&&d.size>e||(d.add(a.id),this._isHoldingAccelKey))break}}this.editor.setErasingShapes([...d])}onKeyUp(){this._isHoldingAccelKey=kg(this.editor.inputs)}onKeyDown(){this._isHoldingAccelKey=kg(this.editor.inputs)}onLongPress(a){this.startErasing(a)}onExit(a,b){"erasing"!==b&&this.editor.setErasingShapes([])}onPointerMove(a){!this._isHoldingAccelKey&&this.editor.inputs.isDragging&&this.startErasing(a)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(a){this.parent.transition("erasing",a)}complete(){let a=this.editor.getErasingShapeIds();a.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(a)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class Zz extends ps{static id="dragging";initialCamera=new jA;onEnter(){this.initialCamera=jA.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){let{initialCamera:a,editor:b}=this,{currentScreenPoint:c,originScreenPoint:d}=b.inputs,e=jA.Sub(c,d).div(b.getZoomLevel());0!==e.len2()&&b.setCamera(a.clone().add(e))}complete(){let{editor:a}=this,{pointerVelocity:b}=a.inputs,c=Math.min(b.len(),2);c>.1&&this.editor.slideCamera({speed:c,direction:b}),this.parent.transition("idle")}}class ZA extends ps{static id="idle";onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(a){this.parent.transition("pointing",a)}onCancel(){this.editor.setCurrentTool("select")}}class ZB extends ps{static id="pointing";onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}}class ZC extends ps{static id="idle";onCancel(){this.editor.setCurrentTool("select")}onPointerDown(a){this.parent.transition("lasering",a)}}class ZD extends ps{static id="lasering";scribbleId="id";onEnter(){let a=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=a.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){let{x:a,y:b}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,a,b)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class ZE extends ps{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;viewportDidChange=!1;cleanupViewportChangeReactor(){}onEnter(a){let{editor:b}=this,{altKey:c}=b.inputs;this.isWrapMode=b.user.getIsWrapMode(),this.viewportDidChange=!1;let d=!0;(this.cleanupViewportChangeReactor=eg("viewport change while brushing",()=>{b.getViewportPageBounds(),d||this.viewportDidChange||(this.viewportDidChange=!0)}),c)?this.parent.transition("scribble_brushing",a):(this.excludedShapeIds=new Set(b.getCurrentPageShapes().filter(a=>b.isShapeOfType(a,"group")||b.isShapeOrAncestorLocked(a)).map(a=>a.id)),this.info=a,this.initialSelectedShapeIds=b.getSelectedShapeIds().slice(),this.hitTestShapes(),d=!1)}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null}),this.cleanupViewportChangeReactor()}onTick({elapsed:a}){let{editor:b}=this;b.edgeScrollManager.updateEdgeScrolling(a)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(a){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",a)}onKeyDown(a){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",a):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){let a,b,c,d,e,f,{editor:g,excludedShapeIds:h,isWrapMode:i}=this,{inputs:{originPagePoint:j,currentPagePoint:k,shiftKey:l,ctrlKey:m}}=g,n=new Set(l?this.initialSelectedShapeIds:[]),o=i?!m:m,p=lh.FromPoints([j,k]),{corners:q}=p,r=g.getViewportPageBounds().contains(p)&&!this.viewportDidChange?g.getCurrentPageRenderingShapesSorted():g.getCurrentPageShapesSorted(),s=g.getCurrentPageId();for(let i=0,j=r.length;i<j;i++){if(c=r[i],!(h.has(c.id)||n.has(c.id))&&(d=g.getShapePageBounds(c))){if(p.contains(d)){this.handleHit(c,k,s,n,q);continue}if(!(o||g.isShapeOfType(c,"frame"))&&p.collides(d)){if(!(e=g.getShapePageTransform(c)))continue;f=e.clone().invert().applyToPoints(q);let d=g.getShapeGeometry(c);for(let e=0;e<4;e++)if(a=f[e],b=f[(e+1)%4],d.hitTestLineSegment(a,b,0)){this.handleHit(c,k,s,n,q);break}}}}let t=g.getInstanceState().brush;t&&p.equals(t)||g.updateInstanceState({brush:{...p.toJson()}});let u=g.getSelectedShapeIds();(u.length!==n.size||u.some(a=>!n.has(a)))&&g.setSelectedShapes(Array.from(n))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(a,b,c,d,e){if(a.parentId===c)return void d.add(a.id);let f=this.editor.getOutermostSelectableShape(a),g=this.editor.getShapeMask(f.id);(!g||lr(g,e)||jW(b,g))&&d.add(f.id)}}let ZF={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class ZG extends ps{static id="pointing_resize_handle";info={};updateCursor(){let a=this.editor.getSelectedShapes(),b=ZF[this.info.handle];this.editor.setCursor({type:b,rotation:1===a.length?this.editor.getSelectionRotation():0})}onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}cancel(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}}class ZH extends ps{static id="cropping";info={};markId="";snapshot={};onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0)}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;let a=ZF[this.info.handle];this.editor.setCursor({type:a,rotation:this.editor.getSelectionRotation()})}updateShapes(){let{shape:a,cursorHandleOffset:b}=this.snapshot;if(!a)return;let c=this.editor.getShapeUtil(a.type);if(!c)return;let{shiftKey:d}=this.editor.inputs,e=this.editor.inputs.currentPagePoint.clone().sub(b),f=this.editor.inputs.originPagePoint.clone().sub(b),g=e.clone().sub(f).rot(-a.rotation),h=a.props.crop??MW(),i=MZ(a.props,h),j=(c.onCrop?.bind(c)??function(a,b,c={}){let{handle:d,change:e,crop:f,aspectRatioLocked:g}=b,{w:h,h:i}=b.uncroppedSize,{minWidth:j=8,minHeight:k=8}=c;if(h<j||i<k||0===e.x&&0===e.y)return;let l=new lh(f.topLeft.x*h,f.topLeft.y*i,(f.bottomRight.x-f.topLeft.x)*h,(f.bottomRight.y-f.topLeft.y)*i),m=l.aspectRatio,n=l.clone();if("top_left"===d||"bottom_left"===d||"left"===d)n.x=jI(n.x+e.x,0,l.maxX-j),n.w=l.maxX-n.x;else if("top_right"===d||"bottom_right"===d||"right"===d){let a=jI(n.maxX+e.x,l.x+j,h);n.w=a-n.x}if("top_left"===d||"top_right"===d||"top"===d)n.y=jI(n.y+e.y,0,l.maxY-k),n.h=l.maxY-n.y;else if("bottom_left"===d||"bottom_right"===d||"bottom"===d){let a=jI(n.maxY+e.y,l.y+k,i);n.h=a-n.y}if(g)switch(n.aspectRatio>m?n.h=n.w/m:n.w=n.h*m,d){case"top_left":n.x=l.maxX-n.w,n.y=l.maxY-n.h,n.x<=0&&(n.x=0,n.w=l.maxX-n.x,n.h=n.w/m,n.y=l.maxY-n.h),n.y<=0&&(n.y=0,n.h=l.maxY-n.y,n.w=n.h*m,n.x=l.maxX-n.w);break;case"top_right":n.x=l.x,n.y=l.maxY-n.h,n.maxX>=h&&(n.w=h-l.x,n.h=n.w/m,n.y=l.maxY-n.h),n.y<=0&&(n.y=0,n.h=l.maxY-n.y,n.w=n.h*m);break;case"bottom_left":n.x=l.maxX-n.w,n.y=l.y,n.x<=0&&(n.x=0,n.w=l.maxX-n.x,n.h=n.w/m),n.maxY>=i&&(n.h=i-l.y,n.w=n.h*m,n.x=l.maxX-n.w);break;case"bottom_right":n.x=l.x,n.y=l.y,n.maxX>=h&&(n.w=h-l.x,n.h=n.w/m),n.maxY>=i&&(n.h=i-l.y,n.w=n.h*m);break;case"top":n.h=l.maxY-n.y,n.w=n.h*m,n.x-=(n.w-l.w)/2,n.x<=0&&(n.w=2*l.midX,n.h=n.w/m,n.x=0),n.maxX>=h&&(n.w=2*(h-l.midX),n.h=n.w/m,n.x=h-n.w),n.y=l.maxY-n.h;break;case"right":n.w=n.maxX-l.x,n.h=n.w/m,n.y-=(n.h-l.h)/2,n.y<=0&&(n.h=2*l.midY,n.w=n.h*m,n.y=0),n.maxY>=i&&(n.h=2*(i-l.midY),n.w=n.h*m,n.y=i-n.h);break;case"bottom":n.h=n.maxY-l.y,n.w=n.h*m,n.x-=(n.w-l.w)/2,n.x<=0&&(n.w=2*l.midX,n.h=n.w/m,n.x=0),n.maxX>=h&&(n.w=2*(h-l.midX),n.h=n.w/m,n.x=h-n.w);break;case"left":n.w=l.maxX-n.x,n.h=n.w/m,n.y-=(n.h-l.h)/2,n.y<=0&&(n.h=2*l.midY,n.w=n.h*m,n.y=0),n.maxY>=i&&(n.h=2*(i-l.midY),n.w=n.h*m,n.y=i-n.h),n.x=l.maxX-n.w}let o={topLeft:{x:n.x/h,y:n.y/i},bottomRight:{x:n.maxX/h,y:n.maxY/i},isCircle:f.isCircle};if(o.topLeft.x===f.topLeft.x&&o.topLeft.y===f.topLeft.y&&o.bottomRight.x===f.bottomRight.x&&o.bottomRight.y===f.bottomRight.y)return;let p=new jA(n.x-f.topLeft.x*h,n.y-f.topLeft.y*i).rot(a.rotation).add(a);return{id:a.id,type:a.type,x:p.x,y:p.y,props:{w:n.w,h:n.h,crop:o}}})(a,{handle:this.info.handle,change:g,crop:h,uncroppedSize:i,initialShape:this.snapshot.shape,aspectRatioLocked:d});j&&(this.editor.updateShapes([{id:a.id,type:a.type,...j}]),this.updateCursor())}complete(){this.updateShapes(),sH(this.editor,[this.snapshot.shape.id]);let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId);let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){let a=this.editor.getSelectionRotation(),{inputs:{originPagePoint:b}}=this.editor,c=this.editor.getOnlySelectedShape(),d=this.editor.getSelectionRotatedPageBounds(),e=jA.RotWith(d.getHandlePoint(this.info.handle),d.point,a);return{shape:c,cursorHandleOffset:jA.Sub(b,e)}}}function ZI(a,b=!1){let c=a.getZoomLevel(),{inputs:{currentPagePoint:d}}=a;return a.getShapeAtPoint(d,{hitInside:!1,hitLabels:b,margin:a.options.hitTestMargin/c,renderingOnly:!0})??a.getSelectedShapeAtPoint(d)}function ZJ(a,b,c){if(!b)throw Error("Needs to translate a cropped shape!");let{crop:d}=b.props;if(!d)return;let e=a.inputs.shiftKey?Math.abs(c.x)<Math.abs(c.y)?"x":"y":null;"x"===e?c.x=0:"y"===e&&(c.y=0),c.rot(-b.rotation);let{w:f,h:g}=MZ(b.props,d),h=d.bottomRight.x-d.topLeft.x,i=d.bottomRight.y-d.topLeft.y,j=d$(d);return j.topLeft.x=jI(j.topLeft.x-c.x/f,0,1-h),j.topLeft.y=jI(j.topLeft.y-c.y/g,0,1-i),j.bottomRight.x=j.topLeft.x+h,j.bottomRight.y=j.topLeft.y+i,{id:b.id,type:b.type,props:{crop:j}}}class ZK extends ps{static id="idle";onEnter(){this.editor.setCursor({type:"default",rotation:0});let a=this.editor.getOnlySelectedShape();a&&this.editor.setCroppingShape(a.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(a){if(a.accelKey){this.cancel(),this.editor.root.handleEvent(a);return}switch(a.target){case"canvas":{let b=ZI(this.editor);if(b&&!this.editor.isShapeOfType(b,"group"))return void this.onPointerDown({...a,shape:b,target:"shape"});this.cancel(),this.editor.root.handleEvent(a);break}case"shape":if(a.shape.id===this.editor.getCroppingShapeId())return void this.editor.setCurrentTool("select.crop.pointing_crop",a);this.editor.getShapeUtil(a.shape)?.canCrop(a.shape)?(this.editor.setCroppingShape(a.shape.id),this.editor.setSelectedShapes([a.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",a)):(this.cancel(),this.editor.root.handleEvent(a));break;case"selection":switch(a.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...a,onInteractionEnd:"select.crop.idle"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...a,onInteractionEnd:"select.crop.idle"});break;default:this.cancel()}}}onDoubleClick(a){if(this.editor.inputs.shiftKey||"up"!==a.phase)return;let b=this.editor.getCroppingShapeId();if(!b)return;let c=this.editor.getShape(b);if(!c)return;let d=this.editor.getShapeUtil(c);if(d){if("selection"===a.target)return void d.onDoubleClickEdge?.(c,a);this.cancel(),this.editor.root.handleEvent(a)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(a){"Enter"===a.key&&(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{}))}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(a=!1){let{editor:{inputs:{keys:b}}}=this,c=b.has("ShiftLeft"),d=new jA(0,0);if(b.has("ArrowLeft")&&(d.x+=1),b.has("ArrowRight")&&(d.x-=1),b.has("ArrowUp")&&(d.y+=1),b.has("ArrowDown")&&(d.y-=1),d.equals(new jA(0,0)))return;c&&d.mul(10);let e=this.editor.getShape(this.editor.getCroppingShapeId());if(!e)return;let f=ZJ(this.editor,e,d);f&&(a||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([f]))}}class ZL extends ps{static id="pointing_crop";onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(a){this.editor.inputs.isDragging&&this.startDragging(a)}onLongPress(a){this.startDragging(a)}onPointerUp(a){this.editor.setCurrentTool("select.crop.idle",a)}startDragging(a){this.editor.setCurrentTool("select.crop.translating_crop",a)}}class ZM extends ps{static id="pointing_crop_handle";info={};onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd);let b=this.editor.getSelectedShapes()[0];if(!b)return;let c=ZF[this.info.handle];this.editor.setCursor({type:c,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(b.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}class ZN extends ps{static id="translating_crop";info={};markId="";snapshot={};onEnter(a){this.info=a,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(a){switch(a.key){case"Alt":case"Shift":return void this.updateShapes()}}onKeyUp(a){switch(a.key){case"Enter":return void this.complete();case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){let a=this.snapshot.shape;if(!a)return;let{originPagePoint:b,currentPagePoint:c}=this.editor.inputs,d=c.clone().sub(b),e=ZJ(this.editor,a,d);e&&this.editor.updateShapes([e])}}class ZO extends ps{static id="crop";static initial="idle";static children(){return[ZK,ZN,ZL,ZM,ZH]}markId="";onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}didExit=!1;onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}class ZP extends ps{static id="dragging_handle";shapeId;initialHandle;initialAdjacentHandle;initialPagePoint;markId;initialPageTransform;initialPageRotation;info;isPrecise=!1;isPreciseId=null;pointingId=null;onEnter(a){let{shape:b,isCreating:c,creatingMarkId:d,handle:e}=a;if(this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.shapeId=b.id,this.markId="",c)if(d)this.markId=d;else{let a=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);a&&(this.markId=a)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");this.initialHandle=d$(e),this.initialPageTransform=this.editor.getShapePageTransform(b),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:c?"cross":"grabbing",rotation:0});let f=this.editor.getShapeHandles(b).sort(dz),g=f.findIndex(b=>b.id===a.handle.id);if(this.initialAdjacentHandle=null,a.handle.snapReferenceHandleId){let b=f.find(b=>b.id===a.handle.snapReferenceHandleId);b&&(this.initialAdjacentHandle=b)}if(!this.initialAdjacentHandle){for(let b=g+1;b<f.length;b++){let c=f[b];if("vertex"===c.type&&"middle"!==c.id&&c.id!==a.handle.id){this.initialAdjacentHandle=c;break}}if(!this.initialAdjacentHandle)for(let b=f.length-1;b>=0;b--){let c=f[b];if("vertex"===c.type&&"middle"!==c.id&&c.id!==a.handle.id){this.initialAdjacentHandle=c;break}}}if(this.editor.isShapeOfType(b,"arrow")){let c=JO(this.editor,b)[a.handle.id];this.isPrecise=!1,c&&(this.isPrecise=c.props.isPrecise,this.isPrecise?this.isPreciseId=c.toId:this.resetExactTimeout())}let h={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:b},i=this.editor.getShapeUtil(b),j=i.onHandleDragStart?.(b,h);j&&this.editor.updateShapes([{...j,id:b.id,type:b.type}]),this.update(),this.editor.select(this.shapeId)}exactTimeout=-1;resetExactTimeout(){let a=this.editor.getShapeUtil("arrow").options.pointingPreciseTimeout;-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},a)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),Q6(this.editor),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),sH(this.editor,[this.shapeId]);let a=this.editor.getShape(this.shapeId);if(a){let b=this.editor.getShapeUtil(a),c={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:this.info.shape},d=b.onHandleDragEnd?.(a,c);d&&this.editor.updateShapes([{...d,id:a.id,type:a.type}])}let{onInteractionEnd:b}=this.info;if(b){if("string"!=typeof b)return void b?.();else if(this.editor.getInstanceState().isToolLocked&&b)return void this.editor.setCurrentTool(b,{shapeId:this.shapeId})}this.parent.transition("idle")}cancel(){let a=this.editor.getShape(this.shapeId);if(a){let b=this.editor.getShapeUtil(a),c={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:this.info.shape};b.onHandleDragCancel?.(a,c)}this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();let{onInteractionEnd:b}=this.info;b?"string"==typeof b?this.editor.setCurrentTool(b,{shapeId:this.shapeId}):b?.():this.parent.transition("idle")}update(){let{editor:a,shapeId:b,initialPagePoint:c}=this,{initialHandle:d,initialPageRotation:e,initialAdjacentHandle:f}=this,g=this.editor.user.getIsSnapMode(),{snaps:h,inputs:{currentPagePoint:i,shiftKey:j,ctrlKey:k,altKey:l,pointerVelocity:m}}=a,n=this.info.shape,o=a.getShape(b);if(!o)return;let p=a.getShapeUtil(o),q=a.isShapeOfType(o,"arrow")?JO(a,o)[d.id]:void 0,r=i.clone().sub(c).rot(-e).add(d);if(j&&f&&"middle"!==d.id){let a=jA.Angle(f,r),b=jQ(a,24);r=jA.RotWith(r,f,b-a)}a.snaps.clearIndicators();let s={...d,x:r.x,y:r.y},t=!1;if(d.canSnap&&d.snapType?d3("canSnap is deprecated. Cannot use both canSnap and snapType together - snapping disabled. Please use only snapType."):t=d.canSnap||void 0!==d.snapType,t&&(g?!k:k)){if(!a.getShapePageTransform(o.id))throw Error("Expected a page transform");let c=h.handles.snapHandle({currentShapeId:b,handle:s});c&&(c.nudge.rot(-a.getShapeParentTransform(o).rotation()),r.add(c.nudge),s={...d,x:r.x,y:r.y})}let u=p.onHandleDrag?.(o,{handle:s,isPrecise:this.isPrecise||l,isCreatingShape:!!this.info.isCreating,initial:n}),v={id:o.id,type:o.type,...u};if("vertex"===d.type&&this.editor.isShapeOfType(o,"arrow")){let b=JO(a,o)[d.id];b?q?.toId!==b.toId&&(this.pointingId=b.toId,this.isPrecise=.5>m.len()||l,this.isPreciseId=this.isPrecise?b.toId:null,this.resetExactTimeout()):q&&(this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}u&&a.updateShapes([v])}}function ZQ(a){return a.isLabel?[a]:a instanceof lw?a.children.filter(a=>a.isLabel):[]}class ZR extends ps{static id="editing_shape";hitShapeForPointerUp=null;info={};onEnter(a){let b=this.editor.getEditingShape();if(!b)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=a,a.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),XK(this.editor),this.editor.select(b)}onExit(){let{editingShapeId:a}=this.editor.getCurrentPageState();a&&(this.editor.setEditingShape(null),XK.cancel(),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{})))}onPointerMove(a){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",a),this.hitShapeForPointerUp=null;return}switch(a.target){case"shape":case"canvas":return void XK(this.editor)}}onPointerDown(a){switch(this.hitShapeForPointerUp=null,a.target){case"canvas":{let b=ZI(this.editor,!0);if(b)return void this.onPointerDown({...a,shape:b,target:"shape"});break}case"shape":{let{shape:b}=a,c=this.editor.getEditingShape();if(!c)throw Error("Expected an editing shape!");let d=ZQ(this.editor.getShapeUtil(b).getGeometry(b)),e=1===d.length?d[0]:void 0,f=this.editor.isShapeOfType(c,"text")&&""===Xd(this.editor,c.props.richText).trim();if(e&&!f){let a=this.editor.getPointInShapeSpace(b,this.editor.inputs.currentPagePoint);if(e.bounds.containsPoint(a,0)&&e.hitTestPoint(a))if(b.id===c.id)return;else{this.hitShapeForPointerUp=b,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(b.id);return}}else{if(b.id!==c.id)return void this.parent.transition("pointing_shape",a);this.editor.isShapeOfType(b,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",a));return}}}this.parent.transition("idle",a),this.editor.root.handleEvent(a)}onPointerUp(a){let b=this.hitShapeForPointerUp;if(!b)return;this.hitShapeForPointerUp=null;let c=this.editor.getShapeUtil(b);if(b.isLocked)return;if(this.editor.getIsReadonly()&&!c.canEditInReadonly(b))return void this.parent.transition("pointing_shape",a);this.editor.select(b.id);let d=this.editor.getEditingShape(),e=d&&d.id!==b.id;this.editor.setEditingShape(b.id);this.editor.emit("place-caret",{shapeId:b.id,point:a.point}),XK(this.editor)}onComplete(a){this.editor.getContainer().focus(),this.parent.transition("idle",a)}onCancel(a){this.editor.getContainer().focus(),this.parent.transition("idle",a)}}function ZS(a){let b=a.getOnlySelectedShape();return!!(b&&!a.isShapeOrAncestorLocked(b)&&a.getShapeUtil(b).canCrop(b))}function ZT(a,b){let c=a.getSelectedShapeIds(),{currentPagePoint:d}=a.inputs,{shiftKey:e,altKey:f,accelKey:g}=b,h=e||g,i=a.getShapeAtPoint(d,{hitInside:!1,margin:a.options.hitTestMargin/a.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:a=>!a.isLocked});if(i){let b=a.getOutermostSelectableShape(i);if(h&&!f)a.cancelDoubleClick(),c.includes(b.id)?(a.markHistoryStoppingPoint("deselecting shape"),a.deselect(b)):(a.markHistoryStoppingPoint("shift selecting shape"),a.setSelectedShapes([...c,b.id]));else{let d;(d=b===i||b.id===a.getFocusedGroupId()||c.includes(b.id)?i:b)&&!c.includes(d.id)&&(a.markHistoryStoppingPoint("selecting shape"),a.select(d.id))}}else{if(h)return;c.length>0&&(a.markHistoryStoppingPoint("selecting none"),a.selectNone());let b=a.getFocusedGroupId();if(hc(b)){let c=a.getShape(b);a.isPointInShape(c,d,{margin:0,hitInside:!0})||a.setFocusedGroup(null)}}}let ZU=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];class ZV extends ps{static id="idle";selectedShapesOnKeyDown=[];onEnter(){this.parent.setCurrentToolIdMask(void 0),XK(this.editor),this.selectedShapesOnKeyDown=[],this.editor.setCursor({type:"default",rotation:0})}onExit(){XK.cancel()}onPointerMove(){XK(this.editor)}onPointerDown(a){let b=a.ctrlKey&&ZS(this.editor);switch(a.target){case"canvas":{let b=ZI(this.editor);if(b&&!b.isLocked)return void this.onPointerDown({...a,shape:b,target:"shape"});let c=this.editor.getSelectedShapeIds(),d=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:e}}=this.editor;if((c.length>1||d&&!this.editor.getShapeUtil(d).hideSelectionBoundsBg(d))&&ZZ(this.editor,e))return void this.onPointerDown({...a,target:"selection"});this.parent.transition("pointing_canvas",a);break}case"shape":{let{shape:b}=a;if(this.editor.isShapeOrAncestorLocked(b)){this.parent.transition("pointing_canvas",a);break}this.parent.transition("pointing_shape",a);break}case"handle":if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",a):this.parent.transition("pointing_handle",a);break;case"selection":switch(a.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":if(a.accelKey){this.parent.transition("brushing",a);break}this.parent.transition("pointing_rotate_handle",a);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":if(b)this.parent.transition("crop.pointing_crop_handle",a);else{if(a.accelKey){this.parent.transition("brushing",a);break}this.parent.transition("pointing_resize_handle",a)}break;default:{let b=this.editor.getHoveredShape();if(b&&!this.editor.getSelectedShapeIds().includes(b.id)&&!b.isLocked)return void this.onPointerDown({...a,shape:b,target:"shape"});this.parent.transition("pointing_selection",a)}}}}onDoubleClick(a){if(!this.editor.inputs.shiftKey&&"up"===a.phase&&!a.ctrlKey&&!a.shiftKey)switch(a.target){case"canvas":{let b=this.editor.getHoveredShape(),c=b&&!this.editor.isShapeOfType(b,"group")?b:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),d=this.editor.getFocusedGroupId();if(c){if(this.editor.isShapeOfType(c,"group"))return void ZT(this.editor,a);{let b=this.editor.getShape(c.parentId);if(b&&this.editor.isShapeOfType(b,"group")&&(!d||b.id!==d))return void ZT(this.editor,a)}this.onDoubleClick({...a,shape:c,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(a);break}case"selection":{if(this.editor.getIsReadonly())break;let b=this.editor.getOnlySelectedShape();if(b){let c=this.editor.getShapeUtil(b);if(!this.canInteractWithShapeInReadOnly(b))return;if("right"===a.handle||"left"===a.handle||"top"===a.handle||"bottom"===a.handle){let d=c.onDoubleClickEdge?.(b,a);if(d){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([d]),sH(this.editor,[b.id]);return}}if("top_left"===a.handle||"top_right"===a.handle||"bottom_right"===a.handle||"bottom_left"===a.handle){let d=c.onDoubleClickCorner?.(b,a);if(d){this.editor.markHistoryStoppingPoint("double click corner"),this.editor.updateShapes([d]),sH(this.editor,[b.id]);return}}if(c.canCrop(b)&&!this.editor.isShapeOrAncestorLocked(b))return void this.parent.transition("crop",a);this.shouldStartEditingShape(b)&&this.startEditingShape(b,a,!0)}break}case"shape":{let{shape:b}=a,c=this.editor.getShapeUtil(b);if("video"!==b.type&&"embed"!==b.type&&this.editor.getIsReadonly())break;if(c.onDoubleClick){let a=c.onDoubleClick?.(b);if(a)return void this.editor.updateShapes([a])}if(c.canCrop(b)&&!this.editor.isShapeOrAncestorLocked(b)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select(a.shape?.id),this.parent.transition("crop",a);return}this.shouldStartEditingShape(b)?this.startEditingShape(b,a,!0):this.handleDoubleClickOnCanvas(a);break}case"handle":{if(this.editor.getIsReadonly())break;let{shape:b,handle:c}=a,d=this.editor.getShapeUtil(b),e=d.onDoubleClickHandle?.(b,c);e?this.editor.updateShapes([e]):this.shouldStartEditingShape(b)&&this.startEditingShape(b,a,!0)}}}onRightClick(a){switch(a.target){case"canvas":{let b=this.editor.getHoveredShape(),c=b&&!this.editor.isShapeOfType(b,"group")?b:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(c)return void this.onRightClick({...a,shape:c,target:"shape"});let d=this.editor.getSelectedShapeIds(),e=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:f}}=this.editor;if((d.length>1||e&&!this.editor.getShapeUtil(e).hideSelectionBoundsBg(e))&&ZZ(this.editor,f))return void this.onRightClick({...a,target:"selection"});this.editor.selectNone();break}case"shape":{let{selectedShapeIds:b}=this.editor.getCurrentPageState(),{shape:c}=a,d=this.editor.getOutermostSelectableShape(c,a=>!b.includes(a.id));b.includes(d.id)||this.editor.findShapeAncestor(d,a=>b.includes(a.id))||(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([d.id]))}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(a){switch(this.selectedShapesOnKeyDown=this.editor.getSelectedShapes(),a.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(a.accelKey)return void(a.shiftKey?"ArrowDown"===a.code?this.editor.selectFirstChildShape():"ArrowUp"===a.code&&this.editor.selectParentShape():this.editor.selectAdjacentShape(a.code.replace("Arrow","").toLowerCase()));this.nudgeSelectedShapes(!1);return}if(j7.editOnType.get()&&!ZU.includes(a.key)&&!a.altKey&&!a.ctrlKey){let b=this.editor.getOnlySelectedShape();if(b&&this.editor.isShapeOfType(b,"note")&&this.shouldStartEditingShape(b))return void this.startEditingShape(b,{...a,target:"shape",shape:b},!0)}}onKeyRepeat(a){switch(a.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(a.accelKey)return void this.editor.selectAdjacentShape(a.code.replace("Arrow","").toLowerCase());this.nudgeSelectedShapes(!0);break;case"Tab":this.editor.getSelectedShapes().length&&!a.altKey&&this.editor.selectAdjacentShape(a.shiftKey?"prev":"next")}}onKeyUp(a){switch(a.key){case"Enter":{if(!this.selectedShapesOnKeyDown.length)return;let b=this.editor.getSelectedShapes();if(b.every(a=>this.editor.isShapeOfType(a,"group")))return void this.editor.setSelectedShapes(b.flatMap(a=>this.editor.getSortedChildIdsForParent(a.id)));let c=this.editor.getOnlySelectedShape();if(c&&this.shouldStartEditingShape(c))return void this.startEditingShape(c,{...a,target:"shape",shape:c},!0);ZS(this.editor)&&this.parent.transition("crop",a);break}case"Tab":this.editor.getSelectedShapes().length&&!a.altKey&&this.editor.selectAdjacentShape(a.shiftKey?"prev":"next")}}shouldStartEditingShape(a=this.editor.getOnlySelectedShape()){return!(!a||this.editor.isShapeOrAncestorLocked(a)&&"embed"!==a.type)&&!!this.canInteractWithShapeInReadOnly(a)&&this.editor.getShapeUtil(a).canEdit(a)}startEditingShape(a,b,c){this.editor.isShapeOrAncestorLocked(a)&&"embed"!==a.type||(this.editor.markHistoryStoppingPoint("editing shape"),Zm(this.editor,a,c),this.parent.transition("editing_shape",b))}isOverArrowLabelTest(a){return!!a&&Yb(this.editor,a)}handleDoubleClickOnCanvas(a){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");let b=hd(),{x:c,y:d}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:b,type:"text",x:c,y:d,props:{richText:g6(""),autoSize:!0}}]);let e=this.editor.getShape(b);if(!e)return;let f=this.editor.getShapeUtil(e);(!this.editor.getIsReadonly()||f.canEditInReadonly(e))&&(this.editor.setEditingShape(b),this.editor.select(b),this.parent.transition("editing_shape",a))}nudgeSelectedShapes(a=!1){let{editor:{inputs:{keys:b}}}=this,c=b.has("ShiftLeft"),d=new jA(0,0);if(b.has("ArrowLeft")&&(d.x-=1),b.has("ArrowRight")&&(d.x+=1),b.has("ArrowUp")&&(d.y-=1),b.has("ArrowDown")&&(d.y+=1),d.equals(new jA(0,0)))return;a||this.editor.markHistoryStoppingPoint("nudge shapes");let{gridSize:e}=this.editor.getDocumentSettings(),f=this.editor.getInstanceState().isGridMode?c?e*ZY:e:c?ZW:ZX,g=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(g,d.mul(f)),sH(this.editor,g)}canInteractWithShapeInReadOnly(a){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(a).canEditInReadonly(a))}}let ZW=10,ZX=1,ZY=5;function ZZ(a,b){let c=a.getSelectionRotatedPageBounds();if(!c)return!1;let d=a.getSelectionRotation();return d?jW(b,c.corners.map(a=>jA.RotWith(a,c.point,d))):c.containsPoint(b)}class Z$ extends ps{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;didCtrlOnEnter=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(a){let{shape:b}=a;"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.info=a,this.shapeId=b.id,this.didDrag=!1,this.didCtrlOnEnter=a.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===b.id,this.updateCursor();let c=this.editor.getShapeGeometry(b).children[1];if(!c)throw Error(`Expected to find an arrow label geometry for shape: ${b.id}`);let{currentPagePoint:d}=this.editor.inputs,e=this.editor.getPointInShapeSpace(b,d);if(this._labelDragOffset=jA.Sub(c.center,e),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),a.shiftKey||a.accelKey){let a=this.editor.getSelectedShapeIds();this.editor.setSelectedShapes([...a,this.shapeId]);return}this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}_labelDragOffset=new jA(0,0);onPointerMove(){let{isDragging:a}=this.editor.inputs;if(!a)return;if(this.didCtrlOnEnter)return void this.parent.transition("brushing",this.info);let b=this.editor.getShape(this.shapeId);if(!b)return;let c=this.editor.getShapeUtil("arrow").options,d=X3(this.editor,b),e=this.editor.getShapePageTransform(b.id),f=this.editor.getPointInShapeSpace(b,this.editor.inputs.currentPagePoint).add(this._labelDragOffset),g=Ya(this.editor,b),h=d.uninterpolateAlongEdge(f);isNaN(h)&&(h=g);let i=e.applyToPoint(d.interpolateAlongEdge(h)),j=e.applyToPoint(d.interpolateAlongEdge(g));jA.DistMin(i,j,c.labelCenterSnapDistance/this.editor.getZoomLevel())&&(h=g),this.didDrag=!0,this.editor.updateShape({id:b.id,type:b.type,props:{labelPosition:h}})}onPointerUp(){let a=this.editor.getShape(this.shapeId);a&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(a.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId);let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}}class Z_ extends ps{static id="pointing_canvas";onEnter(a){!(a.shiftKey||a.accelKey)&&this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(a){this.editor.inputs.isDragging&&this.parent.transition("brushing",a)}onPointerUp(a){ZT(this.editor,a),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}class Z0 extends ps{static id="pointing_handle";didCtrlOnEnter=!1;info={};onEnter(a){this.info=a,this.didCtrlOnEnter=a.accelKey;let{shape:b}=a;if(this.editor.isShapeOfType(b,"arrow")){let c=JO(this.editor,b),d=c[a.handle.id],e=c["start"===a.handle.id?"end":"start"],f=this.editor.getShapePageTransform(b.id);d&&Q7({editor:this.editor,pointInPageSpace:f.applyToPoint(a.handle),arrow:b,isPrecise:d.props.isPrecise,currentBinding:d,oppositeBinding:e})}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){let{shape:a,handle:b}=this.info;if(this.editor.isShapeOfType(a,"note")){let{editor:c}=this,d=Z1(c,a,b,!1);if(d)return void Zm(c,d,!0)}this.parent.transition("idle",this.info)}onPointerMove(a){let{editor:b}=this;b.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",a):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){let{editor:a}=this;if(a.getIsReadonly())return;let{shape:b,handle:c}=this.info;if(a.isShapeOfType(b,"note")){let d=Z1(a,b,c,!0);if(d){let c=a.getPointInParentSpace(d,a.inputs.originPagePoint).sub(jA.Rot(XF.clone().mul(b.props.scale),d.rotation));a.updateShape({...d,x:c.x,y:c.y}),a.setHoveredShape(d.id).select(d.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:a.getShape(d),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{Zm(a,d,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}function Z1(a,b,c,d){let e=a.getShapePageTransform(b.id),f=e.point(),g=e.rotation(),h=XG(a,f,g,b.props.growY*b.props.scale,0,b.props.scale)[c.index];if(h)return XI(a,b,h,g,d)}class Z2 extends ps{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:ZF[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a?.():this.parent.transition("idle")}cancel(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}}class Z3 extends ps{static id="pointing_selection";info={};onEnter(a){this.info=a}onPointerUp(a){ZT(this.editor,a),this.parent.transition("idle",a)}onPointerMove(a){this.editor.inputs.isDragging&&this.startTranslating(a)}onLongPress(a){this.startTranslating(a)}startTranslating(a){this.editor.getIsReadonly()||this.parent.transition("translating",a)}onDoubleClick(a){let b=this.editor.getHoveredShape(),c=b&&!this.editor.isShapeOfType(b,"group")?b:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(c){this.parent.transition("idle"),this.parent.onDoubleClick?.({...a,target:"shape",shape:this.editor.getShape(c)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class Z4 extends ps{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didCtrlOnEnter=!1;didSelectOnEnter=!1;onEnter(a){let b=this.editor.getSelectedShapeIds(),c=this.editor.getSelectionRotatedPageBounds(),d=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:e}}=this.editor,{shiftKey:f,altKey:g,accelKey:h}=a;this.hitShape=a.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=h;let i=this.editor.getOutermostSelectableShape(a.shape),j=this.editor.findShapeAncestor(i,a=>b.includes(a.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(a.shape).onClick||i.id===d||b.includes(i.id)||j||b.length>1&&c?.containsPoint(e)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=i;return}this.didSelectOnEnter=!0,f&&!g?(this.editor.cancelDoubleClick(),b.includes(i.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...b,i.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([i.id]))}onPointerUp(a){let b=this.editor.getSelectedShapeIds(),c=this.editor.getFocusedGroupId(),d=this.editor.getZoomLevel(),{inputs:{currentPagePoint:e}}=this.editor,f=a.shiftKey||a.accelKey,g=this.editor.getShapeAtPoint(e,{margin:this.editor.options.hitTestMargin/d,hitInside:!0,renderingOnly:!0})??this.hitShape,h=g?this.editor.getOutermostSelectableShape(g):this.hitShapeForPointerUp;if(h){let d=this.editor.getShapeUtil(h);if(d.onClick){let b=d.onClick?.(h);if(b){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([b]),this.parent.transition("idle",a);return}}if(h.id===c){b.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",a);return}}if(!this.didSelectOnEnter){let c=this.editor.getOutermostSelectableShape(g,a=>!b.includes(a.id));if(b.includes(c.id))if(f)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(h);else if(b.includes(h.id)){if(1===b.length){let b=ZQ(this.editor.getShapeUtil(h).getGeometry(h)),c=1===b.length?b[0]:void 0;if(c){let b=this.editor.getPointInShapeSpace(h,e);if(c.bounds.containsPoint(b,0)&&c.hitTestPoint(b))return void this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(h.id);let b=this.editor.getShapeUtil(h);(!this.editor.getIsReadonly()||b.canEditInReadonly(h))&&(this.editor.setEditingShape(h.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick?this.editor.emit("select-all-text",{shapeId:h.id}):this.editor.emit("place-caret",{shapeId:h.id,point:a.point}))})}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(h.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(h);else if(f){let a=this.editor.getShapeAncestors(c);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(b=>!a.find(a=>a.id===b)),c.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([c.id])}this.parent.transition("idle",a)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(a){if(this.editor.inputs.isDragging){if(Yb(this.editor,this.hitShape))return void this.parent.transition("pointing_arrow_label",{...a,shape:this.hitShape});this.didCtrlOnEnter?this.parent.transition("brushing",a):this.startTranslating(a)}}onLongPress(a){this.startTranslating(a)}startTranslating(a){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",a))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class Z5 extends ps{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter(a){let{isCreating:b=!1,creatingMarkId:c,creationCursorOffset:d={x:0,y:0}}=a;this.info=a,this.didHoldCommand=!1,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.creationCursorOffset=d;try{this.snapshot=this._createSnapshot()}catch(a){console.error(a),this.cancel();return}if(this.markId="",b)if(c)this.markId=c;else{let a=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);a&&(this.markId=a)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");b&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:a}){let{editor:b}=this;b.edgeScrollManager.updateEdgeScrolling(a)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){let{shapeSnapshots:a}=this.snapshot;a.forEach(({shape:a})=>{let b=this.editor.getShape(a.id);if(b){let c=this.editor.getShapeUtil(a);c.onResizeCancel?.(a,b)}}),this.editor.bailToMark(this.markId);let{onInteractionEnd:b}=this.info;b?"string"==typeof b?this.editor.setCurrentTool(b,{}):b():this.parent.transition("idle")}complete(){if(sH(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate)return void this.info.onCreate?.(this.editor.getOnlySelectedShape());let{onInteractionEnd:a}=this.info;if(a){if("string"!=typeof a)return void a();else if(this.editor.getInstanceState().isToolLocked)return void this.editor.setCurrentTool(a,{})}this.parent.transition("idle")}handleResizeStart(){let{shapeSnapshots:a}=this.snapshot,b=[];a.forEach(({shape:a})=>{let c=this.editor.getShapeUtil(a),d=c.onResizeStart?.(a);d&&b.push(d)}),b.length>0&&this.editor.updateShapes(b)}handleResizeEnd(){let{shapeSnapshots:a}=this.snapshot,b=[];a.forEach(({shape:a})=>{let c=this.editor.getShape(a.id),d=this.editor.getShapeUtil(a),e=d.onResizeEnd?.(a,c);e&&b.push(e)}),b.length>0&&this.editor.updateShapes(b)}updateShapes(){let{altKey:a,shiftKey:b}=this.editor.inputs,{frames:c,shapeSnapshots:d,selectionBounds:e,cursorHandleOffset:f,selectedShapeIds:g,selectionRotation:h,canShapesDeform:i}=this.snapshot,j=b||!i;if(1===d.size){let a=[...d.values()][0];this.editor.isShapeOfType(a.shape,"text")&&(j="left"!==this.info.handle&&"right"!==this.info.handle)}let k=kg(this.editor.inputs),l=this.editor.inputs.currentPagePoint.clone().sub(f).sub(this.creationCursorOffset),m=this.editor.inputs.originPagePoint.clone().sub(f);if(this.editor.getInstanceState().isGridMode&&!k){let{gridSize:a}=this.editor.getDocumentSettings();l.snapToGrid(a)}let n=this.info.handle,o=Z7(n,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!k:k)&&h%jF==0){let{nudge:b}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:jA.Sub(l,m),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:Z7(n,h),isAspectRatioLocked:j,isResizingFromCenter:a});l.add(b)}let p=jA.RotWith(a?e.center:e.getHandlePoint(o),e.point,h),q=jA.Sub(l,p).rot(-h),r=jA.Sub(m,p).rot(-h),s=jA.DivV(q,r);Number.isFinite(s.x)||(s.x=1),Number.isFinite(s.y)||(s.y=1);let t="top"===n||"bottom"===n,u="left"===n||"right"===n;for(let a of(j?u?s.y=Math.abs(s.x):t?s.x=Math.abs(s.y):Math.abs(s.x)>Math.abs(s.y)?s.y=Math.abs(s.x)*(s.y<0?-1:1):s.x=Math.abs(s.y)*(s.x<0?-1:1):(t&&(s.x=1),u&&(s.y=1)),this.info.isCreating||this.updateCursor({dragHandle:n,isFlippedX:s.x<0,isFlippedY:s.y<0,rotation:h}),d.keys())){let b=d.get(a);this.editor.resizeShape(a,s,{initialShape:b.shape,initialBounds:b.bounds,initialPageTransform:b.pageTransform,dragHandle:n,mode:1===g.length&&a===g[0]?"resize_bounds":"scale_shape",scaleOrigin:p,isAspectRatioLocked:j,scaleAxisRotation:h,skipStartAndEndCallbacks:!0})}if(k)for(let{id:a,children:b}of(this.didHoldCommand=!0,c)){if(!b.length)continue;let c=d.get(a).shape,e=this.editor.getShape(a);if(!(c&&e))continue;let f=new jA(e.x-c.x,e.y-c.y).rot(-c.rotation);if(0!==f.x||0!==f.y)for(let a of b)this.editor.updateShape({id:a.id,type:a.type,x:a.x-f.x,y:a.y-f.y})}else if(this.didHoldCommand){for(let{children:a}of(this.didHoldCommand=!1,c))if(a.length)for(let b of a)this.editor.updateShape({id:b.id,type:b.type,x:b.x,y:b.y})}}updateCursor({dragHandle:a,isFlippedX:b,isFlippedY:c,rotation:d}){let e={...this.editor.getInstanceState().cursor};switch(a){case"top_left":case"bottom_right":e.type="nwse-resize",b!==c&&(e.type="nesw-resize");break;case"top_right":case"bottom_left":e.type="nesw-resize",b!==c&&(e.type="nwse-resize")}e.rotation=d,this.editor.setCursor(e)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){let{editor:a}=this,b=a.getSelectedShapeIds(),c=a.getSelectionRotation(),{inputs:{originPagePoint:d}}=a,e=a.getSelectionRotatedPageBounds();if(!e)throw Error("Resizing but nothing is selected");let f=jA.RotWith(e.getHandlePoint(this.info.handle),e.point,c),g=jA.Sub(d,f),h=new Map,i=[],j=b=>{let c=a.getShape(b);if(!c)return!1;let d=a.getShapeUtil(c);if(d.canResize(c)){let b=a.getShapePageTransform(c);h.set(c.id,{shape:c,bounds:a.getShapeGeometry(c).bounds,pageTransform:b,pageRotation:li.Decompose(b).rotation,isAspectRatioLocked:d.isAspectRatioLocked(c)})}if(a.isShapeOfType(c,"frame")&&i.push({id:c.id,children:b5(a.getSortedChildIdsForParent(c).map(b=>a.getShape(b)))}),!d.canResizeChildren(c))return!1};b.forEach(b=>{!1!==j(b)&&a.visitDescendants(b,j)});let k=![...h.values()].some(a=>!jR(a.pageRotation,c)||a.isAspectRatioLocked);return{shapeSnapshots:h,selectionBounds:e,cursorHandleOffset:g,selectionRotation:c,selectedShapeIds:b,canShapesDeform:k,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:i}}}let Z6=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function Z7(a,b){let c=Math.round((b%=jG)/(jE/4)),d=Z6.indexOf(a);return Z6[(d+c)%Z6.length]}let Z8=Math.PI/180;class Z9 extends ps{static id="rotating";snapshot={};info={};markId="";onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");let b=nd({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!b)return this.parent.transition("idle",this.info);this.snapshot=b;let c=this._getRotationFromPointerPosition({snapToNearestDegree:!1});ne({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:ZF[this.info.handle],rotation:c+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){let a=this._getRotationFromPointerPosition({snapToNearestDegree:!1});ne({editor:this.editor,delta:a,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:ZF[this.info.handle],rotation:a+this.snapshot.initialShapesRotation})}cancel(){let{shapeSnapshots:a}=this.snapshot;a.forEach(({shape:a})=>{let b=this.editor.getShape(a.id);if(b){let c=this.editor.getShapeUtil(a);c.onRotateCancel?.(a,b)}}),this.editor.bailToMark(this.markId);let{onInteractionEnd:b}=this.info;b?"string"==typeof b?this.editor.setCurrentTool(b,this.info):b():this.parent.transition("idle",this.info)}complete(){ne({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),sH(this.editor,this.snapshot.shapeSnapshots.map(a=>a.shape.id));let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:a}){let{inputs:{shiftKey:b,currentPagePoint:c}}=this.editor,{initialCursorAngle:d,initialShapesRotation:e,initialPageCenter:f}=this.snapshot,g=e+(f.angle(c)-d);if(b)g=jQ(g,24);else if(a&&(g=Math.round(g/Z8)*Z8,this.editor.getInstanceState().isCoarsePointer)){let a=jQ(g,4);Math.abs(jP(g,a))<5*jE/180&&(g=a)}return g-e}}class $a extends ps{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();let a=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=a.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){let{x:a,y:b}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,a,b)}updateScribbleSelection(a){let b,c,d,e,{editor:f}=this,g=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:h,originPagePoint:i,previousPagePoint:j,currentPagePoint:k}}=this.editor,{newlySelectedShapeIds:l,initialSelectedShapeIds:m}=this;a&&this.pushPointToScribble();for(let a=0,h=g.length;a<h;a++){if(b=g[a],f.isShapeOfType(b,"group")||l.has(b.id)||f.isShapeOrAncestorLocked(b)||(c=f.getShapeGeometry(b),f.isShapeOfType(b,"frame")&&c.bounds.containsPoint(f.getPointInShapeSpace(b,i))))continue;let h=f.getShapePageTransform(b);if(!c||!h)continue;let m=h.clone().invert();d=m.applyToPoint(j),e=m.applyToPoint(k);let{bounds:n}=c;if(!(n.minX-0>Math.max(d.x,e.x)||n.minY-0>Math.max(d.y,e.y)||n.maxX+0<Math.min(d.x,e.x)||n.maxY+0<Math.min(d.y,e.y))&&c.hitTestLineSegment(d,e,0)){let a=this.editor.getOutermostSelectableShape(b),c=this.editor.getShapeMask(a.id);if(c&&null!==ll(j,k,c)&&!jW(k,c))continue;l.add(a.id)}}let n=f.getSelectedShapeIds(),o=new Set(h?[...l,...m]:[...l]);(n.length!==o.size||n.some(a=>!o.has(a)))&&this.editor.setSelectedShapes(Array.from(o))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}var $b=Object.create,$c=Object.defineProperty,$d=Object.getOwnPropertyDescriptor,$e=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),$f=a=>{throw TypeError(a)},$g=(a,b,c)=>b in a?$c(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,$h=(a,b)=>$c(a,"name",{value:b,configurable:!0}),$i=["class","method","getter","setter","accessor","field","value","get","set"],$j=a=>void 0!==a&&"function"!=typeof a?$f("Function expected"):a,$k=(a,b,c,d,e)=>({kind:$i[a],name:b,metadata:d,addInitializer:a=>c._?$f("Already initialized"):e.push($j(a||null))}),$l=(a,b)=>$g(b,$e("metadata"),a[3]),$m=(a,b,c)=>$g(a,"symbol"!=typeof b?b+"":b,c),$n=(a,b,c)=>b.has(a)||$f("Cannot "+c),$o=(a,b)=>Object(b)!==b?$f('Cannot use the "in" operator on this value'):a.has(b),$p=(a,b,c)=>($n(a,b,"read from private field"),c?c.call(a):b.get(a)),$q=(a,b,c,d)=>($n(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),$r=(a,b,c)=>($n(a,b,"access private method"),c);bO=[ck];class $s{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(bP,5,this),$m(this,"shapesToActuallyMove",[]),$m(this,"draggedOverShapeIds",new Set),$m(this,"initialGroupIds",new Map),$m(this,"initialParentIds",new Map),$m(this,"initialIndices",new Map),$m(this,"initialDraggingOverShape"),$m(this,"prevDraggingOverShape"),$m(this,"prevPagePoint",new jA),$m(this,"intervalTimerId",-1),a.disposables.add(this.dispose)}startDraggingShapes(a,b,c){let{editor:d}=this;if(-1!==this.intervalTimerId)return;let e=new Set(a),f=new Set;for(let a of e){let b=d.getShapeParent(a);b&&d.isShapeOfType(b,"group")&&!f.has(b)&&f.add(b)}for(let a of f){let b=b5(d.getSortedChildIdsForParent(a).map(a=>d.getShape(a)));for(let c of(e.add(a),b))e.delete(c)}for(let a of(this.initialParentIds.clear(),e)){let b=d.getShapeParent(a);b&&this.initialParentIds.set(a.id,b.id),this.initialIndices.set(a.id,a.index);let c=d.findShapeAncestor(a,a=>d.isShapeOfType(a,"group"));c&&this.initialGroupIds.set(a.id,c.id)}let g=d.getCurrentPageShapesSorted();this.shapesToActuallyMove=Array.from(e).filter(a=>!a.isLocked).sort((a,b)=>g.indexOf(a)-g.indexOf(b)),this.initialDraggingOverShape=d.getDraggingOverShape(b,this.shapesToActuallyMove),this.prevDraggingOverShape=this.initialDraggingOverShape,this.updateDraggingShapes(b,c);let h=0;this.intervalTimerId=this.editor.timers.setInterval(()=>{++h%3&&this.editor.inputs.pointerVelocity.len()>.5||this.updateDraggingShapes(d.inputs.currentPagePoint,c)},a.length>10?320:60)}dropShapes(a){let{editor:b}=this;this.updateDraggingShapes(b.inputs.currentPagePoint);let c=b.getDraggingOverShape(b.inputs.currentPagePoint,a);if(c){let d=b.getShapeUtil(c);d.onDropShapesOver?.(c,a,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}this.dispose()}clear(){clearInterval(this.intervalTimerId),this.intervalTimerId=-1,this.initialParentIds.clear(),this.initialIndices.clear(),this.shapesToActuallyMove=[],this.initialDraggingOverShape=void 0,this.prevDraggingOverShape=void 0,this.editor.setHintingShapes([])}dispose(){this.clear()}updateDraggingShapes(a,b){let{editor:c}=this,d=b5(this.shapesToActuallyMove.map(a=>c.getShape(a)));if(!d.length)return;let e=c.getDraggingOverShape(a,this.shapesToActuallyMove),f=!this.prevPagePoint.equals(c.inputs.currentPagePoint);this.prevPagePoint.setTo(c.inputs.currentPagePoint),c.run(()=>{if(this.prevDraggingOverShape?.id===e?.id){if(f&&e&&hc(e.id)&&!c.inputs.previousPagePoint.equals(c.inputs.currentPagePoint)){let a=c.getShapeUtil(e);a.onDragShapesOver?.(e,d,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}return}if(this.prevDraggingOverShape){let a=c.getShapeUtil(this.prevDraggingOverShape);a.onDragShapesOut?.(this.editor.getShape(this.prevDraggingOverShape),d,{nextDraggingOverShapeId:e?.id??null,initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}if(e){let a=c.getShapeUtil(e);a.onDragShapesIn?.(e,d,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,prevDraggingOverShapeId:this.prevDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),c.setHintingShapes([e.id])}else this.prevDraggingOverShape&&c.setHintingShapes([]);b?.()}),this.prevDraggingOverShape=e}}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=$i[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&$d(l<4?e:{get[c](){return $p(this,f)},set[c](x){return $q(this,f,x)}},c));l?n&&l<4&&$h(f,(l>2?"set ":l>1?"get ":"")+c):$h(e,c);for(var t=d.length-1;t>=0;t--)j=$k(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>$o(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?$p:$r)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>$q(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?$j(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?$f("Object expected"):($j(g=h.get)&&(s.get=g),$j(g=h.set)&&(s.set=g),$j(g=h.init)&&q.unshift(g));return l||$l(a,e),s&&$c(e,c,s),n})(bP=[,,,$b((void 0)??null)],1,"dispose",bO,$s),$l(bP,$s);var $t=Object.create,$u=Object.defineProperty,$v=Object.getOwnPropertyDescriptor,$w=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),$x=a=>{throw TypeError(a)},$y=(a,b,c)=>b in a?$u(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,$z=(a,b)=>$u(a,"name",{value:b,configurable:!0}),$A=["class","method","getter","setter","accessor","field","value","get","set"],$B=a=>void 0!==a&&"function"!=typeof a?$x("Function expected"):a,$C=(a,b,c,d,e)=>({kind:$A[a],name:b,metadata:d,addInitializer:a=>c._?$x("Already initialized"):e.push($B(a||null))}),$D=(a,b)=>$y(b,$w("metadata"),a[3]),$E=(a,b,c)=>$y(a,"symbol"!=typeof b?b+"":b,c),$F=(a,b,c)=>b.has(a)||$x("Cannot "+c),$G=(a,b)=>Object(b)!==b?$x('Cannot use the "in" operator on this value'):a.has(b),$H=(a,b,c)=>($F(a,b,"read from private field"),c?c.call(a):b.get(a)),$I=(a,b,c,d)=>($F(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),$J=(a,b,c)=>($F(a,b,"access private method"),c);class $K extends(bR=ps,bQ=[ck],bR){constructor(){super(...arguments),((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(bS,5,this),$E(this,"info",{}),$E(this,"selectionSnapshot",{}),$E(this,"snapshot",{}),$E(this,"markId",""),$E(this,"isCloning",!1),$E(this,"isCreating",!1),$E(this,"dragAndDropManager",new $s(this.editor))}onCreate(a){}onEnter(a){let{isCreating:b=!1,creatingMarkId:c,onCreate:d=()=>void 0}=a;if(!this.editor.getSelectedShapeIds()?.length)return void this.parent.transition("idle");if(this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.isCreating=b,this.markId="",b)if(c)this.markId=c;else{let a=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);a&&(this.markId=a)}else this.markId=this.editor.markHistoryStoppingPoint("translating");this.onCreate=d,this.isCloning=!1,this.info=a,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=$L(this.editor),!this.isCreating&&this.editor.inputs.altKey&&(this.startCloning(),this.isCloning)||(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes())}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:a}){let{editor:b}=this;b.edgeScrollManager.updateEdgeScrolling(a)}onPointerMove(){this.updateShapes()}onKeyDown(){this.editor.inputs.altKey&&!this.isCloning&&(this.startCloning(),this.isCloning)||this.updateShapes()}onKeyUp(){!this.editor.inputs.altKey&&this.isCloning?this.stopCloning():this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){if(this.isCreating)return;let a=Array.from(this.editor.getSelectedShapeIds());this.editor.canCreateShapes(a)&&(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=$L(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),sH(this.editor,this.snapshot.movingShapes.map(a=>a.id));let{onInteractionEnd:a}=this.info;if(a){if("string"!=typeof a)return void a();else if(this.editor.getInstanceState().isToolLocked)return void this.editor.setCurrentTool(a)}this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){let{movingShapes:a}=this.snapshot;a.forEach(a=>{let b=this.editor.getShape(a.id);if(b){let c=this.editor.getShapeUtil(a);c.onTranslateCancel?.(a,b)}}),this.reset();let{onInteractionEnd:b}=this.info;b?"string"==typeof b?this.editor.setCurrentTool(b):b():this.parent.transition("idle",this.info)}handleStart(){let{movingShapes:a}=this.snapshot,b=[];a.forEach(a=>{let c=this.editor.getShapeUtil(a),d=c.onTranslateStart?.(a);d&&b.push(d)}),b.length>0&&this.editor.updateShapes(b),this.dragAndDropManager.startDraggingShapes(b5(this.snapshot.movingShapes.map(a=>this.editor.getShape(a.id))),this.editor.inputs.originPagePoint,this.updateParentTransforms),this.editor.setHoveredShape(null)}handleEnd(){let{movingShapes:a}=this.snapshot;if(this.isCloning&&a.length>0){let b=jA.Average(a.map(a=>this.editor.getShapePageTransform(a.id).point())),c=jA.Sub(b,this.selectionSnapshot.averagePagePoint);jA.IsNaN(c)||this.editor.updateInstanceState({duplicateProps:{shapeIds:a.map(a=>a.id),offset:{x:c.x,y:c.y}}})}let b=[];a.forEach(a=>{let c=this.editor.getShape(a.id),d=this.editor.getShapeUtil(a),e=d.onTranslateEnd?.(a,c);e&&b.push(e)}),b.length>0&&this.editor.updateShapes(b)}updateShapes(){let{snapshot:a}=this;this.dragAndDropManager.startDraggingShapes(a.movingShapes,this.editor.inputs.originPagePoint,this.updateParentTransforms),function({editor:a,snapshot:b}){let{inputs:c}=a,{noteSnapshot:d,noteAdjacentPositions:e,initialPageBounds:f,initialSnapPoints:g,shapeSnapshots:h,averagePagePoint:i}=b,j=a.getInstanceState().isGridMode,k=a.getDocumentSettings().gridSize,l=jA.Sub(c.currentPagePoint,c.originPagePoint),m=a.inputs.shiftKey?Math.abs(l.x)<Math.abs(l.y)?"x":"y":null;"x"===m?l.x=0:"y"===m&&(l.y=0),a.snaps.clearIndicators();let n=a.user.getIsSnapMode()?!c.ctrlKey:c.ctrlKey,o=!1;if(n&&.5>a.inputs.pointerVelocity.len()){let{nudge:b}=a.snaps.shapeBounds.snapTranslateShapes({dragDelta:l,initialSelectionPageBounds:f,lockedAxis:m,initialSelectionSnapPoints:g});l.add(b)}else if(d&&e){let{scale:b}=d.shape.props,c=d.pagePoint.clone().add(l).add(XF.clone().mul(b).rot(d.pageRotation)),f=10/a.getZoomLevel(),g=new jA(0,0);for(let a of e){let b=jA.Sub(c,a),d=b.len();d<f&&(o=!0,f=d,g=b)}l.sub(g)}let p=jA.Add(i,l),q=a.snaps.getIndicators();!j||c.ctrlKey||o||0!==q.length||p.snapToGrid(k);let r=jA.Sub(p,i);a.updateShapes(b5(h.map(({shape:a,pagePoint:b,parentTransform:c})=>{let d=jA.Add(b,r),e=c?li.applyToPoint(c,d):d;return{id:a.id,type:a.type,x:e.x,y:e.y}})))}({editor:this.editor,snapshot:a});let{movingShapes:b}=a,c=[];b.forEach(a=>{let b=this.editor.getShape(a.id),d=this.editor.getShapeUtil(a),e=d.onTranslate?.(a,b);e&&c.push(e)}),c.length>0&&this.editor.updateShapes(c)}updateParentTransforms(){let{editor:a,snapshot:{shapeSnapshots:b}}=this,c=[];b.forEach(b=>{let d=a.getShape(b.shape.id);if(!d)return null;c.push(d),b.parentTransform=hV(d.parentId)?null:li.Inverse(a.getShapePageTransform(d.parentId))})}}function $L(a){let b,c,d=[],e=[],f=b5(a.getSelectedShapeIds().map(b=>{let c=a.getShape(b);if(!c)return null;d.push(c);let f=a.getShapePageTransform(b),g=f.point(),h=f.rotation();e.push(g);let i=hU.isId(c.parentId)?null:li.Inverse(a.getShapePageTransform(c.parentId));return{shape:c,pagePoint:g,pageRotation:h,parentTransform:i}})),g=a.getOnlySelectedShape(),h=[];if(g)h=a.snaps.shapeBounds.getSnapPoints(g.id);else{let b=a.getSelectionPageBounds();b&&(h=b.cornersAndCenter.map((a,b)=>({id:"selection:"+b,x:a.x,y:a.y})))}let{originPagePoint:i}=a.inputs,j=f.filter(b=>a.isShapeOfType(b.shape,"note")&&a.isPointInShape(b.shape,i));if(0===j.length);else if(1===j.length)c=j[0];else{let b=a.getCurrentPageShapesSorted();c=j.map(a=>({snapshot:a,index:b.findIndex(b=>b.id===a.shape.id)})).sort((a,b)=>b.index-a.index)[0]?.snapshot}return c&&(b=XH(a,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:jA.Average(e),movingShapes:d,shapeSnapshots:f,initialPageBounds:a.getSelectionPageBounds(),initialSnapPoints:h,noteAdjacentPositions:b,noteSnapshot:c}}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=$A[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&$v(l<4?e:{get[c](){return $H(this,f)},set[c](x){return $I(this,f,x)}},c));l?n&&l<4&&$z(f,(l>2?"set ":l>1?"get ":"")+c):$z(e,c);for(var t=d.length-1;t>=0;t--)j=$C(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>$G(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?$H:$J)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>$I(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?$B(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?$x("Object expected"):($B(g=h.get)&&(s.get=g),$B(g=h.set)&&(s.set=g),$B(g=h.init)&&q.unshift(g));return l||$D(a,e),s&&$u(e,c,s),n})(bS=[,,,$t(bR?.[$w("metadata")]??null)],1,"updateParentTransforms",bQ,$K),$D(bS,$K),$E($K,"id","translating");class $M extends ps{static id="idle";info={};onEnter(a){this.info=a}onPointerDown(){this.parent.transition("pointing",this.info)}}class $N extends ps{static id="pointing";info={};onEnter(a){this.info=a}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){let{currentScreenPoint:a}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(a,{animation:{duration:220}}):this.editor.zoomIn(a,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class $O extends ps{static id="zoom_brushing";info={};zoomBrush=new lh;onEnter(a){this.info=a,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){let{inputs:{originPagePoint:a,currentPagePoint:b}}=this.editor;this.zoomBrush.setTo(lh.FromPoints([a,b])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){let{zoomBrush:a}=this,b=8/this.editor.getZoomLevel();if(a.width<b&&a.height<b){let a=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(a,{animation:{duration:220}}):this.editor.zoomIn(a,{animation:{duration:220}})}else{let b=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(a,{targetZoom:b,animation:{duration:220}})}this.parent.transition("idle",this.info)}}let $P=[class extends ps{static id="eraser";static initial="idle";static isLockable=!1;static children(){return[Zx,Zy,Zw]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}},class extends ps{static id="hand";static initial="idle";static isLockable=!1;static children(){return[ZA,ZB,Zz]}onDoubleClick(a){if("settle"===a.phase){let{currentScreenPoint:a}=this.editor.inputs;this.editor.zoomIn(a,{animation:{duration:220,easing:jy}})}}onTripleClick(a){if("settle"===a.phase){let{currentScreenPoint:a}=this.editor.inputs;this.editor.zoomOut(a,{animation:{duration:320,easing:jy}})}}onQuadrupleClick(a){if("settle"===a.phase){let a=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:b}}=this.editor;1===a?this.editor.zoomToFit({animation:{duration:400,easing:jy}}):this.editor.resetZoom(b,{animation:{duration:320,easing:jy}})}}},class extends ps{static id="laser";static initial="idle";static children(){return[ZC,ZD]}static isLockable=!1;onEnter(){this.editor.setCursor({type:"cross",rotation:0})}},class extends ps{static id="zoom";static initial="idle";static children(){return[$M,$O,$N]}static isLockable=!1;info={};onEnter(a){this.info=a,this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(a){this.updateCursor(),"KeyZ"===a.code&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}},class extends ps{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children(){return[ZO,ZH,ZV,Z_,Z4,$K,ZE,$a,ZM,Z3,ZG,ZR,Z5,Z9,Z2,Z$,Z0,ZP]}cleanUpDuplicateProps(){let a=this.editor.getSelectedShapeIds(),b=this.editor.getInstanceState();if(!b.duplicateProps)return;let c=new Set(b.duplicateProps.shapeIds);a.length===c.size&&a.every(a=>c.has(a))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=eg("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(a){console.error(a)}})}onExit(){this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}],$Q={fonts:{tldraw_mono:`${m9()}/fonts/IBMPlexMono-Medium.woff2`,tldraw_mono_italic:`${m9()}/fonts/IBMPlexMono-MediumItalic.woff2`,tldraw_mono_bold:`${m9()}/fonts/IBMPlexMono-Bold.woff2`,tldraw_mono_italic_bold:`${m9()}/fonts/IBMPlexMono-BoldItalic.woff2`,tldraw_serif:`${m9()}/fonts/IBMPlexSerif-Medium.woff2`,tldraw_serif_italic:`${m9()}/fonts/IBMPlexSerif-MediumItalic.woff2`,tldraw_serif_bold:`${m9()}/fonts/IBMPlexSerif-Bold.woff2`,tldraw_serif_italic_bold:`${m9()}/fonts/IBMPlexSerif-BoldItalic.woff2`,tldraw_sans:`${m9()}/fonts/IBMPlexSans-Medium.woff2`,tldraw_sans_italic:`${m9()}/fonts/IBMPlexSans-MediumItalic.woff2`,tldraw_sans_bold:`${m9()}/fonts/IBMPlexSans-Bold.woff2`,tldraw_sans_italic_bold:`${m9()}/fonts/IBMPlexSans-BoldItalic.woff2`,tldraw_draw:`${m9()}/fonts/Shantell_Sans-Informal_Regular.woff2`,tldraw_draw_italic:`${m9()}/fonts/Shantell_Sans-Informal_Regular_Italic.woff2`,tldraw_draw_bold:`${m9()}/fonts/Shantell_Sans-Informal_Bold.woff2`,tldraw_draw_italic_bold:`${m9()}/fonts/Shantell_Sans-Informal_Bold_Italic.woff2`}},$R={...$Q,icons:Object.fromEntries(["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","alt","arrow-arc","arrow-cycle","arrow-elbow","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bold","bookmark","bring-forward","bring-to-front","broken","bulletList","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","color","comment","corners","crop","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","download","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","heading","help-circle","highlight","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","italic","leading","link","list","lock","manual","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","strike","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","underline","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"].map(a=>[a,`${m9()}/icons/icon/0_merged.svg#${a}`])),translations:Object.fromEntries(jo.map(a=>[a.locale,`${m9()}/translations/${a.locale}.json`])),embedIcons:Object.fromEntries(B4.map(a=>[a.type,`${m9()}/embed-icons/${a.type}.png`]))};function $S(a){return(0,eQ.useMemo)(()=>a?{fonts:Object.assign({...$R.fonts},{...a?.fonts}),icons:Object.assign({...$R.icons},{...a?.icons}),embedIcons:Object.assign({...$R.embedIcons},{...a?.embedIcons}),translations:Object.assign({...$R.translations},{...a?.translations})}:$R,[a])}let $T=eV(function({overrides:a,components:b,assetUrls:c,onUiEvent:d,forceMobile:e,mediaMimeTypes:f,children:g}){let h=kq();return(0,bT.jsx)(Iv.Provider,{value:f,children:(0,bT.jsx)(Ho,{children:(0,bT.jsx)(zI,{assetUrls:$S(c),children:(0,bT.jsx)(zP,{overrides:Iy(a),locale:h?.user.getLocale()??kT.locale,children:(0,bT.jsx)(F_,{onEvent:d,children:(0,bT.jsx)(H9,{children:(0,bT.jsx)(HB,{context:"tla",children:(0,bT.jsx)(zF,{children:(0,bT.jsx)(Cd,{forceMobile:e,children:(0,bT.jsx)(P9,{overrides:b,children:(0,bT.jsx)($U,{overrides:a,children:g})})})})})})})})})})})});function $U({overrides:a,children:b}){let c,d,e=(c=Iw(),d=Ix(null==a?[]:Array.isArray(a)?a:[a]),(0,eQ.useMemo)(()=>(function(a,b){let c={};for(let b of a)if(b.translations)for(let[a,d]of cY(b.translations)){let b=c[a];b||(b=c[a]={}),Object.assign(b,d)}return{actions:(b,c,d)=>{for(let e of a)e.actions&&(c=e.actions(b,c,d));return c},tools:(c,d,e)=>{for(let f of a)f.tools&&(d=f.tools(c,d,{...b,...e}));return d},translations:c}})(d,c),[d,c]));return(0,bT.jsx)(Qe,{overrides:e.actions,children:(0,bT.jsx)(IA,{overrides:e.tools,children:b})})}let $V=eQ.default.memo(function({renderDebugMenuItems:a,children:b,hideUi:c,components:d,...e}){return(0,bT.jsx)($T,{...e,components:d,children:(0,bT.jsx)($W,{hideUi:c,renderDebugMenuItems:a,children:b})})}),$W=eQ.default.memo(function({children:a,hideUi:b,...c}){return(0,bT.jsxs)(bT.Fragment,{children:[a,b?null:(0,bT.jsx)($X,{...c})]})}),$X=eQ.default.memo(function(){let a,b,c,d,e,f,g,h,i,j=kp(),k=zQ(),l=Ce(),m=Ft(),n=e$("focus",()=>j.getInstanceState().isFocusMode,[j]),o=e$("debug",()=>j.getInstanceState().isDebugMode,[j]),{SharePanel:p,TopPanel:q,MenuPanel:r,StylePanel:s,Toolbar:t,HelpMenu:u,NavigationPanel:v,HelperButtons:w,DebugPanel:y,Toasts:z,Dialogs:A,A11y:B}=Qa();a=kp(),b=Ft(),c=Qf(),d=IB(),e=e$("is focused",()=>a.getInstanceState().isFocused,[a]),(0,eQ.useEffect)(()=>{var f;if(!e)return;let g=[],h=a.getContainer(),i=(a,b)=>{PO(a,{element:h.ownerDocument.body},b),g.push(()=>{PO.unbind(a,b)})};for(let d of Object.values(c))d.kbd&&(!b||d.readonlyOk)&&(PR.includes(d.id)||i(PT(d.kbd),b=>{(!PS(a)||d.isRequiredA11yAction)&&(kb(b),d.onSelect("kbd"))}));for(let b of Object.values(d))!(!b.kbd||!b.readonlyOk&&a.getIsReadonly())&&(PR.includes(b.id)||i(PT(b.kbd),c=>{PS(a)||(kb(c),b.onSelect("kbd"))}));return i(",",b=>{if(PS(a)||a.inputs.keys.has("Comma"))return;kb(b),a.focus(),a.inputs.keys.add("Comma");let{x:c,y:d,z:e}=a.inputs.currentPagePoint,f=a.pageToScreen({x:c,y:d}),g={type:"pointer",name:"pointer_down",point:{x:f.x,y:f.y,z:e},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:kg(b),pointerId:0,button:0,isPen:a.getInstanceState().isPenMode,target:"canvas"};a.dispatch(g)}),f=b=>{if(PS(a)||!a.inputs.keys.has("Comma"))return;a.inputs.keys.delete("Comma");let{x:c,y:d,z:e}=a.inputs.currentScreenPoint,f={type:"pointer",name:"pointer_up",point:{x:c,y:d,z:e},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:kg(b),pointerId:0,button:0,isPen:a.getInstanceState().isPenMode,target:"canvas"};a.dispatch(f)},PO(",",{element:h.ownerDocument.body,keyup:!0,keydown:!1},f),g.push(()=>{PO.unbind(",",f)}),()=>{g.forEach(a=>a())}},[c,d,b,a,e]),g=(f=kp()).getContainer().ownerDocument,h=F0(),i=e$("editor.isFocused",()=>f.getInstanceState().isFocused,[f]),(0,eQ.useEffect)(()=>{if(!i)return;let a=async a=>{0===f.getSelectedShapeIds().length||null!==f.getEditingShapeId()||Il(f)||(kb(a),await Iq(f),h("copy",{source:"kbd"}))};async function b(a){0===f.getSelectedShapeIds().length||null!==f.getEditingShapeId()||Il(f)||(kb(a),await Iq(f),f.deleteShapes(f.getSelectedShapeIds()),h("cut",{source:"kbd"}))}let c=!1,d=a=>{1===a.button&&(c=!0,f.timers.requestAnimationFrame(()=>{c=!1}))},e=a=>{let b;if(c)return void f.markEventAsHandled(a);if(null!==f.getEditingShapeId()||Il(f))return;let d=!1;f.inputs.shiftKey&&(d=!0),f.user.getIsPasteAtCursorMode()&&(d=!d),d&&(b=f.inputs.currentPagePoint);let e=()=>{a.clipboardData&&In(f,a.clipboardData,b)};if(navigator.clipboard?.read){let c=Array.from(a.clipboardData?.files||[]);navigator.clipboard.read().then(a=>{Array.isArray(a)&&a[0]instanceof ClipboardItem&&Io({editor:f,clipboardItems:a,point:b,fallbackFiles:c})},()=>{e()})}else e();kb(a),h("paste",{source:"kbd"})};return g?.addEventListener("copy",a),g?.addEventListener("cut",b),g?.addEventListener("paste",e),g?.addEventListener("pointerup",d),()=>{g?.removeEventListener("copy",a),g?.removeEventListener("cut",b),g?.removeEventListener("paste",e),g?.removeEventListener("pointerup",d)}},[f,h,i,g]),function(){let a=kp(),{addToast:b}=Ia();(0,eQ.useEffect)(()=>{function c({name:a,count:c}){b({title:"Maximum shapes reached",description:`You've reached the maximum number of shapes allowed on ${a} (${c}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return a.addListener("max-shapes",c),()=>{a.removeListener("max-shapes",c)}},[a,b])}();let C=(0,eQ.useRef)(!1),D=(0,eQ.useRef)(-1),[E,F]=(0,eQ.useState)(!1);eZ("update hide toolbar while delayed",()=>{0},[]);let{"toggle-focus-mode":G}=Qf(),{breakpointsAbove:H,breakpointsBelow:I}=(0,eQ.useMemo)(()=>{let a=[],b=[];for(let c=0;c<Ca.length;c++)c<=l?a.push(c):b.push(c);return{breakpointsAbove:a,breakpointsBelow:b}},[l]);return(0,bT.jsxs)("div",{className:(0,j1.default)("tlui-layout",{"tlui-layout__mobile":l<Cb.TABLET_SM}),"data-iseditinganything":E,"data-breakpoint":l,"data-breakpoints-above":H.join(" "),"data-breakpoints-below":I.join(" "),children:[(0,bT.jsx)(zT,{}),n?(0,bT.jsx)("div",{className:"tlui-layout__top",children:(0,bT.jsx)(zS,{type:"icon",className:"tlui-focus-button",title:k("focus-mode.toggle-focus-mode"),onClick:()=>G.onSelect("menu"),children:(0,bT.jsx)(BV,{icon:"dot"})})}):(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsxs)("div",{className:"tlui-layout__top",children:[(0,bT.jsxs)("div",{className:"tlui-layout__top__left",children:[r&&(0,bT.jsx)(r,{}),w&&(0,bT.jsx)(w,{})]}),(0,bT.jsx)("div",{className:"tlui-layout__top__center",children:q&&(0,bT.jsx)(q,{})}),(0,bT.jsxs)("div",{className:"tlui-layout__top__right",children:[p&&(0,bT.jsx)(p,{}),s&&l>=Cb.TABLET_SM&&!m&&(0,bT.jsx)(s,{})]})]}),(0,bT.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,bT.jsxs)("div",{className:"tlui-layout__bottom__main",children:[v&&(0,bT.jsx)(v,{}),t&&(0,bT.jsx)(t,{}),u&&(0,bT.jsx)(u,{})]}),o&&y&&(0,bT.jsx)(y,{}),B&&(0,bT.jsx)(B,{})]})]}),z&&(0,bT.jsx)(z,{}),A&&(0,bT.jsx)(A,{})]})});function $Y(){let{RichTextToolbar:a,ImageToolbar:b,VideoToolbar:c,CursorChatBubble:d,FollowingIndicator:e}=Qa();return(0,bT.jsxs)(bT.Fragment,{children:[a&&(0,bT.jsx)(a,{}),b&&(0,bT.jsx)(b,{}),c&&(0,bT.jsx)(c,{}),e&&(0,bT.jsx)(e,{}),d&&(0,bT.jsx)(d,{})]})}let $Z=()=>{let{Spinner:a}=re();return(0,bT.jsx)(qW,{children:a?(0,bT.jsx)(a,{}):null})},$$=[...$P,...XN];function $_(a){var b;let{children:c,maxImageDimension:d,maxAssetSize:e,acceptedImageMimeTypes:f,acceptedVideoMimeTypes:g,onMount:h,components:i={},shapeUtils:j=[],bindingUtils:k=[],tools:l=[],embeds:m,textOptions:n,...o}=a,p=kK(i,kM),q=i?.InFrontOfTheCanvas,r=(0,eQ.useMemo)(()=>o.hideUi?q??null:q?()=>(0,bT.jsxs)(bT.Fragment,{children:[(0,bT.jsx)($Y,{}),(0,bT.jsx)(q,{})]}):$Y,[o.hideUi,q]),s=(0,eQ.useMemo)(()=>({Scribble:Rj,ShapeIndicators:Rp,CollaboratorScribble:Rj,SelectionForeground:Rk,Handles:Q3,Overlays:Ra,Spinner:Fz,LoadingScreen:$Z,...p,InFrontOfTheCanvas:r}),[p,r]),t=kK(j,kL),u=(0,eQ.useMemo)(()=>cb("type",t,Zv),[t]),v=kK(k,kL),w=(0,eQ.useMemo)(()=>cb("type",v,Rq),[v]),y=kK(l,kL),z=(0,eQ.useMemo)(()=>cb("id",y,$$),[y]),A=kK(f??cL,kL),B=kK(g??cM,kL),C=(0,eQ.useMemo)(()=>({addFontsFromNode:Xe,...n,tipTapConfig:{extensions:W7,...n?.tipTapConfig}}),[n]),D=(0,eQ.useMemo)(()=>[...A,...B],[A,B]),E=(b=o.assetUrls,(0,eQ.useMemo)(()=>b?{fonts:{...$Q.fonts,...b?.fonts}}:$Q,[b]));return u.find(a=>"embed"===a.type)&&m&&YK.setEmbedDefinitions(m),(0,bT.jsx)(zI,{assetUrls:$S(o.assetUrls),children:(0,bT.jsx)(zP,{overrides:Iy(o.overrides),locale:o.user?.userPreferences.get().locale??kT.locale,children:(0,bT.jsx)(qP,{initialState:"select",...o,components:s,shapeUtils:u,bindingUtils:w,tools:z,textOptions:C,assetUrls:E,children:(0,bT.jsxs)($V,{...o,components:s,mediaMimeTypes:D,children:[(0,bT.jsx)($0,{maxImageDimension:d,maxAssetSize:e,acceptedImageMimeTypes:A,acceptedVideoMimeTypes:B,onMount:h}),c]})})})})}function $0({maxImageDimension:a,maxAssetSize:b,acceptedImageMimeTypes:c,acceptedVideoMimeTypes:d,onMount:e}){let f=kp(),g=Ia(),h=zQ(),i=F0();qX(()=>{var j;let k=[];return k.push(f.sideEffects.register({instance_page_state:{afterChange:(a,b)=>{if(a.croppingShapeId!==b.croppingShapeId){let c=f.isIn("select.crop");!a.croppingShapeId&&b.croppingShapeId?c||f.setCurrentTool("select.crop.idle"):a.croppingShapeId&&!b.croppingShapeId&&c&&f.setCurrentTool("select.idle")}if(a.editingShapeId!==b.editingShapeId)if(!a.editingShapeId&&b.editingShapeId){if(!f.isIn("select.editing_shape")){let a=f.getEditingShape();a&&"text"===a.type&&f.isInAny("text.pointing","select.resizing")&&f.getInstanceState().isToolLocked?f.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):f.setCurrentTool("select.editing_shape")}}else a.editingShapeId&&!b.editingShapeId&&f.isIn("select.editing_shape")&&f.setCurrentTool("select.idle")}}})),f.fonts.requestFonts(W4),f.once("edit",()=>i("edit",{source:"unknown"})),j={maxImageDimension:a,maxAssetSize:b,acceptedImageMimeTypes:c,acceptedVideoMimeTypes:d,toasts:g,msg:h},f.registerExternalAssetHandler("file",async a=>Xj(f,a,j)),f.registerExternalAssetHandler("url",async a=>Xl(f,a,j)),f.registerExternalContentHandler("svg-text",async a=>Xm(f,a)),f.registerExternalContentHandler("embed",a=>(function(a,{point:b,url:c,embed:d}){let e=b??(a.inputs.shiftKey?a.inputs.currentPagePoint:a.getViewportPageBounds().center),{width:f,height:g}=d,h=hd(),i=sy(new jA(e.x-(f||450)/2,e.y-(g||450)/2),a),j={id:h,type:"embed",x:i.x,y:i.y,props:{w:f,h:g,url:c}};a.canCreateShape(j)&&a.createShape(j).select(h)})(f,a)),f.registerExternalContentHandler("files",async a=>Xn(f,a,j)),f.registerExternalContentHandler("file-replace",async a=>Xk(f,a,j)),f.registerExternalContentHandler("text",async a=>Xo(f,a)),f.registerExternalContentHandler("url",async a=>Xp(f,a,j)),f.registerExternalContentHandler("tldraw",async a=>Xq(f,a)),f.registerExternalContentHandler("excalidraw",async a=>Xr(f,a)),k.push(f.store.props.onMount(f)),k.push(e?.(f)),()=>{k.forEach(a=>a?.())}});let{Canvas:j}=re(),{ContextMenu:k}=Qa();return k?(0,bT.jsx)(k,{}):j?(0,bT.jsx)(j,{}):null}var $1=((B=$1||{}).Sticky="sticky",B.Ellipse="ellipse",B.Rectangle="rectangle",B.Triangle="triangle",B.Draw="draw",B.Arrow="arrow",B.Text="text",B.Group="group",B.Image="image",B.Video="video",B),$2=((C=$2||{}).White="white",C.LightGray="lightGray",C.Gray="gray",C.Black="black",C.Green="green",C.Cyan="cyan",C.Blue="blue",C.Indigo="indigo",C.Violet="violet",C.Red="red",C.Orange="orange",C.Yellow="yellow",C),$3=((D=$3||{}).Small="small",D.Medium="medium",D.Large="large",D),$4=((E=$4||{}).Draw="draw",E.Solid="solid",E.Dashed="dashed",E.Dotted="dotted",E),$5=((F=$5||{}).Start="start",F.Middle="middle",F.End="end",F.Justify="justify",F),$6=((G=$6||{}).Script="script",G.Sans="sans",G.Serif="serif",G.Mono="mono",G),$7=((H=$7||{}).Arrow="arrow",H),$8=((I=$8||{}).Image="image",I.Video="video",I),z2=gO;let $9=z2.object({schemaVersion:z2.literal(1),storeVersion:z2.positiveInteger,recordVersions:z2.dict(z2.string,z2.object({version:z2.positiveInteger,subTypeVersions:z2.dict(z2.string,z2.positiveInteger).optional(),subTypeKey:z2.string.optional()}))}),_a=z2.object({schemaVersion:z2.literal(2),sequences:z2.dict(z2.string,z2.positiveInteger)});z2.object({tldrawFileFormatVersion:z2.nonZeroInteger,schema:z2.numberUnion("schemaVersion",{1:$9,2:_a}),records:z2.arrayOf(z2.object({id:z2.string,typeName:z2.string}).allowUnknownProperties())}),bV("tldraw","4.2.0","esm"),a.i(2921),a.i(45987),a.i(43382),a.i(62402),a.i(52441),a.i(8574),a.i(66247);class _b extends ps{static id="idle";onPointerDown=a=>{this.parent.transition("brushing",a)}}class _c extends ps{static id="brushing";onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onPointerMove=()=>{};onPointerUp=async()=>{let{inputs:a}=this.editor,{originPagePoint:b,currentPagePoint:c}=a,d={x:Math.min(b.x,c.x),y:Math.min(b.y,c.y),w:Math.abs(b.x-c.x),h:Math.abs(b.y-c.y)};console.log("Wand selection:",d);try{let a=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selection:d})}),b=await a.json();console.log("AI Response:",b),"math"===b.classification&&this.editor.createShape({type:"text",x:d.x+d.w+20,y:d.y,props:{text:b.latex_content}})}catch(a){console.error("AI Error",a)}this.parent.transition("idle")}}let _d=[class extends ps{static id="wand";static initial="idle";static children=()=>[_b,_c];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}];function _e(){let b=kp(),c=async c=>{let d=c.target.files?.[0];if(d)try{let{loadPDF:c}=await a.A(35995),e=await c(d),f=0;b.batch(()=>{e.forEach((a,c)=>{let d=`asset:${Date.now()}_${c}`,e=`shape:${Date.now()}_${c}`;b.createAssets([{id:d,type:"image",typeName:"asset",props:{name:`page_${c+1}`,src:a,w:1e3,h:1400,mimeType:"image/png",isAnimated:!1},meta:{}}]),b.createShape({id:e,type:"image",x:0,y:f,props:{assetId:d,w:1e3,h:1400}}),f+=1420})})}catch(a){console.error("Failed to load PDF",a),alert("Failed to load PDF")}};return(0,bT.jsxs)("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[1000] flex gap-2 bg-white p-2 rounded-lg shadow-md border border-gray-200 pointer-events-auto",children:[(0,bT.jsx)("button",{className:`p-2 rounded hover:bg-gray-100 ${"wand"===b.getCurrentToolId()?"bg-blue-100 text-blue-600":""}`,onClick:()=>b.setCurrentTool("wand"),title:"AI Wand",children:"🪄 AI Wand"}),(0,bT.jsx)("button",{className:`p-2 rounded hover:bg-gray-100 ${"select"===b.getCurrentToolId()?"bg-blue-100 text-blue-600":""}`,onClick:()=>b.setCurrentTool("select"),title:"Select",children:"👆 Select"}),(0,bT.jsx)("button",{className:`p-2 rounded hover:bg-gray-100 ${"draw"===b.getCurrentToolId()?"bg-blue-100 text-blue-600":""}`,onClick:()=>b.setCurrentTool("draw"),title:"Draw",children:"✏️ Draw"}),(0,bT.jsxs)("label",{className:"p-2 rounded hover:bg-gray-100 cursor-pointer",title:"Upload PDF",children:["📄 Upload PDF",(0,bT.jsx)("input",{type:"file",accept:".pdf",className:"hidden",onChange:c})]})]})}function _f(){return(0,bT.jsx)("div",{className:"fixed inset-0 w-screen h-screen",children:(0,bT.jsx)($_,{persistenceKey:"cognitive-canvas-v1",tools:_d,onMount:a=>{},children:(0,bT.jsx)(_e,{})})})}a.s(["default",()=>_f],76081)}];

//# sourceMappingURL=_15cc2f36._.js.map