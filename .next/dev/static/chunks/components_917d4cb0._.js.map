{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/NoteSmart/components/WandTool.ts"],"sourcesContent":["import { StateNode, TLEventHandlers } from 'tldraw'\r\n\r\nexport class WandIdle extends StateNode {\r\n\tstatic override id = 'idle'\r\n\r\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\r\n\t\tthis.parent.transition('brushing', info)\r\n\t}\r\n}\r\n\r\nexport class WandBrushing extends StateNode {\r\n\tstatic override id = 'brushing'\r\n\r\n\toverride onEnter = () => {\r\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\r\n\t}\r\n\r\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\r\n\t\t// Visual feedback could be added here (e.g. drawing a selection box)\r\n\t}\r\n\r\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = async () => {\r\n\t\tconst { inputs } = this.editor\r\n\t\tconst { originPagePoint, currentPagePoint } = inputs\r\n        \r\n        const box = {\r\n            x: Math.min(originPagePoint.x, currentPagePoint.x),\r\n            y: Math.min(originPagePoint.y, currentPagePoint.y),\r\n            w: Math.abs(originPagePoint.x - currentPagePoint.x),\r\n            h: Math.abs(originPagePoint.y - currentPagePoint.y),\r\n        }\r\n\r\n        // Trigger the AI action\r\n        console.log('Wand selection:', box)\r\n        \r\n        // Call the API\r\n        try {\r\n            const response = await fetch('/api/ai', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ selection: box })\r\n            });\r\n            const data = await response.json();\r\n            console.log('AI Response:', data);\r\n            \r\n            // Create a text shape with the result\r\n            if (data.classification === 'math') {\r\n                this.editor.createShape({\r\n                    type: 'text',\r\n                    x: box.x + box.w + 20,\r\n                    y: box.y,\r\n                    props: { text: data.latex_content }\r\n                })\r\n            }\r\n        } catch (e) {\r\n            console.error(\"AI Error\", e)\r\n        }\r\n\r\n\t\tthis.parent.transition('idle')\r\n\t}\r\n}\r\n\r\nexport class WandTool extends StateNode {\r\n\tstatic override id = 'wand'\r\n\tstatic override initial = 'idle'\r\n\tstatic override children = () => [WandIdle, WandBrushing]\r\n\r\n    override onEnter = () => {\r\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\r\n\t}\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAEO,MAAM,iBAAiB,2KAAS;IACtC,OAAgB,KAAK,OAAM;IAElB,gBAAkD,CAAC;QAC3D,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,YAAY;IACpC,EAAC;AACF;AAEO,MAAM,qBAAqB,2KAAS;IAC1C,OAAgB,KAAK,WAAU;IAEtB,UAAU;QAClB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC;YAAE,MAAM;YAAS,UAAU;QAAE;IACpD,EAAC;IAEQ,gBAAkD;IAC1D,qEAAqE;IACtE,EAAC;IAEQ,cAA8C;QACtD,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM;QAC9B,MAAM,EAAE,eAAe,EAAE,gBAAgB,EAAE,GAAG;QAExC,MAAM,MAAM;YACR,GAAG,KAAK,GAAG,CAAC,gBAAgB,CAAC,EAAE,iBAAiB,CAAC;YACjD,GAAG,KAAK,GAAG,CAAC,gBAAgB,CAAC,EAAE,iBAAiB,CAAC;YACjD,GAAG,KAAK,GAAG,CAAC,gBAAgB,CAAC,GAAG,iBAAiB,CAAC;YAClD,GAAG,KAAK,GAAG,CAAC,gBAAgB,CAAC,GAAG,iBAAiB,CAAC;QACtD;QAEA,wBAAwB;QACxB,QAAQ,GAAG,CAAC,mBAAmB;QAE/B,eAAe;QACf,IAAI;YACA,MAAM,WAAW,MAAM,MAAM,WAAW;gBACpC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,WAAW;gBAAI;YAC1C;YACA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,QAAQ,GAAG,CAAC,gBAAgB;YAE5B,sCAAsC;YACtC,IAAI,KAAK,cAAc,KAAK,QAAQ;gBAChC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC;oBACpB,MAAM;oBACN,GAAG,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG;oBACnB,GAAG,IAAI,CAAC;oBACR,OAAO;wBAAE,MAAM,KAAK,aAAa;oBAAC;gBACtC;YACJ;QACJ,EAAE,OAAO,GAAG;YACR,QAAQ,KAAK,CAAC,YAAY;QAC9B;QAEN,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;IACxB,EAAC;AACF;AAEO,MAAM,iBAAiB,2KAAS;IACtC,OAAgB,KAAK,OAAM;IAC3B,OAAgB,UAAU,OAAM;IAChC,OAAgB,WAAW,IAAM;YAAC;YAAU;SAAa,CAAA;IAE7C,UAAU;QACrB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC;YAAE,MAAM;YAAS,UAAU;QAAE;IACpD,EAAC;AACF"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///D:/NoteSmart/components/Canvas.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Tldraw, useEditor, Editor } from \"tldraw\";\r\nimport \"tldraw/tldraw.css\";\r\nimport { WandTool } from \"./WandTool\";\r\n\r\nconst customTools = [WandTool];\r\n\r\nfunction CustomToolbar() {\r\n  const editor = useEditor();\r\n  \r\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    \r\n    try {\r\n        // Dynamic import to avoid SSR issues with canvas/window\r\n        const { loadPDF } = await import('@/utils/pdf');\r\n        const images = await loadPDF(file);\r\n        \r\n        let yOffset = 0;\r\n        \r\n        // Use run which is often an alias or similar to batch in some versions, or just cast\r\n        // In tldraw v2+, it might be 'run' or just direct updates. \r\n        // But 'batch' should exist. Let's try casting to any to be safe for now as we know it exists in runtime.\r\n        (editor as any).batch(() => {\r\n            images.forEach((dataUrl, index) => {\r\n                const assetId = `asset:${Date.now()}_${index}` as any;\r\n                const shapeId = `shape:${Date.now()}_${index}` as any;\r\n                \r\n                // Create asset\r\n                editor.createAssets([\r\n                    {\r\n                        id: assetId,\r\n                        type: 'image',\r\n                        typeName: 'asset',\r\n                        props: {\r\n                            name: `page_${index + 1}`,\r\n                            src: dataUrl,\r\n                            w: 1000, // Placeholder, should be dynamic based on image\r\n                            h: 1400,\r\n                            mimeType: 'image/png',\r\n                            isAnimated: false\r\n                        },\r\n                        meta: {}\r\n                    }\r\n                ]);\r\n                \r\n                // Create shape\r\n                editor.createShape({\r\n                    id: shapeId,\r\n                    type: 'image',\r\n                    x: 0,\r\n                    y: yOffset,\r\n                    props: {\r\n                        assetId: assetId,\r\n                        w: 1000,\r\n                        h: 1400\r\n                    }\r\n                });\r\n                \r\n                yOffset += 1420; // Add some gap\r\n            });\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error(\"Failed to load PDF\", error);\r\n        alert(\"Failed to load PDF\");\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"absolute top-4 left-1/2 -translate-x-1/2 z-[1000] flex gap-2 bg-white p-2 rounded-lg shadow-md border border-gray-200 pointer-events-auto\">\r\n      <button\r\n        className={`p-2 rounded hover:bg-gray-100 ${editor.getCurrentToolId() === 'wand' ? 'bg-blue-100 text-blue-600' : ''}`}\r\n        onClick={() => editor.setCurrentTool('wand')}\r\n        title=\"AI Wand\"\r\n      >\r\n        ü™Ñ AI Wand\r\n      </button>\r\n      <button\r\n        className={`p-2 rounded hover:bg-gray-100 ${editor.getCurrentToolId() === 'select' ? 'bg-blue-100 text-blue-600' : ''}`}\r\n        onClick={() => editor.setCurrentTool('select')}\r\n        title=\"Select\"\r\n      >\r\n        üëÜ Select\r\n      </button>\r\n      <button\r\n        className={`p-2 rounded hover:bg-gray-100 ${editor.getCurrentToolId() === 'draw' ? 'bg-blue-100 text-blue-600' : ''}`}\r\n        onClick={() => editor.setCurrentTool('draw')}\r\n        title=\"Draw\"\r\n      >\r\n        ‚úèÔ∏è Draw\r\n      </button>\r\n      <label className=\"p-2 rounded hover:bg-gray-100 cursor-pointer\" title=\"Upload PDF\">\r\n        üìÑ Upload PDF\r\n        <input type=\"file\" accept=\".pdf\" className=\"hidden\" onChange={handleUpload} />\r\n      </label>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function Canvas() {\r\n  return (\r\n    <div className=\"fixed inset-0 w-screen h-screen\">\r\n      <Tldraw \r\n        persistenceKey=\"cognitive-canvas-v1\"\r\n        tools={customTools}\r\n        onMount={(editor: Editor) => {\r\n            // Initial setup if needed\r\n            // editor.setCurrentTool('wand') // Optional: start with wand\r\n        }}\r\n      >\r\n        <CustomToolbar />\r\n      </Tldraw>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAEA;;;AAJA;;;;AAMA,MAAM,cAAc;IAAC,qIAAQ;CAAC;AAE9B,SAAS;;IACP,MAAM,SAAS,IAAA,2KAAS;IAExB,MAAM,eAAe,OAAO;QAC1B,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QAChC,IAAI,CAAC,MAAM;QAEX,IAAI;YACA,wDAAwD;YACxD,MAAM,EAAE,OAAO,EAAE,GAAG;YACpB,MAAM,SAAS,MAAM,QAAQ;YAE7B,IAAI,UAAU;YAEd,qFAAqF;YACrF,4DAA4D;YAC5D,yGAAyG;YACxG,OAAe,KAAK,CAAC;gBAClB,OAAO,OAAO,CAAC,CAAC,SAAS;oBACrB,MAAM,UAAU,CAAC,MAAM,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,OAAO;oBAC9C,MAAM,UAAU,CAAC,MAAM,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,OAAO;oBAE9C,eAAe;oBACf,OAAO,YAAY,CAAC;wBAChB;4BACI,IAAI;4BACJ,MAAM;4BACN,UAAU;4BACV,OAAO;gCACH,MAAM,CAAC,KAAK,EAAE,QAAQ,GAAG;gCACzB,KAAK;gCACL,GAAG;gCACH,GAAG;gCACH,UAAU;gCACV,YAAY;4BAChB;4BACA,MAAM,CAAC;wBACX;qBACH;oBAED,eAAe;oBACf,OAAO,WAAW,CAAC;wBACf,IAAI;wBACJ,MAAM;wBACN,GAAG;wBACH,GAAG;wBACH,OAAO;4BACH,SAAS;4BACT,GAAG;4BACH,GAAG;wBACP;oBACJ;oBAEA,WAAW,MAAM,eAAe;gBACpC;YACJ;QAEJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,sBAAsB;YACpC,MAAM;QACV;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBACC,WAAW,CAAC,8BAA8B,EAAE,OAAO,gBAAgB,OAAO,SAAS,8BAA8B,IAAI;gBACrH,SAAS,IAAM,OAAO,cAAc,CAAC;gBACrC,OAAM;0BACP;;;;;;0BAGD,6LAAC;gBACC,WAAW,CAAC,8BAA8B,EAAE,OAAO,gBAAgB,OAAO,WAAW,8BAA8B,IAAI;gBACvH,SAAS,IAAM,OAAO,cAAc,CAAC;gBACrC,OAAM;0BACP;;;;;;0BAGD,6LAAC;gBACC,WAAW,CAAC,8BAA8B,EAAE,OAAO,gBAAgB,OAAO,SAAS,8BAA8B,IAAI;gBACrH,SAAS,IAAM,OAAO,cAAc,CAAC;gBACrC,OAAM;0BACP;;;;;;0BAGD,6LAAC;gBAAM,WAAU;gBAA+C,OAAM;;oBAAa;kCAEjF,6LAAC;wBAAM,MAAK;wBAAO,QAAO;wBAAO,WAAU;wBAAS,UAAU;;;;;;;;;;;;;;;;;;AAItE;GA5FS;;QACQ,2KAAS;;;KADjB;AA8FM,SAAS;IACtB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC,oKAAM;YACL,gBAAe;YACf,OAAO;YACP,SAAS,CAAC;YACN,0BAA0B;YAC1B,6DAA6D;YACjE;sBAEA,cAAA,6LAAC;;;;;;;;;;;;;;;AAIT;MAfwB"}}]
}